Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0BEAB9E3EE
	for <lists+spice-devel@lfdr.de>; Tue, 27 Aug 2019 11:23:01 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5944689836;
	Tue, 27 Aug 2019 09:22:59 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 71AE989836
 for <spice-devel@lists.freedesktop.org>; Tue, 27 Aug 2019 09:22:58 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx04.intmail.prod.int.phx2.redhat.com
 [10.5.11.14])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 1C5153084242;
 Tue, 27 Aug 2019 09:22:58 +0000 (UTC)
Received: from fziglio.remote.csb (ovpn-204-114.brq.redhat.com [10.40.204.114])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 25F045D9CC;
 Tue, 27 Aug 2019 09:22:55 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Tue, 27 Aug 2019 10:22:18 +0100
Message-Id: <20190827092246.10276-2-fziglio@redhat.com>
In-Reply-To: <20190827092246.10276-1-fziglio@redhat.com>
References: <20190827092246.10276-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.14
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.40]); Tue, 27 Aug 2019 09:22:58 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-gtk v4 01/29] usb-redir: define
 interfaces to support emulated devices
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogWXVyaSBCZW5kaXRvdmljaCA8eXVyaS5iZW5kaXRvdmljaEBkYXluaXguY29tPgoKU3Bp
Y2VVc2JCYWNrZW5kRGV2aWNlIHN0cnVjdHVyZSBpcyBleHRlbmRlZCB0byBzdXBwb3J0CmFkZGl0
aW9uYWwga2luZCBvZiBkZXZpY2UgdGhhdCBpcyBlbXVsYXRlZCBieSBTcGljZS1HVEsKYW5kIG5v
dCBwcmVzZW50IGxvY2FsbHkgKGFuZCBkb2VzIG5vdCBoYXZlIGxpYnVzYl9kZXZpY2UpLApzdWNo
IGRldmljZSBoYXMgaW5zdGVhZCBwb2ludGVyIHRvIFNwaWNlVXNiRW11bGF0ZWREZXZpY2UKYWJz
dHJhY3Qgc3RydWN0dXJlLiBTcGVjaWZpYyBpbXBsZW1lbnRhdGlvbiBvZiBzdWNoIGRldmljZQpk
ZXBlbmRzIG9uIGl0cyBkZXZpY2UgdHlwZS4gSW1wbGVtZW50YXRpb24gbW9kdWxlIHdpbGwgZGVm
aW5lCmNvbnN0cnVjdG9yIGZvciBzcGVjaWZpYyBkZXZpY2UgdHlwZS4KRGV2aWNlIHN0cnVjdHVy
ZSBpcyBhYnN0cmFjdCBidXQgYWx3YXlzIHN0YXJ0cyBmcm9tIHRhYmxlIG9mCnZpcnR1YWwgZnVu
Y3Rpb25zIHJlcXVpcmVkIHRvIHJlZGlyZWN0IHN1Y2ggdmlydHVhbCBkZXZpY2UuCgpTaWduZWQt
b2ZmLWJ5OiBZdXJpIEJlbmRpdG92aWNoIDx5dXJpLmJlbmRpdG92aWNoQGRheW5peC5jb20+Ci0t
LQogc3JjL21lc29uLmJ1aWxkICAgICB8ICAgMSArCiBzcmMvdXNiLWJhY2tlbmQuYyAgIHwgMTAz
ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKystCiBzcmMvdXNiLWJh
Y2tlbmQuaCAgIHwgICAzICsrCiBzcmMvdXNiLWVtdWxhdGlvbi5oIHwgIDg4ICsrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysKIDQgZmlsZXMgY2hhbmdlZCwgMTkzIGluc2VydGlv
bnMoKyksIDIgZGVsZXRpb25zKC0pCiBjcmVhdGUgbW9kZSAxMDA2NDQgc3JjL3VzYi1lbXVsYXRp
b24uaAoKZGlmZiAtLWdpdCBhL3NyYy9tZXNvbi5idWlsZCBiL3NyYy9tZXNvbi5idWlsZAppbmRl
eCBkYWM4NWE3Yi4uNGQ5MjE1YzggMTAwNjQ0Ci0tLSBhL3NyYy9tZXNvbi5idWlsZAorKysgYi9z
cmMvbWVzb24uYnVpbGQKQEAgLTEyMiw2ICsxMjIsNyBAQCBzcGljZV9jbGllbnRfZ2xpYl9zb3Vy
Y2VzID0gWwogICAndXNidXRpbC5jJywKICAgJ3VzYnV0aWwuaCcsCiAgICd1c2ItYmFja2VuZC5j
JywKKyAgJ3VzYi1lbXVsYXRpb24uaCcsCiAgICd1c2ItYmFja2VuZC5oJywKICAgJ3ZtY3N0cmVh
bS5jJywKICAgJ3ZtY3N0cmVhbS5oJywKZGlmZiAtLWdpdCBhL3NyYy91c2ItYmFja2VuZC5jIGIv
c3JjL3VzYi1iYWNrZW5kLmMKaW5kZXggOWFjODU5NWMuLmRlMmI1NWVjIDEwMDY0NAotLS0gYS9z
cmMvdXNiLWJhY2tlbmQuYworKysgYi9zcmMvdXNiLWJhY2tlbmQuYwpAQCAtMzksNiArMzksNyBA
QAogI2luY2x1ZGUgInVzYnJlZGlycGFyc2VyLmgiCiAjaW5jbHVkZSAic3BpY2UtdXRpbC5oIgog
I2luY2x1ZGUgInVzYi1iYWNrZW5kLmgiCisjaW5jbHVkZSAidXNiLWVtdWxhdGlvbi5oIgogI2lu
Y2x1ZGUgImNoYW5uZWwtdXNicmVkaXItcHJpdi5oIgogI2luY2x1ZGUgInNwaWNlLWNoYW5uZWwt
cHJpdi5oIgogCkBAIC00Niw3ICs0NywxMCBAQAogCiBzdHJ1Y3QgX1NwaWNlVXNiQmFja2VuZERl
dmljZQogeworICAgIC8qIFBvaW50ZXIgdG8gZGV2aWNlLiBFaXRoZXIgcmVhbCBkZXZpY2UgKGxp
YnVzYl9kZXZpY2UpCisgICAgICogb3IgZW11bGF0ZWQgb25lIChlZGV2KSAqLwogICAgIGxpYnVz
Yl9kZXZpY2UgKmxpYnVzYl9kZXZpY2U7CisgICAgU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZWRl
djsKICAgICBnaW50IHJlZl9jb3VudDsKICAgICBTcGljZVVzYkJhY2tlbmRDaGFubmVsICphdHRh
Y2hlZF90bzsKICAgICBVc2JEZXZpY2VJbmZvcm1hdGlvbiBkZXZpY2VfaW5mbzsKQEAgLTY2LDYg
KzcwLDEwIEBAIHN0cnVjdCBfU3BpY2VVc2JCYWNrZW5kCiAgICAgbGlidXNiX2RldmljZSAqKmxp
YnVzYl9kZXZpY2VfbGlzdDsKICAgICBnaW50IHJlZGlyZWN0aW5nOwogI2VuZGlmCisKKyAgICAv
KiBNYXNrIG9mIGFsbG9jYXRlZCBkZXZpY2UsIGEgc3BlY2lmaWMgYml0IHNldCB0byAxIHRvIGlu
ZGljYXRlIHRoYXQgdGhlIGRldmljZSBhdAorICAgICAqIHRoYXQgYWRkcmVzcyBpcyBhbGxvY2F0
ZWQgKi8KKyAgICB1aW50MzJfdCBvd25fZGV2aWNlc19tYXNrOwogfTsKIAogc3RydWN0IF9TcGlj
ZVVzYkJhY2tlbmRDaGFubmVsCkBAIC00MDgsNiArNDE2LDggQEAgU3BpY2VVc2JCYWNrZW5kICpz
cGljZV91c2JfYmFja2VuZF9uZXcoR0Vycm9yICoqZXJyb3IpCiAgICAgICAgIGxpYnVzYl9zZXRf
b3B0aW9uKGJlLT5saWJ1c2JfY29udGV4dCwgTElCVVNCX09QVElPTl9VU0VfVVNCREspOwogI2Vu
ZGlmCiAjZW5kaWYKKyAgICAgICAgLyogZXhjbHVkZSBhZGRyZXNzZXMgMCAocmVzZXJ2ZWQpIGFu
ZCAxIChyb290IGh1YikgKi8KKyAgICAgICAgYmUtPm93bl9kZXZpY2VzX21hc2sgPSAzOwogICAg
IH0KICAgICBTUElDRV9ERUJVRygiJXMgPDwiLCBfX0ZVTkNUSU9OX18pOwogICAgIHJldHVybiBi
ZTsKQEAgLTUyNCw4ICs1MzQsMTMgQEAgdm9pZCBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfdW5y
ZWYoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYpCiB7CiAgICAgTE9VRF9ERUJVRygiJXMgPj4g
JXAoJWQpIiwgX19GVU5DVElPTl9fLCBkZXYsIGRldi0+cmVmX2NvdW50KTsKICAgICBpZiAoZ19h
dG9taWNfaW50X2RlY19hbmRfdGVzdCgmZGV2LT5yZWZfY291bnQpKSB7Ci0gICAgICAgIGxpYnVz
Yl91bnJlZl9kZXZpY2UoZGV2LT5saWJ1c2JfZGV2aWNlKTsKLSAgICAgICAgTE9VRF9ERUJVRygi
JXMgZnJlZWluZyAlcCAobGlidXNiICVwKSIsIF9fRlVOQ1RJT05fXywgZGV2LCBkZXYtPmxpYnVz
Yl9kZXZpY2UpOworICAgICAgICBpZiAoZGV2LT5saWJ1c2JfZGV2aWNlKSB7CisgICAgICAgICAg
ICBsaWJ1c2JfdW5yZWZfZGV2aWNlKGRldi0+bGlidXNiX2RldmljZSk7CisgICAgICAgICAgICBM
T1VEX0RFQlVHKCIlcyBmcmVlaW5nICVwIChsaWJ1c2IgJXApIiwgX19GVU5DVElPTl9fLCBkZXYs
IGRldi0+bGlidXNiX2RldmljZSk7CisgICAgICAgIH0KKyAgICAgICAgaWYgKGRldi0+ZWRldikg
eworICAgICAgICAgICAgZGV2aWNlX29wcyhkZXYtPmVkZXYpLT51bnJlYWxpemUoZGV2LT5lZGV2
KTsKKyAgICAgICAgfQogICAgICAgICBnX2ZyZWUoZGV2KTsKICAgICB9CiB9CkBAIC04MjQsNCAr
ODM5LDg4IEBAIHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfZ2V0X2d1ZXN0X2ZpbHRlcihTcGlj
ZVVzYkJhY2tlbmRDaGFubmVsICpjaCwKICAgICB9CiB9CiAKK3ZvaWQgc3BpY2VfdXNiX2JhY2tl
bmRfZGV2aWNlX3JlcG9ydF9jaGFuZ2UoU3BpY2VVc2JCYWNrZW5kICpiZSwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpk
ZXYpCit7CisgICAgZ2NoYXIgKmRlc2M7CisgICAgZ19yZXR1cm5faWZfZmFpbChkZXYgJiYgZGV2
LT5lZGV2KTsKKworICAgIGRlc2MgPSBkZXZpY2Vfb3BzKGRldi0+ZWRldiktPmdldF9wcm9kdWN0
X2Rlc2NyaXB0aW9uKGRldi0+ZWRldik7CisgICAgU1BJQ0VfREVCVUcoIiVzOiAlcyIsIF9fRlVO
Q1RJT05fXywgZGVzYyk7CisgICAgZ19mcmVlKGRlc2MpOworfQorCit2b2lkIHNwaWNlX3VzYl9i
YWNrZW5kX2RldmljZV9lamVjdChTcGljZVVzYkJhY2tlbmQgKmJlLCBTcGljZVVzYkJhY2tlbmRE
ZXZpY2UgKmRldikKK3sKKyAgICBnX3JldHVybl9pZl9mYWlsKGRldik7CisKKyAgICBpZiAoZGV2
LT5lZGV2KSB7CisgICAgICAgIGJlLT5vd25fZGV2aWNlc19tYXNrICY9IH4oMSA8PCBkZXYtPmRl
dmljZV9pbmZvLmFkZHJlc3MpOworICAgIH0KKyAgICBpZiAoYmUtPmhvdHBsdWdfY2FsbGJhY2sp
IHsKKyAgICAgICAgYmUtPmhvdHBsdWdfY2FsbGJhY2soYmUtPmhvdHBsdWdfdXNlcl9kYXRhLCBk
ZXYsIEZBTFNFKTsKKyAgICB9Cit9CisKK2dib29sZWFuCitzcGljZV91c2JfYmFja2VuZF9jcmVh
dGVfZW11bGF0ZWRfZGV2aWNlKFNwaWNlVXNiQmFja2VuZCAqYmUsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNlVXNiRW11bGF0ZWREZXZpY2VDcmVhdGUgY3Jl
YXRlX3Byb2MsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQg
KmNyZWF0ZV9wYXJhbXMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IEdFcnJvciAqKmVycikKK3sKKyAgICBTcGljZVVzYkVtdWxhdGVkRGV2aWNlICplZGV2OworICAg
IFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2OworICAgIHN0cnVjdCBsaWJ1c2JfZGV2aWNlX2Rl
c2NyaXB0b3IgKmRlc2M7CisgICAgdWludDE2X3QgZGV2aWNlX2Rlc2Nfc2l6ZTsKKyAgICB1aW50
OF90IGFkZHJlc3MgPSAwOworCisgICAgaWYgKGJlLT5vd25fZGV2aWNlc19tYXNrID09IDB4ZmZm
ZmZmZmYpIHsKKyAgICAgICAgZ19zZXRfZXJyb3IoZXJyLCBTUElDRV9DTElFTlRfRVJST1IsIFNQ
SUNFX0NMSUVOVF9FUlJPUl9GQUlMRUQsCisgICAgICAgICAgICAgICAgICAgIF8oImNhbid0IGNy
ZWF0ZSBkZXZpY2UgLSBsaW1pdCByZWFjaGVkIikpOworICAgICAgICByZXR1cm4gRkFMU0U7Cisg
ICAgfQorICAgIGZvciAoYWRkcmVzcyA9IDA7IGFkZHJlc3MgPCAzMjsgKythZGRyZXNzKSB7Cisg
ICAgICAgIGlmICh+YmUtPm93bl9kZXZpY2VzX21hc2sgJiAoMSA8PCBhZGRyZXNzKSkgeworICAg
ICAgICAgICAgYnJlYWs7CisgICAgICAgIH0KKyAgICB9CisKKyAgICBkZXYgPSBnX25ldzAoU3Bp
Y2VVc2JCYWNrZW5kRGV2aWNlLCAxKTsKKyAgICBkZXYtPmRldmljZV9pbmZvLmJ1cyA9IEJVU19O
VU1CRVJfRk9SX0VNVUxBVEVEX1VTQjsKKyAgICBkZXYtPmRldmljZV9pbmZvLmFkZHJlc3MgPSBh
ZGRyZXNzOworICAgIGRldi0+cmVmX2NvdW50ID0gMTsKKworICAgIGRldi0+ZWRldiA9IGVkZXYg
PSBjcmVhdGVfcHJvYyhiZSwgZGV2LCBjcmVhdGVfcGFyYW1zLCBlcnIpOworICAgIGlmIChlZGV2
ID09IE5VTEwpIHsKKyAgICAgICAgc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX3VucmVmKGRldik7
CisgICAgICAgIHJldHVybiBGQUxTRTsKKyAgICB9CisKKyAgICBpZiAoIWRldmljZV9vcHMoZWRl
diktPmdldF9kZXNjcmlwdG9yKGVkZXYsIExJQlVTQl9EVF9ERVZJQ0UsIDAsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodm9pZCAqKikmZGVzYywgJmRldmljZV9k
ZXNjX3NpemUpCisgICAgICAgIHx8IGRldmljZV9kZXNjX3NpemUgIT0gc2l6ZW9mKCpkZXNjKSkg
eworCisgICAgICAgIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV91bnJlZihkZXYpOworICAgICAg
ICBnX3NldF9lcnJvcihlcnIsIFNQSUNFX0NMSUVOVF9FUlJPUiwgU1BJQ0VfQ0xJRU5UX0VSUk9S
X0ZBSUxFRCwKKyAgICAgICAgICAgICAgICAgICAgXygiY2FuJ3QgY3JlYXRlIGRldmljZSAtIGlu
dGVybmFsIGVycm9yIikpOworICAgICAgICByZXR1cm4gRkFMU0U7CisgICAgfQorCisgICAgYmUt
Pm93bl9kZXZpY2VzX21hc2sgfD0gMSA8PCBhZGRyZXNzOworCisgICAgZGV2LT5kZXZpY2VfaW5m
by52aWQgPSBkZXNjLT5pZFZlbmRvcjsKKyAgICBkZXYtPmRldmljZV9pbmZvLnBpZCA9IGRlc2Mt
PmlkUHJvZHVjdDsKKyAgICBkZXYtPmRldmljZV9pbmZvLmJjZFVTQiA9IGRlc2MtPmJjZFVTQjsK
KyAgICBkZXYtPmRldmljZV9pbmZvLmNsYXNzID0gZGVzYy0+YkRldmljZUNsYXNzOworICAgIGRl
di0+ZGV2aWNlX2luZm8uc3ViY2xhc3MgPSBkZXNjLT5iRGV2aWNlU3ViQ2xhc3M7CisgICAgZGV2
LT5kZXZpY2VfaW5mby5wcm90b2NvbCA9IGRlc2MtPmJEZXZpY2VQcm90b2NvbDsKKworICAgIGlm
IChiZS0+aG90cGx1Z19jYWxsYmFjaykgeworICAgICAgICBiZS0+aG90cGx1Z19jYWxsYmFjayhi
ZS0+aG90cGx1Z191c2VyX2RhdGEsIGRldiwgVFJVRSk7CisgICAgfQorICAgIHNwaWNlX3VzYl9i
YWNrZW5kX2RldmljZV91bnJlZihkZXYpOworCisgICAgcmV0dXJuIFRSVUU7Cit9CisKICNlbmRp
ZiAvKiBVU0JfUkVESVIgKi8KZGlmZiAtLWdpdCBhL3NyYy91c2ItYmFja2VuZC5oIGIvc3JjL3Vz
Yi1iYWNrZW5kLmgKaW5kZXggNjZlMTNmNTQuLmNkM2ZmMDk3IDEwMDY0NAotLS0gYS9zcmMvdXNi
LWJhY2tlbmQuaAorKysgYi9zcmMvdXNiLWJhY2tlbmQuaApAQCAtMzAsMTIgKzMwLDE1IEBAIHR5
cGVkZWYgc3RydWN0IF9TcGljZVVzYkJhY2tlbmQgU3BpY2VVc2JCYWNrZW5kOwogdHlwZWRlZiBz
dHJ1Y3QgX1NwaWNlVXNiQmFja2VuZERldmljZSBTcGljZVVzYkJhY2tlbmREZXZpY2U7CiB0eXBl
ZGVmIHN0cnVjdCBfU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCBTcGljZVVzYkJhY2tlbmRDaGFubmVs
OwogCisjZGVmaW5lIEJVU19OVU1CRVJfRk9SX0VNVUxBVEVEX1VTQiBHX01BWFVJTlQxNgorCiB0
eXBlZGVmIHN0cnVjdCBVc2JEZXZpY2VJbmZvcm1hdGlvbgogewogICAgIHVpbnQxNl90IGJ1czsK
ICAgICB1aW50MTZfdCBhZGRyZXNzOwogICAgIHVpbnQxNl90IHZpZDsKICAgICB1aW50MTZfdCBw
aWQ7CisgICAgdWludDE2X3QgYmNkVVNCOwogICAgIHVpbnQ4X3QgY2xhc3M7CiAgICAgdWludDhf
dCBzdWJjbGFzczsKICAgICB1aW50OF90IHByb3RvY29sOwpkaWZmIC0tZ2l0IGEvc3JjL3VzYi1l
bXVsYXRpb24uaCBiL3NyYy91c2ItZW11bGF0aW9uLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5k
ZXggMDAwMDAwMDAuLmFjM2Q4ZTA1Ci0tLSAvZGV2L251bGwKKysrIGIvc3JjL3VzYi1lbXVsYXRp
b24uaApAQCAtMCwwICsxLDg4IEBACisvKiAtKi0gTW9kZTogQzsgYy1iYXNpYy1vZmZzZXQ6IDQ7
IGluZGVudC10YWJzLW1vZGU6IG5pbCAtKi0gKi8KKy8qCisgICAgQ29weXJpZ2h0IChDKSAyMDE5
IFJlZCBIYXQsIEluYy4KKworICAgIFJlZCBIYXQgQXV0aG9yczoKKyAgICBZdXJpIEJlbmRpdG92
aWNoPHliZW5kaXRvQHJlZGhhdC5jb20+CisKKyAgICBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0
d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCisgICAgbW9kaWZ5IGl0IHVuZGVy
IHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYworICAgIExpY2Vuc2Ug
YXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlcgorICAg
IHZlcnNpb24gMi4xIG9mIHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRl
ciB2ZXJzaW9uLgorCisgICAgVGhpcyBsaWJyYXJ5IGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3Bl
IHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCisgICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3
aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKKyAgICBNRVJDSEFOVEFCSUxJVFkg
b3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQorICAgIExl
c3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCisKKyAgICBZb3Ug
c2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVi
bGljCisgICAgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCBzZWUgPGh0
dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgorKi8KKworI3ByYWdtYSBvbmNlCisKKyNpbmNs
dWRlICJ1c2JyZWRpcnBhcnNlci5oIgorI2luY2x1ZGUgInVzYi1iYWNrZW5kLmgiCisKK3R5cGVk
ZWYgc3RydWN0IFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgU3BpY2VVc2JFbXVsYXRlZERldmljZTsK
K3R5cGVkZWYgU3BpY2VVc2JFbXVsYXRlZERldmljZSoKKygqU3BpY2VVc2JFbXVsYXRlZERldmlj
ZUNyZWF0ZSkoU3BpY2VVc2JCYWNrZW5kICpiZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpwYXJlbnQsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHZvaWQgKmNyZWF0ZV9wYXJhbXMsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIEdFcnJvciAqKmVycik7CisKKy8qCisgICAgZnVuY3Rpb24gdGFibGUgZm9yIGVt
dWxhdGVkIFVTQiBkZXZpY2UKKyAgICBtdXN0IGJlIGZpcnN0IG1lbWJlciBvZiBkZXZpY2Ugc3Ry
dWN0dXJlCisgICAgYWxsIGZ1bmN0aW9ucyBhcmUgbWFuZGF0b3J5IGZvciBpbXBsZW1lbnRhdGlv
bgorKi8KK3R5cGVkZWYgc3RydWN0IFVzYkRldmljZU9wcyB7CisgICAgZ2Jvb2xlYW4gKCpnZXRf
ZGVzY3JpcHRvcikoU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZGV2aWNlLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHVpbnQ4X3QgdHlwZSwgdWludDhfdCBpbmRleCwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB2b2lkICoqYnVmZmVyLCB1aW50MTZfdCAqc2l6ZSk7Cisg
ICAgZ2NoYXIgKiAoKmdldF9wcm9kdWN0X2Rlc2NyaXB0aW9uKShTcGljZVVzYkVtdWxhdGVkRGV2
aWNlICpkZXZpY2UpOworICAgIHZvaWQgKCphdHRhY2gpKFNwaWNlVXNiRW11bGF0ZWREZXZpY2Ug
KmRldmljZSwgc3RydWN0IHVzYnJlZGlycGFyc2VyICpwYXJzZXIpOworICAgIHZvaWQgKCpyZXNl
dCkoU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZGV2aWNlKTsKKyAgICAvKgorICAgICAgICBwcm9j
ZXNzaW5nIGlzIHN5bmNocm9ub3VzLCBkZWZhdWx0ID0gc3RhbGw6CisgICAgICAgIC0gcmV0dXJu
IHN1Y2Nlc3Mgd2l0aG91dCBkYXRhOiBzZXQgc3RhdHVzIHRvIDAKKyAgICAgICAgLSByZXR1cm4g
ZXJyb3IgLSBzZXQgc3RhdHVzIHRvIGVycm9yCisgICAgICAgIC0gcmV0dXJuIHN1Y2Nlc3Mgd2l0
aCBkYXRhIC0gc2V0IHN0YXR1cyB0byAwLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgc2V0IGJ1ZmZlciB0byBzb21lIGJ1ZmZlcgorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc2V0IGxlbmd0aCB0byBvdXQgbGVuCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB0cnVuY2F0aW9uIGlzIGF1dG9tYXRpYworICAgICovCisgICAgdm9pZCAo
KmNvbnRyb2xfcmVxdWVzdCkoU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZGV2aWNlLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHVpbnQ4X3QgKmRhdGEsIGludCBkYXRhX2xlbiwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgdXNiX3JlZGlyX2NvbnRyb2xfcGFja2V0X2hl
YWRlciAqaCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICoqYnVmZmVyKTsKKyAg
ICAvKgorICAgICAgICBwcm9jZXNzaW5nIGlzIHN5bmNocm9ub3VzOgorICAgICAgICAtIHNldCBo
LT5zdGF0dXMgdG8gcmVzdWx0aW5nIHN0YXR1cywgZGVmYXVsdCA9IHN0YWxsCisgICAgKi8KKyAg
ICB2b2lkICgqYnVsa19vdXRfcmVxdWVzdCkoU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZGV2aWNl
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50OF90IGVwLCB1aW50OF90ICpkYXRh
LCBpbnQgZGF0YV9sZW4sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ4X3QgKnN0
YXR1cyk7CisgICAgLyoKKyAgICAgICAgaWYgcmV0dXJucyB0cnVlLCBwcm9jZXNzaW5nIGlzIGFz
eW5jaHJvbm91cworICAgICAgICBvdGhlcndpc2UgaGVhZGVyIGNvbnRhaW5zIGVycm9yIHN0YXR1
cworICAgICovCisgICAgZ2Jvb2xlYW4gKCpidWxrX2luX3JlcXVlc3QpKFNwaWNlVXNiRW11bGF0
ZWREZXZpY2UgKmRldmljZSwgdWludDY0X3QgaWQsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgc3RydWN0IHVzYl9yZWRpcl9idWxrX3BhY2tldF9oZWFkZXIgKmJ1bGtfaGVhZGVyKTsKKyAg
ICB2b2lkICgqY2FuY2VsX3JlcXVlc3QpKFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmRldmljZSwg
dWludDY0X3QgaWQpOworICAgIHZvaWQgKCpkZXRhY2gpKFNwaWNlVXNiRW11bGF0ZWREZXZpY2Ug
KmRldmljZSk7CisgICAgdm9pZCAoKnVucmVhbGl6ZSkoU3BpY2VVc2JFbXVsYXRlZERldmljZSAq
ZGV2aWNlKTsKK30gVXNiRGV2aWNlT3BzOworCitzdGF0aWMgaW5saW5lIGNvbnN0IFVzYkRldmlj
ZU9wcyAqZGV2aWNlX29wcyhTcGljZVVzYkVtdWxhdGVkRGV2aWNlICpkZXYpCit7CisgICAgcmV0
dXJuIChjb25zdCBVc2JEZXZpY2VPcHMgKilkZXY7Cit9CisKK2dib29sZWFuCitzcGljZV91c2Jf
YmFja2VuZF9jcmVhdGVfZW11bGF0ZWRfZGV2aWNlKFNwaWNlVXNiQmFja2VuZCAqYmUsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNlVXNiRW11bGF0ZWREZXZp
Y2VDcmVhdGUgY3JlYXRlX3Byb2MsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHZvaWQgKmNyZWF0ZV9wYXJhbXMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIEdFcnJvciAqKmVycik7Cit2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2Rldmlj
ZV9lamVjdChTcGljZVVzYkJhY2tlbmQgKmJlLCBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldmlj
ZSk7Cit2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9yZXBvcnRfY2hhbmdlKFNwaWNlVXNi
QmFja2VuZCAqYmUsIFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2aWNlKTsKLS0gCjIuMjAuMQoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KU3BpY2UtZGV2
ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
