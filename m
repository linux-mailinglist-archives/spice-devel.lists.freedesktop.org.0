Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B44FE583B0
	for <lists+spice-devel@lfdr.de>; Thu, 27 Jun 2019 15:37:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C76896E36D;
	Thu, 27 Jun 2019 13:37:26 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3E1186E36D
 for <spice-devel@lists.freedesktop.org>; Thu, 27 Jun 2019 13:37:25 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
 [10.5.11.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id BEA69308FE8D
 for <spice-devel@lists.freedesktop.org>; Thu, 27 Jun 2019 13:37:24 +0000 (UTC)
Received: from dhcp-4-93.tlv.redhat.com (dhcp-4-93.tlv.redhat.com [10.35.4.93])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 2B12D5D707
 for <spice-devel@lists.freedesktop.org>; Thu, 27 Jun 2019 13:37:23 +0000 (UTC)
From: Snir Sheriber <ssheribe@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Thu, 27 Jun 2019 16:37:21 +0300
Message-Id: <20190627133722.15613-1-ssheribe@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.49]); Thu, 27 Jun 2019 13:37:24 +0000 (UTC)
Subject: [Spice-devel] [PATCH v2 spice-streaming-agent 1/2] drop sstream and
 use dedicated functions instead
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

SW5zdGVhZCBvZiBtYW5pcHVsYXRpbmcgYSBzdHJpbmcgYW5kIGNvbnZlcnQgaXQgdG8gY2FwcyBq
dXN0CnVzZSBkZWRpY2F0ZWQgZnVuY3Rpb25zIGluc3RlYWQKClNpZ25lZC1vZmYtYnk6IFNuaXIg
U2hlcmliZXIgPHNzaGVyaWJlQHJlZGhhdC5jb20+Ci0tLQpDaGFuZ2VzOgotY29tbWl0IGxvZwot
U3VnZ2VzdGluZyB1bmlxcHRyIGZvciBjYXBzX3N0cgotLQogc3JjL2dzdC1wbHVnaW4uY3BwIHwg
MzQgKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDE4
IGluc2VydGlvbnMoKyksIDE2IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3NyYy9nc3QtcGx1
Z2luLmNwcCBiL3NyYy9nc3QtcGx1Z2luLmNwcAppbmRleCA5ODU4YmViLi4wZGQ3Nzk2IDEwMDY0
NAotLS0gYS9zcmMvZ3N0LXBsdWdpbi5jcHAKKysrIGIvc3JjL2dzdC1wbHVnaW4uY3BwCkBAIC04
LDcgKzgsNiBAQAogI2luY2x1ZGUgPGNzdHJpbmc+CiAjaW5jbHVkZSA8ZXhjZXB0aW9uPgogI2lu
Y2x1ZGUgPHN0ZGV4Y2VwdD4KLSNpbmNsdWRlIDxzc3RyZWFtPgogI2luY2x1ZGUgPG1lbW9yeT4K
ICNpbmNsdWRlIDxzeXNsb2cuaD4KICNpbmNsdWRlIDx1bmlzdGQuaD4KQEAgLTEzMiwzNCArMTMx
LDM1IEBAIEdzdEVsZW1lbnQgKkdzdHJlYW1lckZyYW1lQ2FwdHVyZTo6Z2V0X2VuY29kZXJfcGx1
Z2luKGNvbnN0IEdzdHJlYW1lckVuY29kZXJTZXR0CiAgICAgR0xpc3QgKmZpbHRlcmVkOwogICAg
IEdzdEVsZW1lbnQgKmVuY29kZXI7CiAgICAgR3N0RWxlbWVudEZhY3RvcnkgKmZhY3RvcnkgPSBu
dWxscHRyOwotICAgIHN0ZDo6c3RyaW5nc3RyZWFtIGNhcHNfc3M7CiAKICAgICBzd2l0Y2ggKHNl
dHRpbmdzLmNvZGVjKSB7CiAgICAgY2FzZSBTUElDRV9WSURFT19DT0RFQ19UWVBFX0gyNjQ6Ci0g
ICAgICAgIGNhcHNfc3MgPDwgInZpZGVvL3gtaDI2NCIgPDwgIixzdHJlYW0tZm9ybWF0PShzdHJp
bmcpYnl0ZS1zdHJlYW0iOworICAgICAgICBzaW5rX2NhcHMucmVzZXQoZ3N0X2NhcHNfbmV3X3Np
bXBsZSgidmlkZW8veC1oMjY0IiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgInN0cmVhbS1mb3JtYXQiLCBHX1RZUEVfU1RSSU5HLCAiYnl0ZS1zdHJlYW0iLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOVUxMKSk7CiAgICAg
ICAgIGJyZWFrOwogICAgIGNhc2UgU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9NSlBFRzoKLSAgICAg
ICAgY2Fwc19zcyA8PCAiaW1hZ2UvanBlZyI7CisgICAgICAgIHNpbmtfY2Fwcy5yZXNldChnc3Rf
Y2Fwc19uZXdfZW1wdHlfc2ltcGxlKCJpbWFnZS9qcGVnIikpOwogICAgICAgICBicmVhazsKICAg
ICBjYXNlIFNQSUNFX1ZJREVPX0NPREVDX1RZUEVfVlA4OgotICAgICAgICBjYXBzX3NzIDw8ICJ2
aWRlby94LXZwOCI7CisgICAgICAgIHNpbmtfY2Fwcy5yZXNldChnc3RfY2Fwc19uZXdfZW1wdHlf
c2ltcGxlKCJ2aWRlby94LXZwOCIpKTsKICAgICAgICAgYnJlYWs7CiAgICAgY2FzZSBTUElDRV9W
SURFT19DT0RFQ19UWVBFX1ZQOToKLSAgICAgICAgY2Fwc19zcyA8PCAidmlkZW8veC12cDkiOwor
ICAgICAgICBzaW5rX2NhcHMucmVzZXQoZ3N0X2NhcHNfbmV3X2VtcHR5X3NpbXBsZSgidmlkZW8v
eC12cDkiKSk7CiAgICAgICAgIGJyZWFrOwogICAgIGNhc2UgU1BJQ0VfVklERU9fQ09ERUNfVFlQ
RV9IMjY1OgotICAgICAgICBjYXBzX3NzIDw8ICJ2aWRlby94LWgyNjUiOworICAgICAgICBzaW5r
X2NhcHMucmVzZXQoZ3N0X2NhcHNfbmV3X2VtcHR5X3NpbXBsZSgidmlkZW8veC1oMjY1IikpOwog
ICAgICAgICBicmVhazsKICAgICBkZWZhdWx0IDogLyogU2hvdWxkIG5vdCBoYXBwZW4gLSBqdXN0
IHRvIGF2b2lkIGNvbXBpbGVyJ3MgY29tcGxhaW50ICovCiAgICAgICAgIHRocm93IHN0ZDo6bG9n
aWNfZXJyb3IoIlVua25vd24gY29kZWMiKTsKICAgICB9Ci0gICAgY2Fwc19zcyA8PCAiLGZyYW1l
cmF0ZT0iIDw8IHNldHRpbmdzLmZwcyA8PCAiLzEiOworICAgIGdzdF9jYXBzX3NldF9zaW1wbGUo
c2lua19jYXBzLmdldCgpLCAiZnJhbWVyYXRlIiwgR1NUX1RZUEVfRlJBQ1RJT04sIHNldHRpbmdz
LmZwcywgMSwgbnVsbHB0cik7CisgICAgc3RkOjp1bmlxdWVfcHRyPGdjaGFyPiBjYXBzX3N0cihn
c3RfY2Fwc190b19zdHJpbmcoc2lua19jYXBzLmdldCgpKSk7CiAKICAgICBlbmNvZGVycyA9IGdz
dF9lbGVtZW50X2ZhY3RvcnlfbGlzdF9nZXRfZWxlbWVudHMoR1NUX0VMRU1FTlRfRkFDVE9SWV9U
WVBFX1ZJREVPX0VOQ09ERVIsIEdTVF9SQU5LX05PTkUpOwotICAgIHNpbmtfY2Fwcy5yZXNldChn
c3RfY2Fwc19mcm9tX3N0cmluZyhjYXBzX3NzLnN0cigpLmNfc3RyKCkpKTsKICAgICBmaWx0ZXJl
ZCA9IGdzdF9lbGVtZW50X2ZhY3RvcnlfbGlzdF9maWx0ZXIoZW5jb2RlcnMsIHNpbmtfY2Fwcy5n
ZXQoKSwgR1NUX1BBRF9TUkMsIGZhbHNlKTsKICAgICBpZiAoZmlsdGVyZWQpIHsKLSAgICAgICAg
Z3N0X3N5c2xvZyhMT0dfTk9USUNFLCAiTG9va2luZyBmb3IgZW5jb2RlciBwbHVnaW5zIHdoaWNo
IGNhbiBwcm9kdWNlIGEgJyVzJyBzdHJlYW0iLCBjYXBzX3NzLnN0cigpLmNfc3RyKCkpOworICAg
ICAgICBnc3Rfc3lzbG9nKExPR19OT1RJQ0UsICJMb29raW5nIGZvciBlbmNvZGVyIHBsdWdpbnMg
d2hpY2ggY2FuIHByb2R1Y2UgYSAnJXMnIHN0cmVhbSIsIGNhcHNfc3RyLmdldCgpKTsKICAgICAg
ICAgZm9yIChHTGlzdCAqbCA9IGZpbHRlcmVkOyBsICE9IG51bGxwdHI7IGwgPSBsLT5uZXh0KSB7
CiAgICAgICAgICAgICBpZiAoIWZhY3RvcnkgJiYgIXNldHRpbmdzLmVuY29kZXIuY29tcGFyZShH
U1RfRUxFTUVOVF9OQU1FKGwtPmRhdGEpKSkgewogICAgICAgICAgICAgICAgIGZhY3RvcnkgPSAo
R3N0RWxlbWVudEZhY3RvcnkqKWwtPmRhdGE7CkBAIC0xNjksMTMgKzE2OSwxMyBAQCBHc3RFbGVt
ZW50ICpHc3RyZWFtZXJGcmFtZUNhcHR1cmU6OmdldF9lbmNvZGVyX3BsdWdpbihjb25zdCBHc3Ry
ZWFtZXJFbmNvZGVyU2V0dAogICAgICAgICBpZiAoIWZhY3RvcnkgJiYgIXNldHRpbmdzLmVuY29k
ZXIuZW1wdHkoKSkgewogICAgICAgICAgICAgZ3N0X3N5c2xvZyhMT0dfV0FSTklORywKICAgICAg
ICAgICAgICAgICAgICAgICAgIlNwZWNpZmllZCBlbmNvZGVyIG5hbWVkICclcycgY2Fubm90IHBy
b2R1Y2UgJyVzJyBzdHJlYW0sIG1ha2Ugc3VyZSBtYXRjaGluZyBnc3QuY29kZWMgaXMgc3BlY2lm
aWVkIGFuZCBwbHVnaW4ncyBhdmFpbGFiaWxpdHkiLAotICAgICAgICAgICAgICAgICAgICAgICBz
ZXR0aW5ncy5lbmNvZGVyLmNfc3RyKCksIGNhcHNfc3Muc3RyKCkuY19zdHIoKSk7CisgICAgICAg
ICAgICAgICAgICAgICAgIHNldHRpbmdzLmVuY29kZXIuY19zdHIoKSwgY2Fwc19zdHIuZ2V0KCkp
OwogICAgICAgICB9CiAgICAgICAgIGZhY3RvcnkgPSBmYWN0b3J5ID8gZmFjdG9yeSA6IChHc3RF
bGVtZW50RmFjdG9yeSopZmlsdGVyZWQtPmRhdGE7CiAgICAgICAgIGdzdF9zeXNsb2coTE9HX05P
VElDRSwgIiclcycgZW5jb2RlciBwbHVnaW4gaXMgdXNlZCIsIEdTVF9FTEVNRU5UX05BTUUoZmFj
dG9yeSkpOwogCiAgICAgfSBlbHNlIHsKLSAgICAgICAgZ3N0X3N5c2xvZyhMT0dfRVJSLCAiTm8g
c3VpdGFibGUgZW5jb2RlciB3YXMgZm91bmQgZm9yICclcyciLCBjYXBzX3NzLnN0cigpLmNfc3Ry
KCkpOworICAgICAgICBnc3Rfc3lzbG9nKExPR19FUlIsICJObyBzdWl0YWJsZSBlbmNvZGVyIHdh
cyBmb3VuZCBmb3IgJyVzJyIsIGNhcHNfc3RyLmdldCgpKTsKICAgICB9CiAKICAgICBlbmNvZGVy
ID0gZmFjdG9yeSA/IGdzdF9lbGVtZW50X2ZhY3RvcnlfY3JlYXRlKGZhY3RvcnksICJlbmNvZGVy
IikgOiBudWxscHRyOwpAQCAtMzUxLDEwICszNTEsMTIgQEAgdm9pZCBHc3RyZWFtZXJGcmFtZUNh
cHR1cmU6OnhsaWJfY2FwdHVyZSgpCiAgICAgICAgIHRocm93IHN0ZDo6cnVudGltZV9lcnJvcigi
RmFpbGVkIHRvIHdyYXAgaW1hZ2UgaW4gZ3N0cmVhbWVyIGJ1ZmZlciIpOwogICAgIH0KIAotICAg
IHN0ZDo6c3RyaW5nc3RyZWFtIHNzOwotCi0gICAgc3MgPDwgInZpZGVvL3gtcmF3LGZvcm1hdD1C
R1J4LHdpZHRoPSIgPDwgaW1hZ2UtPndpZHRoIDw8ICIsaGVpZ2h0PSIgPDwgaW1hZ2UtPmhlaWdo
dCA8PCAiLGZyYW1lcmF0ZT0iIDw8IHNldHRpbmdzLmZwcyA8PCAiLzEiOwotICAgIEdzdENhcHNV
UHRyIGNhcHMoZ3N0X2NhcHNfZnJvbV9zdHJpbmcoc3Muc3RyKCkuY19zdHIoKSkpOworICAgIEdz
dENhcHNVUHRyIGNhcHMoZ3N0X2NhcHNfbmV3X3NpbXBsZSgidmlkZW8veC1yYXciLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZm9ybWF0IiwgR19UWVBFX1NUUklO
RywgIkJHUngiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAid2lk
dGgiLCBHX1RZUEVfSU5ULCBpbWFnZS0+d2lkdGgsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICJoZWlnaHQiLCBHX1RZUEVfSU5ULCBpbWFnZS0+aGVpZ2h0LAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZnJhbWVyYXRlIiwgR1NUX1RZ
UEVfRlJBQ1RJT04sIHNldHRpbmdzLmZwcywgMSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgTlVMTCkpOwogCiAgICAgLy8gUHVzaCBzYW1wbGUKICAgICBHc3RTYW1w
bGVVUHRyIGFwcHNyY19zYW1wbGUoZ3N0X3NhbXBsZV9uZXcoYnVmLCBjYXBzLmdldCgpLCBudWxs
cHRyLCBudWxscHRyKSk7Ci0tIAoyLjIxLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9zcGljZS1kZXZlbA==
