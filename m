Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7413648A42
	for <lists+spice-devel@lfdr.de>; Mon, 17 Jun 2019 19:36:10 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5D1DE891C4;
	Mon, 17 Jun 2019 17:36:08 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail.codeweavers.com (mail.codeweavers.com [50.203.203.244])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 20C1588F1B
 for <spice-devel@lists.freedesktop.org>; Mon, 17 Jun 2019 17:36:07 +0000 (UTC)
Received: from 82-64-54-218.subs.proxad.net ([82.64.54.218] helo=amboise)
 by mail.codeweavers.com with esmtpsa (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.89) (envelope-from <fgouget@free.fr>) id 1hcvYe-0007Bs-HW
 for spice-devel@lists.freedesktop.org; Mon, 17 Jun 2019 12:36:41 -0500
Received: from fgouget by amboise with local (Exim 4.92)
 (envelope-from <fgouget@amboise.dolphin>) id 1hcvY4-00006b-Bz
 for spice-devel@lists.freedesktop.org; Mon, 17 Jun 2019 19:36:04 +0200
Date: Mon, 17 Jun 2019 19:36:04 +0200 (CEST)
From: Francois Gouget <fgouget@codeweavers.com>
To: Spice devel <spice-devel@lists.freedesktop.org>
In-Reply-To: <cover.1560790607.git.fgouget@free.fr>
Message-ID: <182e78142a7bcde90000bb3e82967db608676b12.1560790607.git.fgouget@free.fr>
References: <cover.1560790607.git.fgouget@free.fr>
User-Agent: Alpine 2.21 (DEB 202 2017-01-01)
MIME-Version: 1.0
X-Spam-Score: -103.7
X-Spam-Report: Spam detection software,
 running on the system "mail.codeweavers.com", 
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview: Each video and audio stream has its own lag: for video
 streams
 it is the decoding time and for audio ones buffering by the audio subsystem.
 The only way to keep them all in sync is to synchronize to t [...] 
 Content analysis details:   (-103.7 points, 5.0 required)
 pts rule name              description
 ---- ---------------------- --------------------------------------------------
 -100 USER_IN_WHITELIST      From: address is in the user's white-list
 -6.0 ALL_TRUSTED            Passed through trusted hosts only via SMTP
 0.0 TVD_RCVD_IP            Message was received from an IP address
 1.0 FREEMAIL_FROM          Sender email is commonly abused enduser mail
 provider (fgouget[at]free.fr)
 1.0 HEADER_FROM_DIFFERENT_DOMAINS From and EnvelopeFrom 2nd level
 mail domains are different
 0.2 FREEMAIL_FORGED_FROMDOMAIN 2nd level domains in From and
 EnvelopeFrom freemail headers are different
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; 
 d=codeweavers.com; s=6377696661; h=Content-Type:MIME-Version:References:
 Message-ID:In-Reply-To:Subject:To:From:Date:Sender:Reply-To:Cc:
 Content-Transfer-Encoding:Content-ID:Content-Description:Resent-Date:
 Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:
 List-Help:List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=OGmOTpE3wpJAqTZycI90Vfn5J38wvianKS8Os3E8AWI=; b=sUE+vDfDioqqJlRRbThtcwe8B
 a3uQjIbDqeLuT4RtGo7Ys1xT4Oj0LUCCqKaVMcdOYAoHGT2PQs/paYG55jrlnk+PPLjnj67ICYHgU
 qWwCgjZi4s/5hjTriOjPanXX0AV4zUJx4FVmUbquyOgStPuHOWktowgbR7yQ+aDDRi3fY=;
Subject: [Spice-devel] [client v2 11/12] spice-session: Keep track of the
 global streams lag
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RWFjaCB2aWRlbyBhbmQgYXVkaW8gc3RyZWFtIGhhcyBpdHMgb3duIGxhZzogZm9yIHZpZGVvIHN0
cmVhbXMgaXQgaXMKdGhlIGRlY29kaW5nIHRpbWUgYW5kIGZvciBhdWRpbyBvbmVzIGJ1ZmZlcmlu
ZyBieSB0aGUgYXVkaW8gc3Vic3lzdGVtLgpUaGUgb25seSB3YXkgdG8ga2VlcCB0aGVtIGFsbCBp
biBzeW5jIGlzIHRvIHN5bmNocm9uaXplIHRvIHRoZSBtb3N0CmxhZ2d5IHN0cmVhbS4KClNpZ25l
ZC1vZmYtYnk6IEZyYW5jb2lzIEdvdWdldCA8ZmdvdWdldEBjb2Rld2VhdmVycy5jb20+Ci0tLQoK
VGhlcmUgbWF5IGJlIGEgdGhyZWFkIGNvbmV0eHQgaXNzdWUgd2l0aCB0aGUgc3BpY2Vfc2Vzc2lv
bl91cGRhdGVfbGFnKCkgCmNhbGwgaW4gZGlzcGxheV9oYW5kbGVfc3RyZWFtX2RhdGEoKS4gSSBo
YXZlIG5vdCBub3RpY2VkIHRoaXMgY2F1c2luZyAKYW55IHByb2JsZW0gdGhvdWdoLgoKIHNyYy9j
aGFubmVsLWRpc3BsYXktZ3N0LmMgICB8ICA5ICsrKysrKysrCiBzcmMvY2hhbm5lbC1kaXNwbGF5
LW1qcGVnLmMgfCAgNiArKysrKysKIHNyYy9jaGFubmVsLWRpc3BsYXktcHJpdi5oICB8ICA0ICsr
KysKIHNyYy9jaGFubmVsLWRpc3BsYXkuYyAgICAgICB8IDMzICsrKysrKysrKysrKysrKysrKysr
KysrKysrKy0tCiBzcmMvY2hhbm5lbC1kaXNwbGF5LmggICAgICAgfCAgMiArKwogc3JjL2NoYW5u
ZWwtcGxheWJhY2stcHJpdi5oIHwgIDMgKystCiBzcmMvY2hhbm5lbC1wbGF5YmFjay5jICAgICAg
fCAyMiArKysrKysrKysrKysrKysrLS0tCiBzcmMvc3BpY2Utc2Vzc2lvbi1wcml2LmggICAgfCAg
NiArKysrKy0KIHNyYy9zcGljZS1zZXNzaW9uLmMgICAgICAgICB8IDQyICsrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrLS0KIDkgZmlsZXMgY2hhbmdlZCwgMTE4IGluc2VydGlvbnMo
KyksIDkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvc3JjL2NoYW5uZWwtZGlzcGxheS1nc3Qu
YyBiL3NyYy9jaGFubmVsLWRpc3BsYXktZ3N0LmMKaW5kZXggNDYwZDBhYjkuLmQ1YTVkNDMxIDEw
MDY0NAotLS0gYS9zcmMvY2hhbm5lbC1kaXNwbGF5LWdzdC5jCisrKyBiL3NyYy9jaGFubmVsLWRp
c3BsYXktZ3N0LmMKQEAgLTQ1NCw2ICs0NTQsMTUgQEAgc2lua19ldmVudF9wcm9iZShHc3RQYWQg
KnBhZCwgR3N0UGFkUHJvYmVJbmZvICppbmZvLCBncG9pbnRlciBkYXRhKQogICAgICAgICAgICAg
ICAgICAgIGZyYW1lLT50aW1lLCBmcmFtZS0+c2l6ZSwgZnJhbWUtPmNyZWF0aW9uX3RpbWUsIGR1
cmF0aW9uLAogICAgICAgICAgICAgICAgICAgIGRlY29kZXItPmRlY29kaW5nX3F1ZXVlLT5sZW5n
dGgsIGdzdGZyYW1lLT5xdWV1ZV9sZW4pOwogCisgICAgICAgICAgICAvKiBBbmQgdGhlIGF2ZXJh
Z2UgZGVjb2RpbmcgdGltZS4gT25seSB0YWtlIGludG8gYWNjb3VudCBmcmFtZXMKKyAgICAgICAg
ICAgICAqIHRoYXQgd2VyZSBub3QgZGVsYXllZCAoc2VlIGFib3ZlKSwgb3IgdGhhdCBwcm92ZSB0
aGUgY3VycmVudAorICAgICAgICAgICAgICogYXZlcmFnZSBpcyBjbGVhcmx5IG92ZXJlc3RpbWF0
ZWQuCisgICAgICAgICAgICAgKi8KKyAgICAgICAgICAgIGlmIChnc3RmcmFtZS0+cXVldWVfbGVu
IDwgTUFYX0RFQ09ERURfRlJBTUVTIHx8CisgICAgICAgICAgICAgICAgZHVyYXRpb24gLyAxMDAw
IDwgZGVjb2Rlci0+YmFzZS5kZWNvZGluZ190aW1lKSB7CisgICAgICAgICAgICAgICAgZGVjb2Rl
ci0+YmFzZS5kZWNvZGluZ190aW1lID0gKGRlY29kZXItPmJhc2UuZGVjb2RpbmdfdGltZSAqIDE1
ICsgZHVyYXRpb24gLyAxMDAwKSAvIDE2OworICAgICAgICAgICAgfQorCiAgICAgICAgICAgICBp
ZiAoIWRlY29kZXItPmFwcHNpbmspIHsKICAgICAgICAgICAgICAgICAvKiBUaGUgc2luayB3aWxs
IGRpc3BsYXkgdGhlIGZyYW1lIGRpcmVjdGx5IHNvIHRoaXMKICAgICAgICAgICAgICAgICAgKiBT
cGljZUdzdEZyYW1lIGFuZCB0aG9zZSBvZiBhbnkgZHJvcHBlZCBmcmFtZSBhcmUgbm8gbG9uZ2Vy
CmRpZmYgLS1naXQgYS9zcmMvY2hhbm5lbC1kaXNwbGF5LW1qcGVnLmMgYi9zcmMvY2hhbm5lbC1k
aXNwbGF5LW1qcGVnLmMKaW5kZXggYjA1ODQyNGUuLjIwZTEwZDliIDEwMDY0NAotLS0gYS9zcmMv
Y2hhbm5lbC1kaXNwbGF5LW1qcGVnLmMKKysrIGIvc3JjL2NoYW5uZWwtZGlzcGxheS1tanBlZy5j
CkBAIC04Niw2ICs4Niw3IEBAIHN0YXRpYyBnYm9vbGVhbiBtanBlZ19kZWNvZGVyX2RlY29kZV9m
cmFtZShncG9pbnRlciB2aWRlb19kZWNvZGVyKQogICAgIEpESU1FTlNJT04gd2lkdGgsIGhlaWdo
dDsKICAgICB1aW50OF90ICpkZXN0OwogICAgIHVpbnQ4X3QgKmxpbmVzWzRdOworICAgIGludDY0
X3Qgc3RhcnQgPSBnX2dldF9tb25vdG9uaWNfdGltZSgpOwogCiAgICAganBlZ19yZWFkX2hlYWRl
cigmZGVjb2Rlci0+bWpwZWdfY2luZm8sIDEpOwogICAgIHdpZHRoID0gZGVjb2Rlci0+bWpwZWdf
Y2luZm8uaW1hZ2Vfd2lkdGg7CkBAIC0xNTYsNiArMTU3LDExIEBAIHN0YXRpYyBnYm9vbGVhbiBt
anBlZ19kZWNvZGVyX2RlY29kZV9mcmFtZShncG9pbnRlciB2aWRlb19kZWNvZGVyKQogICAgIH0K
ICAgICBqcGVnX2ZpbmlzaF9kZWNvbXByZXNzKCZkZWNvZGVyLT5tanBlZ19jaW5mbyk7CiAKKyAg
ICB1aW50MzJfdCBkdXJhdGlvbiA9IChnX2dldF9tb25vdG9uaWNfdGltZSgpIC0gc3RhcnQpIC8g
MTAwMDsKKyAgICBkZWNvZGVyLT5iYXNlLmRlY29kaW5nX3RpbWUgPSBkZWNvZGVyLT5iYXNlLmRl
Y29kaW5nX3RpbWUgPworICAgICAgICAoZGVjb2Rlci0+YmFzZS5kZWNvZGluZ190aW1lICogMTUg
KyBkdXJhdGlvbikgLyAxNiA6CisgICAgICAgIGR1cmF0aW9uOworCiAgICAgLyogRGlzcGxheSB0
aGUgZnJhbWUgYW5kIGRpc3Bvc2Ugb2YgaXQgKi8KICAgICBzdHJlYW1fZGlzcGxheV9mcmFtZShk
ZWNvZGVyLT5iYXNlLnN0cmVhbSwgZGVjb2Rlci0+Y3VyX2ZyYW1lLAogICAgICAgICAgICAgICAg
ICAgICAgICAgIHdpZHRoLCBoZWlnaHQsIFNQSUNFX1VOS05PV05fU1RSSURFLCBkZWNvZGVyLT5v
dXRfZnJhbWUpOwpkaWZmIC0tZ2l0IGEvc3JjL2NoYW5uZWwtZGlzcGxheS1wcml2LmggYi9zcmMv
Y2hhbm5lbC1kaXNwbGF5LXByaXYuaAppbmRleCA3Yzk3ODc4MC4uMDNmMGM5OTIgMTAwNjQ0Ci0t
LSBhL3NyYy9jaGFubmVsLWRpc3BsYXktcHJpdi5oCisrKyBiL3NyYy9jaGFubmVsLWRpc3BsYXkt
cHJpdi5oCkBAIC03Miw2ICs3Miw5IEBAIHN0cnVjdCBWaWRlb0RlY29kZXIgewogCiAgICAgLyog
VGhlIGFzc29jaWF0ZWQgZGlzcGxheSBzdHJlYW0uICovCiAgICAgZGlzcGxheV9zdHJlYW0gKnN0
cmVhbTsKKworICAgIC8qIFRoZSBhdmVyYWdlIHRpbWUgaXQgdGFrZXMgdG8gZGVjb2RlIGEgZnJh
bWUuICovCisgICAgZmxvYXQgZGVjb2RpbmdfdGltZTsKIH07CiAKIApAQCAtMTE4LDYgKzEyMSw3
IEBAIHN0cnVjdCBkaXNwbGF5X3N0cmVhbSB7CiAgICAgaW50ICAgICAgICAgICAgICAgICAgICAg
ICAgIGhhdmVfcmVnaW9uOwogCiAgICAgVmlkZW9EZWNvZGVyICAgICAgICAgICAgICAgICp2aWRl
b19kZWNvZGVyOworICAgIGd1aW50ICAgICAgICAgICAgICAgICAgICAgICBkZWNvZGVyX2xhZzsK
IAogICAgIFNwaWNlQ2hhbm5lbCAgICAgICAgICAgICAgICAqY2hhbm5lbDsKIApkaWZmIC0tZ2l0
IGEvc3JjL2NoYW5uZWwtZGlzcGxheS5jIGIvc3JjL2NoYW5uZWwtZGlzcGxheS5jCmluZGV4IDAz
MTEwZGY2Li5iNjU2OWQwNCAxMDA2NDQKLS0tIGEvc3JjL2NoYW5uZWwtZGlzcGxheS5jCisrKyBi
L3NyYy9jaGFubmVsLWRpc3BsYXkuYwpAQCAtMTQxMSw2ICsxNDExLDI3IEBAIHZvaWQgc3RyZWFt
X2Rpc3BsYXlfZnJhbWUoZGlzcGxheV9zdHJlYW0gKnN0LCBTcGljZUZyYW1lICpmcmFtZSwKICAg
ICB9CiB9CiAKK0dfR05VQ19JTlRFUk5BTAorZ3VpbnQzMiBzcGljZV9kaXNwbGF5X2NoYW5uZWxf
Z2V0X2xhZyhTcGljZURpc3BsYXlDaGFubmVsICpjaGFubmVsKQoreworICAgIFNwaWNlRGlzcGxh
eUNoYW5uZWxQcml2YXRlICpjID0gU1BJQ0VfRElTUExBWV9DSEFOTkVMKGNoYW5uZWwpLT5wcml2
OworICAgIGludCBpOworICAgIGd1aW50IGxhZzsKKworICAgIGxhZyA9IDA7CisgICAgaWYgKGMt
PnN0cmVhbXMpIHsKKyAgICAgICAgZm9yIChpID0gMDsgaSA8IGMtPm5zdHJlYW1zOyBpKyspIHsK
KyAgICAgICAgICAgIGRpc3BsYXlfc3RyZWFtICpzdCA9IGMtPnN0cmVhbXNbaV07CisgICAgICAg
ICAgICBpZiAoc3QgIT0gTlVMTCAmJiBzdC0+dmlkZW9fZGVjb2RlcikgeworICAgICAgICAgICAg
ICAgIHN0LT5kZWNvZGVyX2xhZyA9IHN0LT52aWRlb19kZWNvZGVyLT5kZWNvZGluZ190aW1lOwor
ICAgICAgICAgICAgICAgIGxhZyA9IE1BWChsYWcsIHN0LT5kZWNvZGVyX2xhZyk7CisgICAgICAg
ICAgICB9CisgICAgICAgIH0KKyAgICB9CisKKyAgICByZXR1cm4gbGFnOworfQorCiBHX0dOVUNf
SU5URVJOQUwKIGdib29sZWFuIGhhbmRfcGlwZWxpbmVfdG9fd2lkZ2V0KGRpc3BsYXlfc3RyZWFt
ICpzdCwgR3N0UGlwZWxpbmUgKnBpcGVsaW5lKQogewpAQCAtMTQ2Nyw3ICsxNDg4LDcgQEAgc3Rh
dGljIHZvaWQgZGlzcGxheV91cGRhdGVfc3RyZWFtX3JlcG9ydChTcGljZURpc3BsYXlDaGFubmVs
ICpjaGFubmVsLCB1aW50MzJfdAogICAgICAgICByZXBvcnQubnVtX2Ryb3BzID0gc3QtPiByZXBv
cnRfbnVtX2Ryb3BzOwogICAgICAgICByZXBvcnQubGFzdF9mcmFtZV9kZWxheSA9IG1hcmdpbjsK
ICAgICAgICAgaWYgKHNwaWNlX3Nlc3Npb25faXNfcGxheWJhY2tfYWN0aXZlKHNlc3Npb24pKSB7
Ci0gICAgICAgICAgICByZXBvcnQuYXVkaW9fZGVsYXkgPSBzcGljZV9zZXNzaW9uX2dldF9wbGF5
YmFja19sYXRlbmN5KHNlc3Npb24pOworICAgICAgICAgICAgcmVwb3J0LmF1ZGlvX2RlbGF5ID0g
c3BpY2Vfc2Vzc2lvbl9nZXRfcGxheWJhY2tfbGFnKHNlc3Npb24pOwogICAgICAgICB9IGVsc2Ug
ewogICAgICAgICAgICAgcmVwb3J0LmF1ZGlvX2RlbGF5ID0gVUlOVF9NQVg7CiAgICAgICAgIH0K
QEAgLTE2ODQsNyArMTcwNSw3IEBAIHN0YXRpYyB2b2lkIGRpc3BsYXlfaGFuZGxlX3N0cmVhbV9k
YXRhKFNwaWNlQ2hhbm5lbCAqY2hhbm5lbCwgU3BpY2VNc2dJbiAqaW4pCiAgICAgLyogQ29tcHV0
ZSB0aGUgbG9jYWwgZnJhbWUgbW10aW1lICovCiAgICAgc3RyZWFtX3RpbWUgPSBzdHJlYW1fZ2V0
X3RpbWUoc3QpOwogICAgIGZyYW1lX3RpbWUgPSBzcGljZV9zZXNzaW9uX2dldF9jbGllbnRfdGlt
ZShzZXNzaW9uLCBvcC0+bXVsdGlfbWVkaWFfdGltZSk7Ci0gICAgZ3VpbnQzMiB0YXJnZXRfbGFn
ID0gc3BpY2Vfc2Vzc2lvbl9nZXRfcGxheWJhY2tfbGF0ZW5jeShzZXNzaW9uKTsKKyAgICBndWlu
dDMyIHRhcmdldF9sYWcgPSBzcGljZV9zZXNzaW9uX2dldF9sYWcoc2Vzc2lvbik7CiAgICAgaWYg
KHN0LT5sYXN0X2ZyYW1lX3RpbWUgPT0gMCkgewogICAgICAgICBtYXJnaW4gPSBzcGljZV9tbXRp
bWVfZGlmZihmcmFtZV90aW1lLCBzdHJlYW1fdGltZSk7CiAgICAgICAgIHN0LT5kZWxheSA9IE1B
WCh0YXJnZXRfbGFnIC0gbWFyZ2luLCBJTklUSUFMX0RFTEFZKTsKQEAgLTE3OTMsNiArMTgxNCwx
NCBAQCBzdGF0aWMgdm9pZCBkaXNwbGF5X2hhbmRsZV9zdHJlYW1fZGF0YShTcGljZUNoYW5uZWwg
KmNoYW5uZWwsIFNwaWNlTXNnSW4gKmluKQogICAgICAgICByZXR1cm47CiAgICAgfQogCisgICAg
aWYgKHN0LT52aWRlb19kZWNvZGVyLT5kZWNvZGluZ190aW1lICE9IDAgJiYKKyAgICAgICAgKHN0
LT5kZWNvZGVyX2xhZyA9PSAwIHx8CisgICAgICAgICBzcGljZV9zZXNzaW9uX2xhZ19uZWVkc191
cGRhdGUoc3QtPmRlY29kZXJfbGFnLCBzdC0+dmlkZW9fZGVjb2Rlci0+ZGVjb2RpbmdfdGltZSkp
KSB7CisgICAgICAgIFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbiA9IHNwaWNlX2NoYW5uZWxfZ2V0X3Nl
c3Npb24oU1BJQ0VfQ0hBTk5FTChjaGFubmVsKSk7CisgICAgICAgIC8qIEZJWE1FIFRoaXMgbWF5
IGJlIHRoZSB3cm9uZyBjb250ZXh0IGZvciB0aGlzIGNhbGwgKi8KKyAgICAgICAgc3BpY2Vfc2Vz
c2lvbl91cGRhdGVfbGFnKHNlc3Npb24sIHN0LT52aWRlb19kZWNvZGVyLT5kZWNvZGluZ190aW1l
KTsKKyAgICB9CisKICAgICBpZiAoYy0+ZW5hYmxlX2FkYXB0aXZlX3N0cmVhbWluZykgewogICAg
ICAgICBkaXNwbGF5X3VwZGF0ZV9zdHJlYW1fcmVwb3J0KFNQSUNFX0RJU1BMQVlfQ0hBTk5FTChj
aGFubmVsKSwgb3AtPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9w
LT5tdWx0aV9tZWRpYV90aW1lLCBtbXRpbWVfbWFyZ2luKTsKZGlmZiAtLWdpdCBhL3NyYy9jaGFu
bmVsLWRpc3BsYXkuaCBiL3NyYy9jaGFubmVsLWRpc3BsYXkuaAppbmRleCA1YjQ4ZDJmZi4uNTdl
NWUzZGQgMTAwNjQ0Ci0tLSBhL3NyYy9jaGFubmVsLWRpc3BsYXkuaAorKysgYi9zcmMvY2hhbm5l
bC1kaXNwbGF5LmgKQEAgLTE1Nyw2ICsxNTcsOCBAQCB2b2lkICAgICAgICAgICAgc3BpY2VfZ2xf
c2Nhbm91dF9mcmVlICAgICAgICAgKFNwaWNlR2xTY2Fub3V0ICpzY2Fub3V0KTsKIGNvbnN0IFNw
aWNlR2xTY2Fub3V0KiBzcGljZV9kaXNwbGF5X2NoYW5uZWxfZ2V0X2dsX3NjYW5vdXQoU3BpY2VE
aXNwbGF5Q2hhbm5lbCAqY2hhbm5lbCk7CiB2b2lkIHNwaWNlX2Rpc3BsYXlfY2hhbm5lbF9nbF9k
cmF3X2RvbmUoU3BpY2VEaXNwbGF5Q2hhbm5lbCAqY2hhbm5lbCk7CiAKK2d1aW50MzIgc3BpY2Vf
ZGlzcGxheV9jaGFubmVsX2dldF9sYWcoU3BpY2VEaXNwbGF5Q2hhbm5lbCAqY2hhbm5lbCk7CisK
ICNpZm5kZWYgU1BJQ0VfRElTQUJMRV9ERVBSRUNBVEVECiBHX0RFUFJFQ0FURURfRk9SKHNwaWNl
X2Rpc3BsYXlfY2hhbm5lbF9jaGFuZ2VfcHJlZmVycmVkX2NvbXByZXNzaW9uKQogdm9pZCBzcGlj
ZV9kaXNwbGF5X2NoYW5nZV9wcmVmZXJyZWRfY29tcHJlc3Npb24oU3BpY2VDaGFubmVsICpjaGFu
bmVsLCBnaW50IGNvbXByZXNzaW9uKTsKZGlmZiAtLWdpdCBhL3NyYy9jaGFubmVsLXBsYXliYWNr
LXByaXYuaCBiL3NyYy9jaGFubmVsLXBsYXliYWNrLXByaXYuaAppbmRleCBkYzg5ZTJkOC4uN2Yw
ZWMzM2MgMTAwNjQ0Ci0tLSBhL3NyYy9jaGFubmVsLXBsYXliYWNrLXByaXYuaAorKysgYi9zcmMv
Y2hhbm5lbC1wbGF5YmFjay1wcml2LmgKQEAgLTE5LDUgKzE5LDYgQEAKICNkZWZpbmUgX19TUElD
RV9DTElFTlRfUExBWUJBQ0tfQ0hBTk5FTF9QUklWX0hfXwogCiBnYm9vbGVhbiBzcGljZV9wbGF5
YmFja19jaGFubmVsX2lzX2FjdGl2ZShTcGljZVBsYXliYWNrQ2hhbm5lbCAqY2hhbm5lbCk7Ci1n
dWludDMyIHNwaWNlX3BsYXliYWNrX2NoYW5uZWxfZ2V0X2xhdGVuY3koU3BpY2VQbGF5YmFja0No
YW5uZWwgKmNoYW5uZWwpOworZ3VpbnQzMiBzcGljZV9wbGF5YmFja19jaGFubmVsX2dldF9sYWco
U3BpY2VQbGF5YmFja0NoYW5uZWwgKmNoYW5uZWwpOwordm9pZCBzcGljZV9wbGF5YmFja19jaGFu
bmVsX3VwZGF0ZV9sYWcoU3BpY2VQbGF5YmFja0NoYW5uZWwgKmNoYW5uZWwsIGd1aW50MzIgbGFn
KTsKICNlbmRpZgpkaWZmIC0tZ2l0IGEvc3JjL2NoYW5uZWwtcGxheWJhY2suYyBiL3NyYy9jaGFu
bmVsLXBsYXliYWNrLmMKaW5kZXggMDUyZTMwMzYuLjIxZDUxN2FmIDEwMDY0NAotLS0gYS9zcmMv
Y2hhbm5lbC1wbGF5YmFjay5jCisrKyBiL3NyYy9jaGFubmVsLXBsYXliYWNrLmMKQEAgLTQ1Nywy
NSArNDU3LDMwIEBAIHN0YXRpYyB2b2lkIGNoYW5uZWxfc2V0X2hhbmRsZXJzKFNwaWNlQ2hhbm5l
bENsYXNzICprbGFzcykKICAqIEBjaGFubmVsOiBhICNTcGljZVBsYXliYWNrQ2hhbm5lbAogICog
QGRlbGF5X21zOiB0aGUgZGVsYXkgaW4gbXMKICAqCi0gKiBBZGp1c3QgdGhlIG11bHRpbWVkaWEg
dGltZSBhY2NvcmRpbmcgdG8gdGhlIGRlbGF5LgorICogQWRqdXN0IHRoZSBtdWx0aW1lZGlhIHRp
bWUgYW5kIGdsb2JhbCBsYWcgYWNjb3JkaW5nIHRvIHRoZSBkZWxheS4KICAqKi8KIHZvaWQgc3Bp
Y2VfcGxheWJhY2tfY2hhbm5lbF9zZXRfZGVsYXkoU3BpY2VQbGF5YmFja0NoYW5uZWwgKmNoYW5u
ZWwsIGd1aW50MzIgZGVsYXlfbXMpCiB7CiAgICAgU3BpY2VQbGF5YmFja0NoYW5uZWxQcml2YXRl
ICpjOwogICAgIFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbjsKKyAgICBndWludDMyIG9sZF9sYXRlbmN5
OwogCiAgICAgZ19yZXR1cm5faWZfZmFpbChTUElDRV9JU19QTEFZQkFDS19DSEFOTkVMKGNoYW5u
ZWwpKTsKIAogICAgIENIQU5ORUxfREVCVUcoY2hhbm5lbCwgInBsYXliYWNrIHNldF9kZWxheSAl
dSBtcyIsIGRlbGF5X21zKTsKIAogICAgIGMgPSBjaGFubmVsLT5wcml2OworICAgIG9sZF9sYXRl
bmN5ID0gYy0+bGF0ZW5jeTsKICAgICBjLT5sYXRlbmN5ID0gZGVsYXlfbXM7CiAKICAgICBzZXNz
aW9uID0gc3BpY2VfY2hhbm5lbF9nZXRfc2Vzc2lvbihTUElDRV9DSEFOTkVMKGNoYW5uZWwpKTsK
ICAgICBpZiAoc2Vzc2lvbikgewogICAgICAgICBzcGljZV9zZXNzaW9uX3NldF9tbV90aW1lKHNl
c3Npb24sIGMtPmxhc3RfdGltZSAtIGRlbGF5X21zKTsKKyAgICAgICAgaWYgKHNwaWNlX3Nlc3Np
b25fbGFnX25lZWRzX3VwZGF0ZShvbGRfbGF0ZW5jeSwgZGVsYXlfbXMpKSB7CisgICAgICAgICAg
ICBzcGljZV9zZXNzaW9uX3VwZGF0ZV9sYWcoc2Vzc2lvbiwgZGVsYXlfbXMpOworICAgICAgICB9
CiAgICAgfSBlbHNlIHsKLSAgICAgICAgQ0hBTk5FTF9ERUJVRyhjaGFubmVsLCAiY2hhbm5lbCBk
ZXRhY2hlZCBmcm9tIHNlc3Npb24sIG1tIHRpbWUgc2tpcHBlZCIpOworICAgICAgICBDSEFOTkVM
X0RFQlVHKGNoYW5uZWwsICJjaGFubmVsIGRldGFjaGVkIGZyb20gc2Vzc2lvbiwgbW0gdGltZSAm
IGdsb2JhbCBsYWcgc2tpcHBlZCIpOwogICAgIH0KIH0KIApAQCAtNDg3LDcgKzQ5Miw3IEBAIGdi
b29sZWFuIHNwaWNlX3BsYXliYWNrX2NoYW5uZWxfaXNfYWN0aXZlKFNwaWNlUGxheWJhY2tDaGFu
bmVsICpjaGFubmVsKQogfQogCiBHX0dOVUNfSU5URVJOQUwKLWd1aW50MzIgc3BpY2VfcGxheWJh
Y2tfY2hhbm5lbF9nZXRfbGF0ZW5jeShTcGljZVBsYXliYWNrQ2hhbm5lbCAqY2hhbm5lbCkKK2d1
aW50MzIgc3BpY2VfcGxheWJhY2tfY2hhbm5lbF9nZXRfbGFnKFNwaWNlUGxheWJhY2tDaGFubmVs
ICpjaGFubmVsKQogewogICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKFNQSUNFX0lTX1BMQVlCQUNL
X0NIQU5ORUwoY2hhbm5lbCksIDApOwogICAgIGlmICghY2hhbm5lbC0+cHJpdi0+aXNfYWN0aXZl
KSB7CkBAIC00OTUsMyArNTAwLDE0IEBAIGd1aW50MzIgc3BpY2VfcGxheWJhY2tfY2hhbm5lbF9n
ZXRfbGF0ZW5jeShTcGljZVBsYXliYWNrQ2hhbm5lbCAqY2hhbm5lbCkKICAgICB9CiAgICAgcmV0
dXJuIGNoYW5uZWwtPnByaXYtPmxhdGVuY3k7CiB9CisKK0dfR05VQ19JTlRFUk5BTAordm9pZCBz
cGljZV9wbGF5YmFja19jaGFubmVsX3VwZGF0ZV9sYWcoU3BpY2VQbGF5YmFja0NoYW5uZWwgKmNo
YW5uZWwsIGd1aW50MzIgbGFnKQoreworICAgIGdfcmV0dXJuX2lmX2ZhaWwoU1BJQ0VfSVNfUExB
WUJBQ0tfQ0hBTk5FTChjaGFubmVsKSk7CisgICAgY2hhbm5lbC0+cHJpdi0+bWluX2xhdGVuY3kg
PSBsYWc7CisgICAgaWYgKGNoYW5uZWwtPnByaXYtPmlzX2FjdGl2ZSkgeworICAgICAgICBTUElD
RV9ERUJVRygiJXM6IG5vdGlmeSBsYWcgdXBkYXRlICV1IiwgX19GVU5DVElPTl9fLCBjaGFubmVs
LT5wcml2LT5taW5fbGF0ZW5jeSk7CisgICAgICAgIGdfY29yb3V0aW5lX29iamVjdF9ub3RpZnko
R19PQkpFQ1QoU1BJQ0VfQ0hBTk5FTChjaGFubmVsKSksICJtaW4tbGF0ZW5jeSIpOworICAgIH0K
K30KZGlmZiAtLWdpdCBhL3NyYy9zcGljZS1zZXNzaW9uLXByaXYuaCBiL3NyYy9zcGljZS1zZXNz
aW9uLXByaXYuaAppbmRleCAxZTkxZjYyNy4uMWIzZjY1OGMgMTAwNjQ0Ci0tLSBhL3NyYy9zcGlj
ZS1zZXNzaW9uLXByaXYuaAorKysgYi9zcmMvc3BpY2Utc2Vzc2lvbi1wcml2LmgKQEAgLTg1LDcg
Kzg1LDExIEBAIFNwaWNlQ2hhbm5lbCogc3BpY2Vfc2Vzc2lvbl9sb29rdXBfY2hhbm5lbChTcGlj
ZVNlc3Npb24gKnNlc3Npb24sIGdpbnQgaWQsIGdpbnQKIHZvaWQgc3BpY2Vfc2Vzc2lvbl9zZXRf
dXVpZChTcGljZVNlc3Npb24gKnNlc3Npb24sIGd1aW50OCB1dWlkWzE2XSk7CiB2b2lkIHNwaWNl
X3Nlc3Npb25fc2V0X25hbWUoU3BpY2VTZXNzaW9uICpzZXNzaW9uLCBjb25zdCBnY2hhciAqbmFt
ZSk7CiBnYm9vbGVhbiBzcGljZV9zZXNzaW9uX2lzX3BsYXliYWNrX2FjdGl2ZShTcGljZVNlc3Np
b24gKnNlc3Npb24pOwotZ3VpbnQzMiBzcGljZV9zZXNzaW9uX2dldF9wbGF5YmFja19sYXRlbmN5
KFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbik7CitndWludDMyIHNwaWNlX3Nlc3Npb25fZ2V0X3BsYXli
YWNrX2xhZyhTcGljZVNlc3Npb24gKnNlc3Npb24pOworI2RlZmluZSBzcGljZV9zZXNzaW9uX2xh
Z19uZWVkc191cGRhdGUob2xkX2xhZywgbmV3X2xhZykgXAorICAgIChvbGRfbGFnID09IDAgfHwg
KG5ld19sYWcpICsgMTAgPCAob2xkX2xhZykgfHwgKG5ld19sYWcpID4gKG9sZF9sYWcpICsgMTAp
CitndWludDMyIHNwaWNlX3Nlc3Npb25fZ2V0X2xhZyhTcGljZVNlc3Npb24gKnNlc3Npb24pOwor
dm9pZCBzcGljZV9zZXNzaW9uX3VwZGF0ZV9sYWcoU3BpY2VTZXNzaW9uICpzZXNzaW9uLCBndWlu
dDMyIGxhZyk7CiBnYm9vbGVhbiBzcGljZV9zZXNzaW9uX2dldF9hdWRpb19lbmFibGVkKFNwaWNl
U2Vzc2lvbiAqc2Vzc2lvbik7CiBnYm9vbGVhbiBzcGljZV9zZXNzaW9uX2dldF9zbWFydGNhcmRf
ZW5hYmxlZChTcGljZVNlc3Npb24gKnNlc3Npb24pOwogZ2Jvb2xlYW4gc3BpY2Vfc2Vzc2lvbl9n
ZXRfdXNicmVkaXJfZW5hYmxlZChTcGljZVNlc3Npb24gKnNlc3Npb24pOwpkaWZmIC0tZ2l0IGEv
c3JjL3NwaWNlLXNlc3Npb24uYyBiL3NyYy9zcGljZS1zZXNzaW9uLmMKaW5kZXggYTFhOTY4Mjku
LjU3YjEzYWU5IDEwMDY0NAotLS0gYS9zcmMvc3BpY2Utc2Vzc2lvbi5jCisrKyBiL3NyYy9zcGlj
ZS1zZXNzaW9uLmMKQEAgLTEwMyw2ICsxMDMsNyBAQCBzdHJ1Y3QgX1NwaWNlU2Vzc2lvblByaXZh
dGUgewogICAgIGdib29sZWFuICAgICAgICAgIGNsaWVudF9wcm92aWRlZF9zb2NrZXRzOwogICAg
IGd1aW50NjQgICAgICAgICAgIG1tX3RpbWVfb2Zmc2V0OwogICAgIGdpbnQ2NCAgICAgICAgICAg
IGNsaWVudF90aW1lX29mZnNldDsKKyAgICBndWludDMyICAgICAgICAgICBsYWc7CiAgICAgU3Bp
Y2VTZXNzaW9uICAgICAgKm1pZ3JhdGlvbjsKICAgICBHTGlzdCAgICAgICAgICAgICAqbWlncmF0
aW9uX2xlZnQ7CiAgICAgU3BpY2VTZXNzaW9uTWlncmF0aW9uIG1pZ3JhdGlvbl9zdGF0ZTsKQEAg
LTI2NzIsNyArMjY3Myw3IEBAIGdib29sZWFuIHNwaWNlX3Nlc3Npb25faXNfcGxheWJhY2tfYWN0
aXZlKFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbikKIH0KIAogR19HTlVDX0lOVEVSTkFMCi1ndWludDMy
IHNwaWNlX3Nlc3Npb25fZ2V0X3BsYXliYWNrX2xhdGVuY3koU3BpY2VTZXNzaW9uICpzZXNzaW9u
KQorZ3VpbnQzMiBzcGljZV9zZXNzaW9uX2dldF9wbGF5YmFja19sYWcoU3BpY2VTZXNzaW9uICpz
ZXNzaW9uKQogewogICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKFNQSUNFX0lTX1NFU1NJT04oc2Vz
c2lvbiksIDApOwogCkBAIC0yNjgwLDEzICsyNjgxLDUwIEBAIGd1aW50MzIgc3BpY2Vfc2Vzc2lv
bl9nZXRfcGxheWJhY2tfbGF0ZW5jeShTcGljZVNlc3Npb24gKnNlc3Npb24pCiAKICAgICBpZiAo
cy0+cGxheWJhY2tfY2hhbm5lbCAmJgogICAgICAgICBzcGljZV9wbGF5YmFja19jaGFubmVsX2lz
X2FjdGl2ZShzLT5wbGF5YmFja19jaGFubmVsKSkgewotICAgICAgICByZXR1cm4gc3BpY2VfcGxh
eWJhY2tfY2hhbm5lbF9nZXRfbGF0ZW5jeShzLT5wbGF5YmFja19jaGFubmVsKTsKKyAgICAgICAg
cmV0dXJuIHNwaWNlX3BsYXliYWNrX2NoYW5uZWxfZ2V0X2xhZyhzLT5wbGF5YmFja19jaGFubmVs
KTsKICAgICB9IGVsc2UgewogICAgICAgICBTUElDRV9ERUJVRygiJXM6IG5vdCBpbXBsZW1lbnRl
ZCB3aGVuIHRoZXJlIGlzbid0IGF1ZGlvIHBsYXliYWNrIiwgX19GVU5DVElPTl9fKTsKICAgICAg
ICAgcmV0dXJuIDA7CiAgICAgfQogfQogCitHX0dOVUNfSU5URVJOQUwKK2d1aW50MzIgc3BpY2Vf
c2Vzc2lvbl9nZXRfbGFnKFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbikKK3sKKyAgICBnX3JldHVybl92
YWxfaWZfZmFpbChTUElDRV9JU19TRVNTSU9OKHNlc3Npb24pLCAwKTsKKworICAgIHJldHVybiBz
ZXNzaW9uLT5wcml2LT5sYWc7Cit9CisKK0dfR05VQ19JTlRFUk5BTAordm9pZCBzcGljZV9zZXNz
aW9uX3VwZGF0ZV9sYWcoU3BpY2VTZXNzaW9uICpzZXNzaW9uLCBndWludDMyIGxhZykKK3sKKyAg
ICBnX3JldHVybl9pZl9mYWlsKFNQSUNFX0lTX1NFU1NJT04oc2Vzc2lvbikpOworICAgIFNwaWNl
U2Vzc2lvblByaXZhdGUgKnMgPSBzZXNzaW9uLT5wcml2OworCisgICAgaWYgKHNwaWNlX3Nlc3Np
b25fbGFnX25lZWRzX3VwZGF0ZShzLT5sYWcsIGxhZykpIHsKKyAgICAgICAgZ3VpbnQzMiBuZXdf
bGFnID0gMDsKKyAgICAgICAgZm9yIChHTGlzdCAqbCA9IHMtPmNoYW5uZWxzOyBsICE9IE5VTEw7
ICkgeworICAgICAgICAgICAgU3BpY2VDaGFubmVsICpjaGFubmVsID0gbC0+ZGF0YTsKKyAgICAg
ICAgICAgIGwgPSBsLT5uZXh0OworICAgICAgICAgICAgc3dpdGNoIChzcGljZV9jaGFubmVsX2dl
dF9jaGFubmVsX3R5cGUoY2hhbm5lbCkpIHsKKyAgICAgICAgICAgIGNhc2UgU1BJQ0VfQ0hBTk5F
TF9ESVNQTEFZOgorICAgICAgICAgICAgICAgIG5ld19sYWcgPSBNQVgobmV3X2xhZywgc3BpY2Vf
ZGlzcGxheV9jaGFubmVsX2dldF9sYWcoU1BJQ0VfRElTUExBWV9DSEFOTkVMKGNoYW5uZWwpKSk7
CisgICAgICAgICAgICAgICAgYnJlYWs7CisgICAgICAgICAgICBjYXNlIFNQSUNFX0NIQU5ORUxf
UExBWUJBQ0s6CisgICAgICAgICAgICAgICAgbmV3X2xhZyA9IE1BWChuZXdfbGFnLCBzcGljZV9w
bGF5YmFja19jaGFubmVsX2dldF9sYWcoU1BJQ0VfUExBWUJBQ0tfQ0hBTk5FTChjaGFubmVsKSkp
OworICAgICAgICAgICAgICAgIGJyZWFrOworICAgICAgICAgICAgfQorICAgICAgICB9CisgICAg
ICAgIGlmIChuZXdfbGFnICE9IHMtPmxhZykgeworICAgICAgICAgICAgcy0+bGFnID0gbmV3X2xh
ZzsKKyAgICAgICAgICAgIGlmIChzLT5wbGF5YmFja19jaGFubmVsKSB7CisgICAgICAgICAgICAg
ICAgc3BpY2VfcGxheWJhY2tfY2hhbm5lbF91cGRhdGVfbGFnKHMtPnBsYXliYWNrX2NoYW5uZWws
IHMtPmxhZyk7CisgICAgICAgICAgICB9CisgICAgICAgIH0KKyAgICB9Cit9CisKIHN0YXRpYyBj
b25zdCBnY2hhciogc3BpY2Vfc2Vzc2lvbl9nZXRfc2hhcmVkX2RpcihTcGljZVNlc3Npb24gKnNl
c3Npb24pCiB7CiAgICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwoU1BJQ0VfSVNfU0VTU0lPTihzZXNz
aW9uKSwgTlVMTCk7Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9zcGljZS1kZXZlbA==
