Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7894073168
	for <lists+spice-devel@lfdr.de>; Wed, 24 Jul 2019 16:17:37 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DBA846E5AE;
	Wed, 24 Jul 2019 14:17:34 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail.codeweavers.com (mail.codeweavers.com [50.203.203.244])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 553D46E5AA
 for <spice-devel@lists.freedesktop.org>; Wed, 24 Jul 2019 14:17:32 +0000 (UTC)
Received: from jwhite.mn.codeweavers.com ([10.69.137.101])
 by mail.codeweavers.com with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_GCM_SHA256:128)
 (Exim 4.89) (envelope-from <jwhite@codeweavers.com>)
 id 1hqI5X-0001ed-Vd
 for spice-devel@lists.freedesktop.org; Wed, 24 Jul 2019 09:17:52 -0500
From: Jeremy White <jwhite@codeweavers.com>
To: spice-devel@lists.freedesktop.org
Date: Wed, 24 Jul 2019 09:17:24 -0500
Message-Id: <20190724141726.32063-2-jwhite@codeweavers.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190724141726.32063-1-jwhite@codeweavers.com>
References: <20190724141726.32063-1-jwhite@codeweavers.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; 
 d=codeweavers.com; s=6377696661; h=Content-Transfer-Encoding:MIME-Version:
 References:In-Reply-To:Message-Id:Date:Subject:To:From:Sender:Reply-To:Cc:
 Content-Type:Content-ID:Content-Description:Resent-Date:Resent-From:
 Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:
 List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=Mkh1B0L3c2vFodEmQyicZA3vDbjGFEFMY0pmQT8Atzw=; b=ugFeoN486tN0LLDFelf5wJ2ehG
 G893la9da2lSQ+Ip9Yq7Amr5FVQSG6vBfltsHGHcaksje4wab8pqWgNVdDfcA2TaLL3oVZ2alqMme
 e2D8Y8ALsDyA61EP8Oy2kivKt0cNAM7lO8ks4B+UkWXnGYWAvdMqAfgNGPPxewZ867ms=;
Subject: [Spice-devel] [PATCH fixup1 x11spice 1/3] Simplify string options
 and make sure they are freed when replaced.
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

VGhpcyBpcyBsYXJnZWx5IHRoZSB3b3JrIG9mIEZyZWRpYW5vIFppZ2xpbyA8ZnppZ2xpb0ByZWRo
YXQuY29tPi4KClNpZ25lZC1vZmYtYnk6IEplcmVteSBXaGl0ZSA8andoaXRlQGNvZGV3ZWF2ZXJz
LmNvbT4KLS0tCiBzcmMvb3B0aW9ucy5jIHwgMTE4ICsrKysrKysrKysrKysrKysrKysrKysrLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgNTQgaW5zZXJ0aW9ucygr
KSwgNjQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvc3JjL29wdGlvbnMuYyBiL3NyYy9vcHRp
b25zLmMKaW5kZXggNmM2ZWNiNGUuLmNmZjRhYzE3IDEwMDY0NAotLS0gYS9zcmMvb3B0aW9ucy5j
CisrKyBiL3NyYy9vcHRpb25zLmMKQEAgLTQ1LDU0ICs0NSw0NiBAQAogI2luY2x1ZGUgPGxpYmF1
ZGl0Lmg+CiAjZW5kaWYKIAorc3RhdGljIHZvaWQgc3RyX3JlcGxhY2UoY2hhciAqKmRlc3QsIGNv
bnN0IGNoYXIgKnNyYykKK3sKKyAgICBnX2ZyZWUoKmRlc3QpOworICAgICpkZXN0ID0gc3JjID8g
Z19zdHJkdXAoc3JjKSA6IE5VTEw7Cit9CisKIHZvaWQgb3B0aW9uc19pbml0KG9wdGlvbnNfdCAq
b3B0aW9ucykKIHsKICAgICBtZW1zZXQob3B0aW9ucywgMCwgc2l6ZW9mKCpvcHRpb25zKSk7CiB9
CiAKLXZvaWQgc3NsX29wdGlvbnNfZnJlZShzc2xfb3B0aW9uc190ICpzc2wpCitzdGF0aWMgdm9p
ZCBzc2xfb3B0aW9uc19mcmVlKHNzbF9vcHRpb25zX3QgKnNzbCkKIHsKLSAgICBnX2ZyZWUoc3Ns
LT5jYV9jZXJ0X2ZpbGUpOwotICAgIGdfZnJlZShzc2wtPmNlcnRzX2ZpbGUpOwotICAgIGdfZnJl
ZShzc2wtPnByaXZhdGVfa2V5X2ZpbGUpOwotICAgIGdfZnJlZShzc2wtPmtleV9wYXNzd29yZCk7
Ci0gICAgZ19mcmVlKHNzbC0+ZGhfa2V5X2ZpbGUpOwotICAgIGdfZnJlZShzc2wtPmNpcGhlcnN1
aXRlKTsKLSAgICAqc3NsID0gKHNzbF9vcHRpb25zX3QpIHsgMCB9OworICAgIHN0cl9yZXBsYWNl
KCZzc2wtPmNhX2NlcnRfZmlsZSwgTlVMTCk7CisgICAgc3RyX3JlcGxhY2UoJnNzbC0+Y2VydHNf
ZmlsZSwgTlVMTCk7CisgICAgc3RyX3JlcGxhY2UoJnNzbC0+cHJpdmF0ZV9rZXlfZmlsZSwgTlVM
TCk7CisgICAgc3RyX3JlcGxhY2UoJnNzbC0+a2V5X3Bhc3N3b3JkLCBOVUxMKTsKKyAgICBzdHJf
cmVwbGFjZSgmc3NsLT5kaF9rZXlfZmlsZSwgTlVMTCk7CisgICAgc3RyX3JlcGxhY2UoJnNzbC0+
Y2lwaGVyc3VpdGUsIE5VTEwpOwogfQogCiB2b2lkIG9wdGlvbnNfZnJlZShvcHRpb25zX3QgKm9w
dGlvbnMpCiB7Ci0gICAgZ19mcmVlKG9wdGlvbnMtPmRpc3BsYXkpOwotICAgIG9wdGlvbnMtPmRp
c3BsYXkgPSBOVUxMOwotICAgIGdfZnJlZShvcHRpb25zLT5saXN0ZW4pOwotICAgIG9wdGlvbnMt
Pmxpc3RlbiA9IE5VTEw7CisgICAgc3RyX3JlcGxhY2UoJm9wdGlvbnMtPmRpc3BsYXksIE5VTEwp
OworICAgIHN0cl9yZXBsYWNlKCZvcHRpb25zLT5saXN0ZW4sIE5VTEwpOwogCiAgICAgc3NsX29w
dGlvbnNfZnJlZSgmb3B0aW9ucy0+c3NsKTsKLQotICAgIGdfZnJlZShvcHRpb25zLT5zcGljZV9w
YXNzd29yZCk7Ci0gICAgb3B0aW9ucy0+c3BpY2VfcGFzc3dvcmQgPSBOVUxMOwotICAgIGdfZnJl
ZShvcHRpb25zLT5wYXNzd29yZF9maWxlKTsKLSAgICBvcHRpb25zLT5wYXNzd29yZF9maWxlID0g
TlVMTDsKLQotICAgIGdfZnJlZShvcHRpb25zLT52aXJ0aW9fcGF0aCk7Ci0gICAgb3B0aW9ucy0+
dmlydGlvX3BhdGggPSBOVUxMOwotICAgIGdfZnJlZShvcHRpb25zLT51aW5wdXRfcGF0aCk7Ci0g
ICAgb3B0aW9ucy0+dWlucHV0X3BhdGggPSBOVUxMOwotICAgIGdfZnJlZShvcHRpb25zLT5vbl9j
b25uZWN0KTsKLSAgICBvcHRpb25zLT5vbl9jb25uZWN0ID0gTlVMTDsKLSAgICBnX2ZyZWUob3B0
aW9ucy0+b25fZGlzY29ubmVjdCk7Ci0gICAgb3B0aW9ucy0+b25fZGlzY29ubmVjdCA9IE5VTEw7
Ci0KLSAgICBnX2ZyZWUob3B0aW9ucy0+dXNlcl9jb25maWdfZmlsZSk7Ci0gICAgb3B0aW9ucy0+
dXNlcl9jb25maWdfZmlsZSA9IE5VTEw7Ci0KLSAgICBnX2ZyZWUob3B0aW9ucy0+c3lzdGVtX2Nv
bmZpZ19maWxlKTsKLSAgICBvcHRpb25zLT5zeXN0ZW1fY29uZmlnX2ZpbGUgPSBOVUxMOworICAg
IHN0cl9yZXBsYWNlKCZvcHRpb25zLT5zcGljZV9wYXNzd29yZCwgTlVMTCk7CisgICAgc3RyX3Jl
cGxhY2UoJm9wdGlvbnMtPnBhc3N3b3JkX2ZpbGUsIE5VTEwpOworCisgICAgc3RyX3JlcGxhY2Uo
Jm9wdGlvbnMtPnZpcnRpb19wYXRoLCBOVUxMKTsKKyAgICBzdHJfcmVwbGFjZSgmb3B0aW9ucy0+
dWlucHV0X3BhdGgsIE5VTEwpOworICAgIHN0cl9yZXBsYWNlKCZvcHRpb25zLT5vbl9jb25uZWN0
LCBOVUxMKTsKKyAgICBzdHJfcmVwbGFjZSgmb3B0aW9ucy0+b25fZGlzY29ubmVjdCwgTlVMTCk7
CisgICAgc3RyX3JlcGxhY2UoJm9wdGlvbnMtPnVzZXJfY29uZmlnX2ZpbGUsIE5VTEwpOworICAg
IHN0cl9yZXBsYWNlKCZvcHRpb25zLT5zeXN0ZW1fY29uZmlnX2ZpbGUsIE5VTEwpOwogfQogCiAK
LXN0YXRpYyBnY2hhciAqc3RyaW5nX29wdGlvbihHS2V5RmlsZSAqdSwgR0tleUZpbGUgKnMsIGNv
bnN0IGdjaGFyICpzZWN0aW9uLCBjb25zdCBnY2hhciAqa2V5KQorc3RhdGljIHZvaWQgc3RyaW5n
X29wdGlvbihnY2hhciAqKmRlc3QsIEdLZXlGaWxlICp1LCBHS2V5RmlsZSAqcywgY29uc3QgZ2No
YXIgKnNlY3Rpb24sIGNvbnN0IGdjaGFyICprZXkpCiB7CiAgICAgZ2NoYXIgKnJldCA9IE5VTEw7
CiAgICAgR0Vycm9yICplcnJvciA9IE5VTEw7CkBAIC0xMDQsNyArOTYsOCBAQCBzdGF0aWMgZ2No
YXIgKnN0cmluZ19vcHRpb24oR0tleUZpbGUgKnUsIEdLZXlGaWxlICpzLCBjb25zdCBnY2hhciAq
c2VjdGlvbiwgY29ucwogICAgIGlmIChlcnJvcikKICAgICAgICAgZ19lcnJvcl9mcmVlKGVycm9y
KTsKIAotICAgIHJldHVybiByZXQ7CisgICAgZ19mcmVlKCpkZXN0KTsKKyAgICAqZGVzdCA9IHJl
dDsKIH0KIAogc3RhdGljIGdpbnQgaW50X29wdGlvbihHS2V5RmlsZSAqdSwgR0tleUZpbGUgKnMs
IGNvbnN0IGdjaGFyICpzZWN0aW9uLCBjb25zdCBnY2hhciAqa2V5KQpAQCAtMTc1LDMxICsxNjgs
MjggQEAgaW50IG9wdGlvbnNfaGFuZGxlX3NzbChvcHRpb25zX3QgKm9wdGlvbnMsIGNvbnN0IGNo
YXIgKnNwZWMpCiAgICAgaW50IGkgPSAwOwogICAgIGludCByYyA9IDA7CiAKLSAgICBpZiAoIWlu
KQotICAgICAgICByZXR1cm4gWDExU1BJQ0VfRVJSX01BTExPQzsKLQogICAgIGZvciAocCA9IHN0
cnRva19yKGluLCAiLCIsICZzYXZlKTsgcDsgcCA9IHN0cnRva19yKE5VTEwsICIsIiwgJnNhdmUp
LCBpKyspIHsKICAgICAgICAgaWYgKHN0cmxlbihwKSA9PSAwKQogICAgICAgICAgICAgY29udGlu
dWU7CiAKICAgICAgICAgc3dpdGNoKGkpIHsKICAgICAgICAgICAgIGNhc2UgMDoKLSAgICAgICAg
ICAgICAgICBvcHRpb25zLT5zc2wuY2FfY2VydF9maWxlID0gZ19zdHJkdXAocCk7CisgICAgICAg
ICAgICAgICAgc3RyX3JlcGxhY2UoJm9wdGlvbnMtPnNzbC5jYV9jZXJ0X2ZpbGUsIHApOwogICAg
ICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgY2FzZSAxOgotICAgICAgICAgICAgICAg
IG9wdGlvbnMtPnNzbC5jZXJ0c19maWxlID0gZ19zdHJkdXAocCk7CisgICAgICAgICAgICAgICAg
c3RyX3JlcGxhY2UoJm9wdGlvbnMtPnNzbC5jZXJ0c19maWxlLCBwKTsKICAgICAgICAgICAgICAg
ICBicmVhazsKICAgICAgICAgICAgIGNhc2UgMjoKLSAgICAgICAgICAgICAgICBvcHRpb25zLT5z
c2wucHJpdmF0ZV9rZXlfZmlsZSA9IGdfc3RyZHVwKHApOworICAgICAgICAgICAgICAgIHN0cl9y
ZXBsYWNlKCZvcHRpb25zLT5zc2wucHJpdmF0ZV9rZXlfZmlsZSwgcCk7CiAgICAgICAgICAgICAg
ICAgYnJlYWs7CiAgICAgICAgICAgICBjYXNlIDM6Ci0gICAgICAgICAgICAgICAgb3B0aW9ucy0+
c3NsLmtleV9wYXNzd29yZCA9IGdfc3RyZHVwKHApOworICAgICAgICAgICAgICAgIHN0cl9yZXBs
YWNlKCZvcHRpb25zLT5zc2wua2V5X3Bhc3N3b3JkLCBwKTsKICAgICAgICAgICAgICAgICBicmVh
azsKICAgICAgICAgICAgIGNhc2UgNDoKLSAgICAgICAgICAgICAgICBvcHRpb25zLT5zc2wuZGhf
a2V5X2ZpbGUgPSBnX3N0cmR1cChwKTsKKyAgICAgICAgICAgICAgICBzdHJfcmVwbGFjZSgmb3B0
aW9ucy0+c3NsLmRoX2tleV9maWxlLCBwKTsKICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg
ICAgICAgIGNhc2UgNToKLSAgICAgICAgICAgICAgICBvcHRpb25zLT5zc2wuY2lwaGVyc3VpdGUg
PSBnX3N0cmR1cChwKTsKKyAgICAgICAgICAgICAgICBzdHJfcmVwbGFjZSgmb3B0aW9ucy0+c3Ns
LmNpcGhlcnN1aXRlLCBwKTsKICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgIGRl
ZmF1bHQ6CiAgICAgICAgICAgICAgICAgZnByaW50ZihzdGRlcnIsICJFcnJvcjogaW52YWxpZCBz
c2wgc3BlY2lmaWNhdGlvbi4iKTsKQEAgLTIxNiwxMiArMjA2LDEyIEBAIHZvaWQgb3B0aW9uc19o
YW5kbGVfc3NsX2ZpbGVfb3B0aW9ucyhvcHRpb25zX3QgKm9wdGlvbnMsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgR0tleUZpbGUgKnVzZXJrZXksIEdLZXlGaWxlICpzeXN0
ZW1rZXkpCiB7CiAgICAgb3B0aW9ucy0+c3NsLmVuYWJsZWQgPSBib29sX29wdGlvbih1c2Vya2V5
LCBzeXN0ZW1rZXksICJzc2wiLCAiZW5hYmxlZCIpOwotICAgIG9wdGlvbnMtPnNzbC5jYV9jZXJ0
X2ZpbGUgPSBzdHJpbmdfb3B0aW9uKHVzZXJrZXksIHN5c3RlbWtleSwgInNzbCIsICJjYS1jZXJ0
LWZpbGUiKTsKLSAgICBvcHRpb25zLT5zc2wuY2VydHNfZmlsZSA9IHN0cmluZ19vcHRpb24odXNl
cmtleSwgc3lzdGVta2V5LCAic3NsIiwgImNlcnRzLWZpbGUiKTsKLSAgICBvcHRpb25zLT5zc2wu
cHJpdmF0ZV9rZXlfZmlsZSA9IHN0cmluZ19vcHRpb24odXNlcmtleSwgc3lzdGVta2V5LCAic3Ns
IiwgInByaXZhdGUta2V5LWZpbGUiKTsKLSAgICBvcHRpb25zLT5zc2wua2V5X3Bhc3N3b3JkID0g
c3RyaW5nX29wdGlvbih1c2Vya2V5LCBzeXN0ZW1rZXksICJzc2wiLCAia2V5LXBhc3N3b3JkLWZp
bGUiKTsKLSAgICBvcHRpb25zLT5zc2wuZGhfa2V5X2ZpbGUgPSBzdHJpbmdfb3B0aW9uKHVzZXJr
ZXksIHN5c3RlbWtleSwgInNzbCIsICJkaC1rZXktZmlsZSIpOwotICAgIG9wdGlvbnMtPnNzbC5j
aXBoZXJzdWl0ZSA9IHN0cmluZ19vcHRpb24odXNlcmtleSwgc3lzdGVta2V5LCAic3NsIiwgImNp
cGhlcnN1aXRlIik7CisgICAgc3RyaW5nX29wdGlvbigmb3B0aW9ucy0+c3NsLmNhX2NlcnRfZmls
ZSwgdXNlcmtleSwgc3lzdGVta2V5LCAic3NsIiwgImNhLWNlcnQtZmlsZSIpOworICAgIHN0cmlu
Z19vcHRpb24oJm9wdGlvbnMtPnNzbC5jZXJ0c19maWxlLCB1c2Vya2V5LCBzeXN0ZW1rZXksICJz
c2wiLCAiY2VydHMtZmlsZSIpOworICAgIHN0cmluZ19vcHRpb24oJm9wdGlvbnMtPnNzbC5wcml2
YXRlX2tleV9maWxlLCB1c2Vya2V5LCBzeXN0ZW1rZXksICJzc2wiLCAicHJpdmF0ZS1rZXktZmls
ZSIpOworICAgIHN0cmluZ19vcHRpb24oJm9wdGlvbnMtPnNzbC5rZXlfcGFzc3dvcmQsIHVzZXJr
ZXksIHN5c3RlbWtleSwgInNzbCIsICJrZXktcGFzc3dvcmQtZmlsZSIpOworICAgIHN0cmluZ19v
cHRpb24oJm9wdGlvbnMtPnNzbC5kaF9rZXlfZmlsZSwgdXNlcmtleSwgc3lzdGVta2V5LCAic3Ns
IiwgImRoLWtleS1maWxlIik7CisgICAgc3RyaW5nX29wdGlvbigmb3B0aW9ucy0+c3NsLmNpcGhl
cnN1aXRlLCB1c2Vya2V5LCBzeXN0ZW1rZXksICJzc2wiLCAiY2lwaGVyc3VpdGUiKTsKIH0KIAog
dm9pZCBvcHRpb25zX2hhbmRsZV91c2VyX2NvbmZpZyhpbnQgYXJnYywgY2hhciAqYXJndltdLCBv
cHRpb25zX3QgKm9wdGlvbnMpCkBAIC0yODksMTUgKzI3OSwxNSBAQCBpbnQgb3B0aW9uc19wYXJz
ZV9hcmd1bWVudHMoaW50IGFyZ2MsIGNoYXIgKmFyZ3ZbXSwgb3B0aW9uc190ICpvcHRpb25zKQog
ICAgICAgICAgICAgICAgIGJyZWFrOwogCiAgICAgICAgICAgICBjYXNlIE9QVElPTl9QQVNTV09S
RDoKLSAgICAgICAgICAgICAgICBvcHRpb25zLT5zcGljZV9wYXNzd29yZCA9IGdfc3RyZHVwKG9w
dGFyZyk7CisgICAgICAgICAgICAgICAgc3RyX3JlcGxhY2UoJm9wdGlvbnMtPnNwaWNlX3Bhc3N3
b3JkLCBvcHRhcmcpOwogICAgICAgICAgICAgICAgIGJyZWFrOwogCiAgICAgICAgICAgICBjYXNl
IE9QVElPTl9QQVNTV09SRF9GSUxFOgotICAgICAgICAgICAgICAgIG9wdGlvbnMtPnBhc3N3b3Jk
X2ZpbGUgPSBnX3N0cmR1cChvcHRhcmcpOworICAgICAgICAgICAgICAgIHN0cl9yZXBsYWNlKCZv
cHRpb25zLT5wYXNzd29yZF9maWxlLCBvcHRhcmcpOwogICAgICAgICAgICAgICAgIGJyZWFrOwog
CiAgICAgICAgICAgICBjYXNlIE9QVElPTl9DT05GSUc6Ci0gICAgICAgICAgICAgICAgLyogVGhp
cyB3YXMgaGFuZGxlZCBwcmV2aW91c2x5OyB3ZSBjYW4gaWdub3JlICovCisgICAgICAgICAgICAg
ICAgc3RyX3JlcGxhY2UoJm9wdGlvbnMtPnVzZXJfY29uZmlnX2ZpbGUsIG9wdGFyZyk7CiAgICAg
ICAgICAgICAgICAgYnJlYWs7CiAKICAgICAgICAgICAgIGNhc2UgT1BUSU9OX1NTTDoKQEAgLTMx
Niw3ICszMDYsNyBAQCBpbnQgb3B0aW9uc19wYXJzZV9hcmd1bWVudHMoaW50IGFyZ2MsIGNoYXIg
KmFyZ3ZbXSwgb3B0aW9uc190ICpvcHRpb25zKQogICAgICAgICAgICAgICAgIGJyZWFrOwogCiAg
ICAgICAgICAgICBjYXNlIE9QVElPTl9ESVNQTEFZOgotICAgICAgICAgICAgICAgIG9wdGlvbnMt
PmRpc3BsYXkgPSBnX3N0cmR1cChvcHRhcmcpOworICAgICAgICAgICAgICAgIHN0cl9yZXBsYWNl
KCZvcHRpb25zLT5kaXNwbGF5LCBvcHRhcmcpOwogICAgICAgICAgICAgICAgIGJyZWFrOwogCiAg
ICAgICAgICAgICBjYXNlIE9QVElPTl9NSU5JTUlaRToKQEAgLTM0NiwxMiArMzM2LDEyIEBAIGlu
dCBvcHRpb25zX3BhcnNlX2FyZ3VtZW50cyhpbnQgYXJnYywgY2hhciAqYXJndltdLCBvcHRpb25z
X3QgKm9wdGlvbnMpCiAgICAgaWYgKHJjID09IDApIHsKICAgICAgICAgaWYgKG9wdGluZCA+PSBh
cmdjKSB7CiAgICAgICAgICAgICAvKiBEZWZhdWx0ICovCi0gICAgICAgICAgICBvcHRpb25zLT5s
aXN0ZW4gPSBnX3N0cmR1cCgiNTkwMCIpOworICAgICAgICAgICAgc3RyX3JlcGxhY2UoJm9wdGlv
bnMtPmxpc3RlbiwgIjU5MDAiKTsKICAgICAgICAgfSBlbHNlIGlmIChvcHRpbmQgPCAoYXJnYyAt
IDEpKSB7CiAgICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIkVycm9yOiB0b28gbWFueSBhcmd1
bWVudHNcbiIpOwogICAgICAgICAgICAgcmMgPSBYMTFTUElDRV9FUlJfQkFEQVJHUzsKICAgICAg
ICAgfSBlbHNlIHsKLSAgICAgICAgICAgIG9wdGlvbnMtPmxpc3RlbiA9IGdfc3RyZHVwKGFyZ3Zb
b3B0aW5kXSk7CisgICAgICAgICAgICBzdHJfcmVwbGFjZSgmb3B0aW9ucy0+bGlzdGVuLCBhcmd2
W29wdGluZF0pOwogICAgICAgICB9CiAgICAgfQogCkBAIC0zODYsMTcgKzM3NiwxNyBAQCB2b2lk
IG9wdGlvbnNfZnJvbV9jb25maWcob3B0aW9uc190ICpvcHRpb25zKQogICAgIG9wdGlvbnMtPmFs
bG93X2NvbnRyb2wgPSBib29sX29wdGlvbih1c2Vya2V5LCBzeXN0ZW1rZXksICJzcGljZSIsICJh
bGxvdy1jb250cm9sIik7CiAgICAgb3B0aW9ucy0+Z2VuZXJhdGVfcGFzc3dvcmQgPSBpbnRfb3B0
aW9uKHVzZXJrZXksIHN5c3RlbWtleSwgInNwaWNlIiwgImdlbmVyYXRlLXBhc3N3b3JkIik7CiAg
ICAgb3B0aW9ucy0+aGlkZSA9IGJvb2xfb3B0aW9uKHVzZXJrZXksIHN5c3RlbWtleSwgInNwaWNl
IiwgImhpZGUiKTsKLSAgICBvcHRpb25zLT5kaXNwbGF5ID0gc3RyaW5nX29wdGlvbih1c2Vya2V5
LCBzeXN0ZW1rZXksICJzcGljZSIsICJkaXNwbGF5Iik7CisgICAgc3RyaW5nX29wdGlvbigmb3B0
aW9ucy0+ZGlzcGxheSwgdXNlcmtleSwgc3lzdGVta2V5LCAic3BpY2UiLCAiZGlzcGxheSIpOwog
Ci0gICAgb3B0aW9ucy0+bGlzdGVuID0gc3RyaW5nX29wdGlvbih1c2Vya2V5LCBzeXN0ZW1rZXks
ICJzcGljZSIsICJsaXN0ZW4iKTsKLSAgICBvcHRpb25zLT5zcGljZV9wYXNzd29yZCA9IHN0cmlu
Z19vcHRpb24odXNlcmtleSwgc3lzdGVta2V5LCAic3BpY2UiLCAicGFzc3dvcmQiKTsKLSAgICBv
cHRpb25zLT5wYXNzd29yZF9maWxlID0gc3RyaW5nX29wdGlvbih1c2Vya2V5LCBzeXN0ZW1rZXks
ICJzcGljZSIsICJwYXNzd29yZC1maWxlIik7CisgICAgc3RyaW5nX29wdGlvbigmb3B0aW9ucy0+
bGlzdGVuLCB1c2Vya2V5LCBzeXN0ZW1rZXksICJzcGljZSIsICJsaXN0ZW4iKTsKKyAgICBzdHJp
bmdfb3B0aW9uKCZvcHRpb25zLT5zcGljZV9wYXNzd29yZCwgdXNlcmtleSwgc3lzdGVta2V5LCAi
c3BpY2UiLCAicGFzc3dvcmQiKTsKKyAgICBzdHJpbmdfb3B0aW9uKCZvcHRpb25zLT5wYXNzd29y
ZF9maWxlLCB1c2Vya2V5LCBzeXN0ZW1rZXksICJzcGljZSIsICJwYXNzd29yZC1maWxlIik7CiAg
ICAgb3B0aW9ucy0+ZGlzYWJsZV90aWNrZXRpbmcgPSBib29sX29wdGlvbih1c2Vya2V5LCBzeXN0
ZW1rZXksICJzcGljZSIsICJkaXNhYmxlLXRpY2tldGluZyIpOwogICAgIG9wdGlvbnMtPmV4aXRf
b25fZGlzY29ubmVjdCA9IGJvb2xfb3B0aW9uKHVzZXJrZXksIHN5c3RlbWtleSwgInNwaWNlIiwg
ImV4aXQtb24tZGlzY29ubmVjdCIpOwotICAgIG9wdGlvbnMtPnZpcnRpb19wYXRoID0gc3RyaW5n
X29wdGlvbih1c2Vya2V5LCBzeXN0ZW1rZXksICJzcGljZSIsICJ2aXJ0aW8tcGF0aCIpOwotICAg
IG9wdGlvbnMtPnVpbnB1dF9wYXRoID0gc3RyaW5nX29wdGlvbih1c2Vya2V5LCBzeXN0ZW1rZXks
ICJzcGljZSIsICJ1aW5wdXQtcGF0aCIpOwotICAgIG9wdGlvbnMtPm9uX2Nvbm5lY3QgPSBzdHJp
bmdfb3B0aW9uKHVzZXJrZXksIHN5c3RlbWtleSwgInNwaWNlIiwgIm9uLWNvbm5lY3QiKTsKLSAg
ICBvcHRpb25zLT5vbl9kaXNjb25uZWN0ID0gc3RyaW5nX29wdGlvbih1c2Vya2V5LCBzeXN0ZW1r
ZXksICJzcGljZSIsICJvbi1kaXNjb25uZWN0Iik7CisgICAgc3RyaW5nX29wdGlvbigmb3B0aW9u
cy0+dmlydGlvX3BhdGgsIHVzZXJrZXksIHN5c3RlbWtleSwgInNwaWNlIiwgInZpcnRpby1wYXRo
Iik7CisgICAgc3RyaW5nX29wdGlvbigmb3B0aW9ucy0+dWlucHV0X3BhdGgsIHVzZXJrZXksIHN5
c3RlbWtleSwgInNwaWNlIiwgInVpbnB1dC1wYXRoIik7CisgICAgc3RyaW5nX29wdGlvbigmb3B0
aW9ucy0+b25fY29ubmVjdCwgdXNlcmtleSwgc3lzdGVta2V5LCAic3BpY2UiLCAib24tY29ubmVj
dCIpOworICAgIHN0cmluZ19vcHRpb24oJm9wdGlvbnMtPm9uX2Rpc2Nvbm5lY3QsIHVzZXJrZXks
IHN5c3RlbWtleSwgInNwaWNlIiwgIm9uLWRpc2Nvbm5lY3QiKTsKICAgICBvcHRpb25zLT5hdWRp
dCA9IGJvb2xfb3B0aW9uKHVzZXJrZXksIHN5c3RlbWtleSwgInNwaWNlIiwgImF1ZGl0Iik7CiAg
ICAgb3B0aW9ucy0+YXVkaXRfbWVzc2FnZV90eXBlID0gaW50X29wdGlvbih1c2Vya2V5LCBzeXN0
ZW1rZXksICJzcGljZSIsICJhdWRpdC1tZXNzYWdlLXR5cGUiKTsKIApAQCAtNDQ1LDcgKzQzNSw3
IEBAIHN0YXRpYyBpbnQgcHJvY2Vzc19wYXNzd29yZF9maWxlKG9wdGlvbnNfdCAqb3B0aW9ucykK
ICAgICBpZiAocCA+IGJ1ZiAmJiAqKHAgLSAxKSA9PSAnXG4nKQogICAgICAgICAqKHAgLSAxKSA9
ICdcMCc7CiAKLSAgICBvcHRpb25zLT5zcGljZV9wYXNzd29yZCA9IGdfc3RyZHVwKGJ1Zik7Cisg
ICAgc3RyX3JlcGxhY2UoJm9wdGlvbnMtPnNwaWNlX3Bhc3N3b3JkLCBidWYpOwogCiAgICAgcmV0
dXJuIHJjOwogfQotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpTcGljZS1kZXZlbCBtYWlsaW5nIGxpc3QKU3BpY2UtZGV2ZWxAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vc3BpY2UtZGV2ZWw=
