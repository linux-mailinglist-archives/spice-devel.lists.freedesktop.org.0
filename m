Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id AC3CDB40E4
	for <lists+spice-devel@lfdr.de>; Mon, 16 Sep 2019 21:13:51 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 815066EA3D;
	Mon, 16 Sep 2019 19:13:48 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail.codeweavers.com (mail.codeweavers.com [50.203.203.244])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C91036EA3F
 for <spice-devel@lists.freedesktop.org>; Mon, 16 Sep 2019 19:13:46 +0000 (UTC)
Received: from jwhite.mn.codeweavers.com ([10.69.137.101])
 by mail.codeweavers.com with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_GCM_SHA256:128)
 (Exim 4.89) (envelope-from <jwhite@codeweavers.com>)
 id 1i9wRW-0003Nb-2g
 for spice-devel@lists.freedesktop.org; Mon, 16 Sep 2019 14:13:46 -0500
From: Jeremy White <jwhite@codeweavers.com>
To: spice-devel@lists.freedesktop.org
Date: Mon, 16 Sep 2019 14:13:28 -0500
Message-Id: <20190916191333.27139-6-jwhite@codeweavers.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190916191333.27139-1-jwhite@codeweavers.com>
References: <20190916191333.27139-1-jwhite@codeweavers.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; 
 d=codeweavers.com; s=6377696661; h=Content-Transfer-Encoding:MIME-Version:
 References:In-Reply-To:Message-Id:Date:Subject:To:From:Sender:Reply-To:Cc:
 Content-Type:Content-ID:Content-Description:Resent-Date:Resent-From:
 Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:
 List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=4Xyuqy4s5P587zVzQvbMcj5FBg4ghjiFjasocJXrDbM=; b=kXorQjO6enc7xj0VyX6jeLK1Jw
 Dua3TxcbmSuwQrIb9gRYkAHs2lEiMgNwPBnRoLK1MeJEQNt9u69k65BmjslCRT3JovUV10C+osTzp
 V+WU8Qrgr3r7DzzKO9Fj0X19+TJOvNJ0Re+iOEg2khfpCK9c5b/hO2D6U3L07Wlr7SsU=;
Subject: [Spice-devel] [PATCH x11spice 05/10] Provide support for outputs
 and crtcs.
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

VGhpcyBhbGxvdyB1cyB0byBzaXplIGFuZCBkeW5hbWljYWxseSByZXNpemUgdGhlIGR1bW15IGRy
aXZlci4KClNpZ25lZC1vZmYtYnk6IEplcmVteSBXaGl0ZSA8andoaXRlQGNvZGV3ZWF2ZXJzLmNv
bT4KLS0tCiBzcGljZS12aWRlby1kdW1teS9zcmMvTWFrZWZpbGUuYW0gICAgICAgICB8ICAgMiAr
LQogc3BpY2UtdmlkZW8tZHVtbXkvc3JjL2Rpc3BsYXkuYyAgICAgICAgICAgfCA0MTUgKysrKysr
KysrKysrKysrKysrKysrKwogc3BpY2UtdmlkZW8tZHVtbXkvc3JjL2RyaTIuYyAgICAgICAgICAg
ICAgfCAgIDUgKy0KIHNwaWNlLXZpZGVvLWR1bW15L3NyYy9kdW1teS5oICAgICAgICAgICAgIHwg
IDMzICsrCiBzcGljZS12aWRlby1kdW1teS9zcmMvZHVtbXlfY3Vyc29yLmMgICAgICB8IDEwMSAt
LS0tLS0KIHNwaWNlLXZpZGVvLWR1bW15L3NyYy9wcmVzZW50LmMgICAgICAgICAgIHwgMTI1ICsr
KysrKy0KIHNwaWNlLXZpZGVvLWR1bW15L3NyYy9zcGljZWR1bW15X2RyaXZlci5jIHwgIDUzICst
LQogNyBmaWxlcyBjaGFuZ2VkLCA1ODkgaW5zZXJ0aW9ucygrKSwgMTQ1IGRlbGV0aW9ucygtKQog
Y3JlYXRlIG1vZGUgMTAwNjQ0IHNwaWNlLXZpZGVvLWR1bW15L3NyYy9kaXNwbGF5LmMKIGRlbGV0
ZSBtb2RlIDEwMDY0NCBzcGljZS12aWRlby1kdW1teS9zcmMvZHVtbXlfY3Vyc29yLmMKCmRpZmYg
LS1naXQgYS9zcGljZS12aWRlby1kdW1teS9zcmMvTWFrZWZpbGUuYW0gYi9zcGljZS12aWRlby1k
dW1teS9zcmMvTWFrZWZpbGUuYW0KaW5kZXggMWRjNGRmOGUuLjhjNmUxMzJiIDEwMDY0NAotLS0g
YS9zcGljZS12aWRlby1kdW1teS9zcmMvTWFrZWZpbGUuYW0KKysrIGIvc3BpY2UtdmlkZW8tZHVt
bXkvc3JjL01ha2VmaWxlLmFtCkBAIC0zNSw3ICszNSw3IEBAIHNwaWNlZHVtbXlfZHJ2X2xhZGly
ID0gQG1vZHVsZWRpckAvZHJpdmVycwogc3BpY2VkdW1teV9kcnZfbGFfU09VUkNFUyA9IFwKICAg
ICAgICAgIGNvbXBhdC1hcGkuaCBcCiAgICAgICAgICBkcmkyLmMgXAotICAgICAgICAgZHVtbXlf
Y3Vyc29yLmMgXAogICAgICAgICAgc3BpY2VkdW1teV9kcml2ZXIuYyBcCisgICAgICAgICBkaXNw
bGF5LmMgXAogICAgICAgICAgZHVtbXkuaCBcCiAgICAgICAgICBwcmVzZW50LmMKZGlmZiAtLWdp
dCBhL3NwaWNlLXZpZGVvLWR1bW15L3NyYy9kaXNwbGF5LmMgYi9zcGljZS12aWRlby1kdW1teS9z
cmMvZGlzcGxheS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwLi5iODM4Njli
YgotLS0gL2Rldi9udWxsCisrKyBiL3NwaWNlLXZpZGVvLWR1bW15L3NyYy9kaXNwbGF5LmMKQEAg
LTAsMCArMSw0MTUgQEAKKy8qCisgKiBDb3B5cmlnaHQgMjAxOSBKZXJlbXkgV2hpdGUKKyAqCisg
KiBQZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBkaXN0cmlidXRlLCBhbmQgc2VsbCB0
aGlzIHNvZnR3YXJlIGFuZCBpdHMKKyAqIGRvY3VtZW50YXRpb24gZm9yIGFueSBwdXJwb3NlIGlz
IGhlcmVieSBncmFudGVkIHdpdGhvdXQgZmVlLCBwcm92aWRlZCB0aGF0CisgKiB0aGUgYWJvdmUg
Y29weXJpZ2h0IG5vdGljZSBhcHBlYXIgaW4gYWxsIGNvcGllcyBhbmQgdGhhdCBib3RoIHRoYXQg
Y29weXJpZ2h0CisgKiBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2UgYXBwZWFyIGlu
IHN1cHBvcnRpbmcgZG9jdW1lbnRhdGlvbiwgYW5kCisgKiB0aGF0IHRoZSBuYW1lIG9mIHRoZSBj
b3B5cmlnaHQgaG9sZGVycyBub3QgYmUgdXNlZCBpbiBhZHZlcnRpc2luZyBvcgorICogcHVibGlj
aXR5IHBlcnRhaW5pbmcgdG8gZGlzdHJpYnV0aW9uIG9mIHRoZSBzb2Z0d2FyZSB3aXRob3V0IHNw
ZWNpZmljLAorICogd3JpdHRlbiBwcmlvciBwZXJtaXNzaW9uLiAgVGhlIGNvcHlyaWdodCBob2xk
ZXJzIG1ha2Ugbm8gcmVwcmVzZW50YXRpb25zCisgKiBhYm91dCB0aGUgc3VpdGFiaWxpdHkgb2Yg
dGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UuICBJdCBpcyBwcm92aWRlZCAiYXMKKyAqIGlz
IiB3aXRob3V0IGV4cHJlc3Mgb3IgaW1wbGllZCB3YXJyYW50eS4KKyAqCisgKiBUSEUgQ09QWVJJ
R0hUIEhPTERFUlMgRElTQ0xBSU0gQUxMIFdBUlJBTlRJRVMgV0lUSCBSRUdBUkQgVE8gVEhJUyBT
T0ZUV0FSRSwKKyAqIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5U
QUJJTElUWSBBTkQgRklUTkVTUywgSU4gTk8KKyAqIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQg
SE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBJTkRJUkVDVCBPUgorICogQ09OU0VR
VUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZST00g
TE9TUyBPRiBVU0UsCisgKiBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9G
IENPTlRSQUNULCBORUdMSUdFTkNFIE9SIE9USEVSCisgKiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJ
TkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SIFBFUkZPUk1BTkNFCisg
KiBPRiBUSElTIFNPRlRXQVJFLgorICovCisKKyNpZmRlZiBIQVZFX0NPTkZJR19ICisjaW5jbHVk
ZSAiY29uZmlnLmgiCisjZW5kaWYKKworI2luY2x1ZGUgImR1bW15LmgiCisKKyNkZWZpbmUgRFVN
TVlfREVGQVVMVF9XSURUSCAxMDI0CisjZGVmaW5lIERVTU1ZX0RFRkFVTFRfSEVJR0hUIDc2OAor
CitzdGF0aWMgQm9vbAorY3J0Y19yZXNpemUoU2NybkluZm9SZWMgKiBzY3JuLCBpbnQgd2lkdGgs
IGludCBoZWlnaHQpCit7CisgICAgUGl4bWFwUmVjICpwaXhtYXA7CisgICAgU2NyZWVuUmVjICpz
Y3JlZW47CisKKyAgICBzY3JlZW4gPSB4Zjg2U2NyblRvU2NyZWVuKHNjcm4pOworICAgIHBpeG1h
cCA9IHNjcmVlbi0+R2V0U2NyZWVuUGl4bWFwKHNjcmVlbik7CisKKyAgICBzY3JlZW4tPk1vZGlm
eVBpeG1hcEhlYWRlcihwaXhtYXAsIHdpZHRoLCBoZWlnaHQsIC0xLCAtMSwgLTEsIE5VTEwpOwor
CisgICAgc2Nybi0+dmlydHVhbFggPSB3aWR0aDsKKyAgICBzY3JuLT52aXJ0dWFsWSA9IGhlaWdo
dDsKKworICAgIHJldHVybiBUUlVFOworfQorCitzdGF0aWMgY29uc3QgeGY4NkNydGNDb25maWdG
dW5jc1JlYyBjcnRjX2NvbmZpZ19mdW5jcyA9IHsKKyAgICBjcnRjX3Jlc2l6ZQorfTsKKworc3Rh
dGljIHZvaWQKK2NydGNfZHBtcyh4Zjg2Q3J0Y1B0ciBjcnRjLCBpbnQgbW9kZSkKK3sKKyAgICB4
Zjg2RHJ2TXNnKGNydGMtPnNjcm4tPnNjcm5JbmRleCwgWF9JTkZPLCAiJXM6IFNUVUIgZHBtcyAl
ZFxuIiwgX19mdW5jX18sIG1vZGUpOworfQorCitzdGF0aWMgQm9vbAorY3J0Y19zZXRfbW9kZV9t
YWpvcih4Zjg2Q3J0Y1B0ciBjcnRjLCBEaXNwbGF5TW9kZVB0ciBtb2RlLCBSb3RhdGlvbiByb3Rh
dGlvbiwgaW50IHgsIGludCB5KQoreworICAgIHN0cnVjdCBkdW1teV9jcnRjX3N0YXRlICpzdGF0
ZTsKKyAgICB1aW50NjRfdCB1c3Q7CisKKyAgICB4Zjg2RHJ2TXNnKGNydGMtPnNjcm4tPnNjcm5J
bmRleCwgWF9JTkZPLCAiJXM6IG1vZGUgJXMsIHggJWQsIHkgJWRcbiIsIF9fZnVuY19fLCBtb2Rl
LT5uYW1lLCB4LAorICAgICAgICAgICAgICAgeSk7CisKKyAgICBzdGF0ZSA9IGNydGMtPmRyaXZl
cl9wcml2YXRlOworICAgIHVzdCA9IGR1bW15X2dldHRpbWVfdXMoKTsKKyAgICBpZiAoc3RhdGUt
PmludGVydmFsKQorICAgICAgICBzdGF0ZS0+bXNjX2Jhc2UgKz0gKCh1c3QgLSBzdGF0ZS0+dXN0
X2Jhc2UpIC8gc3RhdGUtPmludGVydmFsKTsKKyAgICBzdGF0ZS0+dXN0X2Jhc2UgPSB1c3Q7Cisg
ICAgc3RhdGUtPmludGVydmFsID0KKyAgICAgICAgKCgodWludDY0X3QpIDEwMDAgKiBtb2RlLT5I
VG90YWwgKiBtb2RlLT5WVG90YWwpICsgKG1vZGUtPkNsb2NrIC8gMikpIC8gbW9kZS0+Q2xvY2s7
CisKKyAgICBjcnRjLT5tb2RlID0gKm1vZGU7CisgICAgY3J0Yy0+eCA9IHg7CisgICAgY3J0Yy0+
eSA9IHk7CisgICAgY3J0Yy0+cm90YXRpb24gPSByb3RhdGlvbjsKKyNpZiBYT1JHX1ZFUlNJT05f
Q1VSUkVOVCA+PSBYT1JHX1ZFUlNJT05fTlVNRVJJQyAoMSwgNSwgOTksIDAsIDApCisgICAgY3J0
Yy0+dHJhbnNmb3JtUHJlc2VudCA9IEZBTFNFOworI2VuZGlmCisKKyAgICByZXR1cm4gVFJVRTsK
K30KKworc3RhdGljIHZvaWQKK2NydGNfZGVzdHJveSh4Zjg2Q3J0Y1B0ciBjcnRjKQoreworICAg
IHhmODZEcnZNc2coY3J0Yy0+c2Nybi0+c2NybkluZGV4LCBYX0lORk8sICIlc1xuIiwgX19mdW5j
X18pOworCisgICAgaWYgKGNydGMtPmRyaXZlcl9wcml2YXRlKSB7CisgICAgICAgIGR1bW15X3By
ZXNlbnRfZnJlZV92YmxhbmtzKGNydGMpOworICAgICAgICBmcmVlKGNydGMtPmRyaXZlcl9wcml2
YXRlKTsKKyAgICB9CisgICAgY3J0Yy0+ZHJpdmVyX3ByaXZhdGUgPSBOVUxMOworfQorCitzdGF0
aWMgdm9pZAorZHVtbXlfY3J0Y19zZXRfY3Vyc29yX2NvbG9ycyh4Zjg2Q3J0Y1B0ciBjcnRjLCBp
bnQgYmcsIGludCBmZykKK3sKK30KKworc3RhdGljIHZvaWQKK2R1bW15X2NydGNfc2V0X2N1cnNv
cl9wb3NpdGlvbih4Zjg2Q3J0Y1B0ciBjcnRjLCBpbnQgeCwgaW50IHkpCit7Cit9CisKK3N0YXRp
YyB2b2lkCitkdW1teV9jcnRjX2hpZGVfY3Vyc29yKHhmODZDcnRjUHRyIGNydGMpCit7Cit9CisK
K3N0YXRpYyBCb29sCitkdW1teV9jcnRjX3Nob3dfY3Vyc29yKHhmODZDcnRjUHRyIGNydGMpCit7
CisgICAgcmV0dXJuIFRSVUU7Cit9CisKK3N0YXRpYyBCb29sCitkdW1teV9jcnRjX2xvYWRfY3Vy
c29yX2FyZ2JfY2hlY2soeGY4NkNydGNQdHIgY3J0YywgQ0FSRDMyICogaW1hZ2UpCit7CisgICAg
cmV0dXJuIFRSVUU7Cit9CisKK3N0YXRpYyBjb25zdCB4Zjg2Q3J0Y0Z1bmNzUmVjIGNydGNfZnVu
Y3MgPSB7CisgICAgLmRwbXMgPSBjcnRjX2RwbXMsCisgICAgLnNhdmUgPSBOVUxMLAorICAgIC5y
ZXN0b3JlID0gTlVMTCwKKyAgICAubG9jayA9IE5VTEwsCisgICAgLnVubG9jayA9IE5VTEwsCisg
ICAgLm1vZGVfZml4dXAgPSBOVUxMLAorICAgIC5wcmVwYXJlID0gTlVMTCwKKyAgICAubW9kZV9z
ZXQgPSBOVUxMLAorICAgIC5jb21taXQgPSBOVUxMLAorICAgIC5nYW1tYV9zZXQgPSBOVUxMLAor
ICAgIC5zaGFkb3dfYWxsb2NhdGUgPSBOVUxMLAorICAgIC5zaGFkb3dfY3JlYXRlID0gTlVMTCwK
KyAgICAuc2hhZG93X2Rlc3Ryb3kgPSBOVUxMLAorICAgIC5zZXRfY3Vyc29yX2NvbG9ycyA9IGR1
bW15X2NydGNfc2V0X2N1cnNvcl9jb2xvcnMsCisgICAgLnNldF9jdXJzb3JfcG9zaXRpb24gPSBk
dW1teV9jcnRjX3NldF9jdXJzb3JfcG9zaXRpb24sCisgICAgLnNob3dfY3Vyc29yID0gTlVMTCwK
KyAgICAuc2hvd19jdXJzb3JfY2hlY2sgPSBkdW1teV9jcnRjX3Nob3dfY3Vyc29yLAorICAgIC5o
aWRlX2N1cnNvciA9IGR1bW15X2NydGNfaGlkZV9jdXJzb3IsCisgICAgLmxvYWRfY3Vyc29yX2lt
YWdlID0gTlVMTCwKKyAgICAubG9hZF9jdXJzb3JfaW1hZ2VfY2hlY2sgPSBOVUxMLAorICAgIC5s
b2FkX2N1cnNvcl9hcmdiID0gTlVMTCwKKyAgICAubG9hZF9jdXJzb3JfYXJnYl9jaGVjayA9IGR1
bW15X2NydGNfbG9hZF9jdXJzb3JfYXJnYl9jaGVjaywKKyAgICAuZGVzdHJveSA9IGNydGNfZGVz
dHJveSwKKyAgICAuc2V0X21vZGVfbWFqb3IgPSBjcnRjX3NldF9tb2RlX21ham9yLAorICAgIC5z
ZXRfb3JpZ2luID0gTlVMTCwKKyAgICAuc2V0X3NjYW5vdXRfcGl4bWFwID0gTlVMTCwKK307CisK
K3ZvaWQKK2NydGNfY29uZmlnX2luaXQoU2NybkluZm9QdHIgcFNjcm4pCit7CisgICAgeGY4NkNy
dGNDb25maWdJbml0KHBTY3JuLCAmY3J0Y19jb25maWdfZnVuY3MpOworfQorCit2b2lkCitjcnRj
X2NyZWF0ZShTY3JuSW5mb1B0ciBwU2NybikKK3sKKyAgICBzdHJ1Y3QgZHVtbXlfY3J0Y19zdGF0
ZSAqc3RhdGU7CisgICAgeGY4NkNydGNSZWMgKmNydGM7CisKKyAgICBjcnRjID0geGY4NkNydGND
cmVhdGUocFNjcm4sICZjcnRjX2Z1bmNzKTsKKworICAgIHN0YXRlID0gbWFsbG9jKHNpemVvZigq
c3RhdGUpKTsKKyAgICBzdGF0ZS0+dXN0X2Jhc2UgPSAwOworICAgIHN0YXRlLT5tc2NfYmFzZSA9
IDA7CisgICAgc3RhdGUtPmludGVydmFsID0gMDsKKyAgICB4b3JnX2xpc3RfaW5pdCgmc3RhdGUt
PnZibGFua19xdWV1ZSk7CisgICAgeG9yZ19saXN0X2luaXQoJnN0YXRlLT52YmxhbmtfZnJlZSk7
CisgICAgc3RhdGUtPnZibGFua190aW1lciA9IE5VTEw7CisgICAgY3J0Yy0+ZHJpdmVyX3ByaXZh
dGUgPSBzdGF0ZTsKKworICAgIC8qCisgICAgICogU2V0IHRoZSBDUlRDIHBhcmFtZXRlcnMgZm9y
IGFsbCBvZiB0aGUgbW9kZXMgYmFzZWQgb24gdGhlIHR5cGUKKyAgICAgKiBvZiBtb2RlLCBhbmQg
dGhlIGNoaXBzZXQncyBpbnRlcmxhY2UgcmVxdWlyZW1lbnRzLgorICAgICAqCisgICAgICogQ2Fs
bGluZyB0aGlzIGlzIHJlcXVpcmVkIGlmIHRoZSBtb2RlLT5DcnRjKiB2YWx1ZXMgYXJlIHVzZWQg
YnkgdGhlCisgICAgICogZHJpdmVyIGFuZCBpZiB0aGUgZHJpdmVyIGRvZXNuJ3QgcHJvdmlkZSBj
b2RlIHRvIHNldCB0aGVtLiAgVGhleQorICAgICAqIGFyZSBub3QgcHJlLWluaXRpYWxpc2VkIGF0
IGFsbC4KKyAgICAgKi8KKyAgICB4Zjg2U2V0Q3J0Y0Zvck1vZGVzKHBTY3JuLCAwKTsKKworICAg
IHhmODZDcnRjU2V0U2l6ZVJhbmdlKHBTY3JuLCAzMjAsIDIwMCwgcFNjcm4tPmRpc3BsYXktPnZp
cnR1YWxYLCBwU2Nybi0+ZGlzcGxheS0+dmlydHVhbFkpOworfQorCisvKioKKyAqIFR1cm5zIHRo
ZSBvdXRwdXQgb24vb2ZmLCBvciBzZXRzIGludGVybWVkaWF0ZSBwb3dlciBsZXZlbHMgaWYgYXZh
aWxhYmxlLgorICoKKyAqIFVuc3VwcG9ydGVkIGludGVybWVkaWF0ZSBtb2RlcyBkcm9wIHRvIHRo
ZSBsb3dlciBwb3dlciBzZXR0aW5nLiAgSWYgdGhlCisgKiBtb2RlIGlzIERQTVNNb2RlT2ZmLCB0
aGUgb3V0cHV0IG11c3QgYmUgZGlzYWJsZWQsIGFzIHRoZSBEUExMIG1heSBiZQorICogZGlzYWJs
ZWQgYWZ0ZXJ3YXJkcy4KKyAqLworc3RhdGljIHZvaWQKK291dHB1dF9kcG1zKHhmODZPdXRwdXRQ
dHIgb3V0cHV0LCBpbnQgbW9kZSkKK3sKKyAgICB4Zjg2RHJ2TXNnKG91dHB1dC0+c2Nybi0+c2Ny
bkluZGV4LCBYX0lORk8sICIlczogU1RVQiBkcG1zICVkXG4iLCBfX2Z1bmNfXywgbW9kZSk7Cit9
CisKKy8qKgorICogQ2FsbGJhY2sgZm9yIHRlc3RpbmcgYSB2aWRlbyBtb2RlIGZvciBhIGdpdmVu
IG91dHB1dC4KKyAqCisgKiBUaGlzIGZ1bmN0aW9uIHNob3VsZCBvbmx5IGNoZWNrIGZvciBjYXNl
cyB3aGVyZSBhIG1vZGUgY2FuJ3QgYmUgc3VwcG9ydGVkCisgKiBvbiB0aGUgb3V0cHV0IHNwZWNp
ZmljYWxseSwgYW5kIG5vdCByZXByZXNlbnQgZ2VuZXJpYyBDUlRDIGxpbWl0YXRpb25zLgorICoK
KyAqIFxyZXR1cm4gTU9ERV9PSyBpZiB0aGUgbW9kZSBpcyB2YWxpZCwgb3IgYW5vdGhlciBNT0RF
Xyogb3RoZXJ3aXNlLgorICovCitzdGF0aWMgaW50CitvdXRwdXRfbW9kZV92YWxpZCh4Zjg2T3V0
cHV0UHRyIG91dHB1dCwgRGlzcGxheU1vZGVQdHIgcE1vZGUpCit7CisgICAgcmV0dXJuIE1PREVf
T0s7Cit9CisKKy8qIFRoaXMgaXMgY29waWVkIGZyb20geGY4NkNydGMuYy9HdWVzc1JhbmdlRnJv
bU1vZGVzLiAgRXNzZW50aWFsbHksIHdlIHdhbnQKKyAgIGFsbCBvZiB0aGUgZGVmYXVsdCBtb2Rl
cyB0byBiZSBjb25zaWRlcmVkIHdpdGhpbiBzeW5jIHJhbmdlLiAgVGhlIG5vcm1hbAorICAgeGY4
NkluaXRpYWxDb25maWd1cmF0aW9uIHdpbGwgdXNlIHRoaXMsIGJ1dCB0aGVuIGRpc2NhcmQgdGhl
IHN5bmMgcmFuZ2VzLgorKi8KK3N0YXRpYyB2b2lkCitvdXRwdXRfZ3Vlc3NfcmFuZ2VzX2Zyb21f
bW9kZXMoTW9uUHRyIG1vbiwgRGlzcGxheU1vZGVQdHIgbW9kZSkKK3sKKyAgICBpZiAoIW1vbiB8
fCAhbW9kZSkKKyAgICAgICAgcmV0dXJuOworCisgICAgbW9uLT5uSHN5bmMgPSAxOworICAgIG1v
bi0+aHN5bmNbMF0ubG8gPSAxMDI0LjA7CisgICAgbW9uLT5oc3luY1swXS5oaSA9IDAuMDsKKwor
ICAgIG1vbi0+blZyZWZyZXNoID0gMTsKKyAgICBtb24tPnZyZWZyZXNoWzBdLmxvID0gMTAyNC4w
OworICAgIG1vbi0+dnJlZnJlc2hbMF0uaGkgPSAwLjA7CisKKyAgICB3aGlsZSAobW9kZSkgewor
ICAgICAgICBpZiAoIW1vZGUtPkhTeW5jKQorICAgICAgICAgICAgbW9kZS0+SFN5bmMgPSAoKGZs
b2F0KSBtb2RlLT5DbG9jaykgLyAoKGZsb2F0KSBtb2RlLT5IVG90YWwpOworCisgICAgICAgIGlm
ICghbW9kZS0+VlJlZnJlc2gpCisgICAgICAgICAgICBtb2RlLT5WUmVmcmVzaCA9ICgxMDAwLjAg
KiAoKGZsb2F0KSBtb2RlLT5DbG9jaykpIC8KKyAgICAgICAgICAgICAgICAoKGZsb2F0KSAobW9k
ZS0+SFRvdGFsICogbW9kZS0+VlRvdGFsKSk7CisKKyAgICAgICAgaWYgKG1vZGUtPkhTeW5jIDwg
bW9uLT5oc3luY1swXS5sbykKKyAgICAgICAgICAgIG1vbi0+aHN5bmNbMF0ubG8gPSBtb2RlLT5I
U3luYzsKKworICAgICAgICBpZiAobW9kZS0+SFN5bmMgPiBtb24tPmhzeW5jWzBdLmhpKQorICAg
ICAgICAgICAgbW9uLT5oc3luY1swXS5oaSA9IG1vZGUtPkhTeW5jOworCisgICAgICAgIGlmICht
b2RlLT5WUmVmcmVzaCA8IG1vbi0+dnJlZnJlc2hbMF0ubG8pCisgICAgICAgICAgICBtb24tPnZy
ZWZyZXNoWzBdLmxvID0gbW9kZS0+VlJlZnJlc2g7CisKKyAgICAgICAgaWYgKG1vZGUtPlZSZWZy
ZXNoID4gbW9uLT52cmVmcmVzaFswXS5oaSkKKyAgICAgICAgICAgIG1vbi0+dnJlZnJlc2hbMF0u
aGkgPSBtb2RlLT5WUmVmcmVzaDsKKworICAgICAgICBtb2RlID0gbW9kZS0+bmV4dDsKKyAgICB9
CisKKyAgICAvKiBzdHJldGNoIG91dCB0aGUgYm90dG9tIHRvIGZpdCA2NDB4NDgwQDYwICovCisg
ICAgaWYgKG1vbi0+aHN5bmNbMF0ubG8gPiAzMS4wKQorICAgICAgICBtb24tPmhzeW5jWzBdLmxv
ID0gMzEuMDsKKyAgICBpZiAobW9uLT52cmVmcmVzaFswXS5sbyA+IDU4LjApCisgICAgICAgIG1v
bi0+dnJlZnJlc2hbMF0ubG8gPSA1OC4wOworfQorCisvKioKKyAqIFByb2JlIGZvciBhIGNvbm5l
Y3RlZCBvdXRwdXQsIGFuZCByZXR1cm4gZGV0ZWN0X3N0YXR1cy4KKyAqLworc3RhdGljIHhmODZP
dXRwdXRTdGF0dXMKK291dHB1dF9kZXRlY3QoeGY4Nk91dHB1dFB0ciBvdXRwdXQpCit7CisgICAg
eGY4NkRydk1zZyhvdXRwdXQtPnNjcm4tPnNjcm5JbmRleCwgWF9JTkZPLCAiJXM6IFNUVUIgZGV0
ZWN0XG4iLCBfX2Z1bmNfXyk7CisgICAgcmV0dXJuIFhGODZPdXRwdXRTdGF0dXNDb25uZWN0ZWQ7
Cit9CisKK3N0YXRpYyBEaXNwbGF5TW9kZVB0cgorb3V0cHV0X2NyZWF0ZV9tb2RlKFNjcm5JbmZv
UHRyIHBTY3JuLCBpbnQgd2lkdGgsIGludCBoZWlnaHQsIGludCB0eXBlKQoreworICAgIERpc3Bs
YXlNb2RlUHRyIG1vZGU7CisKKyAgICBtb2RlID0geG5mY2FsbG9jKDEsIHNpemVvZihEaXNwbGF5
TW9kZVJlYykpOworCisgICAgbW9kZS0+c3RhdHVzID0gTU9ERV9PSzsKKyAgICBtb2RlLT50eXBl
ID0gdHlwZTsKKyAgICBtb2RlLT5IRGlzcGxheSA9IHdpZHRoOworICAgIG1vZGUtPkhTeW5jU3Rh
cnQgPSAod2lkdGggKiAxMDUgLyAxMDAgKyA3KSAmIH43OworICAgIG1vZGUtPkhTeW5jRW5kID0g
KHdpZHRoICogMTE1IC8gMTAwICsgNykgJiB+NzsKKyAgICBtb2RlLT5IVG90YWwgPSAod2lkdGgg
KiAxMzAgLyAxMDAgKyA3KSAmIH43OworICAgIG1vZGUtPlZEaXNwbGF5ID0gaGVpZ2h0OworICAg
IG1vZGUtPlZTeW5jU3RhcnQgPSBoZWlnaHQgKyAxOworICAgIG1vZGUtPlZTeW5jRW5kID0gaGVp
Z2h0ICsgNDsKKyAgICBtb2RlLT5WVG90YWwgPSBoZWlnaHQgKiAxMDM1IC8gMTAwMDsKKyAgICBt
b2RlLT5DbG9jayA9IG1vZGUtPkhUb3RhbCAqIG1vZGUtPlZUb3RhbCAqIDYwIC8gMTAwMDsKKyAg
ICBtb2RlLT5GbGFncyA9IFZfTkhTWU5DIHwgVl9QVlNZTkM7CisKKyAgICB4Zjg2U2V0TW9kZURl
ZmF1bHROYW1lKG1vZGUpOworICAgIHhmODZTZXRNb2RlQ3J0Yyhtb2RlLCBwU2Nybi0+YWRqdXN0
RmxhZ3MpOyAgLyogbmVlZGVkPyB4Zjg2LXZpZGVvLW1vZGVzZXR0aW5nIGRvZXMgdGhpcyAqLwor
CisgICAgcmV0dXJuIG1vZGU7Cit9CisKK3N0YXRpYyB2b2lkCitvdXRwdXRfY2hlY2tfbW9kZXMo
U2NybkluZm9QdHIgcFNjcm4sIERpc3BsYXlNb2RlUHRyIG1vZGVzKQoreworICAgIGludCBwcmVm
ZXJyZWRfZm91bmQgPSAwOworICAgIGludCB2aXJ0dWFsX2ZvdW5kID0gMDsKKyAgICBEaXNwbGF5
TW9kZVB0ciBtb2RlID0gbW9kZXM7CisKKyAgICB3aGlsZSAobW9kZSkgeworICAgICAgICBpZiAo
bW9kZS0+SERpc3BsYXkgPT0gRFVNTVlfREVGQVVMVF9XSURUSCAmJiBtb2RlLT5WRGlzcGxheSA9
PSBEVU1NWV9ERUZBVUxUX0hFSUdIVCkgeworICAgICAgICAgICAgbW9kZS0+dHlwZSB8PSBNX1Rf
UFJFRkVSUkVEOworICAgICAgICAgICAgcHJlZmVycmVkX2ZvdW5kKys7CisgICAgICAgIH0KKyAg
ICAgICAgaWYgKG1vZGUtPkhEaXNwbGF5ID09IHBTY3JuLT5kaXNwbGF5LT52aXJ0dWFsWCAmJgor
ICAgICAgICAgICAgbW9kZS0+VkRpc3BsYXkgPT0gcFNjcm4tPmRpc3BsYXktPnZpcnR1YWxZKSB7
CisgICAgICAgICAgICB2aXJ0dWFsX2ZvdW5kID0gMDsKKyAgICAgICAgfQorCisgICAgICAgIG1v
ZGUtPnR5cGUgfD0gTV9UX0RSSVZFUjsKKyAgICAgICAgbW9kZSA9IG1vZGUtPm5leHQ7CisgICAg
fQorCisgICAgaWYgKHByZWZlcnJlZF9mb3VuZCA9PSAwKSB7CisgICAgICAgIG1vZGUgPSBvdXRw
dXRfY3JlYXRlX21vZGUocFNjcm4sIERVTU1ZX0RFRkFVTFRfV0lEVEgsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgRFVNTVlfREVGQVVMVF9IRUlHSFQsIE1fVF9EUklWRVIgfCBN
X1RfUFJFRkVSUkVEKTsKKyAgICAgICAgeGY4Nk1vZGVzQWRkKG1vZGVzLCBtb2RlKTsKKyAgICB9
CisKKyAgICBpZiAoRFVNTVlfREVGQVVMVF9XSURUSCA9PSBwU2Nybi0+ZGlzcGxheS0+dmlydHVh
bFggJiYKKyAgICAgICAgRFVNTVlfREVGQVVMVF9IRUlHSFQgPT0gcFNjcm4tPmRpc3BsYXktPnZp
cnR1YWxZKSB7CisgICAgICAgIHZpcnR1YWxfZm91bmQrKzsKKyAgICB9CisKKyAgICBpZiAodmly
dHVhbF9mb3VuZCA9PSAwKSB7CisgICAgICAgIG1vZGUgPSBvdXRwdXRfY3JlYXRlX21vZGUocFNj
cm4sIHBTY3JuLT5kaXNwbGF5LT52aXJ0dWFsWCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBwU2Nybi0+ZGlzcGxheS0+dmlydHVhbFksIE1fVF9EUklWRVIpOworICAgICAgICB4
Zjg2TW9kZXNBZGQobW9kZXMsIG1vZGUpOworICAgIH0KK30KKworLyoqCisgKiBRdWVyeSB0aGUg
ZGV2aWNlIGZvciB0aGUgbW9kZXMgaXQgcHJvdmlkZXMuCisgKgorICogVGhpcyBmdW5jdGlvbiBt
YXkgYWxzbyB1cGRhdGUgTW9uSW5mbywgbW1fd2lkdGgsIGFuZCBtbV9oZWlnaHQuCisgKgorICog
XHJldHVybiBzaW5nbHktbGlua2VkIGxpc3Qgb2YgbW9kZXMgb3IgTlVMTCBpZiBubyBtb2RlcyBm
b3VuZC4KKyAqLworc3RhdGljIERpc3BsYXlNb2RlUHRyCitvdXRwdXRfZ2V0X21vZGVzKHhmODZP
dXRwdXRQdHIgb3V0cHV0KQoreworICAgIERpc3BsYXlNb2RlUHRyIG1vZGVzID0gb3V0cHV0LT5k
cml2ZXJfcHJpdmF0ZTsKKworICAgIHhmODZEcnZNc2cob3V0cHV0LT5zY3JuLT5zY3JuSW5kZXgs
IFhfSU5GTywgIiVzOiBTVFVCICVwXG4iLCBfX2Z1bmNfXywgbW9kZXMpOworCisgICAgcmV0dXJu
IHhmODZEdXBsaWNhdGVNb2RlcyhvdXRwdXQtPnNjcm4sIG1vZGVzKTsKK30KKworLyoqCisgKiBD
YWxsYmFjayB0byBnZXQgY3VycmVudCBDUlRDIGZvciBhIGdpdmVuIG91dHB1dAorICovCitzdGF0
aWMgeGY4NkNydGNQdHIKK291dHB1dF9nZXRfY3J0Yyh4Zjg2T3V0cHV0UHRyIG91dHB1dCkKK3sK
KyAgICByZXR1cm4gb3V0cHV0LT5jcnRjOworfQorCisvKioKKyAqIENsZWFuIHVwIGRyaXZlci1z
cGVjaWZpYyBiaXRzIG9mIHRoZSBvdXRwdXQKKyAqLworc3RhdGljIHZvaWQKK291dHB1dF9kZXN0
cm95KHhmODZPdXRwdXRQdHIgb3V0cHV0KQoreworICAgIERpc3BsYXlNb2RlUHRyIG1vZGVzID0g
b3V0cHV0LT5kcml2ZXJfcHJpdmF0ZTsKKworICAgIG91dHB1dC0+ZHJpdmVyX3ByaXZhdGUgPSBO
VUxMOworICAgIHdoaWxlIChtb2RlcykKKyAgICAgICAgeGY4NkRlbGV0ZU1vZGUoJm1vZGVzLCBt
b2Rlcyk7Cit9CisKK3hmODZPdXRwdXRGdW5jc1JlYyBvdXRwdXRfZnVuY3MgPSB7CisgICAgLmNy
ZWF0ZV9yZXNvdXJjZXMgPSBOVUxMLAorICAgIC5kcG1zID0gb3V0cHV0X2RwbXMsCisgICAgLnNh
dmUgPSBOVUxMLAorICAgIC5yZXN0b3JlID0gTlVMTCwKKyAgICAubW9kZV92YWxpZCA9IG91dHB1
dF9tb2RlX3ZhbGlkLAorICAgIC5tb2RlX2ZpeHVwID0gTlVMTCwgICAgICAgICAvKiBOb3QgcmVx
dWlyZWQgaWYgY3J0YyBwcm92aWRlcyBzZXRfbWFqb3JfbW9kZSAqLworICAgIC5wcmVwYXJlID0g
TlVMTCwKKyAgICAuY29tbWl0ID0gTlVMTCwKKyAgICAubW9kZV9zZXQgPSBOVUxMLAorICAgIC5k
ZXRlY3QgPSBvdXRwdXRfZGV0ZWN0LAorICAgIC5nZXRfbW9kZXMgPSBvdXRwdXRfZ2V0X21vZGVz
LAorCisjaWZkZWYgUkFORFJfMTJfSU5URVJGQUNFCisgICAgLnNldF9wcm9wZXJ0eSA9IE5VTEws
CisjZW5kaWYKKyNpZmRlZiBSQU5EUl8xM19JTlRFUkZBQ0UKKyAgICAuZ2V0X3Byb3BlcnR5ID0g
TlVMTCwKKyNlbmRpZgorI2lmZGVmIFJBTkRSX0dFVF9DUlRDX0lOVEVSRkFDRQorICAgIC5nZXRf
Y3J0YyA9IG91dHB1dF9nZXRfY3J0YywKKyNlbmRpZgorICAgIC5kZXN0cm95ID0gb3V0cHV0X2Rl
c3Ryb3ksCit9OworCit2b2lkCitvdXRwdXRfcHJlX2luaXQoU2NybkluZm9QdHIgcFNjcm4pCit7
CisgICAgRGlzcGxheU1vZGVQdHIgbW9kZXM7CisgICAgeGY4Nk91dHB1dFB0ciBvdXRwdXQgPSB4
Zjg2T3V0cHV0Q3JlYXRlKHBTY3JuLCAmb3V0cHV0X2Z1bmNzLCAiU1BJQ0UtMCIpOworICAgIG91
dHB1dC0+cG9zc2libGVfY3J0Y3MgPSAoMSA8PCAwKTsKKyAgICBtb2RlcyA9IHhmODZHZXREZWZh
dWx0TW9kZXMoKTsKKyAgICBvdXRwdXRfY2hlY2tfbW9kZXMocFNjcm4sIG1vZGVzKTsKKyAgICBv
dXRwdXRfZ3Vlc3NfcmFuZ2VzX2Zyb21fbW9kZXMob3V0cHV0LT5zY3JuLT5tb25pdG9yLCBtb2Rl
cyk7CisgICAgb3V0cHV0LT5kcml2ZXJfcHJpdmF0ZSA9IG1vZGVzOworfQpkaWZmIC0tZ2l0IGEv
c3BpY2UtdmlkZW8tZHVtbXkvc3JjL2RyaTIuYyBiL3NwaWNlLXZpZGVvLWR1bW15L3NyYy9kcmky
LmMKaW5kZXggMmQzZjRjMDguLmVhNDk4ZGE4IDEwMDY0NAotLS0gYS9zcGljZS12aWRlby1kdW1t
eS9zcmMvZHJpMi5jCisrKyBiL3NwaWNlLXZpZGVvLWR1bW15L3NyYy9kcmkyLmMKQEAgLTIxOSw4
ICsyMTksOSBAQCBkdW1teV9kcmkyX2NvcHlfcmVnaW9uKERyYXdhYmxlUmVjICogZHJhd2FibGUs
IFJlZ2lvblJlYyAqIHJlZ2lvbiwKIHN0YXRpYyBpbnQKIGR1bW15X2RyaTJfZ2V0X21zYyhEcmF3
YWJsZVJlYyAqIGRyYXdhYmxlLCBDQVJENjQgKiB1c3QsIENBUkQ2NCAqIG1zYykKIHsKLSAgICAq
dXN0ID0gZHVtbXlfZ2V0dGltZV91cygpOwotICAgICptc2MgPSAwOworICAgIFNjcm5JbmZvUmVj
ICpzY3JuID0geGY4NlNjcmVlblRvU2NybihkcmF3YWJsZS0+cFNjcmVlbik7CisKKyAgICBkdW1t
eV9nZXRfdXN0X21zYyh4Zjg2Q29tcGF0UlJDcnRjKHNjcm4pLCB1c3QsIG1zYyk7CiAKICAgICBy
ZXR1cm4gVFJVRTsKIH0KZGlmZiAtLWdpdCBhL3NwaWNlLXZpZGVvLWR1bW15L3NyYy9kdW1teS5o
IGIvc3BpY2UtdmlkZW8tZHVtbXkvc3JjL2R1bW15LmgKaW5kZXggZGM0YWI5MmYuLjc5ZDFhOWVm
IDEwMDY0NAotLS0gYS9zcGljZS12aWRlby1kdW1teS9zcmMvZHVtbXkuaAorKysgYi9zcGljZS12
aWRlby1kdW1teS9zcmMvZHVtbXkuaApAQCAtNCw2ICs0LDcgQEAKICNpbmNsdWRlICJ4Zjg2X09T
cHJvYy5oIgogCiAjaW5jbHVkZSAieGY4NkN1cnNvci5oIgorI2luY2x1ZGUgInhmODZDcnRjLmgi
CiAKICNpZmRlZiBYdkV4dGVuc2lvbgogI2luY2x1ZGUgInhmODZ4di5oIgpAQCAtMzUsNiArMzYs
MTQgQEAgZXh0ZXJuIHZvaWQgRFVNTVlIaWRlQ3Vyc29yKFNjcm5JbmZvUHRyIHBTY3JuKTsKIHZv
aWQgZHVtbXlfZHJpMl9jbG9zZV9zY3JlZW4oU2NyZWVuUmVjICogc2NyZWVuKTsKIEJvb2wgZHVt
bXlfZHJpMl9zY3JlZW5faW5pdChTY3JlZW5SZWMgKiBzY3JlZW4pOwogQm9vbCBkdW1teV9wcmVz
ZW50X3NjcmVlbl9pbml0KFNjcmVlblJlYyAqIHNjcmVlbik7Cit2b2lkIGR1bW15X3ByZXNlbnRf
ZnJlZV92YmxhbmtzKHhmODZDcnRjUHRyIGNydGMpOworCisvKiBpbiBjcnRjLmMgKi8KK3ZvaWQg
Y3J0Y19jb25maWdfaW5pdChTY3JuSW5mb1B0ciBzY3JuKTsKK3ZvaWQgY3J0Y19jcmVhdGUoU2Ny
bkluZm9QdHIgc2Nybik7CisKKy8qIGluIG91dHB1dC5jICovCit2b2lkIG91dHB1dF9wcmVfaW5p
dChTY3JuSW5mb1B0ciBzY3JuKTsKIAogLyogZ2xvYmFscyAqLwogdHlwZWRlZiBzdHJ1Y3QgX2Nv
bG9yIHsKQEAgLTYzLDYgKzcyLDE2IEBAIHR5cGVkZWYgc3RydWN0IGR1bW15UmVjIHsKICAgICBp
bnQgZmQ7CiB9IERVTU1ZUmVjLCAqRFVNTVlQdHI7CiAKK3N0cnVjdCBkdW1teV9jcnRjX3N0YXRl
IHsKKyAgICB1aW50NjRfdCB1c3RfYmFzZTsKKyAgICB1aW50NjRfdCBtc2NfYmFzZTsKKyAgICB1
aW50NjRfdCBpbnRlcnZhbDsKKworICAgIHN0cnVjdCB4b3JnX2xpc3QgdmJsYW5rX3F1ZXVlOwor
ICAgIHN0cnVjdCB4b3JnX2xpc3QgdmJsYW5rX2ZyZWU7CisgICAgT3NUaW1lclB0ciB2Ymxhbmtf
dGltZXI7Cit9OworCiAvKiBUaGUgcHJpdmF0ZXMgb2YgdGhlIERVTU1ZIGRyaXZlciAqLwogI2Rl
ZmluZSBEVU1NWVBUUihwKQkoKERVTU1ZUHRyKSgocCktPmRyaXZlclByaXZhdGUpKQogCkBAIC03
NywzICs5NiwxNyBAQCBkdW1teV9nZXR0aW1lX3VzKHZvaWQpCiAKICAgICByZXR1cm4gKHVpbnQ2
NF90KSB0di50dl9zZWMgKiAxMDAwMDAwICsgdHYudHZfbnNlYyAvIDEwMDA7CiB9CisKK3N0YXRp
YyBpbmxpbmUgdm9pZAorZHVtbXlfZ2V0X3VzdF9tc2MoY29uc3QgUlJDcnRjUmVjICogY3J0Yywg
dWludDY0X3QgKiB1c3QsIHVpbnQ2NF90ICogbXNjKQoreworICAgIHN0cnVjdCBkdW1teV9jcnRj
X3N0YXRlICpzdGF0ZTsKKyAgICB4Zjg2Q3J0Y1JlYyAqeGY4Nl9jcnRjOworCisgICAgeGY4Nl9j
cnRjID0gY3J0Yy0+ZGV2UHJpdmF0ZTsKKyAgICBzdGF0ZSA9IHhmODZfY3J0Yy0+ZHJpdmVyX3By
aXZhdGU7CisgICAgKnVzdCA9IGR1bW15X2dldHRpbWVfdXMoKTsKKyAgICAqbXNjID0gc3RhdGUt
Pm1zY19iYXNlOworICAgIGlmIChzdGF0ZS0+aW50ZXJ2YWwpCisgICAgICAgICptc2MgKz0gKCp1
c3QgLSBzdGF0ZS0+dXN0X2Jhc2UpIC8gc3RhdGUtPmludGVydmFsOworfQpkaWZmIC0tZ2l0IGEv
c3BpY2UtdmlkZW8tZHVtbXkvc3JjL2R1bW15X2N1cnNvci5jIGIvc3BpY2UtdmlkZW8tZHVtbXkv
c3JjL2R1bW15X2N1cnNvci5jCmRlbGV0ZWQgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwM2RlOGVi
Ni4uMDAwMDAwMDAKLS0tIGEvc3BpY2UtdmlkZW8tZHVtbXkvc3JjL2R1bW15X2N1cnNvci5jCisr
KyAvZGV2L251bGwKQEAgLTEsMTAxICswLDAgQEAKLSNpZmRlZiBIQVZFX0NPTkZJR19ICi0jaW5j
bHVkZSAiY29uZmlnLmgiCi0jZW5kaWYKLQotLyogQWxsIGRyaXZlcnMgc2hvdWxkIHR5cGljYWxs
eSBpbmNsdWRlIHRoZXNlICovCi0jaW5jbHVkZSAieGY4Ni5oIgotI2luY2x1ZGUgInhmODZfT1Nw
cm9jLmgiCi0KLSNpbmNsdWRlICJ4Zjg2Q3Vyc29yLmgiCi0jaW5jbHVkZSAiY3Vyc29yc3RyLmgi
Ci0vKiBEcml2ZXIgc3BlY2lmaWMgaGVhZGVycyAqLwotI2luY2x1ZGUgImR1bW15LmgiCi0KLXN0
YXRpYyB2b2lkCi1kdW1teVNob3dDdXJzb3IoU2NybkluZm9QdHIgcFNjcm4pCi17Ci0gICAgRFVN
TVlQdHIgZFB0ciA9IERVTU1ZUFRSKHBTY3JuKTsKLQotICAgIC8qIHR1cm4gY3Vyc29yIG9uICov
Ci0gICAgZFB0ci0+RHVtbXlIV0N1cnNvclNob3duID0gVFJVRTsKLX0KLQotc3RhdGljIHZvaWQK
LWR1bW15SGlkZUN1cnNvcihTY3JuSW5mb1B0ciBwU2NybikKLXsKLSAgICBEVU1NWVB0ciBkUHRy
ID0gRFVNTVlQVFIocFNjcm4pOwotCi0gICAgLyoKLSAgICAgKiB0dXJuIGN1cnNvciBvZmYKLSAg
ICAgKgotICAgICAqLwotICAgIGRQdHItPkR1bW15SFdDdXJzb3JTaG93biA9IEZBTFNFOwotfQot
Ci0jZGVmaW5lIE1BWF9DVVJTIDY0Ci0KLXN0YXRpYyB2b2lkCi1kdW1teVNldEN1cnNvclBvc2l0
aW9uKFNjcm5JbmZvUHRyIHBTY3JuLCBpbnQgeCwgaW50IHkpCi17Ci0gICAgRFVNTVlQdHIgZFB0
ciA9IERVTU1ZUFRSKHBTY3JuKTsKLQotICAgIGRQdHItPmN1cnNvclggPSB4OwotICAgIGRQdHIt
PmN1cnNvclkgPSB5OwotfQotCi1zdGF0aWMgdm9pZAotZHVtbXlTZXRDdXJzb3JDb2xvcnMoU2Ny
bkluZm9QdHIgcFNjcm4sIGludCBiZywgaW50IGZnKQotewotICAgIERVTU1ZUHRyIGRQdHIgPSBE
VU1NWVBUUihwU2Nybik7Ci0KLSAgICBkUHRyLT5jdXJzb3JGRyA9IGZnOwotICAgIGRQdHItPmN1
cnNvckJHID0gYmc7Ci19Ci0KLXN0YXRpYyB2b2lkCi1kdW1teUxvYWRDdXJzb3JJbWFnZShTY3Ju
SW5mb1B0ciBwU2NybiwgdW5zaWduZWQgY2hhciAqc3JjKQotewotfQotCi1zdGF0aWMgQm9vbAot
ZHVtbXlVc2VIV0N1cnNvcihTY3JlZW5QdHIgcFNjciwgQ3Vyc29yUHRyIHBDdXJzKQotewotICAg
IERVTU1ZUHRyIGRQdHIgPSBEVU1NWVBUUih4Zjg2U2NyZWVuVG9TY3JuKHBTY3IpKTsKLSAgICBy
ZXR1cm4gKCFkUHRyLT5zd0N1cnNvcik7Ci19Ci0KLSNpZiAwCi1zdGF0aWMgdW5zaWduZWQgY2hh
ciAqCi1kdW1teVJlYWxpemVDdXJzb3IoeGY4NkN1cnNvckluZm9QdHIgaW5mb1B0ciwgQ3Vyc29y
UHRyIHBDdXJzKQotewotICAgIHJldHVybiBOVUxMOwotfQotI2VuZGlmCi0KLUJvb2wKLURVTU1Z
Q3Vyc29ySW5pdChTY3JlZW5QdHIgcFNjcmVlbikKLXsKLSAgICBEVU1NWVB0ciBkUHRyID0gRFVN
TVlQVFIoeGY4NlNjcmVlblRvU2NybihwU2NyZWVuKSk7Ci0KLSAgICB4Zjg2Q3Vyc29ySW5mb1B0
ciBpbmZvUHRyOwotICAgIGluZm9QdHIgPSB4Zjg2Q3JlYXRlQ3Vyc29ySW5mb1JlYygpOwotICAg
IGlmICghaW5mb1B0cikgewotICAgICAgICByZXR1cm4gRkFMU0U7Ci0gICAgfQotCi0gICAgZFB0
ci0+Q3Vyc29ySW5mbyA9IGluZm9QdHI7Ci0KLSAgICBpbmZvUHRyLT5NYXhIZWlnaHQgPSA2NDsK
LSAgICBpbmZvUHRyLT5NYXhXaWR0aCA9IDY0OwotICAgIGluZm9QdHItPkZsYWdzID0gSEFSRFdB
UkVfQ1VSU09SX1RSVUVDT0xPUl9BVF84QlBQOwotCi0gICAgaW5mb1B0ci0+U2V0Q3Vyc29yQ29s
b3JzID0gZHVtbXlTZXRDdXJzb3JDb2xvcnM7Ci0gICAgaW5mb1B0ci0+U2V0Q3Vyc29yUG9zaXRp
b24gPSBkdW1teVNldEN1cnNvclBvc2l0aW9uOwotICAgIGluZm9QdHItPkxvYWRDdXJzb3JJbWFn
ZSA9IGR1bW15TG9hZEN1cnNvckltYWdlOwotICAgIGluZm9QdHItPkhpZGVDdXJzb3IgPSBkdW1t
eUhpZGVDdXJzb3I7Ci0gICAgaW5mb1B0ci0+U2hvd0N1cnNvciA9IGR1bW15U2hvd0N1cnNvcjsK
LSAgICBpbmZvUHRyLT5Vc2VIV0N1cnNvciA9IGR1bW15VXNlSFdDdXJzb3I7Ci0vKiAgICAgaW5m
b1B0ci0+UmVhbGl6ZUN1cnNvciA9IGR1bW15UmVhbGl6ZUN1cnNvcjsgKi8KLQotICAgIHJldHVy
biAoeGY4NkluaXRDdXJzb3IocFNjcmVlbiwgaW5mb1B0cikpOwotfQpkaWZmIC0tZ2l0IGEvc3Bp
Y2UtdmlkZW8tZHVtbXkvc3JjL3ByZXNlbnQuYyBiL3NwaWNlLXZpZGVvLWR1bW15L3NyYy9wcmVz
ZW50LmMKaW5kZXggODFmY2M1YjYuLmFkMjlkYzkxIDEwMDY0NAotLS0gYS9zcGljZS12aWRlby1k
dW1teS9zcmMvcHJlc2VudC5jCisrKyBiL3NwaWNlLXZpZGVvLWR1bW15L3NyYy9wcmVzZW50LmMK
QEAgLTI3LDI1ICsyNywxMDkgQEAKICNpbmNsdWRlICJkdW1teS5oIgogI2luY2x1ZGUgInByZXNl
bnQuaCIKIAorI2luY2x1ZGUgPHN0ZGJvb2wuaD4KKworc3RydWN0IGR1bW15X3ZibGFuayB7Cisg
ICAgc3RydWN0IHhvcmdfbGlzdCBsaXN0OworICAgIHVpbnQ2NF90IGV2ZW50X2lkOworICAgIHVp
bnQ2NF90IHRhcmdldF9tc2M7Cit9OworCiBzdGF0aWMgUlJDcnRjUmVjICoKIGR1bW15X3ByZXNl
bnRfZ2V0X2NydGMoV2luZG93UmVjICogd2luZG93KQogewotICAgIHJldHVybiBOVUxMOworICAg
IFNjcm5JbmZvUmVjICpzY3JuOworCisgICAgaWYgKCEoc2NybiA9IHhmODZTY3JlZW5Ub1Njcm4o
d2luZG93LT5kcmF3YWJsZS5wU2NyZWVuKSkpCisgICAgICAgIHJldHVybiBOVUxMOworICAgIHJl
dHVybiB4Zjg2Q29tcGF0UlJDcnRjKHNjcm4pOwogfQogCiBzdGF0aWMgaW50CiBkdW1teV9wcmVz
ZW50X2dldF91c3RfbXNjKFJSQ3J0Y1JlYyAqIGNydGMsIENBUkQ2NCAqIHVzdCwgQ0FSRDY0ICog
bXNjKQogewotICAgICp1c3QgPSBkdW1teV9nZXR0aW1lX3VzKCk7Ci0gICAgKm1zYyA9IDA7Cisg
ICAgZHVtbXlfZ2V0X3VzdF9tc2MoY3J0YywgdXN0LCBtc2MpOwogCiAgICAgcmV0dXJuIFN1Y2Nl
c3M7CiB9CiAKK3N0YXRpYyB1aW50NjRfdAorZHVtbXlfcHJlc2VudF91c3RfZm9yX21zYyhSUkNy
dGNSZWMgKiBjcnRjLCB1aW50NjRfdCBtc2MpCit7CisgICAgc3RydWN0IGR1bW15X2NydGNfc3Rh
dGUgKnN0YXRlOworICAgIHhmODZDcnRjUmVjICp4Zjg2X2NydGM7CisKKyAgICB4Zjg2X2NydGMg
PSBjcnRjLT5kZXZQcml2YXRlOworICAgIHN0YXRlID0geGY4Nl9jcnRjLT5kcml2ZXJfcHJpdmF0
ZTsKKworICAgIHJldHVybiBzdGF0ZS0+dXN0X2Jhc2UgKyAoc3RhdGUtPmludGVydmFsICogKG1z
YyAtIHN0YXRlLT5tc2NfYmFzZSkpOworfQorCitzdGF0aWMgdWludDMyX3QKK2R1bW15X2RvX3Rp
bWVyKE9zVGltZXJQdHIgdGltZXIsIHVpbnQzMl90IHRpbWUsIHZvaWQgKmFyZykKK3sKKyAgICBz
dHJ1Y3QgZHVtbXlfdmJsYW5rICp2YmxhbmssICp0bXA7CisgICAgc3RydWN0IGR1bW15X2NydGNf
c3RhdGUgKnN0YXRlOworICAgIHVpbnQ2NF90IHVzdCwgbXNjLCBuZXh0X3VzdDsKKyAgICB4Zjg2
Q3J0Y1JlYyAqeGY4Nl9jcnRjOworICAgIFJSQ3J0Y1JlYyAqY3J0YyA9IGFyZzsKKworICAgIHhm
ODZfY3J0YyA9IGNydGMtPmRldlByaXZhdGU7CisgICAgc3RhdGUgPSB4Zjg2X2NydGMtPmRyaXZl
cl9wcml2YXRlOworCisgICAgZHVtbXlfZ2V0X3VzdF9tc2MoY3J0YywgJnVzdCwgJm1zYyk7Cisg
ICAgeG9yZ19saXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodmJsYW5rLCB0bXAsICZzdGF0ZS0+dmJs
YW5rX3F1ZXVlLCBsaXN0KSB7CisgICAgICAgIGlmIChtc2MgPCB2YmxhbmstPnRhcmdldF9tc2Mp
CisgICAgICAgICAgICBjb250aW51ZTsKKworICAgICAgICBwcmVzZW50X2V2ZW50X25vdGlmeSh2
YmxhbmstPmV2ZW50X2lkLCB1c3QsIG1zYyk7CisgICAgICAgIHhvcmdfbGlzdF9kZWwoJnZibGFu
ay0+bGlzdCk7CisgICAgICAgIHhvcmdfbGlzdF9hZGQoJnZibGFuay0+bGlzdCwgJnN0YXRlLT52
YmxhbmtfZnJlZSk7CisgICAgfQorCisgICAgaWYgKCF4b3JnX2xpc3RfaXNfZW1wdHkoJnN0YXRl
LT52YmxhbmtfcXVldWUpKSB7CisgICAgICAgIG5leHRfdXN0ID0gZHVtbXlfcHJlc2VudF91c3Rf
Zm9yX21zYyhjcnRjLCBtc2MgKyAxKTsKKyAgICAgICAgVGltZXJTZXQoc3RhdGUtPnZibGFua190
aW1lciwgVGltZXJBYnNvbHV0ZSwgKG5leHRfdXN0IC8gMTAwMCkgKyAxLCBkdW1teV9kb190aW1l
ciwgYXJnKTsKKyAgICB9CisKKyAgICByZXR1cm4gMDsKK30KKwogc3RhdGljIGludAotZHVtbXlf
cHJlc2VudF9xdWV1ZV92YmxhbmsoUlJDcnRjUmVjICogY3J0YywgdWludDY0X3QgZXZlbnRfaWQs
IHVpbnQ2NF90IG1zYykKK2R1bW15X3ByZXNlbnRfcXVldWVfdmJsYW5rKFJSQ3J0Y1JlYyAqIGNy
dGMsIHVpbnQ2NF90IGV2ZW50X2lkLCB1aW50NjRfdCB0YXJnZXRfbXNjKQogewotICAgIHByZXNl
bnRfZXZlbnRfbm90aWZ5KGV2ZW50X2lkLCBkdW1teV9nZXR0aW1lX3VzKCksIG1zYyk7CisgICAg
c3RydWN0IGR1bW15X2NydGNfc3RhdGUgKnN0YXRlOworICAgIHVpbnQ2NF90IHVzdCwgdGFyZ2V0
X3VzdCwgbXNjOworICAgIHN0cnVjdCBkdW1teV92YmxhbmsgKnZibGFuazsKKyAgICB4Zjg2Q3J0
Y1JlYyAqeGY4Nl9jcnRjOworICAgIGJvb2wgc3RhcnQgPSBmYWxzZTsKKworICAgIHhmODZfY3J0
YyA9IGNydGMtPmRldlByaXZhdGU7CisgICAgc3RhdGUgPSB4Zjg2X2NydGMtPmRyaXZlcl9wcml2
YXRlOworCisgICAgZHVtbXlfZ2V0X3VzdF9tc2MoY3J0YywgJnVzdCwgJm1zYyk7CisgICAgaWYg
KCh0YXJnZXRfdXN0ID0gZHVtbXlfcHJlc2VudF91c3RfZm9yX21zYyhjcnRjLCB0YXJnZXRfbXNj
KSkgPD0gdXN0KQorICAgICAgICB0YXJnZXRfdXN0ID0gZHVtbXlfcHJlc2VudF91c3RfZm9yX21z
YyhjcnRjLCBtc2MgKyAxKTsKKworICAgIGlmICgheG9yZ19saXN0X2lzX2VtcHR5KCZzdGF0ZS0+
dmJsYW5rX2ZyZWUpKSB7CisgICAgICAgIHZibGFuayA9IHhvcmdfbGlzdF9maXJzdF9lbnRyeSgm
c3RhdGUtPnZibGFua19mcmVlLCBzdHJ1Y3QgZHVtbXlfdmJsYW5rLCBsaXN0KTsKKyAgICAgICAg
eG9yZ19saXN0X2RlbCgmdmJsYW5rLT5saXN0KTsKKyAgICB9IGVsc2UgaWYgKCEodmJsYW5rID0g
bWFsbG9jKHNpemVvZigqdmJsYW5rKSkpKSB7CisgICAgICAgIHJldHVybiBCYWRBbGxvYzsKKyAg
ICB9CisKKyAgICB2YmxhbmstPmV2ZW50X2lkID0gZXZlbnRfaWQ7CisgICAgdmJsYW5rLT50YXJn
ZXRfbXNjID0gdGFyZ2V0X21zYzsKKyAgICBpZiAoeG9yZ19saXN0X2lzX2VtcHR5KCZzdGF0ZS0+
dmJsYW5rX3F1ZXVlKSkKKyAgICAgICAgc3RhcnQgPSB0cnVlOworICAgIHhvcmdfbGlzdF9hcHBl
bmQoJnZibGFuay0+bGlzdCwgJnN0YXRlLT52YmxhbmtfcXVldWUpOworICAgIGlmIChzdGFydAor
ICAgICAgICAmJiAhKHN0YXRlLT52YmxhbmtfdGltZXIgPQorICAgICAgICAgICAgIFRpbWVyU2V0
KE5VTEwsIFRpbWVyQWJzb2x1dGUsICh0YXJnZXRfdXN0IC8gMTAwMCkgKyAxLCBkdW1teV9kb190
aW1lciwgY3J0YykpKSB7CisgICAgICAgIHhvcmdfbGlzdF9kZWwoJnZibGFuay0+bGlzdCk7Cisg
ICAgICAgIGZyZWUodmJsYW5rKTsKKyAgICAgICAgcmV0dXJuIEJhZEFsbG9jOworICAgIH0KIAog
ICAgIHJldHVybiBTdWNjZXNzOwogfQpAQCAtNTMsNiArMTM3LDIwIEBAIGR1bW15X3ByZXNlbnRf
cXVldWVfdmJsYW5rKFJSQ3J0Y1JlYyAqIGNydGMsIHVpbnQ2NF90IGV2ZW50X2lkLCB1aW50NjRf
dCBtc2MpCiBzdGF0aWMgdm9pZAogZHVtbXlfcHJlc2VudF9hYm9ydF92YmxhbmsoUlJDcnRjUmVj
ICogY3J0YywgdWludDY0X3QgZXZlbnRfaWQsIHVpbnQ2NF90IG1zYykKIHsKKyAgICBzdHJ1Y3Qg
ZHVtbXlfdmJsYW5rICp2YmxhbmssICp0bXA7CisgICAgc3RydWN0IGR1bW15X2NydGNfc3RhdGUg
KnN0YXRlOworICAgIHhmODZDcnRjUmVjICp4Zjg2X2NydGM7CisKKyAgICB4Zjg2X2NydGMgPSBj
cnRjLT5kZXZQcml2YXRlOworICAgIHN0YXRlID0geGY4Nl9jcnRjLT5kcml2ZXJfcHJpdmF0ZTsK
KworICAgIHhvcmdfbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHZibGFuaywgdG1wLCAmc3RhdGUt
PnZibGFua19xdWV1ZSwgbGlzdCkgeworICAgICAgICBpZiAodmJsYW5rLT5ldmVudF9pZCA9PSBl
dmVudF9pZCkgeworICAgICAgICAgICAgeG9yZ19saXN0X2RlbCgmdmJsYW5rLT5saXN0KTsKKyAg
ICAgICAgICAgIGZyZWUodmJsYW5rKTsKKyAgICAgICAgICAgIGJyZWFrOworICAgICAgICB9Cisg
ICAgfQogfQogCiBzdGF0aWMgdm9pZApAQCAtMTAwLDMgKzE5OCwyMCBAQCBkdW1teV9wcmVzZW50
X3NjcmVlbl9pbml0KFNjcmVlblJlYyAqIHNjcmVlbikKIAogICAgIHJldHVybiBwcmVzZW50X3Nj
cmVlbl9pbml0KHNjcmVlbiwgJnByZXNlbnRfc2NyZWVuX2luZm8pOwogfQorCit2b2lkCitkdW1t
eV9wcmVzZW50X2ZyZWVfdmJsYW5rcyh4Zjg2Q3J0Y1B0ciBjcnRjKQoreworICAgIHN0cnVjdCBk
dW1teV9jcnRjX3N0YXRlICpzdGF0ZTsKKyAgICBzdHJ1Y3QgZHVtbXlfdmJsYW5rICp2Ymxhbmss
ICp0bXA7CisgICAgc3RhdGUgPSBjcnRjLT5kcml2ZXJfcHJpdmF0ZTsKKyAgICB4b3JnX2xpc3Rf
Zm9yX2VhY2hfZW50cnlfc2FmZSh2YmxhbmssIHRtcCwgJnN0YXRlLT52YmxhbmtfcXVldWUsIGxp
c3QpIHsKKyAgICAgICAgeG9yZ19saXN0X2RlbCgmdmJsYW5rLT5saXN0KTsKKyAgICAgICAgZnJl
ZSh2YmxhbmspOworICAgIH0KKworICAgIHhvcmdfbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHZi
bGFuaywgdG1wLCAmc3RhdGUtPnZibGFua19mcmVlLCBsaXN0KSB7CisgICAgICAgIHhvcmdfbGlz
dF9kZWwoJnZibGFuay0+bGlzdCk7CisgICAgICAgIGZyZWUodmJsYW5rKTsKKyAgICB9Cit9CmRp
ZmYgLS1naXQgYS9zcGljZS12aWRlby1kdW1teS9zcmMvc3BpY2VkdW1teV9kcml2ZXIuYyBiL3Nw
aWNlLXZpZGVvLWR1bW15L3NyYy9zcGljZWR1bW15X2RyaXZlci5jCmluZGV4IDFlZmFlNDczLi4x
OGU5NmNlYyAxMDA2NDQKLS0tIGEvc3BpY2UtdmlkZW8tZHVtbXkvc3JjL3NwaWNlZHVtbXlfZHJp
dmVyLmMKKysrIGIvc3BpY2UtdmlkZW8tZHVtbXkvc3JjL3NwaWNlZHVtbXlfZHJpdmVyLmMKQEAg
LTQyOSw2ICs0MjksMTYgQEAgRFVNTVlQcmVJbml0KFNjcm5JbmZvUHRyIHBTY3JuLCBpbnQgZmxh
Z3MpCiAgICAgICAgIHhmODZEcnZNc2cocFNjcm4tPnNjcm5JbmRleCwgWF9QUk9CRUQsICJNYXgg
Q2xvY2s6ICVkIGtIelxuIiwgbWF4Q2xvY2spOwogICAgIH0KIAorICAgIC8qIEluaXRpYWxpemUg
YW4gb3V0cHV0IGFuZCBjcnRjICovCisgICAgY3J0Y19jb25maWdfaW5pdChwU2Nybik7CisgICAg
b3V0cHV0X3ByZV9pbml0KHBTY3JuKTsKKyAgICBjcnRjX2NyZWF0ZShwU2Nybik7CisKKyAgICAv
KiBJZiBtb25pdG9yIHJlc29sdXRpb24gaXMgc2V0IG9uIHRoZSBjb21tYW5kIGxpbmUsIHVzZSBp
dCAqLworICAgIHhmODZTZXREcGkocFNjcm4sIDAsIDApOworCisgICAgeGY4NkluaXRpYWxDb25m
aWd1cmF0aW9uKHBTY3JuLCBUUlVFKTsKKwogICAgIHBTY3JuLT5wcm9nQ2xvY2sgPSBUUlVFOwog
ICAgIC8qCiAgICAgICogU2V0dXAgdGhlIENsb2NrUmFuZ2VzLCB3aGljaCBkZXNjcmliZSB3aGF0
IGNsb2NrIHJhbmdlcyBhcmUgYXZhaWxhYmxlLApAQCAtNDQ0LDggKzQ1NCw2IEBAIERVTU1ZUHJl
SW5pdChTY3JuSW5mb1B0ciBwU2NybiwgaW50IGZsYWdzKQogICAgIGNsb2NrUmFuZ2VzLT5kb3Vi
bGVTY2FuQWxsb3dlZCA9IFRSVUU7CiAKICAgICAvKiBTdWJ0cmFjdCBtZW1vcnkgZm9yIEhXIGN1
cnNvciAqLwotCi0KICAgICB7CiAgICAgICAgIGludCBhcGVydHVyZVNpemUgPSAocFNjcm4tPnZp
ZGVvUmFtICogMTAyNCk7CiAgICAgICAgIGkgPSB4Zjg2VmFsaWRhdGVNb2RlcyhwU2NybiwgcFNj
cm4tPm1vbml0b3ItPk1vZGVzLApAQCAtNDY4LDM1ICs0NzYsMTYgQEAgRFVNTVlQcmVJbml0KFNj
cm5JbmZvUHRyIHBTY3JuLCBpbnQgZmxhZ3MpCiAgICAgICAgIFJFVFVSTjsKICAgICB9CiAKLSAg
ICAvKgotICAgICAqIFNldCB0aGUgQ1JUQyBwYXJhbWV0ZXJzIGZvciBhbGwgb2YgdGhlIG1vZGVz
IGJhc2VkIG9uIHRoZSB0eXBlCi0gICAgICogb2YgbW9kZSwgYW5kIHRoZSBjaGlwc2V0J3MgaW50
ZXJsYWNlIHJlcXVpcmVtZW50cy4KLSAgICAgKgotICAgICAqIENhbGxpbmcgdGhpcyBpcyByZXF1
aXJlZCBpZiB0aGUgbW9kZS0+Q3J0YyogdmFsdWVzIGFyZSB1c2VkIGJ5IHRoZQotICAgICAqIGRy
aXZlciBhbmQgaWYgdGhlIGRyaXZlciBkb2Vzbid0IHByb3ZpZGUgY29kZSB0byBzZXQgdGhlbS4g
IFRoZXkKLSAgICAgKiBhcmUgbm90IHByZS1pbml0aWFsaXNlZCBhdCBhbGwuCi0gICAgICovCi0g
ICAgeGY4NlNldENydGNGb3JNb2RlcyhwU2NybiwgMCk7Ci0KICAgICAvKiBTZXQgdGhlIGN1cnJl
bnQgbW9kZSB0byB0aGUgZmlyc3QgaW4gdGhlIGxpc3QgKi8KICAgICBwU2Nybi0+Y3VycmVudE1v
ZGUgPSBwU2Nybi0+bW9kZXM7CiAKICAgICAvKiBQcmludCB0aGUgbGlzdCBvZiBtb2RlcyBiZWlu
ZyB1c2VkICovCiAgICAgeGY4NlByaW50TW9kZXMocFNjcm4pOwogCi0gICAgLyogSWYgbW9uaXRv
ciByZXNvbHV0aW9uIGlzIHNldCBvbiB0aGUgY29tbWFuZCBsaW5lLCB1c2UgaXQgKi8KLSAgICB4
Zjg2U2V0RHBpKHBTY3JuLCAwLCAwKTsKLQogICAgIGlmICh4Zjg2TG9hZFN1Yk1vZHVsZShwU2Ny
biwgImZiIikgPT0gTlVMTCkgewogICAgICAgICBSRVRVUk47CiAgICAgfQogCi0gICAgaWYgKCFk
UHRyLT5zd0N1cnNvcikgewotICAgICAgICBpZiAoIXhmODZMb2FkU3ViTW9kdWxlKHBTY3JuLCAi
cmFtZGFjIikpIHsKLSAgICAgICAgICAgIFJFVFVSTjsKLSAgICAgICAgfQotICAgIH0KLQogICAg
IC8qIFdlIGhhdmUgbm8gY29udGlndW91cyBwaHlzaWNhbCBmYiBpbiBwaHlzaWNhbCBtZW1vcnkg
Ki8KICAgICBwU2Nybi0+bWVtUGh5c0Jhc2UgPSAwOwogICAgIHBTY3JuLT5mYk9mZnNldCA9IDA7
CkBAIC02MzEsNiArNjIwLDkgQEAgRFVNTVlTY3JlZW5Jbml0KFNDUkVFTl9JTklUX0FSR1NfREVD
TCkKICAgICAvKiBtdXN0IGJlIGFmdGVyIFJHQiBvcmRlcmluZyBmaXhlZCAqLwogICAgIGZiUGlj
dHVyZUluaXQocFNjcmVlbiwgMCwgMCk7CiAKKyAgICBpZiAoIXhmODZDcnRjU2NyZWVuSW5pdChw
U2NyZWVuKSkKKyAgICAgICAgcmV0dXJuIEZBTFNFOworCiAgICAgaWYgKGRQdHItPmdsYW1vciAm
JiAhZ2xhbW9yX2luaXQocFNjcmVlbiwgZ2xhbW9yX2ZsYWdzKSkgewogICAgICAgICB4Zjg2RHJ2
TXNnKHBTY3JuLT5zY3JuSW5kZXgsIFhfRVJST1IsCiAgICAgICAgICAgICAgICAgICAgIkZhaWxl
ZCB0byBpbml0aWFsaXNlIGdsYW1vciBhdCBTY3JlZW5Jbml0KCkgdGltZS5cbiIpOwpAQCAtNjM5
LDEzICs2MzEsNyBAQCBEVU1NWVNjcmVlbkluaXQoU0NSRUVOX0lOSVRfQVJHU19ERUNMKQogCiAg
ICAgeGY4NlNldEJsYWNrV2hpdGVQaXhlbHMocFNjcmVlbik7CiAKLSAgICBpZiAoZFB0ci0+c3dD
dXJzb3IpIHsKLSAgICAgICAgeGY4NkRydk1zZyhwU2Nybi0+c2NybkluZGV4LCBYX0NPTkZJRywg
IlVzaW5nIFNvZnR3YXJlIEN1cnNvci5cbiIpOwotICAgIH0KLQogICAgIHsKLQotCiAgICAgICAg
IEJveFJlYyBBdmFpbEZCQXJlYTsKICAgICAgICAgaW50IGxpbmVzID0gcFNjcm4tPnZpZGVvUmFt
ICogMTAyNCAvIChwU2Nybi0+ZGlzcGxheVdpZHRoICogKHBTY3JuLT5iaXRzUGVyUGl4ZWwgPj4g
MykpOwogICAgICAgICBBdmFpbEZCQXJlYS54MSA9IDA7CkBAIC02NjMsMTUgKzY0OSwxMCBAQCBE
VU1NWVNjcmVlbkluaXQoU0NSRUVOX0lOSVRfQVJHU19ERUNMKQogCiAgICAgLyogSW5pdGlhbGlz
ZSBjdXJzb3IgZnVuY3Rpb25zICovCiAgICAgbWlEQ0luaXRpYWxpemUocFNjcmVlbiwgeGY4Nkdl
dFBvaW50ZXJTY3JlZW5GdW5jcygpKTsKLQotCi0gICAgaWYgKCFkUHRyLT5zd0N1cnNvcikgewot
ICAgICAgICAvKiBIVyBjdXJzb3IgZnVuY3Rpb25zICovCi0gICAgICAgIGlmICghRFVNTVlDdXJz
b3JJbml0KHBTY3JlZW4pKSB7Ci0gICAgICAgICAgICB4Zjg2RHJ2TXNnKHBTY3JuLT5zY3JuSW5k
ZXgsIFhfRVJST1IsICJIYXJkd2FyZSBjdXJzb3IgaW5pdGlhbGl6YXRpb24gZmFpbGVkXG4iKTsK
LSAgICAgICAgICAgIHJldHVybiBGQUxTRTsKLSAgICAgICAgfQotICAgIH0KKyAgICBpZiAoIWRQ
dHItPnN3Q3Vyc29yKQorICAgICAgICB4Zjg2X2N1cnNvcnNfaW5pdChwU2NyZWVuLCA2NCwgNjQs
IEhBUkRXQVJFX0NVUlNPUl9VUERBVEVfVU5ISURERU4gfCBIQVJEV0FSRV9DVVJTT1JfQVJHQik7
CisgICAgZWxzZQorICAgICAgICB4Zjg2RHJ2TXNnKHBTY3JuLT5zY3JuSW5kZXgsIFhfQ09ORklH
LCAiVXNpbmcgU29mdHdhcmUgQ3Vyc29yLlxuIik7CiAKICAgICAvKiBJbml0aWFsaXNlIGRlZmF1
bHQgY29sb3VybWFwICovCiAgICAgaWYgKCFtaUNyZWF0ZURlZkNvbG9ybWFwKHBTY3JlZW4pKSB7
Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9zcGlj
ZS1kZXZlbA==
