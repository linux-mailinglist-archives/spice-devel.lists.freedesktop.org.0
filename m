Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A44A5D0AFD
	for <lists+spice-devel@lfdr.de>; Wed,  9 Oct 2019 11:23:24 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2E7846E947;
	Wed,  9 Oct 2019 09:23:23 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2344E6E945
 for <spice-devel@lists.freedesktop.org>; Wed,  9 Oct 2019 09:23:22 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx03.intmail.prod.int.phx2.redhat.com
 [10.5.11.13])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id C04E818C427F
 for <spice-devel@lists.freedesktop.org>; Wed,  9 Oct 2019 09:23:21 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.15])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 34FE86061E;
 Wed,  9 Oct 2019 09:23:20 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Wed,  9 Oct 2019 10:23:02 +0100
Message-Id: <20191009092302.15025-6-fziglio@redhat.com>
In-Reply-To: <20191009092302.15025-1-fziglio@redhat.com>
References: <20191009092302.15025-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.13
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.6.2
 (mx1.redhat.com [10.5.110.62]); Wed, 09 Oct 2019 09:23:21 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-server v3 5/5] test-smardcard: Improve
 test coverage
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

VXNpbmcgY292ZXJhZ2UgdXRpbGl0eSBleGVyY2lzZSBtb3JlIGNvZGUgcGF0aHM6Ci0gbWVzc2Fn
ZSBmcm9tIGNoYW5uZWwgd2l0aCB3cm9uZyB0eXBlOwotIHJlbW92ZSBtZXNzYWdlIGZyb20gY2hh
bm5lbCB3aXRoIGFscmVhZHkgcmVtb3ZlZCByZWFkZXI7Ci0gaW5pdCBtZXNzYWdlIGZyb20gY2hh
bm5lbCAoaWdub3JlZCk7Ci0gZGF0YSBmcm9tIGRldmljZXMsIEFEUFU7Ci0gZXJyb3IgZnJvbSBk
ZXZpY2U7Ci0gbWVzc2FnZXMgc3BsaXQgaW4gZGlmZmVyZW50IHdheXM7Ci0gaW52YWxpZCByZWFk
ZXJfaWQgdmFsdWVzLgoKU2lnbmVkLW9mZi1ieTogRnJlZGlhbm8gWmlnbGlvIDxmemlnbGlvQHJl
ZGhhdC5jb20+CkFja2VkLWJ5OiBWaWN0b3IgVG9zbyA8dmljdG9ydG9zb0ByZWRoYXQuY29tPgot
LS0KIHNlcnZlci90ZXN0cy90ZXN0LXNtYXJ0Y2FyZC5jIHwgMjA4ICsrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKy0tLS0KIHNlcnZlci90ZXN0cy92bWMtZW11LmMgICAgICAgIHwgICAzICsK
IHNlcnZlci90ZXN0cy92bWMtZW11LmggICAgICAgIHwgICAzICsKIDMgZmlsZXMgY2hhbmdlZCwg
MTk0IGluc2VydGlvbnMoKyksIDIwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3NlcnZlci90
ZXN0cy90ZXN0LXNtYXJ0Y2FyZC5jIGIvc2VydmVyL3Rlc3RzL3Rlc3Qtc21hcnRjYXJkLmMKaW5k
ZXggYWFjMmU3OTQxLi5jMWU0Nzg2ZGEgMTAwNjQ0Ci0tLSBhL3NlcnZlci90ZXN0cy90ZXN0LXNt
YXJ0Y2FyZC5jCisrKyBiL3NlcnZlci90ZXN0cy90ZXN0LXNtYXJ0Y2FyZC5jCkBAIC00MSw2ICs0
MSwxNSBAQCBzdGF0aWMgU3BpY2VDb3JlSW50ZXJmYWNlICpjb3JlOwogc3RhdGljIFRlc3QgKnRl
c3Q7CiBzdGF0aWMgVm1jRW11ICp2bWM7CiB0eXBlZGVmIGludCBUZXN0Rml4dHVyZTsKK3N0YXRp
YyBpbnQgY2xpZW50X3NvY2tldCA9IC0xOworLy8gYnVmZmVyIHdoZW4gZGF0YSBmcm9tIGNoYW5u
ZWwgYXJlIHN0b3JlZAorc3RhdGljIFNwaWNlQnVmZmVyIGNoYW5uZWxfYnVmOworLy8gZXhwZWN0
ZWQgYnVmZmVyIGluIGNoYW5uZWwKK3N0YXRpYyBTcGljZUJ1ZmZlciBjaGFubmVsX2V4cGVjdGVk
OworLy8gZXhwZWN0ZWQgYnVmZmVyIGluIGRldmljZQorc3RhdGljIFNwaWNlQnVmZmVyIGRldmlj
ZV9leHBlY3RlZDsKKworc3RhdGljIHZvaWQgbmV4dF90ZXN0KHZvaWQpOwogCiBzdGF0aWMgdm9p
ZCB0ZXN0X3NtYXJ0Y2FyZF9zZXR1cChUZXN0Rml4dHVyZSAqZml4dHVyZSwgZ2NvbnN0cG9pbnRl
ciB1c2VyX2RhdGEpCiB7CkBAIC0xMDEsNyArMTEwLDcgQEAgc3RhdGljIHZvaWQgc2VuZF9hY2tf
c3luYyhpbnQgc29ja2V0LCB1aW50MzJfdCBnZW5lcmF0aW9uKQogICAgIGdfYXNzZXJ0X2NtcGlu
dChzb2NrZXRfd3JpdGUoc29ja2V0LCAmbXNnLnR5cGUsIDEwKSwgPT0sIDEwKTsKIH0KIAotc3Rh
dGljIHZvaWQgc2VuZF9kYXRhKGludCBzb2NrZXQsIHVpbnQzMl90IHR5cGUpCitzdGF0aWMgdm9p
ZCBzZW5kX2RhdGEoaW50IHNvY2tldCwgdWludDMyX3QgdHlwZSwgdWludDMyX3QgcmVhZGVyX2lk
KQogewogICAgIHN0cnVjdCB7CiAgICAgICAgIHVpbnQxNl90IGR1bW15OwpAQCAtMTE0LDI0ICsx
MjMsMTg0IEBAIHN0YXRpYyB2b2lkIHNlbmRfZGF0YShpbnQgc29ja2V0LCB1aW50MzJfdCB0eXBl
KQogICAgIG1zZy50eXBlID0gR1VJTlQxNl9UT19MRShTUElDRV9NU0dDX1NNQVJUQ0FSRF9EQVRB
KTsKICAgICBtc2cubGVuID0gR1VJTlQzMl9UT19MRShzaXplb2YoVlNDTXNnSGVhZGVyKSs2KTsK
ICAgICBtc2cudmhlYWRlci50eXBlID0gR1VJTlQzMl9UT19MRSh0eXBlKTsKLSAgICBtc2cudmhl
YWRlci5yZWFkZXJfaWQgPSAwOworICAgIG1zZy52aGVhZGVyLnJlYWRlcl9pZCA9IEdVSU5UMzJf
VE9fTEUocmVhZGVyX2lkKTsKICAgICBtc2cudmhlYWRlci5sZW5ndGggPSBHVUlOVDMyX1RPX0xF
KDYpOwogICAgIHN0cmNweShtc2cuZGF0YSwgImhlbGxvIik7CiAKICAgICBnX2Fzc2VydF9jbXBp
bnQoc29ja2V0X3dyaXRlKHNvY2tldCwgJm1zZy50eXBlLCBzaXplb2YobXNnKS00KSwgPT0sIHNp
emVvZihtc2cpLTQpOwogfQogCi1zdGF0aWMgdm9pZCBjaGVja19kYXRhKHZvaWQgKm9wYXF1ZSkK
K3N0YXRpYyB2b2lkIGNoZWNrX2RhdGEoVm1jRW11ICp2bWMpCit7CisgICAgZ19hc3NlcnRfY21w
aW50KGRldmljZV9leHBlY3RlZC5vZmZzZXQsICE9LCAwKTsKKyAgICBpZiAodm1jLT53cml0ZV9w
b3MgPCBkZXZpY2VfZXhwZWN0ZWQub2Zmc2V0KSB7CisgICAgICAgIHJldHVybjsKKyAgICB9Cisg
ICAgZ19hc3NlcnRfY21waW50KHZtYy0+d3JpdGVfcG9zLCA9PSwgZGV2aWNlX2V4cGVjdGVkLm9m
ZnNldCk7CisgICAgZ19hc3NlcnRfdHJ1ZShtZW1jbXAodm1jLT53cml0ZV9idWYsIGRldmljZV9l
eHBlY3RlZC5idWZmZXIsIGRldmljZV9leHBlY3RlZC5vZmZzZXQpID09IDApOworICAgIHZtYy0+
d3JpdGVfcG9zID0gMDsKKworICAgIG5leHRfdGVzdCgpOworfQorCitzdGF0aWMgdm9pZCBkYXRh
X2Zyb21fY2hhbm5lbChpbnQgZmQsIGludCBldmVudCwgdm9pZCAqb3BhcXVlKQoreworICAgIHVp
bnQ4X3QgYnVmWzEyOF07CisgICAgc3NpemVfdCByZXQgPSBzb2NrZXRfcmVhZChmZCwgYnVmLCBz
aXplb2YoYnVmKSk7CisgICAgaWYgKHJldCA8PSAwKSB7CisgICAgICAgIHJldHVybjsKKyAgICB9
CisgICAgc3BpY2VfYnVmZmVyX2FwcGVuZCgmY2hhbm5lbF9idWYsIGJ1ZiwgcmV0KTsKKworICAg
IGdfYXNzZXJ0X2NtcGludChjaGFubmVsX2V4cGVjdGVkLm9mZnNldCwgIT0sIDApOworICAgIGlm
IChjaGFubmVsX2J1Zi5vZmZzZXQgPCBjaGFubmVsX2V4cGVjdGVkLm9mZnNldCkgeworICAgICAg
ICByZXR1cm47CisgICAgfQorICAgIGdfYXNzZXJ0X3RydWUobWVtY21wKGNoYW5uZWxfYnVmLmJ1
ZmZlciwgY2hhbm5lbF9leHBlY3RlZC5idWZmZXIsIGNoYW5uZWxfZXhwZWN0ZWQub2Zmc2V0KSA9
PSAwKTsKKyAgICBzcGljZV9idWZmZXJfcmVtb3ZlKCZjaGFubmVsX2J1ZiwgY2hhbm5lbF9leHBl
Y3RlZC5vZmZzZXQpOworCisgICAgbmV4dF90ZXN0KCk7Cit9CisKK3N0YXRpYyB2b2lkIG5leHRf
dGVzdCh2b2lkKQogewotICAgIHN0YXRpYyBjb25zdCBjaGFyIGV4cGVjdGVkX2J1ZltdID0KLSAg
ICAgICAgLy8gZm9yd2FyZGVkIFJlYWRlckFkZCBtZXNzYWdlLCBub3RlIHRoYXQgcGF5bG9hZCBp
cyBzdHJpcHBlZAotICAgICAgICAiXHgwMFx4MDBceDAwXHgwM1x4MDBceDAwXHgwMFx4MDBceDAw
XHgwMFx4MDBceDAwIgotICAgICAgICAvLyBmb3J3YXJkZWQgQVBEVSBtZXNzYWdlCi0gICAgICAg
ICJceDAwXHgwMFx4MDBceDA3XHgwMFx4MDBceDAwXHgwMFx4MDBceDAwXHgwMFx4MDZceDY4XHg2
NVx4NmNceDZjXHg2Zlx4MDAiOwotICAgIGNvbnN0IHNpemVfdCBleHBlY3RlZF9idWZfbGVuID0g
c2l6ZW9mKGV4cGVjdGVkX2J1ZikgLSAxOwotICAgIGdfYXNzZXJ0X2NtcGludCh2bWMtPndyaXRl
X3BvcywgPT0sIGV4cGVjdGVkX2J1Zl9sZW4pOwotICAgIGdfYXNzZXJ0X3RydWUobWVtY21wKHZt
Yy0+d3JpdGVfYnVmLCBleHBlY3RlZF9idWYsIGV4cGVjdGVkX2J1Zl9sZW4pID09IDApOwotICAg
IGJhc2ljX2V2ZW50X2xvb3BfcXVpdCgpOworICAgIHN0YXRpYyBpbnQgdGVzdF9udW07CisKKyAg
ICB0ZXN0X251bSsrOworICAgIHByaW50ZigiRXhlY3V0aW5nIHN1YnRlc3QgJWRcbiIsIHRlc3Rf
bnVtKTsKKworICAgIHNwaWNlX2J1ZmZlcl9yZXNldCgmY2hhbm5lbF9leHBlY3RlZCk7CisgICAg
c3BpY2VfYnVmZmVyX3Jlc2V0KCZkZXZpY2VfZXhwZWN0ZWQpOworCisgICAgc3dpdGNoICh0ZXN0
X251bSkgeworICAgIC8vIEZpcnN0IHRlc3QsIHNlbmQgc29tZSBtZXNzYWdlIHRvIGNoYW5uZWwg
ZXhwZWN0aW5nIGEgcmVwbHkKKyAgICAvLyBmb3IgZWFjaCBtZXNzYWdlIHdlIGFyZSBzZW5kaW5n
CisgICAgY2FzZSAxOiB7CisgICAgICAgIHN0YXRpYyBjb25zdCBjaGFyIGV4cGVjdGVkX2J1Zltd
ID0KKyAgICAgICAgICAgIC8vIGZvcndhcmRlZCBSZWFkZXJBZGQgbWVzc2FnZSwgbm90ZSB0aGF0
IHBheWxvYWQgaXMgc3RyaXBwZWQKKyAgICAgICAgICAgICJceDAwXHgwMFx4MDBceDAzXHgwMFx4
MDBceDAwXHgwMFx4MDBceDAwXHgwMFx4MDAiCisgICAgICAgICAgICAvLyBmb3J3YXJkZWQgQVBE
VSBtZXNzYWdlCisgICAgICAgICAgICAiXHgwMFx4MDBceDAwXHgwN1x4MDBceDAwXHgwMFx4MDBc
eDAwXHgwMFx4MDBceDA2XHg2OFx4NjVceDZjXHg2Y1x4NmZceDAwIgorICAgICAgICAgICAgIlx4
MDBceDAwXHgwMFx4MDRceDAwXHgwMFx4MDBceDAwXHgwMFx4MDBceDAwXHgwMCI7CisgICAgICAg
IHNwaWNlX2J1ZmZlcl9hcHBlbmQoJmRldmljZV9leHBlY3RlZCwgZXhwZWN0ZWRfYnVmLCBzaXpl
b2YoZXhwZWN0ZWRfYnVmKSAtIDEpOworCisgICAgICAgIHNlbmRfZGF0YShjbGllbnRfc29ja2V0
LCBWU0NfUmVhZGVyQWRkLCAwKTsKKyAgICAgICAgc2VuZF9kYXRhKGNsaWVudF9zb2NrZXQsIFZT
Q19BUERVLCAwKTsKKyAgICAgICAgc2VuZF9kYXRhKGNsaWVudF9zb2NrZXQsIFZTQ19SZWFkZXJS
ZW1vdmUsIDApOworICAgICAgICB9IGJyZWFrOworICAgIC8vIFNlY29uZCB0ZXN0LCBzZW5kIGFu
IGluaXQgYW5kIHJlbW92ZSBhIHJlYWRlciB0aGF0IGlzIG5vdCBwcmVzZW50LAorICAgIC8vIHdl
IGV4cGVjdCBhbiBlcnJvciBmb3IgdGhlIHJlbW92YWwgKHRoZSBJbml0IGlzIGlnbm9yZWQpCisg
ICAgY2FzZSAyOiB7CisgICAgICAgIHN0YXRpYyBjb25zdCBjaGFyIGV4cGVjdGVkX2J1ZltdID0K
KyAgICAgICAgICAgIC8vIGZvcndhcmRlZCBFcnJvciBtZXNzYWdlCisgICAgICAgICAgICAiXHg2
NVx4MDBceDEwXHgwMFx4MDBceDAwIgorICAgICAgICAgICAgIlx4MDJceDAwXHgwMFx4MDBceDAw
XHgwMFx4MDBceDAwXHgwNFx4MDBceDAwXHgwMFx4MDFceDAwXHgwMFx4MDAiOworICAgICAgICBz
cGljZV9idWZmZXJfYXBwZW5kKCZjaGFubmVsX2V4cGVjdGVkLCBleHBlY3RlZF9idWYsIHNpemVv
ZihleHBlY3RlZF9idWYpIC0gMSk7CisKKyAgICAgICAgLy8gSW5pdCBtZXNzYWdlLCBpZ25vcmVk
CisgICAgICAgIHNlbmRfZGF0YShjbGllbnRfc29ja2V0LCBWU0NfSW5pdCwgMCk7CisgICAgICAg
IC8vIHJlbW92ZSBhZ2FpbiwgdGhpcyB3aWxsIHRyaWdnZXIgYW4gZXJyb3IKKyAgICAgICAgc2Vu
ZF9kYXRhKGNsaWVudF9zb2NrZXQsIFZTQ19SZWFkZXJSZW1vdmUsIDApOworICAgICAgICB9IGJy
ZWFrOworICAgIC8vIFRoaXJkIHRlc3QsIEFQRFUgbWVzc2FnZXMgZnJvbSBkZXZpY2UgYXJlIGZv
cndhcmRlZCB0byB0aGUgY2hhbm5lbC4KKyAgICAvLyBXZSBzcGxpdCB0aGUgaGVhZGVyIGFuZCBw
YXlsb2FkIG9mIHRoZSBmaXJzdCBtZXNzYWdlIHRvIGNoZWNrIGRldmljZSBjb2RlIGNhbiBoYW5k
bGUgaXQuCisgICAgLy8gVGhlIHNlY29uZCBtZXNzYWdlIGlzIHNlbmQgaW5zaWRlIGEgYmxvY2sg
d2l0aCB0aGUgZW5kIG9mIHRoZSBmaXJzdCB0byB0cmlnZ2VyCisgICAgLy8gYW4gaGFyZCBwYXRo
IGluIHRoZSBkZXZpY2UgY29kZQorICAgIGNhc2UgMzogeworICAgICAgICBzdGF0aWMgY29uc3Qg
Y2hhciBleHBlY3RlZF9idWZbXSA9CisgICAgICAgICAgICAvLyBmb3J3YXJkZWQgQVBEVSBtZXNz
YWdlCisgICAgICAgICAgICAiXHg2NVx4MDBceDEyXHgwMFx4MDBceDAwIgorICAgICAgICAgICAg
Ilx4MDdceDAwXHgwMFx4MDBceDAwXHgwMFx4MDBceDAwXHgwNlx4MDBceDAwXHgwMCIgImZvb2Jh
eiIKKyAgICAgICAgICAgICJceDY1XHgwMFx4MTJceDAwXHgwMFx4MDAiCisgICAgICAgICAgICAi
XHgwN1x4MDBceDAwXHgwMFx4MDBceDAwXHgwMFx4MDBceDA2XHgwMFx4MDBceDAwIiAiZm9vYmFy
IjsKKyAgICAgICAgc3BpY2VfYnVmZmVyX2FwcGVuZCgmY2hhbm5lbF9leHBlY3RlZCwgZXhwZWN0
ZWRfYnVmLCBzaXplb2YoZXhwZWN0ZWRfYnVmKSAtIDEpOworCisgICAgICAgIHZtY19lbXVfcmVz
ZXQodm1jKTsKKyAgICAgICAgLy8gZGF0YSBmcm9tIGRldmljZQorICAgICAgICB1aW50OF90ICpw
ID0gdm1jLT5tZXNzYWdlOworCisgICAgICAgIC8vIGFkZCBWU0NfQVBEVSBtZXNzYWdlCisgICAg
ICAgIG1lbWNweShwLCAiXHgwMFx4MDBceDAwXHgwN1x4MDBceDAwXHgwMFx4MDBceDAwXHgwMFx4
MDBceDA2IiAiZm9vYmF6IiwgMTgpOworICAgICAgICBwICs9IDE4OworICAgICAgICBtZW1jcHko
cCwgIlx4MDBceDAwXHgwMFx4MDdceDAwXHgwMFx4MDBceDAwXHgwMFx4MDBceDAwXHgwNiIgImZv
b2JhciIsIDE4KTsKKyAgICAgICAgcCArPSAxODsKKyAgICAgICAgdm1jX2VtdV9hZGRfcmVhZF90
aWxsKHZtYywgdm1jLT5tZXNzYWdlICsgOCk7CisgICAgICAgIHZtY19lbXVfYWRkX3JlYWRfdGls
bCh2bWMsIHZtYy0+bWVzc2FnZSArIDE0KTsKKyAgICAgICAgdm1jX2VtdV9hZGRfcmVhZF90aWxs
KHZtYywgcCk7CisKKyAgICAgICAgc3BpY2Vfc2VydmVyX2NoYXJfZGV2aWNlX3dha2V1cCgmdm1j
LT5pbnN0YW5jZSk7CisgICAgICAgIH0gYnJlYWs7CisgICAgLy8gRm91cnRoIHRlc3QsIHdlIHNo
b3VsZCBnZXQgYmFjayBhbiBlcnJvciBpZiBjbGllbnQgdHJpZWQgdG8gcmVtb3ZlCisgICAgLy8g
YSBub3QgZXhpc3RpbmcgcmVhZGVyCisgICAgY2FzZSA0OiB7CisgICAgICAgIHN0YXRpYyBjb25z
dCBjaGFyIGV4cGVjdGVkX2J1ZltdID0KKyAgICAgICAgICAgIC8vIGZvcndhcmRlZCBFcnJvciBt
ZXNzYWdlCisgICAgICAgICAgICAiXHg2NVx4MDBceDEwXHgwMFx4MDBceDAwIgorICAgICAgICAg
ICAgIlx4MDJceDAwXHgwMFx4MDBceDA1XHgwMFx4MDBceDAwXHgwNFx4MDBceDAwXHgwMFx4MDFc
eDAwXHgwMFx4MDAiOworICAgICAgICBzcGljZV9idWZmZXJfYXBwZW5kKCZjaGFubmVsX2V4cGVj
dGVkLCBleHBlY3RlZF9idWYsIHNpemVvZihleHBlY3RlZF9idWYpIC0gMSk7CisKKyAgICAgICAg
Ly8gcmVtb3ZlIGludmFsaWQsIHRoaXMgd2lsbCB0cmlnZ2VyIGFuIGVycm9yCisgICAgICAgIHNl
bmRfZGF0YShjbGllbnRfc29ja2V0LCBWU0NfUmVhZGVyUmVtb3ZlLCA1KTsKKyAgICAgICAgfSBi
cmVhazsKKyAgICAvLyBGaWZ0aCB0ZXN0LCBzaW1pbGFyIHRvIHByZXZpb3VzIGJ1dCB1c2luZyBh
biBodWdlIHJlYWRlcl9pZCBmaWVsZCB0byB0cmlnZ2VyCisgICAgLy8gcG9zc2libGUgYnVmZmVy
IG92ZXJmbG93CisgICAgY2FzZSA1OiB7CisgICAgICAgIHN0YXRpYyBjb25zdCBjaGFyIGV4cGVj
dGVkX2J1ZltdID0KKyAgICAgICAgICAgIC8vIGZvcndhcmRlZCBFcnJvciBtZXNzYWdlCisgICAg
ICAgICAgICAiXHg2NVx4MDBceDEwXHgwMFx4MDBceDAwIgorICAgICAgICAgICAgIlx4MDJceDAw
XHgwMFx4MDBceDA1XHgwMVx4MDBceDAwXHgwNFx4MDBceDAwXHgwMFx4MDFceDAwXHgwMFx4MDAi
OworICAgICAgICBzcGljZV9idWZmZXJfYXBwZW5kKCZjaGFubmVsX2V4cGVjdGVkLCBleHBlY3Rl
ZF9idWYsIHNpemVvZihleHBlY3RlZF9idWYpIC0gMSk7CisKKyAgICAgICAgLy8gcmVtb3ZlIGlu
dmFsaWQgYW5kIGh1Z2UsIHRoaXMgd2lsbCB0cmlnZ2VyIGFuIGVycm9yLCBzaG91bGQgbm90IGNy
YXNoCisgICAgICAgIHNlbmRfZGF0YShjbGllbnRfc29ja2V0LCBWU0NfUmVhZGVyUmVtb3ZlLCAy
NjEpOworICAgICAgICB9IGJyZWFrOworICAgIC8vIFNpeHRoIHRlc3QsIHNlbmQgYW4gaW52YWxp
ZCBtZXNzYWdlIGZyb20gY2xpZW50LCBhIGxvZyBpcyB0cmlnZ2VyZWQKKyAgICAvLyBidXQgY2hh
bm5lbCBjb250aW51ZXMgdG8gd29yaworICAgIGNhc2UgNjogeworICAgICAgICBzdGF0aWMgY29u
c3QgY2hhciBleHBlY3RlZF9idWZbXSA9CisgICAgICAgICAgICAvLyBmb3J3YXJkZWQgQVBEVSBt
ZXNzYWdlCisgICAgICAgICAgICAiXHgwMFx4MDBceDAwXHgwN1x4MDBceDAwXHgwMFx4MDBceDAw
XHgwMFx4MDBceDA2XHg2OFx4NjVceDZjXHg2Y1x4NmZceDAwIjsKKyAgICAgICAgc3BpY2VfYnVm
ZmVyX2FwcGVuZCgmZGV2aWNlX2V4cGVjdGVkLCBleHBlY3RlZF9idWYsIHNpemVvZihleHBlY3Rl
ZF9idWYpIC0gMSk7CisKKyAgICAgICAgZ190ZXN0X2V4cGVjdF9tZXNzYWdlKEdfTE9HX0RPTUFJ
TiwgR19MT0dfTEVWRUxfV0FSTklORywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIq
RVJST1I6IHVuZXhwZWN0ZWQgbWVzc2FnZSBvbiBzbWFydGNhcmQgY2hhbm5lbCoiKTsKKworICAg
ICAgICAvLyBpbnZhbGlkIG1lc3NhZ2UgdHlwZSwgc2hvdWxkIGxvZyBhIHdhcm5pbmcKKyAgICAg
ICAgc2VuZF9kYXRhKGNsaWVudF9zb2NrZXQsIDB4YWJjZCwgMCk7CisgICAgICAgIC8vIEFQRFUg
anVzdCB0byBnZXQgYW4gZXZlbnQKKyAgICAgICAgc2VuZF9kYXRhKGNsaWVudF9zb2NrZXQsIFZT
Q19BUERVLCAwKTsKKyAgICAgICAgfSBicmVhazsKKyAgICAvLyBTZXZlbnRoIHRlc3QsIGFuIEVy
cm9yIG1lc3NhZ2UgZnJvbSBkZXZpY2UgYXJlIGZvcndhcmRlZCB0byB0aGUgY2hhbm5lbC4KKyAg
ICAvLyBOb3RlIHRoYXQgdGhlIGhlYWRlciBpcyBpbiBiaWcgZW5kaWFuIG9yZGVyIHdoaWxlIHRo
ZSBlcnJvciBmcm9tIGRldmljZQorICAgIC8vIGlzIGluIGxpdHRsZSBlbmRpYW4gb3JkZXIuIFRo
aXMgc2VlbXMgd2VpcmQgYnV0IGl0J3MgY29ycmVjdCB3aXRoIHRoZQorICAgIC8vIGN1cnJlbnQg
bGliY2FjYXJkIGltcGxlbWVudGF0aW9uIHdoaWNoIGp1c3Qgc2VuZCBlcnJvciBhcyBob3N0IG9y
ZGVyCisgICAgY2FzZSA3OiB7CisgICAgICAgIGdfdGVzdF9hc3NlcnRfZXhwZWN0ZWRfbWVzc2Fn
ZXMoKTsKKworICAgICAgICBzdGF0aWMgY29uc3QgY2hhciBleHBlY3RlZF9idWZbXSA9CisgICAg
ICAgICAgICAvLyBmb3J3YXJkZWQgRXJyb3IgbWVzc2FnZQorICAgICAgICAgICAgIlx4NjVceDAw
XHgxMFx4MDBceDAwXHgwMCIKKyAgICAgICAgICAgICJceDAyXHgwMFx4MDBceDAwXHgwMFx4MDBc
eDAwXHgwMFx4MDRceDAwXHgwMFx4MDBceDBhXHgwYlx4MGNceDBkIjsKKyAgICAgICAgc3BpY2Vf
YnVmZmVyX2FwcGVuZCgmY2hhbm5lbF9leHBlY3RlZCwgZXhwZWN0ZWRfYnVmLCBzaXplb2YoZXhw
ZWN0ZWRfYnVmKSAtIDEpOworCisgICAgICAgIHZtY19lbXVfcmVzZXQodm1jKTsKKyAgICAgICAg
Ly8gZGF0YSBmcm9tIGRldmljZQorICAgICAgICB1aW50OF90ICpwID0gdm1jLT5tZXNzYWdlOwor
CisgICAgICAgIC8vIGFkZCBFcnJvciBtZXNzYWdlCisgICAgICAgIG1lbWNweShwLCAiXHgwMFx4
MDBceDAwXHgwMlx4MDBceDAwXHgwMFx4MDBceDAwXHgwMFx4MDBceDA0XHgwYVx4MGJceDBjXHgw
ZCIsIDE2KTsKKyAgICAgICAgcCArPSAxNjsKKyAgICAgICAgdm1jX2VtdV9hZGRfcmVhZF90aWxs
KHZtYywgcCk7CisKKyAgICAgICAgc3BpY2Vfc2VydmVyX2NoYXJfZGV2aWNlX3dha2V1cCgmdm1j
LT5pbnN0YW5jZSk7CisgICAgICAgIH0gYnJlYWs7CisgICAgY2FzZSA4OgorICAgICAgICBnX3Rl
c3RfYXNzZXJ0X2V4cGVjdGVkX21lc3NhZ2VzKCk7CisgICAgICAgIGJhc2ljX2V2ZW50X2xvb3Bf
cXVpdCgpOworICAgICAgICBicmVhazsKKyAgICBkZWZhdWx0OgorICAgICAgICBhYm9ydCgpOwor
ICAgIH0KIH0KIAogc3RhdGljIHZvaWQgdGVzdF9zbWFydGNhcmQoVGVzdEZpeHR1cmUgKmZpeHR1
cmUsIGdjb25zdHBvaW50ZXIgdXNlcl9kYXRhKQpAQCAtMTQ0LDYgKzMxMyw3IEBAIHN0YXRpYyB2
b2lkIHRlc3Rfc21hcnRjYXJkKFRlc3RGaXh0dXJlICpmaXh0dXJlLCBnY29uc3Rwb2ludGVyIHVz
ZXJfZGF0YSkKICAgICAvLyBhZGQgVlNDX0luaXQgbWVzc2FnZQogICAgIG1lbWNweShwLCAiXHgw
MFx4MDBceDAwXHgwMVx4MGFceDBiXHgwY1x4MGRceDAwXHgwMFx4MDBceDAwIiwgMTIpOwogICAg
IHAgKz0gMTI7CisgICAgdm1jX2VtdV9hZGRfcmVhZF90aWxsKHZtYywgdm1jLT5tZXNzYWdlICsg
Mik7IC8vIGNoZWNrIGhlYWRlciBpcyBkZWNvZGVkIGNvcnJlY3RseSB3aGVuIHNwbGl0CiAgICAg
dm1jX2VtdV9hZGRfcmVhZF90aWxsKHZtYywgcCk7CiAKICAgICAvLyBmaW5kIFNtYXJ0Y2FyZCBj
aGFubmVsIHRvIGNvbm5lY3QgdG8KQEAgLTE3MCw3ICszNDAsNiBAQCBzdGF0aWMgdm9pZCB0ZXN0
X3NtYXJ0Y2FyZChUZXN0Rml4dHVyZSAqZml4dHVyZSwgZ2NvbnN0cG9pbnRlciB1c2VyX2RhdGEp
CiAgICAgcmVkX2NsaWVudF9zZXRfbWFpbihjbGllbnQsIG1jYyk7CiAKICAgICAvLyBjcmVhdGUg
b3VyIHRlc3RpbmcgUmVkQ2hhbm5lbENsaWVudAotICAgIGludCBjbGllbnRfc29ja2V0OwogICAg
IHJlZF9jaGFubmVsX2Nvbm5lY3QoY2hhbm5lbCwgY2xpZW50LCBjcmVhdGVfZHVtbXlfc3RyZWFt
KHNlcnZlciwgJmNsaWVudF9zb2NrZXQpLAogICAgICAgICAgICAgICAgICAgICAgICAgRkFMU0Us
ICZjYXBzKTsKICAgICByZWRfY2hhbm5lbF9jYXBhYmlsaXRpZXNfcmVzZXQoJmNhcHMpOwpAQCAt
MTgwLDIxICszNDksMjAgQEAgc3RhdGljIHZvaWQgdGVzdF9zbWFydGNhcmQoVGVzdEZpeHR1cmUg
KmZpeHR1cmUsIGdjb25zdHBvaW50ZXIgdXNlcl9kYXRhKQogCiAgICAgLy8gcHVzaCBkYXRhIGlu
dG8gY2hhbm5lbAogICAgIHNlbmRfYWNrX3N5bmMoY2xpZW50X3NvY2tldCwgMSk7Ci0gICAgc2Vu
ZF9kYXRhKGNsaWVudF9zb2NrZXQsIFZTQ19SZWFkZXJBZGQpOwotICAgIHNlbmRfZGF0YShjbGll
bnRfc29ja2V0LCBWU0NfQVBEVSk7CiAKLSAgICAvLyBjaGVjayBkYXRhIGFyZSBwcm9jZXNzZWQg
YWZ0ZXIgYSBzaG9ydCB0aW1lCi0gICAgU3BpY2VUaW1lciAqd2F0Y2hfdGltZXI7Ci0gICAgd2F0
Y2hfdGltZXIgPSBjb3JlLT50aW1lcl9hZGQoY2hlY2tfZGF0YSwgY29yZSk7Ci0gICAgY29yZS0+
dGltZXJfc3RhcnQod2F0Y2hfdGltZXIsIDEwMCk7CisgICAgLy8gY2hlY2sgZGF0YSBhcmUgcHJv
Y2Vzc2VkCisgICAgU3BpY2VXYXRjaCAqd2F0Y2ggPSBjb3JlLT53YXRjaF9hZGQoY2xpZW50X3Nv
Y2tldCwgU1BJQ0VfV0FUQ0hfRVZFTlRfUkVBRCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBkYXRhX2Zyb21fY2hhbm5lbCwgTlVMTCk7CisgICAgdm1jLT5kYXRhX3dy
aXR0ZW5fY2IgPSBjaGVja19kYXRhOwogCiAgICAgLy8gc3RhcnQgYWxsIHRlc3QKICAgICBhbGFy
bSgxMCk7CisgICAgbmV4dF90ZXN0KCk7CiAgICAgYmFzaWNfZXZlbnRfbG9vcF9tYWlubG9vcCgp
OwogICAgIGFsYXJtKDApOwogCiAgICAgLy8gY2xlYW51cAotICAgIGNvcmUtPnRpbWVyX3JlbW92
ZSh3YXRjaF90aW1lcik7CisgICAgY29yZS0+d2F0Y2hfcmVtb3ZlKHdhdGNoKTsKICAgICByZWRf
Y2xpZW50X2Rlc3Ryb3koY2xpZW50KTsKICAgICBnX29iamVjdF91bnJlZihtYWluX2NoYW5uZWwp
OwogICAgIGdfb2JqZWN0X3VucmVmKGNoYW5uZWwpOwpkaWZmIC0tZ2l0IGEvc2VydmVyL3Rlc3Rz
L3ZtYy1lbXUuYyBiL3NlcnZlci90ZXN0cy92bWMtZW11LmMKaW5kZXggNDE4YTAyMTM5Li5mNjRk
ZGMzN2UgMTAwNjQ0Ci0tLSBhL3NlcnZlci90ZXN0cy92bWMtZW11LmMKKysrIGIvc2VydmVyL3Rl
c3RzL3ZtYy1lbXUuYwpAQCAtMzEsNiArMzEsOSBAQCBzdGF0aWMgaW50IHZtY193cml0ZShTcGlj
ZUNoYXJEZXZpY2VJbnN0YW5jZSAqc2luLAogICAgIHVuc2lnbmVkIGNvcHkgPSBNSU4oc2l6ZW9m
KHZtYy0+d3JpdGVfYnVmKSAtIHZtYy0+d3JpdGVfcG9zLCBsZW4pOwogICAgIG1lbWNweSh2bWMt
PndyaXRlX2J1Zit2bWMtPndyaXRlX3BvcywgYnVmLCBjb3B5KTsKICAgICB2bWMtPndyaXRlX3Bv
cyArPSBjb3B5OworICAgIGlmIChjb3B5ICYmIHZtYy0+ZGF0YV93cml0dGVuX2NiKSB7CisgICAg
ICAgIHZtYy0+ZGF0YV93cml0dGVuX2NiKHZtYyk7CisgICAgfQogICAgIHJldHVybiBsZW47CiB9
CiAKZGlmZiAtLWdpdCBhL3NlcnZlci90ZXN0cy92bWMtZW11LmggYi9zZXJ2ZXIvdGVzdHMvdm1j
LWVtdS5oCmluZGV4IDdjMjY5MzhlYi4uOTNjZGNjMTAyIDEwMDY0NAotLS0gYS9zZXJ2ZXIvdGVz
dHMvdm1jLWVtdS5oCisrKyBiL3NlcnZlci90ZXN0cy92bWMtZW11LmgKQEAgLTQwLDYgKzQwLDkg
QEAgc3RydWN0IFZtY0VtdSB7CiAKICAgICB1bnNpZ25lZCB3cml0ZV9wb3M7CiAgICAgdWludDhf
dCB3cml0ZV9idWZbMjA0OF07CisKKyAgICAvLyB0aGlzIGNhbGxiYWNrIHdpbGwgYmUgY2FsbGVk
IHdoZW4gbmV3IGRhdGEgYXJyaXZlIHRvIHRoZSBkZXZpY2UKKyAgICB2b2lkICgqZGF0YV93cml0
dGVuX2NiKShWbWNFbXUgKnZtYyk7CiB9OwogCiBWbWNFbXUgKnZtY19lbXVfbmV3KGNvbnN0IGNo
YXIgKnN1YnR5cGUsIGNvbnN0IGNoYXIgKnBvcnRuYW1lKTsKLS0gCjIuMjEuMAoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KU3BpY2UtZGV2ZWwgbWFpbGlu
ZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZy
ZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
