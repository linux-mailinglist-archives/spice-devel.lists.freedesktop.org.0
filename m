Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4A4728B7B7
	for <lists+spice-devel@lfdr.de>; Tue, 13 Aug 2019 13:59:06 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D92346E10D;
	Tue, 13 Aug 2019 11:59:04 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D8C346E10D
 for <spice-devel@lists.freedesktop.org>; Tue, 13 Aug 2019 11:59:03 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx02.intmail.prod.int.phx2.redhat.com
 [10.5.11.12])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 6D7ABC0094CA;
 Tue, 13 Aug 2019 11:59:03 +0000 (UTC)
Received: from colo-mx.corp.redhat.com
 (colo-mx02.intmail.prod.int.phx2.redhat.com [10.5.11.21])
 by smtp.corp.redhat.com (Postfix) with ESMTPS id 634F8891AB;
 Tue, 13 Aug 2019 11:59:03 +0000 (UTC)
Received: from zmail25.collab.prod.int.phx2.redhat.com
 (zmail25.collab.prod.int.phx2.redhat.com [10.5.83.31])
 by colo-mx.corp.redhat.com (Postfix) with ESMTP id 597602551B;
 Tue, 13 Aug 2019 11:59:03 +0000 (UTC)
Date: Tue, 13 Aug 2019 07:59:03 -0400 (EDT)
From: Frediano Ziglio <fziglio@redhat.com>
To: Yuri Benditovich <yuri.benditovich@daynix.com>
Message-ID: <1409051095.5635285.1565697543164.JavaMail.zimbra@redhat.com>
In-Reply-To: <20190812095729.32692-6-yuri.benditovich@daynix.com>
References: <20190812095729.32692-1-yuri.benditovich@daynix.com>
 <20190812095729.32692-6-yuri.benditovich@daynix.com>
MIME-Version: 1.0
X-Originating-IP: [10.40.205.69, 10.4.195.4]
Thread-Topic: usb-redir: extend USB backend to support emulated devices
Thread-Index: 4oS6CPjNym98f3uFHaVxW+loocKINg==
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.12
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.32]); Tue, 13 Aug 2019 11:59:03 +0000 (UTC)
Subject: Re: [Spice-devel] [spice-gtk v3 5/9] usb-redir: extend USB backend
 to support emulated devices
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: yan@daynix.com, spice-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

PiAKPiBSZWRpcmVjdGlvbiBvZiBlbXVsYXRlZCBkZXZpY2VzIHJlcXVpcmVzIHNwZWNpYWwgYXBw
cm9hY2gsCj4gYXMgdXNicmVkaXJob3N0IGNhbid0IGJlIHVzZWQgZm9yIHRoYXQgKGl0IHdvcmtz
IG9ubHkgd2l0aAo+IGxpYnVzYiBkZXZpY2VzKS4gRm9yIGVtdWxhdGVkIGRldmljZXMgd2UgY3Jl
YXRlIGluc3RhbmNlIG9mCj4gdXNicmVkaXJwYXJzZXIgdGhhdCBpbXBsZW1lbnRzIFVTQiByZWRp
cmVjdGlvbiBwcm90b2NvbC4KCk1ha2Ugc2Vuc2UuIEFjdHVhbGx5IHVzYnJlZGlyaG9zdCBpbnRl
cm5hbGx5IHVzZXMgYSBwYXJzZXIgdG8KcGFyc2UgcHJvdG9jb2wgbWVzc2FnZXMgYW5kIHJlZGly
ZWN0IHRvIHRoZSBwaHlzaWNhbCBkZXZpY2UuCkJ1dCB0aGUgcGFyc2UgaXMgaW50ZXJuYWwgYW5k
IGlzIHVzZWQgYnkgdXNicmVkaXJob3N0IHNvCndvdWxkIGJlIGhhcmQgdG8gcmV1c2UuCgo+IElu
IG9yZGVyIHRvIHdvcmsgd2l0aCB0aGUgc2FtZSBzZXQgb2YgcHJvdG9jb2wgY2FwYWJpbGl0aWVz
Cj4gdGhhdCB1c2JyZWRpcmhvc3Qgc2V0cyB1cCB3aXRoIHJlbW90ZSBzaWRlLCB0aGUgcGFyc2Vy
IHNoYWxsOgo+IC0gbm90IHNlbmQgaXRzIG93biAnaGVsbG8nIHRvIHRoZSBzZXJ2ZXIKPiAtIGlu
aXRpYWxpemUgdGhlIHNhbWUgY2FwYWJpbGl0aWVzIHRoYXQgdXNicmVkaXJob3N0Cj4gLSByZWNl
aXZlIHRoZSBzYW1lICdoZWxsbycgcmVzcG9uc2UKPiBGb3IgdGhhdCB3ZSBhbmFseXplICdoZWxs
bycgc2VudCBieSBVU0IgcmVkaXIgcGFyc2VyIGFuZAo+IGV4dHJhY3Qgc2V0IG9mIGNhcGFiaWxp
dGllcyBmcm9tIGl0IGFuZCB1cG9uIHJlY2VpdmUgb2YKPiAnaGVsbG8nIHJlc3BvbnNlIHdlIHBy
b3ZpZGUgaXQgYWxzbyB0byB0aGUgcGFyc2VyLgoKVGhpcyBtYWtlIHNlbnNlIGJ1dCBzb21lIHBh
cnQgb2YgdGhlIGNvZGUgZG9lcyBub3QgZXhhY3RseSB0aGF0LgpJbiBzb21lIHBhdGggdGhlIGNv
ZGUgc2VuZCB0aGUgJ2hlbGxvJyBpcyBzZW50IGJ5IHRoZSBwYXJzZXIuCkl0IHdvdWxkIGJlIG1v
cmUgY2xlYXIgdG8gaW1wbGVtZW50IGp1c3Qgd2hhdCB5b3UgZGVzY3JpYmVkCmFib3ZlLCB3aHkg
dGhlIGltcGxlbWVudGF0aW9uIGlzIGEgYml0IGRpZmZlcmVudC4KCj4gV2hlbiBsaWJ1c2IgZGV2
aWNlIGlzIHJlZGlyZWN0ZWQgdmlhIGEgY2hhbm5lbCwgaW5zdGFuY2Ugb2YKPiB1c2JyZWRpcmhv
c3Qgc2VydmVzIGl0Lgo+IFdoZW4gZW11bGF0ZWQgZGV2aWNlIGlzIHJlZGlyZWN0ZWQgdmlhIGEg
Y2hhbm5lbCwgaW5zdGFuY2UKPiBvZiB1c2JyZWRpcnBhcnNlciBkb2VzIHRoZSBqb2IuCj4gCj4g
U2lnbmVkLW9mZi1ieTogWXVyaSBCZW5kaXRvdmljaCA8eXVyaS5iZW5kaXRvdmljaEBkYXluaXgu
Y29tPgo+IC0tLQo+ICBzcmMvdXNiLWJhY2tlbmQuYyB8IDYxNiArKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrLS0tCj4gIDEgZmlsZSBjaGFuZ2VkLCA1ODAgaW5zZXJ0
aW9ucygrKSwgMzYgZGVsZXRpb25zKC0pCj4gCj4gZGlmZiAtLWdpdCBhL3NyYy91c2ItYmFja2Vu
ZC5jIGIvc3JjL3VzYi1iYWNrZW5kLmMKPiBpbmRleCBhYTExYzc5Li45YWVlNmM3IDEwMDY0NAo+
IC0tLSBhL3NyYy91c2ItYmFja2VuZC5jCj4gKysrIGIvc3JjL3VzYi1iYWNrZW5kLmMKPiBAQCAt
NTUsNiArNTUsNyBAQCBzdHJ1Y3QgX1NwaWNlVXNiQmFja2VuZERldmljZQo+ICAgICAgZ2ludCBy
ZWZfY291bnQ7Cj4gICAgICBTcGljZVVzYkJhY2tlbmRDaGFubmVsICphdHRhY2hlZF90bzsKPiAg
ICAgIFVzYkRldmljZUluZm9ybWF0aW9uIGRldmljZV9pbmZvOwo+ICsgICAgZ2Jvb2xlYW4gZWRl
dl9jb25maWd1cmVkOwoKVGhpcyB2YXJpYWJsZSBpcyBuZXZlciByZXNldCwgSSB3b3VsZCBleHBl
Y3QgdGhhdCBhdCBsZWFzdAp3aGVuIGRldmljZSBpcyBkZXRhY2hlZCAodGhpcyBzaG91bGQgYmUg
ZXF1aXZhbGVudCB0byBwaHlzaWNhbApyZW1vdmFsKS4KV2h5IG5vdCBtb3ZpbmcgdG8gU3BpY2VV
c2JCYWNrZW5kQ2hhbm5lbD8KCj4gIH07Cj4gIAo+ICBzdHJ1Y3QgX1NwaWNlVXNiQmFja2VuZAo+
IEBAIC04MCwxMCArODEsMjAgQEAgc3RydWN0IF9TcGljZVVzYkJhY2tlbmQKPiAgc3RydWN0IF9T
cGljZVVzYkJhY2tlbmRDaGFubmVsCj4gIHsKPiAgICAgIHN0cnVjdCB1c2JyZWRpcmhvc3QgKnVz
YnJlZGlyaG9zdDsKPiArICAgIHN0cnVjdCB1c2JyZWRpcmhvc3QgKmhpZGRlbl9ob3N0Owo+ICsg
ICAgc3RydWN0IHVzYnJlZGlycGFyc2VyICpwYXJzZXI7Cj4gKyAgICBzdHJ1Y3QgdXNicmVkaXJw
YXJzZXIgKmhpZGRlbl9wYXJzZXI7CgpJIGRvbid0IHVuZGVyc3RhbmQgYWxsIHRoZXNlIHZhcmlh
YmxlLgpXb24ndCBiZSBlYXNpZXIgdG8gaGF2ZSBwYXJzZXIgaW5pdGlhbGl6ZWQgZm9yIGVtdWxh
dGVkCmRldmljZXMgYW5kIGJlaW5nIE5VTEwgKHNvIGZyZWVkKSB3aGVuIGVtdWxhdGVkIGRldmlj
ZQppcyBkZXRhY2hlZD8KCj4gICAgICB1aW50OF90ICpyZWFkX2J1ZjsKPiAgICAgIGludCByZWFk
X2J1Zl9zaXplOwo+ICAgICAgc3RydWN0IHVzYnJlZGlyZmlsdGVyX3J1bGUgKnJ1bGVzOwo+ICAg
ICAgaW50IHJ1bGVzX2NvdW50Owo+ICsgICAgdWludDMyX3QgaG9zdF9jYXBzOwo+ICsgICAgdWlu
dDMyX3QgcGFyc2VyX2luaXRfZG9uZSAgOiAxOwo+ICsgICAgdWludDMyX3QgcGFyc2VyX3dpdGhf
aGVsbG8gOiAxOwo+ICsgICAgdWludDMyX3QgaGVsbG9fZG9uZV9wYXJzZXIgOiAxOwo+ICsgICAg
dWludDMyX3QgaGVsbG9fc2VudCAgICAgICAgOiAxOwo+ICsgICAgdWludDMyX3QgcmVqZWN0ZWQg
ICAgICAgICAgOiAxOwo+ICsgICAgdWludDMyX3Qgd2FpdF9kaXNjX2FjayAgICAgOiAxOwoKVGhl
ICJkaXNjIiBuYW1pbmcgaXMgY29uZnVzaW5nLCBhbHNvIHRha2luZyBpbnRvIGFjY291bnQgdGhl
CiJDb21wYWN0IERpc2MiIGFkZGl0aW9uLiBSZWFkaW5nIHRoZSBjb2RlIHRoaXMgImRpc2MiIGlz
IGEgc2hvcnRlbgpmb3IgImRpc2Nvbm5lY3QiLCBtYXliZSB3b3VsZCBiZSBiZXR0ZXIgdG8ganVz
dCB1c2UgIndhaXRfZGlzY29ubmVjdF9hY2siPwoKPiAgICAgIFNwaWNlVXNiQmFja2VuZERldmlj
ZSAqYXR0YWNoZWQ7Cj4gICAgICBTcGljZVVzYnJlZGlyQ2hhbm5lbCAgKnVzZXJfZGF0YTsKCk9U
OiB0aGlzIGRlZmluaXRpdmVseSBzaG91bGQgYmUgcmVuYW1lZCEKCj4gICAgICBTcGljZVVzYkJh
Y2tlbmQgKmJhY2tlbmQ7Cj4gQEAgLTM1NSw3ICszNjYsMTEgQEAgZ2Jvb2xlYW4KPiBzcGljZV91
c2JfYmFja2VuZF9kZXZpY2VfaXNvY2goU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYpCj4gICAg
ICBnaW50IGksIGosIGs7Cj4gICAgICBpbnQgcmM7Cj4gIAo+IC0gICAgZ19yZXR1cm5fdmFsX2lm
X2ZhaWwobGliZGV2ICE9IE5VTEwsIDApOwo+ICsgICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwobGli
ZGV2ICE9IE5VTEwgfHwgZGV2LT5lZGV2ICE9IE5VTEwsIDApOwo+ICsgICAgaWYgKGRldi0+ZWRl
dikgewo+ICsgICAgICAgIC8qIGN1cnJlbnRseSB3ZSBkbyBub3QgZW11bGF0ZSBpc29jaCBkZXZp
Y2VzICovCj4gKyAgICAgICAgcmV0dXJuIEZBTFNFOwo+ICsgICAgfQo+ICAKPiAgICAgIHJjID0g
bGlidXNiX2dldF9hY3RpdmVfY29uZmlnX2Rlc2NyaXB0b3IobGliZGV2LCAmY29uZl9kZXNjKTsK
PiAgICAgIGlmIChyYykgewo+IEBAIC0zOTAsMTMgKzQwNSwxNiBAQCBmcm9tIGJvdGggdGhlIG1h
aW4gdGhyZWFkIGFzIHdlbGwgYXMgZnJvbSB0aGUgdXNiIGV2ZW50Cj4gaGFuZGxpbmcgdGhyZWFk
ICovCj4gIHN0YXRpYyB2b2lkIHVzYnJlZGlyX3dyaXRlX2ZsdXNoX2NhbGxiYWNrKHZvaWQgKnVz
ZXJfZGF0YSkKPiAgewo+ICAgICAgU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSB1c2VyX2Rh
dGE7Cj4gLSAgICBpZiAoIWNoLT51c2JyZWRpcmhvc3QpIHsKPiAtICAgICAgICAvKiBqdXN0IHRv
IGJlIG9uIHRoZSBzYWZlIHNpZGUgKi8KPiAtICAgICAgICByZXR1cm47Cj4gLSAgICB9CgpUaGVz
ZSBjaGVjayBzaG91bGQgYmUgaW4gYSBwcmVwYXJhdG9yeSBwYXRjaC4gTm90aGluZyB3cm9uZyB3
aXRoIHRoaXMgcGF0Y2gsCmJ1dCB0aGUgY29kZSAobWFzdGVyKSBpcyBjb25mdXNpbmcuIHVzYnJl
ZGlyaG9zdCBpcyBpbml0aWFsaXplZCBhcyBzb29uIGFzCnBvc3NpYmxlLCBjYW4gYmUgTlVMTCBv
bmx5IGJlZm9yZSB1c2JyZWRpcmhvc3Rfb3Blbl9mdWxsIHJldHVybnMuCkFjdHVhbGx5IGNhbiBi
ZSBOVUxMIGluIHRoaXMgY2FsbCBmb3IgdGhpcyByZWFzb24gKHRoaXMgY2FsbGJhY2sgaXMgY2Fs
bGVkCmluc2lkZSB1c2JyZWRpcmhvc3Rfb3Blbl9mdWxsKS4KCj4gICAgICBpZiAoaXNfY2hhbm5l
bF9yZWFkeShjaC0+dXNlcl9kYXRhKSkgewo+IC0gICAgICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAl
cCAtPiB1c2JyZWRpcmhvc3QiLCBfX0ZVTkNUSU9OX18sIGNoKTsKPiAtICAgICAgICB1c2JyZWRp
cmhvc3Rfd3JpdGVfZ3Vlc3RfZGF0YShjaC0+dXNicmVkaXJob3N0KTsKPiArICAgICAgICBpZiAo
Y2gtPnVzYnJlZGlyaG9zdCkgewo+ICsgICAgICAgICAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAg
LT4gdXNicmVkaXJob3N0IiwgX19GVU5DVElPTl9fLCBjaCk7Cj4gKyAgICAgICAgICAgIHVzYnJl
ZGlyaG9zdF93cml0ZV9ndWVzdF9kYXRhKGNoLT51c2JyZWRpcmhvc3QpOwo+ICsgICAgICAgIH0g
ZWxzZSBpZiAoY2gtPnBhcnNlcikgewo+ICsgICAgICAgICAgICBTUElDRV9ERUJVRygiJXMgY2gg
JXAgLT4gcGFyc2VyIiwgX19GVU5DVElPTl9fLCBjaCk7Cj4gKyAgICAgICAgICAgIHVzYnJlZGly
cGFyc2VyX2RvX3dyaXRlKGNoLT5wYXJzZXIpOwo+ICsgICAgICAgIH0gZWxzZSB7Cj4gKyAgICAg
ICAgICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCAoTk9UIEFDVElWRSkiLCBfX0ZVTkNUSU9OX18s
IGNoKTsKClRoaXMgdGhpcmQgY2FzZSBzaG91bGQgbmV2ZXIgYmUgcG9zc2libGUuIFRoaXMgaXMg
b25lIGFzcGVjdCB0aGF0IG1hc3Rlcgpjb2RlIGlzIGNvbmZ1c2luZyBhYm91dC4KCj4gKyAgICAg
ICAgfQo+ICAgICAgfSBlbHNlIHsKPiAgICAgICAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAgKG5v
dCByZWFkeSkiLCBfX0ZVTkNUSU9OX18sIGNoKTsKPiAgICAgIH0KPiBAQCAtNTUxLDEzICs1Njks
NTIgQEAgdm9pZAo+IHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV91bnJlZihTcGljZVVzYkJhY2tl
bmREZXZpY2UgKmRldikKPiAgICAgIH0KPiAgfQo+ICAKPiAtaW50IHNwaWNlX3VzYl9iYWNrZW5k
X2RldmljZV9jaGVja19maWx0ZXIoCj4gLSAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldiwK
PiAtICAgIGNvbnN0IHN0cnVjdCB1c2JyZWRpcmZpbHRlcl9ydWxlICpydWxlcywKPiAtICAgIGlu
dCBjb3VudCkKPiArc3RhdGljIGludCBjaGVja19lZGV2X2RldmljZV9maWx0ZXIoU3BpY2VVc2JC
YWNrZW5kRGV2aWNlICpkZXYsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGNvbnN0IHN0cnVjdCB1c2JyZWRpcmZpbHRlcl9ydWxlICpydWxlcywKPiArICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgaW50IGNvdW50KQo+ICB7Cj4gLSAgICByZXR1cm4gdXNi
cmVkaXJob3N0X2NoZWNrX2RldmljZV9maWx0ZXIoCj4gLSAgICAgICAgcnVsZXMsIGNvdW50LCBk
ZXYtPmxpYnVzYl9kZXZpY2UsIDApOwo+ICsgICAgU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZWRl
diA9IGRldi0+ZWRldjsKPiArICAgIHVpbnQ4X3QgY2xzWzMyXSwgc3ViY2xzWzMyXSwgcHJvdG9b
MzJdLCAqY2ZnLCBpZm51bSA9IDA7Cj4gKyAgICB1aW50MTZfdCBzaXplLCBvZmZzZXQgPSAwOwo+
ICsgICAgaWYgKCFlZGV2KSB7Cj4gKyAgICAgICAgcmV0dXJuIDE7Cj4gKyAgICB9Cj4gKyAgICBp
ZiAoIWRldmljZV9vcHMoZWRldiktPmdldF9kZXNjcmlwdG9yKGVkZXYsIExJQlVTQl9EVF9DT05G
SUcsIDAsICh2b2lkCj4gKiopJmNmZywgJnNpemUpKSB7Cj4gKyAgICAgICAgcmV0dXJuIDE7Cj4g
KyAgICB9Cj4gKyAgICB3aGlsZSAoKG9mZnNldCArIDEpIDwgc2l6ZSkgewo+ICsgICAgICAgIHVp
bnQ4X3QgbGVuICA9IGNmZ1tvZmZzZXRdOwo+ICsgICAgICAgIHVpbnQ4X3QgdHlwZSA9IGNmZ1tv
ZmZzZXQgKyAxXTsKPiArICAgICAgICBpZiAoKG9mZnNldCArIGxlbikgPiBzaXplKSB7Cj4gKyAg
ICAgICAgICAgIGJyZWFrOwo+ICsgICAgICAgIH0KPiArICAgICAgICBpZiAodHlwZSA9PSBMSUJV
U0JfRFRfSU5URVJGQUNFKSB7Cj4gKyAgICAgICAgICAgIGNsc1tpZm51bV0gPSBjZmdbb2Zmc2V0
ICsgNV07Cj4gKyAgICAgICAgICAgIHN1YmNsc1tpZm51bV0gPSBjZmdbb2Zmc2V0ICsgNl07Cj4g
KyAgICAgICAgICAgIHByb3RvW2lmbnVtXSA9IGNmZ1tvZmZzZXQgKyA3XTsKPiArICAgICAgICAg
ICAgaWZudW0rKzsKPiArICAgICAgICB9Cj4gKyAgICAgICAgb2Zmc2V0ICs9IGxlbjsKPiArICAg
IH0KPiArCj4gKyAgICByZXR1cm4gdXNicmVkaXJmaWx0ZXJfY2hlY2socnVsZXMsIGNvdW50LAo+
ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldi0+ZGV2aWNlX2luZm8uY2xhc3Ms
Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2LT5kZXZpY2VfaW5mby5zdWJj
bGFzcywKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXYtPmRldmljZV9pbmZv
LnByb3RvY29sLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNscywgc3ViY2xz
LCBwcm90bywgaWZudW0sCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2LT5k
ZXZpY2VfaW5mby52aWQsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2LT5k
ZXZpY2VfaW5mby5waWQsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2LT5k
ZXZpY2VfaW5mby5iY2RVU0IsIDApOwo+ICt9Cj4gKwo+ICtpbnQgc3BpY2VfdXNiX2JhY2tlbmRf
ZGV2aWNlX2NoZWNrX2ZpbHRlcihTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldiwKPiArICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RydWN0IHVzYnJlZGly
ZmlsdGVyX3J1bGUKPiAqcnVsZXMsIGludCBjb3VudCkKPiArewo+ICsgICAgaWYgKGRldi0+bGli
dXNiX2RldmljZSkgewo+ICsgICAgICAgIHJldHVybiB1c2JyZWRpcmhvc3RfY2hlY2tfZGV2aWNl
X2ZpbHRlcihydWxlcywgY291bnQsCj4gZGV2LT5saWJ1c2JfZGV2aWNlLCAwKTsKPiArICAgIH0g
ZWxzZSB7Cj4gKyAgICAgICAgcmV0dXJuIGNoZWNrX2VkZXZfZGV2aWNlX2ZpbHRlcihkZXYsIHJ1
bGVzLCBjb3VudCk7Cj4gKyAgICB9Cj4gIH0KPiAgCj4gIHN0YXRpYyBpbnQgdXNicmVkaXJfcmVh
ZF9jYWxsYmFjayh2b2lkICp1c2VyX2RhdGEsIHVpbnQ4X3QgKmRhdGEsIGludCBjb3VudCkKPiBA
QCAtNjIxLDYgKzY3OCwxNyBAQCBzdGF0aWMgaW50IHVzYnJlZGlyX3dyaXRlX2NhbGxiYWNrKHZv
aWQgKnVzZXJfZGF0YSwKPiB1aW50OF90ICpkYXRhLCBpbnQgY291bnQpCj4gICAgICBTcGljZVVz
YkJhY2tlbmRDaGFubmVsICpjaCA9IHVzZXJfZGF0YTsKPiAgICAgIGludCByZXM7Cj4gICAgICBT
UElDRV9ERUJVRygiJXMgY2ggJXAsICVkIGJ5dGVzIiwgX19GVU5DVElPTl9fLCBjaCwgY291bnQp
Owo+ICsgICAgaWYgKCFjaC0+aGVsbG9fc2VudCkgewoKSXMgY29uZnVzaW5nIHRoYXQgdGhlIHNh
bWUgY2FsbGJhY2sgaXMgdXNlZCBmb3IgYm90aCB1c2JyZWRpciBwYXJzZXIgYW5kCnVzYnJlZGly
IGhvc3QgYnV0IHRoZSBoZWxsbyBzaG91bGQgYmUgcGFyc2VkIG9ubHkgZm9yIHRoZSBob3N0LgpN
YXliZSBkaXNhYmxpbmcgaGVsbG8gZm9yIHRoZSBwYXJzZXIgYW5kIGNoZWNrIHRoZSB0eXBlICho
ZWxsbykgaGVyZT8KCj4gKyAgICAgICAgLyogaGVsbG8gaXMgc2hvcnQgaGVhZGVyICgxMikgKyBo
ZWxsbyBzdHJ1Y3QgKDY0KSArIGNhcGFiaWxpdGllcyAoNCkKPiAqLwo+ICsgICAgICAgIGludCBo
ZWxsb19zaXplID0gc2l6ZW9mKHN0cnVjdCB1c2JfcmVkaXJfaGVhZGVyKSArIHNpemVvZihzdHJ1
Y3QKPiB1c2JfcmVkaXJfaGVsbG9faGVhZGVyKTsKClRoaXMgZm9ybXVsYWUgaXMgY29uZnVzaW5n
IHdpdGggdGhlIGRlc2NyaXB0aW9uLiBzaXplb2Yoc3RydWN0IHVzYl9yZWRpcl9oZWFkZXIpCmlz
IDE2IGJ1dCBpcyBub3QgdGhlIHNob3J0ICgzMmJpdCkgaGVhZGVyLgoKPiArICAgICAgICBjaC0+
aGVsbG9fc2VudCA9IDE7Cj4gKyAgICAgICAgaWYgKGNvdW50ID09IGhlbGxvX3NpemUpIHsKCkkg
d291bGQgc2F5ICJjb3VudCA+PSBoZWxsb19zaXplIiB0byBzdXBwb3J0IGZ1dHVyZSBleHRlbnNp
b25zIG9mIHRoZQpjYXBhYmlsaXR5IGFycmF5LgoKPiArICAgICAgICAgICAgbWVtY3B5KCZjaC0+
aG9zdF9jYXBzLCBkYXRhICsgaGVsbG9fc2l6ZSAtCj4gc2l6ZW9mKGNoLT5ob3N0X2NhcHMpLAo+
ICsgICAgICAgICAgICAgICAgICAgc2l6ZW9mKGNoLT5ob3N0X2NhcHMpKTsKPiArICAgICAgICAg
ICAgU1BJQ0VfREVCVUcoIiVzIGNoICVwLCBzZW5kaW5nIGZpcnN0IGhlbGxvLCBjYXBzICUwOFgi
LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICBfX0ZVTkNUSU9OX18sIGNoLCBjaC0+aG9zdF9j
YXBzKTsKPiArICAgICAgICB9Cj4gKyAgICB9Cj4gICAgICByZXMgPSBzcGljZV91c2JyZWRpcl93
cml0ZV9jYWxsYmFjayhjaC0+dXNlcl9kYXRhLCBkYXRhLCBjb3VudCk7Cj4gICAgICByZXR1cm4g
cmVzOwo+ICB9Cj4gQEAgLTY0MSw2ICs3MDksMjcgQEAgaW50Cj4gc3BpY2VfdXNiX2JhY2tlbmRf
cmVhZF9ndWVzdF9kYXRhKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLCB1aW50OF90ICpkYXRh
LAo+ICAgICAgY2gtPnJlYWRfYnVmX3NpemUgPSBjb3VudDsKPiAgICAgIGlmIChjaC0+dXNicmVk
aXJob3N0KSB7CgpNYXliZSB0aGlzIGNvdWxkIGJlICJjaC0+dXNicmVkaXJob3N0IHx8ICFjaC0+
aGVsbG9fZG9uZV9wYXJzZXIiIHRvCnBhcnNlIHRoZSAnaGVsbG8nIGFsd2F5cyB3aXRoIHVzYnJl
ZGlyIGhvc3QgPwoKPiAgICAgICAgICByZXMgPSB1c2JyZWRpcmhvc3RfcmVhZF9ndWVzdF9kYXRh
KGNoLT51c2JyZWRpcmhvc3QpOwo+ICsgICAgICAgIGlmICghY2gtPmhlbGxvX2RvbmVfcGFyc2Vy
KSB7Cj4gKyAgICAgICAgICAgIGludCByZXNfcGFyc2VyOwo+ICsgICAgICAgICAgICAvKiB1c2Jy
ZWRpcmhvc3Qgc2hvdWxkIGNvbnN1bWUgaGVsbG8gcmVzcG9uc2UgKi8KPiArICAgICAgICAgICAg
Z19yZXR1cm5fdmFsX2lmX2ZhaWwoY2gtPnJlYWRfYnVmID09IE5VTEwsCj4gVVNCX1JFRElSX0VS
Uk9SX1JFQURfUEFSU0UpOwo+ICsKPiArICAgICAgICAgICAgY2gtPnJlYWRfYnVmID0gZGF0YTsK
PiArICAgICAgICAgICAgY2gtPnJlYWRfYnVmX3NpemUgPSBjb3VudDsKPiArICAgICAgICAgICAg
Y2gtPmhlbGxvX2RvbmVfcGFyc2VyID0gMTsKPiArICAgICAgICAgICAgaWYgKGNoLT5hdHRhY2hl
ZCAmJiBjaC0+YXR0YWNoZWQtPmVkZXYpIHsKPiArICAgICAgICAgICAgICAgIC8qIGNhc2Ugb2Yg
Q0Qgc2hhcmluZyBvbiBjb25uZWN0ICovCj4gKyAgICAgICAgICAgICAgICBjaC0+dXNicmVkaXJo
b3N0ID0gTlVMTDsKPiArICAgICAgICAgICAgICAgIGNoLT5wYXJzZXIgPSBjaC0+aGlkZGVuX3Bh
cnNlcjsKPiArICAgICAgICAgICAgICAgIFNQSUNFX0RFQlVHKCIlczogc3dpdGNoICVwIHRvIHBh
cnNlciIsIF9fRlVOQ1RJT05fXywgY2gpOwo+ICsgICAgICAgICAgICB9Cj4gKyAgICAgICAgICAg
IHJlc19wYXJzZXIgPSB1c2JyZWRpcnBhcnNlcl9kb19yZWFkKGNoLT5oaWRkZW5fcGFyc2VyKTsK
PiArICAgICAgICAgICAgaWYgKHJlcyA+PSAwKSB7Cj4gKyAgICAgICAgICAgICAgICByZXMgPSBy
ZXNfcGFyc2VyOwo+ICsgICAgICAgICAgICB9Cj4gKyAgICAgICAgfQo+ICsgICAgfSBlbHNlIGlm
IChjaC0+cGFyc2VyKSB7Cj4gKyAgICAgICAgcmVzID0gdXNicmVkaXJwYXJzZXJfZG9fcmVhZChj
aC0+cGFyc2VyKTsKPiAgICAgIH0gZWxzZSB7Cj4gICAgICAgICAgcmVzID0gVVNCX1JFRElSX0VS
Uk9SX0lPOwo+ICAgICAgfQo+IEBAIC02NjEsNiArNzUwLDExIEBAIGludAo+IHNwaWNlX3VzYl9i
YWNrZW5kX3JlYWRfZ3Vlc3RfZGF0YShTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCwgdWludDhf
dCAqZGF0YSwKPiAgICAgIH0KPiAgICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCwgJWQgYnl0ZXMs
IHJlcyAlZCIsIF9fRlVOQ1RJT05fXywgY2gsIGNvdW50LCByZXMpOwo+ICAKPiArICAgIGlmIChj
aC0+cmVqZWN0ZWQpIHsKPiArICAgICAgICBjaC0+cmVqZWN0ZWQgPSAwOwo+ICsgICAgICAgIHJl
cyA9IFVTQl9SRURJUl9FUlJPUl9ERVZfUkVKRUNURUQ7Cj4gKyAgICB9CgpXaHkgdGhpcyBpcyBh
ZnRlciB0aGUgcmVhZD8gV29uJ3QgaXQgZGlzY2FyZCB0aGUgdmFsdWU/Cgo+ICsKPiAgICAgIHJl
dHVybiByZXM7Cj4gIH0KPiAgCj4gQEAgLTY5MCwxMyArNzg0LDQyNiBAQCBHRXJyb3IgKnNwaWNl
X3VzYl9iYWNrZW5kX2dldF9lcnJvcl9kZXRhaWxzKGludAo+IGVycm9yX2NvZGUsIGdjaGFyICpk
ZXNjKQo+ICB2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX3JldHVybl93cml0ZV9kYXRhKFNwaWNlVXNi
QmFja2VuZENoYW5uZWwgKmNoLCB2b2lkCj4gICpkYXRhKQo+ICB7Cj4gICAgICBpZiAoY2gtPnVz
YnJlZGlyaG9zdCkgewo+IC0gICAgICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCIsIF9fRlVOQ1RJ
T05fXywgY2gpOwo+ICsgICAgICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCAtPiB1c2JyZWRpcmhv
c3QiLCBfX0ZVTkNUSU9OX18sIGNoKTsKPiAgICAgICAgICB1c2JyZWRpcmhvc3RfZnJlZV93cml0
ZV9idWZmZXIoY2gtPnVzYnJlZGlyaG9zdCwgZGF0YSk7Cj4gKyAgICB9IGVsc2UgaWYgKGNoLT5w
YXJzZXIpIHsKPiArICAgICAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAgLT4gcGFyc2VyIiwgX19G
VU5DVElPTl9fLCBjaCk7Cj4gKyAgICAgICAgdXNicmVkaXJwYXJzZXJfZnJlZV93cml0ZV9idWZm
ZXIoY2gtPnBhcnNlciwgZGF0YSk7CgpBIGJpdCBzY2FyeSB0aGF0IGR1cmluZyBhIHN3aWN0aCBo
b3N0IDwtPiBwYXJzZXIgdGhpcyBjYW4gY2FsbCB0aGUgd3JvbmcKZnVuY3Rpb24uIEJ1dCBjdXJy
ZW50bHkgdGhlIGltcGxlbWVudGF0aW9uIGZvciBib3RoIGlzIHRvIGZyZWUgJ2RhdGEnLgoKPiAg
ICAgIH0gZWxzZSB7Cj4gICAgICAgICAgU1BJQ0VfREVCVUcoIiVzIGNoICVwIC0gTk9CT0RZIFRP
IENBTEwiLCBfX0ZVTkNUSU9OX18sIGNoKTsKPiAgICAgIH0KPiAgfQo+ICAKPiArc3RhdGljIHZv
aWQgdXNicmVkaXJfY29udHJvbF9wYWNrZXQodm9pZCAqcHJpdiwKPiArICAgIHVpbnQ2NF90IGlk
LCBzdHJ1Y3QgdXNiX3JlZGlyX2NvbnRyb2xfcGFja2V0X2hlYWRlciAqaCwKPiArICAgIHVpbnQ4
X3QgKmRhdGEsIGludCBkYXRhX2xlbikKClRoaXMgc3R5bGUgaXMgbmV3LCBJIHN1cHBvc2UgY29w
aWVkIGZyb20gdXNicmVkaXIsIGJ1dCBpcyBub3QKc3BpY2UtZ3RrLgoKPiArewo+ICsgICAgU3Bp
Y2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSBwcml2Owo+ICsgICAgU3BpY2VVc2JCYWNrZW5kRGV2
aWNlICpkID0gY2gtPmF0dGFjaGVkOwo+ICsgICAgU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZWRl
diA9IGQgPyBkLT5lZGV2IDogTlVMTDsKPiArICAgIHN0cnVjdCB1c2JfcmVkaXJfY29udHJvbF9w
YWNrZXRfaGVhZGVyIHJlc3BvbnNlID0gKmg7Cj4gKyAgICB1aW50OF90IHJlcXR5cGUgPSBoLT5y
ZXF1ZXN0dHlwZSAmIDB4N2Y7Cj4gKyAgICBnYm9vbGVhbiBkb25lID0gRkFMU0U7Cj4gKyAgICB2
b2lkICpvdXRfYnVmZmVyID0gTlVMTDsKPiArCj4gKyAgICByZXNwb25zZS5zdGF0dXMgPSB1c2Jf
cmVkaXJfc3RhbGw7Cj4gKyAgICBTUElDRV9ERUJVRygiJXMgJXA6IFRSVklMICUwMlggJTAyWCAl
MDRYICUwNFggJTA0WCIsCj4gKyAgICAgICAgICAgICAgICBfX0ZVTkNUSU9OX18sCj4gKyAgICAg
ICAgICAgICAgICBjaCwgaC0+cmVxdWVzdHR5cGUsIGgtPnJlcXVlc3QsCj4gKyAgICAgICAgICAg
ICAgICBoLT52YWx1ZSwgaC0+aW5kZXgsIGgtPmxlbmd0aCk7Cj4gKwo+ICsgICAgaWYgKCFlZGV2
KSB7Cj4gKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiBkZXZpY2Ugbm90IGF0dGFjaGVkIiwgX19G
VU5DVElPTl9fKTsKPiArICAgICAgICByZXNwb25zZS5zdGF0dXMgPSB1c2JfcmVkaXJfaW9lcnJv
cjsKPiArICAgICAgICBkb25lID0gVFJVRTsKPiArICAgIH0gZWxzZSBpZiAocmVxdHlwZSA9PSAo
TElCVVNCX1JFUVVFU1RfVFlQRV9TVEFOREFSRCB8Cj4gTElCVVNCX1JFQ0lQSUVOVF9ERVZJQ0Up
ICYmCj4gKyAgICAgICAgICAgICAgIGgtPnJlcXVlc3QgPT0gTElCVVNCX1JFUVVFU1RfR0VUX0RF
U0NSSVBUT1IpIHsKPiArICAgICAgICB1aW50MTZfdCBzaXplOwo+ICsgICAgICAgIGRvbmUgPSBk
ZXZpY2Vfb3BzKGVkZXYpLT5nZXRfZGVzY3JpcHRvcihlZGV2LCBoLT52YWx1ZSA+PiA4LAo+IGgt
PnZhbHVlICYgMHhmZiwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgJm91dF9idWZmZXIsICZzaXplKTsKPiArICAgICAgICByZXNwb25zZS5sZW5ndGgg
PSBzaXplOwo+ICsgICAgICAgIGlmIChkb25lKSB7Cj4gKyAgICAgICAgICAgIHJlc3BvbnNlLnN0
YXR1cyA9IDA7Cj4gKyAgICAgICAgfQo+ICsgICAgICAgIGRvbmUgPSBUUlVFOwo+ICsgICAgfQo+
ICsKPiArICAgIGlmICghZG9uZSkgewo+ICsgICAgICAgIGRldmljZV9vcHMoZWRldiktPmNvbnRy
b2xfcmVxdWVzdChlZGV2LCBkYXRhLCBkYXRhX2xlbiwgJnJlc3BvbnNlLAo+ICZvdXRfYnVmZmVy
KTsKPiArICAgICAgICBkb25lID0gVFJVRTsKPiArICAgIH0KPiArCj4gKyAgICBpZiAocmVzcG9u
c2Uuc3RhdHVzKSB7Cj4gKyAgICAgICAgcmVzcG9uc2UubGVuZ3RoID0gMDsKPiArICAgIH0gZWxz
ZSBpZiAocmVzcG9uc2UubGVuZ3RoID4gaC0+bGVuZ3RoKSB7Cj4gKyAgICAgICAgcmVzcG9uc2Uu
bGVuZ3RoID0gaC0+bGVuZ3RoOwo+ICsgICAgfQo+ICsKPiArICAgIFNQSUNFX0RFQlVHKCIlcyBy
ZXNwb25kaW5nIHdpdGggcGF5bG9hZCBvZiAlMDJYLCBzdGF0dXMgJVgiLAo+ICsgICAgICAgICAg
ICAgICAgX19GVU5DVElPTl9fLCByZXNwb25zZS5sZW5ndGgsIHJlc3BvbnNlLnN0YXR1cyk7Cj4g
KyAgICB1c2JyZWRpcnBhcnNlcl9zZW5kX2NvbnRyb2xfcGFja2V0KGNoLT5wYXJzZXIsIGlkLCAm
cmVzcG9uc2UsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3Bv
bnNlLmxlbmd0aCA/IG91dF9idWZmZXIgOiBOVUxMLAo+ICsgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICByZXNwb25zZS5sZW5ndGgpOwo+ICsKPiArICAgIHVzYnJlZGlyX3dy
aXRlX2ZsdXNoX2NhbGxiYWNrKGNoKTsKPiArICAgIHVzYnJlZGlycGFyc2VyX2ZyZWVfcGFja2V0
X2RhdGEoY2gtPnBhcnNlciwgZGF0YSk7Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIHVzYnJlZGly
X2J1bGtfcGFja2V0KHZvaWQgKnByaXYsCj4gKyAgICB1aW50NjRfdCBpZCwgc3RydWN0IHVzYl9y
ZWRpcl9idWxrX3BhY2tldF9oZWFkZXIgKmgsCj4gKyAgICB1aW50OF90ICpkYXRhLCBpbnQgZGF0
YV9sZW4pCj4gK3sKPiArICAgIFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoID0gcHJpdjsKPiAr
ICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqZCA9IGNoLT5hdHRhY2hlZDsKPiArICAgIFNwaWNl
VXNiRW11bGF0ZWREZXZpY2UgKmVkZXYgPSBkID8gZC0+ZWRldiA6IE5VTEw7Cj4gKyAgICBzdHJ1
Y3QgdXNiX3JlZGlyX2J1bGtfcGFja2V0X2hlYWRlciBob3V0ID0gKmg7Cj4gKyAgICB1aW50MzJf
dCBsZW4gPSAoaC0+bGVuZ3RoX2hpZ2ggPDwgMTYpIHwgaC0+bGVuZ3RoOwo+ICsgICAgU1BJQ0Vf
REVCVUcoIiVzICVwOiBlcCAlWCwgbGVuICV1LCBpZCAlIiBHX0dVSU5UNjRfRk9STUFULCBfX0ZV
TkNUSU9OX18sCj4gKyAgICAgICAgICAgICAgICBjaCwgaC0+ZW5kcG9pbnQsIGxlbiwgaWQpOwo+
ICsKPiArICAgIGlmICghZWRldikgewo+ICsgICAgICAgIFNQSUNFX0RFQlVHKCIlczogZGV2aWNl
IG5vdCBhdHRhY2hlZCIsIF9fRlVOQ1RJT05fXyk7Cj4gKyAgICAgICAgaG91dC5zdGF0dXMgPSB1
c2JfcmVkaXJfaW9lcnJvcjsKPiArICAgICAgICBob3V0Lmxlbmd0aCA9IGhvdXQubGVuZ3RoX2hp
Z2ggPSAwOwo+ICsgICAgICAgIFNQSUNFX0RFQlVHKCIlczogcmVzcG9uZGluZyB3aXRoIFpMUCBz
dGF0dXMgJWQiLCBfX0ZVTkNUSU9OX18sCj4gaG91dC5zdGF0dXMpOwo+ICsgICAgfSBlbHNlIGlm
IChoLT5lbmRwb2ludCAmIExJQlVTQl9FTkRQT0lOVF9JTikgewo+ICsgICAgICAgIGlmIChkZXZp
Y2Vfb3BzKGVkZXYpLT5idWxrX2luX3JlcXVlc3QoZWRldiwgaWQsICZob3V0KSkgewo+ICsgICAg
ICAgICAgICB1c2JyZWRpcnBhcnNlcl9mcmVlX3BhY2tldF9kYXRhKGNoLT5wYXJzZXIsIGRhdGEp
Owo+ICsgICAgICAgICAgICAvKiBjb21wbGV0aW9uIGlzIGFzeW5jaHJvbm91cyAqLwo+ICsgICAg
ICAgICAgICByZXR1cm47Cj4gKyAgICAgICAgfQo+ICsgICAgfSBlbHNlIHsKPiArICAgICAgICBo
b3V0LnN0YXR1cyA9IHVzYl9yZWRpcl9zdGFsbDsKPiArICAgICAgICBkZXZpY2Vfb3BzKGVkZXYp
LT5idWxrX291dF9yZXF1ZXN0KGVkZXYsIGgtPmVuZHBvaW50LCBkYXRhLAo+IGRhdGFfbGVuLCAm
aG91dC5zdGF0dXMpOwo+ICsgICAgICAgIFNQSUNFX0RFQlVHKCIlczogcmVzcG9uZGluZyBzdGF0
dXMgJWQiLCBfX0ZVTkNUSU9OX18sIGhvdXQuc3RhdHVzKTsKPiArICAgIH0KPiArCj4gKyAgICB1
c2JyZWRpcnBhcnNlcl9zZW5kX2J1bGtfcGFja2V0KGNoLT5wYXJzZXIsIGlkLCAmaG91dCwgTlVM
TCwgMCk7Cj4gKyAgICB1c2JyZWRpcnBhcnNlcl9mcmVlX3BhY2tldF9kYXRhKGNoLT5wYXJzZXIs
IGRhdGEpOwo+ICsgICAgdXNicmVkaXJfd3JpdGVfZmx1c2hfY2FsbGJhY2soY2gpOwo+ICt9Cj4g
Kwo+ICtzdGF0aWMgdm9pZCB1c2JyZWRpcl9kZXZpY2VfcmVzZXQodm9pZCAqcHJpdikKPiArewo+
ICsgICAgU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSBwcml2Owo+ICsgICAgU3BpY2VVc2JC
YWNrZW5kRGV2aWNlICpkID0gY2gtPmF0dGFjaGVkOwo+ICsgICAgU3BpY2VVc2JFbXVsYXRlZERl
dmljZSAqZWRldiA9IGQgPyBkLT5lZGV2IDogTlVMTDsKPiArICAgIFNQSUNFX0RFQlVHKCIlcyBj
aCAlcCIsIF9fRlVOQ1RJT05fXywgY2gpOwo+ICsgICAgaWYgKGVkZXYpIHsKPiArICAgICAgICBk
ZXZpY2Vfb3BzKGVkZXYpLT5yZXNldChlZGV2KTsKPiArICAgIH0KPiArfQo+ICsKPiArc3RhdGlj
IHZvaWQgdXNicmVkaXJfaW50ZXJmYWNlX2luZm8odm9pZCAqcHJpdiwKPiArICAgIHN0cnVjdCB1
c2JfcmVkaXJfaW50ZXJmYWNlX2luZm9faGVhZGVyICppbnRlcmZhY2VfaW5mbykKPiArewo+ICsg
ICAgU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSBwcml2Owo+ICsgICAgU1BJQ0VfREVCVUco
IiVzIG5vdCBpbXBsZW1lbnRlZCAlcCIsIF9fRlVOQ1RJT05fXywgY2gpOwo+ICt9Cj4gKwo+ICtz
dGF0aWMgdm9pZCB1c2JyZWRpcl9pbnRlcmZhY2VfZXBfaW5mbyh2b2lkICpwcml2LAo+ICsgICAg
c3RydWN0IHVzYl9yZWRpcl9lcF9pbmZvX2hlYWRlciAqZXBfaW5mbykKPiArewo+ICsgICAgU3Bp
Y2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSBwcml2Owo+ICsgICAgU1BJQ0VfREVCVUcoIiVzIG5v
dCBpbXBsZW1lbnRlZCAlcCIsIF9fRlVOQ1RJT05fXywgY2gpOwo+ICt9Cj4gKwo+ICtzdGF0aWMg
dm9pZCB1c2JyZWRpcl9zZXRfY29uZmlndXJhdGlvbih2b2lkICpwcml2LAo+ICsgICAgdWludDY0
X3QgaWQsIHN0cnVjdCB1c2JfcmVkaXJfc2V0X2NvbmZpZ3VyYXRpb25faGVhZGVyCj4gKnNldF9j
b25maWd1cmF0aW9uKQo+ICt7Cj4gKyAgICBTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCA9IHBy
aXY7Cj4gKyAgICBzdHJ1Y3QgdXNiX3JlZGlyX2NvbmZpZ3VyYXRpb25fc3RhdHVzX2hlYWRlciBo
Owo+ICsgICAgaC5zdGF0dXMgPSAwOwo+ICsgICAgaC5jb25maWd1cmF0aW9uID0gc2V0X2NvbmZp
Z3VyYXRpb24tPmNvbmZpZ3VyYXRpb247Cj4gKyAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAsIGNm
ZyAlZCIsIF9fRlVOQ1RJT05fXywgY2gsIGguY29uZmlndXJhdGlvbik7Cj4gKyAgICBpZiAoY2gt
PmF0dGFjaGVkKSB7Cj4gKyAgICAgICAgY2gtPmF0dGFjaGVkLT5lZGV2X2NvbmZpZ3VyZWQgPSBo
LmNvbmZpZ3VyYXRpb24gIT0gMDsKPiArICAgIH0KPiArICAgIHVzYnJlZGlycGFyc2VyX3NlbmRf
Y29uZmlndXJhdGlvbl9zdGF0dXMoY2gtPnBhcnNlciwgaWQsICZoKTsKPiArICAgIHVzYnJlZGly
X3dyaXRlX2ZsdXNoX2NhbGxiYWNrKGNoKTsKPiArfQo+ICsKPiArc3RhdGljIHZvaWQgdXNicmVk
aXJfZ2V0X2NvbmZpZ3VyYXRpb24odm9pZCAqcHJpdiwgdWludDY0X3QgaWQpCj4gK3sKPiArICAg
IFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoID0gcHJpdjsKPiArICAgIHN0cnVjdCB1c2JfcmVk
aXJfY29uZmlndXJhdGlvbl9zdGF0dXNfaGVhZGVyIGg7Cj4gKyAgICBoLnN0YXR1cyA9IDA7Cj4g
KyAgICBoLmNvbmZpZ3VyYXRpb24gPSBjaC0+YXR0YWNoZWQgJiYgY2gtPmF0dGFjaGVkLT5lZGV2
X2NvbmZpZ3VyZWQ7Cj4gKyAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAsIGNmZyAlZCIsIF9fRlVO
Q1RJT05fXywgY2gsIGguY29uZmlndXJhdGlvbik7Cj4gKyAgICB1c2JyZWRpcnBhcnNlcl9zZW5k
X2NvbmZpZ3VyYXRpb25fc3RhdHVzKGNoLT5wYXJzZXIsIGlkLCAmaCk7Cj4gKyAgICB1c2JyZWRp
cl93cml0ZV9mbHVzaF9jYWxsYmFjayhjaCk7Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIHVzYnJl
ZGlyX3NldF9hbHRfc2V0dGluZyh2b2lkICpwcml2LAo+ICsgICAgdWludDY0X3QgaWQsIHN0cnVj
dCB1c2JfcmVkaXJfc2V0X2FsdF9zZXR0aW5nX2hlYWRlciAqcykKPiArewo+ICsgICAgU3BpY2VV
c2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSBwcml2Owo+ICsgICAgc3RydWN0IHVzYl9yZWRpcl9hbHRf
c2V0dGluZ19zdGF0dXNfaGVhZGVyIHNoOwo+ICsgICAgc2guc3RhdHVzID0gKCFzLT5pbnRlcmZh
Y2UgJiYgIXMtPmFsdCkgPyAwIDogdXNiX3JlZGlyX3N0YWxsOwo+ICsgICAgc2guaW50ZXJmYWNl
ID0gcy0+aW50ZXJmYWNlOwo+ICsgICAgc2guYWx0ID0gcy0+YWx0Owo+ICsgICAgU1BJQ0VfREVC
VUcoIiVzIGNoICVwLCAlZDolZCIsIF9fRlVOQ1RJT05fXywgY2gsIHMtPmludGVyZmFjZSwgcy0+
YWx0KTsKPiArICAgIHVzYnJlZGlycGFyc2VyX3NlbmRfYWx0X3NldHRpbmdfc3RhdHVzKGNoLT5w
YXJzZXIsIGlkLCAmc2gpOwo+ICsgICAgdXNicmVkaXJfd3JpdGVfZmx1c2hfY2FsbGJhY2soY2gp
Owo+ICt9Cj4gKwo+ICtzdGF0aWMgdm9pZCB1c2JyZWRpcl9nZXRfYWx0X3NldHRpbmcodm9pZCAq
cHJpdiwKPiArICAgIHVpbnQ2NF90IGlkLCBzdHJ1Y3QgdXNiX3JlZGlyX2dldF9hbHRfc2V0dGlu
Z19oZWFkZXIgKnMpCj4gK3sKPiArICAgIFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoID0gcHJp
djsKPiArICAgIHN0cnVjdCB1c2JfcmVkaXJfYWx0X3NldHRpbmdfc3RhdHVzX2hlYWRlciBzaDsK
PiArICAgIHNoLnN0YXR1cyA9IChzLT5pbnRlcmZhY2UgPT0gMCkgPyAwIDogdXNiX3JlZGlyX3N0
YWxsOwo+ICsgICAgc2guaW50ZXJmYWNlID0gcy0+aW50ZXJmYWNlOwo+ICsgICAgc2guYWx0ID0g
MDsKPiArICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCwgaWYgJWQiLCBfX0ZVTkNUSU9OX18sIGNo
LCBzLT5pbnRlcmZhY2UpOwo+ICsgICAgdXNicmVkaXJwYXJzZXJfc2VuZF9hbHRfc2V0dGluZ19z
dGF0dXMoY2gtPnBhcnNlciwgaWQsICZzaCk7Cj4gKyAgICB1c2JyZWRpcl93cml0ZV9mbHVzaF9j
YWxsYmFjayhjaCk7Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIHVzYnJlZGlyX2NhbmNlbF9kYXRh
KHZvaWQgKnByaXYsIHVpbnQ2NF90IGlkKQo+ICt7Cj4gKyAgICBTcGljZVVzYkJhY2tlbmRDaGFu
bmVsICpjaCA9IHByaXY7Cj4gKyAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmQgPSBjaC0+YXR0
YWNoZWQ7Cj4gKyAgICBTcGljZVVzYkVtdWxhdGVkRGV2aWNlICplZGV2ID0gZCA/IGQtPmVkZXYg
OiBOVUxMOwo+ICsgICAgaWYgKCFlZGV2KSB7Cj4gKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiBk
ZXZpY2Ugbm90IGF0dGFjaGVkIiwgX19GVU5DVElPTl9fKTsKPiArICAgICAgICByZXR1cm47Cj4g
KyAgICB9Cj4gKyAgICBkZXZpY2Vfb3BzKGVkZXYpLT5jYW5jZWxfcmVxdWVzdChlZGV2LCBpZCk7
Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIHVzYnJlZGlyX2ZpbHRlcl9yZWplY3Qodm9pZCAqcHJp
dikKPiArewo+ICsgICAgU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSBwcml2Owo+ICsgICAg
U1BJQ0VfREVCVUcoIiVzICVwIiwgX19GVU5DVElPTl9fLCBjaCk7Cj4gKyAgICBjaC0+cmVqZWN0
ZWQgPSAxOwo+ICt9Cj4gKwo+ICsvKiBOb3RlIHRoYXQgdGhlIG93bmVyc2hpcCBvZiB0aGUgcnVs
ZXMgYXJyYXkgaXMgcGFzc2VkIG9uIHRvIHRoZSBjYWxsYmFjay4KPiAqLwo+ICtzdGF0aWMgdm9p
ZCB1c2JyZWRpcl9maWx0ZXJfZmlsdGVyKHZvaWQgKnByaXYsCj4gKyAgICBzdHJ1Y3QgdXNicmVk
aXJmaWx0ZXJfcnVsZSAqciwgaW50IGNvdW50KQo+ICt7Cj4gKyAgICBTcGljZVVzYkJhY2tlbmRD
aGFubmVsICpjaCA9IHByaXY7Cj4gKyAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAgJWQgZmlsdGVy
cyIsIF9fRlVOQ1RJT05fXywgY2gsIGNvdW50KTsKPiArCj4gKyAgICBmcmVlKGNoLT5ydWxlcyk7
Cj4gKwo+ICsgICAgY2gtPnJ1bGVzID0gcjsKPiArICAgIGNoLT5ydWxlc19jb3VudCA9IGNvdW50
Owo+ICsgICAgaWYgKGNvdW50KSB7Cj4gKyAgICAgICAgaW50IGk7Cj4gKyAgICAgICAgZm9yIChp
ID0gMDsgaSA8IGNvdW50OyBpKyspIHsKPiArICAgICAgICAgICAgU1BJQ0VfREVCVUcoIiVzIGNs
YXNzICVkLCAlWDolWCIsCj4gKyAgICAgICAgICAgICAgICByW2ldLmFsbG93ID8gImFsbG93ZWQi
IDogImRlbmllZCIsIHJbaV0uZGV2aWNlX2NsYXNzLAo+ICsgICAgICAgICAgICAgICAgKHVpbnQz
Ml90KXJbaV0udmVuZG9yX2lkLCAodWludDMyX3QpcltpXS5wcm9kdWN0X2lkKTsKPiArICAgICAg
ICB9Cj4gKyAgICB9Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIHVzYnJlZGlyX2RldmljZV9kaXNj
b25uZWN0X2Fjayh2b2lkICpwcml2KQo+ICt7Cj4gKyAgICBTcGljZVVzYkJhY2tlbmRDaGFubmVs
ICpjaCA9IHByaXY7Cj4gKyAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAiLCBfX0ZVTkNUSU9OX18s
IGNoKTsKPiArICAgIGlmIChjaC0+cGFyc2VyICYmIGNoLT53YWl0X2Rpc2NfYWNrKSB7Cj4gKyAg
ICAgICAgY2gtPnBhcnNlciA9IE5VTEw7Cj4gKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzIHN3aXRj
aCB0byB1c2JyZWRpcmhvc3QiLCBfX0ZVTkNUSU9OX18pOwo+ICsgICAgICAgIGNoLT51c2JyZWRp
cmhvc3QgPSBjaC0+aGlkZGVuX2hvc3Q7Cj4gKyAgICB9Cj4gKyAgICBjaC0+d2FpdF9kaXNjX2Fj
ayA9IDA7Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIHVzYnJlZGlyX2hlbGxvKHZvaWQgKnByaXYs
Cj4gKyAgICBzdHJ1Y3QgdXNiX3JlZGlyX2hlbGxvX2hlYWRlciAqaGVsbG8pCj4gK3sKPiArICAg
IFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoID0gcHJpdjsKPiArICAgIFNwaWNlVXNiQmFja2Vu
ZERldmljZSAqZCA9IGNoLT5hdHRhY2hlZDsKPiArICAgIFNwaWNlVXNiRW11bGF0ZWREZXZpY2Ug
KmVkZXYgPSBkID8gZC0+ZWRldiA6IE5VTEw7Cj4gKyAgICBzdHJ1Y3QgdXNiX3JlZGlyX2Rldmlj
ZV9jb25uZWN0X2hlYWRlciBkZXZpY2VfY29ubmVjdDsKPiArICAgIHN0cnVjdCB1c2JfcmVkaXJf
ZXBfaW5mb19oZWFkZXIgZXBfaW5mbyA9IHsgMCB9Owo+ICsgICAgc3RydWN0IHVzYl9yZWRpcl9p
bnRlcmZhY2VfaW5mb19oZWFkZXIgaW50ZXJmYWNlX2luZm8gPSB7IDAgfTsKPiArICAgIHVpbnQ4
X3QgKmNmZzsKPiArICAgIHVpbnQxNl90IHNpemUsIG9mZnNldCA9IDA7Cj4gKyAgICBTUElDRV9E
RUJVRygiJXMgJXAgJXNhdHRhY2hlZCAlcyIsIF9fRlVOQ1RJT05fXywgY2gsCj4gKyAgICAgICAg
ZWRldiA/ICIiIDogIm5vdCAiLCAgaGVsbG8gPyAiIiA6ICIoaW50ZXJuYWwpIik7Cj4gKwo+ICsg
ICAgaWYgKGhlbGxvKSB7Cj4gKyAgICAgICAgY2gtPmhlbGxvX2RvbmVfcGFyc2VyID0gMTsKPiAr
ICAgIH0KPiArICAgIGlmICghZWRldikgewo+ICsgICAgICAgIHJldHVybjsKPiArICAgIH0KPiAr
ICAgIGlmICghZGV2aWNlX29wcyhlZGV2KS0+Z2V0X2Rlc2NyaXB0b3IoZWRldiwgTElCVVNCX0RU
X0NPTkZJRywgMCwgKHZvaWQKPiAqKikmY2ZnLCAmc2l6ZSkpIHsKPiArICAgICAgICByZXR1cm47
Cj4gKyAgICB9Cj4gKyAgICB3aGlsZSAoKG9mZnNldCArIDEpIDwgc2l6ZSkgewo+ICsgICAgICAg
IHVpbnQ4X3QgbGVuICA9IGNmZ1tvZmZzZXRdOwo+ICsgICAgICAgIHVpbnQ4X3QgdHlwZSA9IGNm
Z1tvZmZzZXQgKyAxXTsKPiArICAgICAgICBpZiAoKG9mZnNldCArIGxlbikgPiBzaXplKSB7Cj4g
KyAgICAgICAgICAgIGJyZWFrOwo+ICsgICAgICAgIH0KPiArICAgICAgICBpZiAodHlwZSA9PSBM
SUJVU0JfRFRfSU5URVJGQUNFKSB7Cj4gKyAgICAgICAgICAgIHVpbnQzMl90IGkgPSBpbnRlcmZh
Y2VfaW5mby5pbnRlcmZhY2VfY291bnQ7Cj4gKyAgICAgICAgICAgIHVpbnQ4X3QgY2xhc3MsIHN1
YmNsYXNzLCBwcm90b2NvbDsKPiArICAgICAgICAgICAgY2xhc3MgPSBjZmdbb2Zmc2V0ICsgNV07
Cj4gKyAgICAgICAgICAgIHN1YmNsYXNzID0gY2ZnW29mZnNldCArIDZdOwo+ICsgICAgICAgICAg
ICBwcm90b2NvbCA9IGNmZ1tvZmZzZXQgKyA3XTsKPiArICAgICAgICAgICAgaW50ZXJmYWNlX2lu
Zm8uaW50ZXJmYWNlX2NsYXNzW2ldID0gY2xhc3M7Cj4gKyAgICAgICAgICAgIGludGVyZmFjZV9p
bmZvLmludGVyZmFjZV9zdWJjbGFzc1tpXSA9IHN1YmNsYXNzOwo+ICsgICAgICAgICAgICBpbnRl
cmZhY2VfaW5mby5pbnRlcmZhY2VfcHJvdG9jb2xbaV0gPSBwcm90b2NvbDsKPiArICAgICAgICAg
ICAgaW50ZXJmYWNlX2luZm8uaW50ZXJmYWNlX2NvdW50Kys7Cj4gKyAgICAgICAgICAgIFNQSUNF
X0RFQlVHKCIlcyBJRiVkOiAlZC8lZC8lZCIsIF9fRlVOQ1RJT05fXywgaSwgY2xhc3MsCj4gc3Vi
Y2xhc3MsIHByb3RvY29sKTsKPiArICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gTElCVVNCX0RU
X0VORFBPSU5UKSB7Cj4gKyAgICAgICAgICAgIHVpbnQ4X3QgYWRkcmVzcyA9IGNmZ1tvZmZzZXQg
KyAyXTsKPiArICAgICAgICAgICAgdWludDE2X3QgbWF4X3BhY2tldF9zaXplID0gMHgxMDAgKiBj
Zmdbb2Zmc2V0ICsgNV0gKyBjZmdbb2Zmc2V0Cj4gKyA0XTsKPiArICAgICAgICAgICAgdWludDhf
dCBpbmRleCA9IGFkZHJlc3MgJiAweGY7Cj4gKyAgICAgICAgICAgIGlmIChhZGRyZXNzICYgMHg4
MCkgaW5kZXggKz0gMHgxMDsKPiArICAgICAgICAgICAgZXBfaW5mby50eXBlW2luZGV4XSA9IGNm
Z1tvZmZzZXQgKyAzXSAmIDB4MzsKPiArICAgICAgICAgICAgZXBfaW5mby5tYXhfcGFja2V0X3Np
emVbaW5kZXhdID0gbWF4X3BhY2tldF9zaXplOwo+ICsgICAgICAgICAgICBTUElDRV9ERUJVRygi
JXMgRVBbJTAyWF06ICVkLyVkIiwgX19GVU5DVElPTl9fLCBpbmRleCwKPiBlcF9pbmZvLnR5cGVb
aW5kZXhdLCBtYXhfcGFja2V0X3NpemUpOwo+ICsgICAgICAgIH0KPiArICAgICAgICBvZmZzZXQg
Kz0gbGVuOwo+ICsgICAgfQo+ICsKPiArICAgIHVzYnJlZGlycGFyc2VyX3NlbmRfaW50ZXJmYWNl
X2luZm8oY2gtPnBhcnNlciwgJmludGVyZmFjZV9pbmZvKTsKPiArICAgIHVzYnJlZGlycGFyc2Vy
X3NlbmRfZXBfaW5mbyhjaC0+cGFyc2VyLCAmZXBfaW5mbyk7Cj4gKwo+ICsgICAgZGV2aWNlX2Nv
bm5lY3QuZGV2aWNlX2NsYXNzID0gMDsgLy9kLT5kZXZpY2VfaW5mby5jbGFzczsKPiArICAgIGRl
dmljZV9jb25uZWN0LmRldmljZV9zdWJjbGFzcyA9IDA7IC8vZC0+ZGV2aWNlX2luZm8uc3ViY2xh
c3M7Cj4gKyAgICBkZXZpY2VfY29ubmVjdC5kZXZpY2VfcHJvdG9jb2wgPSAwOyAvL2QtPmRldmlj
ZV9pbmZvLnByb3RvY29sOzsKPiArICAgIGRldmljZV9jb25uZWN0LnZlbmRvcl9pZCA9IGQtPmRl
dmljZV9pbmZvLnZpZDsKPiArICAgIGRldmljZV9jb25uZWN0LnByb2R1Y3RfaWQgPSBkLT5kZXZp
Y2VfaW5mby5waWQ7Cj4gKyAgICBkZXZpY2VfY29ubmVjdC5kZXZpY2VfdmVyc2lvbl9iY2QgPSBk
LT5kZXZpY2VfaW5mby5iY2RVU0I7Cj4gKyAgICBkZXZpY2VfY29ubmVjdC5zcGVlZCA9IHVzYl9y
ZWRpcl9zcGVlZF9oaWdoOwo+ICsgICAgdXNicmVkaXJwYXJzZXJfc2VuZF9kZXZpY2VfY29ubmVj
dChjaC0+cGFyc2VyLCAmZGV2aWNlX2Nvbm5lY3QpOwo+ICsgICAgdXNicmVkaXJfd3JpdGVfZmx1
c2hfY2FsbGJhY2soY2gpOwo+ICt9Cj4gKwo+ICtzdGF0aWMgdm9pZCBpbml0aWFsaXplX3BhcnNl
cihTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCwgZ2Jvb2xlYW4gZG9faGVsbG8pCj4gK3sKPiAr
ICAgIHVpbnQzMl90IGZsYWdzLCBjYXBzW1VTQl9SRURJUl9DQVBTX1NJWkVdID0geyAwIH07Cj4g
Kwo+ICsgICAgZ19yZXR1cm5faWZfZmFpbChjaC0+aGlkZGVuX3BhcnNlciAhPSBOVUxMKTsKPiAr
ICAgIGlmIChjaC0+cGFyc2VyX2luaXRfZG9uZSkgewo+ICsgICAgICAgIGlmIChjaC0+cGFyc2Vy
X3dpdGhfaGVsbG8gIT0gZG9faGVsbG8pIHsKPiArICAgICAgICAgICAgZ19yZXR1cm5faWZfcmVh
Y2hlZCgpOwo+ICsgICAgICAgIH0KPiArICAgICAgICByZXR1cm47Cj4gKyAgICB9Cj4gKwo+ICsg
ICAgY2gtPnBhcnNlcl9pbml0X2RvbmUgPSAxOwo+ICsgICAgY2gtPnBhcnNlcl93aXRoX2hlbGxv
ID0gZG9faGVsbG87Cj4gKyAgICBmbGFncyA9IHVzYnJlZGlycGFyc2VyX2ZsX3dyaXRlX2NiX293
bnNfYnVmZmVyIHwKPiB1c2JyZWRpcnBhcnNlcl9mbF91c2JfaG9zdDsKPiArCj4gKyAgICBpZiAo
ZG9faGVsbG8pIHsKPiArICAgICAgICBjaC0+aGVsbG9fc2VudCA9IDE7CgpJbiB3aGljaCBjYXNl
IHlvdSBuZWVkIHRvIGRvIHRoZSBoZWxsbyBpbiB0aGUgcGFyc2VyIGluc3RlYWQgb2YgdGhlIGhv
c3Q/ClRoaXMgY291bGQgY2F1c2UgaXNzdWVzIHN3aXRjaGluZyBmcm9tIHBhcnNlciBiYWNrIHRv
IGhvc3QgaW4gY2FzZSB5b3UKcmVtb3ZlIGFuIGVtdWxhdGVkIGRldmljZSBhbmQgeW91IGFkZCBh
IHJlYWwgb25lLgoKPiArICAgICAgICBjaC0+aG9zdF9jYXBzIHw9IDEgPDwgdXNiX3JlZGlyX2Nh
cF9jb25uZWN0X2RldmljZV92ZXJzaW9uOwo+ICsgICAgICAgIGNoLT5ob3N0X2NhcHMgfD0gMSA8
PCB1c2JfcmVkaXJfY2FwX2RldmljZV9kaXNjb25uZWN0X2FjazsKPiArICAgICAgICBjaC0+aG9z
dF9jYXBzIHw9IDEgPDwgdXNiX3JlZGlyX2NhcF9lcF9pbmZvX21heF9wYWNrZXRfc2l6ZTsKPiAr
ICAgICAgICBjaC0+aG9zdF9jYXBzIHw9IDEgPDwgdXNiX3JlZGlyX2NhcF82NGJpdHNfaWRzOwo+
ICsgICAgICAgIGNoLT5ob3N0X2NhcHMgfD0gMSA8PCB1c2JfcmVkaXJfY2FwXzMyYml0c19idWxr
X2xlbmd0aDsKPiArICAgIH0gZWxzZSB7Cj4gKyAgICAgICAgZmxhZ3MgfD0gdXNicmVkaXJwYXJz
ZXJfZmxfbm9faGVsbG87Cj4gKyAgICB9Cj4gKwo+ICsgICAgaWYgKGNoLT5ob3N0X2NhcHMgJiAo
MSA8PCB1c2JfcmVkaXJfY2FwX2Nvbm5lY3RfZGV2aWNlX3ZlcnNpb24pKSB7Cj4gKyAgICAgICAg
dXNicmVkaXJwYXJzZXJfY2Fwc19zZXRfY2FwKGNhcHMsCj4gdXNiX3JlZGlyX2NhcF9jb25uZWN0
X2RldmljZV92ZXJzaW9uKTsKPiArICAgIH0KPiArICAgIHVzYnJlZGlycGFyc2VyX2NhcHNfc2V0
X2NhcChjYXBzLCB1c2JfcmVkaXJfY2FwX2ZpbHRlcik7Cj4gKyAgICBpZiAoY2gtPmhvc3RfY2Fw
cyAmICgxIDw8IHVzYl9yZWRpcl9jYXBfZGV2aWNlX2Rpc2Nvbm5lY3RfYWNrKSkgewo+ICsgICAg
ICAgIHVzYnJlZGlycGFyc2VyX2NhcHNfc2V0X2NhcChjYXBzLAo+IHVzYl9yZWRpcl9jYXBfZGV2
aWNlX2Rpc2Nvbm5lY3RfYWNrKTsKPiArICAgIH0KPiArICAgIGlmIChjaC0+aG9zdF9jYXBzICYg
KDEgPDwgdXNiX3JlZGlyX2NhcF9lcF9pbmZvX21heF9wYWNrZXRfc2l6ZSkpIHsKPiArICAgICAg
ICB1c2JyZWRpcnBhcnNlcl9jYXBzX3NldF9jYXAoY2FwcywKPiB1c2JfcmVkaXJfY2FwX2VwX2lu
Zm9fbWF4X3BhY2tldF9zaXplKTsKPiArICAgIH0KPiArICAgIGlmIChjaC0+aG9zdF9jYXBzICYg
KDEgPDwgdXNiX3JlZGlyX2NhcF82NGJpdHNfaWRzKSkgewo+ICsgICAgICAgIHVzYnJlZGlycGFy
c2VyX2NhcHNfc2V0X2NhcChjYXBzLCB1c2JfcmVkaXJfY2FwXzY0Yml0c19pZHMpOwo+ICsgICAg
fQo+ICsgICAgaWYgKGNoLT5ob3N0X2NhcHMgJiAoMSA8PCB1c2JfcmVkaXJfY2FwXzMyYml0c19i
dWxrX2xlbmd0aCkpIHsKPiArICAgICAgICB1c2JyZWRpcnBhcnNlcl9jYXBzX3NldF9jYXAoY2Fw
cywgdXNiX3JlZGlyX2NhcF8zMmJpdHNfYnVsa19sZW5ndGgpOwo+ICsgICAgfQo+ICsgICAgaWYg
KGNoLT5ob3N0X2NhcHMgJiAoMSA8PCB1c2JfcmVkaXJfY2FwX2J1bGtfc3RyZWFtcykpIHsKPiAr
ICAgICAgICB1c2JyZWRpcnBhcnNlcl9jYXBzX3NldF9jYXAoY2FwcywgdXNiX3JlZGlyX2NhcF9i
dWxrX3N0cmVhbXMpOwo+ICsgICAgfQo+ICsgICAgdXNicmVkaXJwYXJzZXJfaW5pdChjaC0+aGlk
ZGVuX3BhcnNlciwgUEFDS0FHRV9TVFJJTkcsIGNhcHMsCj4gVVNCX1JFRElSX0NBUFNfU0laRSwg
ZmxhZ3MpOwo+ICt9Cj4gKwo+ICsvKgo+ICsgICAgV2UgY2FuIGluaXRpYWxpemUgdGhlIHVzYnJl
ZGlycGFyc2VyIHdpdGggSEVMTE8gZW5hYmxlZCBvbmx5IGluIGNhc2UKPiArICAgIHRoZSBsaWJ1
c2IgaXMgbm90IGFjdGl2ZSBhbmQgdGhlIHVzYnJlZGlyaG9zdCBkb2VzIG5vdCBmdW5jdGlvbi4K
PiArICAgIFRoZW4gdGhlIHBhcnNlciBzZW5kcyBzZXNzaW9uIEhFTExPIGFuZCByZWNlaXZlcyBz
ZXJ2ZXIncyByZXNwb25zZS4KPiArICAgIE90aGVyd2lzZSAodXNicmVkaXJwYXJzZXIgaW5pdGlh
bGl6ZWQgd2l0aCBIRUxMTyBkaXNhYmxlZCk6Cj4gKyAgICAtIHRoZSB1c2JyZWRpcmhvc3Qgc2Vu
ZHMgc2Vzc2lvbiBIRUxMTwo+ICsgICAgLSB3ZSBsb29rIGludG8gaXQgdG8ga25vdyBzZXQgb2Yg
Y2FwYWJpbGl0aWVzIHdlIHNoYWxsIGluaXRpYWxpemUKPiArICAgICAgdGhlIHBhcnNlciB3aXRo
Cj4gKyAgICAtIHdoZW4gd2UgcmVjZWl2ZSBzZXJ2ZXIncyByZXNwb25zZSB0byBIRUxMTyB3ZSBw
cm92aWRlIGl0IGFsc28gdG8KPiArICAgICAgcGFyc2VyIHRvIGxldCBpdCBzeW5jaHJvbml6ZSB3
aXRoIHNlcnZlcidzIGNhcGFiaWxpdGllcwo+ICsqLwo+ICtzdGF0aWMgc3RydWN0IHVzYnJlZGly
cGFyc2VyICpjcmVhdGVfcGFyc2VyKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoKQo+ICt7Cj4g
KyAgICBzdHJ1Y3QgdXNicmVkaXJwYXJzZXIgKnBhcnNlciA9IHVzYnJlZGlycGFyc2VyX2NyZWF0
ZSgpOwo+ICsKPiArICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKHBhcnNlciAhPSBOVUxMLCBOVUxM
KTsKPiArCj4gKyAgICBwYXJzZXItPnByaXYgPSBjaDsKPiArICAgIHBhcnNlci0+bG9nX2Z1bmMg
PSB1c2JyZWRpcl9sb2c7Cj4gKyAgICBwYXJzZXItPnJlYWRfZnVuYyA9IHVzYnJlZGlyX3JlYWRf
Y2FsbGJhY2s7Cj4gKyAgICBwYXJzZXItPndyaXRlX2Z1bmMgPSB1c2JyZWRpcl93cml0ZV9jYWxs
YmFjazsKPiArICAgIHBhcnNlci0+cmVzZXRfZnVuYyA9IHVzYnJlZGlyX2RldmljZV9yZXNldDsK
PiArICAgIHBhcnNlci0+c2V0X2NvbmZpZ3VyYXRpb25fZnVuYyA9IHVzYnJlZGlyX3NldF9jb25m
aWd1cmF0aW9uOwo+ICsgICAgcGFyc2VyLT5nZXRfY29uZmlndXJhdGlvbl9mdW5jID0gdXNicmVk
aXJfZ2V0X2NvbmZpZ3VyYXRpb247Cj4gKyAgICBwYXJzZXItPnNldF9hbHRfc2V0dGluZ19mdW5j
ID0gdXNicmVkaXJfc2V0X2FsdF9zZXR0aW5nOwo+ICsgICAgcGFyc2VyLT5nZXRfYWx0X3NldHRp
bmdfZnVuYyA9IHVzYnJlZGlyX2dldF9hbHRfc2V0dGluZzsKPiArICAgIHBhcnNlci0+Y2FuY2Vs
X2RhdGFfcGFja2V0X2Z1bmMgPSB1c2JyZWRpcl9jYW5jZWxfZGF0YTsKPiArICAgIHBhcnNlci0+
Y29udHJvbF9wYWNrZXRfZnVuYyA9IHVzYnJlZGlyX2NvbnRyb2xfcGFja2V0Owo+ICsgICAgcGFy
c2VyLT5idWxrX3BhY2tldF9mdW5jID0gdXNicmVkaXJfYnVsa19wYWNrZXQ7Cj4gKyAgICBwYXJz
ZXItPmFsbG9jX2xvY2tfZnVuYyA9IHVzYnJlZGlyX2FsbG9jX2xvY2s7Cj4gKyAgICBwYXJzZXIt
PmxvY2tfZnVuYyA9IHVzYnJlZGlyX2xvY2tfbG9jazsKPiArICAgIHBhcnNlci0+dW5sb2NrX2Z1
bmMgPSB1c2JyZWRpcl91bmxvY2tfbG9jazsKPiArICAgIHBhcnNlci0+ZnJlZV9sb2NrX2Z1bmMg
PSB1c2JyZWRpcl9mcmVlX2xvY2s7Cj4gKyAgICBwYXJzZXItPmhlbGxvX2Z1bmMgPSB1c2JyZWRp
cl9oZWxsbzsKPiArICAgIHBhcnNlci0+ZmlsdGVyX3JlamVjdF9mdW5jID0gdXNicmVkaXJfZmls
dGVyX3JlamVjdDsKPiArICAgIHBhcnNlci0+ZGV2aWNlX2Rpc2Nvbm5lY3RfYWNrX2Z1bmMgPSB1
c2JyZWRpcl9kZXZpY2VfZGlzY29ubmVjdF9hY2s7Cj4gKyAgICBwYXJzZXItPmludGVyZmFjZV9p
bmZvX2Z1bmMgPSB1c2JyZWRpcl9pbnRlcmZhY2VfaW5mbzsKPiArICAgIHBhcnNlci0+ZXBfaW5m
b19mdW5jID0gdXNicmVkaXJfaW50ZXJmYWNlX2VwX2luZm87Cj4gKyAgICBwYXJzZXItPmZpbHRl
cl9maWx0ZXJfZnVuYyA9IHVzYnJlZGlyX2ZpbHRlcl9maWx0ZXI7Cj4gKwo+ICsgICAgcmV0dXJu
IHBhcnNlcjsKPiArfQo+ICsKPiArc3RhdGljIGdib29sZWFuIGF0dGFjaF9lZGV2KFNwaWNlVXNi
QmFja2VuZENoYW5uZWwgKmNoLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VV
c2JCYWNrZW5kRGV2aWNlICpkZXYsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBHRXJy
b3IgKiplcnJvcikKPiArewo+ICsgICAgaWYgKCFkZXYtPmVkZXYpIHsKPiArICAgICAgICBnX3Nl
dF9lcnJvcihlcnJvciwgU1BJQ0VfQ0xJRU5UX0VSUk9SLCBTUElDRV9DTElFTlRfRVJST1JfRkFJ
TEVELAo+ICsgICAgICAgICAgIF8oIkZhaWxlZCB0byByZWRpcmVjdCBkZXZpY2UgJWQiKSwgMSk7
CgpNaW5vcjogSSB3b3VsZCBzYXkgbW9yZSBhbiBhc3NlcnQgbGV2ZWwgZXJyb3IsIHRoZSBkZXZp
Y2Ugc2hvdWxkIGJlIHJlYWwgb3IgZW11bGF0ZWQuCgo+ICsgICAgICAgIHJldHVybiBGQUxTRTsK
PiArICAgIH0KPiArICAgIGlmIChjaC0+dXNicmVkaXJob3N0ICYmICFjaC0+aGVsbG9fZG9uZV9w
YXJzZXIpIHsKPiArICAgICAgICAvKgo+ICsgICAgICAgICAgICB3ZSBjYW4ndCBpbml0aWFsaXpl
IHBhcnNlciB1bnRpbCB3ZSBzZWUgaGVsbG8gZnJvbSB1c2JyZWRpcgo+ICsgICAgICAgICAgICBh
bmQgdGhlIHBhcnNlciBjYW4ndCB3b3JrIHVudGlsIGl0IHNlZXMgdGhlIGhlbGxvIHJlc3BvbnNl
Lgo+ICsgICAgICAgICAgICB0aGlzIGlzIGNhc2Ugb2YgYXV0b2Nvbm5lY3Qgd2hlbiBlbXVsYXRl
ZCBkZXZpY2UgaXMgYXR0YWNoZWQKPiArICAgICAgICAgICAgYmVmb3JlIHRoZSBjaGFubmVsIGlz
IHVwCj4gKyAgICAgICAgKi8KPiArICAgICAgICBTUElDRV9ERUJVRygiJXMgd2FpdGluZyB1bnRp
bCB0aGUgY2hhbm5lbCBpcyByZWFkeSIsIF9fRlVOQ1RJT05fXyk7Cj4gKwo+ICsgICAgfSBlbHNl
IHsKPiArICAgICAgICBpbml0aWFsaXplX3BhcnNlcihjaCwgY2gtPmhpZGRlbl9ob3N0ID09IE5V
TEwpOwo+ICsgICAgICAgIGNoLT51c2JyZWRpcmhvc3QgPSBOVUxMOwo+ICsgICAgICAgIGNoLT5w
YXJzZXIgPSBjaC0+aGlkZGVuX3BhcnNlcjsKPiArICAgIH0KPiArICAgIGNoLT53YWl0X2Rpc2Nf
YWNrID0gMDsKPiArICAgIGNoLT5hdHRhY2hlZCA9IGRldjsKPiArICAgIGRldi0+YXR0YWNoZWRf
dG8gPSBjaDsKPiArICAgIGRldmljZV9vcHMoZGV2LT5lZGV2KS0+YXR0YWNoKGRldi0+ZWRldiwg
Y2gtPmhpZGRlbl9wYXJzZXIpOwo+ICsgICAgaWYgKGNoLT5oZWxsb19kb25lX3BhcnNlcikgewo+
ICsgICAgICAgIC8qIHNlbmQgZGV2aWNlIGluZm8gKi8KPiArICAgICAgICB1c2JyZWRpcl9oZWxs
byhjaCwgTlVMTCk7Cj4gKyAgICB9Cj4gKyAgICByZXR1cm4gVFJVRTsKPiArfQo+ICsKPiAgZ2Jv
b2xlYW4gc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9hdHRhY2goU3BpY2VVc2JCYWNrZW5kQ2hh
bm5lbCAqY2gsCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNw
aWNlVXNiQmFja2VuZERldmljZSAqZGV2LAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBHRXJyb3IgKiplcnJvcikKPiBAQCAtNzA2LDcgKzEyMTMsMTMgQEAgZ2Jv
b2xlYW4KPiBzcGljZV91c2JfYmFja2VuZF9jaGFubmVsX2F0dGFjaChTcGljZVVzYkJhY2tlbmRD
aGFubmVsICpjaCwKPiAgCj4gICAgICBnX3JldHVybl92YWxfaWZfZmFpbChkZXYgIT0gTlVMTCwg
RkFMU0UpOwo+ICAKPiArICAgIGlmICghZGV2LT5saWJ1c2JfZGV2aWNlKSB7Cj4gKyAgICAgICAg
cmV0dXJuIGF0dGFjaF9lZGV2KGNoLCBkZXYsIGVycm9yKTsKPiArICAgIH0KPiArCj4gICAgICBs
aWJ1c2JfZGV2aWNlX2hhbmRsZSAqaGFuZGxlID0gTlVMTDsKPiArICAgIGNoLT51c2JyZWRpcmhv
c3QgPSBjaC0+aGlkZGVuX2hvc3Q7Cj4gKyAgICBjaC0+cGFyc2VyID0gTlVMTDsKPiAgCj4gICAg
ICAvKgo+ICAgICAgICAgVW5kZXIgV2luZG93cyB3ZSBuZWVkIHRvIGF2b2lkIHVwZGF0aW5nCj4g
QEAgLTc0MCwxOCArMTI1MywzMyBAQCBnYm9vbGVhbgo+IHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5u
ZWxfYXR0YWNoKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLAo+ICAKPiAgdm9pZCBzcGljZV91
c2JfYmFja2VuZF9jaGFubmVsX2RldGFjaChTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCkKPiAg
ewo+ICsgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkID0gY2gtPmF0dGFjaGVkOwo+ICsgICAg
U3BpY2VVc2JFbXVsYXRlZERldmljZSAqZWRldiA9IGQgPyBkLT5lZGV2IDogTlVMTDsKPiAgICAg
IFNQSUNFX0RFQlVHKCIlcyA+PiBjaCAlcCwgd2FzIGF0dGFjaGVkICVwIiwgX19GVU5DVElPTl9f
LCBjaCwKPiAgICAgIGNoLT5hdHRhY2hlZCk7Cj4gLSAgICBpZiAoIWNoLT5hdHRhY2hlZCkgewo+
ICsgICAgaWYgKCFkKSB7Cj4gICAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiBub3RoaW5nIHRvIGRl
dGFjaCIsIF9fRlVOQ1RJT05fXyk7Cj4gICAgICAgICAgcmV0dXJuOwo+ICAgICAgfQo+ICAgICAg
aWYgKGNoLT51c2JyZWRpcmhvc3QpIHsKPiAgICAgICAgICAvKiBpdCB3aWxsIGNhbGwgbGlidXNi
X2Nsb3NlIGludGVybmFsbHkgKi8KPiAgICAgICAgICB1c2JyZWRpcmhvc3Rfc2V0X2RldmljZShj
aC0+dXNicmVkaXJob3N0LCBOVUxMKTsKPiArICAgIH0gZWxzZSBpZiAoY2gtPnBhcnNlcikgewo+
ICsgICAgICAgIGlmIChlZGV2KSB7Cj4gKyAgICAgICAgICAgIGRldmljZV9vcHMoZWRldiktPmRl
dGFjaChlZGV2KTsKPiArICAgICAgICB9Cj4gKyAgICAgICAgdXNicmVkaXJwYXJzZXJfc2VuZF9k
ZXZpY2VfZGlzY29ubmVjdChjaC0+cGFyc2VyKTsKPiArICAgICAgICB1c2JyZWRpcl93cml0ZV9m
bHVzaF9jYWxsYmFjayhjaCk7Cj4gKyAgICAgICAgY2gtPndhaXRfZGlzY19hY2sgPSB1c2JyZWRp
cnBhcnNlcl9wZWVyX2hhc19jYXAoY2gtPnBhcnNlciwKPiArCj4gdXNiX3JlZGlyX2NhcF9kZXZp
Y2VfZGlzY29ubmVjdF9hY2spOwo+ICsgICAgICAgIGlmICghY2gtPndhaXRfZGlzY19hY2spIHsK
PiArICAgICAgICAgICAgY2gtPnVzYnJlZGlyaG9zdCA9IGNoLT5oaWRkZW5faG9zdDsKPiArICAg
ICAgICAgICAgY2gtPnBhcnNlciA9IE5VTEw7Cj4gKyAgICAgICAgfQo+ICAgICAgfQo+ICAgICAg
U1BJQ0VfREVCVUcoIiVzIGNoICVwLCBkZXRhY2ggZG9uZSIsIF9fRlVOQ1RJT05fXywgY2gpOwo+
ICAgICAgY2gtPmF0dGFjaGVkLT5hdHRhY2hlZF90byA9IE5VTEw7Cj4gICAgICBjaC0+YXR0YWNo
ZWQgPSBOVUxMOwo+ICsgICAgY2gtPnJlamVjdGVkID0gMDsKPiAgfQo+ICAKPiAgU3BpY2VVc2JC
YWNrZW5kQ2hhbm5lbCAqc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9uZXcoU3BpY2VVc2JCYWNr
ZW5kICpiZSwKPiBAQCAtNzY2LDI2ICsxMjk0LDMzIEBAIFNwaWNlVXNiQmFja2VuZENoYW5uZWwK
PiAqc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9uZXcoU3BpY2VVc2JCYWNrZW5kICpiZSwKPiAg
ICAgIGNoLT51c2VyX2RhdGEgPSBTUElDRV9VU0JSRURJUl9DSEFOTkVMKHVzZXJfZGF0YSk7Cj4g
ICAgICBpZiAoYmUtPmxpYnVzYl9jb250ZXh0KSB7CgpUaGlzIGNhbiBuZXZlciBiZSBOVUxMLCBp
ZiB3ZSBhcmUgbm90IGFibGUgdG8gYWxsb2NhdGUgaXQgaW5zaWRlCnNwaWNlX3VzYl9iYWNrZW5k
X25ldyB0aGUgZnVuY3Rpb24gcmV0dXJucyBOVUxMLgpUaGlzIHNob3VsZCBiZSBpbiBhIHByZWxp
bWluYXJ5IHBhdGNoIHRvIG1ha2UgdGhpcyBjbGVhci4KCj4gICAgICAgICAgY2gtPmJhY2tlbmQg
PSBiZTsKPiAtICAgICAgICBjaC0+dXNicmVkaXJob3N0ID0gdXNicmVkaXJob3N0X29wZW5fZnVs
bCgKPiAtICAgICAgICAgICAgYmUtPmxpYnVzYl9jb250ZXh0LAo+IC0gICAgICAgICAgICBOVUxM
LAo+IC0gICAgICAgICAgICB1c2JyZWRpcl9sb2csCj4gLSAgICAgICAgICAgIHVzYnJlZGlyX3Jl
YWRfY2FsbGJhY2ssCj4gLSAgICAgICAgICAgIHVzYnJlZGlyX3dyaXRlX2NhbGxiYWNrLAo+IC0g
ICAgICAgICAgICB1c2JyZWRpcl93cml0ZV9mbHVzaF9jYWxsYmFjaywKPiAtICAgICAgICAgICAg
dXNicmVkaXJfYWxsb2NfbG9jaywKPiAtICAgICAgICAgICAgdXNicmVkaXJfbG9ja19sb2NrLAo+
IC0gICAgICAgICAgICB1c2JyZWRpcl91bmxvY2tfbG9jaywKPiAtICAgICAgICAgICAgdXNicmVk
aXJfZnJlZV9sb2NrLAo+IC0gICAgICAgICAgICBjaCwgUEFDS0FHRV9TVFJJTkcsCj4gLSAgICAg
ICAgICAgIHNwaWNlX3V0aWxfZ2V0X2RlYnVnKCkgPyB1c2JyZWRpcnBhcnNlcl9kZWJ1ZyA6Cj4g
dXNicmVkaXJwYXJzZXJfd2FybmluZywKPiAtICAgICAgICAgICAgdXNicmVkaXJob3N0X2ZsX3dy
aXRlX2NiX293bnNfYnVmZmVyKTsKPiArICAgICAgICBjaC0+dXNicmVkaXJob3N0ID0KPiArICAg
ICAgICAgICAgdXNicmVkaXJob3N0X29wZW5fZnVsbChiZS0+bGlidXNiX2NvbnRleHQsCj4gKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTlVMTCwKPiArICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB1c2JyZWRpcl9sb2csCj4gKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdXNicmVkaXJfcmVhZF9jYWxsYmFjaywKPiArICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB1c2JyZWRpcl93cml0ZV9jYWxsYmFjaywKPiArICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB1c2JyZWRpcl93cml0ZV9mbHVzaF9jYWxsYmFjaywK
PiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2JyZWRpcl9hbGxvY19sb2Nr
LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzYnJlZGlyX2xvY2tfbG9j
aywKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2JyZWRpcl91bmxvY2tf
bG9jaywKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2JyZWRpcl9mcmVl
X2xvY2ssCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2gsIFBBQ0tBR0Vf
U1RSSU5HLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwaWNlX3V0aWxf
Z2V0X2RlYnVnKCkgPwo+IHVzYnJlZGlycGFyc2VyX2RlYnVnIDoKPiArICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHVzYnJlZGlycGFyc2VyX3dhcm5pbmcsCj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNicmVkaXJob3N0X2ZsX3dyaXRlX2NiX293
bnNfYnVmZmVyKTsKPiAgICAgICAgICBnX3dhcm5faWZfZmFpbChjaC0+dXNicmVkaXJob3N0ICE9
IE5VTEwpOwo+ICAgICAgfQo+ICsKPiAgICAgIGlmIChjaC0+dXNicmVkaXJob3N0KSB7Cj4gLSAg
ICAgICAgdXNicmVkaXJob3N0X3NldF9idWZmZXJlZF9vdXRwdXRfc2l6ZV9jYihjaC0+dXNicmVk
aXJob3N0LAo+IHVzYnJlZGlyX2J1ZmZlcmVkX291dHB1dF9zaXplX2NhbGxiYWNrKTsKPiAtICAg
IH0gZWxzZSB7Cj4gLSAgICAgICAgZ19mcmVlKGNoKTsKPiArICAgICAgICBjaC0+aGlkZGVuX3Bh
cnNlciA9IGNyZWF0ZV9wYXJzZXIoY2gpOwo+ICsgICAgICAgIGNoLT5oaWRkZW5faG9zdCA9IGNo
LT51c2JyZWRpcmhvc3Q7Cj4gKyAgICAgICAgdXNicmVkaXJob3N0X3NldF9idWZmZXJlZF9vdXRw
dXRfc2l6ZV9jYihjaC0+dXNicmVkaXJob3N0LAo+ICsKPiB1c2JyZWRpcl9idWZmZXJlZF9vdXRw
dXRfc2l6ZV9jYWxsYmFjayk7Cj4gKyAgICB9Cj4gKwo+ICsgICAgaWYgKCFjaC0+aGlkZGVuX3Bh
cnNlcikgewo+ICsgICAgICAgIHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfZGVsZXRlKGNoKTsK
PiAgICAgICAgICBjaCA9IE5VTEw7Cj4gICAgICB9Cj4gIAo+IEBAIC03OTUsOSArMTMzMCwxNCBA
QCBTcGljZVVzYkJhY2tlbmRDaGFubmVsCj4gKnNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfbmV3
KFNwaWNlVXNiQmFja2VuZCAqYmUsCj4gIAo+ICB2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5u
ZWxfZmx1c2hfd3JpdGVzKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoKQo+ICB7Cj4gLSAgICBT
UElDRV9ERUJVRygiJXMgJXAsIGhvc3QgJXAiLCBfX0ZVTkNUSU9OX18sIGNoLCBjaC0+dXNicmVk
aXJob3N0KTsKPiArICAgIFNQSUNFX0RFQlVHKCIlcyAlcCBpcyB1cCIsIF9fRlVOQ1RJT05fXywg
Y2gpOwo+ICAgICAgaWYgKGNoLT51c2JyZWRpcmhvc3QpIHsKPiAgICAgICAgICB1c2JyZWRpcmhv
c3Rfd3JpdGVfZ3Vlc3RfZGF0YShjaC0+dXNicmVkaXJob3N0KTsKPiArICAgICAgICBpbml0aWFs
aXplX3BhcnNlcihjaCwgRkFMU0UpOwo+ICsgICAgfSBlbHNlIHsKPiArICAgICAgICBpbml0aWFs
aXplX3BhcnNlcihjaCwgVFJVRSk7CgpXaHkgaW5pdGlhbGl6ZV9wYXJzZSBpcyBjYWxsZWQgaGVy
ZT8KCj4gKyAgICAgICAgY2gtPnBhcnNlciA9IGNoLT5oaWRkZW5fcGFyc2VyOwo+ICsgICAgICAg
IHVzYnJlZGlycGFyc2VyX2RvX3dyaXRlKGNoLT5wYXJzZXIpOwo+ICAgICAgfQo+ICB9Cj4gIAo+
IEBAIC04MDcsMTIgKzEzNDcsMTYgQEAgdm9pZAo+IHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxf
ZGVsZXRlKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoKQo+ICAgICAgaWYgKCFjaCkgewo+ICAg
ICAgICAgIHJldHVybjsKPiAgICAgIH0KPiAtICAgIGlmIChjaC0+dXNicmVkaXJob3N0KSB7Cj4g
LSAgICAgICAgdXNicmVkaXJob3N0X2Nsb3NlKGNoLT51c2JyZWRpcmhvc3QpOwo+ICsgICAgaWYg
KGNoLT5oaWRkZW5faG9zdCkgewo+ICsgICAgICAgIHVzYnJlZGlyaG9zdF9jbG9zZShjaC0+aGlk
ZGVuX2hvc3QpOwo+ICsgICAgfQo+ICsgICAgaWYgKGNoLT5oaWRkZW5fcGFyc2VyKSB7Cj4gKyAg
ICAgICAgdXNicmVkaXJwYXJzZXJfZGVzdHJveShjaC0+aGlkZGVuX3BhcnNlcik7Cj4gICAgICB9
Cj4gIAo+ICAgICAgaWYgKGNoLT5ydWxlcykgewo+IC0gICAgICAgIGdfZnJlZShjaC0+cnVsZXMp
Owo+ICsgICAgICAgIC8qIHJ1bGVzIHdlcmUgYWxsb2NhdGVkIGJ5IHVzYnJlZGlycGFyc2VyICov
Cj4gKyAgICAgICAgZnJlZShjaC0+cnVsZXMpOwoKTWlub3IgOkkgc3VwcG9zZSB0aGlzIHNtYWxs
IGNoYW5nZSBjYW4gZ28gdG8gYSBwcmVsaW1pbmFyeSBwYXRjaCB0b28KCj4gICAgICB9Cj4gIAo+
ICAgICAgZ19mcmVlKGNoKTsKCkZyZWRpYW5vCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9zcGljZS1kZXZlbA==
