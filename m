Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 70FFC5F677
	for <lists+spice-devel@lfdr.de>; Thu,  4 Jul 2019 12:18:17 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0AF576E2F5;
	Thu,  4 Jul 2019 10:18:16 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail-wm1-f67.google.com (mail-wm1-f67.google.com
 [209.85.128.67])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 05ADB6E2F2
 for <spice-devel@lists.freedesktop.org>; Thu,  4 Jul 2019 10:18:14 +0000 (UTC)
Received: by mail-wm1-f67.google.com with SMTP id 207so5190577wma.1
 for <spice-devel@lists.freedesktop.org>; Thu, 04 Jul 2019 03:18:13 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=bcxqaAe7WyZn2WnigL3+95O3r3ul4g0QUHZk+QLlw8U=;
 b=E1RvKFqHkcRPF+dUnGM/5iimL+B5CZZU5JzieL5eDD9FudjlIuYum0tyhPCSBBIV7e
 UgZrf53ct0BazvyBV4OdPweuSvooM8Jfvalbhc4hXsDWQ9eMZL183vXVE6P9uEPewLmQ
 0SAKGi1YuwJzJNB6BSBZsZ+fhy85Qiy8QkEs9r65FCprzA50ECf9ATOVGNuAkwqpfTKQ
 Pdkc89kqYYZbGceIQeLZDFYJPTtl2SXONlMuxVr20NCKOGznz+zEUps2nUGSuF1oOr1t
 lZg8K2n0NmuBieFTmc/kLue92sBY11aWHVyO03KA3LiYE8pqjgq1m0H26gO/kPaaw1Zx
 xcPA==
X-Gm-Message-State: APjAAAVP86An+4TNsOQLKEaYzf1RxtdjFujKZBRxCm9KlCpHQLjOFsWv
 NU5mKyvPaDekyqXHBfZnSi7BWE2H86I=
X-Google-Smtp-Source: APXvYqzeDoPGIxxR+RitaZsUNmeBrR+S04m5EsIUqRzzmTXHnjgXxeuVgGNUZutANyR5h27hnZY2hg==
X-Received: by 2002:a1c:b189:: with SMTP id a131mr12431817wmf.7.1562235492461; 
 Thu, 04 Jul 2019 03:18:12 -0700 (PDT)
Received: from pinea.redhat.com ([2001:861:3440:6a0:71b6:dd5f:657d:58e3])
 by smtp.gmail.com with ESMTPSA id n5sm3825911wmi.21.2019.07.04.03.18.11
 for <spice-devel@lists.freedesktop.org>
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Thu, 04 Jul 2019 03:18:11 -0700 (PDT)
From: Kevin Pouget <kpouget@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Thu,  4 Jul 2019 12:18:10 +0200
Message-Id: <20190704101810.10268-1-kpouget@redhat.com>
X-Mailer: git-send-email 2.21.0
MIME-Version: 1.0
Subject: [Spice-devel] [PATCH spice-server] reds:
 spice_server_set_video_codecs: fail when no codec can be installed
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

UHVibGljIGZ1bmN0aW9uIHNwaWNlX3NlcnZlcl9zZXRfdmlkZW9fY29kZWNzOiByZXR1cm4gLTEg
aWYgbm8KZW5jb2Rlci9jb2RlYyBoYXMgYmVlbiBpbnN0YWxsZWQsIGluc3RlYWQgb2YgYWx3YXlz
IHJldHVybmluZyAwLgoKSW50ZXJuYWwgZnVuY3Rpb24gcmVkc19zZXRfdmlkZW9fY29kZWNzX2Zy
b21fc3RyaW5nOiByZXR1cm4gdGhlIG51bWJlcgpvZiBpbnZhbGlkIGVuY29kZXIvY29kZWMgZW50
cmllcyBmb3VuZCBpbiB0aGUgaW5wdXQgbGlzdCwgYW5kIHVwZGF0ZQp0aGUgaW5zdGFsbGVkIHBv
aW50ZXIgd2l0aCB0aGUgbnVtYmVyIG9mIGVuY29kZXIvY29kZWMgcGFpcnMKc3VjY2Vzc2Z1bGx5
IGluc3RhbGxlZC4KCi0tLQoKSSByZXdvcmtlZCB0aGlzIHBhdGNoIHRvIGxpbWl0IHRoZSBtb2Rp
ZmljYXRpb24gb2YgdGhlIHB1YmxpYwppbnRlcmZhY2UsIHNlZSBpbiB0aGUgZmlyc3QgcGFydCBv
ZiB0aGUgbWVzc2FnZSBhYm92ZS4KCi0tLQogc2VydmVyL3JlZHMuYyB8IDM1ICsrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKystLS0tCiAxIGZpbGUgY2hhbmdlZCwgMzEgaW5zZXJ0aW9ucygr
KSwgNCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9zZXJ2ZXIvcmVkcy5jIGIvc2VydmVyL3Jl
ZHMuYwppbmRleCBhNTFkNTc2ZS4uMTFjZjAzODQgMTAwNjQ0Ci0tLSBhL3NlcnZlci9yZWRzLmMK
KysrIGIvc2VydmVyL3JlZHMuYwpAQCAtMzgxNywxMiArMzgxNywyMiBAQCBzdGF0aWMgY2hhciog
cGFyc2VfbmV4dF92aWRlb19jb2RlYyhjaGFyICpjb2RlY3MsIGNoYXIgKiplbmNvZGVyLCBjaGFy
ICoqY29kZWMpCiAgICAgcmV0dXJuIGNvZGVjcyArIHN0cmNzcG4oY29kZWNzLCAiOyIpOwogfQoK
LXN0YXRpYyB2b2lkIHJlZHNfc2V0X3ZpZGVvX2NvZGVjc19mcm9tX3N0cmluZyhSZWRzU3RhdGUg
KnJlZHMsIGNvbnN0IGNoYXIgKmNvZGVjcykKKy8qIEVuYWJsZSB0aGUgZW5jb2RlcnMvY29kZWNz
IGZyb20gdGhlIGxpc3Qgc3BlY2lmaWVkIGluIEBjb2RlY3MuCisgKgorICogQHJlZHM6IHRoZSAj
UmVkc1N0YXRlIHRvIG1vZGlmeQorICogQGNvZGVjczogYSBjb2RlYyBzdHJpbmcgaW4gdGhlIGZv
bGxvd2luZyBmb3JtYXQ6IGVuY29kZXI6Y29kZWM7ZW5jb2Rlcjpjb2RlYworICogQGluc3RhbGxl
ZDogKG9wdGlvbmFsKTogYSBsb2NhdGlvbiB0byByZXR1cm4gdGhlIG51bWJlciBvZiBjb2RlY3Mg
c3VjY2Vzc2Z1bGwgaW5zdGFsbGVkCisgKiBAcmV0dXJuIC0xIGlmIEBjb2RlY3MgaXMgJU5VTEwg
KEBpbnN0YWxsZWQgaXMgbm90IG1vZGlmaWVkKSBvciB0aGUgbnVtYmVyIG9mIGludmFsaWQKKyAq
ICAgICAgICAgZW5jb2RlcnMvY29kZWNzIGZvdW5kIGluIEBjb2RlY3MuCisgKi8KK3N0YXRpYyBp
bnQgcmVkc19zZXRfdmlkZW9fY29kZWNzX2Zyb21fc3RyaW5nKFJlZHNTdGF0ZSAqcmVkcywgY29u
c3QgY2hhciAqY29kZWNzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgdW5zaWduZWQgaW50ICppbnN0YWxsZWQpCiB7CiAgICAgY2hhciAqZW5jb2Rlcl9uYW1l
LCAqY29kZWNfbmFtZTsKICAgICBHQXJyYXkgKnZpZGVvX2NvZGVjczsKKyAgICBpbnQgaW52YWxp
ZF9jb2RlY3MgPSAwOwoKLSAgICBnX3JldHVybl9pZl9mYWlsKGNvZGVjcyAhPSBOVUxMKTsKKyAg
ICBnX3JldHVybl92YWxfaWZfZmFpbChjb2RlY3MgIT0gTlVMTCwgLTEpOwoKICAgICBpZiAoc3Ry
Y21wKGNvZGVjcywgImF1dG8iKSA9PSAwKSB7CiAgICAgICAgIGNvZGVjcyA9IGRlZmF1bHRfdmlk
ZW9fY29kZWNzOwpAQCAtMzgzNSwxNSArMzg0NSwxOSBAQCBzdGF0aWMgdm9pZCByZWRzX3NldF92
aWRlb19jb2RlY3NfZnJvbV9zdHJpbmcoUmVkc1N0YXRlICpyZWRzLCBjb25zdCBjaGFyICpjb2Rl
YwogICAgICAgICB1aW50MzJfdCBlbmNvZGVyX2luZGV4LCBjb2RlY19pbmRleDsKICAgICAgICAg
aWYgKCFlbmNvZGVyX25hbWUgfHwgIWNvZGVjX25hbWUpIHsKICAgICAgICAgICAgIHNwaWNlX3dh
cm5pbmcoInNwaWNlOiBpbnZhbGlkIGVuY29kZXI6Y29kZWMgdmFsdWUgYXQgJXMiLCBjb2RlY3Mp
OworICAgICAgICAgICAgaW52YWxpZF9jb2RlY3MrKzsKCiAgICAgICAgIH0gZWxzZSBpZiAoIWdl
dF9uYW1lX2luZGV4KHZpZGVvX2VuY29kZXJfbmFtZXMsIGVuY29kZXJfbmFtZSwgJmVuY29kZXJf
aW5kZXgpKXsKICAgICAgICAgICAgIHNwaWNlX3dhcm5pbmcoInNwaWNlOiB1bmtub3duIHZpZGVv
IGVuY29kZXIgJXMiLCBlbmNvZGVyX25hbWUpOworICAgICAgICAgICAgaW52YWxpZF9jb2RlY3Mr
KzsKCiAgICAgICAgIH0gZWxzZSBpZiAoIWdldF9uYW1lX2luZGV4KHZpZGVvX2NvZGVjX25hbWVz
LCBjb2RlY19uYW1lLCAmY29kZWNfaW5kZXgpKSB7CiAgICAgICAgICAgICBzcGljZV93YXJuaW5n
KCJzcGljZTogdW5rbm93biB2aWRlbyBjb2RlYyAlcyIsIGNvZGVjX25hbWUpOworICAgICAgICAg
ICAgaW52YWxpZF9jb2RlY3MrKzsKCiAgICAgICAgIH0gZWxzZSBpZiAoIXZpZGVvX2VuY29kZXJf
cHJvY3NbZW5jb2Rlcl9pbmRleF0pIHsKICAgICAgICAgICAgIHNwaWNlX3dhcm5pbmcoInNwaWNl
OiB1bnN1cHBvcnRlZCB2aWRlbyBlbmNvZGVyICVzIiwgZW5jb2Rlcl9uYW1lKTsKKyAgICAgICAg
ICAgIGludmFsaWRfY29kZWNzKys7CgogICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgUmVk
VmlkZW9Db2RlYyBuZXdfY29kZWM7CkBAIC0zODY0LDYgKzM4NzgsMTIgQEAgc3RhdGljIHZvaWQg
cmVkc19zZXRfdmlkZW9fY29kZWNzX2Zyb21fc3RyaW5nKFJlZHNTdGF0ZSAqcmVkcywgY29uc3Qg
Y2hhciAqY29kZWMKICAgICB9CgogICAgIGdfZnJlZShjb2RlY3NfY29weSk7CisKKyAgICBpZiAo
aW5zdGFsbGVkKSB7CisgICAgICAgICppbnN0YWxsZWQgPSB2aWRlb19jb2RlY3MtPmxlbjsKKyAg
ICB9CisKKyAgICByZXR1cm4gaW52YWxpZF9jb2RlY3M7CiB9CgogU1BJQ0VfR05VQ19WSVNJQkxF
IGludCBzcGljZV9zZXJ2ZXJfaW5pdChTcGljZVNlcnZlciAqcmVkcywgU3BpY2VDb3JlSW50ZXJm
YWNlICpjb3JlKQpAQCAtMzg3NSw3ICszODk1LDcgQEAgU1BJQ0VfR05VQ19WSVNJQkxFIGludCBz
cGljZV9zZXJ2ZXJfaW5pdChTcGljZVNlcnZlciAqcmVkcywgU3BpY2VDb3JlSW50ZXJmYWNlICoK
ICAgICAgICAgcmVkc19hZGRfcmVuZGVyZXIocmVkcywgZGVmYXVsdF9yZW5kZXJlcik7CiAgICAg
fQogICAgIGlmIChyZWRzLT5jb25maWctPnZpZGVvX2NvZGVjcy0+bGVuID09IDApIHsKLSAgICAg
ICAgcmVkc19zZXRfdmlkZW9fY29kZWNzX2Zyb21fc3RyaW5nKHJlZHMsIGRlZmF1bHRfdmlkZW9f
Y29kZWNzKTsKKyAgICAgICAgcmVkc19zZXRfdmlkZW9fY29kZWNzX2Zyb21fc3RyaW5nKHJlZHMs
IGRlZmF1bHRfdmlkZW9fY29kZWNzLCBOVUxMKTsKICAgICB9CiAgICAgcmV0dXJuIHJldDsKIH0K
QEAgLTQyMjEsOCArNDI0MSwxNSBAQCB1aW50MzJfdCByZWRzX2dldF9zdHJlYW1pbmdfdmlkZW8o
Y29uc3QgUmVkc1N0YXRlICpyZWRzKQoKIFNQSUNFX0dOVUNfVklTSUJMRSBpbnQgc3BpY2Vfc2Vy
dmVyX3NldF92aWRlb19jb2RlY3MoU3BpY2VTZXJ2ZXIgKnJlZHMsIGNvbnN0IGNoYXIgKnZpZGVv
X2NvZGVjcykKIHsKLSAgICByZWRzX3NldF92aWRlb19jb2RlY3NfZnJvbV9zdHJpbmcocmVkcywg
dmlkZW9fY29kZWNzKTsKKyAgICB1bnNpZ25lZCBpbnQgaW5zdGFsbGVkID0gMDsKKworICAgIHJl
ZHNfc2V0X3ZpZGVvX2NvZGVjc19mcm9tX3N0cmluZyhyZWRzLCB2aWRlb19jb2RlY3MsICZpbnN0
YWxsZWQpOworCisgICAgaWYgKCFpbnN0YWxsZWQpIHsKKyAgICAgICAgcmV0dXJuIC0xOworICAg
IH0KICAgICByZWRzX29uX3ZjX2NoYW5nZShyZWRzKTsKKwogICAgIHJldHVybiAwOwogfQoKLS0K
Mi4yMS4wCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClNw
aWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9zcGljZS1kZXZl
bA==
