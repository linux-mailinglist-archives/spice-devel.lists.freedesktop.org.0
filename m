Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D1FDA48A2B
	for <lists+spice-devel@lfdr.de>; Mon, 17 Jun 2019 19:33:50 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 74B45891C4;
	Mon, 17 Jun 2019 17:33:49 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail.codeweavers.com (mail.codeweavers.com [50.203.203.244])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 892FA891AC
 for <spice-devel@lists.freedesktop.org>; Mon, 17 Jun 2019 17:33:48 +0000 (UTC)
Received: from 82-64-54-218.subs.proxad.net ([82.64.54.218] helo=amboise)
 by mail.codeweavers.com with esmtpsa (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.89) (envelope-from <fgouget@free.fr>) id 1hcvWP-000794-Vn
 for spice-devel@lists.freedesktop.org; Mon, 17 Jun 2019 12:34:22 -0500
Received: from fgouget by amboise with local (Exim 4.92)
 (envelope-from <fgouget@amboise.dolphin>) id 1hcvVp-00085i-R0
 for spice-devel@lists.freedesktop.org; Mon, 17 Jun 2019 19:33:45 +0200
Date: Mon, 17 Jun 2019 19:33:45 +0200 (CEST)
From: Francois Gouget <fgouget@codeweavers.com>
To: Spice devel <spice-devel@lists.freedesktop.org>
In-Reply-To: <cover.1560790607.git.fgouget@free.fr>
Message-ID: <6e53d1bc6954ec61a690632fe517e9693af1f79b.1560790607.git.fgouget@free.fr>
References: <cover.1560790607.git.fgouget@free.fr>
User-Agent: Alpine 2.21 (DEB 202 2017-01-01)
MIME-Version: 1.0
X-Spam-Score: -103.7
X-Spam-Report: Spam detection software,
 running on the system "mail.codeweavers.com", 
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview: 'Latency' is confusing because it evokes either the network
 latency or the audio latency, neither of which match what the latency variables
 contain. Instead they record how much margin there was betwe [...] 
 Content analysis details:   (-103.7 points, 5.0 required)
 pts rule name              description
 ---- ---------------------- --------------------------------------------------
 -100 USER_IN_WHITELIST      From: address is in the user's white-list
 -6.0 ALL_TRUSTED            Passed through trusted hosts only via SMTP
 0.0 TVD_RCVD_IP            Message was received from an IP address
 1.0 FREEMAIL_FROM          Sender email is commonly abused enduser mail
 provider (fgouget[at]free.fr)
 1.0 HEADER_FROM_DIFFERENT_DOMAINS From and EnvelopeFrom 2nd level
 mail domains are different
 0.2 FREEMAIL_FORGED_FROMDOMAIN 2nd level domains in From and
 EnvelopeFrom freemail headers are different
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; 
 d=codeweavers.com; s=6377696661; h=Content-Type:MIME-Version:References:
 Message-ID:In-Reply-To:Subject:To:From:Date:Sender:Reply-To:Cc:
 Content-Transfer-Encoding:Content-ID:Content-Description:Resent-Date:
 Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:
 List-Help:List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=C8T9pZ+hqsqdavMvW6NxcML91cXwg1WYDALSq/7gvdc=; b=c9zM2IrMwIv/Ovk823CF99jf8
 /UyiPAkQnN4UxM4wgZ1KkZHrLOtzFFrIBO+p42j3dv/r8YNjQVRtwd3ipXz9d+LWgHjDtMk/KSXDS
 VSFmDge4TX5fk3hHZrpSUxSOgE5zBCVW0Btey2GitU4vzmczEl5Ao09BoGcPff3As50nE=;
Subject: [Spice-devel] [client v2 05/12] channel-display: The video latency
 is in fact a margin
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

J0xhdGVuY3knIGlzIGNvbmZ1c2luZyBiZWNhdXNlIGl0IGV2b2tlcyBlaXRoZXIgdGhlIG5ldHdv
cmsgbGF0ZW5jeQpvciB0aGUgYXVkaW8gbGF0ZW5jeSwgbmVpdGhlciBvZiB3aGljaCBtYXRjaCB3
aGF0IHRoZSBsYXRlbmN5CnZhcmlhYmxlcyBjb250YWluLiBJbnN0ZWFkIHRoZXkgcmVjb3JkIGhv
dyBtdWNoIG1hcmdpbiB0aGVyZSB3YXMKYmV0d2VlbiB3aGVuIHRoZSBmcmFtZSB3YXMgcmVjZWl2
ZWQsIGFuZCB3aGVuIGl0IGlzIHN1cHBvc2VkIHRvIGJlCmRpc3BsYXllZC4gSGVuY2UgdGhlIG5l
dyBuYW1lLgoKU2lnbmVkLW9mZi1ieTogRnJhbmNvaXMgR291Z2V0IDxmZ291Z2V0QGNvZGV3ZWF2
ZXJzLmNvbT4KLS0tCgpJdCdzIGxlc3MgY29uZnVzaW5nIHdoZW4gdXNpbmcgdGhlIHJpZ2h0IHRl
cm1pbm9sb2d5IHNvIEknbSBzdGFydGluZyAKd2l0aCB0aGlzIGJlZm9yZSB0aGUgbW9yZSBpbnZv
bHZlZCBwYXRjaGVzLgoKIHNyYy9jaGFubmVsLWRpc3BsYXktZ3N0LmMgICB8ICA2ICsrKy0tLQog
c3JjL2NoYW5uZWwtZGlzcGxheS1tanBlZy5jIHwgIDQgKystLQogc3JjL2NoYW5uZWwtZGlzcGxh
eS5jICAgICAgIHwgMjYgKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0KIDMgZmlsZXMgY2hhbmdl
ZCwgMTggaW5zZXJ0aW9ucygrKSwgMTggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvc3JjL2No
YW5uZWwtZGlzcGxheS1nc3QuYyBiL3NyYy9jaGFubmVsLWRpc3BsYXktZ3N0LmMKaW5kZXggNDQ5
YjljYjguLjZmY2NmNjIxIDEwMDY0NAotLS0gYS9zcmMvY2hhbm5lbC1kaXNwbGF5LWdzdC5jCisr
KyBiL3NyYy9jaGFubmVsLWRpc3BsYXktZ3N0LmMKQEAgLTY3OSw3ICs2NzksNyBAQCBzdGF0aWMg
dm9pZCBzcGljZV9nc3RfZGVjb2Rlcl9kZXN0cm95KFZpZGVvRGVjb2RlciAqdmlkZW9fZGVjb2Rl
cikKICAqICAgICAgc3BpY2VfZnJhbWVfZnJlZSgpIGFuZCBmcmVlIGl0cyBlbmNvZGVkX2ZyYW1l
LgogICovCiBzdGF0aWMgZ2Jvb2xlYW4gc3BpY2VfZ3N0X2RlY29kZXJfcXVldWVfZnJhbWUoVmlk
ZW9EZWNvZGVyICp2aWRlb19kZWNvZGVyLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIFNwaWNlRnJhbWUgKmZyYW1lLCBpbnQgbGF0ZW5jeSkKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZUZyYW1lICpmcmFtZSwg
aW50IG1hcmdpbikKIHsKICAgICBTcGljZUdzdERlY29kZXIgKmRlY29kZXIgPSAoU3BpY2VHc3RE
ZWNvZGVyKil2aWRlb19kZWNvZGVyOwogCkBAIC02OTcsNyArNjk3LDcgQEAgc3RhdGljIGdib29s
ZWFuIHNwaWNlX2dzdF9kZWNvZGVyX3F1ZXVlX2ZyYW1lKFZpZGVvRGVjb2RlciAqdmlkZW9fZGVj
b2RlciwKICAgICB9CiAgICAgZGVjb2Rlci0+bGFzdF9tbV90aW1lID0gZnJhbWUtPm1tX3RpbWU7
CiAKLSAgICBpZiAobGF0ZW5jeSA8IDAgJiYKKyAgICBpZiAobWFyZ2luIDwgMCAmJgogICAgICAg
ICBkZWNvZGVyLT5iYXNlLmNvZGVjX3R5cGUgPT0gU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9NSlBF
RykgewogICAgICAgICAvKiBEcm9wcGluZyBNSlBFRyBmcmFtZXMgaGFzIG5vIGltcGFjdCBvbiB0
aG9zZSB0aGF0IGZvbGxvdyBhbmQKICAgICAgICAgICogc2F2ZXMgQ1BVIHNvIGRvIGl0LgpAQCAt
NzI2LDcgKzcyNiw3IEBAIHN0YXRpYyBnYm9vbGVhbiBzcGljZV9nc3RfZGVjb2Rlcl9xdWV1ZV9m
cmFtZShWaWRlb0RlY29kZXIgKnZpZGVvX2RlY29kZXIsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWUtPmRhdGEsIGZyYW1lLT5zaXplLCAw
LCBmcmFtZS0+c2l6ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBmcmFtZSwgKEdEZXN0cm95Tm90aWZ5KSBzcGljZV9mcmFtZV9mcmVlKTsKIAot
ICAgIEdzdENsb2NrVGltZSBwdHMgPSBnc3RfY2xvY2tfZ2V0X3RpbWUoZGVjb2Rlci0+Y2xvY2sp
IC0gZ3N0X2VsZW1lbnRfZ2V0X2Jhc2VfdGltZShkZWNvZGVyLT5waXBlbGluZSkgKyAoKHVpbnQ2
NF90KU1BWCgwLCBsYXRlbmN5KSkgKiAxMDAwICogMTAwMDsKKyAgICBHc3RDbG9ja1RpbWUgcHRz
ID0gZ3N0X2Nsb2NrX2dldF90aW1lKGRlY29kZXItPmNsb2NrKSAtIGdzdF9lbGVtZW50X2dldF9i
YXNlX3RpbWUoZGVjb2Rlci0+cGlwZWxpbmUpICsgKCh1aW50NjRfdClNQVgoMCwgbWFyZ2luKSkg
KiAxMDAwICogMTAwMDsKICAgICBHU1RfQlVGRkVSX0RVUkFUSU9OKGJ1ZmZlcikgPSBHU1RfQ0xP
Q0tfVElNRV9OT05FOwogICAgIEdTVF9CVUZGRVJfRFRTKGJ1ZmZlcikgPSBHU1RfQ0xPQ0tfVElN
RV9OT05FOwogICAgIEdTVF9CVUZGRVJfUFRTKGJ1ZmZlcikgPSBwdHM7CmRpZmYgLS1naXQgYS9z
cmMvY2hhbm5lbC1kaXNwbGF5LW1qcGVnLmMgYi9zcmMvY2hhbm5lbC1kaXNwbGF5LW1qcGVnLmMK
aW5kZXggYmE3ZjI2NmUuLjY0N2QzMWIwIDEwMDY0NAotLS0gYS9zcmMvY2hhbm5lbC1kaXNwbGF5
LW1qcGVnLmMKKysrIGIvc3JjL2NoYW5uZWwtZGlzcGxheS1tanBlZy5jCkBAIC0yMTksNyArMjE5
LDcgQEAgc3RhdGljIHZvaWQgbWpwZWdfZGVjb2Rlcl9kcm9wX3F1ZXVlKE1KcGVnRGVjb2RlciAq
ZGVjb2RlcikKIC8qIC0tLS0tLS0tLS0gVmlkZW9EZWNvZGVyJ3MgcHVibGljIEFQSSAtLS0tLS0t
LS0tICovCiAKIHN0YXRpYyBnYm9vbGVhbiBtanBlZ19kZWNvZGVyX3F1ZXVlX2ZyYW1lKFZpZGVv
RGVjb2RlciAqdmlkZW9fZGVjb2RlciwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIFNwaWNlRnJhbWUgKmZyYW1lLCBpbnQzMl90IGxhdGVuY3kpCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZUZyYW1lICpmcmFtZSwgaW50MzJf
dCBtYXJnaW4pCiB7CiAgICAgTUpwZWdEZWNvZGVyICpkZWNvZGVyID0gKE1KcGVnRGVjb2Rlciop
dmlkZW9fZGVjb2RlcjsKICAgICBTcGljZUZyYW1lICpsYXN0X2ZyYW1lOwpAQCAtMjM5LDcgKzIz
OSw3IEBAIHN0YXRpYyBnYm9vbGVhbiBtanBlZ19kZWNvZGVyX3F1ZXVlX2ZyYW1lKFZpZGVvRGVj
b2RlciAqdmlkZW9fZGVjb2RlciwKICAgICAvKiBEcm9wcGVkIE1KUEVHIGZyYW1lcyBkb24ndCBp
bXBhY3QgdGhlIG9uZXMgdGhhdCBjb21lIGFmdGVyLgogICAgICAqIFNvIGRyb3AgbGF0ZSBmcmFt
ZXMgYXMgZWFybHkgYXMgcG9zc2libGUgdG8gc2F2ZSBvbiBwcm9jZXNzaW5nIHRpbWUuCiAgICAg
ICovCi0gICAgaWYgKGxhdGVuY3kgPCAwKSB7CisgICAgaWYgKG1hcmdpbiA8IDApIHsKICAgICAg
ICAgU1BJQ0VfREVCVUcoImRyb3BwaW5nIGEgbGF0ZSBNSlBFRyBmcmFtZSIpOwogICAgICAgICBz
cGljZV9mcmFtZV9mcmVlKGZyYW1lKTsKICAgICAgICAgcmV0dXJuIFRSVUU7CmRpZmYgLS1naXQg
YS9zcmMvY2hhbm5lbC1kaXNwbGF5LmMgYi9zcmMvY2hhbm5lbC1kaXNwbGF5LmMKaW5kZXggNmMy
YTk5YzcuLmNkYTBmY2RkIDEwMDY0NAotLS0gYS9zcmMvY2hhbm5lbC1kaXNwbGF5LmMKKysrIGIv
c3JjL2NoYW5uZWwtZGlzcGxheS5jCkBAIC0xNDMyLDcgKzE0MzIsNyBAQCBnYm9vbGVhbiBoYW5k
X3BpcGVsaW5lX3RvX3dpZGdldChkaXNwbGF5X3N0cmVhbSAqc3QsIEdzdFBpcGVsaW5lICpwaXBl
bGluZSkKICNkZWZpbmUgU1RSRUFNX1JFUE9SVF9EUk9QX1NFUV9MRU5fTElNSVQgMwogCiBzdGF0
aWMgdm9pZCBkaXNwbGF5X3VwZGF0ZV9zdHJlYW1fcmVwb3J0KFNwaWNlRGlzcGxheUNoYW5uZWwg
KmNoYW5uZWwsIHVpbnQzMl90IHN0cmVhbV9pZCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdWludDMyX3QgZnJhbWVfdGltZSwgaW50MzJfdCBsYXRlbmN5KQorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBmcmFtZV90aW1l
LCBpbnQzMl90IG1hcmdpbikKIHsKICAgICBkaXNwbGF5X3N0cmVhbSAqc3QgPSBnZXRfc3RyZWFt
X2J5X2lkKFNQSUNFX0NIQU5ORUwoY2hhbm5lbCksIHN0cmVhbV9pZCk7CiAgICAgZ3VpbnQ2NCBu
b3c7CkBAIC0xNDQ5LDcgKzE0NDksNyBAQCBzdGF0aWMgdm9pZCBkaXNwbGF5X3VwZGF0ZV9zdHJl
YW1fcmVwb3J0KFNwaWNlRGlzcGxheUNoYW5uZWwgKmNoYW5uZWwsIHVpbnQzMl90CiAgICAgfQog
ICAgIHN0LT5yZXBvcnRfbnVtX2ZyYW1lcysrOwogCi0gICAgaWYgKGxhdGVuY3kgPCAwKSB7IC8v
IGRyb3AKKyAgICBpZiAobWFyZ2luIDwgMCkgeyAvLyBkcm9wCiAgICAgICAgIHN0LT5yZXBvcnRf
bnVtX2Ryb3BzKys7CiAgICAgICAgIHN0LT5yZXBvcnRfZHJvcHNfc2VxX2xlbisrOwogICAgIH0g
ZWxzZSB7CkBAIC0xNDY5LDcgKzE0NjksNyBAQCBzdGF0aWMgdm9pZCBkaXNwbGF5X3VwZGF0ZV9z
dHJlYW1fcmVwb3J0KFNwaWNlRGlzcGxheUNoYW5uZWwgKmNoYW5uZWwsIHVpbnQzMl90CiAgICAg
ICAgIHJlcG9ydC5lbmRfZnJhbWVfbW1fdGltZSA9IGZyYW1lX3RpbWU7CiAgICAgICAgIHJlcG9y
dC5udW1fZnJhbWVzID0gc3QtPnJlcG9ydF9udW1fZnJhbWVzOwogICAgICAgICByZXBvcnQubnVt
X2Ryb3BzID0gc3QtPiByZXBvcnRfbnVtX2Ryb3BzOwotICAgICAgICByZXBvcnQubGFzdF9mcmFt
ZV9kZWxheSA9IGxhdGVuY3k7CisgICAgICAgIHJlcG9ydC5sYXN0X2ZyYW1lX2RlbGF5ID0gbWFy
Z2luOwogICAgICAgICBpZiAoc3BpY2Vfc2Vzc2lvbl9pc19wbGF5YmFja19hY3RpdmUoc2Vzc2lv
bikpIHsKICAgICAgICAgICAgIHJlcG9ydC5hdWRpb19kZWxheSA9IHNwaWNlX3Nlc3Npb25fZ2V0
X3BsYXliYWNrX2xhdGVuY3koc2Vzc2lvbik7CiAgICAgICAgIH0gZWxzZSB7CkBAIC0xNjA2LDE0
ICsxNjA2LDE0IEBAIHN0YXRpYyB2b2lkIGRpc3BsYXlfc3RyZWFtX3N0YXRzX3NhdmUoZGlzcGxh
eV9zdHJlYW0gKnN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBndWlu
dDMyIHNlcnZlcl9tbXRpbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGd1aW50MzIgY2xpZW50X21tdGltZSkKIHsKLSAgICBnaW50MzIgbGF0ZW5jeSA9IHNlcnZlcl9t
bXRpbWUgLSBjbGllbnRfbW10aW1lOworICAgIGdpbnQzMiBtYXJnaW4gPSBzZXJ2ZXJfbW10aW1l
IC0gY2xpZW50X21tdGltZTsKIAogICAgIGlmICghc3QtPm51bV9pbnB1dF9mcmFtZXMpIHsKICAg
ICAgICAgc3QtPmZpcnN0X2ZyYW1lX21tX3RpbWUgPSBzZXJ2ZXJfbW10aW1lOwogICAgIH0KICAg
ICBzdC0+bnVtX2lucHV0X2ZyYW1lcysrOwogCi0gICAgaWYgKGxhdGVuY3kgPCAwKSB7CisgICAg
aWYgKG1hcmdpbiA8IDApIHsKICAgICAgICAgQ0hBTk5FTF9ERUJVRyhzdC0+Y2hhbm5lbCwgInN0
cmVhbSBkYXRhIHRvbyBsYXRlIGJ5ICV1IG1zICh0czogJXUsIG1tdGltZTogJXUpIiwKICAgICAg
ICAgICAgICAgICAgICAgICBjbGllbnRfbW10aW1lIC0gc2VydmVyX21tdGltZSwgc2VydmVyX21t
dGltZSwgY2xpZW50X21tdGltZSk7CiAgICAgICAgIHN0LT5hcnJpdmVfbGF0ZV90aW1lICs9IGNs
aWVudF9tbXRpbWUgLSBzZXJ2ZXJfbW10aW1lOwpAQCAtMTYzMCw3ICsxNjMwLDcgQEAgc3RhdGlj
IHZvaWQgZGlzcGxheV9zdHJlYW1fc3RhdHNfc2F2ZShkaXNwbGF5X3N0cmVhbSAqc3QsCiAgICAg
ICAgIHJldHVybjsKICAgICB9CiAKLSAgICBDSEFOTkVMX0RFQlVHKHN0LT5jaGFubmVsLCAidmlk
ZW8gbGF0ZW5jeTogJWQiLCBsYXRlbmN5KTsKKyAgICBDSEFOTkVMX0RFQlVHKHN0LT5jaGFubmVs
LCAidmlkZW8gbWFyZ2luOiAlZCIsIG1hcmdpbik7CiAgICAgaWYgKHN0LT5jdXJfZHJvcHNfc2Vx
X3N0YXRzLmxlbikgewogICAgICAgICBzdC0+Y3VyX2Ryb3BzX3NlcV9zdGF0cy5kdXJhdGlvbiA9
IHNlcnZlcl9tbXRpbWUgLQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHN0LT5jdXJfZHJvcHNfc2VxX3N0YXRzLnN0YXJ0X21tX3RpbWU7CkBAIC0xNjc5LDcgKzE2
NzksNyBAQCBzdGF0aWMgdm9pZCBkaXNwbGF5X2hhbmRsZV9zdHJlYW1fZGF0YShTcGljZUNoYW5u
ZWwgKmNoYW5uZWwsIFNwaWNlTXNnSW4gKmluKQogICAgIFNwaWNlU3RyZWFtRGF0YUhlYWRlciAq
b3AgPSBzcGljZV9tc2dfaW5fcGFyc2VkKGluKTsKICAgICBkaXNwbGF5X3N0cmVhbSAqc3QgPSBn
ZXRfc3RyZWFtX2J5X2lkKGNoYW5uZWwsIG9wLT5pZCk7CiAgICAgZ3VpbnQzMiBtbXRpbWU7Ci0g
ICAgaW50MzJfdCBsYXRlbmN5LCBsYXRlbmN5X3JlcG9ydDsKKyAgICBpbnQzMl90IG1hcmdpbiwg
bWFyZ2luX3JlcG9ydDsKICAgICBTcGljZUZyYW1lICpmcmFtZTsKIAogICAgIGdfcmV0dXJuX2lm
X2ZhaWwoc3QgIT0gTlVMTCk7CkBAIC0xNjk0LDEzICsxNjk0LDEzIEBAIHN0YXRpYyB2b2lkIGRp
c3BsYXlfaGFuZGxlX3N0cmVhbV9kYXRhKFNwaWNlQ2hhbm5lbCAqY2hhbm5lbCwgU3BpY2VNc2dJ
biAqaW4pCiAgICAgICAgIG9wLT5tdWx0aV9tZWRpYV90aW1lID0gbW10aW1lICsgMTAwOyAvKiB3
b3JrYXJvdW5kLi4uICovCiAgICAgfQogCi0gICAgbGF0ZW5jeSA9IGxhdGVuY3lfcmVwb3J0ID0g
b3AtPm11bHRpX21lZGlhX3RpbWUgLSBtbXRpbWU7Ci0gICAgaWYgKGxhdGVuY3kgPiAwKSB7Cisg
ICAgbWFyZ2luID0gbWFyZ2luX3JlcG9ydCA9IG9wLT5tdWx0aV9tZWRpYV90aW1lIC0gbW10aW1l
OworICAgIGlmIChtYXJnaW4gPiAwKSB7CiAgICAgICAgIFNwaWNlU2Vzc2lvbiAqcyA9IHNwaWNl
X2NoYW5uZWxfZ2V0X3Nlc3Npb24oY2hhbm5lbCk7CiAKICAgICAgICAgaWYgKHN0LT5zdXJmYWNl
LT5zdHJlYW1pbmdfbW9kZSAmJiAhc3BpY2Vfc2Vzc2lvbl9pc19wbGF5YmFja19hY3RpdmUocykp
IHsKLSAgICAgICAgICAgIENIQU5ORUxfREVCVUcoY2hhbm5lbCwgInZpZGVvIGxhdGVuY3k6ICVk
LCBzZXQgdG8gMCBzaW5jZSB0aGVyZSBpcyBubyBwbGF5YmFjayIsIGxhdGVuY3kpOwotICAgICAg
ICAgICAgbGF0ZW5jeSA9IDA7CisgICAgICAgICAgICBDSEFOTkVMX0RFQlVHKGNoYW5uZWwsICJ2
aWRlbyBtYXJnaW46ICVkLCBzZXQgdG8gMCBzaW5jZSB0aGVyZSBpcyBubyBwbGF5YmFjayIsIG1h
cmdpbik7CisgICAgICAgICAgICBtYXJnaW4gPSAwOwogICAgICAgICB9CiAgICAgfQogICAgIGRp
c3BsYXlfc3RyZWFtX3N0YXRzX3NhdmUoc3QsIG9wLT5tdWx0aV9tZWRpYV90aW1lLCBtbXRpbWUp
OwpAQCAtMTcxMCw3ICsxNzEwLDcgQEAgc3RhdGljIHZvaWQgZGlzcGxheV9oYW5kbGVfc3RyZWFt
X2RhdGEoU3BpY2VDaGFubmVsICpjaGFubmVsLCBTcGljZU1zZ0luICppbikKICAgICAgKiB0YWtp
bmcgaW50byBhY2NvdW50IHRoZSBpbXBhY3Qgb24gbGF0ZXIgZnJhbWVzLgogICAgICAqLwogICAg
IGZyYW1lID0gc3BpY2VfZnJhbWVfbmV3KHN0LCBpbiwgb3AtPm11bHRpX21lZGlhX3RpbWUpOwot
ICAgIGlmICghc3QtPnZpZGVvX2RlY29kZXItPnF1ZXVlX2ZyYW1lKHN0LT52aWRlb19kZWNvZGVy
LCBmcmFtZSwgbGF0ZW5jeSkpIHsKKyAgICBpZiAoIXN0LT52aWRlb19kZWNvZGVyLT5xdWV1ZV9m
cmFtZShzdC0+dmlkZW9fZGVjb2RlciwgZnJhbWUsIG1hcmdpbikpIHsKICAgICAgICAgZGVzdHJv
eV9zdHJlYW0oY2hhbm5lbCwgb3AtPmlkKTsKICAgICAgICAgcmVwb3J0X2ludmFsaWRfc3RyZWFt
KGNoYW5uZWwsIG9wLT5pZCk7CiAgICAgICAgIHJldHVybjsKQEAgLTE3MTgsNyArMTcxOCw3IEBA
IHN0YXRpYyB2b2lkIGRpc3BsYXlfaGFuZGxlX3N0cmVhbV9kYXRhKFNwaWNlQ2hhbm5lbCAqY2hh
bm5lbCwgU3BpY2VNc2dJbiAqaW4pCiAKICAgICBpZiAoYy0+ZW5hYmxlX2FkYXB0aXZlX3N0cmVh
bWluZykgewogICAgICAgICBkaXNwbGF5X3VwZGF0ZV9zdHJlYW1fcmVwb3J0KFNQSUNFX0RJU1BM
QVlfQ0hBTk5FTChjaGFubmVsKSwgb3AtPmlkLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIG9wLT5tdWx0aV9tZWRpYV90aW1lLCBsYXRlbmN5X3JlcG9ydCk7CisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3AtPm11bHRpX21lZGlhX3RpbWUsIG1hcmdp
bl9yZXBvcnQpOwogICAgICAgICBpZiAoc3QtPnBsYXliYWNrX3N5bmNfZHJvcHNfc2VxX2xlbiA+
PSBTVFJFQU1fUExBWUJBQ0tfU1lOQ19EUk9QX1NFUV9MRU5fTElNSVQpIHsKICAgICAgICAgICAg
IHNwaWNlX3Nlc3Npb25fc3luY19wbGF5YmFja19sYXRlbmN5KHNwaWNlX2NoYW5uZWxfZ2V0X3Nl
c3Npb24oY2hhbm5lbCkpOwogICAgICAgICAgICAgc3QtPnBsYXliYWNrX3N5bmNfZHJvcHNfc2Vx
X2xlbiA9IDA7Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9zcGljZS1kZXZlbA==
