Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 77F2DAD6D9
	for <lists+spice-devel@lfdr.de>; Mon,  9 Sep 2019 12:29:55 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 019D1891F2;
	Mon,  9 Sep 2019 10:29:53 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2C9F5891CE
 for <spice-devel@lists.freedesktop.org>; Mon,  9 Sep 2019 10:29:52 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx01.intmail.prod.int.phx2.redhat.com
 [10.5.11.11])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id CBE3730B4A82
 for <spice-devel@lists.freedesktop.org>; Mon,  9 Sep 2019 10:29:51 +0000 (UTC)
Received: from wingsuit.mxp.redhat.com (unknown [10.32.181.222])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 557EA60126
 for <spice-devel@lists.freedesktop.org>; Mon,  9 Sep 2019 10:29:51 +0000 (UTC)
From: Victor Toso <victortoso@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Mon,  9 Sep 2019 12:29:48 +0200
Message-Id: <20190909102949.17504-3-victortoso@redhat.com>
In-Reply-To: <20190909102949.17504-1-victortoso@redhat.com>
References: <20190909102949.17504-1-victortoso@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.11
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.49]); Mon, 09 Sep 2019 10:29:51 +0000 (UTC)
Subject: [Spice-devel] [spice-gtk v2 2/3] display-gst: rely on SpiceSession
 init of GStreamer
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogVmljdG9yIFRvc28gPG1lQHZpY3RvcnRvc28uY29tPgoKVGhpcyBtZWFucyB3ZSBjYW4g
ZHJvcCBnc3R2aWRlb19pbml0KCkgZnVuY3Rpb24gYW5kIHJlcGxhY2UgaXRzIGNhbGxzCndpdGgg
Z3N0X2lzX2luaXRpYWxpemVkKCkuCgpBIHNtYWxsIHJld29yayBvbiBjcmVhdGVfZ3N0cmVhbWVy
X2RlY29kZXIoKSB3YXMgZG9uZSB0byBtYWtlCmdzdF9pc19pbml0aWFsaXplZCgpIHJldHVybiBl
YXJseSB3aXRoIHByb3BlciBkZWJ1ZyBtZXNzYWdlIHJlbGF0ZWQgdG8KbGFjayBvZiBHU3RyZWFt
ZXIgaW5pdGlhbGl6YXRpb24uCgpTaWduZWQtb2ZmLWJ5OiBWaWN0b3IgVG9zbyA8dmljdG9ydG9z
b0ByZWRoYXQuY29tPgotLS0KIHNyYy9jaGFubmVsLWRpc3BsYXktZ3N0LmMgfCA1NSArKysrKysr
KysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAyMiBpbnNl
cnRpb25zKCspLCAzMyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9zcmMvY2hhbm5lbC1kaXNw
bGF5LWdzdC5jIGIvc3JjL2NoYW5uZWwtZGlzcGxheS1nc3QuYwppbmRleCA2ZmNjZjYyLi5jODg3
ODhmIDEwMDY0NAotLS0gYS9zcmMvY2hhbm5lbC1kaXNwbGF5LWdzdC5jCisrKyBiL3NyYy9jaGFu
bmVsLWRpc3BsYXktZ3N0LmMKQEAgLTc0OCw0NCArNzQ4LDMwIEBAIHN0YXRpYyBnYm9vbGVhbiBz
cGljZV9nc3RfZGVjb2Rlcl9xdWV1ZV9mcmFtZShWaWRlb0RlY29kZXIgKnZpZGVvX2RlY29kZXIs
CiAgICAgcmV0dXJuIFRSVUU7CiB9CiAKLXN0YXRpYyBnYm9vbGVhbiBnc3R2aWRlb19pbml0KHZv
aWQpCi17Ci0gICAgc3RhdGljIGludCBzdWNjZXNzID0gMDsKLSAgICBpZiAoIXN1Y2Nlc3MpIHsK
LSAgICAgICAgR0Vycm9yICplcnIgPSBOVUxMOwotICAgICAgICBpZiAoZ3N0X2luaXRfY2hlY2so
TlVMTCwgTlVMTCwgJmVycikpIHsKLSAgICAgICAgICAgIHN1Y2Nlc3MgPSAxOwotICAgICAgICB9
IGVsc2UgewotICAgICAgICAgICAgc3BpY2Vfd2FybmluZygiRGlzYWJsaW5nIEdTdHJlYW1lciB2
aWRlbyBzdXBwb3J0OiAlcyIsIGVyci0+bWVzc2FnZSk7Ci0gICAgICAgICAgICBnX2NsZWFyX2Vy
cm9yKCZlcnIpOwotICAgICAgICAgICAgc3VjY2VzcyA9IC0xOwotICAgICAgICB9Ci0gICAgfQot
ICAgIHJldHVybiBzdWNjZXNzID4gMDsKLX0KLQogR19HTlVDX0lOVEVSTkFMCiBWaWRlb0RlY29k
ZXIqIGNyZWF0ZV9nc3RyZWFtZXJfZGVjb2RlcihpbnQgY29kZWNfdHlwZSwgZGlzcGxheV9zdHJl
YW0gKnN0cmVhbSkKIHsKLSAgICBTcGljZUdzdERlY29kZXIgKmRlY29kZXIgPSBOVUxMOwogCiAg
ICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwoVkFMSURfVklERU9fQ09ERUNfVFlQRShjb2RlY190eXBl
KSwgTlVMTCk7CiAKLSAgICBpZiAoZ3N0dmlkZW9faW5pdCgpKSB7Ci0gICAgICAgIGRlY29kZXIg
PSBnX25ldzAoU3BpY2VHc3REZWNvZGVyLCAxKTsKLSAgICAgICAgZGVjb2Rlci0+YmFzZS5kZXN0
cm95ID0gc3BpY2VfZ3N0X2RlY29kZXJfZGVzdHJveTsKLSAgICAgICAgZGVjb2Rlci0+YmFzZS5y
ZXNjaGVkdWxlID0gc3BpY2VfZ3N0X2RlY29kZXJfcmVzY2hlZHVsZTsKLSAgICAgICAgZGVjb2Rl
ci0+YmFzZS5xdWV1ZV9mcmFtZSA9IHNwaWNlX2dzdF9kZWNvZGVyX3F1ZXVlX2ZyYW1lOwotICAg
ICAgICBkZWNvZGVyLT5iYXNlLmNvZGVjX3R5cGUgPSBjb2RlY190eXBlOwotICAgICAgICBkZWNv
ZGVyLT5iYXNlLnN0cmVhbSA9IHN0cmVhbTsKLSAgICAgICAgZGVjb2Rlci0+bGFzdF9tbV90aW1l
ID0gc3RyZWFtX2dldF90aW1lKHN0cmVhbSk7Ci0gICAgICAgIGdfbXV0ZXhfaW5pdCgmZGVjb2Rl
ci0+cXVldWVzX211dGV4KTsKLSAgICAgICAgZGVjb2Rlci0+ZGVjb2RpbmdfcXVldWUgPSBnX3F1
ZXVlX25ldygpOwotCi0gICAgICAgIGlmICghY3JlYXRlX3BpcGVsaW5lKGRlY29kZXIpKSB7Ci0g
ICAgICAgICAgICBkZWNvZGVyLT5iYXNlLmRlc3Ryb3koKFZpZGVvRGVjb2RlciopZGVjb2Rlcik7
Ci0gICAgICAgICAgICBkZWNvZGVyID0gTlVMTDsKLSAgICAgICAgfQorICAgIGlmICghZ3N0X2lz
X2luaXRpYWxpemVkKCkpIHsKKyAgICAgICAgc3BpY2VfZGVidWcoIkdTdHJlYW1lciBpcyBub3Qg
aW5pdGlhbGl6ZWQ6IE5vIGRlY29kZXIgZm9yIGNvZGVjLXR5cGU6ICV1IiwgY29kZWNfdHlwZSk7
CisgICAgICAgIHJldHVybiBOVUxMOworICAgIH0KKworICAgIFNwaWNlR3N0RGVjb2RlciAqZGVj
b2RlciA9IGdfbmV3MChTcGljZUdzdERlY29kZXIsIDEpOworICAgIGRlY29kZXItPmJhc2UuZGVz
dHJveSA9IHNwaWNlX2dzdF9kZWNvZGVyX2Rlc3Ryb3k7CisgICAgZGVjb2Rlci0+YmFzZS5yZXNj
aGVkdWxlID0gc3BpY2VfZ3N0X2RlY29kZXJfcmVzY2hlZHVsZTsKKyAgICBkZWNvZGVyLT5iYXNl
LnF1ZXVlX2ZyYW1lID0gc3BpY2VfZ3N0X2RlY29kZXJfcXVldWVfZnJhbWU7CisgICAgZGVjb2Rl
ci0+YmFzZS5jb2RlY190eXBlID0gY29kZWNfdHlwZTsKKyAgICBkZWNvZGVyLT5iYXNlLnN0cmVh
bSA9IHN0cmVhbTsKKyAgICBkZWNvZGVyLT5sYXN0X21tX3RpbWUgPSBzdHJlYW1fZ2V0X3RpbWUo
c3RyZWFtKTsKKyAgICBnX211dGV4X2luaXQoJmRlY29kZXItPnF1ZXVlc19tdXRleCk7CisgICAg
ZGVjb2Rlci0+ZGVjb2RpbmdfcXVldWUgPSBnX3F1ZXVlX25ldygpOworCisgICAgaWYgKCFjcmVh
dGVfcGlwZWxpbmUoZGVjb2RlcikpIHsKKyAgICAgICAgZGVjb2Rlci0+YmFzZS5kZXN0cm95KChW
aWRlb0RlY29kZXIqKWRlY29kZXIpOworICAgICAgICByZXR1cm4gTlVMTDsKICAgICB9CiAKICAg
ICByZXR1cm4gKFZpZGVvRGVjb2RlciopZGVjb2RlcjsKQEAgLTgyMCw3ICs4MDYsMTAgQEAgZ2Jv
b2xlYW4gZ3N0dmlkZW9faGFzX2NvZGVjKGludCBjb2RlY190eXBlKQogICAgIEdzdENhcHMgKmNh
cHM7CiAgICAgR3N0RWxlbWVudEZhY3RvcnlMaXN0VHlwZSB0eXBlOwogCi0gICAgZ19yZXR1cm5f
dmFsX2lmX2ZhaWwoZ3N0dmlkZW9faW5pdCgpLCBGQUxTRSk7CisgICAgaWYgKCFnc3RfaXNfaW5p
dGlhbGl6ZWQoKSkgeworICAgICAgICByZXR1cm4gRkFMU0U7CisgICAgfQorCiAgICAgZ19yZXR1
cm5fdmFsX2lmX2ZhaWwoVkFMSURfVklERU9fQ09ERUNfVFlQRShjb2RlY190eXBlKSwgRkFMU0Up
OwogCiAgICAgdHlwZSA9IEdTVF9FTEVNRU5UX0ZBQ1RPUllfVFlQRV9ERUNPREVSIHwKLS0gCjIu
MjEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KU3Bp
Y2UtZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
