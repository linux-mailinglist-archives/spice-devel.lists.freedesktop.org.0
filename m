Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D8470B37FA
	for <lists+spice-devel@lfdr.de>; Mon, 16 Sep 2019 12:21:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D1EFF6E8F9;
	Mon, 16 Sep 2019 10:21:14 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 083196E8F1
 for <spice-devel@lists.freedesktop.org>; Mon, 16 Sep 2019 10:21:12 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
 [10.5.11.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id A514030833A3
 for <spice-devel@lists.freedesktop.org>; Mon, 16 Sep 2019 10:21:11 +0000 (UTC)
Received: from wingsuit.mxp.redhat.com (unknown [10.32.181.155])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 0A4D35D6A3
 for <spice-devel@lists.freedesktop.org>; Mon, 16 Sep 2019 10:21:10 +0000 (UTC)
From: Victor Toso <victortoso@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Mon, 16 Sep 2019 12:20:51 +0200
Message-Id: <20190916102104.20943-9-victortoso@redhat.com>
In-Reply-To: <20190916102104.20943-1-victortoso@redhat.com>
References: <20190916102104.20943-1-victortoso@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.44]); Mon, 16 Sep 2019 10:21:11 +0000 (UTC)
Subject: [Spice-devel] [PATCH v7 08/20] usb-redir: extend USB backend to
 support emulated devices
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogWXVyaSBCZW5kaXRvdmljaCA8eXVyaS5iZW5kaXRvdmljaEBkYXluaXguY29tPgoKUmVk
aXJlY3Rpb24gb2YgZW11bGF0ZWQgZGV2aWNlcyByZXF1aXJlcyBzcGVjaWFsIGFwcHJvYWNoLCBh
cwp1c2JyZWRpcmhvc3QgY2FuJ3QgYmUgdXNlZCBmb3IgdGhhdCAoaXQgd29ya3Mgb25seSB3aXRo
IGxpYnVzYgpkZXZpY2VzKS4gRm9yIGVtdWxhdGVkIGRldmljZXMgd2UgY3JlYXRlIGluc3RhbmNl
IG9mIHVzYnJlZGlycGFyc2VyCnRoYXQgaW1wbGVtZW50cyBVU0IgcmVkaXJlY3Rpb24gcHJvdG9j
b2wuICBJbiBvcmRlciB0byB3b3JrIHdpdGggdGhlCnNhbWUgc2V0IG9mIHByb3RvY29sIGNhcGFi
aWxpdGllcyB0aGF0IHVzYnJlZGlyaG9zdCBzZXRzIHVwIHdpdGgKcmVtb3RlIHNpZGUsIHRoZSBw
YXJzZXIgc2hhbGw6IC0gbm90IHNlbmQgaXRzIG93biAnaGVsbG8nIHRvIHRoZQpzZXJ2ZXIKLSBp
bml0aWFsaXplIHRoZSBzYW1lIGNhcGFiaWxpdGllcyB0aGF0IHVzYnJlZGlyaG9zdAotIHJlY2Vp
dmUgdGhlIHNhbWUgJ2hlbGxvJyByZXNwb25zZQpGb3IgdGhhdCB3ZSBhbmFseXplICdoZWxsbycg
c2VudCBieSBVU0IgcmVkaXIgcGFyc2VyIGFuZCBleHRyYWN0IHNldApvZiBjYXBhYmlsaXRpZXMg
ZnJvbSBpdCBhbmQgdXBvbiByZWNlaXZlIG9mICdoZWxsbycgcmVzcG9uc2Ugd2UKcHJvdmlkZSBp
dCBhbHNvIHRvIHRoZSBwYXJzZXIuICBXaGVuIGxpYnVzYiBkZXZpY2UgaXMgcmVkaXJlY3RlZCB2
aWEgYQpjaGFubmVsLCBpbnN0YW5jZSBvZiB1c2JyZWRpcmhvc3Qgc2VydmVzIGl0LiAgV2hlbiBl
bXVsYXRlZCBkZXZpY2UgaXMKcmVkaXJlY3RlZCB2aWEgYSBjaGFubmVsLCBpbnN0YW5jZSBvZiB1
c2JyZWRpcnBhcnNlciBkb2VzIHRoZSBqb2IuCgpTaWduZWQtb2ZmLWJ5OiBZdXJpIEJlbmRpdG92
aWNoIDx5dXJpLmJlbmRpdG92aWNoQGRheW5peC5jb20+Ci0tLQogc3JjL3VzYi1iYWNrZW5kLmMg
fCA0MTcgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLQogMSBm
aWxlIGNoYW5nZWQsIDM3MCBpbnNlcnRpb25zKCspLCA0NyBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS9zcmMvdXNiLWJhY2tlbmQuYyBiL3NyYy91c2ItYmFja2VuZC5jCmluZGV4IGVmMjk5MDEu
LjgxZDdjOWUgMTAwNjQ0Ci0tLSBhL3NyYy91c2ItYmFja2VuZC5jCisrKyBiL3NyYy91c2ItYmFj
a2VuZC5jCkBAIC01OCw2ICs1OCw3IEBAIHN0cnVjdCBfU3BpY2VVc2JEZXZpY2UKICAgICBVc2JE
ZXZpY2VJbmZvcm1hdGlvbiBkZXZpY2VfaW5mbzsKICAgICBib29sIGNhY2hlZF9pc29jaHJvbm91
c192YWxpZDsKICAgICBib29sIGNhY2hlZF9pc29jaHJvbm91czsKKyAgICBnYm9vbGVhbiBlZGV2
X2NvbmZpZ3VyZWQ7CiB9OwogCiBzdHJ1Y3QgX1NwaWNlVXNiQmFja2VuZApAQCAtODAsMTQgKzgx
LDIzIEBAIHN0cnVjdCBfU3BpY2VVc2JCYWNrZW5kCiAgICAgdWludDMyX3Qgb3duX2RldmljZXNf
bWFzazsKIH07CiAKK3R5cGVkZWYgZW51bSB7CisgICAgVVNCX0NIQU5ORUxfU1RBVEVfSU5JVElB
TElaSU5HLAorICAgIFVTQl9DSEFOTkVMX1NUQVRFX0hPU1QsCisgICAgVVNCX0NIQU5ORUxfU1RB
VEVfUEFSU0VSLAorfSBTcGljZVVzYkJhY2tlbmRDaGFubmVsU3RhdGU7CisKIHN0cnVjdCBfU3Bp
Y2VVc2JCYWNrZW5kQ2hhbm5lbAogewogICAgIHN0cnVjdCB1c2JyZWRpcmhvc3QgKnVzYnJlZGly
aG9zdDsKICAgICBzdHJ1Y3QgdXNicmVkaXJwYXJzZXIgKnBhcnNlcjsKKyAgICBTcGljZVVzYkJh
Y2tlbmRDaGFubmVsU3RhdGUgc3RhdGU7CiAgICAgdWludDhfdCAqcmVhZF9idWY7CiAgICAgaW50
IHJlYWRfYnVmX3NpemU7CiAgICAgc3RydWN0IHVzYnJlZGlyZmlsdGVyX3J1bGUgKnJ1bGVzOwog
ICAgIGludCBydWxlc19jb3VudDsKKyAgICB1aW50MzJfdCByZWplY3RlZCAgICAgICAgICA6IDE7
CisgICAgdWludDMyX3Qgd2FpdF9kaXNjb25uZWN0X2FjayA6IDE7CiAgICAgU3BpY2VVc2JCYWNr
ZW5kRGV2aWNlICphdHRhY2hlZDsKICAgICBTcGljZVVzYnJlZGlyQ2hhbm5lbCAqdXNicmVkaXJf
Y2hhbm5lbDsKICAgICBTcGljZVVzYkJhY2tlbmQgKmJhY2tlbmQ7CkBAIC00MDYsMTMgKzQxNiwx
NyBAQCBmcm9tIGJvdGggdGhlIG1haW4gdGhyZWFkIGFzIHdlbGwgYXMgZnJvbSB0aGUgdXNiIGV2
ZW50IGhhbmRsaW5nIHRocmVhZCAqLwogc3RhdGljIHZvaWQgdXNicmVkaXJfd3JpdGVfZmx1c2hf
Y2FsbGJhY2sodm9pZCAqdXNlcl9kYXRhKQogewogICAgIFNwaWNlVXNiQmFja2VuZENoYW5uZWwg
KmNoID0gdXNlcl9kYXRhOwotICAgIGlmICghY2gtPnVzYnJlZGlyaG9zdCkgewotICAgICAgICAv
KiBqdXN0IHRvIGJlIG9uIHRoZSBzYWZlIHNpZGUgKi8KKyAgICBpZiAoY2gtPnBhcnNlciA9PSBO
VUxMKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgaWYgKGlzX2NoYW5uZWxfcmVhZHko
Y2gtPnVzYnJlZGlyX2NoYW5uZWwpKSB7Ci0gICAgICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCAt
PiB1c2JyZWRpcmhvc3QiLCBfX0ZVTkNUSU9OX18sIGNoKTsKLSAgICAgICAgdXNicmVkaXJob3N0
X3dyaXRlX2d1ZXN0X2RhdGEoY2gtPnVzYnJlZGlyaG9zdCk7CisgICAgICAgIGlmIChjaC0+c3Rh
dGUgPT0gVVNCX0NIQU5ORUxfU1RBVEVfSE9TVCkgeworICAgICAgICAgICAgU1BJQ0VfREVCVUco
IiVzIGNoICVwIC0+IHVzYnJlZGlyaG9zdCIsIF9fRlVOQ1RJT05fXywgY2gpOworICAgICAgICAg
ICAgdXNicmVkaXJob3N0X3dyaXRlX2d1ZXN0X2RhdGEoY2gtPnVzYnJlZGlyaG9zdCk7CisgICAg
ICAgIH0gZWxzZSB7CisgICAgICAgICAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAgLT4gcGFyc2Vy
IiwgX19GVU5DVElPTl9fLCBjaCk7CisgICAgICAgICAgICB1c2JyZWRpcnBhcnNlcl9kb193cml0
ZShjaC0+cGFyc2VyKTsKKyAgICAgICAgfQogICAgIH0gZWxzZSB7CiAgICAgICAgIFNQSUNFX0RF
QlVHKCIlcyBjaCAlcCAobm90IHJlYWR5KSIsIF9fRlVOQ1RJT05fXywgY2gpOwogICAgIH0KQEAg
LTU2NywxMyArNTgxLDUzIEBAIHZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX3VucmVmKFNw
aWNlVXNiQmFja2VuZERldmljZSAqZGV2KQogICAgIH0KIH0KIAotR19HTlVDX0lOVEVSTkFMCitz
dGF0aWMgaW50IGNoZWNrX2VkZXZfZGV2aWNlX2ZpbHRlcihTcGljZVVzYkJhY2tlbmREZXZpY2Ug
KmRldiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCB1
c2JyZWRpcmZpbHRlcl9ydWxlICpydWxlcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGludCBjb3VudCkKK3sKKyAgICBTcGljZVVzYkVtdWxhdGVkRGV2aWNlICplZGV2ID0g
ZGV2LT5lZGV2OworICAgIHVpbnQ4X3QgY2xzWzMyXSwgc3ViY2xzWzMyXSwgcHJvdG9bMzJdLCAq
Y2ZnLCBpZm51bSA9IDA7CisgICAgdWludDE2X3Qgc2l6ZSwgb2Zmc2V0ID0gMDsKKworICAgIGlm
ICghZGV2aWNlX29wcyhlZGV2KS0+Z2V0X2Rlc2NyaXB0b3IoZWRldiwgTElCVVNCX0RUX0NPTkZJ
RywgMCwgKHZvaWQgKiopJmNmZywgJnNpemUpKSB7CisgICAgICAgIHJldHVybiAtRUlOVkFMOwor
ICAgIH0KKworICAgIHdoaWxlICgob2Zmc2V0ICsgMSkgPCBzaXplKSB7CisgICAgICAgIHVpbnQ4
X3QgbGVuICA9IGNmZ1tvZmZzZXRdOworICAgICAgICB1aW50OF90IHR5cGUgPSBjZmdbb2Zmc2V0
ICsgMV07CisgICAgICAgIGlmICgob2Zmc2V0ICsgbGVuKSA+IHNpemUpIHsKKyAgICAgICAgICAg
IGJyZWFrOworICAgICAgICB9CisgICAgICAgIGlmICh0eXBlID09IExJQlVTQl9EVF9JTlRFUkZB
Q0UpIHsKKyAgICAgICAgICAgIGNsc1tpZm51bV0gPSBjZmdbb2Zmc2V0ICsgNV07CisgICAgICAg
ICAgICBzdWJjbHNbaWZudW1dID0gY2ZnW29mZnNldCArIDZdOworICAgICAgICAgICAgcHJvdG9b
aWZudW1dID0gY2ZnW29mZnNldCArIDddOworICAgICAgICAgICAgaWZudW0rKzsKKyAgICAgICAg
fQorICAgICAgICBvZmZzZXQgKz0gbGVuOworICAgIH0KKworICAgIHJldHVybiB1c2JyZWRpcmZp
bHRlcl9jaGVjayhydWxlcywgY291bnQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGRldi0+ZGV2aWNlX2luZm8uY2xhc3MsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGRldi0+ZGV2aWNlX2luZm8uc3ViY2xhc3MsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGRldi0+ZGV2aWNlX2luZm8ucHJvdG9jb2wsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGNscywgc3ViY2xzLCBwcm90bywgaWZudW0sCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGRldi0+ZGV2aWNlX2luZm8udmlkLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBkZXYtPmRldmljZV9pbmZvLnBpZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgZGV2LT5kZXZpY2VfaW5mby5iY2RVU0IsIDApOworfQorCiBpbnQgc3BpY2VfdXNiX2Jh
Y2tlbmRfZGV2aWNlX2NoZWNrX2ZpbHRlcihTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldiwKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCB1c2Jy
ZWRpcmZpbHRlcl9ydWxlICpydWxlcywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGludCBjb3VudCkKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGNvbnN0IHN0cnVjdCB1c2JyZWRpcmZpbHRlcl9ydWxlICpydWxlcywgaW50IGNvdW50
KQogewotICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKGRldi0+bGlidXNiX2RldmljZSAhPSBOVUxM
LCAtRUlOVkFMKTsKLSAgICByZXR1cm4gdXNicmVkaXJob3N0X2NoZWNrX2RldmljZV9maWx0ZXIo
cnVsZXMsIGNvdW50LCBkZXYtPmxpYnVzYl9kZXZpY2UsIDApOworICAgIGlmIChkZXYtPmxpYnVz
Yl9kZXZpY2UgIT0gTlVMTCkgeworICAgICAgICByZXR1cm4gdXNicmVkaXJob3N0X2NoZWNrX2Rl
dmljZV9maWx0ZXIocnVsZXMsIGNvdW50LCBkZXYtPmxpYnVzYl9kZXZpY2UsIDApOworICAgIH0g
ZWxzZSBpZiAoZGV2LT5lZGV2ICE9IE5VTEwpIHsKKyAgICAgICAgcmV0dXJuIGNoZWNrX2VkZXZf
ZGV2aWNlX2ZpbHRlcihkZXYsIHJ1bGVzLCBjb3VudCk7CisgICAgfQorICAgIGdfd2Fybl9pZl9y
ZWFjaGVkKCk7CisgICAgcmV0dXJuIC1FSU5WQUw7CiB9CiAKIHN0YXRpYyBpbnQgdXNicmVkaXJf
cmVhZF9jYWxsYmFjayh2b2lkICp1c2VyX2RhdGEsIHVpbnQ4X3QgKmRhdGEsIGludCBjb3VudCkK
QEAgLTY5MiwxMCArNzQ2LDMzIEBAIGludCBzcGljZV91c2JfYmFja2VuZF9yZWFkX2d1ZXN0X2Rh
dGEoU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gsIHVpbnQ4X3QgKmRhdGEsCiAKICAgICBjaC0+
cmVhZF9idWYgPSBkYXRhOwogICAgIGNoLT5yZWFkX2J1Zl9zaXplID0gY291bnQ7Ci0gICAgaWYg
KGNoLT51c2JyZWRpcmhvc3QpIHsKKyAgICBpZiAoU1BJQ0VfVU5MSUtFTFkoY2gtPnN0YXRlID09
IFVTQl9DSEFOTkVMX1NUQVRFX0lOSVRJQUxJWklORykpIHsKKyAgICAgICAgaWYgKGNoLT51c2Jy
ZWRpcmhvc3QgIT0gTlVMTCkgeworICAgICAgICAgICAgcmVzID0gdXNicmVkaXJob3N0X3JlYWRf
Z3Vlc3RfZGF0YShjaC0+dXNicmVkaXJob3N0KTsKKyAgICAgICAgICAgIGlmIChyZXMgIT0gMCkg
eworICAgICAgICAgICAgICAgIHJldHVybiByZXM7CisgICAgICAgICAgICB9CisgICAgICAgICAg
ICBjaC0+c3RhdGUgPSBVU0JfQ0hBTk5FTF9TVEFURV9IT1NUOworCisgICAgICAgICAgICAvKiB1
c2JyZWRpcmhvc3Qgc2hvdWxkIGNvbnN1bWUgaGVsbG8gcmVzcG9uc2UgKi8KKyAgICAgICAgICAg
IGdfcmV0dXJuX3ZhbF9pZl9mYWlsKGNoLT5yZWFkX2J1ZiA9PSBOVUxMLCBVU0JfUkVESVJfRVJS
T1JfUkVBRF9QQVJTRSk7CisgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICBjaC0+c3RhdGUg
PSBVU0JfQ0hBTk5FTF9TVEFURV9QQVJTRVI7CisgICAgICAgIH0KKworICAgICAgICBjaC0+cmVh
ZF9idWYgPSBkYXRhOworICAgICAgICBjaC0+cmVhZF9idWZfc2l6ZSA9IGNvdW50OworICAgICAg
ICBpZiAoY2gtPmF0dGFjaGVkICYmIGNoLT5hdHRhY2hlZC0+ZWRldikgeworICAgICAgICAgICAg
LyogY2FzZSBvZiBDRCBzaGFyaW5nIG9uIGNvbm5lY3QgKi8KKyAgICAgICAgICAgIGNoLT5zdGF0
ZSA9IFVTQl9DSEFOTkVMX1NUQVRFX1BBUlNFUjsKKyAgICAgICAgICAgIFNQSUNFX0RFQlVHKCIl
czogc3dpdGNoICVwIHRvIHBhcnNlciIsIF9fRlVOQ1RJT05fXywgY2gpOworICAgICAgICB9Cisg
ICAgICAgIHJldHVybiB1c2JyZWRpcnBhcnNlcl9kb19yZWFkKGNoLT5wYXJzZXIpOworICAgIH0K
KyAgICBpZiAoY2gtPnN0YXRlID09IFVTQl9DSEFOTkVMX1NUQVRFX0hPU1QpIHsKICAgICAgICAg
cmVzID0gdXNicmVkaXJob3N0X3JlYWRfZ3Vlc3RfZGF0YShjaC0+dXNicmVkaXJob3N0KTsKICAg
ICB9IGVsc2UgewotICAgICAgICByZXMgPSBVU0JfUkVESVJfRVJST1JfSU87CisgICAgICAgIHJl
cyA9IHVzYnJlZGlycGFyc2VyX2RvX3JlYWQoY2gtPnBhcnNlcik7CiAgICAgfQogICAgIHN3aXRj
aCAocmVzKQogICAgIHsKQEAgLTcxNCw2ICs3OTEsMTEgQEAgaW50IHNwaWNlX3VzYl9iYWNrZW5k
X3JlYWRfZ3Vlc3RfZGF0YShTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCwgdWludDhfdCAqZGF0
YSwKICAgICB9CiAgICAgU1BJQ0VfREVCVUcoIiVzIGNoICVwLCAlZCBieXRlcywgcmVzICVkIiwg
X19GVU5DVElPTl9fLCBjaCwgY291bnQsIHJlcyk7CiAKKyAgICBpZiAoY2gtPnJlamVjdGVkKSB7
CisgICAgICAgIGNoLT5yZWplY3RlZCA9IDA7CisgICAgICAgIHJlcyA9IFVTQl9SRURJUl9FUlJP
Ul9ERVZfUkVKRUNURUQ7CisgICAgfQorCiAgICAgcmV0dXJuIHJlczsKIH0KIApAQCAtNzQwLDIz
ICs4MjIsMTE1IEBAIEdFcnJvciAqc3BpY2VfdXNiX2JhY2tlbmRfZ2V0X2Vycm9yX2RldGFpbHMo
aW50IGVycm9yX2NvZGUsIGdjaGFyICpkZXNjKQogICAgIHJldHVybiBlcnI7CiB9CiAKK3ZvaWQg
c3BpY2VfdXNiX2JhY2tlbmRfcmV0dXJuX3dyaXRlX2RhdGEoU3BpY2VVc2JCYWNrZW5kQ2hhbm5l
bCAqY2gsIHZvaWQgKmRhdGEpCit7CisgICAgaWYgKGNoLT5zdGF0ZSA9PSBVU0JfQ0hBTk5FTF9T
VEFURV9IT1NUKSB7CisgICAgICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCAtPiB1c2JyZWRpcmhv
c3QiLCBfX0ZVTkNUSU9OX18sIGNoKTsKKyAgICAgICAgdXNicmVkaXJob3N0X2ZyZWVfd3JpdGVf
YnVmZmVyKGNoLT51c2JyZWRpcmhvc3QsIGRhdGEpOworICAgIH0gZWxzZSB7CisgICAgICAgIFNQ
SUNFX0RFQlVHKCIlcyBjaCAlcCAtPiBwYXJzZXIiLCBfX0ZVTkNUSU9OX18sIGNoKTsKKyAgICAg
ICAgdXNicmVkaXJwYXJzZXJfZnJlZV93cml0ZV9idWZmZXIoY2gtPnBhcnNlciwgZGF0YSk7Cisg
ICAgfQorfQorCiBzdGF0aWMgdm9pZAogdXNicmVkaXJfY29udHJvbF9wYWNrZXQodm9pZCAqcHJp
diwgdWludDY0X3QgaWQsIHN0cnVjdCB1c2JfcmVkaXJfY29udHJvbF9wYWNrZXRfaGVhZGVyICpo
LAogICAgICAgICAgICAgICAgICAgICAgICAgdWludDhfdCAqZGF0YSwgaW50IGRhdGFfbGVuKQog
ewotICAgIFVTQlJFRElSX0NBTExCQUNLX05PVF9JTVBMRU1FTlRFRCgpOworICAgIFNwaWNlVXNi
QmFja2VuZENoYW5uZWwgKmNoID0gcHJpdjsKKyAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmQg
PSBjaC0+YXR0YWNoZWQ7CisgICAgU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZWRldiA9IGQgPyBk
LT5lZGV2IDogTlVMTDsKKyAgICBzdHJ1Y3QgdXNiX3JlZGlyX2NvbnRyb2xfcGFja2V0X2hlYWRl
ciByZXNwb25zZSA9ICpoOworICAgIHVpbnQ4X3QgcmVxdHlwZSA9IGgtPnJlcXVlc3R0eXBlICYg
MHg3ZjsKKyAgICBnYm9vbGVhbiBkb25lID0gRkFMU0U7CisgICAgdm9pZCAqb3V0X2J1ZmZlciA9
IE5VTEw7CisKKyAgICByZXNwb25zZS5zdGF0dXMgPSB1c2JfcmVkaXJfc3RhbGw7CisgICAgU1BJ
Q0VfREVCVUcoIiVzICVwOiBUUlZJTCAlMDJYICUwMlggJTA0WCAlMDRYICUwNFgiLAorICAgICAg
ICAgICAgICAgIF9fRlVOQ1RJT05fXywKKyAgICAgICAgICAgICAgICBjaCwgaC0+cmVxdWVzdHR5
cGUsIGgtPnJlcXVlc3QsCisgICAgICAgICAgICAgICAgaC0+dmFsdWUsIGgtPmluZGV4LCBoLT5s
ZW5ndGgpOworCisgICAgaWYgKCFlZGV2KSB7CisgICAgICAgIFNQSUNFX0RFQlVHKCIlczogZGV2
aWNlIG5vdCBhdHRhY2hlZCIsIF9fRlVOQ1RJT05fXyk7CisgICAgICAgIHJlc3BvbnNlLnN0YXR1
cyA9IHVzYl9yZWRpcl9pb2Vycm9yOworICAgICAgICBkb25lID0gVFJVRTsKKyAgICB9IGVsc2Ug
aWYgKHJlcXR5cGUgPT0gKExJQlVTQl9SRVFVRVNUX1RZUEVfU1RBTkRBUkQgfCBMSUJVU0JfUkVD
SVBJRU5UX0RFVklDRSkgJiYKKyAgICAgICAgICAgICAgIGgtPnJlcXVlc3QgPT0gTElCVVNCX1JF
UVVFU1RfR0VUX0RFU0NSSVBUT1IpIHsKKyAgICAgICAgdWludDE2X3Qgc2l6ZTsKKyAgICAgICAg
ZG9uZSA9IGRldmljZV9vcHMoZWRldiktPmdldF9kZXNjcmlwdG9yKGVkZXYsIGgtPnZhbHVlID4+
IDgsIGgtPnZhbHVlICYgMHhmZiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICZvdXRfYnVmZmVyLCAmc2l6ZSk7CisgICAgICAgIHJlc3BvbnNlLmxlbmd0
aCA9IHNpemU7CisgICAgICAgIGlmIChkb25lKSB7CisgICAgICAgICAgICByZXNwb25zZS5zdGF0
dXMgPSAwOworICAgICAgICB9CisgICAgICAgIGRvbmUgPSBUUlVFOworICAgIH0KKworICAgIGlm
ICghZG9uZSkgeworICAgICAgICBkZXZpY2Vfb3BzKGVkZXYpLT5jb250cm9sX3JlcXVlc3QoZWRl
diwgZGF0YSwgZGF0YV9sZW4sICZyZXNwb25zZSwgJm91dF9idWZmZXIpOworICAgICAgICBkb25l
ID0gVFJVRTsKKyAgICB9CisKKyAgICBpZiAocmVzcG9uc2Uuc3RhdHVzKSB7CisgICAgICAgIHJl
c3BvbnNlLmxlbmd0aCA9IDA7CisgICAgfSBlbHNlIGlmIChyZXNwb25zZS5sZW5ndGggPiBoLT5s
ZW5ndGgpIHsKKyAgICAgICAgcmVzcG9uc2UubGVuZ3RoID0gaC0+bGVuZ3RoOworICAgIH0KKwor
ICAgIFNQSUNFX0RFQlVHKCIlcyByZXNwb25kaW5nIHdpdGggcGF5bG9hZCBvZiAlMDJYLCBzdGF0
dXMgJVgiLAorICAgICAgICAgICAgICAgIF9fRlVOQ1RJT05fXywgcmVzcG9uc2UubGVuZ3RoLCBy
ZXNwb25zZS5zdGF0dXMpOworICAgIHVzYnJlZGlycGFyc2VyX3NlbmRfY29udHJvbF9wYWNrZXQo
Y2gtPnBhcnNlciwgaWQsICZyZXNwb25zZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHJlc3BvbnNlLmxlbmd0aCA/IG91dF9idWZmZXIgOiBOVUxMLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UubGVuZ3RoKTsKKworICAgIHVz
YnJlZGlyX3dyaXRlX2ZsdXNoX2NhbGxiYWNrKGNoKTsKKyAgICB1c2JyZWRpcnBhcnNlcl9mcmVl
X3BhY2tldF9kYXRhKGNoLT5wYXJzZXIsIGRhdGEpOwogfQogCiBzdGF0aWMgdm9pZAogdXNicmVk
aXJfYnVsa19wYWNrZXQodm9pZCAqcHJpdiwgdWludDY0X3QgaWQsIHN0cnVjdCB1c2JfcmVkaXJf
YnVsa19wYWNrZXRfaGVhZGVyICpoLAogICAgICAgICAgICAgICAgICAgICAgdWludDhfdCAqZGF0
YSwgaW50IGRhdGFfbGVuKQogewotICAgIFVTQlJFRElSX0NBTExCQUNLX05PVF9JTVBMRU1FTlRF
RCgpOworICAgIFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoID0gcHJpdjsKKyAgICBTcGljZVVz
YkJhY2tlbmREZXZpY2UgKmQgPSBjaC0+YXR0YWNoZWQ7CisgICAgU3BpY2VVc2JFbXVsYXRlZERl
dmljZSAqZWRldiA9IGQgPyBkLT5lZGV2IDogTlVMTDsKKyAgICBzdHJ1Y3QgdXNiX3JlZGlyX2J1
bGtfcGFja2V0X2hlYWRlciBob3V0ID0gKmg7CisgICAgdWludDMyX3QgbGVuID0gKGgtPmxlbmd0
aF9oaWdoIDw8IDE2KSB8IGgtPmxlbmd0aDsKKyAgICBTUElDRV9ERUJVRygiJXMgJXA6IGVwICVY
LCBsZW4gJXUsIGlkICUiIEdfR1VJTlQ2NF9GT1JNQVQsIF9fRlVOQ1RJT05fXywKKyAgICAgICAg
ICAgICAgICBjaCwgaC0+ZW5kcG9pbnQsIGxlbiwgaWQpOworCisgICAgaWYgKCFlZGV2KSB7Cisg
ICAgICAgIFNQSUNFX0RFQlVHKCIlczogZGV2aWNlIG5vdCBhdHRhY2hlZCIsIF9fRlVOQ1RJT05f
Xyk7CisgICAgICAgIGhvdXQuc3RhdHVzID0gdXNiX3JlZGlyX2lvZXJyb3I7CisgICAgICAgIGhv
dXQubGVuZ3RoID0gaG91dC5sZW5ndGhfaGlnaCA9IDA7CisgICAgICAgIFNQSUNFX0RFQlVHKCIl
czogcmVzcG9uZGluZyB3aXRoIFpMUCBzdGF0dXMgJWQiLCBfX0ZVTkNUSU9OX18sIGhvdXQuc3Rh
dHVzKTsKKyAgICB9IGVsc2UgaWYgKGgtPmVuZHBvaW50ICYgTElCVVNCX0VORFBPSU5UX0lOKSB7
CisgICAgICAgIGlmIChkZXZpY2Vfb3BzKGVkZXYpLT5idWxrX2luX3JlcXVlc3QoZWRldiwgaWQs
ICZob3V0KSkgeworICAgICAgICAgICAgdXNicmVkaXJwYXJzZXJfZnJlZV9wYWNrZXRfZGF0YShj
aC0+cGFyc2VyLCBkYXRhKTsKKyAgICAgICAgICAgIC8qIGNvbXBsZXRpb24gaXMgYXN5bmNocm9u
b3VzICovCisgICAgICAgICAgICByZXR1cm47CisgICAgICAgIH0KKyAgICB9IGVsc2UgeworICAg
ICAgICBob3V0LnN0YXR1cyA9IHVzYl9yZWRpcl9zdGFsbDsKKyAgICAgICAgZGV2aWNlX29wcyhl
ZGV2KS0+YnVsa19vdXRfcmVxdWVzdChlZGV2LCBoLT5lbmRwb2ludCwgZGF0YSwgZGF0YV9sZW4s
ICZob3V0LnN0YXR1cyk7CisgICAgICAgIFNQSUNFX0RFQlVHKCIlczogcmVzcG9uZGluZyBzdGF0
dXMgJWQiLCBfX0ZVTkNUSU9OX18sIGhvdXQuc3RhdHVzKTsKKyAgICB9CisKKyAgICB1c2JyZWRp
cnBhcnNlcl9zZW5kX2J1bGtfcGFja2V0KGNoLT5wYXJzZXIsIGlkLCAmaG91dCwgTlVMTCwgMCk7
CisgICAgdXNicmVkaXJwYXJzZXJfZnJlZV9wYWNrZXRfZGF0YShjaC0+cGFyc2VyLCBkYXRhKTsK
KyAgICB1c2JyZWRpcl93cml0ZV9mbHVzaF9jYWxsYmFjayhjaCk7CiB9CiAKIHN0YXRpYyB2b2lk
IHVzYnJlZGlyX2RldmljZV9yZXNldCh2b2lkICpwcml2KQogewotICAgIFVTQlJFRElSX0NBTExC
QUNLX05PVF9JTVBMRU1FTlRFRCgpOworICAgIFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoID0g
cHJpdjsKKyAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmQgPSBjaC0+YXR0YWNoZWQ7CisgICAg
U3BpY2VVc2JFbXVsYXRlZERldmljZSAqZWRldiA9IGQgPyBkLT5lZGV2IDogTlVMTDsKKyAgICBT
UElDRV9ERUJVRygiJXMgY2ggJXAiLCBfX0ZVTkNUSU9OX18sIGNoKTsKKyAgICBpZiAoZWRldikg
eworICAgICAgICBkZXZpY2Vfb3BzKGVkZXYpLT5yZXNldChlZGV2KTsKKyAgICB9CiB9CiAKIHN0
YXRpYyB2b2lkCkBAIC03NzUsMzQgKzk0OSw3MiBAQCBzdGF0aWMgdm9pZAogdXNicmVkaXJfc2V0
X2NvbmZpZ3VyYXRpb24odm9pZCAqcHJpdiwgdWludDY0X3QgaWQsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBzdHJ1Y3QgdXNiX3JlZGlyX3NldF9jb25maWd1cmF0aW9uX2hlYWRlciAqc2V0
X2NvbmZpZ3VyYXRpb24pCiB7Ci0gICAgVVNCUkVESVJfQ0FMTEJBQ0tfTk9UX0lNUExFTUVOVEVE
KCk7CisgICAgU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSBwcml2OworICAgIHN0cnVjdCB1
c2JfcmVkaXJfY29uZmlndXJhdGlvbl9zdGF0dXNfaGVhZGVyIGg7CisgICAgaC5zdGF0dXMgPSAw
OworICAgIGguY29uZmlndXJhdGlvbiA9IHNldF9jb25maWd1cmF0aW9uLT5jb25maWd1cmF0aW9u
OworICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCwgY2ZnICVkIiwgX19GVU5DVElPTl9fLCBjaCwg
aC5jb25maWd1cmF0aW9uKTsKKyAgICBpZiAoY2gtPmF0dGFjaGVkKSB7CisgICAgICAgIGNoLT5h
dHRhY2hlZC0+ZWRldl9jb25maWd1cmVkID0gaC5jb25maWd1cmF0aW9uICE9IDA7CisgICAgfQor
ICAgIHVzYnJlZGlycGFyc2VyX3NlbmRfY29uZmlndXJhdGlvbl9zdGF0dXMoY2gtPnBhcnNlciwg
aWQsICZoKTsKKyAgICB1c2JyZWRpcl93cml0ZV9mbHVzaF9jYWxsYmFjayhjaCk7CiB9CiAKIHN0
YXRpYyB2b2lkIHVzYnJlZGlyX2dldF9jb25maWd1cmF0aW9uKHZvaWQgKnByaXYsIHVpbnQ2NF90
IGlkKQogewotICAgIFVTQlJFRElSX0NBTExCQUNLX05PVF9JTVBMRU1FTlRFRCgpOworICAgIFNw
aWNlVXNiQmFja2VuZENoYW5uZWwgKmNoID0gcHJpdjsKKyAgICBzdHJ1Y3QgdXNiX3JlZGlyX2Nv
bmZpZ3VyYXRpb25fc3RhdHVzX2hlYWRlciBoOworICAgIGguc3RhdHVzID0gMDsKKyAgICBoLmNv
bmZpZ3VyYXRpb24gPSBjaC0+YXR0YWNoZWQgJiYgY2gtPmF0dGFjaGVkLT5lZGV2X2NvbmZpZ3Vy
ZWQ7CisgICAgU1BJQ0VfREVCVUcoIiVzIGNoICVwLCBjZmcgJWQiLCBfX0ZVTkNUSU9OX18sIGNo
LCBoLmNvbmZpZ3VyYXRpb24pOworICAgIHVzYnJlZGlycGFyc2VyX3NlbmRfY29uZmlndXJhdGlv
bl9zdGF0dXMoY2gtPnBhcnNlciwgaWQsICZoKTsKKyAgICB1c2JyZWRpcl93cml0ZV9mbHVzaF9j
YWxsYmFjayhjaCk7CiB9CiAKIHN0YXRpYyB2b2lkCiB1c2JyZWRpcl9zZXRfYWx0X3NldHRpbmco
dm9pZCAqcHJpdiwgdWludDY0X3QgaWQsIHN0cnVjdCB1c2JfcmVkaXJfc2V0X2FsdF9zZXR0aW5n
X2hlYWRlciAqcykKIHsKLSAgICBVU0JSRURJUl9DQUxMQkFDS19OT1RfSU1QTEVNRU5URUQoKTsK
KyAgICBTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCA9IHByaXY7CisgICAgc3RydWN0IHVzYl9y
ZWRpcl9hbHRfc2V0dGluZ19zdGF0dXNfaGVhZGVyIHNoOworICAgIHNoLnN0YXR1cyA9ICghcy0+
aW50ZXJmYWNlICYmICFzLT5hbHQpID8gMCA6IHVzYl9yZWRpcl9zdGFsbDsKKyAgICBzaC5pbnRl
cmZhY2UgPSBzLT5pbnRlcmZhY2U7CisgICAgc2guYWx0ID0gcy0+YWx0OworICAgIFNQSUNFX0RF
QlVHKCIlcyBjaCAlcCwgJWQ6JWQiLCBfX0ZVTkNUSU9OX18sIGNoLCBzLT5pbnRlcmZhY2UsIHMt
PmFsdCk7CisgICAgdXNicmVkaXJwYXJzZXJfc2VuZF9hbHRfc2V0dGluZ19zdGF0dXMoY2gtPnBh
cnNlciwgaWQsICZzaCk7CisgICAgdXNicmVkaXJfd3JpdGVfZmx1c2hfY2FsbGJhY2soY2gpOwog
fQogCiBzdGF0aWMgdm9pZAogdXNicmVkaXJfZ2V0X2FsdF9zZXR0aW5nKHZvaWQgKnByaXYsIHVp
bnQ2NF90IGlkLCBzdHJ1Y3QgdXNiX3JlZGlyX2dldF9hbHRfc2V0dGluZ19oZWFkZXIgKnMpCiB7
Ci0gICAgVVNCUkVESVJfQ0FMTEJBQ0tfTk9UX0lNUExFTUVOVEVEKCk7CisgICAgU3BpY2VVc2JC
YWNrZW5kQ2hhbm5lbCAqY2ggPSBwcml2OworICAgIHN0cnVjdCB1c2JfcmVkaXJfYWx0X3NldHRp
bmdfc3RhdHVzX2hlYWRlciBzaDsKKyAgICBzaC5zdGF0dXMgPSAocy0+aW50ZXJmYWNlID09IDAp
ID8gMCA6IHVzYl9yZWRpcl9zdGFsbDsKKyAgICBzaC5pbnRlcmZhY2UgPSBzLT5pbnRlcmZhY2U7
CisgICAgc2guYWx0ID0gMDsKKyAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAsIGlmICVkIiwgX19G
VU5DVElPTl9fLCBjaCwgcy0+aW50ZXJmYWNlKTsKKyAgICB1c2JyZWRpcnBhcnNlcl9zZW5kX2Fs
dF9zZXR0aW5nX3N0YXR1cyhjaC0+cGFyc2VyLCBpZCwgJnNoKTsKKyAgICB1c2JyZWRpcl93cml0
ZV9mbHVzaF9jYWxsYmFjayhjaCk7CiB9CiAKIHN0YXRpYyB2b2lkIHVzYnJlZGlyX2NhbmNlbF9k
YXRhKHZvaWQgKnByaXYsIHVpbnQ2NF90IGlkKQogewotICAgIFVTQlJFRElSX0NBTExCQUNLX05P
VF9JTVBMRU1FTlRFRCgpOworICAgIFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoID0gcHJpdjsK
KyAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmQgPSBjaC0+YXR0YWNoZWQ7CisgICAgU3BpY2VV
c2JFbXVsYXRlZERldmljZSAqZWRldiA9IGQgPyBkLT5lZGV2IDogTlVMTDsKKyAgICBpZiAoIWVk
ZXYpIHsKKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiBkZXZpY2Ugbm90IGF0dGFjaGVkIiwgX19G
VU5DVElPTl9fKTsKKyAgICAgICAgcmV0dXJuOworICAgIH0KKyAgICBkZXZpY2Vfb3BzKGVkZXYp
LT5jYW5jZWxfcmVxdWVzdChlZGV2LCBpZCk7CiB9CiAKIHN0YXRpYyB2b2lkIHVzYnJlZGlyX2Zp
bHRlcl9yZWplY3Qodm9pZCAqcHJpdikKIHsKLSAgICBVU0JSRURJUl9DQUxMQkFDS19OT1RfSU1Q
TEVNRU5URUQoKTsKKyAgICBTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCA9IHByaXY7CisgICAg
U1BJQ0VfREVCVUcoIiVzICVwIiwgX19GVU5DVElPTl9fLCBjaCk7CisgICAgY2gtPnJlamVjdGVk
ID0gMTsKIH0KIAogLyogTm90ZSB0aGF0IHRoZSBvd25lcnNoaXAgb2YgdGhlIHJ1bGVzIGFycmF5
IGlzIHBhc3NlZCBvbiB0byB0aGUgY2FsbGJhY2suICovCkBAIC04MjcsMTMgKzEwMzksNzcgQEAg
dXNicmVkaXJfZmlsdGVyX2ZpbHRlcih2b2lkICpwcml2LCBzdHJ1Y3QgdXNicmVkaXJmaWx0ZXJf
cnVsZSAqciwgaW50IGNvdW50KQogCiBzdGF0aWMgdm9pZCB1c2JyZWRpcl9kZXZpY2VfZGlzY29u
bmVjdF9hY2sodm9pZCAqcHJpdikKIHsKLSAgICBVU0JSRURJUl9DQUxMQkFDS19OT1RfSU1QTEVN
RU5URUQoKTsKKyAgICBTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCA9IHByaXY7CisgICAgU1BJ
Q0VfREVCVUcoIiVzIGNoICVwIiwgX19GVU5DVElPTl9fLCBjaCk7CisgICAgaWYgKGNoLT5zdGF0
ZSA9PSBVU0JfQ0hBTk5FTF9TVEFURV9QQVJTRVIgJiYgY2gtPnVzYnJlZGlyaG9zdCAhPSBOVUxM
ICYmCisgICAgICAgIGNoLT53YWl0X2Rpc2Nvbm5lY3RfYWNrKSB7CisgICAgICAgIGNoLT5zdGF0
ZSA9IFVTQl9DSEFOTkVMX1NUQVRFX0hPU1Q7CisgICAgICAgIFNQSUNFX0RFQlVHKCIlcyBzd2l0
Y2ggdG8gdXNicmVkaXJob3N0IiwgX19GVU5DVElPTl9fKTsKKyAgICB9CisgICAgY2gtPndhaXRf
ZGlzY29ubmVjdF9hY2sgPSAwOwogfQogCiBzdGF0aWMgdm9pZAogdXNicmVkaXJfaGVsbG8odm9p
ZCAqcHJpdiwgc3RydWN0IHVzYl9yZWRpcl9oZWxsb19oZWFkZXIgKmhlbGxvKQogewotICAgIFVT
QlJFRElSX0NBTExCQUNLX05PVF9JTVBMRU1FTlRFRCgpOworICAgIFNwaWNlVXNiQmFja2VuZENo
YW5uZWwgKmNoID0gcHJpdjsKKyAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmQgPSBjaC0+YXR0
YWNoZWQ7CisgICAgU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZWRldiA9IGQgPyBkLT5lZGV2IDog
TlVMTDsKKyAgICBzdHJ1Y3QgdXNiX3JlZGlyX2RldmljZV9jb25uZWN0X2hlYWRlciBkZXZpY2Vf
Y29ubmVjdDsKKyAgICBzdHJ1Y3QgdXNiX3JlZGlyX2VwX2luZm9faGVhZGVyIGVwX2luZm8gPSB7
IDAgfTsKKyAgICBzdHJ1Y3QgdXNiX3JlZGlyX2ludGVyZmFjZV9pbmZvX2hlYWRlciBpbnRlcmZh
Y2VfaW5mbyA9IHsgMCB9OworICAgIHVpbnQ4X3QgKmNmZzsKKyAgICB1aW50MTZfdCBzaXplLCBv
ZmZzZXQgPSAwOworICAgIFNQSUNFX0RFQlVHKCIlcyAlcCAlc2F0dGFjaGVkICVzIiwgX19GVU5D
VElPTl9fLCBjaCwKKyAgICAgICAgZWRldiA/ICIiIDogIm5vdCAiLCAgaGVsbG8gPyAiIiA6ICIo
aW50ZXJuYWwpIik7CisKKyAgICBpZiAoIWVkZXYpIHsKKyAgICAgICAgcmV0dXJuOworICAgIH0K
KyAgICBpZiAoIWRldmljZV9vcHMoZWRldiktPmdldF9kZXNjcmlwdG9yKGVkZXYsIExJQlVTQl9E
VF9DT05GSUcsIDAsICh2b2lkICoqKSZjZmcsICZzaXplKSkgeworICAgICAgICByZXR1cm47Cisg
ICAgfQorICAgIHdoaWxlICgob2Zmc2V0ICsgMSkgPCBzaXplKSB7CisgICAgICAgIHVpbnQ4X3Qg
bGVuICA9IGNmZ1tvZmZzZXRdOworICAgICAgICB1aW50OF90IHR5cGUgPSBjZmdbb2Zmc2V0ICsg
MV07CisgICAgICAgIGlmICgob2Zmc2V0ICsgbGVuKSA+IHNpemUpIHsKKyAgICAgICAgICAgIGJy
ZWFrOworICAgICAgICB9CisgICAgICAgIGlmICh0eXBlID09IExJQlVTQl9EVF9JTlRFUkZBQ0Up
IHsKKyAgICAgICAgICAgIHVpbnQzMl90IGkgPSBpbnRlcmZhY2VfaW5mby5pbnRlcmZhY2VfY291
bnQ7CisgICAgICAgICAgICB1aW50OF90IGNsYXNzLCBzdWJjbGFzcywgcHJvdG9jb2w7CisgICAg
ICAgICAgICBjbGFzcyA9IGNmZ1tvZmZzZXQgKyA1XTsKKyAgICAgICAgICAgIHN1YmNsYXNzID0g
Y2ZnW29mZnNldCArIDZdOworICAgICAgICAgICAgcHJvdG9jb2wgPSBjZmdbb2Zmc2V0ICsgN107
CisgICAgICAgICAgICBpbnRlcmZhY2VfaW5mby5pbnRlcmZhY2VfY2xhc3NbaV0gPSBjbGFzczsK
KyAgICAgICAgICAgIGludGVyZmFjZV9pbmZvLmludGVyZmFjZV9zdWJjbGFzc1tpXSA9IHN1YmNs
YXNzOworICAgICAgICAgICAgaW50ZXJmYWNlX2luZm8uaW50ZXJmYWNlX3Byb3RvY29sW2ldID0g
cHJvdG9jb2w7CisgICAgICAgICAgICBpbnRlcmZhY2VfaW5mby5pbnRlcmZhY2VfY291bnQrKzsK
KyAgICAgICAgICAgIFNQSUNFX0RFQlVHKCIlcyBJRiVkOiAlZC8lZC8lZCIsIF9fRlVOQ1RJT05f
XywgaSwgY2xhc3MsIHN1YmNsYXNzLCBwcm90b2NvbCk7CisgICAgICAgIH0gZWxzZSBpZiAodHlw
ZSA9PSBMSUJVU0JfRFRfRU5EUE9JTlQpIHsKKyAgICAgICAgICAgIHVpbnQ4X3QgYWRkcmVzcyA9
IGNmZ1tvZmZzZXQgKyAyXTsKKyAgICAgICAgICAgIHVpbnQxNl90IG1heF9wYWNrZXRfc2l6ZSA9
IDB4MTAwICogY2ZnW29mZnNldCArIDVdICsgY2ZnW29mZnNldCArIDRdOworICAgICAgICAgICAg
dWludDhfdCBpbmRleCA9IGFkZHJlc3MgJiAweGY7CisgICAgICAgICAgICBpZiAoYWRkcmVzcyAm
IDB4ODApIGluZGV4ICs9IDB4MTA7CisgICAgICAgICAgICBlcF9pbmZvLnR5cGVbaW5kZXhdID0g
Y2ZnW29mZnNldCArIDNdICYgMHgzOworICAgICAgICAgICAgZXBfaW5mby5tYXhfcGFja2V0X3Np
emVbaW5kZXhdID0gbWF4X3BhY2tldF9zaXplOworICAgICAgICAgICAgU1BJQ0VfREVCVUcoIiVz
IEVQWyUwMlhdOiAlZC8lZCIsIF9fRlVOQ1RJT05fXywgaW5kZXgsIGVwX2luZm8udHlwZVtpbmRl
eF0sIG1heF9wYWNrZXRfc2l6ZSk7CisgICAgICAgIH0KKyAgICAgICAgb2Zmc2V0ICs9IGxlbjsK
KyAgICB9CisKKyAgICB1c2JyZWRpcnBhcnNlcl9zZW5kX2ludGVyZmFjZV9pbmZvKGNoLT5wYXJz
ZXIsICZpbnRlcmZhY2VfaW5mbyk7CisgICAgdXNicmVkaXJwYXJzZXJfc2VuZF9lcF9pbmZvKGNo
LT5wYXJzZXIsICZlcF9pbmZvKTsKKworICAgIGRldmljZV9jb25uZWN0LmRldmljZV9jbGFzcyA9
IDA7IC8vZC0+ZGV2aWNlX2luZm8uY2xhc3M7CisgICAgZGV2aWNlX2Nvbm5lY3QuZGV2aWNlX3N1
YmNsYXNzID0gMDsgLy9kLT5kZXZpY2VfaW5mby5zdWJjbGFzczsKKyAgICBkZXZpY2VfY29ubmVj
dC5kZXZpY2VfcHJvdG9jb2wgPSAwOyAvL2QtPmRldmljZV9pbmZvLnByb3RvY29sOzsKKyAgICBk
ZXZpY2VfY29ubmVjdC52ZW5kb3JfaWQgPSBkLT5kZXZpY2VfaW5mby52aWQ7CisgICAgZGV2aWNl
X2Nvbm5lY3QucHJvZHVjdF9pZCA9IGQtPmRldmljZV9pbmZvLnBpZDsKKyAgICBkZXZpY2VfY29u
bmVjdC5kZXZpY2VfdmVyc2lvbl9iY2QgPSBkLT5kZXZpY2VfaW5mby5iY2RVU0I7CisgICAgZGV2
aWNlX2Nvbm5lY3Quc3BlZWQgPSB1c2JfcmVkaXJfc3BlZWRfaGlnaDsKKyAgICB1c2JyZWRpcnBh
cnNlcl9zZW5kX2RldmljZV9jb25uZWN0KGNoLT5wYXJzZXIsICZkZXZpY2VfY29ubmVjdCk7Cisg
ICAgdXNicmVkaXJfd3JpdGVfZmx1c2hfY2FsbGJhY2soY2gpOwogfQogCiBzdGF0aWMgdm9pZCBp
bml0aWFsaXplX3BhcnNlcihTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCkKQEAgLTg5OSwxNCAr
MTE3NSwzNiBAQCBzdGF0aWMgc3RydWN0IHVzYnJlZGlycGFyc2VyICpjcmVhdGVfcGFyc2VyKFNw
aWNlVXNiQmFja2VuZENoYW5uZWwgKmNoKQogICAgIHJldHVybiBwYXJzZXI7CiB9CiAKLXZvaWQg
c3BpY2VfdXNiX2JhY2tlbmRfcmV0dXJuX3dyaXRlX2RhdGEoU3BpY2VVc2JCYWNrZW5kQ2hhbm5l
bCAqY2gsIHZvaWQgKmRhdGEpCitzdGF0aWMgZ2Jvb2xlYW4gYXR0YWNoX2VkZXYoU3BpY2VVc2JC
YWNrZW5kQ2hhbm5lbCAqY2gsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VVc2JC
YWNrZW5kRGV2aWNlICpkZXYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgR0Vycm9yICoq
ZXJyb3IpCiB7Ci0gICAgaWYgKGNoLT51c2JyZWRpcmhvc3QpIHsKLSAgICAgICAgU1BJQ0VfREVC
VUcoIiVzIGNoICVwIiwgX19GVU5DVElPTl9fLCBjaCk7Ci0gICAgICAgIHVzYnJlZGlyaG9zdF9m
cmVlX3dyaXRlX2J1ZmZlcihjaC0+dXNicmVkaXJob3N0LCBkYXRhKTsKKyAgICBpZiAoIWRldi0+
ZWRldikgeworICAgICAgICBnX3NldF9lcnJvcihlcnJvciwgU1BJQ0VfQ0xJRU5UX0VSUk9SLCBT
UElDRV9DTElFTlRfRVJST1JfRkFJTEVELAorICAgICAgICAgICBfKCJGYWlsZWQgdG8gcmVkaXJl
Y3QgZGV2aWNlICVkIiksIDEpOworICAgICAgICByZXR1cm4gRkFMU0U7CisgICAgfQorICAgIGlm
IChjaC0+c3RhdGUgPT0gVVNCX0NIQU5ORUxfU1RBVEVfSU5JVElBTElaSU5HKSB7CisgICAgICAg
IC8qCisgICAgICAgICAgICB3ZSBjYW4ndCBpbml0aWFsaXplIHBhcnNlciB1bnRpbCB3ZSBzZWUg
aGVsbG8gZnJvbSB1c2JyZWRpcgorICAgICAgICAgICAgYW5kIHRoZSBwYXJzZXIgY2FuJ3Qgd29y
ayB1bnRpbCBpdCBzZWVzIHRoZSBoZWxsbyByZXNwb25zZS4KKyAgICAgICAgICAgIHRoaXMgaXMg
Y2FzZSBvZiBhdXRvY29ubmVjdCB3aGVuIGVtdWxhdGVkIGRldmljZSBpcyBhdHRhY2hlZAorICAg
ICAgICAgICAgYmVmb3JlIHRoZSBjaGFubmVsIGlzIHVwCisgICAgICAgICovCisgICAgICAgIFNQ
SUNFX0RFQlVHKCIlcyB3YWl0aW5nIHVudGlsIHRoZSBjaGFubmVsIGlzIHJlYWR5IiwgX19GVU5D
VElPTl9fKTsKKwogICAgIH0gZWxzZSB7Ci0gICAgICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCAt
IE5PQk9EWSBUTyBDQUxMIiwgX19GVU5DVElPTl9fLCBjaCk7CisgICAgICAgIGNoLT5zdGF0ZSA9
IFVTQl9DSEFOTkVMX1NUQVRFX1BBUlNFUjsKICAgICB9CisgICAgY2gtPndhaXRfZGlzY29ubmVj
dF9hY2sgPSAwOworICAgIGNoLT5hdHRhY2hlZCA9IGRldjsKKyAgICBkZXYtPmF0dGFjaGVkX3Rv
ID0gY2g7CisgICAgZGV2aWNlX29wcyhkZXYtPmVkZXYpLT5hdHRhY2goZGV2LT5lZGV2LCBjaC0+
cGFyc2VyKTsKKyAgICBpZiAoY2gtPnN0YXRlID09IFVTQl9DSEFOTkVMX1NUQVRFX1BBUlNFUikg
eworICAgICAgICAvKiBzZW5kIGRldmljZSBpbmZvICovCisgICAgICAgIHVzYnJlZGlyX2hlbGxv
KGNoLCBOVUxMKTsKKyAgICB9CisgICAgcmV0dXJuIFRSVUU7CiB9CiAKIGdib29sZWFuIHNwaWNl
X3VzYl9iYWNrZW5kX2NoYW5uZWxfYXR0YWNoKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLApA
QCAtOTE4LDEyICsxMjE2LDE5IEBAIGdib29sZWFuIHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxf
YXR0YWNoKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLAogCiAgICAgZ19yZXR1cm5fdmFsX2lm
X2ZhaWwoZGV2ICE9IE5VTEwsIEZBTFNFKTsKIAorICAgIGlmICghZGV2LT5saWJ1c2JfZGV2aWNl
KSB7CisgICAgICAgIHJldHVybiBhdHRhY2hfZWRldihjaCwgZGV2LCBlcnJvcik7CisgICAgfQor
CiAgICAgLy8gbm8gcGh5c2ljYWwgZGV2aWNlIGVuYWJsZWQKICAgICBpZiAoY2gtPnVzYnJlZGly
aG9zdCA9PSBOVUxMKSB7CiAgICAgICAgIHJldHVybiBGQUxTRTsKICAgICB9CiAKICAgICBsaWJ1
c2JfZGV2aWNlX2hhbmRsZSAqaGFuZGxlID0gTlVMTDsKKyAgICBpZiAoY2gtPnN0YXRlICE9IFVT
Ql9DSEFOTkVMX1NUQVRFX0lOSVRJQUxJWklORykgeworICAgICAgICBjaC0+c3RhdGUgPSBVU0Jf
Q0hBTk5FTF9TVEFURV9IT1NUOworICAgIH0KIAogICAgIC8qCiAgICAgICAgVW5kZXIgV2luZG93
cyB3ZSBuZWVkIHRvIGF2b2lkIHVwZGF0aW5nCkBAIC05NTcsMTggKzEyNjIsMzIgQEAgZ2Jvb2xl
YW4gc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9hdHRhY2goU3BpY2VVc2JCYWNrZW5kQ2hhbm5l
bCAqY2gsCiAKIHZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9kZXRhY2goU3BpY2VVc2JC
YWNrZW5kQ2hhbm5lbCAqY2gpCiB7CisgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkID0gY2gt
PmF0dGFjaGVkOworICAgIFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmVkZXYgPSBkID8gZC0+ZWRl
diA6IE5VTEw7CiAgICAgU1BJQ0VfREVCVUcoIiVzID4+IGNoICVwLCB3YXMgYXR0YWNoZWQgJXAi
LCBfX0ZVTkNUSU9OX18sIGNoLCBjaC0+YXR0YWNoZWQpOwotICAgIGlmICghY2gtPmF0dGFjaGVk
KSB7CisgICAgaWYgKCFkKSB7CiAgICAgICAgIFNQSUNFX0RFQlVHKCIlczogbm90aGluZyB0byBk
ZXRhY2giLCBfX0ZVTkNUSU9OX18pOwogICAgICAgICByZXR1cm47CiAgICAgfQotICAgIGlmIChj
aC0+dXNicmVkaXJob3N0KSB7CisgICAgaWYgKGNoLT5zdGF0ZSA9PSBVU0JfQ0hBTk5FTF9TVEFU
RV9IT1NUKSB7CiAgICAgICAgIC8qIGl0IHdpbGwgY2FsbCBsaWJ1c2JfY2xvc2UgaW50ZXJuYWxs
eSAqLwogICAgICAgICB1c2JyZWRpcmhvc3Rfc2V0X2RldmljZShjaC0+dXNicmVkaXJob3N0LCBO
VUxMKTsKKyAgICB9IGVsc2UgeworICAgICAgICBpZiAoZWRldikgeworICAgICAgICAgICAgZGV2
aWNlX29wcyhlZGV2KS0+ZGV0YWNoKGVkZXYpOworICAgICAgICB9CisgICAgICAgIHVzYnJlZGly
cGFyc2VyX3NlbmRfZGV2aWNlX2Rpc2Nvbm5lY3QoY2gtPnBhcnNlcik7CisgICAgICAgIHVzYnJl
ZGlyX3dyaXRlX2ZsdXNoX2NhbGxiYWNrKGNoKTsKKyAgICAgICAgY2gtPndhaXRfZGlzY29ubmVj
dF9hY2sgPQorICAgICAgICAgICAgdXNicmVkaXJwYXJzZXJfcGVlcl9oYXNfY2FwKGNoLT5wYXJz
ZXIsIHVzYl9yZWRpcl9jYXBfZGV2aWNlX2Rpc2Nvbm5lY3RfYWNrKTsKKyAgICAgICAgaWYgKCFj
aC0+d2FpdF9kaXNjb25uZWN0X2FjayAmJiBjaC0+dXNicmVkaXJob3N0ICE9IE5VTEwpIHsKKyAg
ICAgICAgICAgIGNoLT5zdGF0ZSA9IFVTQl9DSEFOTkVMX1NUQVRFX0hPU1Q7CisgICAgICAgIH0K
ICAgICB9CiAgICAgU1BJQ0VfREVCVUcoIiVzIGNoICVwLCBkZXRhY2ggZG9uZSIsIF9fRlVOQ1RJ
T05fXywgY2gpOwogICAgIGNoLT5hdHRhY2hlZC0+YXR0YWNoZWRfdG8gPSBOVUxMOwogICAgIGNo
LT5hdHRhY2hlZCA9IE5VTEw7CisgICAgY2gtPnJlamVjdGVkID0gMDsKIH0KIAogU3BpY2VVc2JC
YWNrZW5kQ2hhbm5lbCAqCkBAIC05ODIsMjMgKzEzMDEsMjUgQEAgc3BpY2VfdXNiX2JhY2tlbmRf
Y2hhbm5lbF9uZXcoU3BpY2VVc2JCYWNrZW5kICpiZSwKICAgICBjaC0+dXNicmVkaXJfY2hhbm5l
bCA9IHVzYnJlZGlyX2NoYW5uZWw7CiAgICAgaWYgKGJlLT5saWJ1c2JfY29udGV4dCkgewogICAg
ICAgICBjaC0+YmFja2VuZCA9IGJlOwotICAgICAgICBjaC0+dXNicmVkaXJob3N0ID0gdXNicmVk
aXJob3N0X29wZW5fZnVsbCgKLSAgICAgICAgICAgIGJlLT5saWJ1c2JfY29udGV4dCwKLSAgICAg
ICAgICAgIE5VTEwsCi0gICAgICAgICAgICB1c2JyZWRpcl9sb2csCi0gICAgICAgICAgICB1c2Jy
ZWRpcl9yZWFkX2NhbGxiYWNrLAotICAgICAgICAgICAgdXNicmVkaXJfd3JpdGVfY2FsbGJhY2ss
Ci0gICAgICAgICAgICB1c2JyZWRpcl93cml0ZV9mbHVzaF9jYWxsYmFjaywKLSAgICAgICAgICAg
IHVzYnJlZGlyX2FsbG9jX2xvY2ssCi0gICAgICAgICAgICB1c2JyZWRpcl9sb2NrX2xvY2ssCi0g
ICAgICAgICAgICB1c2JyZWRpcl91bmxvY2tfbG9jaywKLSAgICAgICAgICAgIHVzYnJlZGlyX2Zy
ZWVfbG9jaywKLSAgICAgICAgICAgIGNoLCBQQUNLQUdFX1NUUklORywKLSAgICAgICAgICAgIHNw
aWNlX3V0aWxfZ2V0X2RlYnVnKCkgPyB1c2JyZWRpcnBhcnNlcl9kZWJ1ZyA6IHVzYnJlZGlycGFy
c2VyX3dhcm5pbmcsCi0gICAgICAgICAgICB1c2JyZWRpcmhvc3RfZmxfd3JpdGVfY2Jfb3duc19i
dWZmZXIpOworICAgICAgICBjaC0+dXNicmVkaXJob3N0ID0KKyAgICAgICAgICAgIHVzYnJlZGly
aG9zdF9vcGVuX2Z1bGwoYmUtPmxpYnVzYl9jb250ZXh0LAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBOVUxMLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1
c2JyZWRpcl9sb2csCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzYnJlZGly
X3JlYWRfY2FsbGJhY2ssCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzYnJl
ZGlyX3dyaXRlX2NhbGxiYWNrLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1
c2JyZWRpcl93cml0ZV9mbHVzaF9jYWxsYmFjaywKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdXNicmVkaXJfYWxsb2NfbG9jaywKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdXNicmVkaXJfbG9ja19sb2NrLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB1c2JyZWRpcl91bmxvY2tfbG9jaywKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdXNicmVkaXJfZnJlZV9sb2NrLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBjaCwgUEFDS0FHRV9TVFJJTkcsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHNwaWNlX3V0aWxfZ2V0X2RlYnVnKCkgPyB1c2JyZWRpcnBhcnNlcl9kZWJ1ZyA6Cisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNicmVkaXJwYXJzZXJfd2Fy
bmluZywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNicmVkaXJob3N0X2Zs
X3dyaXRlX2NiX293bnNfYnVmZmVyKTsKICAgICAgICAgZ193YXJuX2lmX2ZhaWwoY2gtPnVzYnJl
ZGlyaG9zdCAhPSBOVUxMKTsKLSAgICAgICAgaWYgKGNoLT51c2JyZWRpcmhvc3QpIHsKLSAgICAg
ICAgICAgIHVzYnJlZGlyaG9zdF9zZXRfYnVmZmVyZWRfb3V0cHV0X3NpemVfY2IoY2gtPnVzYnJl
ZGlyaG9zdCwgdXNicmVkaXJfYnVmZmVyZWRfb3V0cHV0X3NpemVfY2FsbGJhY2spOworICAgICAg
ICBpZiAoY2gtPnVzYnJlZGlyaG9zdCAhPSBOVUxMKSB7CisgICAgICAgICAgICB1c2JyZWRpcmhv
c3Rfc2V0X2J1ZmZlcmVkX291dHB1dF9zaXplX2NiKGNoLT51c2JyZWRpcmhvc3QsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzYnJlZGlyX2J1
ZmZlcmVkX291dHB1dF9zaXplX2NhbGxiYWNrKTsKICAgICAgICAgICAgIC8vIGZvcmNlIGZsdXNo
IG9mIEhFTExPIHBhY2tldCBhbmQgY3JlYXRpb24gb2YgcGFyc2VyCiAgICAgICAgICAgICB1c2Jy
ZWRpcmhvc3Rfd3JpdGVfZ3Vlc3RfZGF0YShjaC0+dXNicmVkaXJob3N0KTsKICAgICAgICAgfQpA
QCAtMTAyMiw5ICsxMzQzLDExIEBAIHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfbmV3KFNwaWNl
VXNiQmFja2VuZCAqYmUsCiAKIHZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9mbHVzaF93
cml0ZXMoU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gpCiB7Ci0gICAgU1BJQ0VfREVCVUcoIiVz
ICVwLCBob3N0ICVwIiwgX19GVU5DVElPTl9fLCBjaCwgY2gtPnVzYnJlZGlyaG9zdCk7Ci0gICAg
aWYgKGNoLT51c2JyZWRpcmhvc3QpIHsKKyAgICBTUElDRV9ERUJVRygiJXMgJXAgaXMgdXAiLCBf
X0ZVTkNUSU9OX18sIGNoKTsKKyAgICBpZiAoY2gtPnN0YXRlICE9IFVTQl9DSEFOTkVMX1NUQVRF
X1BBUlNFUiAmJiBjaC0+dXNicmVkaXJob3N0ICE9IE5VTEwpIHsKICAgICAgICAgdXNicmVkaXJo
b3N0X3dyaXRlX2d1ZXN0X2RhdGEoY2gtPnVzYnJlZGlyaG9zdCk7CisgICAgfSBlbHNlIHsKKyAg
ICAgICAgdXNicmVkaXJwYXJzZXJfZG9fd3JpdGUoY2gtPnBhcnNlcik7CiAgICAgfQogfQogCi0t
IAoyLjIxLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
ClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9zcGljZS1k
ZXZlbA==
