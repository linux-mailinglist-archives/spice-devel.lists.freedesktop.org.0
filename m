Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D0C9D72183
	for <lists+spice-devel@lfdr.de>; Tue, 23 Jul 2019 23:29:04 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E114B6E3C9;
	Tue, 23 Jul 2019 21:29:01 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail.codeweavers.com (mail.codeweavers.com [50.203.203.244])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 32A1A6E3C9
 for <spice-devel@lists.freedesktop.org>; Tue, 23 Jul 2019 21:29:01 +0000 (UTC)
Received: from jwhite.mn.codeweavers.com ([10.69.137.101])
 by mail.codeweavers.com with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_GCM_SHA256:128)
 (Exim 4.89) (envelope-from <jwhite@codeweavers.com>)
 id 1hq2La-0003tS-Au
 for spice-devel@lists.freedesktop.org; Tue, 23 Jul 2019 16:29:22 -0500
From: Jeremy White <jwhite@codeweavers.com>
To: spice-devel@lists.freedesktop.org
Date: Tue, 23 Jul 2019 16:28:57 -0500
Message-Id: <20190723212858.11137-2-jwhite@codeweavers.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190723212858.11137-1-jwhite@codeweavers.com>
References: <20190723212858.11137-1-jwhite@codeweavers.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; 
 d=codeweavers.com; s=6377696661; h=Content-Transfer-Encoding:MIME-Version:
 References:In-Reply-To:Message-Id:Date:Subject:To:From:Sender:Reply-To:Cc:
 Content-Type:Content-ID:Content-Description:Resent-Date:Resent-From:
 Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:
 List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=gtEe92kSqTfnKG+bit9+J0g4SrfaRdopvcaqgxpU9cQ=; b=sFrUPRy8bEBSmdwqjG2mMNTb1n
 KdBk7//ec7c8I6pmfEDf1hh35l+ZxHd0OVKSOhGxf0n8IOIFdooTdTJUJpl3yQE2pT73/5NOtRWr0
 vfqms9olEdkO3vYy6nflWVo0RaOV08n5HvjpPeBj6Giai5+a2ysujqTIzcVZ++fneUd4=;
Subject: [Spice-devel] [PATCH v4 x11spice 2/3] Simplify the expression of
 option handling.
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

VGhpcyBmaXhlcyBhIGJ1ZyB3aXRoIC0tY29uZmlnPTxmaWxlbmFtZT4gaGFuZGxpbmcuCgpBZGQg
ZXhwYW5kZWQgdGVzdCBjb2RlIGNvdXJ0ZXN5IG9mIEZyZWRpYW5vIFppZ2xpbyA8ZnppZ2xpb0By
ZWRoYXQuY29tPi4KClNpZ25lZC1vZmYtYnk6IEplcmVteSBXaGl0ZSA8andoaXRlQGNvZGV3ZWF2
ZXJzLmNvbT4KLS0tCiBzcmMvbWFpbi5jICAgIHwgIDggKysrLS0KIHNyYy9vcHRpb25zLmMgfCA5
MyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0KIHNy
Yy9vcHRpb25zLmggfCAgMSAtCiAzIGZpbGVzIGNoYW5nZWQsIDgzIGluc2VydGlvbnMoKyksIDE5
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3NyYy9tYWluLmMgYi9zcmMvbWFpbi5jCmluZGV4
IGYxODMxMWM5Li5kYTZkNDg4MiAxMDA2NDQKLS0tIGEvc3JjL21haW4uYworKysgYi9zcmMvbWFp
bi5jCkBAIC02Nyw5ICs2NywxMyBAQCBpbnQgbWFpbihpbnQgYXJnYywgY2hhciAqYXJndltdKQog
ICAgICoqICBQYXJzZSBhcmd1bWVudHMKICAgICAqKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwogICAgIG9wdGlv
bnNfaW5pdCgmc2Vzc2lvbi5vcHRpb25zKTsKLSAgICBvcHRpb25zX2hhbmRsZV91c2VyX2NvbmZp
ZyhhcmdjLCBhcmd2LCAmc2Vzc2lvbi5vcHRpb25zKTsKLSAgICBvcHRpb25zX2Zyb21fY29uZmln
KCZzZXNzaW9uLm9wdGlvbnMpOwogICAgIHJjID0gb3B0aW9uc19wYXJzZV9hcmd1bWVudHMoYXJn
YywgYXJndiwgJnNlc3Npb24ub3B0aW9ucyk7CisgICAgaWYgKHJjID09IDApIHsKKyAgICAgICAg
b3B0aW9uc19mcm9tX2NvbmZpZygmc2Vzc2lvbi5vcHRpb25zKTsKKyAgICAgICAgLyogV2UgcGFy
c2UgY29tbWFuZCBsaW5lIGFyZ3VtZW50cyBhIHNlY29uZCB0aW1lIHRvIGVuc3VyZQorICAgICAg
ICAqKiAgdGhhdCBjb21tYW5kIGxpbmUgb3B0aW9ucyB0YWtlIHByZWNlZGVuY2Ugb3ZlciBjb25m
aWcgZmlsZXMgKi8KKyAgICAgICAgcmMgPSBvcHRpb25zX3BhcnNlX2FyZ3VtZW50cyhhcmdjLCBh
cmd2LCAmc2Vzc2lvbi5vcHRpb25zKTsKKyAgICB9CiAgICAgaWYgKHJjKQogICAgICAgICBnb3Rv
IGV4aXQ7CiAKZGlmZiAtLWdpdCBhL3NyYy9vcHRpb25zLmMgYi9zcmMvb3B0aW9ucy5jCmluZGV4
IGJjN2NkNjMxLi42NjIwYjg1MyAxMDA2NDQKLS0tIGEvc3JjL29wdGlvbnMuYworKysgYi9zcmMv
b3B0aW9ucy5jCkBAIC0yMTQsMTYgKzIxNCw2IEBAIHZvaWQgb3B0aW9uc19oYW5kbGVfc3NsX2Zp
bGVfb3B0aW9ucyhvcHRpb25zX3QgKm9wdGlvbnMsCiAgICAgc3RyaW5nX29wdGlvbigmb3B0aW9u
cy0+c3NsLmNpcGhlcnN1aXRlLCB1c2Vya2V5LCBzeXN0ZW1rZXksICJzc2wiLCAiY2lwaGVyc3Vp
dGUiKTsKIH0KIAotdm9pZCBvcHRpb25zX2hhbmRsZV91c2VyX2NvbmZpZyhpbnQgYXJnYywgY2hh
ciAqYXJndltdLCBvcHRpb25zX3QgKm9wdGlvbnMpCi17Ci0gICAgaW50IGk7Ci0gICAgZm9yIChp
ID0gMTsgaSA8IGFyZ2MgLSAxOyBpKyspCi0gICAgICAgIGlmIChzdHJjbXAoYXJndltpXSwgIi0t
Y29uZmlnIikgPT0gMCB8fCBzdHJjbXAoYXJndltpXSwgIi1jb25maWciKSA9PSAwKSB7Ci0gICAg
ICAgICAgICBzdHJfcmVwbGFjZSgmb3B0aW9ucy0+dXNlcl9jb25maWdfZmlsZSwgYXJndltpICsg
MV0pOwotICAgICAgICAgICAgaSsrOwotICAgICAgICB9Ci19Ci0KIGludCBvcHRpb25zX3BhcnNl
X2FyZ3VtZW50cyhpbnQgYXJnYywgY2hhciAqYXJndltdLCBvcHRpb25zX3QgKm9wdGlvbnMpCiB7
CiAgICAgaW50IHJjOwpAQCAtMjU0LDYgKzI0NCw3IEBAIGludCBvcHRpb25zX3BhcnNlX2FyZ3Vt
ZW50cyhpbnQgYXJnYywgY2hhciAqYXJndltdLCBvcHRpb25zX3QgKm9wdGlvbnMpCiAgICAgICAg
IHswLCAwLCAwLCAwfQogICAgIH07CiAKKyAgICBvcHRpbmQgPSAxOyAvKiBBbGxvdyByZXVzZSBv
ZiB0aGlzIGZ1bmN0aW9uICovCiAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgcmMgPSBnZXRvcHRf
bG9uZ19vbmx5KGFyZ2MsIGFyZ3YsICIiLCBsb25nX29wdGlvbnMsICZsb25naW5kZXgpOwogICAg
ICAgICBpZiAocmMgPT0gLTEpIHsKQEAgLTI4Nyw3ICsyNzgsNyBAQCBpbnQgb3B0aW9uc19wYXJz
ZV9hcmd1bWVudHMoaW50IGFyZ2MsIGNoYXIgKmFyZ3ZbXSwgb3B0aW9uc190ICpvcHRpb25zKQog
ICAgICAgICAgICAgICAgIGJyZWFrOwogCiAgICAgICAgICAgICBjYXNlIE9QVElPTl9DT05GSUc6
Ci0gICAgICAgICAgICAgICAgLyogVGhpcyB3YXMgaGFuZGxlZCBwcmV2aW91c2x5OyB3ZSBjYW4g
aWdub3JlICovCisgICAgICAgICAgICAgICAgc3RyX3JlcGxhY2UoJm9wdGlvbnMtPnVzZXJfY29u
ZmlnX2ZpbGUsIG9wdGFyZyk7CiAgICAgICAgICAgICAgICAgYnJlYWs7CiAKICAgICAgICAgICAg
IGNhc2UgT1BUSU9OX1NTTDoKQEAgLTUwMSwxNSArNDkyLDg1IEBAIGludCBvcHRpb25zX2ltcG9z
c2libGVfY29uZmlnKG9wdGlvbnNfdCAqb3B0aW9ucykKICAgICByZXR1cm4gMTsKIH0KIAotI2lm
IGRlZmluZWQoT1BUSU9OU19NQUlOKQotaW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKmFyZ3ZbXSkK
KyNpZiBkZWZpbmVkKE1BSU5fVEVTVCkKK3N0YXRpYyBpbnQgdGVzdF9sb2FkX29wdGlvbnMob3B0
aW9uc190ICpvcHRpb25zLCBpbnQgYXJnYywgY2hhciAqKmFyZ3YpCit7CisgICAgaW50IHJjOwor
ICAgIHJjID0gb3B0aW9uc19wYXJzZV9hcmd1bWVudHMoYXJnYywgYXJndiwgb3B0aW9ucyk7Cisg
ICAgaWYgKHJjID09IDApIHsKKyAgICAgICAgb3B0aW9uc19mcm9tX2NvbmZpZyhvcHRpb25zKTsK
KyAgICAgICAgLyogV2UgcGFyc2UgY29tbWFuZCBsaW5lIGFyZ3VtZW50cyBhIHNlY29uZCB0aW1l
IHRvIGVuc3VyZQorICAgICAgICAqKiAgdGhhdCBjb21tYW5kIGxpbmUgb3B0aW9ucyB0YWtlIHBy
ZWNlZGVuY2Ugb3ZlciBjb25maWcgZmlsZXMgKi8KKyAgICAgICAgcmMgPSBvcHRpb25zX3BhcnNl
X2FyZ3VtZW50cyhhcmdjLCBhcmd2LCBvcHRpb25zKTsKKyAgICB9CisgICAgaWYgKHJjID09IDAp
IHsKKyAgICAgICAgcmMgPSBvcHRpb25zX3Byb2Nlc3NfaW8ob3B0aW9ucyk7CisgICAgfQorICAg
IHJldHVybiByYzsKK30KKworc3RhdGljIHZvaWQgdGVzdChjb25zdCBjaGFyICpleHBlY3RlZCwg
Y2hhciAqKmFyZ3YpCiB7CiAgICAgb3B0aW9uc190IG9wdGlvbnM7CisgICAgaW50IGFyZ2MgPSAw
OworICAgIGludCByYzsKKyAgICBjaGFyIGJ1ZlsxMDAwXTsKKworICAgIHdoaWxlIChhcmd2W2Fy
Z2NdKSB7CisgICAgICAgICsrYXJnYzsKKyAgICB9CiAKICAgICBvcHRpb25zX2luaXQoJm9wdGlv
bnMpOwotICAgIG9wdGlvbnNfcGFyc2VfYXJndW1lbnRzKGFyZ2MsIGFyZ3YsICZvcHRpb25zKTsK
LSAgICBvcHRpb25zX2Zyb21fY29uZmlnKCZvcHRpb25zKTsKLSAgICBnX21lc3NhZ2UoIk9wdGlv
bnMgcGFyc2VkIik7CisgICAgcmMgPSB0ZXN0X2xvYWRfb3B0aW9ucygmb3B0aW9ucywgYXJnYywg
YXJndik7CisgICAgaWYgKHJjID09IDApIHsKKyAgICAgICAgc25wcmludGYoYnVmLCBzaXplb2Yo
YnVmKSwgImRpc3BsYXkgJXMgYWxsb3dfY29udHJvbCAlZCBsaXN0ZW4gJXMgY2FfZmlsZSAlcyIs
CisgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGlzcGxheSwgb3B0aW9ucy5hbGxvd19jb250cm9s
LCBvcHRpb25zLmxpc3Rlbiwgb3B0aW9ucy5zc2wuY2FfY2VydF9maWxlKTsKKyAgICAgICAgaWYg
KHN0cmNtcChidWYsIGV4cGVjdGVkKSAhPSAwKSB7CisgICAgICAgICAgICBmcHJpbnRmKHN0ZGVy
ciwgIlVuZXhwZWN0ZWQgcmVzdWx0czpcblx0JXNcbiVzXG4iLAorICAgICAgICAgICAgICAgICAg
ICBidWYsIGV4cGVjdGVkKTsKKyAgICAgICAgfQorICAgIH0KKyAgICBlbHNlIHsKKyAgICAgICAg
ZnByaW50ZihzdGRlcnIsICJVbmFibGUgdG8gbG9hZCBvcHRpb25zLCByYyAlZFxuIiwgcmMpOwor
ICAgIH0KICAgICBvcHRpb25zX2ZyZWUoJm9wdGlvbnMpOwogfQorCisjZGVmaW5lIFRFU1QoZXhw
LCAuLi4pIGRvIHsgXAorICAgIGNoYXIgKmFyZ3ZbXSA9IHsgIlBST0dSQU0iLCBfX1ZBX0FSR1Nf
XywgTlVMTCB9OyBcCisgICAgdGVzdChleHAsIGFyZ3YpOyBcCit9IHdoaWxlKDApCisKK2ludCBt
YWluKGludCBhcmdjLCBjaGFyICoqYXJndikKK3sKKyAgICBGSUxFICpmID0gZm9wZW4oInRlc3Qu
Y29uZiIsICJ3Iik7CisKKyAgICBpZiAoYXJnYyA+IDEpIHsKKyAgICAgICAgb3B0aW9uc190IG9w
dGlvbnM7CisgICAgICAgIG9wdGlvbnNfaW5pdCgmb3B0aW9ucyk7CisgICAgICAgIHByaW50Zigi
dGVzdF9sb2FkX29wdGlvbnMgcmV0dXJucyAlZFxuIiwKKyAgICAgICAgICAgIHRlc3RfbG9hZF9v
cHRpb25zKCZvcHRpb25zLCBhcmdjLCBhcmd2KSk7CisgICAgICAgIG9wdGlvbnNfZnJlZSgmb3B0
aW9ucyk7CisgICAgfQorCisgICAgZnByaW50ZihmLCAiW3NwaWNlXVxuZGlzcGxheT1jb25maWdf
ZGlzcGxheVxubGlzdGVuPTg3NjVcbmFsbG93LWNvbnRyb2w9dHJ1ZSIpOworICAgIGZjbG9zZShm
KTsKKworICAgIFRFU1QoImRpc3BsYXkgKG51bGwpIGFsbG93X2NvbnRyb2wgMCBsaXN0ZW4gNTkw
MCBjYV9maWxlIChudWxsKSIsCisgICAgICAgICAiLS1oaWRlIik7CisgICAgVEVTVCgiZGlzcGxh
eSAobnVsbCkgYWxsb3dfY29udHJvbCAwIGxpc3RlbiAxMjM0IGNhX2ZpbGUgKG51bGwpIiwKKyAg
ICAgICAgICIxMjM0Iik7CisgICAgVEVTVCgiZGlzcGxheSBjb25maWdfZGlzcGxheSBhbGxvd19j
b250cm9sIDEgbGlzdGVuIDg3NjUgY2FfZmlsZSAobnVsbCkiLAorICAgICAgICAgIi0tY29uZmln
PXRlc3QuY29uZiIpOworICAgIFRFU1QoImRpc3BsYXkgY29uZmlnX2Rpc3BsYXkgYWxsb3dfY29u
dHJvbCAxIGxpc3RlbiAxMjMgY2FfZmlsZSAobnVsbCkiLAorICAgICAgICAgIi0tY29uZmlnPXRl
c3QuY29uZiIsICIxMjMiKTsKKyAgICBURVNUKCJkaXNwbGF5IGNvbmZpZ19kaXNwbGF5IGFsbG93
X2NvbnRyb2wgMCBsaXN0ZW4gMTIzIGNhX2ZpbGUgKG51bGwpIiwKKyAgICAgICAgICItLW5vLWFs
bG93LWNvbnRyb2wiLCAiLS1jb25maWc9dGVzdC5jb25mIiwgIjEyMyIpOworICAgIFRFU1QoImRp
c3BsYXkgRElTUExBWSBhbGxvd19jb250cm9sIDEgbGlzdGVuIDEyMyBjYV9maWxlIChudWxsKSIs
CisgICAgICAgICAiLS1kaXNwbGF5IiwgIkRJU1BMQVkiLCAiLS1jb25maWc9dGVzdC5jb25mIiwg
IjEyMyIpOworICAgIFRFU1QoImRpc3BsYXkgKG51bGwpIGFsbG93X2NvbnRyb2wgMCBsaXN0ZW4g
NTkwMCBjYV9maWxlIGZvbyIsCisgICAgICAgICAiLS1zc2w9Zm9vIik7CisgICAgdW5saW5rKCJ0
ZXN0LmNvbmYiKTsKKyAgICByZXR1cm4gMDsKK30KICNlbmRpZgpkaWZmIC0tZ2l0IGEvc3JjL29w
dGlvbnMuaCBiL3NyYy9vcHRpb25zLmgKaW5kZXggNjE1NTk4NGIuLjIzMDJjODViIDEwMDY0NAot
LS0gYS9zcmMvb3B0aW9ucy5oCisrKyBiL3NyYy9vcHRpb25zLmgKQEAgLTczLDcgKzczLDYgQEAg
dHlwZWRlZiBzdHJ1Y3QgewogKiogIFByb3RvdHlwZXMKICoqLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwog
dm9pZCBvcHRpb25zX2luaXQob3B0aW9uc190ICpvcHRpb25zKTsKLXZvaWQgb3B0aW9uc19oYW5k
bGVfdXNlcl9jb25maWcoaW50IGFyZ2MsIGNoYXIgKmFyZ3ZbXSwgb3B0aW9uc190ICpvcHRpb25z
KTsKIGludCBvcHRpb25zX3BhcnNlX2FyZ3VtZW50cyhpbnQgYXJnYywgY2hhciAqYXJndltdLCBv
cHRpb25zX3QgKm9wdGlvbnMpOwogaW50IG9wdGlvbnNfcHJvY2Vzc19pbyhvcHRpb25zX3QgKm9w
dGlvbnMpOwogdm9pZCBvcHRpb25zX2ZyZWUob3B0aW9uc190ICpvcHRpb25zKTsKLS0gCjIuMjAu
MQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KU3BpY2Ut
ZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
