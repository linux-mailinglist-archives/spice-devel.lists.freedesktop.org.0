Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 40246B7BCB
	for <lists+spice-devel@lfdr.de>; Thu, 19 Sep 2019 16:11:44 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B36FD6F89B;
	Thu, 19 Sep 2019 14:11:42 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 233216F894
 for <spice-devel@lists.freedesktop.org>; Thu, 19 Sep 2019 14:11:41 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx06.intmail.prod.int.phx2.redhat.com
 [10.5.11.16])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id C486E301E135
 for <spice-devel@lists.freedesktop.org>; Thu, 19 Sep 2019 14:11:40 +0000 (UTC)
Received: from wingsuit.mxp.redhat.com (unknown [10.32.181.155])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 2ABC55C1B5
 for <spice-devel@lists.freedesktop.org>; Thu, 19 Sep 2019 14:11:40 +0000 (UTC)
From: Victor Toso <victortoso@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Thu, 19 Sep 2019 16:11:21 +0200
Message-Id: <20190919141133.10691-9-victortoso@redhat.com>
In-Reply-To: <20190919141133.10691-1-victortoso@redhat.com>
References: <20190919141133.10691-1-victortoso@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.16
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.41]); Thu, 19 Sep 2019 14:11:40 +0000 (UTC)
Subject: [Spice-devel] [PATCH v8 08/20] usb-redir: extend USB backend to
 support emulated devices
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogWXVyaSBCZW5kaXRvdmljaCA8eXVyaS5iZW5kaXRvdmljaEBkYXluaXguY29tPgoKUmVk
aXJlY3Rpb24gb2YgZW11bGF0ZWQgZGV2aWNlcyByZXF1aXJlcyBzcGVjaWFsIGFwcHJvYWNoLCBh
cwp1c2JyZWRpcmhvc3QgY2FuJ3QgYmUgdXNlZCBmb3IgdGhhdCAoaXQgd29ya3Mgb25seSB3aXRo
IGxpYnVzYgpkZXZpY2VzKS4gRm9yIGVtdWxhdGVkIGRldmljZXMgd2UgY3JlYXRlIGluc3RhbmNl
IG9mIHVzYnJlZGlycGFyc2VyCnRoYXQgaW1wbGVtZW50cyBVU0IgcmVkaXJlY3Rpb24gcHJvdG9j
b2wuICBJbiBvcmRlciB0byB3b3JrIHdpdGggdGhlCnNhbWUgc2V0IG9mIHByb3RvY29sIGNhcGFi
aWxpdGllcyB0aGF0IHVzYnJlZGlyaG9zdCBzZXRzIHVwIHdpdGgKcmVtb3RlIHNpZGUsIHRoZSBw
YXJzZXIgc2hhbGw6IC0gbm90IHNlbmQgaXRzIG93biAnaGVsbG8nIHRvIHRoZQpzZXJ2ZXIKLSBp
bml0aWFsaXplIHRoZSBzYW1lIGNhcGFiaWxpdGllcyB0aGF0IHVzYnJlZGlyaG9zdAotIHJlY2Vp
dmUgdGhlIHNhbWUgJ2hlbGxvJyByZXNwb25zZQpGb3IgdGhhdCB3ZSBhbmFseXplICdoZWxsbycg
c2VudCBieSBVU0IgcmVkaXIgcGFyc2VyIGFuZCBleHRyYWN0IHNldApvZiBjYXBhYmlsaXRpZXMg
ZnJvbSBpdCBhbmQgdXBvbiByZWNlaXZlIG9mICdoZWxsbycgcmVzcG9uc2Ugd2UKcHJvdmlkZSBp
dCBhbHNvIHRvIHRoZSBwYXJzZXIuICBXaGVuIGxpYnVzYiBkZXZpY2UgaXMgcmVkaXJlY3RlZCB2
aWEgYQpjaGFubmVsLCBpbnN0YW5jZSBvZiB1c2JyZWRpcmhvc3Qgc2VydmVzIGl0LiAgV2hlbiBl
bXVsYXRlZCBkZXZpY2UgaXMKcmVkaXJlY3RlZCB2aWEgYSBjaGFubmVsLCBpbnN0YW5jZSBvZiB1
c2JyZWRpcnBhcnNlciBkb2VzIHRoZSBqb2IuCgpTaWduZWQtb2ZmLWJ5OiBZdXJpIEJlbmRpdG92
aWNoIDx5dXJpLmJlbmRpdG92aWNoQGRheW5peC5jb20+ClNpZ25lZC1vZmYtYnk6IEZyZWRpYW5v
IFppZ2xpbyA8ZnppZ2xpb0ByZWRoYXQuY29tPgotLS0KIHNyYy91c2ItYmFja2VuZC5jIHwgNDE3
ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0KIDEgZmlsZSBj
aGFuZ2VkLCAzNzAgaW5zZXJ0aW9ucygrKSwgNDcgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
c3JjL3VzYi1iYWNrZW5kLmMgYi9zcmMvdXNiLWJhY2tlbmQuYwppbmRleCAxNjlmMWIwLi5hNTFj
NTQ1IDEwMDY0NAotLS0gYS9zcmMvdXNiLWJhY2tlbmQuYworKysgYi9zcmMvdXNiLWJhY2tlbmQu
YwpAQCAtNTgsNiArNTgsNyBAQCBzdHJ1Y3QgX1NwaWNlVXNiRGV2aWNlCiAgICAgVXNiRGV2aWNl
SW5mb3JtYXRpb24gZGV2aWNlX2luZm87CiAgICAgYm9vbCBjYWNoZWRfaXNvY2hyb25vdXNfdmFs
aWQ7CiAgICAgYm9vbCBjYWNoZWRfaXNvY2hyb25vdXM7CisgICAgZ2Jvb2xlYW4gZWRldl9jb25m
aWd1cmVkOwogfTsKIAogc3RydWN0IF9TcGljZVVzYkJhY2tlbmQKQEAgLTgwLDE0ICs4MSwyMyBA
QCBzdHJ1Y3QgX1NwaWNlVXNiQmFja2VuZAogICAgIHVpbnQzMl90IG93bl9kZXZpY2VzX21hc2s7
CiB9OwogCit0eXBlZGVmIGVudW0geworICAgIFVTQl9DSEFOTkVMX1NUQVRFX0lOSVRJQUxJWklO
RywKKyAgICBVU0JfQ0hBTk5FTF9TVEFURV9IT1NULAorICAgIFVTQl9DSEFOTkVMX1NUQVRFX1BB
UlNFUiwKK30gU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbFN0YXRlOworCiBzdHJ1Y3QgX1NwaWNlVXNi
QmFja2VuZENoYW5uZWwKIHsKICAgICBzdHJ1Y3QgdXNicmVkaXJob3N0ICp1c2JyZWRpcmhvc3Q7
CiAgICAgc3RydWN0IHVzYnJlZGlycGFyc2VyICpwYXJzZXI7CisgICAgU3BpY2VVc2JCYWNrZW5k
Q2hhbm5lbFN0YXRlIHN0YXRlOwogICAgIHVpbnQ4X3QgKnJlYWRfYnVmOwogICAgIGludCByZWFk
X2J1Zl9zaXplOwogICAgIHN0cnVjdCB1c2JyZWRpcmZpbHRlcl9ydWxlICpydWxlczsKICAgICBp
bnQgcnVsZXNfY291bnQ7CisgICAgdWludDMyX3QgcmVqZWN0ZWQgICAgICAgICAgOiAxOworICAg
IHVpbnQzMl90IHdhaXRfZGlzY29ubmVjdF9hY2sgOiAxOwogICAgIFNwaWNlVXNiQmFja2VuZERl
dmljZSAqYXR0YWNoZWQ7CiAgICAgU3BpY2VVc2JyZWRpckNoYW5uZWwgKnVzYnJlZGlyX2NoYW5u
ZWw7CiAgICAgU3BpY2VVc2JCYWNrZW5kICpiYWNrZW5kOwpAQCAtNDA3LDEzICs0MTcsMTcgQEAg
ZnJvbSBib3RoIHRoZSBtYWluIHRocmVhZCBhcyB3ZWxsIGFzIGZyb20gdGhlIHVzYiBldmVudCBo
YW5kbGluZyB0aHJlYWQgKi8KIHN0YXRpYyB2b2lkIHVzYnJlZGlyX3dyaXRlX2ZsdXNoX2NhbGxi
YWNrKHZvaWQgKnVzZXJfZGF0YSkKIHsKICAgICBTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCA9
IHVzZXJfZGF0YTsKLSAgICBpZiAoIWNoLT51c2JyZWRpcmhvc3QpIHsKLSAgICAgICAgLyoganVz
dCB0byBiZSBvbiB0aGUgc2FmZSBzaWRlICovCisgICAgaWYgKGNoLT5wYXJzZXIgPT0gTlVMTCkg
ewogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIGlmIChpc19jaGFubmVsX3JlYWR5KGNoLT51
c2JyZWRpcl9jaGFubmVsKSkgewotICAgICAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAgLT4gdXNi
cmVkaXJob3N0IiwgX19GVU5DVElPTl9fLCBjaCk7Ci0gICAgICAgIHVzYnJlZGlyaG9zdF93cml0
ZV9ndWVzdF9kYXRhKGNoLT51c2JyZWRpcmhvc3QpOworICAgICAgICBpZiAoY2gtPnN0YXRlID09
IFVTQl9DSEFOTkVMX1NUQVRFX0hPU1QpIHsKKyAgICAgICAgICAgIFNQSUNFX0RFQlVHKCIlcyBj
aCAlcCAtPiB1c2JyZWRpcmhvc3QiLCBfX0ZVTkNUSU9OX18sIGNoKTsKKyAgICAgICAgICAgIHVz
YnJlZGlyaG9zdF93cml0ZV9ndWVzdF9kYXRhKGNoLT51c2JyZWRpcmhvc3QpOworICAgICAgICB9
IGVsc2UgeworICAgICAgICAgICAgU1BJQ0VfREVCVUcoIiVzIGNoICVwIC0+IHBhcnNlciIsIF9f
RlVOQ1RJT05fXywgY2gpOworICAgICAgICAgICAgdXNicmVkaXJwYXJzZXJfZG9fd3JpdGUoY2gt
PnBhcnNlcik7CisgICAgICAgIH0KICAgICB9IGVsc2UgewogICAgICAgICBTUElDRV9ERUJVRygi
JXMgY2ggJXAgKG5vdCByZWFkeSkiLCBfX0ZVTkNUSU9OX18sIGNoKTsKICAgICB9CkBAIC01Njgs
MTMgKzU4Miw1MyBAQCB2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV91bnJlZihTcGljZVVz
YkJhY2tlbmREZXZpY2UgKmRldikKICAgICB9CiB9CiAKLUdfR05VQ19JTlRFUk5BTAorc3RhdGlj
IGludCBjaGVja19lZGV2X2RldmljZV9maWx0ZXIoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJ1Y3QgdXNicmVk
aXJmaWx0ZXJfcnVsZSAqcnVsZXMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBpbnQgY291bnQpCit7CisgICAgU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZWRldiA9IGRldi0+
ZWRldjsKKyAgICB1aW50OF90IGNsc1szMl0sIHN1YmNsc1szMl0sIHByb3RvWzMyXSwgKmNmZywg
aWZudW0gPSAwOworICAgIHVpbnQxNl90IHNpemUsIG9mZnNldCA9IDA7CisKKyAgICBpZiAoIWRl
dmljZV9vcHMoZWRldiktPmdldF9kZXNjcmlwdG9yKGVkZXYsIExJQlVTQl9EVF9DT05GSUcsIDAs
ICh2b2lkICoqKSZjZmcsICZzaXplKSkgeworICAgICAgICByZXR1cm4gLUVJTlZBTDsKKyAgICB9
CisKKyAgICB3aGlsZSAoKG9mZnNldCArIDEpIDwgc2l6ZSkgeworICAgICAgICB1aW50OF90IGxl
biAgPSBjZmdbb2Zmc2V0XTsKKyAgICAgICAgdWludDhfdCB0eXBlID0gY2ZnW29mZnNldCArIDFd
OworICAgICAgICBpZiAoKG9mZnNldCArIGxlbikgPiBzaXplKSB7CisgICAgICAgICAgICBicmVh
azsKKyAgICAgICAgfQorICAgICAgICBpZiAodHlwZSA9PSBMSUJVU0JfRFRfSU5URVJGQUNFKSB7
CisgICAgICAgICAgICBjbHNbaWZudW1dID0gY2ZnW29mZnNldCArIDVdOworICAgICAgICAgICAg
c3ViY2xzW2lmbnVtXSA9IGNmZ1tvZmZzZXQgKyA2XTsKKyAgICAgICAgICAgIHByb3RvW2lmbnVt
XSA9IGNmZ1tvZmZzZXQgKyA3XTsKKyAgICAgICAgICAgIGlmbnVtKys7CisgICAgICAgIH0KKyAg
ICAgICAgb2Zmc2V0ICs9IGxlbjsKKyAgICB9CisKKyAgICByZXR1cm4gdXNicmVkaXJmaWx0ZXJf
Y2hlY2socnVsZXMsIGNvdW50LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXYt
PmRldmljZV9pbmZvLmNsYXNzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXYt
PmRldmljZV9pbmZvLnN1YmNsYXNzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBk
ZXYtPmRldmljZV9pbmZvLnByb3RvY29sLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBjbHMsIHN1YmNscywgcHJvdG8sIGlmbnVtLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBkZXYtPmRldmljZV9pbmZvLnZpZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgZGV2LT5kZXZpY2VfaW5mby5waWQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGRldi0+ZGV2aWNlX2luZm8uYmNkVVNCLCAwKTsKK30KKwogaW50IHNwaWNlX3VzYl9iYWNrZW5k
X2RldmljZV9jaGVja19maWx0ZXIoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYsCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJ1Y3QgdXNicmVkaXJm
aWx0ZXJfcnVsZSAqcnVsZXMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBpbnQgY291bnQpCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBjb25zdCBzdHJ1Y3QgdXNicmVkaXJmaWx0ZXJfcnVsZSAqcnVsZXMsIGludCBjb3VudCkKIHsK
LSAgICBnX3JldHVybl92YWxfaWZfZmFpbChkZXYtPmxpYnVzYl9kZXZpY2UgIT0gTlVMTCwgLUVJ
TlZBTCk7Ci0gICAgcmV0dXJuIHVzYnJlZGlyaG9zdF9jaGVja19kZXZpY2VfZmlsdGVyKHJ1bGVz
LCBjb3VudCwgZGV2LT5saWJ1c2JfZGV2aWNlLCAwKTsKKyAgICBpZiAoZGV2LT5saWJ1c2JfZGV2
aWNlICE9IE5VTEwpIHsKKyAgICAgICAgcmV0dXJuIHVzYnJlZGlyaG9zdF9jaGVja19kZXZpY2Vf
ZmlsdGVyKHJ1bGVzLCBjb3VudCwgZGV2LT5saWJ1c2JfZGV2aWNlLCAwKTsKKyAgICB9IGVsc2Ug
aWYgKGRldi0+ZWRldiAhPSBOVUxMKSB7CisgICAgICAgIHJldHVybiBjaGVja19lZGV2X2Rldmlj
ZV9maWx0ZXIoZGV2LCBydWxlcywgY291bnQpOworICAgIH0KKyAgICBnX3dhcm5faWZfcmVhY2hl
ZCgpOworICAgIHJldHVybiAtRUlOVkFMOwogfQogCiBzdGF0aWMgaW50IHVzYnJlZGlyX3JlYWRf
Y2FsbGJhY2sodm9pZCAqdXNlcl9kYXRhLCB1aW50OF90ICpkYXRhLCBpbnQgY291bnQpCkBAIC02
OTMsMTAgKzc0NywzMyBAQCBpbnQgc3BpY2VfdXNiX2JhY2tlbmRfcmVhZF9ndWVzdF9kYXRhKFNw
aWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLCB1aW50OF90ICpkYXRhLAogCiAgICAgY2gtPnJlYWRf
YnVmID0gZGF0YTsKICAgICBjaC0+cmVhZF9idWZfc2l6ZSA9IGNvdW50OwotICAgIGlmIChjaC0+
dXNicmVkaXJob3N0KSB7CisgICAgaWYgKFNQSUNFX1VOTElLRUxZKGNoLT5zdGF0ZSA9PSBVU0Jf
Q0hBTk5FTF9TVEFURV9JTklUSUFMSVpJTkcpKSB7CisgICAgICAgIGlmIChjaC0+dXNicmVkaXJo
b3N0ICE9IE5VTEwpIHsKKyAgICAgICAgICAgIHJlcyA9IHVzYnJlZGlyaG9zdF9yZWFkX2d1ZXN0
X2RhdGEoY2gtPnVzYnJlZGlyaG9zdCk7CisgICAgICAgICAgICBpZiAocmVzICE9IDApIHsKKyAg
ICAgICAgICAgICAgICByZXR1cm4gcmVzOworICAgICAgICAgICAgfQorICAgICAgICAgICAgY2gt
PnN0YXRlID0gVVNCX0NIQU5ORUxfU1RBVEVfSE9TVDsKKworICAgICAgICAgICAgLyogdXNicmVk
aXJob3N0IHNob3VsZCBjb25zdW1lIGhlbGxvIHJlc3BvbnNlICovCisgICAgICAgICAgICBnX3Jl
dHVybl92YWxfaWZfZmFpbChjaC0+cmVhZF9idWYgPT0gTlVMTCwgVVNCX1JFRElSX0VSUk9SX1JF
QURfUEFSU0UpOworICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgY2gtPnN0YXRlID0gVVNC
X0NIQU5ORUxfU1RBVEVfUEFSU0VSOworICAgICAgICB9CisKKyAgICAgICAgY2gtPnJlYWRfYnVm
ID0gZGF0YTsKKyAgICAgICAgY2gtPnJlYWRfYnVmX3NpemUgPSBjb3VudDsKKyAgICAgICAgaWYg
KGNoLT5hdHRhY2hlZCAmJiBjaC0+YXR0YWNoZWQtPmVkZXYpIHsKKyAgICAgICAgICAgIC8qIGNh
c2Ugb2YgQ0Qgc2hhcmluZyBvbiBjb25uZWN0ICovCisgICAgICAgICAgICBjaC0+c3RhdGUgPSBV
U0JfQ0hBTk5FTF9TVEFURV9QQVJTRVI7CisgICAgICAgICAgICBTUElDRV9ERUJVRygiJXM6IHN3
aXRjaCAlcCB0byBwYXJzZXIiLCBfX0ZVTkNUSU9OX18sIGNoKTsKKyAgICAgICAgfQorICAgICAg
ICByZXR1cm4gdXNicmVkaXJwYXJzZXJfZG9fcmVhZChjaC0+cGFyc2VyKTsKKyAgICB9CisgICAg
aWYgKGNoLT5zdGF0ZSA9PSBVU0JfQ0hBTk5FTF9TVEFURV9IT1NUKSB7CiAgICAgICAgIHJlcyA9
IHVzYnJlZGlyaG9zdF9yZWFkX2d1ZXN0X2RhdGEoY2gtPnVzYnJlZGlyaG9zdCk7CiAgICAgfSBl
bHNlIHsKLSAgICAgICAgcmVzID0gVVNCX1JFRElSX0VSUk9SX0lPOworICAgICAgICByZXMgPSB1
c2JyZWRpcnBhcnNlcl9kb19yZWFkKGNoLT5wYXJzZXIpOwogICAgIH0KICAgICBzd2l0Y2ggKHJl
cykKICAgICB7CkBAIC03MTUsNiArNzkyLDExIEBAIGludCBzcGljZV91c2JfYmFja2VuZF9yZWFk
X2d1ZXN0X2RhdGEoU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gsIHVpbnQ4X3QgKmRhdGEsCiAg
ICAgfQogICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCwgJWQgYnl0ZXMsIHJlcyAlZCIsIF9fRlVO
Q1RJT05fXywgY2gsIGNvdW50LCByZXMpOwogCisgICAgaWYgKGNoLT5yZWplY3RlZCkgeworICAg
ICAgICBjaC0+cmVqZWN0ZWQgPSAwOworICAgICAgICByZXMgPSBVU0JfUkVESVJfRVJST1JfREVW
X1JFSkVDVEVEOworICAgIH0KKwogICAgIHJldHVybiByZXM7CiB9CiAKQEAgLTc0MSwyMyArODIz
LDExNSBAQCBHRXJyb3IgKnNwaWNlX3VzYl9iYWNrZW5kX2dldF9lcnJvcl9kZXRhaWxzKGludCBl
cnJvcl9jb2RlLCBnY2hhciAqZGVzYykKICAgICByZXR1cm4gZXJyOwogfQogCit2b2lkIHNwaWNl
X3VzYl9iYWNrZW5kX3JldHVybl93cml0ZV9kYXRhKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNo
LCB2b2lkICpkYXRhKQoreworICAgIGlmIChjaC0+c3RhdGUgPT0gVVNCX0NIQU5ORUxfU1RBVEVf
SE9TVCkgeworICAgICAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAgLT4gdXNicmVkaXJob3N0Iiwg
X19GVU5DVElPTl9fLCBjaCk7CisgICAgICAgIHVzYnJlZGlyaG9zdF9mcmVlX3dyaXRlX2J1ZmZl
cihjaC0+dXNicmVkaXJob3N0LCBkYXRhKTsKKyAgICB9IGVsc2UgeworICAgICAgICBTUElDRV9E
RUJVRygiJXMgY2ggJXAgLT4gcGFyc2VyIiwgX19GVU5DVElPTl9fLCBjaCk7CisgICAgICAgIHVz
YnJlZGlycGFyc2VyX2ZyZWVfd3JpdGVfYnVmZmVyKGNoLT5wYXJzZXIsIGRhdGEpOworICAgIH0K
K30KKwogc3RhdGljIHZvaWQKIHVzYnJlZGlyX2NvbnRyb2xfcGFja2V0KHZvaWQgKnByaXYsIHVp
bnQ2NF90IGlkLCBzdHJ1Y3QgdXNiX3JlZGlyX2NvbnRyb2xfcGFja2V0X2hlYWRlciAqaCwKICAg
ICAgICAgICAgICAgICAgICAgICAgIHVpbnQ4X3QgKmRhdGEsIGludCBkYXRhX2xlbikKIHsKLSAg
ICBVU0JSRURJUl9DQUxMQkFDS19OT1RfSU1QTEVNRU5URUQoKTsKKyAgICBTcGljZVVzYkJhY2tl
bmRDaGFubmVsICpjaCA9IHByaXY7CisgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkID0gY2gt
PmF0dGFjaGVkOworICAgIFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmVkZXYgPSBkID8gZC0+ZWRl
diA6IE5VTEw7CisgICAgc3RydWN0IHVzYl9yZWRpcl9jb250cm9sX3BhY2tldF9oZWFkZXIgcmVz
cG9uc2UgPSAqaDsKKyAgICB1aW50OF90IHJlcXR5cGUgPSBoLT5yZXF1ZXN0dHlwZSAmIDB4N2Y7
CisgICAgZ2Jvb2xlYW4gZG9uZSA9IEZBTFNFOworICAgIHZvaWQgKm91dF9idWZmZXIgPSBOVUxM
OworCisgICAgcmVzcG9uc2Uuc3RhdHVzID0gdXNiX3JlZGlyX3N0YWxsOworICAgIFNQSUNFX0RF
QlVHKCIlcyAlcDogVFJWSUwgJTAyWCAlMDJYICUwNFggJTA0WCAlMDRYIiwKKyAgICAgICAgICAg
ICAgICBfX0ZVTkNUSU9OX18sCisgICAgICAgICAgICAgICAgY2gsIGgtPnJlcXVlc3R0eXBlLCBo
LT5yZXF1ZXN0LAorICAgICAgICAgICAgICAgIGgtPnZhbHVlLCBoLT5pbmRleCwgaC0+bGVuZ3Ro
KTsKKworICAgIGlmICghZWRldikgeworICAgICAgICBTUElDRV9ERUJVRygiJXM6IGRldmljZSBu
b3QgYXR0YWNoZWQiLCBfX0ZVTkNUSU9OX18pOworICAgICAgICByZXNwb25zZS5zdGF0dXMgPSB1
c2JfcmVkaXJfaW9lcnJvcjsKKyAgICAgICAgZG9uZSA9IFRSVUU7CisgICAgfSBlbHNlIGlmIChy
ZXF0eXBlID09IChMSUJVU0JfUkVRVUVTVF9UWVBFX1NUQU5EQVJEIHwgTElCVVNCX1JFQ0lQSUVO
VF9ERVZJQ0UpICYmCisgICAgICAgICAgICAgICBoLT5yZXF1ZXN0ID09IExJQlVTQl9SRVFVRVNU
X0dFVF9ERVNDUklQVE9SKSB7CisgICAgICAgIHVpbnQxNl90IHNpemU7CisgICAgICAgIGRvbmUg
PSBkZXZpY2Vfb3BzKGVkZXYpLT5nZXRfZGVzY3JpcHRvcihlZGV2LCBoLT52YWx1ZSA+PiA4LCBo
LT52YWx1ZSAmIDB4ZmYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAmb3V0X2J1ZmZlciwgJnNpemUpOworICAgICAgICByZXNwb25zZS5sZW5ndGggPSBz
aXplOworICAgICAgICBpZiAoZG9uZSkgeworICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzID0g
MDsKKyAgICAgICAgfQorICAgICAgICBkb25lID0gVFJVRTsKKyAgICB9CisKKyAgICBpZiAoIWRv
bmUpIHsKKyAgICAgICAgZGV2aWNlX29wcyhlZGV2KS0+Y29udHJvbF9yZXF1ZXN0KGVkZXYsIGRh
dGEsIGRhdGFfbGVuLCAmcmVzcG9uc2UsICZvdXRfYnVmZmVyKTsKKyAgICAgICAgZG9uZSA9IFRS
VUU7CisgICAgfQorCisgICAgaWYgKHJlc3BvbnNlLnN0YXR1cykgeworICAgICAgICByZXNwb25z
ZS5sZW5ndGggPSAwOworICAgIH0gZWxzZSBpZiAocmVzcG9uc2UubGVuZ3RoID4gaC0+bGVuZ3Ro
KSB7CisgICAgICAgIHJlc3BvbnNlLmxlbmd0aCA9IGgtPmxlbmd0aDsKKyAgICB9CisKKyAgICBT
UElDRV9ERUJVRygiJXMgcmVzcG9uZGluZyB3aXRoIHBheWxvYWQgb2YgJTAyWCwgc3RhdHVzICVY
IiwKKyAgICAgICAgICAgICAgICBfX0ZVTkNUSU9OX18sIHJlc3BvbnNlLmxlbmd0aCwgcmVzcG9u
c2Uuc3RhdHVzKTsKKyAgICB1c2JyZWRpcnBhcnNlcl9zZW5kX2NvbnRyb2xfcGFja2V0KGNoLT5w
YXJzZXIsIGlkLCAmcmVzcG9uc2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICByZXNwb25zZS5sZW5ndGggPyBvdXRfYnVmZmVyIDogTlVMTCwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmxlbmd0aCk7CisKKyAgICB1c2JyZWRp
cl93cml0ZV9mbHVzaF9jYWxsYmFjayhjaCk7CisgICAgdXNicmVkaXJwYXJzZXJfZnJlZV9wYWNr
ZXRfZGF0YShjaC0+cGFyc2VyLCBkYXRhKTsKIH0KIAogc3RhdGljIHZvaWQKIHVzYnJlZGlyX2J1
bGtfcGFja2V0KHZvaWQgKnByaXYsIHVpbnQ2NF90IGlkLCBzdHJ1Y3QgdXNiX3JlZGlyX2J1bGtf
cGFja2V0X2hlYWRlciAqaCwKICAgICAgICAgICAgICAgICAgICAgIHVpbnQ4X3QgKmRhdGEsIGlu
dCBkYXRhX2xlbikKIHsKLSAgICBVU0JSRURJUl9DQUxMQkFDS19OT1RfSU1QTEVNRU5URUQoKTsK
KyAgICBTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCA9IHByaXY7CisgICAgU3BpY2VVc2JCYWNr
ZW5kRGV2aWNlICpkID0gY2gtPmF0dGFjaGVkOworICAgIFNwaWNlVXNiRW11bGF0ZWREZXZpY2Ug
KmVkZXYgPSBkID8gZC0+ZWRldiA6IE5VTEw7CisgICAgc3RydWN0IHVzYl9yZWRpcl9idWxrX3Bh
Y2tldF9oZWFkZXIgaG91dCA9ICpoOworICAgIHVpbnQzMl90IGxlbiA9IChoLT5sZW5ndGhfaGln
aCA8PCAxNikgfCBoLT5sZW5ndGg7CisgICAgU1BJQ0VfREVCVUcoIiVzICVwOiBlcCAlWCwgbGVu
ICV1LCBpZCAlIiBHX0dVSU5UNjRfRk9STUFULCBfX0ZVTkNUSU9OX18sCisgICAgICAgICAgICAg
ICAgY2gsIGgtPmVuZHBvaW50LCBsZW4sIGlkKTsKKworICAgIGlmICghZWRldikgeworICAgICAg
ICBTUElDRV9ERUJVRygiJXM6IGRldmljZSBub3QgYXR0YWNoZWQiLCBfX0ZVTkNUSU9OX18pOwor
ICAgICAgICBob3V0LnN0YXR1cyA9IHVzYl9yZWRpcl9pb2Vycm9yOworICAgICAgICBob3V0Lmxl
bmd0aCA9IGhvdXQubGVuZ3RoX2hpZ2ggPSAwOworICAgICAgICBTUElDRV9ERUJVRygiJXM6IHJl
c3BvbmRpbmcgd2l0aCBaTFAgc3RhdHVzICVkIiwgX19GVU5DVElPTl9fLCBob3V0LnN0YXR1cyk7
CisgICAgfSBlbHNlIGlmIChoLT5lbmRwb2ludCAmIExJQlVTQl9FTkRQT0lOVF9JTikgeworICAg
ICAgICBpZiAoZGV2aWNlX29wcyhlZGV2KS0+YnVsa19pbl9yZXF1ZXN0KGVkZXYsIGlkLCAmaG91
dCkpIHsKKyAgICAgICAgICAgIHVzYnJlZGlycGFyc2VyX2ZyZWVfcGFja2V0X2RhdGEoY2gtPnBh
cnNlciwgZGF0YSk7CisgICAgICAgICAgICAvKiBjb21wbGV0aW9uIGlzIGFzeW5jaHJvbm91cyAq
LworICAgICAgICAgICAgcmV0dXJuOworICAgICAgICB9CisgICAgfSBlbHNlIHsKKyAgICAgICAg
aG91dC5zdGF0dXMgPSB1c2JfcmVkaXJfc3RhbGw7CisgICAgICAgIGRldmljZV9vcHMoZWRldikt
PmJ1bGtfb3V0X3JlcXVlc3QoZWRldiwgaC0+ZW5kcG9pbnQsIGRhdGEsIGRhdGFfbGVuLCAmaG91
dC5zdGF0dXMpOworICAgICAgICBTUElDRV9ERUJVRygiJXM6IHJlc3BvbmRpbmcgc3RhdHVzICVk
IiwgX19GVU5DVElPTl9fLCBob3V0LnN0YXR1cyk7CisgICAgfQorCisgICAgdXNicmVkaXJwYXJz
ZXJfc2VuZF9idWxrX3BhY2tldChjaC0+cGFyc2VyLCBpZCwgJmhvdXQsIE5VTEwsIDApOworICAg
IHVzYnJlZGlycGFyc2VyX2ZyZWVfcGFja2V0X2RhdGEoY2gtPnBhcnNlciwgZGF0YSk7CisgICAg
dXNicmVkaXJfd3JpdGVfZmx1c2hfY2FsbGJhY2soY2gpOwogfQogCiBzdGF0aWMgdm9pZCB1c2Jy
ZWRpcl9kZXZpY2VfcmVzZXQodm9pZCAqcHJpdikKIHsKLSAgICBVU0JSRURJUl9DQUxMQkFDS19O
T1RfSU1QTEVNRU5URUQoKTsKKyAgICBTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCA9IHByaXY7
CisgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkID0gY2gtPmF0dGFjaGVkOworICAgIFNwaWNl
VXNiRW11bGF0ZWREZXZpY2UgKmVkZXYgPSBkID8gZC0+ZWRldiA6IE5VTEw7CisgICAgU1BJQ0Vf
REVCVUcoIiVzIGNoICVwIiwgX19GVU5DVElPTl9fLCBjaCk7CisgICAgaWYgKGVkZXYpIHsKKyAg
ICAgICAgZGV2aWNlX29wcyhlZGV2KS0+cmVzZXQoZWRldik7CisgICAgfQogfQogCiBzdGF0aWMg
dm9pZApAQCAtNzc2LDM0ICs5NTAsNzIgQEAgc3RhdGljIHZvaWQKIHVzYnJlZGlyX3NldF9jb25m
aWd1cmF0aW9uKHZvaWQgKnByaXYsIHVpbnQ2NF90IGlkLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgc3RydWN0IHVzYl9yZWRpcl9zZXRfY29uZmlndXJhdGlvbl9oZWFkZXIgKnNldF9jb25m
aWd1cmF0aW9uKQogewotICAgIFVTQlJFRElSX0NBTExCQUNLX05PVF9JTVBMRU1FTlRFRCgpOwor
ICAgIFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoID0gcHJpdjsKKyAgICBzdHJ1Y3QgdXNiX3Jl
ZGlyX2NvbmZpZ3VyYXRpb25fc3RhdHVzX2hlYWRlciBoOworICAgIGguc3RhdHVzID0gMDsKKyAg
ICBoLmNvbmZpZ3VyYXRpb24gPSBzZXRfY29uZmlndXJhdGlvbi0+Y29uZmlndXJhdGlvbjsKKyAg
ICBTUElDRV9ERUJVRygiJXMgY2ggJXAsIGNmZyAlZCIsIF9fRlVOQ1RJT05fXywgY2gsIGguY29u
ZmlndXJhdGlvbik7CisgICAgaWYgKGNoLT5hdHRhY2hlZCkgeworICAgICAgICBjaC0+YXR0YWNo
ZWQtPmVkZXZfY29uZmlndXJlZCA9IGguY29uZmlndXJhdGlvbiAhPSAwOworICAgIH0KKyAgICB1
c2JyZWRpcnBhcnNlcl9zZW5kX2NvbmZpZ3VyYXRpb25fc3RhdHVzKGNoLT5wYXJzZXIsIGlkLCAm
aCk7CisgICAgdXNicmVkaXJfd3JpdGVfZmx1c2hfY2FsbGJhY2soY2gpOwogfQogCiBzdGF0aWMg
dm9pZCB1c2JyZWRpcl9nZXRfY29uZmlndXJhdGlvbih2b2lkICpwcml2LCB1aW50NjRfdCBpZCkK
IHsKLSAgICBVU0JSRURJUl9DQUxMQkFDS19OT1RfSU1QTEVNRU5URUQoKTsKKyAgICBTcGljZVVz
YkJhY2tlbmRDaGFubmVsICpjaCA9IHByaXY7CisgICAgc3RydWN0IHVzYl9yZWRpcl9jb25maWd1
cmF0aW9uX3N0YXR1c19oZWFkZXIgaDsKKyAgICBoLnN0YXR1cyA9IDA7CisgICAgaC5jb25maWd1
cmF0aW9uID0gY2gtPmF0dGFjaGVkICYmIGNoLT5hdHRhY2hlZC0+ZWRldl9jb25maWd1cmVkOwor
ICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCwgY2ZnICVkIiwgX19GVU5DVElPTl9fLCBjaCwgaC5j
b25maWd1cmF0aW9uKTsKKyAgICB1c2JyZWRpcnBhcnNlcl9zZW5kX2NvbmZpZ3VyYXRpb25fc3Rh
dHVzKGNoLT5wYXJzZXIsIGlkLCAmaCk7CisgICAgdXNicmVkaXJfd3JpdGVfZmx1c2hfY2FsbGJh
Y2soY2gpOwogfQogCiBzdGF0aWMgdm9pZAogdXNicmVkaXJfc2V0X2FsdF9zZXR0aW5nKHZvaWQg
KnByaXYsIHVpbnQ2NF90IGlkLCBzdHJ1Y3QgdXNiX3JlZGlyX3NldF9hbHRfc2V0dGluZ19oZWFk
ZXIgKnMpCiB7Ci0gICAgVVNCUkVESVJfQ0FMTEJBQ0tfTk9UX0lNUExFTUVOVEVEKCk7CisgICAg
U3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSBwcml2OworICAgIHN0cnVjdCB1c2JfcmVkaXJf
YWx0X3NldHRpbmdfc3RhdHVzX2hlYWRlciBzaDsKKyAgICBzaC5zdGF0dXMgPSAoIXMtPmludGVy
ZmFjZSAmJiAhcy0+YWx0KSA/IDAgOiB1c2JfcmVkaXJfc3RhbGw7CisgICAgc2guaW50ZXJmYWNl
ID0gcy0+aW50ZXJmYWNlOworICAgIHNoLmFsdCA9IHMtPmFsdDsKKyAgICBTUElDRV9ERUJVRygi
JXMgY2ggJXAsICVkOiVkIiwgX19GVU5DVElPTl9fLCBjaCwgcy0+aW50ZXJmYWNlLCBzLT5hbHQp
OworICAgIHVzYnJlZGlycGFyc2VyX3NlbmRfYWx0X3NldHRpbmdfc3RhdHVzKGNoLT5wYXJzZXIs
IGlkLCAmc2gpOworICAgIHVzYnJlZGlyX3dyaXRlX2ZsdXNoX2NhbGxiYWNrKGNoKTsKIH0KIAog
c3RhdGljIHZvaWQKIHVzYnJlZGlyX2dldF9hbHRfc2V0dGluZyh2b2lkICpwcml2LCB1aW50NjRf
dCBpZCwgc3RydWN0IHVzYl9yZWRpcl9nZXRfYWx0X3NldHRpbmdfaGVhZGVyICpzKQogewotICAg
IFVTQlJFRElSX0NBTExCQUNLX05PVF9JTVBMRU1FTlRFRCgpOworICAgIFNwaWNlVXNiQmFja2Vu
ZENoYW5uZWwgKmNoID0gcHJpdjsKKyAgICBzdHJ1Y3QgdXNiX3JlZGlyX2FsdF9zZXR0aW5nX3N0
YXR1c19oZWFkZXIgc2g7CisgICAgc2guc3RhdHVzID0gKHMtPmludGVyZmFjZSA9PSAwKSA/IDAg
OiB1c2JfcmVkaXJfc3RhbGw7CisgICAgc2guaW50ZXJmYWNlID0gcy0+aW50ZXJmYWNlOworICAg
IHNoLmFsdCA9IDA7CisgICAgU1BJQ0VfREVCVUcoIiVzIGNoICVwLCBpZiAlZCIsIF9fRlVOQ1RJ
T05fXywgY2gsIHMtPmludGVyZmFjZSk7CisgICAgdXNicmVkaXJwYXJzZXJfc2VuZF9hbHRfc2V0
dGluZ19zdGF0dXMoY2gtPnBhcnNlciwgaWQsICZzaCk7CisgICAgdXNicmVkaXJfd3JpdGVfZmx1
c2hfY2FsbGJhY2soY2gpOwogfQogCiBzdGF0aWMgdm9pZCB1c2JyZWRpcl9jYW5jZWxfZGF0YSh2
b2lkICpwcml2LCB1aW50NjRfdCBpZCkKIHsKLSAgICBVU0JSRURJUl9DQUxMQkFDS19OT1RfSU1Q
TEVNRU5URUQoKTsKKyAgICBTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCA9IHByaXY7CisgICAg
U3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkID0gY2gtPmF0dGFjaGVkOworICAgIFNwaWNlVXNiRW11
bGF0ZWREZXZpY2UgKmVkZXYgPSBkID8gZC0+ZWRldiA6IE5VTEw7CisgICAgaWYgKCFlZGV2KSB7
CisgICAgICAgIFNQSUNFX0RFQlVHKCIlczogZGV2aWNlIG5vdCBhdHRhY2hlZCIsIF9fRlVOQ1RJ
T05fXyk7CisgICAgICAgIHJldHVybjsKKyAgICB9CisgICAgZGV2aWNlX29wcyhlZGV2KS0+Y2Fu
Y2VsX3JlcXVlc3QoZWRldiwgaWQpOwogfQogCiBzdGF0aWMgdm9pZCB1c2JyZWRpcl9maWx0ZXJf
cmVqZWN0KHZvaWQgKnByaXYpCiB7Ci0gICAgVVNCUkVESVJfQ0FMTEJBQ0tfTk9UX0lNUExFTUVO
VEVEKCk7CisgICAgU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSBwcml2OworICAgIFNQSUNF
X0RFQlVHKCIlcyAlcCIsIF9fRlVOQ1RJT05fXywgY2gpOworICAgIGNoLT5yZWplY3RlZCA9IDE7
CiB9CiAKIC8qIE5vdGUgdGhhdCB0aGUgb3duZXJzaGlwIG9mIHRoZSBydWxlcyBhcnJheSBpcyBw
YXNzZWQgb24gdG8gdGhlIGNhbGxiYWNrLiAqLwpAQCAtODI4LDEzICsxMDQwLDc3IEBAIHVzYnJl
ZGlyX2ZpbHRlcl9maWx0ZXIodm9pZCAqcHJpdiwgc3RydWN0IHVzYnJlZGlyZmlsdGVyX3J1bGUg
KnIsIGludCBjb3VudCkKIAogc3RhdGljIHZvaWQgdXNicmVkaXJfZGV2aWNlX2Rpc2Nvbm5lY3Rf
YWNrKHZvaWQgKnByaXYpCiB7Ci0gICAgVVNCUkVESVJfQ0FMTEJBQ0tfTk9UX0lNUExFTUVOVEVE
KCk7CisgICAgU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSBwcml2OworICAgIFNQSUNFX0RF
QlVHKCIlcyBjaCAlcCIsIF9fRlVOQ1RJT05fXywgY2gpOworICAgIGlmIChjaC0+c3RhdGUgPT0g
VVNCX0NIQU5ORUxfU1RBVEVfUEFSU0VSICYmIGNoLT51c2JyZWRpcmhvc3QgIT0gTlVMTCAmJgor
ICAgICAgICBjaC0+d2FpdF9kaXNjb25uZWN0X2FjaykgeworICAgICAgICBjaC0+c3RhdGUgPSBV
U0JfQ0hBTk5FTF9TVEFURV9IT1NUOworICAgICAgICBTUElDRV9ERUJVRygiJXMgc3dpdGNoIHRv
IHVzYnJlZGlyaG9zdCIsIF9fRlVOQ1RJT05fXyk7CisgICAgfQorICAgIGNoLT53YWl0X2Rpc2Nv
bm5lY3RfYWNrID0gMDsKIH0KIAogc3RhdGljIHZvaWQKIHVzYnJlZGlyX2hlbGxvKHZvaWQgKnBy
aXYsIHN0cnVjdCB1c2JfcmVkaXJfaGVsbG9faGVhZGVyICpoZWxsbykKIHsKLSAgICBVU0JSRURJ
Ul9DQUxMQkFDS19OT1RfSU1QTEVNRU5URUQoKTsKKyAgICBTcGljZVVzYkJhY2tlbmRDaGFubmVs
ICpjaCA9IHByaXY7CisgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkID0gY2gtPmF0dGFjaGVk
OworICAgIFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmVkZXYgPSBkID8gZC0+ZWRldiA6IE5VTEw7
CisgICAgc3RydWN0IHVzYl9yZWRpcl9kZXZpY2VfY29ubmVjdF9oZWFkZXIgZGV2aWNlX2Nvbm5l
Y3Q7CisgICAgc3RydWN0IHVzYl9yZWRpcl9lcF9pbmZvX2hlYWRlciBlcF9pbmZvID0geyAwIH07
CisgICAgc3RydWN0IHVzYl9yZWRpcl9pbnRlcmZhY2VfaW5mb19oZWFkZXIgaW50ZXJmYWNlX2lu
Zm8gPSB7IDAgfTsKKyAgICB1aW50OF90ICpjZmc7CisgICAgdWludDE2X3Qgc2l6ZSwgb2Zmc2V0
ID0gMDsKKyAgICBTUElDRV9ERUJVRygiJXMgJXAgJXNhdHRhY2hlZCAlcyIsIF9fRlVOQ1RJT05f
XywgY2gsCisgICAgICAgIGVkZXYgPyAiIiA6ICJub3QgIiwgIGhlbGxvID8gIiIgOiAiKGludGVy
bmFsKSIpOworCisgICAgaWYgKCFlZGV2KSB7CisgICAgICAgIHJldHVybjsKKyAgICB9CisgICAg
aWYgKCFkZXZpY2Vfb3BzKGVkZXYpLT5nZXRfZGVzY3JpcHRvcihlZGV2LCBMSUJVU0JfRFRfQ09O
RklHLCAwLCAodm9pZCAqKikmY2ZnLCAmc2l6ZSkpIHsKKyAgICAgICAgcmV0dXJuOworICAgIH0K
KyAgICB3aGlsZSAoKG9mZnNldCArIDEpIDwgc2l6ZSkgeworICAgICAgICB1aW50OF90IGxlbiAg
PSBjZmdbb2Zmc2V0XTsKKyAgICAgICAgdWludDhfdCB0eXBlID0gY2ZnW29mZnNldCArIDFdOwor
ICAgICAgICBpZiAoKG9mZnNldCArIGxlbikgPiBzaXplKSB7CisgICAgICAgICAgICBicmVhazsK
KyAgICAgICAgfQorICAgICAgICBpZiAodHlwZSA9PSBMSUJVU0JfRFRfSU5URVJGQUNFKSB7Cisg
ICAgICAgICAgICB1aW50MzJfdCBpID0gaW50ZXJmYWNlX2luZm8uaW50ZXJmYWNlX2NvdW50Owor
ICAgICAgICAgICAgdWludDhfdCBjbGFzcywgc3ViY2xhc3MsIHByb3RvY29sOworICAgICAgICAg
ICAgY2xhc3MgPSBjZmdbb2Zmc2V0ICsgNV07CisgICAgICAgICAgICBzdWJjbGFzcyA9IGNmZ1tv
ZmZzZXQgKyA2XTsKKyAgICAgICAgICAgIHByb3RvY29sID0gY2ZnW29mZnNldCArIDddOworICAg
ICAgICAgICAgaW50ZXJmYWNlX2luZm8uaW50ZXJmYWNlX2NsYXNzW2ldID0gY2xhc3M7CisgICAg
ICAgICAgICBpbnRlcmZhY2VfaW5mby5pbnRlcmZhY2Vfc3ViY2xhc3NbaV0gPSBzdWJjbGFzczsK
KyAgICAgICAgICAgIGludGVyZmFjZV9pbmZvLmludGVyZmFjZV9wcm90b2NvbFtpXSA9IHByb3Rv
Y29sOworICAgICAgICAgICAgaW50ZXJmYWNlX2luZm8uaW50ZXJmYWNlX2NvdW50Kys7CisgICAg
ICAgICAgICBTUElDRV9ERUJVRygiJXMgSUYlZDogJWQvJWQvJWQiLCBfX0ZVTkNUSU9OX18sIGks
IGNsYXNzLCBzdWJjbGFzcywgcHJvdG9jb2wpOworICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0g
TElCVVNCX0RUX0VORFBPSU5UKSB7CisgICAgICAgICAgICB1aW50OF90IGFkZHJlc3MgPSBjZmdb
b2Zmc2V0ICsgMl07CisgICAgICAgICAgICB1aW50MTZfdCBtYXhfcGFja2V0X3NpemUgPSAweDEw
MCAqIGNmZ1tvZmZzZXQgKyA1XSArIGNmZ1tvZmZzZXQgKyA0XTsKKyAgICAgICAgICAgIHVpbnQ4
X3QgaW5kZXggPSBhZGRyZXNzICYgMHhmOworICAgICAgICAgICAgaWYgKGFkZHJlc3MgJiAweDgw
KSBpbmRleCArPSAweDEwOworICAgICAgICAgICAgZXBfaW5mby50eXBlW2luZGV4XSA9IGNmZ1tv
ZmZzZXQgKyAzXSAmIDB4MzsKKyAgICAgICAgICAgIGVwX2luZm8ubWF4X3BhY2tldF9zaXplW2lu
ZGV4XSA9IG1heF9wYWNrZXRfc2l6ZTsKKyAgICAgICAgICAgIFNQSUNFX0RFQlVHKCIlcyBFUFsl
MDJYXTogJWQvJWQiLCBfX0ZVTkNUSU9OX18sIGluZGV4LCBlcF9pbmZvLnR5cGVbaW5kZXhdLCBt
YXhfcGFja2V0X3NpemUpOworICAgICAgICB9CisgICAgICAgIG9mZnNldCArPSBsZW47CisgICAg
fQorCisgICAgdXNicmVkaXJwYXJzZXJfc2VuZF9pbnRlcmZhY2VfaW5mbyhjaC0+cGFyc2VyLCAm
aW50ZXJmYWNlX2luZm8pOworICAgIHVzYnJlZGlycGFyc2VyX3NlbmRfZXBfaW5mbyhjaC0+cGFy
c2VyLCAmZXBfaW5mbyk7CisKKyAgICBkZXZpY2VfY29ubmVjdC5kZXZpY2VfY2xhc3MgPSAwOyAv
L2QtPmRldmljZV9pbmZvLmNsYXNzOworICAgIGRldmljZV9jb25uZWN0LmRldmljZV9zdWJjbGFz
cyA9IDA7IC8vZC0+ZGV2aWNlX2luZm8uc3ViY2xhc3M7CisgICAgZGV2aWNlX2Nvbm5lY3QuZGV2
aWNlX3Byb3RvY29sID0gMDsgLy9kLT5kZXZpY2VfaW5mby5wcm90b2NvbDs7CisgICAgZGV2aWNl
X2Nvbm5lY3QudmVuZG9yX2lkID0gZC0+ZGV2aWNlX2luZm8udmlkOworICAgIGRldmljZV9jb25u
ZWN0LnByb2R1Y3RfaWQgPSBkLT5kZXZpY2VfaW5mby5waWQ7CisgICAgZGV2aWNlX2Nvbm5lY3Qu
ZGV2aWNlX3ZlcnNpb25fYmNkID0gZC0+ZGV2aWNlX2luZm8uYmNkVVNCOworICAgIGRldmljZV9j
b25uZWN0LnNwZWVkID0gdXNiX3JlZGlyX3NwZWVkX2hpZ2g7CisgICAgdXNicmVkaXJwYXJzZXJf
c2VuZF9kZXZpY2VfY29ubmVjdChjaC0+cGFyc2VyLCAmZGV2aWNlX2Nvbm5lY3QpOworICAgIHVz
YnJlZGlyX3dyaXRlX2ZsdXNoX2NhbGxiYWNrKGNoKTsKIH0KIAogc3RhdGljIHZvaWQgaW5pdGlh
bGl6ZV9wYXJzZXIoU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gpCkBAIC05MDAsMTQgKzExNzYs
MzYgQEAgc3RhdGljIHN0cnVjdCB1c2JyZWRpcnBhcnNlciAqY3JlYXRlX3BhcnNlcihTcGljZVVz
YkJhY2tlbmRDaGFubmVsICpjaCkKICAgICByZXR1cm4gcGFyc2VyOwogfQogCi12b2lkIHNwaWNl
X3VzYl9iYWNrZW5kX3JldHVybl93cml0ZV9kYXRhKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNo
LCB2b2lkICpkYXRhKQorc3RhdGljIGdib29sZWFuIGF0dGFjaF9lZGV2KFNwaWNlVXNiQmFja2Vu
ZENoYW5uZWwgKmNoLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNlVXNiQmFja2Vu
ZERldmljZSAqZGV2LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdFcnJvciAqKmVycm9y
KQogewotICAgIGlmIChjaC0+dXNicmVkaXJob3N0KSB7Ci0gICAgICAgIFNQSUNFX0RFQlVHKCIl
cyBjaCAlcCIsIF9fRlVOQ1RJT05fXywgY2gpOwotICAgICAgICB1c2JyZWRpcmhvc3RfZnJlZV93
cml0ZV9idWZmZXIoY2gtPnVzYnJlZGlyaG9zdCwgZGF0YSk7CisgICAgaWYgKCFkZXYtPmVkZXYp
IHsKKyAgICAgICAgZ19zZXRfZXJyb3IoZXJyb3IsIFNQSUNFX0NMSUVOVF9FUlJPUiwgU1BJQ0Vf
Q0xJRU5UX0VSUk9SX0ZBSUxFRCwKKyAgICAgICAgICAgXygiRmFpbGVkIHRvIHJlZGlyZWN0IGRl
dmljZSAlZCIpLCAxKTsKKyAgICAgICAgcmV0dXJuIEZBTFNFOworICAgIH0KKyAgICBpZiAoY2gt
PnN0YXRlID09IFVTQl9DSEFOTkVMX1NUQVRFX0lOSVRJQUxJWklORykgeworICAgICAgICAvKgor
ICAgICAgICAgICAgd2UgY2FuJ3QgaW5pdGlhbGl6ZSBwYXJzZXIgdW50aWwgd2Ugc2VlIGhlbGxv
IGZyb20gdXNicmVkaXIKKyAgICAgICAgICAgIGFuZCB0aGUgcGFyc2VyIGNhbid0IHdvcmsgdW50
aWwgaXQgc2VlcyB0aGUgaGVsbG8gcmVzcG9uc2UuCisgICAgICAgICAgICB0aGlzIGlzIGNhc2Ug
b2YgYXV0b2Nvbm5lY3Qgd2hlbiBlbXVsYXRlZCBkZXZpY2UgaXMgYXR0YWNoZWQKKyAgICAgICAg
ICAgIGJlZm9yZSB0aGUgY2hhbm5lbCBpcyB1cAorICAgICAgICAqLworICAgICAgICBTUElDRV9E
RUJVRygiJXMgd2FpdGluZyB1bnRpbCB0aGUgY2hhbm5lbCBpcyByZWFkeSIsIF9fRlVOQ1RJT05f
Xyk7CisKICAgICB9IGVsc2UgewotICAgICAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAgLSBOT0JP
RFkgVE8gQ0FMTCIsIF9fRlVOQ1RJT05fXywgY2gpOworICAgICAgICBjaC0+c3RhdGUgPSBVU0Jf
Q0hBTk5FTF9TVEFURV9QQVJTRVI7CiAgICAgfQorICAgIGNoLT53YWl0X2Rpc2Nvbm5lY3RfYWNr
ID0gMDsKKyAgICBjaC0+YXR0YWNoZWQgPSBkZXY7CisgICAgZGV2LT5hdHRhY2hlZF90byA9IGNo
OworICAgIGRldmljZV9vcHMoZGV2LT5lZGV2KS0+YXR0YWNoKGRldi0+ZWRldiwgY2gtPnBhcnNl
cik7CisgICAgaWYgKGNoLT5zdGF0ZSA9PSBVU0JfQ0hBTk5FTF9TVEFURV9QQVJTRVIpIHsKKyAg
ICAgICAgLyogc2VuZCBkZXZpY2UgaW5mbyAqLworICAgICAgICB1c2JyZWRpcl9oZWxsbyhjaCwg
TlVMTCk7CisgICAgfQorICAgIHJldHVybiBUUlVFOwogfQogCiBnYm9vbGVhbiBzcGljZV91c2Jf
YmFja2VuZF9jaGFubmVsX2F0dGFjaChTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCwKQEAgLTkx
OSwxMiArMTIxNywxOSBAQCBnYm9vbGVhbiBzcGljZV91c2JfYmFja2VuZF9jaGFubmVsX2F0dGFj
aChTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCwKIAogICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWls
KGRldiAhPSBOVUxMLCBGQUxTRSk7CiAKKyAgICBpZiAoIWRldi0+bGlidXNiX2RldmljZSkgewor
ICAgICAgICByZXR1cm4gYXR0YWNoX2VkZXYoY2gsIGRldiwgZXJyb3IpOworICAgIH0KKwogICAg
IC8vIG5vIHBoeXNpY2FsIGRldmljZSBlbmFibGVkCiAgICAgaWYgKGNoLT51c2JyZWRpcmhvc3Qg
PT0gTlVMTCkgewogICAgICAgICByZXR1cm4gRkFMU0U7CiAgICAgfQogCiAgICAgbGlidXNiX2Rl
dmljZV9oYW5kbGUgKmhhbmRsZSA9IE5VTEw7CisgICAgaWYgKGNoLT5zdGF0ZSAhPSBVU0JfQ0hB
Tk5FTF9TVEFURV9JTklUSUFMSVpJTkcpIHsKKyAgICAgICAgY2gtPnN0YXRlID0gVVNCX0NIQU5O
RUxfU1RBVEVfSE9TVDsKKyAgICB9CiAKICAgICAvKgogICAgICAgIFVuZGVyIFdpbmRvd3Mgd2Ug
bmVlZCB0byBhdm9pZCB1cGRhdGluZwpAQCAtOTU4LDE4ICsxMjYzLDMyIEBAIGdib29sZWFuIHNw
aWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfYXR0YWNoKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNo
LAogCiB2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfZGV0YWNoKFNwaWNlVXNiQmFja2Vu
ZENoYW5uZWwgKmNoKQogeworICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqZCA9IGNoLT5hdHRh
Y2hlZDsKKyAgICBTcGljZVVzYkVtdWxhdGVkRGV2aWNlICplZGV2ID0gZCA/IGQtPmVkZXYgOiBO
VUxMOwogICAgIFNQSUNFX0RFQlVHKCIlcyA+PiBjaCAlcCwgd2FzIGF0dGFjaGVkICVwIiwgX19G
VU5DVElPTl9fLCBjaCwgY2gtPmF0dGFjaGVkKTsKLSAgICBpZiAoIWNoLT5hdHRhY2hlZCkgewor
ICAgIGlmICghZCkgewogICAgICAgICBTUElDRV9ERUJVRygiJXM6IG5vdGhpbmcgdG8gZGV0YWNo
IiwgX19GVU5DVElPTl9fKTsKICAgICAgICAgcmV0dXJuOwogICAgIH0KLSAgICBpZiAoY2gtPnVz
YnJlZGlyaG9zdCkgeworICAgIGlmIChjaC0+c3RhdGUgPT0gVVNCX0NIQU5ORUxfU1RBVEVfSE9T
VCkgewogICAgICAgICAvKiBpdCB3aWxsIGNhbGwgbGlidXNiX2Nsb3NlIGludGVybmFsbHkgKi8K
ICAgICAgICAgdXNicmVkaXJob3N0X3NldF9kZXZpY2UoY2gtPnVzYnJlZGlyaG9zdCwgTlVMTCk7
CisgICAgfSBlbHNlIHsKKyAgICAgICAgaWYgKGVkZXYpIHsKKyAgICAgICAgICAgIGRldmljZV9v
cHMoZWRldiktPmRldGFjaChlZGV2KTsKKyAgICAgICAgfQorICAgICAgICB1c2JyZWRpcnBhcnNl
cl9zZW5kX2RldmljZV9kaXNjb25uZWN0KGNoLT5wYXJzZXIpOworICAgICAgICB1c2JyZWRpcl93
cml0ZV9mbHVzaF9jYWxsYmFjayhjaCk7CisgICAgICAgIGNoLT53YWl0X2Rpc2Nvbm5lY3RfYWNr
ID0KKyAgICAgICAgICAgIHVzYnJlZGlycGFyc2VyX3BlZXJfaGFzX2NhcChjaC0+cGFyc2VyLCB1
c2JfcmVkaXJfY2FwX2RldmljZV9kaXNjb25uZWN0X2Fjayk7CisgICAgICAgIGlmICghY2gtPndh
aXRfZGlzY29ubmVjdF9hY2sgJiYgY2gtPnVzYnJlZGlyaG9zdCAhPSBOVUxMKSB7CisgICAgICAg
ICAgICBjaC0+c3RhdGUgPSBVU0JfQ0hBTk5FTF9TVEFURV9IT1NUOworICAgICAgICB9CiAgICAg
fQogICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCwgZGV0YWNoIGRvbmUiLCBfX0ZVTkNUSU9OX18s
IGNoKTsKICAgICBjaC0+YXR0YWNoZWQtPmF0dGFjaGVkX3RvID0gTlVMTDsKICAgICBjaC0+YXR0
YWNoZWQgPSBOVUxMOworICAgIGNoLT5yZWplY3RlZCA9IDA7CiB9CiAKIFNwaWNlVXNiQmFja2Vu
ZENoYW5uZWwgKgpAQCAtOTgzLDIzICsxMzAyLDI1IEBAIHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5u
ZWxfbmV3KFNwaWNlVXNiQmFja2VuZCAqYmUsCiAgICAgY2gtPnVzYnJlZGlyX2NoYW5uZWwgPSB1
c2JyZWRpcl9jaGFubmVsOwogICAgIGlmIChiZS0+bGlidXNiX2NvbnRleHQpIHsKICAgICAgICAg
Y2gtPmJhY2tlbmQgPSBiZTsKLSAgICAgICAgY2gtPnVzYnJlZGlyaG9zdCA9IHVzYnJlZGlyaG9z
dF9vcGVuX2Z1bGwoCi0gICAgICAgICAgICBiZS0+bGlidXNiX2NvbnRleHQsCi0gICAgICAgICAg
ICBOVUxMLAotICAgICAgICAgICAgdXNicmVkaXJfbG9nLAotICAgICAgICAgICAgdXNicmVkaXJf
cmVhZF9jYWxsYmFjaywKLSAgICAgICAgICAgIHVzYnJlZGlyX3dyaXRlX2NhbGxiYWNrLAotICAg
ICAgICAgICAgdXNicmVkaXJfd3JpdGVfZmx1c2hfY2FsbGJhY2ssCi0gICAgICAgICAgICB1c2Jy
ZWRpcl9hbGxvY19sb2NrLAotICAgICAgICAgICAgdXNicmVkaXJfbG9ja19sb2NrLAotICAgICAg
ICAgICAgdXNicmVkaXJfdW5sb2NrX2xvY2ssCi0gICAgICAgICAgICB1c2JyZWRpcl9mcmVlX2xv
Y2ssCi0gICAgICAgICAgICBjaCwgUEFDS0FHRV9TVFJJTkcsCi0gICAgICAgICAgICBzcGljZV91
dGlsX2dldF9kZWJ1ZygpID8gdXNicmVkaXJwYXJzZXJfZGVidWcgOiB1c2JyZWRpcnBhcnNlcl93
YXJuaW5nLAotICAgICAgICAgICAgdXNicmVkaXJob3N0X2ZsX3dyaXRlX2NiX293bnNfYnVmZmVy
KTsKKyAgICAgICAgY2gtPnVzYnJlZGlyaG9zdCA9CisgICAgICAgICAgICB1c2JyZWRpcmhvc3Rf
b3Blbl9mdWxsKGJlLT5saWJ1c2JfY29udGV4dCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgTlVMTCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNicmVk
aXJfbG9nLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2JyZWRpcl9yZWFk
X2NhbGxiYWNrLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2JyZWRpcl93
cml0ZV9jYWxsYmFjaywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNicmVk
aXJfd3JpdGVfZmx1c2hfY2FsbGJhY2ssCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHVzYnJlZGlyX2FsbG9jX2xvY2ssCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHVzYnJlZGlyX2xvY2tfbG9jaywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgdXNicmVkaXJfdW5sb2NrX2xvY2ssCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHVzYnJlZGlyX2ZyZWVfbG9jaywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgY2gsIFBBQ0tBR0VfU1RSSU5HLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBzcGljZV91dGlsX2dldF9kZWJ1ZygpID8gdXNicmVkaXJwYXJzZXJfZGVidWcgOgorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzYnJlZGlycGFyc2VyX3dhcm5pbmcs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzYnJlZGlyaG9zdF9mbF93cml0
ZV9jYl9vd25zX2J1ZmZlcik7CiAgICAgICAgIGdfd2Fybl9pZl9mYWlsKGNoLT51c2JyZWRpcmhv
c3QgIT0gTlVMTCk7Ci0gICAgICAgIGlmIChjaC0+dXNicmVkaXJob3N0KSB7Ci0gICAgICAgICAg
ICB1c2JyZWRpcmhvc3Rfc2V0X2J1ZmZlcmVkX291dHB1dF9zaXplX2NiKGNoLT51c2JyZWRpcmhv
c3QsIHVzYnJlZGlyX2J1ZmZlcmVkX291dHB1dF9zaXplX2NhbGxiYWNrKTsKKyAgICAgICAgaWYg
KGNoLT51c2JyZWRpcmhvc3QgIT0gTlVMTCkgeworICAgICAgICAgICAgdXNicmVkaXJob3N0X3Nl
dF9idWZmZXJlZF9vdXRwdXRfc2l6ZV9jYihjaC0+dXNicmVkaXJob3N0LAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2JyZWRpcl9idWZmZXJl
ZF9vdXRwdXRfc2l6ZV9jYWxsYmFjayk7CiAgICAgICAgICAgICAvLyBmb3JjZSBmbHVzaCBvZiBI
RUxMTyBwYWNrZXQgYW5kIGNyZWF0aW9uIG9mIHBhcnNlcgogICAgICAgICAgICAgdXNicmVkaXJo
b3N0X3dyaXRlX2d1ZXN0X2RhdGEoY2gtPnVzYnJlZGlyaG9zdCk7CiAgICAgICAgIH0KQEAgLTEw
MjMsOSArMTM0NCwxMSBAQCBzcGljZV91c2JfYmFja2VuZF9jaGFubmVsX25ldyhTcGljZVVzYkJh
Y2tlbmQgKmJlLAogCiB2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfZmx1c2hfd3JpdGVz
KFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoKQogewotICAgIFNQSUNFX0RFQlVHKCIlcyAlcCwg
aG9zdCAlcCIsIF9fRlVOQ1RJT05fXywgY2gsIGNoLT51c2JyZWRpcmhvc3QpOwotICAgIGlmIChj
aC0+dXNicmVkaXJob3N0KSB7CisgICAgU1BJQ0VfREVCVUcoIiVzICVwIGlzIHVwIiwgX19GVU5D
VElPTl9fLCBjaCk7CisgICAgaWYgKGNoLT5zdGF0ZSAhPSBVU0JfQ0hBTk5FTF9TVEFURV9QQVJT
RVIgJiYgY2gtPnVzYnJlZGlyaG9zdCAhPSBOVUxMKSB7CiAgICAgICAgIHVzYnJlZGlyaG9zdF93
cml0ZV9ndWVzdF9kYXRhKGNoLT51c2JyZWRpcmhvc3QpOworICAgIH0gZWxzZSB7CisgICAgICAg
IHVzYnJlZGlycGFyc2VyX2RvX3dyaXRlKGNoLT5wYXJzZXIpOwogICAgIH0KIH0KIAotLSAKMi4y
MS4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpTcGlj
ZS1kZXZlbCBtYWlsaW5nIGxpc3QKU3BpY2UtZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vc3BpY2UtZGV2ZWw=
