Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C7E2880C1B
	for <lists+spice-devel@lfdr.de>; Sun,  4 Aug 2019 21:16:39 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DA7BB89D9B;
	Sun,  4 Aug 2019 19:16:37 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail-wr1-x443.google.com (mail-wr1-x443.google.com
 [IPv6:2a00:1450:4864:20::443])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BA1A889D9B
 for <spice-devel@lists.freedesktop.org>; Sun,  4 Aug 2019 19:16:35 +0000 (UTC)
Received: by mail-wr1-x443.google.com with SMTP id z1so82222876wru.13
 for <spice-devel@lists.freedesktop.org>; Sun, 04 Aug 2019 12:16:35 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=t15gzA17eOhD1D+BGxTdGzK1p+1rR9e1PIsMC+5cdD4=;
 b=tyWD5/aFVRtrpidUUgNwJb7loQ+ZUb5wDt5SkYf9z4A/ffMguU+SUBuXapnRbJZRm3
 ybPzgDg4uOBBg8oZYzjrIfNh6uAkLwFnXOUInafNi5TYNCl9ePPtfGxA2HVuEWmfJmeY
 mUCVqjsU3CTCr1wrnkNgGgnKRfoQMqbZ4fDpIwiERarP4m3lCfM1Pvbhjrv2lsScmjC6
 zrvtX9v67fr0mntiB8fIdTZY09nEieDyU0H1k7rLLG00vcgk09/g1zZKLvrIp8WiGHgB
 Ucs+6A9hDPaDs0xiHAuWSAYfVNG/5y6bm55o9EwBjqFO6zawcE8XgWyKjDzIHm/IJDB2
 6fVQ==
X-Gm-Message-State: APjAAAWu7Tisa+Ob38VnbbE43U2Lr78m8eexcTmzZplLdOeh9ExYf/PG
 srT+zocoTOeI0DEJnXZHlgFkrDBM
X-Google-Smtp-Source: APXvYqyKHo2llUWAtQYe+6Icfy0sEeFXHk7rnPckgDOI/CMtl4LdvDDdtRlZsHp49MuZzZYCNPifNw==
X-Received: by 2002:a5d:4b11:: with SMTP id
 v17mr113707397wrq.173.1564946194105; 
 Sun, 04 Aug 2019 12:16:34 -0700 (PDT)
Received: from f2.redhat.com (bzq-79-182-115-245.red.bezeqint.net.
 [79.182.115.245])
 by smtp.gmail.com with ESMTPSA id f204sm136527687wme.18.2019.08.04.12.16.33
 (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
 Sun, 04 Aug 2019 12:16:33 -0700 (PDT)
From: Yuri Benditovich <yuri.benditovich@daynix.com>
To: spice-devel@lists.freedesktop.org
Date: Sun,  4 Aug 2019 22:16:18 +0300
Message-Id: <20190804191624.29235-3-yuri.benditovich@daynix.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190804191624.29235-1-yuri.benditovich@daynix.com>
References: <20190804191624.29235-1-yuri.benditovich@daynix.com>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=daynix-com.20150623.gappssmtp.com; s=20150623;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=t15gzA17eOhD1D+BGxTdGzK1p+1rR9e1PIsMC+5cdD4=;
 b=QeKCdp+HPhUjpcJdlDb08uNcCeNcFkW1Kmzvldmj5nczHmmDnjn1ct9P1gMNiR+yRO
 zpMMVAFb0Vhw6cj0z020M6mWOrfmRCvb9LfaYAO+CuUD4qgA2U6QTsAu7lH2380AzYMY
 EAONEMbGB7PBJfh9vPnrulV3BHvr+C4uQ0CspzlDtacTwQOHsYW/OLq9q1mASHpBqNr+
 Vs3wLo2GnPPBQoUeXhHA8l5zv+hL7LAPDF6uiChnHyXDQmZZmkAIGrtjDC2tqbXxC5AX
 xNxhPWQpAOpV+Q5xnnZJt+WE96JhWRHQPqNmv408XrLqwsOQAfGp+f3UFiGLkwIQH97S
 IrWA==
Subject: [Spice-devel] [spice-gtk v2 2/8] usb-redir: move implementation of
 device description to USB backend
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: yan@daynix.com
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

Rm9yIGxvY2FsIFVTQiBkZXZpY2UgdGhlIFVTQiBiYWNrZW5kIHJldHVybnMgdGhlIHNhbWUgZGV2
aWNlCmRlc2NyaXB0aW9uIGFzIHNwaWNlLXVzYi1tYW5hZ2VyIGRpZCwgZm9yIGVtdWxhdGVkIGRl
dmljZXMgaXQKdXNlcyB0aGUgZGVzY3JpcHRpb24gcHJvdmlkZWQgYnkgZGV2aWNlJ3MgaW1wbGVt
ZW50YXRpb24uCgpTaWduZWQtb2ZmLWJ5OiBZdXJpIEJlbmRpdG92aWNoIDx5dXJpLmJlbmRpdG92
aWNoQGRheW5peC5jb20+Ci0tLQogc3JjL3VzYi1iYWNrZW5kLmMgICAgICAgIHwgNDEgKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogc3JjL3VzYi1iYWNrZW5kLmggICAg
ICAgIHwgIDEgKwogc3JjL3VzYi1kZXZpY2UtbWFuYWdlci5jIHwgMjkgKy0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLQogMyBmaWxlcyBjaGFuZ2VkLCA0MyBpbnNlcnRpb25zKCspLCAyOCBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS9zcmMvdXNiLWJhY2tlbmQuYyBiL3NyYy91c2ItYmFja2Vu
ZC5jCmluZGV4IGJlNjBjZjMuLjNhOGEyOGUgMTAwNjQ0Ci0tLSBhL3NyYy91c2ItYmFja2VuZC5j
CisrKyBiL3NyYy91c2ItYmFja2VuZC5jCkBAIC00Miw2ICs0Miw3IEBACiAjaW5jbHVkZSAidXNi
LWVtdWxhdGlvbi5oIgogI2luY2x1ZGUgImNoYW5uZWwtdXNicmVkaXItcHJpdi5oIgogI2luY2x1
ZGUgInNwaWNlLWNoYW5uZWwtcHJpdi5oIgorI2luY2x1ZGUgInVzYnV0aWwuaCIKIAogI2RlZmlu
ZSBMT1VEX0RFQlVHKHgsIC4uLikKIApAQCAtODQ0LDYgKzg0NSw0NiBAQCBzcGljZV91c2JfYmFj
a2VuZF9jaGFubmVsX2dldF9ndWVzdF9maWx0ZXIoU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gs
CiAgICAgfQogfQogCitnY2hhciAqIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9nZXRfZGVzY3Jp
cHRpb24oU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZ2NoYXIgKmZvcm1hdCkKK3sKKyAgICBn
dWludDE2IGJ1cywgYWRkcmVzcywgdmlkLCBwaWQ7CisgICAgZ2NoYXIgKmRlc2NyaXB0aW9uLCAq
ZGVzY3JpcHRvciwgKm1hbnVmYWN0dXJlciA9IE5VTEwsICpwcm9kdWN0ID0gTlVMTDsKKworICAg
IGdfcmV0dXJuX3ZhbF9pZl9mYWlsKGRldiAhPSBOVUxMLCBOVUxMKTsKKworICAgIGJ1cyAgICAg
PSBkZXYtPmRldmljZV9pbmZvLmJ1czsKKyAgICBhZGRyZXNzID0gZGV2LT5kZXZpY2VfaW5mby5h
ZGRyZXNzOworICAgIHZpZCAgICAgPSBkZXYtPmRldmljZV9pbmZvLnZpZDsKKyAgICBwaWQgICAg
ID0gZGV2LT5kZXZpY2VfaW5mby5waWQ7CisKKyAgICBpZiAoKHZpZCA+IDApICYmIChwaWQgPiAw
KSkgeworICAgICAgICBkZXNjcmlwdG9yID0gZ19zdHJkdXBfcHJpbnRmKCJbJTA0eDolMDR4XSIs
IHZpZCwgcGlkKTsKKyAgICB9IGVsc2UgeworICAgICAgICBkZXNjcmlwdG9yID0gZ19zdHJkdXAo
IiIpOworICAgIH0KKworICAgIGlmIChkZXYtPmxpYnVzYl9kZXZpY2UpIHsKKyAgICAgICAgc3Bp
Y2VfdXNiX3V0aWxfZ2V0X2RldmljZV9zdHJpbmdzKGJ1cywgYWRkcmVzcywgdmlkLCBwaWQsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmbWFudWZhY3R1cmVyLCAm
cHJvZHVjdCk7CisgICAgfSBlbHNlIHsKKyAgICAgICAgcHJvZHVjdCA9IGRldmljZV9vcHMoZGV2
LT5lZGV2KS0+Z2V0X3Byb2R1Y3RfZGVzY3JpcHRpb24oZGV2LT5lZGV2KTsKKyAgICB9CisKKyAg
ICBpZiAoIWZvcm1hdCkgeworICAgICAgICBmb3JtYXQgPSBfKCIlcyAlcyAlcyBhdCAlZC0lZCIp
OworICAgIH0KKworICAgIGRlc2NyaXB0aW9uID0gZ19zdHJkdXBfcHJpbnRmKGZvcm1hdCwgbWFu
dWZhY3R1cmVyID8gbWFudWZhY3R1cmVyIDogIiIsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgcHJvZHVjdCwgZGVzY3JpcHRvciwgYnVzLCBhZGRyZXNzKTsKKworICAgIGdfZnJl
ZShtYW51ZmFjdHVyZXIpOworICAgIGdfZnJlZShkZXNjcmlwdG9yKTsKKyAgICBnX2ZyZWUocHJv
ZHVjdCk7CisKKyAgICByZXR1cm4gZGVzY3JpcHRpb247Cit9CisKIHZvaWQgc3BpY2VfdXNiX2Jh
Y2tlbmRfZGV2aWNlX3JlcG9ydF9jaGFuZ2UoU3BpY2VVc2JCYWNrZW5kICpiZSwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNl
ICpkZXYpCiB7CmRpZmYgLS1naXQgYS9zcmMvdXNiLWJhY2tlbmQuaCBiL3NyYy91c2ItYmFja2Vu
ZC5oCmluZGV4IDYzYjkyMDIuLjg3ZWZkNTEgMTAwNjQ0Ci0tLSBhL3NyYy91c2ItYmFja2VuZC5o
CisrKyBiL3NyYy91c2ItYmFja2VuZC5oCkBAIC05MSw2ICs5MSw3IEBAIHZvaWQgc3BpY2VfdXNi
X2JhY2tlbmRfY2hhbm5lbF9nZXRfZ3Vlc3RfZmlsdGVyKFNwaWNlVXNiQmFja2VuZENoYW5uZWwg
KmNoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29u
c3Qgc3RydWN0IHVzYnJlZGlyZmlsdGVyX3J1bGUgICoqcnVsZXMsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgKmNvdW50KTsKIHZvaWQgc3BpY2Vf
dXNiX2JhY2tlbmRfcmV0dXJuX3dyaXRlX2RhdGEoU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gs
IHZvaWQgKmRhdGEpOworZ2NoYXIgKnNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9nZXRfZGVzY3Jp
cHRpb24oU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYsIGNvbnN0IGdjaGFyICpmb3JtYXQpOwog
CiBHX0VORF9ERUNMUwogCmRpZmYgLS1naXQgYS9zcmMvdXNiLWRldmljZS1tYW5hZ2VyLmMgYi9z
cmMvdXNiLWRldmljZS1tYW5hZ2VyLmMKaW5kZXggNDI2YTBjZC4uNDU2YjUxMSAxMDA2NDQKLS0t
IGEvc3JjL3VzYi1kZXZpY2UtbWFuYWdlci5jCisrKyBiL3NyYy91c2ItZGV2aWNlLW1hbmFnZXIu
YwpAQCAtMzIsNyArMzIsNiBAQAogI2VuZGlmCiAKICNpbmNsdWRlICJjaGFubmVsLXVzYnJlZGly
LXByaXYuaCIKLSNpbmNsdWRlICJ1c2J1dGlsLmgiCiAjZW5kaWYKIAogI2luY2x1ZGUgInNwaWNl
LXNlc3Npb24tcHJpdi5oIgpAQCAtMTQzOSwzNSArMTQzOCw5IEBAIHNwaWNlX3VzYl9kZXZpY2Vf
bWFuYWdlcl9jYW5fcmVkaXJlY3RfZGV2aWNlKFNwaWNlVXNiRGV2aWNlTWFuYWdlciAgKnNlbGYs
CiBnY2hhciAqc3BpY2VfdXNiX2RldmljZV9nZXRfZGVzY3JpcHRpb24oU3BpY2VVc2JEZXZpY2Ug
KmRldmljZSwgY29uc3QgZ2NoYXIgKmZvcm1hdCkKIHsKICNpZmRlZiBVU0VfVVNCUkVESVIKLSAg
ICBndWludDE2IGJ1cywgYWRkcmVzcywgdmlkLCBwaWQ7Ci0gICAgZ2NoYXIgKmRlc2NyaXB0aW9u
LCAqZGVzY3JpcHRvciwgKm1hbnVmYWN0dXJlciA9IE5VTEwsICpwcm9kdWN0ID0gTlVMTDsKLQog
ICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKGRldmljZSAhPSBOVUxMLCBOVUxMKTsKIAotICAgIGJ1
cyAgICAgPSBzcGljZV91c2JfZGV2aWNlX2dldF9idXNudW0oZGV2aWNlKTsKLSAgICBhZGRyZXNz
ID0gc3BpY2VfdXNiX2RldmljZV9nZXRfZGV2YWRkcihkZXZpY2UpOwotICAgIHZpZCAgICAgPSBz
cGljZV91c2JfZGV2aWNlX2dldF92aWQoZGV2aWNlKTsKLSAgICBwaWQgICAgID0gc3BpY2VfdXNi
X2RldmljZV9nZXRfcGlkKGRldmljZSk7Ci0KLSAgICBpZiAoKHZpZCA+IDApICYmIChwaWQgPiAw
KSkgewotICAgICAgICBkZXNjcmlwdG9yID0gZ19zdHJkdXBfcHJpbnRmKCJbJTA0eDolMDR4XSIs
IHZpZCwgcGlkKTsKLSAgICB9IGVsc2UgewotICAgICAgICBkZXNjcmlwdG9yID0gZ19zdHJkdXAo
IiIpOwotICAgIH0KLQotICAgIHNwaWNlX3VzYl91dGlsX2dldF9kZXZpY2Vfc3RyaW5ncyhidXMs
IGFkZHJlc3MsIHZpZCwgcGlkLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAmbWFudWZhY3R1cmVyLCAmcHJvZHVjdCk7Ci0KLSAgICBpZiAoIWZvcm1hdCkKLSAgICAgICAg
Zm9ybWF0ID0gXygiJXMgJXMgJXMgYXQgJWQtJWQiKTsKLQotICAgIGRlc2NyaXB0aW9uID0gZ19z
dHJkdXBfcHJpbnRmKGZvcm1hdCwgbWFudWZhY3R1cmVyLCBwcm9kdWN0LCBkZXNjcmlwdG9yLCBi
dXMsIGFkZHJlc3MpOwotCi0gICAgZ19mcmVlKG1hbnVmYWN0dXJlcik7Ci0gICAgZ19mcmVlKGRl
c2NyaXB0b3IpOwotICAgIGdfZnJlZShwcm9kdWN0KTsKLQotICAgIHJldHVybiBkZXNjcmlwdGlv
bjsKKyAgICByZXR1cm4gc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX2dldF9kZXNjcmlwdGlvbihk
ZXZpY2UtPmJkZXYsIGZvcm1hdCk7CiAjZWxzZQogICAgIHJldHVybiBOVUxMOwogI2VuZGlmCi0t
IAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
ClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9zcGljZS1k
ZXZlbA==
