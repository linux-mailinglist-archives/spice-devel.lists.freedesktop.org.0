Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id DAC694C8A9
	for <lists+spice-devel@lfdr.de>; Thu, 20 Jun 2019 09:51:47 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 65BD56E513;
	Thu, 20 Jun 2019 07:51:46 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail-wm1-f54.google.com (mail-wm1-f54.google.com
 [209.85.128.54])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7E1B76E513
 for <spice-devel@lists.freedesktop.org>; Thu, 20 Jun 2019 07:51:44 +0000 (UTC)
Received: by mail-wm1-f54.google.com with SMTP id v19so2058651wmj.5
 for <spice-devel@lists.freedesktop.org>; Thu, 20 Jun 2019 00:51:44 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:subject:to:references:from:message-id:date
 :user-agent:mime-version:in-reply-to:content-transfer-encoding
 :content-language;
 bh=499ons5h7DC1Q9FgwRnId/p8oaQQVwmPyjKH3wPdkew=;
 b=WqFFzs4JO7+4iIGzIYa1wScJmccecMvzTERg0Ixj6RofAenY+cAyyHmnRgng3Cx7IJ
 F8McXe5+3e+oklTKjrgpwvM0jD7gUUzxpJQ1CJQKqo6khJUSl7gtZSRRAqpcnqgFCyiu
 6NVZw1jT7r3w1GukwwE9Oiovsrm5RnaKAkk25sE8WcWvsNig+sS5K4/5aEftUiib0sm5
 j90Bt0XGCmOaw3+31G60yy+MKb4zjz+6XyX2ktSLFd2O0M/AVaHVPxI90mTEU1VfiryX
 nzdmKRLx9AejBTFuXjmTBTetCX/pRzycR7rxl+PVG2YtEKoKQICS0p20qh1HimzF8X0M
 NENQ==
X-Gm-Message-State: APjAAAVozSmS5PyzfaKgFBWmBOsGi5Gx+xUVw924W3hvDfR6PakzXKOi
 766Y3G818RT48ZW/kFoPmcP96gzzL2bEpA==
X-Google-Smtp-Source: APXvYqw0y6GX1SM3gFECt4sf8Tvkt09r24xlUUEUG/zqfE6cVA3pvhKlmQKsMVE8CBlXwR7zOLr2FA==
X-Received: by 2002:a1c:65c3:: with SMTP id z186mr1655476wmb.116.1561017102588; 
 Thu, 20 Jun 2019 00:51:42 -0700 (PDT)
Received: from dhcp-4-69.tlv.redhat.com (bzq-82-81-161-50.red.bezeqint.net.
 [82.81.161.50])
 by smtp.gmail.com with ESMTPSA id j18sm24984063wre.23.2019.06.20.00.51.41
 for <spice-devel@lists.freedesktop.org>
 (version=TLS1_3 cipher=AEAD-AES128-GCM-SHA256 bits=128/128);
 Thu, 20 Jun 2019 00:51:41 -0700 (PDT)
To: spice-devel@lists.freedesktop.org
References: <cover.1560790607.git.fgouget@free.fr>
 <954d1aa1c8862a72dce84790fa9e1212a72256fd.1560790607.git.fgouget@free.fr>
From: Snir Sheriber <ssheribe@redhat.com>
Message-ID: <52f80a0c-4e73-2d1a-37c2-7b10122d4615@redhat.com>
Date: Thu, 20 Jun 2019 10:51:39 +0300
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.6.1
MIME-Version: 1.0
In-Reply-To: <954d1aa1c8862a72dce84790fa9e1212a72256fd.1560790607.git.fgouget@free.fr>
Content-Language: en-US
Subject: Re: [Spice-devel] [client v2 07/12] channel-display: Minimize the
 stream lag by ignoring the server one
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

SGksCgpPbiA2LzE3LzE5IDg6MzMgUE0sIEZyYW5jb2lzIEdvdWdldCB3cm90ZToKPiBUaGUgY2xp
ZW50IGlzIGluIGEgYmV0dGVyIHBvc2l0aW9uIHRoYW4gdGhlIHNlcnZlciB0byBwaWNrIHRoZSBt
aW5pbXVtCj4gbGFnIG5lZWRlZCB0byBjb21wZW5zYXRlIGZvciBmcmFtZSBhcnJpdmFsIHRpbWUg
aml0dGVyIGFuZCBlbnN1cmUKPiBzbW9vdGggdmlkZW8gcGxheWJhY2suCj4gVG8gZG8gc286Cj4g
LSBJdCBpZ25vcmVzIHRoZSBsYWcgc3BlY2lmaWVkIGJ5IHRoZSBzZXJ2ZXIgdGhyb3VnaCB0aGUg
bW10aW1lIGNsb2NrCj4gICAgYWRqdXN0bWVudHMgKGJ1dCB0aGlzIGxhZyBpcyBzdGlsbCB0cmFj
a2VkIGZvciB0aGUgc3RyZWFtIHJlcG9ydHMpLgo+IC0gSXQgcGVyZm9ybXMgaXRzIG93biBmcmFt
ZSBtbXRpbWUgY29udmVyc2lvbiB0byB0aGUgbG9jYWwgbW9ub3RvbmljCj4gICAgY2xvY2sgc3Bp
Y2Vfc2Vzc2lvbl9nZXRfY2xpZW50X3RpbWUoKSBzaW5jZSB0aGUgc2VydmVyLWNvbnRyb2xsZWQK
PiAgICBtbXRpbWUgY2xvY2sgY2Fubm90IGJlIHJlbGllZCBvbi4gVGhpcyBjb252ZXJzaW9uIHVz
ZXMgZGF0YSBmcm9tIGFsbAo+ICAgIHN0cmVhbXMgYnV0IGlzIGdsb2JhbCBzbyBhbGwgc3RyZWFt
cyBpaGF2ZSBhIGNvbW1vbiB0aW1lIHJlZmVyZW5jZS4KaGF2ZSAoaGFzPykKPiAtIFRoaXMgaXMg
YWxzbyB3aGVyZSBtbXRpbWUgY2xvY2sgY2hhbmdlcyBjYXVzZWQgYnkgc2VydmVyIG1pZ3JhdGlv
bgo+ICAgIGFyZSBoYW5kbGVkLgo+IC0gSXQgdHJhY2tzIHRoZSBtYXJnaW4gYmV0d2VlbiB0aGUg
Y29udmVydGVkIHRpbWUtdG8tZGlzcGxheSBmcmFtZQo+ICAgIHRpbWVzdGFtcCBhbmQgdGhlIGN1
cnJlbiB0aW1lIGFuZCBhZGRzIGEgZGVsYXkgdG8gZW5zdXJlIHRoaXMgbWFyZ2luCj4gICAgcmVt
YWlucyBwb3NpdGl2ZS4KPiAtIFRoaXMgZGVsYXkgaW50cm9kdWNlcyB0aGUgdmlkZW8gc3RyZWFt
IGxhZy4gSXQgaXMgY29udGludW91c2x5Cj4gICAgYWRqdXN0ZWQgdG8gZWl0aGVyIGJlIGFzIGxv
dyBhcyBwb3NzaWJsZSwgb3IgbWF0Y2ggdGhlIGF1ZGlvCj4gICAgcGxheWJhY2sgZGVsYXkgZm9y
IHByb3BlciBsaXAgc3luYy4KPiAtIERlbGF5IGFkanVzdG1lbnRzIGFyZSBncmFkdWFsLCBzcGVl
ZGluZyB1cCBvciBzbG93aW5nIGRvd24gdmlkZW8KPiAgICBwbGF5YmFjayB1bnRpbCB0aGUgYXZl
cmFnZSBtYXJnaW4gbWF0Y2hlcyB0aGUgdGFyZ2V0IGxhZy4KCkl0IHNlZW1zIG9uY2UgbWFyZ2lu
IGluY3JlYXNlIGl0J3Mgbm90IGRlY3JlYXNlLgooaSB0ZXN0ZWQgd2l0aCBzdHJlYW1pbmcgYWdl
bnQgYWZ0ZXIgcGxheWluZyBhIHZpZGVvIGZvciBzZXZlcmFsIHNlY29uZHMKbWFyZ2luIGdvZXMg
dXAgYW5kIGxhdGVuY3kgc3RheXMpLCBkbyB3ZSB3YW50IGdyYWR1YWwgY2hhbmdlcyB3aGVuCml0
J3MgZnVsbCBzY3JlZW4gc3RyZWFtaW5nPwoKR2VuZXJhbGx5IHNwZWFraW5nIGl0IG1ha2VzIHRo
ZSBjb2RlIG1vcmUgY29tcGxleCBhbmQgaGFyZCB0bwpmb2xsb3cgKG1heWJlIHdvcnRoIG1vcmUg
Y29tbWVudHMgYW5kIHZhcmlhYmxlcyBkZXNjcmlwdGlvbikKaG93IGRvIHlvdSB0ZXN0IGl0PyBk
b2VzIGl0IGltcHJvdmUgc2lnbmlmaWNhbnRseSB0aGUgc21vb3RobmVzcyBvZgp2aWRlbyBzdHJl
YW1zPwoKCj4gLSBDaGFuZ2VzIGluIHRoZSBhdmVyYWdlIG1hcmdpbiBhcmUgdHJhY2tlZCAoc2Vl
IG1hcmdpbl9zcHJlYWQpIHRvCj4gICAgYXZvaWQgbnVkZ2luZyB0aGUgZGVsYXkgaW4gcmVzcG9u
c2UgdG8gbWlub3IgcmFuZG9tIHZhcmlhdGlvbnMuCj4KPiBTaWduZWQtb2ZmLWJ5OiBGcmFuY29p
cyBHb3VnZXQgPGZnb3VnZXRAY29kZXdlYXZlcnMuY29tPgo+IC0tLQo+ICAgc3JjL2NoYW5uZWwt
ZGlzcGxheS1nc3QuYyAgIHwgIDIyICsrLS0tCj4gICBzcmMvY2hhbm5lbC1kaXNwbGF5LW1qcGVn
LmMgfCAgMTQgKy0tCj4gICBzcmMvY2hhbm5lbC1kaXNwbGF5LXByaXYuaCAgfCAgMTggKysrLQo+
ICAgc3JjL2NoYW5uZWwtZGlzcGxheS5jICAgICAgIHwgMTc4ICsrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrLS0tLQo+ICAgc3JjL3NwaWNlLXNlc3Npb24tcHJpdi5oICAgIHwgICAxICsK
PiAgIHNyYy9zcGljZS1zZXNzaW9uLmMgICAgICAgICB8ICA0NiArKysrKysrKysrCj4gICA2IGZp
bGVzIGNoYW5nZWQsIDI0MCBpbnNlcnRpb25zKCspLCAzOSBkZWxldGlvbnMoLSkKPgo+IGRpZmYg
LS1naXQgYS9zcmMvY2hhbm5lbC1kaXNwbGF5LWdzdC5jIGIvc3JjL2NoYW5uZWwtZGlzcGxheS1n
c3QuYwo+IGluZGV4IDZmY2NmNjIxLi42NzNmNDE3NyAxMDA2NDQKPiAtLS0gYS9zcmMvY2hhbm5l
bC1kaXNwbGF5LWdzdC5jCj4gKysrIGIvc3JjL2NoYW5uZWwtZGlzcGxheS1nc3QuYwo+IEBAIC01
MCw3ICs1MCw3IEBAIHR5cGVkZWYgc3RydWN0IFNwaWNlR3N0RGVjb2RlciB7Cj4gICAKPiAgICAg
ICAvKiAtLS0tLS0tLS0tIERlY29kaW5nIGFuZCBkaXNwbGF5IHF1ZXVlcyAtLS0tLS0tLS0tICov
Cj4gICAKPiAtICAgIHVpbnQzMl90IGxhc3RfbW1fdGltZTsKPiArICAgIHVpbnQzMl90IGxhc3Rf
ZnJhbWVfdGltZTsKPiAgIAo+ICAgICAgIEdNdXRleCBxdWV1ZXNfbXV0ZXg7Cj4gICAgICAgR1F1
ZXVlICpkZWNvZGluZ19xdWV1ZTsKPiBAQCAtMjk3LDggKzI5Nyw4IEBAIHN0YXRpYyB2b2lkIHNj
aGVkdWxlX2ZyYW1lKFNwaWNlR3N0RGVjb2RlciAqZGVjb2RlcikKPiAgICAgICAgICAgICAgIGJy
ZWFrOwo+ICAgICAgICAgICB9Cj4gICAKPiAtICAgICAgICBpZiAoc3BpY2VfbW10aW1lX2RpZmYo
Z3N0ZnJhbWUtPmVuY29kZWRfZnJhbWUtPm1tX3RpbWUsIG5vdykgPj0gMCkgewo+IC0gICAgICAg
ICAgICBkZWNvZGVyLT50aW1lcl9pZCA9IGdfdGltZW91dF9hZGQoZ3N0ZnJhbWUtPmVuY29kZWRf
ZnJhbWUtPm1tX3RpbWUgLSBub3csCj4gKyAgICAgICAgaWYgKHNwaWNlX21tdGltZV9kaWZmKGdz
dGZyYW1lLT5lbmNvZGVkX2ZyYW1lLT50aW1lLCBub3cpID49IDApIHsKPiArICAgICAgICAgICAg
ZGVjb2Rlci0+dGltZXJfaWQgPSBnX3RpbWVvdXRfYWRkKGdzdGZyYW1lLT5lbmNvZGVkX2ZyYW1l
LT50aW1lIC0gbm93LAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGRpc3BsYXlfZnJhbWUsIGRlY29kZXIpOwo+ICAgICAgICAgICB9IGVsc2UgaWYgKGRl
Y29kZXItPmRpc3BsYXlfZnJhbWUgJiYgIWRlY29kZXItPnBlbmRpbmdfc2FtcGxlcykgewo+ICAg
ICAgICAgICAgICAgLyogU3RpbGwgYXR0ZW1wdCB0byBkaXNwbGF5IHRoZSBsZWFzdCBvdXQgb2Yg
ZGF0ZSBmcmFtZSBzbyB0aGUKPiBAQCAtMzA3LDggKzMwNyw4IEBAIHN0YXRpYyB2b2lkIHNjaGVk
dWxlX2ZyYW1lKFNwaWNlR3N0RGVjb2RlciAqZGVjb2RlcikKPiAgICAgICAgICAgICAgIGRlY29k
ZXItPnRpbWVyX2lkID0gZ190aW1lb3V0X2FkZCgwLCBkaXNwbGF5X2ZyYW1lLCBkZWNvZGVyKTsK
PiAgICAgICAgICAgfSBlbHNlIHsKPiAgICAgICAgICAgICAgIFNQSUNFX0RFQlVHKCIlczogcmVu
ZGVyaW5nIHRvbyBsYXRlIGJ5ICV1IG1zICh0czogJXUsIG1tdGltZTogJXUpLCBkcm9wcGluZyIs
Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgIF9fRlVOQ1RJT05fXywgbm93IC0gZ3N0ZnJhbWUt
PmVuY29kZWRfZnJhbWUtPm1tX3RpbWUsCj4gLSAgICAgICAgICAgICAgICAgICAgICAgIGdzdGZy
YW1lLT5lbmNvZGVkX2ZyYW1lLT5tbV90aW1lLCBub3cpOwo+ICsgICAgICAgICAgICAgICAgICAg
ICAgICBfX0ZVTkNUSU9OX18sIG5vdyAtIGdzdGZyYW1lLT5lbmNvZGVkX2ZyYW1lLT50aW1lLAo+
ICsgICAgICAgICAgICAgICAgICAgICAgICBnc3RmcmFtZS0+ZW5jb2RlZF9mcmFtZS0+dGltZSwg
bm93KTsKPiAgICAgICAgICAgICAgIHN0cmVhbV9kcm9wcGVkX2ZyYW1lX29uX3BsYXliYWNrKGRl
Y29kZXItPmJhc2Uuc3RyZWFtKTsKPiAgICAgICAgICAgICAgIGRlY29kZXItPmRpc3BsYXlfZnJh
bWUgPSBOVUxMOwo+ICAgICAgICAgICAgICAgZnJlZV9nc3RfZnJhbWUoZ3N0ZnJhbWUpOwo+IEBA
IC00NDksOSArNDQ5LDkgQEAgc2lua19ldmVudF9wcm9iZShHc3RQYWQgKnBhZCwgR3N0UGFkUHJv
YmVJbmZvICppbmZvLCBncG9pbnRlciBkYXRhKQo+ICAgICAgICAgICAgICAgICogICBvciBtb3Jl
IGZyYW1lIGludGVydmFscy4KPiAgICAgICAgICAgICAgICAqLwo+ICAgICAgICAgICAgICAgcmVj
b3JkKGZyYW1lc19zdGF0cywKPiAtICAgICAgICAgICAgICAgICAgICJmcmFtZSBtbV90aW1lICV1
IHNpemUgJXUgY3JlYXRpb24gdGltZSAlIiBQUklkNjQKPiArICAgICAgICAgICAgICAgICAgICJm
cmFtZSB0aW1lICV1IHNpemUgJXUgY3JlYXRpb24gdGltZSAlIiBQUklkNjQKPiAgICAgICAgICAg
ICAgICAgICAgICAiIGRlY29kZWQgdGltZSAlIiBQUklkNjQgIiBxdWV1ZSAldSBiZWZvcmUgJXUi
LAo+IC0gICAgICAgICAgICAgICAgICAgZnJhbWUtPm1tX3RpbWUsIGZyYW1lLT5zaXplLCBmcmFt
ZS0+Y3JlYXRpb25fdGltZSwgZHVyYXRpb24sCj4gKyAgICAgICAgICAgICAgICAgICBmcmFtZS0+
dGltZSwgZnJhbWUtPnNpemUsIGZyYW1lLT5jcmVhdGlvbl90aW1lLCBkdXJhdGlvbiwKPiAgICAg
ICAgICAgICAgICAgICAgICBkZWNvZGVyLT5kZWNvZGluZ19xdWV1ZS0+bGVuZ3RoLCBnc3RmcmFt
ZS0+cXVldWVfbGVuKTsKPiAgIAo+ICAgICAgICAgICAgICAgaWYgKCFkZWNvZGVyLT5hcHBzaW5r
KSB7Cj4gQEAgLTY4OSwxMyArNjg5LDEzIEBAIHN0YXRpYyBnYm9vbGVhbiBzcGljZV9nc3RfZGVj
b2Rlcl9xdWV1ZV9mcmFtZShWaWRlb0RlY29kZXIgKnZpZGVvX2RlY29kZXIsCj4gICAgICAgICAg
IHJldHVybiBUUlVFOwo+ICAgICAgIH0KPiAgIAo+IC0gICAgaWYgKHNwaWNlX21tdGltZV9kaWZm
KGZyYW1lLT5tbV90aW1lLCBkZWNvZGVyLT5sYXN0X21tX3RpbWUpIDwgMCkgewo+ICsgICAgaWYg
KHNwaWNlX21tdGltZV9kaWZmKGZyYW1lLT50aW1lLCBkZWNvZGVyLT5sYXN0X2ZyYW1lX3RpbWUp
IDwgMCkgewo+ICAgICAgICAgICBTUElDRV9ERUJVRygibmV3LWZyYW1lLXRpbWUgPCBsYXN0LWZy
YW1lLXRpbWUgKCV1IDwgJXUpOiIKPiAgICAgICAgICAgICAgICAgICAgICAgIiByZXNldHRpbmcg
c3RyZWFtIiwKPiAtICAgICAgICAgICAgICAgICAgICBmcmFtZS0+bW1fdGltZSwgZGVjb2Rlci0+
bGFzdF9tbV90aW1lKTsKPiArICAgICAgICAgICAgICAgICAgICBmcmFtZS0+dGltZSwgZGVjb2Rl
ci0+bGFzdF9mcmFtZV90aW1lKTsKPiAgICAgICAgICAgLyogTGV0IEdTdHJlYW1lciBkZWFsIHdp
dGggdGhlIGZyYW1lIGFueXdheSAqLwo+ICAgICAgIH0KPiAtICAgIGRlY29kZXItPmxhc3RfbW1f
dGltZSA9IGZyYW1lLT5tbV90aW1lOwo+ICsgICAgZGVjb2Rlci0+bGFzdF9mcmFtZV90aW1lID0g
ZnJhbWUtPnRpbWU7Cj4gICAKPiAgICAgICBpZiAobWFyZ2luIDwgMCAmJgo+ICAgICAgICAgICBk
ZWNvZGVyLT5iYXNlLmNvZGVjX3R5cGUgPT0gU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9NSlBFRykg
ewo+IEBAIC03NzgsNyArNzc4LDcgQEAgVmlkZW9EZWNvZGVyKiBjcmVhdGVfZ3N0cmVhbWVyX2Rl
Y29kZXIoaW50IGNvZGVjX3R5cGUsIGRpc3BsYXlfc3RyZWFtICpzdHJlYW0pCj4gICAgICAgICAg
IGRlY29kZXItPmJhc2UucXVldWVfZnJhbWUgPSBzcGljZV9nc3RfZGVjb2Rlcl9xdWV1ZV9mcmFt
ZTsKPiAgICAgICAgICAgZGVjb2Rlci0+YmFzZS5jb2RlY190eXBlID0gY29kZWNfdHlwZTsKPiAg
ICAgICAgICAgZGVjb2Rlci0+YmFzZS5zdHJlYW0gPSBzdHJlYW07Cj4gLSAgICAgICAgZGVjb2Rl
ci0+bGFzdF9tbV90aW1lID0gc3RyZWFtX2dldF90aW1lKHN0cmVhbSk7Cj4gKyAgICAgICAgZGVj
b2Rlci0+bGFzdF9mcmFtZV90aW1lID0gc3RyZWFtX2dldF90aW1lKHN0cmVhbSk7Cj4gICAgICAg
ICAgIGdfbXV0ZXhfaW5pdCgmZGVjb2Rlci0+cXVldWVzX211dGV4KTsKPiAgICAgICAgICAgZGVj
b2Rlci0+ZGVjb2RpbmdfcXVldWUgPSBnX3F1ZXVlX25ldygpOwo+ICAgCj4gZGlmZiAtLWdpdCBh
L3NyYy9jaGFubmVsLWRpc3BsYXktbWpwZWcuYyBiL3NyYy9jaGFubmVsLWRpc3BsYXktbWpwZWcu
Ywo+IGluZGV4IDY0N2QzMWIwLi5kM2FiNzdjOCAxMDA2NDQKPiAtLS0gYS9zcmMvY2hhbm5lbC1k
aXNwbGF5LW1qcGVnLmMKPiArKysgYi9zcmMvY2hhbm5lbC1kaXNwbGF5LW1qcGVnLmMKPiBAQCAt
MTgxLDE2ICsxODEsMTYgQEAgc3RhdGljIHZvaWQgbWpwZWdfZGVjb2Rlcl9zY2hlZHVsZShNSnBl
Z0RlY29kZXIgKmRlY29kZXIpCj4gICAgICAgZGVjb2Rlci0+Y3VyX2ZyYW1lID0gTlVMTDsKPiAg
ICAgICBkbyB7Cj4gICAgICAgICAgIGlmIChmcmFtZSkgewo+IC0gICAgICAgICAgICBpZiAoc3Bp
Y2VfbW10aW1lX2RpZmYodGltZSwgZnJhbWUtPm1tX3RpbWUpIDw9IDApIHsKPiAtICAgICAgICAg
ICAgICAgIGd1aW50MzIgZCA9IGZyYW1lLT5tbV90aW1lIC0gdGltZTsKPiArICAgICAgICAgICAg
aWYgKHNwaWNlX21tdGltZV9kaWZmKHRpbWUsIGZyYW1lLT50aW1lKSA8PSAwKSB7Cj4gKyAgICAg
ICAgICAgICAgICBndWludDMyIGQgPSBmcmFtZS0+dGltZSAtIHRpbWU7Cj4gICAgICAgICAgICAg
ICAgICAgZGVjb2Rlci0+Y3VyX2ZyYW1lID0gZnJhbWU7Cj4gICAgICAgICAgICAgICAgICAgZGVj
b2Rlci0+dGltZXJfaWQgPSBnX3RpbWVvdXRfYWRkKGQsIG1qcGVnX2RlY29kZXJfZGVjb2RlX2Zy
YW1lLCBkZWNvZGVyKTsKPiAgICAgICAgICAgICAgICAgICBicmVhazsKPiAgICAgICAgICAgICAg
IH0KPiAgIAo+ICAgICAgICAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiByZW5kZXJpbmcgdG9vIGxh
dGUgYnkgJXUgbXMgKHRzOiAldSwgbW10aW1lOiAldSksIGRyb3BwaW5nICIsCj4gLSAgICAgICAg
ICAgICAgICAgICAgICAgIF9fRlVOQ1RJT05fXywgdGltZSAtIGZyYW1lLT5tbV90aW1lLAo+IC0g
ICAgICAgICAgICAgICAgICAgICAgICBmcmFtZS0+bW1fdGltZSwgdGltZSk7Cj4gKyAgICAgICAg
ICAgICAgICAgICAgICAgIF9fRlVOQ1RJT05fXywgdGltZSAtIGZyYW1lLT50aW1lLAo+ICsgICAg
ICAgICAgICAgICAgICAgICAgICBmcmFtZS0+dGltZSwgdGltZSk7Cj4gICAgICAgICAgICAgICBz
dHJlYW1fZHJvcHBlZF9mcmFtZV9vbl9wbGF5YmFjayhkZWNvZGVyLT5iYXNlLnN0cmVhbSk7Cj4g
ICAgICAgICAgICAgICBzcGljZV9mcmFtZV9mcmVlKGZyYW1lKTsKPiAgICAgICAgICAgfQo+IEBA
IC0yMjYsMTIgKzIyNiwxMiBAQCBzdGF0aWMgZ2Jvb2xlYW4gbWpwZWdfZGVjb2Rlcl9xdWV1ZV9m
cmFtZShWaWRlb0RlY29kZXIgKnZpZGVvX2RlY29kZXIsCj4gICAKPiAgICAgICBsYXN0X2ZyYW1l
ID0gZ19xdWV1ZV9wZWVrX3RhaWwoZGVjb2Rlci0+bXNncSk7Cj4gICAgICAgaWYgKGxhc3RfZnJh
bWUpIHsKPiAtICAgICAgICBpZiAoc3BpY2VfbW10aW1lX2RpZmYoZnJhbWUtPm1tX3RpbWUsIGxh
c3RfZnJhbWUtPm1tX3RpbWUpIDwgMCkgewo+ICsgICAgICAgIGlmIChzcGljZV9tbXRpbWVfZGlm
ZihmcmFtZS0+dGltZSwgbGFzdF9mcmFtZS0+dGltZSkgPCAwKSB7Cj4gICAgICAgICAgICAgICAv
KiBUaGlzIHNob3VsZCByZWFsbHkgbm90IGhhcHBlbiAqLwo+ICAgICAgICAgICAgICAgU1BJQ0Vf
REVCVUcoIm5ldy1mcmFtZS10aW1lIDwgbGFzdC1mcmFtZS10aW1lICgldSA8ICV1KToiCj4gICAg
ICAgICAgICAgICAgICAgICAgICAgICAiIHJlc2V0dGluZyBzdHJlYW0iLAo+IC0gICAgICAgICAg
ICAgICAgICAgICAgICBmcmFtZS0+bW1fdGltZSwKPiAtICAgICAgICAgICAgICAgICAgICAgICAg
bGFzdF9mcmFtZS0+bW1fdGltZSk7Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lLT50
aW1lLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICBsYXN0X2ZyYW1lLT50aW1lKTsKPiAgICAg
ICAgICAgICAgIG1qcGVnX2RlY29kZXJfZHJvcF9xdWV1ZShkZWNvZGVyKTsKPiAgICAgICAgICAg
fQo+ICAgICAgIH0KPiBkaWZmIC0tZ2l0IGEvc3JjL2NoYW5uZWwtZGlzcGxheS1wcml2LmggYi9z
cmMvY2hhbm5lbC1kaXNwbGF5LXByaXYuaAo+IGluZGV4IDQ5NWRmN2FjLi5iYWRkOWQ0MiAxMDA2
NDQKPiAtLS0gYS9zcmMvY2hhbm5lbC1kaXNwbGF5LXByaXYuaAo+ICsrKyBiL3NyYy9jaGFubmVs
LWRpc3BsYXktcHJpdi5oCj4gQEAgLTM5LDcgKzM5LDcgQEAgdHlwZWRlZiBzdHJ1Y3QgZGlzcGxh
eV9zdHJlYW0gZGlzcGxheV9zdHJlYW07Cj4gICAKPiAgIHR5cGVkZWYgc3RydWN0IFNwaWNlRnJh
bWUgU3BpY2VGcmFtZTsKPiAgIHN0cnVjdCBTcGljZUZyYW1lIHsKPiAtICAgIHVpbnQzMl90IG1t
X3RpbWU7Cj4gKyAgICB1aW50MzJfdCB0aW1lOwo+ICAgICAgIFNwaWNlUmVjdCBkZXN0Owo+ICAg
Cj4gICAgICAgdWludDhfdCAqZGF0YTsKPiBAQCAtMTI0LDggKzEyNCwyMiBAQCBzdHJ1Y3QgZGlz
cGxheV9zdHJlYW0gewo+ICAgCj4gICAgICAgU3BpY2VDaGFubmVsICAgICAgICAgICAgICAgICpj
aGFubmVsOwo+ICAgCj4gLSAgICAvKiBzdGF0cyAqLwo+ICAgICAgIHVpbnQzMl90ICAgICAgICAg
ICAgIGZpcnN0X2ZyYW1lX21tX3RpbWU7Cj4gKyAgICB1aW50MzJfdCAgICAgICAgICAgICBsYXN0
X2ZyYW1lX21tX3RpbWU7Cj4gKyAgICB1aW50MzJfdCAgICAgICAgICAgICBsYXN0X2ZyYW1lX3Rp
bWU7Cj4gKwo+ICsgICAgLyogTGFnIG1hbmFnZW1lbnQgKHNlZSBkaXNwbGF5X2hhbmRsZV9zdHJl
YW1fZGF0YSgpKSAqLwo+ICsgICAgdWludDMyX3QgICAgICAgICAgICAgZGVsYXk7Cj4gKyAgICB1
aW50MzJfdCAgICAgICAgICAgICBtYXJnaW5fZXZhbF9zdGFydDsKPiArICAgIHVpbnQzMl90ICAg
ICAgICAgICAgIG1hcmdpbl9ldmFsX2NvdW50Owo+ICsgICAgaW50MzJfdCAgICAgICAgICAgICAg
bWluX21hcmdpbjsKPiArICAgIGludDMyX3QgICAgICAgICAgICAgIG1pbl9tYXJnaW5fbmV4dDsK
PiArICAgIGZsb2F0ICAgICAgICAgICAgICAgIGF2Z19tYXJnaW47Cj4gKyAgICBpbnQzMl90ICAg
ICAgICAgICAgICBtaW5fYXZnX21hcmdpbjsKPiArICAgIGludDMyX3QgICAgICAgICAgICAgIG1h
eF9hdmdfbWFyZ2luOwo+ICsgICAgdWludDMyX3QgICAgICAgICAgICAgbWFyZ2luX3NwcmVhZDsK
PiArCj4gKyAgICAvKiBzdGF0cyAqLwo+ICAgICAgIHVpbnQzMl90ICAgICAgICAgICAgIGFycml2
ZV9sYXRlX2NvdW50Owo+ICAgICAgIHVpbnQ2NF90ICAgICAgICAgICAgIGFycml2ZV9sYXRlX3Rp
bWU7Cj4gICAgICAgdWludDMyX3QgICAgICAgICAgICAgbnVtX2Ryb3BzX29uX3BsYXliYWNrOwo+
IGRpZmYgLS1naXQgYS9zcmMvY2hhbm5lbC1kaXNwbGF5LmMgYi9zcmMvY2hhbm5lbC1kaXNwbGF5
LmMKPiBpbmRleCBiMjYzMjZkNi4uODE1MjQyZGUgMTAwNjQ0Cj4gLS0tIGEvc3JjL2NoYW5uZWwt
ZGlzcGxheS5jCj4gKysrIGIvc3JjL2NoYW5uZWwtZGlzcGxheS5jCj4gQEAgLTIwLDYgKzIwLDcg
QEAKPiAgICNpZmRlZiBIQVZFX1NZU19UWVBFU19ICj4gICAjaW5jbHVkZSA8c3lzL3R5cGVzLmg+
Cj4gICAjZW5kaWYKPiArI2luY2x1ZGUgPG1hdGguaD4gLyogZm9yIGNlaWxmKCkgKi8KPiAgIAo+
ICAgI2luY2x1ZGUgInNwaWNlLWNsaWVudC5oIgo+ICAgI2luY2x1ZGUgInNwaWNlLWNvbW1vbi5o
Igo+IEBAIC0xMzc4LDggKzEzNzksNyBAQCBzdGF0aWMgdWludDMyX3Qgc3BpY2VfbXNnX2luX2Zy
YW1lX2RhdGEoU3BpY2VNc2dJbiAqZnJhbWVfbXNnLCB1aW50OF90ICoqZGF0YSkKPiAgIEdfR05V
Q19JTlRFUk5BTAo+ICAgZ3VpbnQzMiBzdHJlYW1fZ2V0X3RpbWUoZGlzcGxheV9zdHJlYW0gKnN0
KQo+ICAgewo+IC0gICAgU3BpY2VTZXNzaW9uICpzZXNzaW9uID0gc3BpY2VfY2hhbm5lbF9nZXRf
c2Vzc2lvbihzdC0+Y2hhbm5lbCk7Cj4gLSAgICByZXR1cm4gc2Vzc2lvbiA/IHNwaWNlX3Nlc3Np
b25fZ2V0X21tX3RpbWUoc2Vzc2lvbikgOiAwOwo+ICsgICAgcmV0dXJuIGdfZ2V0X21vbm90b25p
Y190aW1lKCkgLyAxMDAwOwo+ICAgfQo+ICAgCj4gICAvKiBjb3JvdXRpbmUgb3IgbWFpbiBjb250
ZXh0ICovCj4gQEAgLTE2NDMsNyArMTY0Myw3IEBAIHN0YXRpYyB2b2lkIGRpc3BsYXlfc3RyZWFt
X3N0YXRzX3NhdmUoZGlzcGxheV9zdHJlYW0gKnN0LAo+ICAgCj4gICBzdGF0aWMgU3BpY2VGcmFt
ZSAqc3BpY2VfZnJhbWVfbmV3KGRpc3BsYXlfc3RyZWFtICpzdCwKPiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgU3BpY2VNc2dJbiAqaW4sCj4gLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgZ3VpbnQzMiBmcmFtZV9tbXRpbWUpCj4gKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZ3VpbnQzMiBmcmFtZV90aW1lKQo+ICAgewo+ICAgICAgIFNw
aWNlRnJhbWUgKmZyYW1lOwo+ICAgICAgIGd1aW50OCAqZGF0YV9wdHI7Cj4gQEAgLTE2NTEsNyAr
MTY1MSw3IEBAIHN0YXRpYyBTcGljZUZyYW1lICpzcGljZV9mcmFtZV9uZXcoZGlzcGxheV9zdHJl
YW0gKnN0LAo+ICAgICAgIGd1aW50MzIgZGF0YV9zaXplID0gc3BpY2VfbXNnX2luX2ZyYW1lX2Rh
dGEoaW4sICZkYXRhX3B0cik7Cj4gICAKPiAgICAgICBmcmFtZSA9IGdfbmV3KFNwaWNlRnJhbWUs
IDEpOwo+IC0gICAgZnJhbWUtPm1tX3RpbWUgPSBmcmFtZV9tbXRpbWU7Cj4gKyAgICBmcmFtZS0+
dGltZSA9IGZyYW1lX3RpbWU7Cj4gICAgICAgZnJhbWUtPmRlc3QgPSAqZGVzdF9yZWN0Owo+ICAg
ICAgIGZyYW1lLT5kYXRhID0gZGF0YV9wdHI7Cj4gICAgICAgZnJhbWUtPnNpemUgPSBkYXRhX3Np
emU7Cj4gQEAgLTE2NzIsNDQgKzE2NzIsMTg0IEBAIHZvaWQgc3BpY2VfZnJhbWVfZnJlZShTcGlj
ZUZyYW1lICpmcmFtZSkKPiAgICAgICBnX2ZyZWUoZnJhbWUpOwo+ICAgfQo+ICAgCj4gKy8qIFBp
Y2sgYW4gaW5pdGlhbCB2YWx1ZSBsaWtlbHkgdG8gY292ZXIgdGhlIG5ldHdvcmsgaml0dGVyIGFu
ZCBub3QgdG8gY2F1c2UKPiArICogYSBzaWduaWZpY2FudCBsYWcuIFRoZSBkZWxheSB3aWxsIGJl
IGFkanVzdGVkIGZyb20gdGhlcmUuCj4gKyAqLwo+ICsjZGVmaW5lIElOSVRJQUxfREVMQVkgNDAK
PiArCj4gKy8qIENvbGxlY3QgZGF0YSBvbiBhIGxvbmcgZW5vdWdoIHBlcmlvZCB0byBjYXB0dXJl
IHJhcmUgZXZlbnRzLCBidXQgc2hvcnQKPiArICogZW5vdWdoIHNvIHRoYXQgdGhlIGFsZ29yaXRo
bSBpcyBzdGlsbCByZXNwb25zaXZlIHRvIGNoYW5nZXMuCj4gKyAqLwo+ICsjZGVmaW5lIE1BUkdJ
Tl9FVkFMX1RJTUUgKDEgKiAxMDAwKQo+ICsKPiArLyogTWFrZSBzdXJlIHdlIGhhdmUgZW5vdWdo
IGRhdGEgcG9pbnRzIGV2ZW4gaWYgdGhlIGZyYW1lcmF0ZSBpcyB2ZXJ5IGxvdy4gKi8KPiArI2Rl
ZmluZSBNQVJHSU5fRVZBTF9DT1VOVCAyMAo+ICsKPiAgIC8qIGNvcm91dGluZSBjb250ZXh0ICov
Cj4gICBzdGF0aWMgdm9pZCBkaXNwbGF5X2hhbmRsZV9zdHJlYW1fZGF0YShTcGljZUNoYW5uZWwg
KmNoYW5uZWwsIFNwaWNlTXNnSW4gKmluKQo+ICAgewo+ICsgICAgU3BpY2VTZXNzaW9uICpzZXNz
aW9uID0gc3BpY2VfY2hhbm5lbF9nZXRfc2Vzc2lvbihjaGFubmVsKTsKPiAgICAgICBTcGljZURp
c3BsYXlDaGFubmVsUHJpdmF0ZSAqYyA9IFNQSUNFX0RJU1BMQVlfQ0hBTk5FTChjaGFubmVsKS0+
cHJpdjsKPiAgICAgICBTcGljZVN0cmVhbURhdGFIZWFkZXIgKm9wID0gc3BpY2VfbXNnX2luX3Bh
cnNlZChpbik7Cj4gICAgICAgZGlzcGxheV9zdHJlYW0gKnN0ID0gZ2V0X3N0cmVhbV9ieV9pZChj
aGFubmVsLCBvcC0+aWQpOwo+IC0gICAgZ3VpbnQzMiBtbXRpbWU7Cj4gLSAgICBpbnQzMl90IG1h
cmdpbiwgbWFyZ2luX3JlcG9ydDsKPiArICAgIGd1aW50MzIgY3VycmVudF9tbXRpbWUsIGZyYW1l
X2ludGVydmFsOwo+ICsgICAgZ3VpbnQzMiBzdHJlYW1fdGltZSwgZnJhbWVfdGltZTsKPiArICAg
IGdpbnQzMiBtbXRpbWVfbWFyZ2luLCBtYXJnaW47Cj4gICAgICAgU3BpY2VGcmFtZSAqZnJhbWU7
Cj4gICAKPiAgICAgICBnX3JldHVybl9pZl9mYWlsKHN0ICE9IE5VTEwpOwo+IC0gICAgbW10aW1l
ID0gc3RyZWFtX2dldF90aW1lKHN0KTsKPiArCj4gKyAgICBjdXJyZW50X21tdGltZSA9IHNwaWNl
X3Nlc3Npb25fZ2V0X21tX3RpbWUoc2Vzc2lvbik7Cj4gICAKPiAgICAgICBpZiAoc3BpY2VfbXNn
X2luX3R5cGUoaW4pID09IFNQSUNFX01TR19ESVNQTEFZX1NUUkVBTV9EQVRBX1NJWkVEKSB7Cj4g
ICAgICAgICAgIENIQU5ORUxfREVCVUcoY2hhbm5lbCwgInN0cmVhbSAldSBjb250YWlucyBzaXpl
ZCBkYXRhIiwgb3AtPmlkKTsKPiAgICAgICB9Cj4gICAKPiArICAgIGZyYW1lX2ludGVydmFsID0g
MDsKPiArICAgIG1tdGltZV9tYXJnaW4gPSA0MDA7IC8qIHNlcnZlcidzIGRlZmF1bHQgbW1fdGlt
ZSBvZmZzZXQgKi8KCgpTZWVtcyBhIGJpdCB3ZWlyZCB0byBhZGp1c3QgdG8gZml4ZWQgc2VydmVy
IHZhbHVlLCBidXQgY3VycmVudGx5IGkgZ3Vlc3MKaXQncyBiZXR0ZXIgdGhhbiBjaGFuZ2luZyBz
ZXJ2ZXIgc2lkZS4KCgo+ICAgICAgIGlmIChvcC0+bXVsdGlfbWVkaWFfdGltZSA9PSAwKSB7Cj4g
LSAgICAgICAgZ19jcml0aWNhbCgiUmVjZWl2ZWQgZnJhbWUgd2l0aCBpbnZhbGlkIDAgdGltZXN0
YW1wISBwZXJoYXBzIHdyb25nIGdyYXBoaWMgZHJpdmVyPyIpOwo+IC0gICAgICAgIG9wLT5tdWx0
aV9tZWRpYV90aW1lID0gbW10aW1lICsgMTAwOyAvKiB3b3JrYXJvdW5kLi4uICovCj4gLSAgICB9
Cj4gKyAgICAgICAgZ19jcml0aWNhbCgiUmVjZWl2ZWQgZnJhbWUgd2l0aCBpbnZhbGlkIDAgdGlt
ZXN0YW1wISBQZXJoYXBzIHdyb25nIGdyYXBoaWMgZHJpdmVyPyIpOwo+ICsgICAgICAgIG9wLT5t
dWx0aV9tZWRpYV90aW1lID0gY3VycmVudF9tbXRpbWU7IC8qIHdvcmthcm91bmQuLi4gKi8KPiAr
ICAgICAgICBmcmFtZV9pbnRlcnZhbCA9IHNwaWNlX21tdGltZV9kaWZmKG9wLT5tdWx0aV9tZWRp
YV90aW1lLCBzdC0+bGFzdF9mcmFtZV9tbV90aW1lKTsKPiArICAgIH0gZWxzZSBpZiAoc3QtPmxh
c3RfZnJhbWVfbW1fdGltZSA9PSAwKSB7Cj4gKyAgICAgICAgLyogRmlyc3QgZnJhbWUgc28gZnJh
bWVfaW50ZXJ2YWwgaXMgdW5rbm93biAqLwo+ICsgICAgICAgIG1tdGltZV9tYXJnaW4gPSBzcGlj
ZV9tbXRpbWVfZGlmZihvcC0+bXVsdGlfbWVkaWFfdGltZSwgY3VycmVudF9tbXRpbWUpOwo+ICsg
ICAgfSBlbHNlIGlmIChvcC0+bXVsdGlfbWVkaWFfdGltZSA8IHN0LT5sYXN0X2ZyYW1lX21tX3Rp
bWUpIHsKPiArICAgICAgICAvKiBUaGlzIGNhbiBoYXBwZW4gd2hlbiBtaWdyYXRpbmcgZnJvbSBh
IHNlcnZlciB3aXRoIGEgaGlnaCBtbV90aW1lCj4gKyAgICAgICAgICogKGkuZS4gaGlnaCB1cHRp
bWUpIHRvIG9uZSB3aXRoIGEgbG93IG1tX3RpbWU6Cj4gKyAgICAgICAgICogLSBzZXJ2ZXIgQSBz
ZW5kcyBhIGZyYW1lIHdpdGggQV9tbV90aW1lCj4gKyAgICAgICAgICogLSBjbGllbnQgcmVjZWl2
ZXMgdGhlIGZyYW1lIGFuZCBzZXRzIGxhc3RfZnJhbWVfbW1fdGltZSA9IEFfbW1fdGltZQo+ICsg
ICAgICAgICAqIC0gc2VydmVyIEIgc2VuZHMgYSBmcmFtZSB3aXRoIEJfbW1fdGltZQo+ICsgICAg
ICAgICAqIC0gY2xpZW50IHJlY2VpdmVzIHNlcnZlciBCJ3MgZnJhbWUgd2l0aCBCX21tX3RpbWUg
PDwgQV9tbV90aW1lCj4gKyAgICAgICAgICogQWxzbyBub3RlIHRoYXQgYWx0aG91Z2ggc2VydmVy
IEIgd291bGQgbm9ybWFsbHkgc2VuZCBhbiBtbV90aW1lCj4gKyAgICAgICAgICogcmVzZXQgbWVz
c2FnZSwgdGhlcmUgaXMgbm8gZ3VhcmFudGVlIGl0IHdpbGwgYmUgcmVjZWl2ZWQgYmVmb3JlCj4g
KyAgICAgICAgICogc2VydmVyIEIncyBmaXJzdCBmcmFtZSBzbyBpdCdzIG5vdCBtdWNoIGhlbHAu
Cj4gKyAgICAgICAgICovCj4gKyAgICAgICAgU1BJQ0VfREVCVUcoIiV1IGdvdCBhbiBvdXQgb2Yg
b3JkZXIgZnJhbWUgLSV1Iiwgb3AtPmlkLAo+ICsgICAgICAgICAgICAgICAgICAgIHN0LT5sYXN0
X2ZyYW1lX21tX3RpbWUgLSBvcC0+bXVsdGlfbWVkaWFfdGltZSk7Cj4gKyAgICAgICAgc3QtPmxh
c3RfZnJhbWVfbW1fdGltZSA9IG9wLT5tdWx0aV9tZWRpYV90aW1lOwo+ICsgICAgfSBlbHNlIGlm
IChvcC0+bXVsdGlfbWVkaWFfdGltZSA+IHN0LT5sYXN0X2ZyYW1lX21tX3RpbWUgKyAxMDAwKSB7
Cj4gKyAgICAgICAgLyogU3RyZWFtcyBhcmUgc3VwcG9zZWQgdG8gc2VuZCBhdCBsZWFzdCAxIGZy
YW1lIHBlciBzZWNvbmQuCj4gKyAgICAgICAgICogU28gaXQncyBtb3JlIGxpa2VseSB0aGF0IHdl
IGdvdCBtaWdyYXRlZCBmcm9tIGEgc2VydmVyIHdpdGggYSBsb3cKPiArICAgICAgICAgKiBtbV90
aW1lIChpLmUuIGxvdyB1cHRpbWUpIHRvIG9uZSB3aXRoIGEgaGlnaCBtbV90aW1lLiBTZWUgdGhl
IGNhc2UKPiArICAgICAgICAgKiBhYm92ZSBmb3IgZGV0YWlscy4gSW4gc3VjaCBhIGNhc2Ugc2lt
cGx5IHJlaW5pdGlhbGl6ZSB0aGUgc3RyZWFtLgo+ICsgICAgICAgICAqLwo+ICsgICAgICAgIFNQ
SUNFX0RFQlVHKCIldSBnb3QgYW4gYWJub3JtYWxseSBsb25nIG1tX3RpbWUgZnJhbWUgaW50ZXJ2
YWwgJXUiLCBvcC0+aWQsCj4gKyAgICAgICAgICAgICAgICAgICAgb3AtPm11bHRpX21lZGlhX3Rp
bWUgLSBzdC0+bGFzdF9mcmFtZV9tbV90aW1lKTsKPiArICAgICAgICBzdC0+bGFzdF9mcmFtZV90
aW1lID0gMDsKPiArICAgIH0gZWxzZSB7Cj4gKyAgICAgICAgbW10aW1lX21hcmdpbiA9IHNwaWNl
X21tdGltZV9kaWZmKG9wLT5tdWx0aV9tZWRpYV90aW1lLCBjdXJyZW50X21tdGltZSk7Cj4gKyAg
ICAgICAgZnJhbWVfaW50ZXJ2YWwgPSBzcGljZV9tbXRpbWVfZGlmZihvcC0+bXVsdGlfbWVkaWFf
dGltZSwgc3QtPmxhc3RfZnJhbWVfbW1fdGltZSk7Cj4gKyAgICB9Cj4gKyAgICBkaXNwbGF5X3N0
cmVhbV9zdGF0c19zYXZlKHN0LCBvcC0+bXVsdGlfbWVkaWFfdGltZSwgY3VycmVudF9tbXRpbWUp
Owo+ICsgICAgc3QtPmxhc3RfZnJhbWVfbW1fdGltZSA9IG9wLT5tdWx0aV9tZWRpYV90aW1lOwo+
ICsKPiArICAgIC8qIENvbXB1dGUgdGhlIGxvY2FsIGZyYW1lIG1tdGltZSAqLwo+ICsgICAgc3Ry
ZWFtX3RpbWUgPSBzdHJlYW1fZ2V0X3RpbWUoc3QpOwo+ICsgICAgZnJhbWVfdGltZSA9IHNwaWNl
X3Nlc3Npb25fZ2V0X2NsaWVudF90aW1lKHNlc3Npb24sIG9wLT5tdWx0aV9tZWRpYV90aW1lKTsK
CgpUaGlzIGlzIG5vdCB2ZXJ5IGNsZWFyIHRvIG1lLCBpdCdzIGNhbGxlZCBmcmFtZV90aW1lIGJ1
dCBpbiBwcmFjdGljZQp0aGlzIHNldHMgb2Zmc2V0IG9yIHJldHVybiBjdXJyZW50IGxvY2FsIG1v
bm90b25pYyB0aW1lLgoKCj4gKyAgICBndWludDMyIHRhcmdldF9sYWcgPSBzcGljZV9zZXNzaW9u
X2dldF9wbGF5YmFja19sYXRlbmN5KHNlc3Npb24pOwo+ICsgICAgaWYgKHN0LT5sYXN0X2ZyYW1l
X3RpbWUgPT0gMCkgewo+ICsgICAgICAgIG1hcmdpbiA9IHNwaWNlX21tdGltZV9kaWZmKGZyYW1l
X3RpbWUsIHN0cmVhbV90aW1lKTsKPiArICAgICAgICBzdC0+ZGVsYXkgPSBNQVgodGFyZ2V0X2xh
ZyAtIG1hcmdpbiwgSU5JVElBTF9ERUxBWSk7Cj4gKyAgICAgICAgZnJhbWVfdGltZSArPSBzdC0+
ZGVsYXk7Cj4gKyAgICAgICAgbWFyZ2luICs9IHN0LT5kZWxheTsKPiArCj4gKyAgICAgICAgc3Qt
Pm1hcmdpbl9ldmFsX3N0YXJ0ID0gc3RyZWFtX3RpbWU7Cj4gKyAgICAgICAgc3QtPm1hcmdpbl9l
dmFsX2NvdW50ID0gMDsKPiArICAgICAgICBzdC0+bWluX21hcmdpbiA9IDA7IC8qIEZvcmNlIHdh
aXQgYmVmb3JlIHJlZHVjaW5nIHRoZSBkZWxheSAqLwo+ICsgICAgICAgIHN0LT5taW5fbWFyZ2lu
X25leHQgPSBtYXJnaW47Cj4gKyAgICAgICAgc3QtPmF2Z19tYXJnaW4gPSBtYXJnaW47Cj4gKyAg
ICAgICAgc3QtPm1heF9hdmdfbWFyZ2luID0gc3QtPm1pbl9hdmdfbWFyZ2luID0gbWFyZ2luOwo+
ICsgICAgICAgIHN0LT5tYXJnaW5fc3ByZWFkID0gc3QtPmRlbGF5Owo+ICsgICAgfSBlbHNlIHsK
PiArICAgICAgICBmcmFtZV90aW1lID0gTUFYKGZyYW1lX3RpbWUgKyBzdC0+ZGVsYXksCj4gKyAg
ICAgICAgICAgICAgICAgICAgICAgICBzdC0+bGFzdF9mcmFtZV90aW1lICsgKGZyYW1lX2ludGVy
dmFsICsgMykgLyA0KTsKCldoeSBpcyB0aGF0PwoKCj4gKyAgICAgICAgbWFyZ2luID0gc3BpY2Vf
bW10aW1lX2RpZmYoZnJhbWVfdGltZSwgc3RyZWFtX3RpbWUpOwo+ICsKPiArICAgICAgICAvKiBO
b3RlIHRoYXQgd2hlbiB1c2luZyBpbnRlZ2VycyB0aGUgbW92aW5nIGF2ZXJhZ2UgY2FuIHN0YWJp
bGl6ZSB1cCB0bwo+ICsgICAgICAgICAqIHdlaWdodC8yLTEgYXdheSBmcm9tIHRoZSB0cnVlIGF2
ZXJhZ2UgKHdoZXJlIHdlaWdodD0xNiBoZXJlKSBkdWUKPiArICAgICAgICAgKiB0byB0aGUgcm91
bmRpbmcgZXJyb3JzIChlLmcuIGNvbnNpZGVyIDEgMTYgMTYuLi4pLgo+ICsgICAgICAgICAqIFNv
IHVzZSBhIGZsb2F0IGZvciBhdmdfbWFyZ2luLgo+ICsgICAgICAgICAqLwo+ICsgICAgICAgIHN0
LT5hdmdfbWFyZ2luID0gKHN0LT5hdmdfbWFyZ2luICogMTUgKyBtYXJnaW4pIC8gMTY7Cj4gKyAg
ICAgICAgaWYgKHN0LT5hdmdfbWFyZ2luIDwgc3QtPm1pbl9hdmdfbWFyZ2luKSB7Cj4gKyAgICAg
ICAgICAgIHN0LT5taW5fYXZnX21hcmdpbiA9IHN0LT5hdmdfbWFyZ2luOwo+ICsgICAgICAgIH0g
ZWxzZSBpZiAoc3QtPmF2Z19tYXJnaW4gPiBzdC0+bWF4X2F2Z19tYXJnaW4pIHsKPiArICAgICAg
ICAgICAgc3QtPm1heF9hdmdfbWFyZ2luID0gY2VpbGYoc3QtPmF2Z19tYXJnaW4pOwo+ICsgICAg
ICAgIH0KPiArCj4gKyAgICAgICAgaWYgKG1hcmdpbiA8IHN0LT5taW5fbWFyZ2luX25leHQpIHsK
PiArICAgICAgICAgICAgc3QtPm1pbl9tYXJnaW5fbmV4dCA9IG1hcmdpbjsKPiArICAgICAgICAg
ICAgLyogVGFrZSBpbnRvIGFjY291bnQgc2lnbnMgdGhhdCB0aGUgc2l0dWF0aW9uIHdvcnNlbmVk
IHdpdGhvdXQKPiArICAgICAgICAgICAgICogZGVsYXkuCj4gKyAgICAgICAgICAgICAqLwo+ICsg
ICAgICAgICAgICBzdC0+bWluX21hcmdpbiA9IE1JTihzdC0+bWluX21hcmdpbiwgc3QtPm1pbl9t
YXJnaW5fbmV4dCk7Cj4gKyAgICAgICAgfQo+ICAgCj4gLSAgICBtYXJnaW4gPSBtYXJnaW5fcmVw
b3J0ID0gb3AtPm11bHRpX21lZGlhX3RpbWUgLSBtbXRpbWU7Cj4gLSAgICBpZiAobWFyZ2luID4g
MCkgewo+IC0gICAgICAgIFNwaWNlU2Vzc2lvbiAqcyA9IHNwaWNlX2NoYW5uZWxfZ2V0X3Nlc3Np
b24oY2hhbm5lbCk7Cj4gKyAgICAgICAgLyogT25seSByZXBsYWNlIHRoZSBjdXJyZW50IG1pbl9t
YXJnaW4gYW5kIG1hcmdpbl9zcHJlYWQgZXN0aW1hdGVzIG9uY2UKPiArICAgICAgICAgKiBlbm91
Z2ggZGF0YSBoYXMgYmVlbiBjb2xsZWN0ZWQgZm9yIHRoZSAqX25leHQgdmFsdWVzLCBib3RoIGlu
IHRlcm0KPiArICAgICAgICAgKiBvZiBlbGFwc2VkIHRpbWUgYW5kIG51bWJlciBvZiBmcmFtZXMu
Cj4gKyAgICAgICAgICovCj4gKyAgICAgICAgc3QtPm1hcmdpbl9ldmFsX2NvdW50Kys7Cj4gKyAg
ICAgICAgaWYgKHN0cmVhbV90aW1lIC0gc3QtPm1hcmdpbl9ldmFsX3N0YXJ0ID4gTUFSR0lOX0VW
QUxfVElNRSAmJgo+ICsgICAgICAgICAgICBzdC0+bWFyZ2luX2V2YWxfY291bnQgPj0gTUFSR0lO
X0VWQUxfQ09VTlQpIHsKPiArICAgICAgICAgICAgc3QtPm1pbl9tYXJnaW4gPSBzdC0+bWluX21h
cmdpbl9uZXh0Owo+ICsKPiArICAgICAgICAgICAgc3QtPm1hcmdpbl9ldmFsX3N0YXJ0ID0gc3Ry
ZWFtX3RpbWU7Cj4gKyAgICAgICAgICAgIHN0LT5tYXJnaW5fZXZhbF9jb3VudCA9IDE7Cj4gKyAg
ICAgICAgICAgIHN0LT5taW5fbWFyZ2luX25leHQgPSBtYXJnaW47Cj4gKwo+ICsgICAgICAgICAg
ICBzdC0+bWFyZ2luX3NwcmVhZCA9IChzdC0+bWF4X2F2Z19tYXJnaW4gLSBzdC0+bWluX2F2Z19t
YXJnaW4gKyAxKSAvIDI7Cj4gKyAgICAgICAgICAgIHN0LT5taW5fYXZnX21hcmdpbiA9IHN0LT5h
dmdfbWFyZ2luOwo+ICsgICAgICAgICAgICBzdC0+bWF4X2F2Z19tYXJnaW4gPSBjZWlsZihzdC0+
YXZnX21hcmdpbik7Cj4gKyAgICAgICAgfQo+ICAgCj4gLSAgICAgICAgaWYgKHN0LT5zdXJmYWNl
LT5zdHJlYW1pbmdfbW9kZSAmJiAhc3BpY2Vfc2Vzc2lvbl9pc19wbGF5YmFja19hY3RpdmUocykp
IHsKPiAtICAgICAgICAgICAgQ0hBTk5FTF9ERUJVRyhjaGFubmVsLCAidmlkZW8gbWFyZ2luOiAl
ZCwgc2V0IHRvIDAgc2luY2UgdGhlcmUgaXMgbm8gcGxheWJhY2siLCBtYXJnaW4pOwo+IC0gICAg
ICAgICAgICBtYXJnaW4gPSAwOwo+ICsgICAgICAgIGlmIChtYXJnaW4gPCAwKSB7Cj4gKyAgICAg
ICAgICAgIGdpbnQzMiBudWRnZSA9IC1tYXJnaW47Cj4gKyAgICAgICAgICAgIG1hcmdpbiArPSBu
dWRnZTsKbWFyZ2luID0gMCA/Cj4gKyAgICAgICAgICAgIHN0LT5kZWxheSArPSBudWRnZTsKPiAr
ICAgICAgICAgICAgZnJhbWVfdGltZSA9IHN0cmVhbV90aW1lICsgKGZyYW1lX2ludGVydmFsICsg
MykgLyA0Owo+ICsKPiArICAgICAgICAgICAgLyogVGhlIGRlbGF5IG51ZGdlIGFsc28gaW1wYWN0
cyB0aGUgbWFyZ2luIGhpc3RvcnkgKi8KPiArICAgICAgICAgICAgc3QtPm1pbl9tYXJnaW5fbmV4
dCArPSBudWRnZTsKPiArICAgICAgICAgICAgc3QtPm1pbl9tYXJnaW4gPSBtYXJnaW47Cj4gKyAg
ICAgICAgICAgIHN0LT5hdmdfbWFyZ2luICs9IG51ZGdlOwo+ICsgICAgICAgICAgICBzdC0+bWlu
X2F2Z19tYXJnaW4gKz0gbnVkZ2U7Cj4gKyAgICAgICAgICAgIHN0LT5tYXhfYXZnX21hcmdpbiAr
PSBudWRnZTsKPiArICAgICAgICB9IGVsc2Ugewo+ICsgICAgICAgICAgICAvKiBUcnkgdG8gbWF0
Y2ggdGhlIHRhcmdldCBsYWcgd2l0aG91dCBtYWtpbmcgbmVlZGxlc3MgYWRqdXN0bWVudHMKPiAr
ICAgICAgICAgICAgICogZm9yIG1pbm9yIG9mZnNldHMuCj4gKyAgICAgICAgICAgICAqLwo+ICsg
ICAgICAgICAgICBnaW50MzIgbnVkZ2UgPSAwOwo+ICsgICAgICAgICAgICBpZiAoc3QtPmF2Z19t
YXJnaW4gKyBzdC0+bWFyZ2luX3NwcmVhZCA8IHRhcmdldF9sYWcpIHsKPiArICAgICAgICAgICAg
ICAgIG51ZGdlID0gTUlOKChmcmFtZV9pbnRlcnZhbCArIDMpIC8gNCwKPiArICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHRhcmdldF9sYWcgLSBzdC0+YXZnX21hcmdpbik7Cj4gKyAgICAgICAg
ICAgIH0gZWxzZSBpZiAoc3QtPm1pbl9tYXJnaW4gPiAwICYmCj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgc3QtPmF2Z19tYXJnaW4gID4gdGFyZ2V0X2xhZyArIHN0LT5tYXJnaW5fc3ByZWFkKSB7
Cj4gKyAgICAgICAgICAgICAgICBudWRnZSA9IC1NSU4oKGZyYW1lX2ludGVydmFsICsgMykgLyA0
LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1JTihzdC0+YXZnX21hcmdpbiAtIHRh
cmdldF9sYWcsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0LT5taW5fbWFy
Z2luKSk7Cj4gKyAgICAgICAgICAgIH0KPiArICAgICAgICAgICAgaWYgKG51ZGdlKSB7Cj4gKyAg
ICAgICAgICAgICAgICBzdC0+ZGVsYXkgKz0gbnVkZ2U7Cj4gKyAgICAgICAgICAgICAgICBmcmFt
ZV90aW1lICs9IDA7Cj4gKwo+ICsgICAgICAgICAgICAgICAgLyogVGhlIGRlbGF5IG51ZGdlIGFs
c28gaW1wYWN0cyB0aGUgbWFyZ2luIGhpc3RvcnkgKi8KPiArICAgICAgICAgICAgICAgIHN0LT5t
aW5fbWFyZ2luX25leHQgKz0gbnVkZ2U7Cj4gKyAgICAgICAgICAgICAgICBzdC0+bWluX21hcmdp
biArPSBudWRnZTsKPiArICAgICAgICAgICAgICAgIHN0LT5hdmdfbWFyZ2luICs9IG51ZGdlOwo+
ICsgICAgICAgICAgICAgICAgc3QtPm1pbl9hdmdfbWFyZ2luICs9IG51ZGdlOwo+ICsgICAgICAg
ICAgICAgICAgc3QtPm1heF9hdmdfbWFyZ2luICs9IG51ZGdlOwo+ICsgICAgICAgICAgICB9Cj4g
ICAgICAgICAgIH0KPiAgICAgICB9Cj4gLSAgICBkaXNwbGF5X3N0cmVhbV9zdGF0c19zYXZlKHN0
LCBvcC0+bXVsdGlfbWVkaWFfdGltZSwgbW10aW1lKTsKPiArICAgIHN0LT5sYXN0X2ZyYW1lX3Rp
bWUgPSBmcmFtZV90aW1lOwo+ICAgCj4gICAgICAgLyogTGV0IHRoZSB2aWRlbyBkZWNvZGVyIHF1
ZXVlIHRoZSBmcmFtZXMgc28gaXQgY2FuIG9wdGltaXplIHRoZWlyCj4gICAgICAgICogZGVjb2Rp
bmcgYW5kIGJlc3QgZGVjaWRlIGlmL3doZW4gdG8gZHJvcCB0aGVtIHdoZW4gdGhleSBhcmUgbGF0
ZSwKPiAgICAgICAgKiB0YWtpbmcgaW50byBhY2NvdW50IHRoZSBpbXBhY3Qgb24gbGF0ZXIgZnJh
bWVzLgo+ICAgICAgICAqLwo+IC0gICAgZnJhbWUgPSBzcGljZV9mcmFtZV9uZXcoc3QsIGluLCBv
cC0+bXVsdGlfbWVkaWFfdGltZSk7Cj4gKyAgICBmcmFtZSA9IHNwaWNlX2ZyYW1lX25ldyhzdCwg
aW4sIGZyYW1lX3RpbWUpOwo+ICAgICAgIGlmICghc3QtPnZpZGVvX2RlY29kZXItPnF1ZXVlX2Zy
YW1lKHN0LT52aWRlb19kZWNvZGVyLCBmcmFtZSwgbWFyZ2luKSkgewo+ICAgICAgICAgICBkZXN0
cm95X3N0cmVhbShjaGFubmVsLCBvcC0+aWQpOwo+ICAgICAgICAgICByZXBvcnRfaW52YWxpZF9z
dHJlYW0oY2hhbm5lbCwgb3AtPmlkKTsKPiBAQCAtMTcxOCw3ICsxODU4LDcgQEAgc3RhdGljIHZv
aWQgZGlzcGxheV9oYW5kbGVfc3RyZWFtX2RhdGEoU3BpY2VDaGFubmVsICpjaGFubmVsLCBTcGlj
ZU1zZ0luICppbikKPiAgIAo+ICAgICAgIGlmIChjLT5lbmFibGVfYWRhcHRpdmVfc3RyZWFtaW5n
KSB7Cj4gICAgICAgICAgIGRpc3BsYXlfdXBkYXRlX3N0cmVhbV9yZXBvcnQoU1BJQ0VfRElTUExB
WV9DSEFOTkVMKGNoYW5uZWwpLCBvcC0+aWQsCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBvcC0+bXVsdGlfbWVkaWFfdGltZSwgbWFyZ2luX3JlcG9ydCk7Cj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcC0+bXVsdGlfbWVkaWFfdGltZSwgbW10
aW1lX21hcmdpbik7Cj4gICAgICAgICAgIGlmIChzdC0+cGxheWJhY2tfc3luY19kcm9wc19zZXFf
bGVuID49IFNUUkVBTV9QTEFZQkFDS19TWU5DX0RST1BfU0VRX0xFTl9MSU1JVCkgewo+ICAgICAg
ICAgICAgICAgc3BpY2Vfc2Vzc2lvbl9zeW5jX3BsYXliYWNrX2xhdGVuY3koc3BpY2VfY2hhbm5l
bF9nZXRfc2Vzc2lvbihjaGFubmVsKSk7Cj4gICAgICAgICAgICAgICBzdC0+cGxheWJhY2tfc3lu
Y19kcm9wc19zZXFfbGVuID0gMDsKPiBkaWZmIC0tZ2l0IGEvc3JjL3NwaWNlLXNlc3Npb24tcHJp
di5oIGIvc3JjL3NwaWNlLXNlc3Npb24tcHJpdi5oCj4gaW5kZXggNmVjZTdlMDEuLjc5NGQ4NmE3
IDEwMDY0NAo+IC0tLSBhL3NyYy9zcGljZS1zZXNzaW9uLXByaXYuaAo+ICsrKyBiL3NyYy9zcGlj
ZS1zZXNzaW9uLXByaXYuaAo+IEBAIC01MCw2ICs1MCw3IEBAIEdTb2NrZXRDb25uZWN0aW9uKiBz
cGljZV9zZXNzaW9uX2NoYW5uZWxfb3Blbl9ob3N0KFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbiwgU3Bp
Y2VDCj4gICB2b2lkIHNwaWNlX3Nlc3Npb25fY2hhbm5lbF9uZXcoU3BpY2VTZXNzaW9uICpzZXNz
aW9uLCBTcGljZUNoYW5uZWwgKmNoYW5uZWwpOwo+ICAgdm9pZCBzcGljZV9zZXNzaW9uX2NoYW5u
ZWxfbWlncmF0ZShTcGljZVNlc3Npb24gKnNlc3Npb24sIFNwaWNlQ2hhbm5lbCAqY2hhbm5lbCk7
Cj4gICAKPiArZ3VpbnQzMiBzcGljZV9zZXNzaW9uX2dldF9jbGllbnRfdGltZShTcGljZVNlc3Np
b24gKnNlc3Npb24sIGd1aW50MzIgc3JjX3RpbWUpOwo+ICAgdm9pZCBzcGljZV9zZXNzaW9uX3Nl
dF9tbV90aW1lKFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbiwgZ3VpbnQzMiB0aW1lKTsKPiAgIGd1aW50
MzIgc3BpY2Vfc2Vzc2lvbl9nZXRfbW1fdGltZShTcGljZVNlc3Npb24gKnNlc3Npb24pOwo+ICAg
Cj4gZGlmZiAtLWdpdCBhL3NyYy9zcGljZS1zZXNzaW9uLmMgYi9zcmMvc3BpY2Utc2Vzc2lvbi5j
Cj4gaW5kZXggMDRiYTEyNGEuLjRlNWE3ODIzIDEwMDY0NAo+IC0tLSBhL3NyYy9zcGljZS1zZXNz
aW9uLmMKPiArKysgYi9zcmMvc3BpY2Utc2Vzc2lvbi5jCj4gQEAgLTEwMiw2ICsxMDIsNyBAQCBz
dHJ1Y3QgX1NwaWNlU2Vzc2lvblByaXZhdGUgewo+ICAgICAgIGd1aW50ICAgICAgICAgICAgIGNo
YW5uZWxzX2Rlc3Ryb3lpbmc7Cj4gICAgICAgZ2Jvb2xlYW4gICAgICAgICAgY2xpZW50X3Byb3Zp
ZGVkX3NvY2tldHM7Cj4gICAgICAgZ3VpbnQ2NCAgICAgICAgICAgbW1fdGltZV9vZmZzZXQ7Cj4g
KyAgICBnaW50NjQgICAgICAgICAgICBjbGllbnRfdGltZV9vZmZzZXQ7Cj4gICAgICAgU3BpY2VT
ZXNzaW9uICAgICAgKm1pZ3JhdGlvbjsKPiAgICAgICBHTGlzdCAgICAgICAgICAgICAqbWlncmF0
aW9uX2xlZnQ7Cj4gICAgICAgU3BpY2VTZXNzaW9uTWlncmF0aW9uIG1pZ3JhdGlvbl9zdGF0ZTsK
PiBAQCAtMTI5LDYgKzEzMCwxMCBAQCBzdHJ1Y3QgX1NwaWNlU2Vzc2lvblByaXZhdGUgewo+ICAg
ICAgIFBob2RhdlNlcnZlciAgICAgICp3ZWJkYXY7Cj4gICB9Owo+ICAgCj4gKy8qIEluaXRpYWxp
emUgdGhlIGNsaWVudF90aW1lX29mZnNldCB0byBhbiB1bmxpa2VseSB2YWx1ZS4KPiArICogU2Vl
IHNwaWNlX3Nlc3Npb25fZ2V0X2NsaWVudF90aW1lKCkuCj4gKyAqLwo+ICsjIGRlZmluZSBVTlNF
VF9DTElFTlRfVElNRV9PRkZTRVQgMHhkMWNlY2E1ZQo+ICAgCj4gICAvKioKPiAgICAqIFNFQ1RJ
T046c3BpY2Utc2Vzc2lvbgo+IEBAIC0yOTIsNiArMjk3LDcgQEAgc3RhdGljIHZvaWQgc3BpY2Vf
c2Vzc2lvbl9pbml0KFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbikKPiAgICAgICBTUElDRV9ERUJVRygi
U3VwcG9ydGVkIGNoYW5uZWxzOiAlcyIsIGNoYW5uZWxzKTsKPiAgICAgICBnX2ZyZWUoY2hhbm5l
bHMpOwo+ICAgCj4gKyAgICBzLT5jbGllbnRfdGltZV9vZmZzZXQgPSBVTlNFVF9DTElFTlRfVElN
RV9PRkZTRVQ7Cj4gICAgICAgcy0+aW1hZ2VzID0gY2FjaGVfaW1hZ2VfbmV3KChHRGVzdHJveU5v
dGlmeSlwaXhtYW5faW1hZ2VfdW5yZWYpOwo+ICAgICAgIHMtPmdsel93aW5kb3cgPSBnbHpfZGVj
b2Rlcl93aW5kb3dfbmV3KCk7Cj4gICAgICAgdXBkYXRlX3Byb3h5KHNlc3Npb24sIE5VTEwpOwo+
IEBAIC0yMzg1LDYgKzIzOTEsNDYgQEAgaW50IHNwaWNlX3Nlc3Npb25fZ2V0X2Nvbm5lY3Rpb25f
aWQoU3BpY2VTZXNzaW9uICpzZXNzaW9uKQo+ICAgICAgIHJldHVybiBzLT5jb25uZWN0aW9uX2lk
Owo+ICAgfQo+ICAgCj4gK0dfR05VQ19JTlRFUk5BTAo+ICtndWludDMyIHNwaWNlX3Nlc3Npb25f
Z2V0X2NsaWVudF90aW1lKFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbiwgZ3VpbnQzMiBtbXRpbWUpCgoK
SXQgc2VlbXMgbmFtaW5nIGRvZXMgbm90IGZpdCB0byBhY3Rpb24sIHdvdWxkbid0IGJlIHJlYXNv
bmFibGUKdG8gaW1wbHkgaXQgc2V0cyB0aGUgb2Zmc2V0IHRvbyAob3IgdG8gc2VwYXJhdGUgdG8g
MiBmdW5jdGlvbnMpPyBpCndvdWxkIGV4cGVjdCBnZXQgZnVuY3Rpb24gdG8gZG8gbm90aGluZyBi
dXQgZ2V0dGluZyBhIHZhbHVlCgpTbmlyLgoKPiArewo+ICsgICAgZ19yZXR1cm5fdmFsX2lmX2Zh
aWwoU1BJQ0VfSVNfU0VTU0lPTihzZXNzaW9uKSwgZ19nZXRfbW9ub3RvbmljX3RpbWUoKSk7Cj4g
Kwo+ICsgICAgU3BpY2VTZXNzaW9uUHJpdmF0ZSAqcyA9IHNlc3Npb24tPnByaXY7Cj4gKwo+ICsg
ICAgZ3VpbnQzMiBub3cgPSBnX2dldF9tb25vdG9uaWNfdGltZSgpIC8gMTAwMDsKPiArICAgIGdp
bnQ2NCBuZXdfb2Zmc2V0ID0gbm93IC0gbW10aW1lOwo+ICsKPiArICAgIGlmIChzLT5jbGllbnRf
dGltZV9vZmZzZXQgPT0gVU5TRVRfQ0xJRU5UX1RJTUVfT0ZGU0VUKSB7Cj4gKyAgICAgICAgLyog
SW5pdGlhbGl6ZSB0aGUgdGltZSBvZmZzZXQuCj4gKyAgICAgICAgICogTm90ZSB0aGF0IFVOU0VU
X0NMSUVOVF9USU1FX09GRlNFVCBjYW4gYmUgYW55IHZhbHVlIGluY2x1ZGluZyAwCj4gKyAgICAg
ICAgICogd2hpY2ggaXMgY29tbW9uIG9uIGxvdy1sYXRlbmN5IExBTnMuIEJ1dCBhbiB1bmxpa2Vs
eSBvbmUgaGVscHMgd2hlbgo+ICsgICAgICAgICAqIGFkZGluZyBhIHRyYWNlIGluIHRoaXMgY29k
ZXBhdGguCj4gKyAgICAgICAgICovCj4gKyAgICAgICAgcy0+Y2xpZW50X3RpbWVfb2Zmc2V0ID0g
bmV3X29mZnNldDsKPiArICAgICAgICByZXR1cm4gbm93Owo+ICsgICAgfQo+ICsgICAgaWYgKG5l
d19vZmZzZXQgPCBzLT5jbGllbnRfdGltZV9vZmZzZXQgLSAxMDAwIHx8Cj4gKyAgICAgICAgbmV3
X29mZnNldCA+IHMtPmNsaWVudF90aW1lX29mZnNldCArIDEwMDApIHsKPiArICAgICAgICAvKiBU
aGUgY2hhbmdlIGluIG9mZnNldCB3YXMgbGlrZWx5IGNhdXNlZCBieSBhIHNlcnZlciBtaWdyYXRp
b24uCj4gKyAgICAgICAgICogUmVzZXQgdGhlIHRpbWUgb2Zmc2V0Lgo+ICsgICAgICAgICAqLwo+
ICsgICAgICAgIHMtPmNsaWVudF90aW1lX29mZnNldCA9IG5ld19vZmZzZXQ7Cj4gKyAgICAgICAg
cmV0dXJuIG5vdzsKPiArICAgIH0KPiArICAgIGlmIChuZXdfb2Zmc2V0IDwgcy0+Y2xpZW50X3Rp
bWVfb2Zmc2V0KSB7Cj4gKyAgICAgICAgLyogVGhlIHByZXZpb3VzIG1lc3NhZ2Ugd2UgdXNlZCB0
byBjb21wdXRlIHRoZSBvZmZzZXQgd2FzIHByb2JhYmx5Cj4gKyAgICAgICAgICogZGVsYXllZCBy
ZXN1bHRpbmcgaW4gYSB0b28gbGFyZ2Ugb2Zmc2V0LiBFdmVudHVhbGx5IHRoZSBvZmZzZXQKPiAr
ICAgICAgICAgKiBzaG91bGQgc2V0dGxlIHRvIHRoZSB0cnVlIGNsb2NrIG9mZnNldCBwbHVzIHRo
ZSBuZXR3b3JrIGxhdGVuY3ksCj4gKyAgICAgICAgICogZXhjbHVkaW5nIHRoZSBuZXR3b3JrIGpp
dHRlci4KPiArICAgICAgICAgKi8KPiArICAgICAgICBzLT5jbGllbnRfdGltZV9vZmZzZXQgPSBu
ZXdfb2Zmc2V0Owo+ICsgICAgICAgIHJldHVybiBub3c7Cj4gKyAgICB9Cj4gKwo+ICsgICAgcmV0
dXJuIG1tdGltZSArIHMtPmNsaWVudF90aW1lX29mZnNldDsKPiArfQo+ICsKPiAgIEdfR05VQ19J
TlRFUk5BTAo+ICAgZ3VpbnQzMiBzcGljZV9zZXNzaW9uX2dldF9tbV90aW1lKFNwaWNlU2Vzc2lv
biAqc2Vzc2lvbikKPiAgIHsKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KU3BpY2UtZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVk
ZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L3NwaWNlLWRldmVs
