Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 299969FF37
	for <lists+spice-devel@lfdr.de>; Wed, 28 Aug 2019 12:16:10 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7394789826;
	Wed, 28 Aug 2019 10:16:08 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 002DF89826
 for <spice-devel@lists.freedesktop.org>; Wed, 28 Aug 2019 10:16:06 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx08.intmail.prod.int.phx2.redhat.com
 [10.5.11.23])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 922A0102BB3E;
 Wed, 28 Aug 2019 10:16:06 +0000 (UTC)
Received: from colo-mx.corp.redhat.com
 (colo-mx01.intmail.prod.int.phx2.redhat.com [10.5.11.20])
 by smtp.corp.redhat.com (Postfix) with ESMTPS id 83F34194B2;
 Wed, 28 Aug 2019 10:16:06 +0000 (UTC)
Received: from zmail25.collab.prod.int.phx2.redhat.com
 (zmail25.collab.prod.int.phx2.redhat.com [10.5.83.31])
 by colo-mx.corp.redhat.com (Postfix) with ESMTP id 7948C1802216;
 Wed, 28 Aug 2019 10:16:06 +0000 (UTC)
Date: Wed, 28 Aug 2019 06:16:06 -0400 (EDT)
From: Frediano Ziglio <fziglio@redhat.com>
To: Christophe de Dinechin <christophe.de.dinechin@gmail.com>
Message-ID: <711781474.9841323.1566987366292.JavaMail.zimbra@redhat.com>
In-Reply-To: <m1tva2evs4.fsf@dinechin.org>
References: <20190827092246.10276-1-fziglio@redhat.com>
 <20190827092246.10276-25-fziglio@redhat.com> <m1tva2evs4.fsf@dinechin.org>
MIME-Version: 1.0
X-Originating-IP: [10.33.32.21, 10.4.195.5]
Thread-Topic: usb-backend: Rewrite USB emulation support
Thread-Index: osBhUFd++UKZYtOx2kOwNRbAJyr6ag==
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.23
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.6.2
 (mx1.redhat.com [10.5.110.64]); Wed, 28 Aug 2019 10:16:06 +0000 (UTC)
Subject: Re: [Spice-devel] [PATCH spice-gtk v4 24/29] usb-backend: Rewrite
 USB emulation support
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: spice-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

PiAKPiBGcmVkaWFubyBaaWdsaW8gd3JpdGVzOgo+IAo+ID4gTWFrZSBpbml0aWFsaXNhdGlvbiBl
YXNpZXIuCj4gPiBBbHdheXMgaW5pdGlhbGlzZSBwYXJzZXIuCj4gCj4gTXkgc3BlbGxjaGVja2Vy
IHNlZW1zIHRvIGNob2tlIG9uICJpbml0aWFsaXNlIiwgc3VnZ2VzdHMKPiAiaW5pdGlhbGl6ZSIg
KG1heWJlIGEgVUsvVVMgZGlmZmVyZW5jZSkuCj4gCgpZZXMsIG1pbmUgY29tcGxhaW5zIHRoZSBv
cHBvc2l0ZSA6LSkKTW92ZWQgdG8gVVMgZm9yIGNvbnNpc3RlbmN5IHdpdGggY29kZS4KCj4gPiBJ
bml0aWFsaXNlIGJvdGggcGFyc2VyIGFuZCBob3N0IGR1cmluZyBzcGljZV91c2JfYmFja2VuZF9j
aGFubmVsX25ldy4KPiA+IFN1cHBvcnQgbm90IGhhdmluZyBsaWJ1c2IgY29udGV4dCAobm8gcGh5
c2ljYWwgZGV2aWNlcykuCj4gPiBBdm9pZHMgdG9vIG11Y2ggc3RhdGUgdmFyaWFibGVzLgo+IAo+
ICJSZWR1Y2UgbnVtYmVyIG9mIHN0YXRlIHZhcmlhYmxlcyI/Cj4gCgpZZXMKCj4gQmFzZWQgb24g
dGhlIGNvZGUsIEknZCBnbyBhcyBmYXIgYXMgc3RhdGluZyAiU2ltcGxpZnkgc3RhdGUgbWFjaGlu
ZSBsb2dpYyIuCj4gCj4gPiBwYXJzZXIgaXMgYWx3YXlzIGluaXRpYWxpc2VkIGFmdGVyIGNyZWF0
aW9uIG1ha2luZyBzdXJlIHRoZSBzdGF0ZQo+ID4gaXMgY29uc2lzdGVudC4KPiAKPiBUaGF0IHNl
ZW1zIHJlZHVuZGFudCB3aXRoICJBbHdheXMgaW5pdGlhbGl6ZSBwYXJzZXIiLgo+IAoKSW5kZWVk
LCBpbXByb3ZlZCBjb21taXQgbWVzc2FnZQoKPiAKPiA+IFVzZSBhIHNpbmdsZSBzdGF0ZSB2YXJp
YWJsZSwgZGF0YSBmbG93cyBpbnRvL2Zyb20gYSBzaW5nbGUgcGFyc2VyLgo+ID4KPiA+IFNpZ25l
ZC1vZmYtYnk6IEZyZWRpYW5vIFppZ2xpbyA8ZnppZ2xpb0ByZWRoYXQuY29tPgo+ID4gLS0tCj4g
PiAgc3JjL3VzYi1iYWNrZW5kLmMgfCAyMzYgKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLQo+ID4gIDEgZmlsZSBjaGFuZ2VkLCAxMTYgaW5zZXJ0aW9ucygrKSwg
MTIwIGRlbGV0aW9ucygtKQo+ID4KPiA+IGRpZmYgLS1naXQgYS9zcmMvdXNiLWJhY2tlbmQuYyBi
L3NyYy91c2ItYmFja2VuZC5jCj4gPiBpbmRleCAzNmE3M2E4OS4uZDYxNGU2OTMgMTAwNjQ0Cj4g
PiAtLS0gYS9zcmMvdXNiLWJhY2tlbmQuYwo+ID4gKysrIGIvc3JjL3VzYi1iYWNrZW5kLmMKPiA+
IEBAIC03OCwyMSArNzgsMjEgQEAgc3RydWN0IF9TcGljZVVzYkJhY2tlbmQKPiA+ICAgICAgdWlu
dDMyX3Qgb3duX2RldmljZXNfbWFzazsKPiA+ICB9Owo+ID4KPiA+ICt0eXBlZGVmIGVudW0gewo+
ID4gKyAgICBVU0JfQ0hBTk5FTF9TVEFURV9JTklUSUFMSVpJTkcsCj4gCj4gKFlvdSBzZWVtIHRv
IGhhdmUgdXNlZCAiaW5pdGlhbGl6ZSIgd2l0aCBhICJ6IiBoZXJlKQo+IAo+ID4gKyAgICBVU0Jf
Q0hBTk5FTF9TVEFURV9IT1NULAo+ID4gKyAgICBVU0JfQ0hBTk5FTF9TVEFURV9QQVJTRVIsCj4g
Cj4gSSBjYW4ndCBzYXkgdGhhdCAiU1RBVEVfSE9TVCIgYW5kICJTVEFURV9QQVJTRVIiIG1ha2Ug
bXVjaCBzZW5zZSB0byBtZS4KPiBNYXliZSBzb21ldGhpbmcgbGlrZSAiU1RBVEVfVVNCUkVESVJI
T1NUIiBhbmQgIlNUQVRFX1BBUlNJTkciIG9yCj4gIlNUQVRFX1BBUlNFUl9BQ1RJVkUiPwo+IAoK
SSB3YXMgdGhpbmtpbmcgYWJvdXQgaGF2aW5nIGEgImJvb2wgaW5pdGlhbGl6ZWQiIGFuZCBhICJ1
c2UgdXNicmVkaXJob3N0L3BhcnNlciIKaW5zdGVhZCBvZiBqdXN0IG9uZS4gVGVjaG5pY2FsbHkg
Ym90aCB1c2JyZWRpcmhvc3QgYW5kIHBhcnNlciBhcmUgcGFyc2luZyB0aGUKcGFja2V0cyBhbmQg
YWxzbyBkdXJpbmcgaW5pdGlhbGl6YXRpb24gc28gIlNUQVRFX1BBUlNJTkciIGRvZXMgbm90IG1h
a2Ugc2Vuc2UuClRoZSBkaWZmZXJlbmNlIGlzIHRoYXQgdXNicmVkaXJob3N0IGNvbnN1bWVzIHRo
ZSBwYXJzZWQgbWVzc2FnZXMgImJ5IGhpbXNlbGYiCihpdCBpbXBsZW1lbnRzIHRoZSBwYXJzZXIg
Y2FsbGJhY2tzKSB3aGlsZSBmb3IgZW11bGF0ZWQgZGV2aWNlIHdlIHVzZSBhbm90aGVyCnBhcnNl
ciBhbmQgd2UgcHJvdmlkZXMgdGhlIGNhbGxiYWNrcy4KVGhlIHJlYXNvbiBmb3IgdGhlICJpbml0
aWFsaXppbmciIHN0YXRlIGlzIHRoYXQgdGhlIGluaXRpYWwgaGVsbG8gcGFja2V0IGlzCnF1ZXVl
ZCBpbiBlaXRoZXIgdXNicmVkaXJob3N0ICh3ZSBzdXBwb3J0IHBoeXNpY2FsIGRldmljZXMpIG9y
IHBhcnNlciAobm8KcGh5c2ljYWwgZGV2aWNlcykuCgo+ID4gK30gU3BpY2VVc2JCYWNrZW5kQ2hh
bm5lbFN0YXRlOwo+ID4gKwo+ID4gIHN0cnVjdCBfU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbAo+ID4g
IHsKPiA+ICAgICAgc3RydWN0IHVzYnJlZGlyaG9zdCAqdXNicmVkaXJob3N0Owo+ID4gLSAgICBz
dHJ1Y3QgdXNicmVkaXJob3N0ICpoaWRkZW5faG9zdDsKPiA+ICAgICAgc3RydWN0IHVzYnJlZGly
cGFyc2VyICpwYXJzZXI7Cj4gPiAtICAgIHN0cnVjdCB1c2JyZWRpcnBhcnNlciAqaGlkZGVuX3Bh
cnNlcjsKPiA+ICsgICAgU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbFN0YXRlIHN0YXRlOwo+ID4gICAg
ICB1aW50OF90ICpyZWFkX2J1ZjsKPiA+ICAgICAgaW50IHJlYWRfYnVmX3NpemU7Cj4gPiAgICAg
IHN0cnVjdCB1c2JyZWRpcmZpbHRlcl9ydWxlICpydWxlczsKPiA+ICAgICAgaW50IHJ1bGVzX2Nv
dW50Owo+ID4gLSAgICB1aW50MzJfdCBob3N0X2NhcHM7Cj4gPiAtICAgIHVpbnQzMl90IHBhcnNl
cl9pbml0X2RvbmUgIDogMTsKPiA+IC0gICAgdWludDMyX3QgcGFyc2VyX3dpdGhfaGVsbG8gOiAx
Owo+ID4gLSAgICB1aW50MzJfdCBoZWxsb19kb25lX3BhcnNlciA6IDE7Cj4gPiAtICAgIHVpbnQz
Ml90IGhlbGxvX3NlbnQgICAgICAgIDogMTsKPiA+ICAgICAgdWludDMyX3QgcmVqZWN0ZWQgICAg
ICAgICAgOiAxOwo+ID4gICAgICB1aW50MzJfdCB3YWl0X2Rpc2Nvbm5lY3RfYWNrIDogMTsKPiAK
PiBOaWNlIHNpbXBsaWZpY2F0aW9uIQo+IAo+IFdvdWxkIGl0IG1ha2Ugc2Vuc2UgdG8gdXNlICJi
b29sIiBmb3IgZmxhZ3M/Cj4gCgpJIHByb3Bvc2VkIHRvbyB0byB1c2UgYm9vbHMuCgo+ID4gICAg
ICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmF0dGFjaGVkOwo+ID4gQEAgLTQwNSwxNSArNDA1LDE2
IEBAIGZyb20gYm90aCB0aGUgbWFpbiB0aHJlYWQgYXMgd2VsbCBhcyBmcm9tIHRoZSB1c2IKPiA+
IGV2ZW50IGhhbmRsaW5nIHRocmVhZCAqLwo+ID4gIHN0YXRpYyB2b2lkIHVzYnJlZGlyX3dyaXRl
X2ZsdXNoX2NhbGxiYWNrKHZvaWQgKnVzZXJfZGF0YSkKPiA+ICB7Cj4gPiAgICAgIFNwaWNlVXNi
QmFja2VuZENoYW5uZWwgKmNoID0gdXNlcl9kYXRhOwo+ID4gKyAgICBpZiAoY2gtPnBhcnNlciA9
PSBOVUxMKSB7Cj4gPiArICAgICAgICByZXR1cm47Cj4gPiArICAgIH0KPiA+ICAgICAgaWYgKGlz
X2NoYW5uZWxfcmVhZHkoY2gtPnVzZXJfZGF0YSkpIHsKPiA+IC0gICAgICAgIGlmIChjaC0+dXNi
cmVkaXJob3N0KSB7Cj4gPiArICAgICAgICBpZiAoY2gtPnN0YXRlID09IFVTQl9DSEFOTkVMX1NU
QVRFX0hPU1QpIHsKPiA+ICAgICAgICAgICAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAgLT4gdXNi
cmVkaXJob3N0IiwgX19GVU5DVElPTl9fLCBjaCk7Cj4gPiAgICAgICAgICAgICAgdXNicmVkaXJo
b3N0X3dyaXRlX2d1ZXN0X2RhdGEoY2gtPnVzYnJlZGlyaG9zdCk7Cj4gPiAtICAgICAgICB9IGVs
c2UgaWYgKGNoLT5wYXJzZXIpIHsKPiA+ICsgICAgICAgIH0gZWxzZSB7Cj4gPiAgICAgICAgICAg
ICAgU1BJQ0VfREVCVUcoIiVzIGNoICVwIC0+IHBhcnNlciIsIF9fRlVOQ1RJT05fXywgY2gpOwo+
ID4gICAgICAgICAgICAgIHVzYnJlZGlycGFyc2VyX2RvX3dyaXRlKGNoLT5wYXJzZXIpOwo+ID4g
LSAgICAgICAgfSBlbHNlIHsKPiA+IC0gICAgICAgICAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAg
KE5PVCBBQ1RJVkUpIiwgX19GVU5DVElPTl9fLCBjaCk7Cj4gPiAgICAgICAgICB9Cj4gPiAgICAg
IH0gZWxzZSB7Cj4gPiAgICAgICAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAgKG5vdCByZWFkeSki
LCBfX0ZVTkNUSU9OX18sIGNoKTsKPiA+IEBAIC02NzMsMjEgKzY3NCw0MiBAQCBzdGF0aWMgdm9p
ZCB1c2JyZWRpcl9sb2codm9pZCAqdXNlcl9kYXRhLCBpbnQgbGV2ZWwsCj4gPiBjb25zdCBjaGFy
ICptc2cpCj4gPiAgICAgIH0KPiA+ICB9Cj4gPgo+ID4gK3N0YXRpYyBzdHJ1Y3QgdXNicmVkaXJw
YXJzZXIgKmNyZWF0ZV9wYXJzZXIoU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gpOwo+ID4gKwo+
ID4gIHN0YXRpYyBpbnQgdXNicmVkaXJfd3JpdGVfY2FsbGJhY2sodm9pZCAqdXNlcl9kYXRhLCB1
aW50OF90ICpkYXRhLCBpbnQKPiA+ICBjb3VudCkKPiA+ICB7Cj4gPiAgICAgIFNwaWNlVXNiQmFj
a2VuZENoYW5uZWwgKmNoID0gdXNlcl9kYXRhOwo+ID4gICAgICBpbnQgcmVzOwo+ID4gICAgICBT
UElDRV9ERUJVRygiJXMgY2ggJXAsICVkIGJ5dGVzIiwgX19GVU5DVElPTl9fLCBjaCwgY291bnQp
Owo+ID4gLSAgICBpZiAoIWNoLT5oZWxsb19zZW50KSB7Cj4gPiAtICAgICAgICAvKiBoZWxsbyBp
cyBzaG9ydCBoZWFkZXIgKDEyKSArIGhlbGxvIHN0cnVjdCAoNjQpICsgY2FwYWJpbGl0aWVzCj4g
PiAoNCkgKi8KPiA+IC0gICAgICAgIGludCBoZWxsb19zaXplID0gc2l6ZW9mKHN0cnVjdCB1c2Jf
cmVkaXJfaGVhZGVyKSArIHNpemVvZihzdHJ1Y3QKPiA+IHVzYl9yZWRpcl9oZWxsb19oZWFkZXIp
Owo+ID4gLSAgICAgICAgY2gtPmhlbGxvX3NlbnQgPSAxOwo+ID4gLSAgICAgICAgaWYgKGNvdW50
ID09IGhlbGxvX3NpemUpIHsKPiA+IC0gICAgICAgICAgICBtZW1jcHkoJmNoLT5ob3N0X2NhcHMs
IGRhdGEgKyBoZWxsb19zaXplIC0KPiA+IHNpemVvZihjaC0+aG9zdF9jYXBzKSwKPiA+IC0gICAg
ICAgICAgICAgICAgICAgc2l6ZW9mKGNoLT5ob3N0X2NhcHMpKTsKPiA+IC0gICAgICAgICAgICBT
UElDRV9ERUJVRygiJXMgY2ggJXAsIHNlbmRpbmcgZmlyc3QgaGVsbG8sIGNhcHMgJTA4WCIsCj4g
PiAtICAgICAgICAgICAgICAgICAgICAgICAgX19GVU5DVElPTl9fLCBjaCwgY2gtPmhvc3RfY2Fw
cyk7Cj4gPiArCj4gPiArICAgIC8vIGhhbmRsZSBmaXJzdCBwYWNrZXQgKEhFTExPKSBjcmVhdGlu
ZyBwYXJzZXIgZnJvbSBjYXBhYmlsaXRpZXMKPiA+ICsgICAgaWYgKFNQSUNFX1VOTElLRUxZKGNo
LT5wYXJzZXIgPT0gTlVMTCkpIHsKPiA+ICsgICAgICAgIC8vIHdlIGFyZSBzdGlsbCBpbml0aWFs
aXppbmcgdGhlIGhvc3QKPiA+ICsgICAgICAgIGlmIChjaC0+dXNicmVkaXJob3N0ID09IE5VTEwp
IHsKPiA+ICsgICAgICAgICAgICByZXR1cm4gMDsKPiA+ICAgICAgICAgIH0KPiA+ICsKPiA+ICsg
ICAgICAgIGNoLT5wYXJzZXIgPSBjcmVhdGVfcGFyc2VyKGNoKTsKPiA+ICsgICAgICAgIGlmICgh
Y2gtPnBhcnNlcikgewo+ID4gKyAgICAgICAgICAgIHJldHVybiAwOwo+ID4gKyAgICAgICAgfQo+
ID4gKwo+ID4gKyAgICAgICAgLyogaGVsbG8gaXMgc2hvcnQgaGVhZGVyICgxMikgKyBoZWxsbyBz
dHJ1Y3QgKDY0KSAqLwo+ID4gKyAgICAgICAgY29uc3QgaW50IGhlbGxvX3NpemUgPSAxMiArIHNp
emVvZihzdHJ1Y3QgdXNiX3JlZGlyX2hlbGxvX2hlYWRlcik7Cj4gPiArICAgICAgICBnX2Fzc2Vy
dChjb3VudCA+PSBoZWxsb19zaXplICsgNCk7Cj4gPiArICAgICAgICBnX2Fzc2VydChTUElDRV9B
TElHTkVEX0NBU1Qoc3RydWN0IHVzYl9yZWRpcl9oZWFkZXIgKiwgZGF0YSktPnR5cGUKPiA+ID09
IHVzYl9yZWRpcl9oZWxsbyk7Cj4gPiArCj4gPiArICAgICAgICBjb25zdCB1aW50MzJfdCBmbGFn
cyA9Cj4gPiArICAgICAgICAgICAgdXNicmVkaXJwYXJzZXJfZmxfd3JpdGVfY2Jfb3duc19idWZm
ZXIgfAo+ID4gdXNicmVkaXJwYXJzZXJfZmxfdXNiX2hvc3QgfAo+ID4gKyAgICAgICAgICAgIHVz
YnJlZGlycGFyc2VyX2ZsX25vX2hlbGxvOwo+ID4gKwo+ID4gKyAgICAgICAgdXNicmVkaXJwYXJz
ZXJfaW5pdChjaC0+cGFyc2VyLAo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQUNL
QUdFX1NUUklORywKPiA+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgU1BJQ0VfQUxJR05F
RF9DQVNUKHVpbnQzMl90ICosIGRhdGEgKwo+ID4gaGVsbG9fc2l6ZSksCj4gPiArICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIChjb3VudCAtIGhlbGxvX3NpemUpIC8gc2l6ZW9mKHVpbnQzMl90
KSwKPiA+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3MpOwo+ID4gKwo+ID4gKyAg
ICAgICAgcmV0dXJuIDA7Cj4gCj4gV2h5IHJldHVybiAwIGFuZCBub3QganVzdCBmYWxsIHRocm91
Z2g/Cj4gSWYgYSB3cml0ZSByZXRyeSBpcyBuZWNlc3NhcnksIGNvdWxkIHlvdSBhZGQgYSBjb21t
ZW50IGV4cGxhaW5pbmcgd2h5Pwo+IAoKYWRkZWQgYSBjb21tZW50Cgo+IFNpZGUgY29tbWVudDog
dXNicmVkaXJfd3JpdGVfY2FsbGJhY2sgdXNlZCB0byBiZSBhIG1lcmUgd3JhcHBlciBhcm91bmQK
PiBzcGljZV91c2JyZWRpcl93cml0ZV9jYWxsYmFjay4gTm93LCBpdCBoYXMgYSB3aG9sZSBsb3Qg
b2YgbG9naWMgaW4gaXQuCj4gSXMgaXQgaW50ZW50aW9uYWwsIG9yIHNob3VsZCBzb21lIG9mIHRo
YXQgbG9naWMgYmUgbW92ZWQgdG8gc2hhcmVkIGNvZGU/Cj4gCgpZZXMsIGludGVudGlvbmFsIChv
dGhlcndpc2Ugd2h5IGNoYW5naW5nIHRoZSBjb2RlPykuClRoaXMgY29kZSBpcyBub3Qgc2hhcmVk
IHdpdGggYW55dGhpbmcuIFRoZSBvbmx5IHJlYXNvbiB0byBwdXQgaW4gYSBzZXBhcmF0ZQpmdW5j
dGlvbiBpcyBzZXBhcmF0aW9uLCBub3Qgc2hhcmluZy4KSSBoYXZlIHRoZSBmZWVsaW5nIEkgZGlk
bid0IGdldCB3aGF0IHlvdSB3YW50ZWQgdG8gc2F5LgoKPiAKPiA+ICAgICAgfQo+ID4gICAgICBy
ZXMgPSBzcGljZV91c2JyZWRpcl93cml0ZV9jYWxsYmFjayhjaC0+dXNlcl9kYXRhLCBkYXRhLCBj
b3VudCk7Cj4gPiAgICAgIHJldHVybiByZXM7Cj4gPiBAQCAtNzA3LDMxICs3MjksMzMgQEAgaW50
Cj4gPiBzcGljZV91c2JfYmFja2VuZF9yZWFkX2d1ZXN0X2RhdGEoU3BpY2VVc2JCYWNrZW5kQ2hh
bm5lbCAqY2gsIHVpbnQ4X3QKPiA+ICpkYXRhLAo+ID4KPiA+ICAgICAgY2gtPnJlYWRfYnVmID0g
ZGF0YTsKPiA+ICAgICAgY2gtPnJlYWRfYnVmX3NpemUgPSBjb3VudDsKPiA+IC0gICAgaWYgKGNo
LT51c2JyZWRpcmhvc3QpIHsKPiA+IC0gICAgICAgIHJlcyA9IHVzYnJlZGlyaG9zdF9yZWFkX2d1
ZXN0X2RhdGEoY2gtPnVzYnJlZGlyaG9zdCk7Cj4gPiAtICAgICAgICBpZiAoIWNoLT5oZWxsb19k
b25lX3BhcnNlcikgewo+ID4gLSAgICAgICAgICAgIGludCByZXNfcGFyc2VyOwo+ID4gKyAgICBp
ZiAoU1BJQ0VfVU5MSUtFTFkoY2gtPnN0YXRlID09IFVTQl9DSEFOTkVMX1NUQVRFX0lOSVRJQUxJ
WklORykpIHsKPiA+ICsgICAgICAgIGlmIChjaC0+dXNicmVkaXJob3N0ICE9IE5VTEwpIHsKPiA+
ICsgICAgICAgICAgICByZXMgPSB1c2JyZWRpcmhvc3RfcmVhZF9ndWVzdF9kYXRhKGNoLT51c2Jy
ZWRpcmhvc3QpOwo+ID4gKyAgICAgICAgICAgIGlmIChyZXMgIT0gMCkgewo+ID4gKyAgICAgICAg
ICAgICAgICByZXR1cm4gcmVzOwo+ID4gKyAgICAgICAgICAgIH0KPiA+ICsgICAgICAgICAgICBj
aC0+c3RhdGUgPSBVU0JfQ0hBTk5FTF9TVEFURV9IT1NUOwo+ID4gKwo+ID4gICAgICAgICAgICAg
IC8qIHVzYnJlZGlyaG9zdCBzaG91bGQgY29uc3VtZSBoZWxsbyByZXNwb25zZSAqLwo+ID4gICAg
ICAgICAgICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKGNoLT5yZWFkX2J1ZiA9PSBOVUxMLAo+ID4g
ICAgICAgICAgICAgIFVTQl9SRURJUl9FUlJPUl9SRUFEX1BBUlNFKTsKPiA+ICsgICAgICAgIH0g
ZWxzZSB7Cj4gPiArICAgICAgICAgICAgY2gtPnN0YXRlID0gVVNCX0NIQU5ORUxfU1RBVEVfUEFS
U0VSOwo+ID4gKyAgICAgICAgfQo+ID4KPiA+IC0gICAgICAgICAgICBjaC0+cmVhZF9idWYgPSBk
YXRhOwo+ID4gLSAgICAgICAgICAgIGNoLT5yZWFkX2J1Zl9zaXplID0gY291bnQ7Cj4gPiAtICAg
ICAgICAgICAgY2gtPmhlbGxvX2RvbmVfcGFyc2VyID0gMTsKPiA+IC0gICAgICAgICAgICBpZiAo
Y2gtPmF0dGFjaGVkICYmIGNoLT5hdHRhY2hlZC0+ZWRldikgewo+ID4gLSAgICAgICAgICAgICAg
ICAvKiBjYXNlIG9mIENEIHNoYXJpbmcgb24gY29ubmVjdCAqLwo+ID4gLSAgICAgICAgICAgICAg
ICBjaC0+dXNicmVkaXJob3N0ID0gTlVMTDsKPiA+IC0gICAgICAgICAgICAgICAgY2gtPnBhcnNl
ciA9IGNoLT5oaWRkZW5fcGFyc2VyOwo+ID4gLSAgICAgICAgICAgICAgICBTUElDRV9ERUJVRygi
JXM6IHN3aXRjaCAlcCB0byBwYXJzZXIiLCBfX0ZVTkNUSU9OX18sIGNoKTsKPiA+IC0gICAgICAg
ICAgICB9Cj4gPiAtICAgICAgICAgICAgcmVzX3BhcnNlciA9IHVzYnJlZGlycGFyc2VyX2RvX3Jl
YWQoY2gtPmhpZGRlbl9wYXJzZXIpOwo+ID4gLSAgICAgICAgICAgIGlmIChyZXMgPj0gMCkgewo+
ID4gLSAgICAgICAgICAgICAgICByZXMgPSByZXNfcGFyc2VyOwo+ID4gLSAgICAgICAgICAgIH0K
PiA+ICsgICAgICAgIGNoLT5yZWFkX2J1ZiA9IGRhdGE7Cj4gPiArICAgICAgICBjaC0+cmVhZF9i
dWZfc2l6ZSA9IGNvdW50Owo+ID4gKyAgICAgICAgaWYgKGNoLT5hdHRhY2hlZCAmJiBjaC0+YXR0
YWNoZWQtPmVkZXYpIHsKPiA+ICsgICAgICAgICAgICAvKiBjYXNlIG9mIENEIHNoYXJpbmcgb24g
Y29ubmVjdCAqLwo+ID4gKyAgICAgICAgICAgIGNoLT5zdGF0ZSA9IFVTQl9DSEFOTkVMX1NUQVRF
X1BBUlNFUjsKPiA+ICsgICAgICAgICAgICBTUElDRV9ERUJVRygiJXM6IHN3aXRjaCAlcCB0byBw
YXJzZXIiLCBfX0ZVTkNUSU9OX18sIGNoKTsKPiA+ICAgICAgICAgIH0KPiA+IC0gICAgfSBlbHNl
IGlmIChjaC0+cGFyc2VyKSB7Cj4gPiAtICAgICAgICByZXMgPSB1c2JyZWRpcnBhcnNlcl9kb19y
ZWFkKGNoLT5wYXJzZXIpOwo+ID4gKyAgICAgICAgcmV0dXJuIHVzYnJlZGlycGFyc2VyX2RvX3Jl
YWQoY2gtPnBhcnNlcik7Cj4gPiArICAgIH0KPiA+ICsgICAgaWYgKGNoLT5zdGF0ZSA9PSBVU0Jf
Q0hBTk5FTF9TVEFURV9IT1NUKSB7Cj4gPiArICAgICAgICByZXMgPSB1c2JyZWRpcmhvc3RfcmVh
ZF9ndWVzdF9kYXRhKGNoLT51c2JyZWRpcmhvc3QpOwo+ID4gICAgICB9IGVsc2Ugewo+ID4gLSAg
ICAgICAgcmVzID0gVVNCX1JFRElSX0VSUk9SX0lPOwo+ID4gKyAgICAgICAgcmVzID0gdXNicmVk
aXJwYXJzZXJfZG9fcmVhZChjaC0+cGFyc2VyKTsKPiA+ICAgICAgfQo+ID4gICAgICBzd2l0Y2gg
KHJlcykKPiA+ICAgICAgewo+ID4gQEAgLTc4MywxNCArODA3LDEyIEBAIEdFcnJvciAqc3BpY2Vf
dXNiX2JhY2tlbmRfZ2V0X2Vycm9yX2RldGFpbHMoaW50Cj4gPiBlcnJvcl9jb2RlLCBnY2hhciAq
ZGVzYykKPiA+Cj4gPiAgdm9pZCBzcGljZV91c2JfYmFja2VuZF9yZXR1cm5fd3JpdGVfZGF0YShT
cGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCwgdm9pZAo+ID4gICpkYXRhKQo+ID4gIHsKPiA+IC0g
ICAgaWYgKGNoLT51c2JyZWRpcmhvc3QpIHsKPiA+ICsgICAgaWYgKGNoLT5zdGF0ZSA9PSBVU0Jf
Q0hBTk5FTF9TVEFURV9IT1NUKSB7Cj4gPiAgICAgICAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAg
LT4gdXNicmVkaXJob3N0IiwgX19GVU5DVElPTl9fLCBjaCk7Cj4gPiAgICAgICAgICB1c2JyZWRp
cmhvc3RfZnJlZV93cml0ZV9idWZmZXIoY2gtPnVzYnJlZGlyaG9zdCwgZGF0YSk7Cj4gPiAtICAg
IH0gZWxzZSBpZiAoY2gtPnBhcnNlcikgewo+ID4gKyAgICB9IGVsc2Ugewo+ID4gICAgICAgICAg
U1BJQ0VfREVCVUcoIiVzIGNoICVwIC0+IHBhcnNlciIsIF9fRlVOQ1RJT05fXywgY2gpOwo+ID4g
ICAgICAgICAgdXNicmVkaXJwYXJzZXJfZnJlZV93cml0ZV9idWZmZXIoY2gtPnBhcnNlciwgZGF0
YSk7Cj4gPiAtICAgIH0gZWxzZSB7Cj4gPiAtICAgICAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAg
LSBOT0JPRFkgVE8gQ0FMTCIsIF9fRlVOQ1RJT05fXywgY2gpOwo+ID4gICAgICB9Cj4gPiAgfQo+
ID4KPiA+IEBAIC0xMDA1LDEwICsxMDI3LDEwIEBAIHN0YXRpYyB2b2lkIHVzYnJlZGlyX2Rldmlj
ZV9kaXNjb25uZWN0X2Fjayh2b2lkCj4gPiAqcHJpdikKPiA+ICB7Cj4gPiAgICAgIFNwaWNlVXNi
QmFja2VuZENoYW5uZWwgKmNoID0gcHJpdjsKPiA+ICAgICAgU1BJQ0VfREVCVUcoIiVzIGNoICVw
IiwgX19GVU5DVElPTl9fLCBjaCk7Cj4gPiAtICAgIGlmIChjaC0+cGFyc2VyICYmIGNoLT53YWl0
X2Rpc2Nvbm5lY3RfYWNrKSB7Cj4gPiAtICAgICAgICBjaC0+cGFyc2VyID0gTlVMTDsKPiA+ICsg
ICAgaWYgKGNoLT5zdGF0ZSA9PSBVU0JfQ0hBTk5FTF9TVEFURV9QQVJTRVIgJiYgY2gtPnVzYnJl
ZGlyaG9zdCAhPSBOVUxMCj4gPiAmJgo+ID4gKyAgICAgICAgY2gtPndhaXRfZGlzY29ubmVjdF9h
Y2spIHsKPiA+ICsgICAgICAgIGNoLT5zdGF0ZSA9IFVTQl9DSEFOTkVMX1NUQVRFX0hPU1Q7Cj4g
PiAgICAgICAgICBTUElDRV9ERUJVRygiJXMgc3dpdGNoIHRvIHVzYnJlZGlyaG9zdCIsIF9fRlVO
Q1RJT05fXyk7Cj4gPiAtICAgICAgICBjaC0+dXNicmVkaXJob3N0ID0gY2gtPmhpZGRlbl9ob3N0
Owo+ID4gICAgICB9Cj4gPiAgICAgIGNoLT53YWl0X2Rpc2Nvbm5lY3RfYWNrID0gMDsKPiA+ICB9
Cj4gPiBAQCAtMTAyNyw5ICsxMDQ5LDYgQEAgdXNicmVkaXJfaGVsbG8odm9pZCAqcHJpdiwgc3Ry
dWN0Cj4gPiB1c2JfcmVkaXJfaGVsbG9faGVhZGVyICpoZWxsbykKPiA+ICAgICAgU1BJQ0VfREVC
VUcoIiVzICVwICVzYXR0YWNoZWQgJXMiLCBfX0ZVTkNUSU9OX18sIGNoLAo+ID4gICAgICAgICAg
ZWRldiA/ICIiIDogIm5vdCAiLCAgaGVsbG8gPyAiIiA6ICIoaW50ZXJuYWwpIik7Cj4gPgo+ID4g
LSAgICBpZiAoaGVsbG8pIHsKPiA+IC0gICAgICAgIGNoLT5oZWxsb19kb25lX3BhcnNlciA9IDE7
Cj4gPiAtICAgIH0KPiA+ICAgICAgaWYgKCFlZGV2KSB7Cj4gPiAgICAgICAgICByZXR1cm47Cj4g
PiAgICAgIH0KPiA+IEBAIC0xMDc5LDUzICsxMDk4LDI0IEBAIHVzYnJlZGlyX2hlbGxvKHZvaWQg
KnByaXYsIHN0cnVjdAo+ID4gdXNiX3JlZGlyX2hlbGxvX2hlYWRlciAqaGVsbG8pCj4gPiAgICAg
IHVzYnJlZGlyX3dyaXRlX2ZsdXNoX2NhbGxiYWNrKGNoKTsKPiA+ICB9Cj4gPgo+ID4gLXN0YXRp
YyB2b2lkIGluaXRpYWxpemVfcGFyc2VyKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLCBnYm9v
bGVhbgo+ID4gZG9faGVsbG8pCj4gPiArc3RhdGljIHZvaWQgaW5pdGlhbGl6ZV9wYXJzZXIoU3Bp
Y2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gpCj4gPiAgewo+ID4gICAgICB1aW50MzJfdCBmbGFncywg
Y2Fwc1tVU0JfUkVESVJfQ0FQU19TSVpFXSA9IHsgMCB9Owo+ID4KPiA+IC0gICAgZ19yZXR1cm5f
aWZfZmFpbChjaC0+aGlkZGVuX3BhcnNlciAhPSBOVUxMKTsKPiA+IC0gICAgaWYgKGNoLT5wYXJz
ZXJfaW5pdF9kb25lKSB7Cj4gPiAtICAgICAgICBpZiAoY2gtPnBhcnNlcl93aXRoX2hlbGxvICE9
IGRvX2hlbGxvKSB7Cj4gPiAtICAgICAgICAgICAgZ19yZXR1cm5faWZfcmVhY2hlZCgpOwo+ID4g
LSAgICAgICAgfQo+ID4gLSAgICAgICAgcmV0dXJuOwo+ID4gLSAgICB9Cj4gPiArICAgIGdfYXNz
ZXJ0KGNoLT51c2JyZWRpcmhvc3QgPT0gTlVMTCk7Cj4gPgo+ID4gLSAgICBjaC0+cGFyc2VyX2lu
aXRfZG9uZSA9IDE7Cj4gPiAtICAgIGNoLT5wYXJzZXJfd2l0aF9oZWxsbyA9IGRvX2hlbGxvOwo+
ID4gICAgICBmbGFncyA9IHVzYnJlZGlycGFyc2VyX2ZsX3dyaXRlX2NiX293bnNfYnVmZmVyIHwK
PiA+ICAgICAgdXNicmVkaXJwYXJzZXJfZmxfdXNiX2hvc3Q7Cj4gPgo+ID4gLSAgICBpZiAoZG9f
aGVsbG8pIHsKPiA+IC0gICAgICAgIGNoLT5oZWxsb19zZW50ID0gMTsKPiA+IC0gICAgICAgIGNo
LT5ob3N0X2NhcHMgfD0gMSA8PCB1c2JfcmVkaXJfY2FwX2Nvbm5lY3RfZGV2aWNlX3ZlcnNpb247
Cj4gPiAtICAgICAgICBjaC0+aG9zdF9jYXBzIHw9IDEgPDwgdXNiX3JlZGlyX2NhcF9kZXZpY2Vf
ZGlzY29ubmVjdF9hY2s7Cj4gPiAtICAgICAgICBjaC0+aG9zdF9jYXBzIHw9IDEgPDwgdXNiX3Jl
ZGlyX2NhcF9lcF9pbmZvX21heF9wYWNrZXRfc2l6ZTsKPiA+IC0gICAgICAgIGNoLT5ob3N0X2Nh
cHMgfD0gMSA8PCB1c2JfcmVkaXJfY2FwXzY0Yml0c19pZHM7Cj4gPiAtICAgICAgICBjaC0+aG9z
dF9jYXBzIHw9IDEgPDwgdXNiX3JlZGlyX2NhcF8zMmJpdHNfYnVsa19sZW5ndGg7Cj4gPiAtICAg
IH0gZWxzZSB7Cj4gPiAtICAgICAgICBmbGFncyB8PSB1c2JyZWRpcnBhcnNlcl9mbF9ub19oZWxs
bzsKPiA+IC0gICAgfQo+ID4gLQo+ID4gLSAgICBpZiAoY2gtPmhvc3RfY2FwcyAmICgxIDw8IHVz
Yl9yZWRpcl9jYXBfY29ubmVjdF9kZXZpY2VfdmVyc2lvbikpIHsKPiA+IC0gICAgICAgIHVzYnJl
ZGlycGFyc2VyX2NhcHNfc2V0X2NhcChjYXBzLAo+ID4gdXNiX3JlZGlyX2NhcF9jb25uZWN0X2Rl
dmljZV92ZXJzaW9uKTsKPiA+IC0gICAgfQo+ID4gKyAgICB1c2JyZWRpcnBhcnNlcl9jYXBzX3Nl
dF9jYXAoY2FwcywKPiA+IHVzYl9yZWRpcl9jYXBfY29ubmVjdF9kZXZpY2VfdmVyc2lvbik7Cj4g
PiAgICAgIHVzYnJlZGlycGFyc2VyX2NhcHNfc2V0X2NhcChjYXBzLCB1c2JfcmVkaXJfY2FwX2Zp
bHRlcik7Cj4gPiAtICAgIGlmIChjaC0+aG9zdF9jYXBzICYgKDEgPDwgdXNiX3JlZGlyX2NhcF9k
ZXZpY2VfZGlzY29ubmVjdF9hY2spKSB7Cj4gPiAtICAgICAgICB1c2JyZWRpcnBhcnNlcl9jYXBz
X3NldF9jYXAoY2FwcywKPiA+IHVzYl9yZWRpcl9jYXBfZGV2aWNlX2Rpc2Nvbm5lY3RfYWNrKTsK
PiA+IC0gICAgfQo+ID4gLSAgICBpZiAoY2gtPmhvc3RfY2FwcyAmICgxIDw8IHVzYl9yZWRpcl9j
YXBfZXBfaW5mb19tYXhfcGFja2V0X3NpemUpKSB7Cj4gPiAtICAgICAgICB1c2JyZWRpcnBhcnNl
cl9jYXBzX3NldF9jYXAoY2FwcywKPiA+IHVzYl9yZWRpcl9jYXBfZXBfaW5mb19tYXhfcGFja2V0
X3NpemUpOwo+ID4gLSAgICB9Cj4gPiAtICAgIGlmIChjaC0+aG9zdF9jYXBzICYgKDEgPDwgdXNi
X3JlZGlyX2NhcF82NGJpdHNfaWRzKSkgewo+ID4gLSAgICAgICAgdXNicmVkaXJwYXJzZXJfY2Fw
c19zZXRfY2FwKGNhcHMsIHVzYl9yZWRpcl9jYXBfNjRiaXRzX2lkcyk7Cj4gPiAtICAgIH0KPiA+
IC0gICAgaWYgKGNoLT5ob3N0X2NhcHMgJiAoMSA8PCB1c2JfcmVkaXJfY2FwXzMyYml0c19idWxr
X2xlbmd0aCkpIHsKPiA+IC0gICAgICAgIHVzYnJlZGlycGFyc2VyX2NhcHNfc2V0X2NhcChjYXBz
LAo+ID4gdXNiX3JlZGlyX2NhcF8zMmJpdHNfYnVsa19sZW5ndGgpOwo+ID4gLSAgICB9Cj4gPiAt
ICAgIGlmIChjaC0+aG9zdF9jYXBzICYgKDEgPDwgdXNiX3JlZGlyX2NhcF9idWxrX3N0cmVhbXMp
KSB7Cj4gPiAtICAgICAgICB1c2JyZWRpcnBhcnNlcl9jYXBzX3NldF9jYXAoY2FwcywgdXNiX3Jl
ZGlyX2NhcF9idWxrX3N0cmVhbXMpOwo+ID4gLSAgICB9Cj4gPiAtICAgIHVzYnJlZGlycGFyc2Vy
X2luaXQoY2gtPmhpZGRlbl9wYXJzZXIsIFBBQ0tBR0VfU1RSSU5HLCBjYXBzLAo+ID4gVVNCX1JF
RElSX0NBUFNfU0laRSwgZmxhZ3MpOwo+ID4gKyAgICB1c2JyZWRpcnBhcnNlcl9jYXBzX3NldF9j
YXAoY2FwcywKPiA+IHVzYl9yZWRpcl9jYXBfZGV2aWNlX2Rpc2Nvbm5lY3RfYWNrKTsKPiA+ICsg
ICAgdXNicmVkaXJwYXJzZXJfY2Fwc19zZXRfY2FwKGNhcHMsCj4gPiB1c2JfcmVkaXJfY2FwX2Vw
X2luZm9fbWF4X3BhY2tldF9zaXplKTsKPiA+ICsgICAgdXNicmVkaXJwYXJzZXJfY2Fwc19zZXRf
Y2FwKGNhcHMsIHVzYl9yZWRpcl9jYXBfNjRiaXRzX2lkcyk7Cj4gPiArICAgIHVzYnJlZGlycGFy
c2VyX2NhcHNfc2V0X2NhcChjYXBzLCB1c2JfcmVkaXJfY2FwXzMyYml0c19idWxrX2xlbmd0aCk7
Cj4gPiArICAgIHVzYnJlZGlycGFyc2VyX2NhcHNfc2V0X2NhcChjYXBzLCB1c2JfcmVkaXJfY2Fw
X2J1bGtfcmVjZWl2aW5nKTsKPiA+ICsgICAgdXNicmVkaXJwYXJzZXJfY2Fwc19zZXRfY2FwKGNh
cHMsIHVzYl9yZWRpcl9jYXBfYnVsa19zdHJlYW1zKTsKPiA+ICsKPiA+ICsgICAgdXNicmVkaXJw
YXJzZXJfaW5pdChjaC0+cGFyc2VyLCBQQUNLQUdFX1NUUklORywgY2FwcywKPiA+IFVTQl9SRURJ
Ul9DQVBTX1NJWkUsIGZsYWdzKTsKPiA+ICB9Cj4gPgo+ID4gIC8qCj4gPiBAQCAtMTE4MCw3ICsx
MTcwLDcgQEAgc3RhdGljIGdib29sZWFuIGF0dGFjaF9lZGV2KFNwaWNlVXNiQmFja2VuZENoYW5u
ZWwKPiA+ICpjaCwKPiA+ICAgICAgICAgICAgIF8oIkZhaWxlZCB0byByZWRpcmVjdCBkZXZpY2Ug
JWQiKSwgMSk7Cj4gPiAgICAgICAgICByZXR1cm4gRkFMU0U7Cj4gPiAgICAgIH0KPiA+IC0gICAg
aWYgKGNoLT51c2JyZWRpcmhvc3QgJiYgIWNoLT5oZWxsb19kb25lX3BhcnNlcikgewo+ID4gKyAg
ICBpZiAoY2gtPnN0YXRlID09IFVTQl9DSEFOTkVMX1NUQVRFX0lOSVRJQUxJWklORykgewo+ID4g
ICAgICAgICAgLyoKPiA+ICAgICAgICAgICAgICB3ZSBjYW4ndCBpbml0aWFsaXplIHBhcnNlciB1
bnRpbCB3ZSBzZWUgaGVsbG8gZnJvbSB1c2JyZWRpcgo+ID4gICAgICAgICAgICAgIGFuZCB0aGUg
cGFyc2VyIGNhbid0IHdvcmsgdW50aWwgaXQgc2VlcyB0aGUgaGVsbG8gcmVzcG9uc2UuCj4gPiBA
QCAtMTE5MCwxNSArMTE4MCwxMyBAQCBzdGF0aWMgZ2Jvb2xlYW4gYXR0YWNoX2VkZXYoU3BpY2VV
c2JCYWNrZW5kQ2hhbm5lbAo+ID4gKmNoLAo+ID4gICAgICAgICAgU1BJQ0VfREVCVUcoIiVzIHdh
aXRpbmcgdW50aWwgdGhlIGNoYW5uZWwgaXMgcmVhZHkiLAo+ID4gICAgICAgICAgX19GVU5DVElP
Tl9fKTsKPiA+Cj4gPiAgICAgIH0gZWxzZSB7Cj4gPiAtICAgICAgICBpbml0aWFsaXplX3BhcnNl
cihjaCwgY2gtPmhpZGRlbl9ob3N0ID09IE5VTEwpOwo+ID4gLSAgICAgICAgY2gtPnVzYnJlZGly
aG9zdCA9IE5VTEw7Cj4gPiAtICAgICAgICBjaC0+cGFyc2VyID0gY2gtPmhpZGRlbl9wYXJzZXI7
Cj4gPiArICAgICAgICBjaC0+c3RhdGUgPSBVU0JfQ0hBTk5FTF9TVEFURV9QQVJTRVI7Cj4gPiAg
ICAgIH0KPiA+ICAgICAgY2gtPndhaXRfZGlzY29ubmVjdF9hY2sgPSAwOwo+ID4gICAgICBjaC0+
YXR0YWNoZWQgPSBkZXY7Cj4gPiAgICAgIGRldi0+YXR0YWNoZWRfdG8gPSBjaDsKPiA+IC0gICAg
ZGV2aWNlX29wcyhkZXYtPmVkZXYpLT5hdHRhY2goZGV2LT5lZGV2LCBjaC0+aGlkZGVuX3BhcnNl
cik7Cj4gPiAtICAgIGlmIChjaC0+aGVsbG9fZG9uZV9wYXJzZXIpIHsKPiA+ICsgICAgZGV2aWNl
X29wcyhkZXYtPmVkZXYpLT5hdHRhY2goZGV2LT5lZGV2LCBjaC0+cGFyc2VyKTsKPiA+ICsgICAg
aWYgKGNoLT5zdGF0ZSA9PSBVU0JfQ0hBTk5FTF9TVEFURV9QQVJTRVIpIHsKPiA+ICAgICAgICAg
IC8qIHNlbmQgZGV2aWNlIGluZm8gKi8KPiA+ICAgICAgICAgIHVzYnJlZGlyX2hlbGxvKGNoLCBO
VUxMKTsKPiA+ICAgICAgfQo+ID4gQEAgLTEyMTgsOSArMTIwNiwxNSBAQCBnYm9vbGVhbgo+ID4g
c3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9hdHRhY2goU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAq
Y2gsCj4gPiAgICAgICAgICByZXR1cm4gYXR0YWNoX2VkZXYoY2gsIGRldiwgZXJyb3IpOwo+ID4g
ICAgICB9Cj4gPgo+ID4gKyAgICAvLyBubyBwaHlzaWNhbCBkZXZpY2UgZW5hYmxlZAo+ID4gKyAg
ICBpZiAoY2gtPnVzYnJlZGlyaG9zdCA9PSBOVUxMKSB7Cj4gPiArICAgICAgICByZXR1cm4gRkFM
U0U7Cj4gPiArICAgIH0KPiA+ICsKPiA+ICAgICAgbGlidXNiX2RldmljZV9oYW5kbGUgKmhhbmRs
ZSA9IE5VTEw7Cj4gPiAtICAgIGNoLT51c2JyZWRpcmhvc3QgPSBjaC0+aGlkZGVuX2hvc3Q7Cj4g
PiAtICAgIGNoLT5wYXJzZXIgPSBOVUxMOwo+ID4gKyAgICBpZiAoY2gtPnN0YXRlICE9IFVTQl9D
SEFOTkVMX1NUQVRFX0lOSVRJQUxJWklORykgewo+ID4gKyAgICAgICAgY2gtPnN0YXRlID0gVVNC
X0NIQU5ORUxfU1RBVEVfSE9TVDsKPiA+ICsgICAgfQo+ID4KPiA+ICAgICAgLyoKPiA+ICAgICAg
ICAgVW5kZXIgV2luZG93cyB3ZSBuZWVkIHRvIGF2b2lkIHVwZGF0aW5nCj4gPiBAQCAtMTI2MSwx
MCArMTI1NSwxMCBAQCB2b2lkCj4gPiBzcGljZV91c2JfYmFja2VuZF9jaGFubmVsX2RldGFjaChT
cGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCkKPiA+ICAgICAgICAgIFNQSUNFX0RFQlVHKCIlczog
bm90aGluZyB0byBkZXRhY2giLCBfX0ZVTkNUSU9OX18pOwo+ID4gICAgICAgICAgcmV0dXJuOwo+
ID4gICAgICB9Cj4gPiAtICAgIGlmIChjaC0+dXNicmVkaXJob3N0KSB7Cj4gPiArICAgIGlmIChj
aC0+c3RhdGUgPT0gVVNCX0NIQU5ORUxfU1RBVEVfSE9TVCkgewo+ID4gICAgICAgICAgLyogaXQg
d2lsbCBjYWxsIGxpYnVzYl9jbG9zZSBpbnRlcm5hbGx5ICovCj4gPiAgICAgICAgICB1c2JyZWRp
cmhvc3Rfc2V0X2RldmljZShjaC0+dXNicmVkaXJob3N0LCBOVUxMKTsKPiA+IC0gICAgfSBlbHNl
IGlmIChjaC0+cGFyc2VyKSB7Cj4gPiArICAgIH0gZWxzZSB7Cj4gPiAgICAgICAgICBpZiAoZWRl
dikgewo+ID4gICAgICAgICAgICAgIGRldmljZV9vcHMoZWRldiktPmRldGFjaChlZGV2KTsKPiA+
ICAgICAgICAgIH0KPiA+IEBAIC0xMjcyLDkgKzEyNjYsOCBAQCB2b2lkCj4gPiBzcGljZV91c2Jf
YmFja2VuZF9jaGFubmVsX2RldGFjaChTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCkKPiA+ICAg
ICAgICAgIHVzYnJlZGlyX3dyaXRlX2ZsdXNoX2NhbGxiYWNrKGNoKTsKPiA+ICAgICAgICAgIGNo
LT53YWl0X2Rpc2Nvbm5lY3RfYWNrID0KPiA+ICAgICAgICAgICAgICB1c2JyZWRpcnBhcnNlcl9w
ZWVyX2hhc19jYXAoY2gtPnBhcnNlciwKPiA+ICAgICAgICAgICAgICB1c2JfcmVkaXJfY2FwX2Rl
dmljZV9kaXNjb25uZWN0X2Fjayk7Cj4gPiAtICAgICAgICBpZiAoIWNoLT53YWl0X2Rpc2Nvbm5l
Y3RfYWNrKSB7Cj4gPiAtICAgICAgICAgICAgY2gtPnVzYnJlZGlyaG9zdCA9IGNoLT5oaWRkZW5f
aG9zdDsKPiA+IC0gICAgICAgICAgICBjaC0+cGFyc2VyID0gTlVMTDsKPiA+ICsgICAgICAgIGlm
ICghY2gtPndhaXRfZGlzY29ubmVjdF9hY2sgJiYgY2gtPnVzYnJlZGlyaG9zdCAhPSBOVUxMKSB7
Cj4gPiArICAgICAgICAgICAgY2gtPnN0YXRlID0gVVNCX0NIQU5ORUxfU1RBVEVfSE9TVDsKPiA+
ICAgICAgICAgIH0KPiA+ICAgICAgfQo+ID4gICAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAsIGRl
dGFjaCBkb25lIiwgX19GVU5DVElPTl9fLCBjaCk7Cj4gPiBAQCAtMTMxMSwxNiArMTMwNCwyMiBA
QCBTcGljZVVzYkJhY2tlbmRDaGFubmVsCj4gPiAqc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9u
ZXcoU3BpY2VVc2JCYWNrZW5kICpiZSwKPiA+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdXNicmVkaXJwYXJzZXJfd2FybmluZywKPiA+ICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHVzYnJlZGlyaG9zdF9mbF93cml0ZV9jYl9vd25zX2J1ZmZlcik7
Cj4gPiAgICAgICAgICBnX3dhcm5faWZfZmFpbChjaC0+dXNicmVkaXJob3N0ICE9IE5VTEwpOwo+
ID4gKyAgICAgICAgaWYgKGNoLT51c2JyZWRpcmhvc3QgIT0gTlVMTCkgewo+ID4gKyAgICAgICAg
ICAgIHVzYnJlZGlyaG9zdF9zZXRfYnVmZmVyZWRfb3V0cHV0X3NpemVfY2IoY2gtPnVzYnJlZGly
aG9zdCwKPiA+ICsKPiA+IHVzYnJlZGlyX2J1ZmZlcmVkX291dHB1dF9zaXplX2NhbGxiYWNrKTsK
PiA+ICsgICAgICAgICAgICAvLyBmb3JjZSBmbHVzaCBvZiBIRUxMTyBwYWNrZXQgYW5kIGNyZWF0
aW9uIG9mIHBhcnNlcgo+ID4gKyAgICAgICAgICAgIHVzYnJlZGlyaG9zdF93cml0ZV9ndWVzdF9k
YXRhKGNoLT51c2JyZWRpcmhvc3QpOwo+ID4gKyAgICAgICAgfQo+ID4gKyAgICB9IGVsc2Ugewo+
ID4gKyAgICAgICAgLy8gbm8gcGh5c2ljYWwgZGV2aWNlIHN1cHBvcnQsIG9ubHkgZW11bGF0ZWQs
IGNyZWF0ZSB0aGUKPiA+ICsgICAgICAgIC8vIHBhcnNlcgo+ID4gKyAgICAgICAgY2gtPnBhcnNl
ciA9IGNyZWF0ZV9wYXJzZXIoY2gpOwo+ID4gKyAgICAgICAgaWYgKGNoLT5wYXJzZXIgIT0gTlVM
TCkgewo+ID4gKyAgICAgICAgICAgIGluaXRpYWxpemVfcGFyc2VyKGNoKTsKPiA+ICsgICAgICAg
IH0KPiA+ICAgICAgfQo+ID4KPiA+IC0gICAgaWYgKGNoLT51c2JyZWRpcmhvc3QpIHsKPiA+IC0g
ICAgICAgIGNoLT5oaWRkZW5fcGFyc2VyID0gY3JlYXRlX3BhcnNlcihjaCk7Cj4gPiAtICAgICAg
ICBjaC0+aGlkZGVuX2hvc3QgPSBjaC0+dXNicmVkaXJob3N0Owo+ID4gLSAgICAgICAgdXNicmVk
aXJob3N0X3NldF9idWZmZXJlZF9vdXRwdXRfc2l6ZV9jYihjaC0+dXNicmVkaXJob3N0LAo+ID4g
LQo+ID4gdXNicmVkaXJfYnVmZmVyZWRfb3V0cHV0X3NpemVfY2FsbGJhY2spOwo+ID4gLSAgICB9
Cj4gPiAtCj4gPiAtICAgIGlmICghY2gtPmhpZGRlbl9wYXJzZXIpIHsKPiA+ICsgICAgaWYgKCFj
aC0+cGFyc2VyKSB7Cj4gPiAgICAgICAgICBzcGljZV91c2JfYmFja2VuZF9jaGFubmVsX2RlbGV0
ZShjaCk7Cj4gPiAgICAgICAgICBjaCA9IE5VTEw7Cj4gPiAgICAgIH0KPiA+IEBAIC0xMzMyLDEy
ICsxMzMxLDkgQEAgU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbAo+ID4gKnNwaWNlX3VzYl9iYWNrZW5k
X2NoYW5uZWxfbmV3KFNwaWNlVXNiQmFja2VuZCAqYmUsCj4gPiAgdm9pZCBzcGljZV91c2JfYmFj
a2VuZF9jaGFubmVsX2ZsdXNoX3dyaXRlcyhTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCkKPiA+
ICB7Cj4gPiAgICAgIFNQSUNFX0RFQlVHKCIlcyAlcCBpcyB1cCIsIF9fRlVOQ1RJT05fXywgY2gp
Owo+ID4gLSAgICBpZiAoY2gtPnVzYnJlZGlyaG9zdCkgewo+ID4gKyAgICBpZiAoY2gtPnN0YXRl
ICE9IFVTQl9DSEFOTkVMX1NUQVRFX1BBUlNFUiAmJiBjaC0+dXNicmVkaXJob3N0ICE9IE5VTEwp
Cj4gPiB7Cj4gPiAgICAgICAgICB1c2JyZWRpcmhvc3Rfd3JpdGVfZ3Vlc3RfZGF0YShjaC0+dXNi
cmVkaXJob3N0KTsKPiA+IC0gICAgICAgIGluaXRpYWxpemVfcGFyc2VyKGNoLCBGQUxTRSk7Cj4g
PiAgICAgIH0gZWxzZSB7Cj4gPiAtICAgICAgICBpbml0aWFsaXplX3BhcnNlcihjaCwgVFJVRSk7
Cj4gPiAtICAgICAgICBjaC0+cGFyc2VyID0gY2gtPmhpZGRlbl9wYXJzZXI7Cj4gPiAgICAgICAg
ICB1c2JyZWRpcnBhcnNlcl9kb193cml0ZShjaC0+cGFyc2VyKTsKPiA+ICAgICAgfQo+ID4gIH0K
PiA+IEBAIC0xMzQ4LDExICsxMzQ0LDExIEBAIHZvaWQKPiA+IHNwaWNlX3VzYl9iYWNrZW5kX2No
YW5uZWxfZGVsZXRlKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoKQo+ID4gICAgICBpZiAoIWNo
KSB7Cj4gPiAgICAgICAgICByZXR1cm47Cj4gPiAgICAgIH0KPiA+IC0gICAgaWYgKGNoLT5oaWRk
ZW5faG9zdCkgewo+ID4gLSAgICAgICAgdXNicmVkaXJob3N0X2Nsb3NlKGNoLT5oaWRkZW5faG9z
dCk7Cj4gPiArICAgIGlmIChjaC0+dXNicmVkaXJob3N0KSB7Cj4gPiArICAgICAgICB1c2JyZWRp
cmhvc3RfY2xvc2UoY2gtPnVzYnJlZGlyaG9zdCk7Cj4gPiAgICAgIH0KPiA+IC0gICAgaWYgKGNo
LT5oaWRkZW5fcGFyc2VyKSB7Cj4gPiAtICAgICAgICB1c2JyZWRpcnBhcnNlcl9kZXN0cm95KGNo
LT5oaWRkZW5fcGFyc2VyKTsKPiA+ICsgICAgaWYgKGNoLT5wYXJzZXIpIHsKPiA+ICsgICAgICAg
IHVzYnJlZGlycGFyc2VyX2Rlc3Ryb3koY2gtPnBhcnNlcik7Cj4gPiAgICAgIH0KPiA+Cj4gPiAg
ICAgIGlmIChjaC0+cnVsZXMpIHsKPiA+IEBAIC0xMzcyLDcgKzEzNjgsNyBAQAo+ID4gc3BpY2Vf
dXNiX2JhY2tlbmRfY2hhbm5lbF9nZXRfZ3Vlc3RfZmlsdGVyKFNwaWNlVXNiQmFja2VuZENoYW5u
ZWwgKmNoLAo+ID4gICAgICBpbnQgaTsKPiA+ICAgICAgKnIgPSBOVUxMOwo+ID4gICAgICAqY291
bnQgPSAwOwo+ID4gLSAgICBpZiAoY2gtPnVzYnJlZGlyaG9zdCkgewo+ID4gKyAgICBpZiAoY2gt
PnVzYnJlZGlyaG9zdCAhPSBOVUxMKSB7Cj4gPiAgICAgICAgICB1c2JyZWRpcmhvc3RfZ2V0X2d1
ZXN0X2ZpbHRlcihjaC0+dXNicmVkaXJob3N0LCByLCBjb3VudCk7Cj4gPiAgICAgIH0KPiA+ICAg
ICAgaWYgKCpyID09IE5VTEwpIHsKPiAKClRoZXJlIGFyZSBzdGlsbCBzb21lIG1pbm9yIHdlaXJk
bmVzcyBpbiB0aGUgaW5pdGlhbCBwYXRjaC4KTGlrZSB3aHkgdXNicmVkaXJfaGVsbG8gaXMgY2Fs
bGVkIHdpdGggYSBOVUxMIHBhcmFtZXRlciBpbnN0ZWFkIG9mIGhhdmluZwphIHNlcGFyYXRlICJp
bml0aWFsaXplX2VkZXYiIG9yIHNpbWlsYXIuCk9yIHdoeSBwYXJzZXIgY29kZSBjYWxscyBhIGxv
dCB1c2JyZWRpcl93cml0ZV9mbHVzaF9jYWxsYmFjayB3aGljaCB3YXMgCnByZXZpb3VzbHkgY2Fs
bGVkIG9ubHkgYnkgdXNicmVkaXJob3N0IGFuZCBpcyBzdXBwb3NlZCB0byBkaXNwYXRjaCBiZXR3
ZWVuCnVzYnJlZGlyaG9zdCBvciBwYXJzZXIgd2h5IGZyb20gdGhlIHBhcnNlciBpcyBjYWxsZWQg
b25seSB0byBmbHVzaCBmcm9tCnBhcnNlciBpZiBjaGFubmVsIGlzIHJlYWR5LgoKRnJlZGlhbm8K
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KU3BpY2UtZGV2
ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
