Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id AAFFA83562
	for <lists+spice-devel@lfdr.de>; Tue,  6 Aug 2019 17:35:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B4F076E3D8;
	Tue,  6 Aug 2019 15:35:06 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail-wr1-f54.google.com (mail-wr1-f54.google.com
 [209.85.221.54])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 57CA36E3D8
 for <spice-devel@lists.freedesktop.org>; Tue,  6 Aug 2019 15:35:05 +0000 (UTC)
Received: by mail-wr1-f54.google.com with SMTP id p13so13776098wru.10
 for <spice-devel@lists.freedesktop.org>; Tue, 06 Aug 2019 08:35:05 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=tQ0SSfxExKm2Bb0gYP0L6MXyKhZ+VKOOFpCVfqosBfg=;
 b=dd8hOucnxtBkIVPakbZvVvNqR7evOQk8/d0jOaX6itrwaFhzrsukZpd+tnIR6Kt5Ls
 9FReb0rj6Bl3UZLCDMRBMDa3VO60qzPk537/5IdumX4lw3oRDxfV3FrNYMRtjqW+8Ojv
 MIY67rKZbqgoEp4R6bm5zmspQePR6XEOlizG6ZYNkLIC6yOA4HKenYe3F8q/EDJ3LaU+
 QchDqLUBTBXbp33d2L1dE8bLzohbxrqdl8pOMUBZyccaClydiO/WylAWULhhdFfQ+1Zv
 aLjL2btIObD+GShiUR17cJ/bbih+pobjIoOsyoAJd0Xxk3aimvTN1DWRyRJ4mpd0rK05
 D2Cg==
X-Gm-Message-State: APjAAAUurbJJ5dTgQh72GGakq8le1krvZS85OMCIqafLISmnwFsXFDT9
 aqVn/lE/5xpemVrgGBFhnRCQpGeaCzt29Q==
X-Google-Smtp-Source: APXvYqynaZYi2U/XMZRN3gF2107jL/MTuw/bwv8iNqLfvUWy5pYLLB+dEn/LQxfkvdwGPpzvay+2jQ==
X-Received: by 2002:a05:6000:112:: with SMTP id
 o18mr5650129wrx.153.1565105703622; 
 Tue, 06 Aug 2019 08:35:03 -0700 (PDT)
Received: from pinea.redhat.com (25.119.19.109.rev.sfr.net. [109.19.119.25])
 by smtp.gmail.com with ESMTPSA id y18sm84860282wmi.23.2019.08.06.08.35.02
 for <spice-devel@lists.freedesktop.org>
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Tue, 06 Aug 2019 08:35:03 -0700 (PDT)
From: Kevin Pouget <kpouget@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Tue,  6 Aug 2019 17:34:51 +0200
Message-Id: <20190806153453.20616-8-kpouget@redhat.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190806153453.20616-1-kpouget@redhat.com>
References: <20190806153453.20616-1-kpouget@redhat.com>
MIME-Version: 1.0
Subject: [Spice-devel] [RFC spice-streaming-agent 4/4] concrete-agent:
 prioritize requested codec for plugin selection
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

VGhpcyBwYXRjaCBnaXZlcyBtb3JlIHByaW9yaXR5IHRvIHRoZSByZXF1ZXN0ZWQgdmlkZW8gY29k
ZWNzIHdoZW4Kc2VsZWN0aW5nIHRoZSBGcmFtZUNhcHR1cmUgcGx1Z2luLCBpbnN0ZWFkIG9mIGl0
cyBoYXJkLWNvZGVkIHJhbmsuCgpUaGUgY2xpZW50X2NvZGVjcyBzdG9yYWdlIHN0cnVjdHVyZSBp
cyBjaGFuZ2VkIGZyb20gJ3NldCcgdG8gJ3ZlY3RvcicsCmFzIHRoZSBjb2RlYyBvcmRlciBpcyBu
b3QgcHJlc2VydmVkIGJ5IHRoZSBzZXQgc3RydWN0dXJlLi4KClNpZ25lZC1vZmYtYnk6IEtldmlu
IFBvdWdldCA8a3BvdWdldEByZWRoYXQuY29tPgotLS0KIHNyYy9jb25jcmV0ZS1hZ2VudC5jcHAg
ICAgICAgIHwgMzggKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0KIHNyYy9jb25j
cmV0ZS1hZ2VudC5ocHAgICAgICAgIHwgIDIgKy0KIHNyYy9zcGljZS1zdHJlYW1pbmctYWdlbnQu
Y3BwIHwgIDIgKy0KIHNyYy9zdHJlYW0tcG9ydC5jcHAgICAgICAgICAgIHwgIDIgKy0KIHNyYy9z
dHJlYW0tcG9ydC5ocHAgICAgICAgICAgIHwgIDQgKystLQogNSBmaWxlcyBjaGFuZ2VkLCAyNCBp
bnNlcnRpb25zKCspLCAyNCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9zcmMvY29uY3JldGUt
YWdlbnQuY3BwIGIvc3JjL2NvbmNyZXRlLWFnZW50LmNwcAppbmRleCAzMzZiZDA5Li42ODNmYTI2
IDEwMDY0NAotLS0gYS9zcmMvY29uY3JldGUtYWdlbnQuY3BwCisrKyBiL3NyYy9jb25jcmV0ZS1h
Z2VudC5jcHAKQEAgLTExMSw3ICsxMTEsNyBAQCB2b2lkIENvbmNyZXRlQWdlbnQ6OkxvYWRQbHVn
aW4oY29uc3Qgc3RkOjpzdHJpbmcgJnBsdWdpbl9maWxlbmFtZSkKICAgICB9CiB9CiAKLUZyYW1l
Q2FwdHVyZSAqQ29uY3JldGVBZ2VudDo6R2V0QmVzdEZyYW1lQ2FwdHVyZShjb25zdCBzdGQ6OnNl
dDxTcGljZVZpZGVvQ29kZWNUeXBlPiYgY29kZWNzKQorRnJhbWVDYXB0dXJlICpDb25jcmV0ZUFn
ZW50OjpHZXRCZXN0RnJhbWVDYXB0dXJlKGNvbnN0IHN0ZDo6dmVjdG9yPFNwaWNlVmlkZW9Db2Rl
Y1R5cGU+JiBjb2RlY3MpCiB7CiAgICAgc3RkOjp2ZWN0b3I8c3RkOjpwYWlyPHVuc2lnbmVkLCBz
dGQ6OnNoYXJlZF9wdHI8UGx1Z2luPj4+IHNvcnRlZF9wbHVnaW5zOwogCkBAIC0xMjEsMjQgKzEy
MSwyNCBAQCBGcmFtZUNhcHR1cmUgKkNvbmNyZXRlQWdlbnQ6OkdldEJlc3RGcmFtZUNhcHR1cmUo
Y29uc3Qgc3RkOjpzZXQ8U3BpY2VWaWRlb0NvZGVjVAogICAgIH0KICAgICBzb3J0KHNvcnRlZF9w
bHVnaW5zLnJiZWdpbigpLCBzb3J0ZWRfcGx1Z2lucy5yZW5kKCkpOwogCi0gICAgLy8gcmV0dXJu
IGZpcnN0IG5vdCBudWxsCi0gICAgZm9yIChjb25zdCBhdXRvJiBwbHVnaW46IHNvcnRlZF9wbHVn
aW5zKSB7Ci0gICAgICAgIGlmIChwbHVnaW4uZmlyc3QgPT0gRG9udFVzZSkgewotICAgICAgICAg
ICAgYnJlYWs7Ci0gICAgICAgIH0KLSAgICAgICAgLy8gY2hlY2sgY2xpZW50IHN1cHBvcnRzIHRo
ZSBjb2RlYwotICAgICAgICBpZiAoY29kZWNzLmZpbmQocGx1Z2luLnNlY29uZC0+VmlkZW9Db2Rl
Y1R5cGUoKSkgPT0gY29kZWNzLmVuZCgpKQotICAgICAgICAgICAgY29udGludWU7Ci0KLSAgICAg
ICAgRnJhbWVDYXB0dXJlICpjYXB0dXJlOwotICAgICAgICB0cnkgewotICAgICAgICAgICAgY2Fw
dHVyZSA9IHBsdWdpbi5zZWNvbmQtPkNyZWF0ZUNhcHR1cmUoKTsKLSAgICAgICAgfSBjYXRjaCAo
Y29uc3Qgc3RkOjpleGNlcHRpb24gJmVycikgewotICAgICAgICAgICAgc3lzbG9nKExPR19FUlIs
ICJFcnJvciBjcmVhdGluZyBjYXB0dXJlIGVuZ2luZTogJXMiLCBlcnIud2hhdCgpKTsKLSAgICAg
ICAgICAgIGNvbnRpbnVlOwotICAgICAgICB9Ci0gICAgICAgIGlmIChjYXB0dXJlKSB7Ci0gICAg
ICAgICAgICByZXR1cm4gY2FwdHVyZTsKKyAgICBmb3IgKGNvbnN0IGF1dG8mIGNvZGVjX3R5cGU6
IGNvZGVjcykgeworICAgICAgICAvLyBmaW5kIHRoZSBwbHVnaW4gd2l0aCB0aGUgaGlnaGVzdCBy
YW5rIGZvciB0aGlzIGNvZGVjIHR5cGUKKyAgICAgICAgZm9yIChjb25zdCBhdXRvJiBwbHVnaW46
IHNvcnRlZF9wbHVnaW5zKSB7CisgICAgICAgICAgICBpZiAocGx1Z2luLmZpcnN0ID09IERvbnRV
c2UpIHsKKyAgICAgICAgICAgICAgICBjb250aW51ZTsKKyAgICAgICAgICAgIH0KKworICAgICAg
ICAgICAgLy8gY2hlY2sgY2xpZW50IHN1cHBvcnRzIHRoZSBjb2RlYworICAgICAgICAgICAgaWYg
KHBsdWdpbi5zZWNvbmQtPlZpZGVvQ29kZWNUeXBlKCkgIT0gY29kZWNfdHlwZSkgeworICAgICAg
ICAgICAgICAgIGNvbnRpbnVlOworICAgICAgICAgICAgfQorCisgICAgICAgICAgICB0cnkgewor
ICAgICAgICAgICAgICAgIHJldHVybiBwbHVnaW4uc2Vjb25kLT5DcmVhdGVDYXB0dXJlKCk7Cisg
ICAgICAgICAgICB9IGNhdGNoIChjb25zdCBzdGQ6OmV4Y2VwdGlvbiAmZXJyKSB7CisgICAgICAg
ICAgICAgICAgc3lzbG9nKExPR19FUlIsICJFcnJvciBjcmVhdGluZyBjYXB0dXJlIGVuZ2luZTog
JXMiLCBlcnIud2hhdCgpKTsKKyAgICAgICAgICAgICAgICBjb250aW51ZTsKKyAgICAgICAgICAg
IH0KICAgICAgICAgfQogICAgIH0KICAgICByZXR1cm4gbnVsbHB0cjsKZGlmZiAtLWdpdCBhL3Ny
Yy9jb25jcmV0ZS1hZ2VudC5ocHAgYi9zcmMvY29uY3JldGUtYWdlbnQuaHBwCmluZGV4IDZkMWJl
MzUuLjAzOTliYWIgMTAwNjQ0Ci0tLSBhL3NyYy9jb25jcmV0ZS1hZ2VudC5ocHAKKysrIGIvc3Jj
L2NvbmNyZXRlLWFnZW50LmhwcApAQCAtMzMsNyArMzMsNyBAQCBwdWJsaWM6CiAgICAgdm9pZCBS
ZWdpc3Rlcihjb25zdCBzdGQ6OnNoYXJlZF9wdHI8UGx1Z2luPiYgcGx1Z2luKSBvdmVycmlkZTsK
ICAgICBjb25zdCBDb25maWd1cmVPcHRpb24qIE9wdGlvbnMoKSBjb25zdCBvdmVycmlkZTsKICAg
ICB2b2lkIExvYWRQbHVnaW5zKGNvbnN0IHN0ZDo6c3RyaW5nICZkaXJlY3RvcnkpOwotICAgIEZy
YW1lQ2FwdHVyZSAqR2V0QmVzdEZyYW1lQ2FwdHVyZShjb25zdCBzdGQ6OnNldDxTcGljZVZpZGVv
Q29kZWNUeXBlPiYgY29kZWNzKTsKKyAgICBGcmFtZUNhcHR1cmUgKkdldEJlc3RGcmFtZUNhcHR1
cmUoY29uc3Qgc3RkOjp2ZWN0b3I8U3BpY2VWaWRlb0NvZGVjVHlwZT4mIGNvZGVjcyk7CiAgICAg
X19hdHRyaWJ1dGVfXyAoKGZvcm1hdCAocHJpbnRmLCAyLCAzKSkpCiAgICAgdm9pZCBMb2dTdGF0
KGNvbnN0IGNoYXIqIGZvcm1hdCwgLi4uKSBvdmVycmlkZTsKIHByaXZhdGU6CmRpZmYgLS1naXQg
YS9zcmMvc3BpY2Utc3RyZWFtaW5nLWFnZW50LmNwcCBiL3NyYy9zcGljZS1zdHJlYW1pbmctYWdl
bnQuY3BwCmluZGV4IGQyNzRiNWYuLjE1YzI3MzIgMTAwNjQ0Ci0tLSBhL3NyYy9zcGljZS1zdHJl
YW1pbmctYWdlbnQuY3BwCisrKyBiL3NyYy9zcGljZS1zdHJlYW1pbmctYWdlbnQuY3BwCkBAIC0x
MjgsNyArMTI4LDcgQEAgcHJpdmF0ZToKIHN0YXRpYyBib29sIGNhcHR1cmVfaW5fcHJvZ3Jlc3Mg
PSBmYWxzZTsKIHN0YXRpYyBib29sIHJlc2V0X3JlcXVlc3RlZCA9IGZhbHNlOwogc3RhdGljIGJv
b2wgcXVpdF9yZXF1ZXN0ZWQgPSBmYWxzZTsKLXN0YXRpYyBzdGQ6OnNldDxTcGljZVZpZGVvQ29k
ZWNUeXBlPiBjbGllbnRfY29kZWNzOworc3RhdGljIHN0ZDo6dmVjdG9yPFNwaWNlVmlkZW9Db2Rl
Y1R5cGU+IGNsaWVudF9jb2RlY3M7CiAKIHN0YXRpYyBib29sIGhhdmVfc29tZXRoaW5nX3RvX3Jl
YWQoU3RyZWFtUG9ydCAmc3RyZWFtX3BvcnQsIGJvb2wgYmxvY2tpbmcpCiB7CmRpZmYgLS1naXQg
YS9zcmMvc3RyZWFtLXBvcnQuY3BwIGIvc3JjL3N0cmVhbS1wb3J0LmNwcAppbmRleCAyNjcwMTIw
Li4wZDA4ZDUwIDEwMDY0NAotLS0gYS9zcmMvc3RyZWFtLXBvcnQuY3BwCisrKyBiL3NyYy9zdHJl
YW0tcG9ydC5jcHAKQEAgLTQzLDcgKzQzLDcgQEAgU3RhcnRTdG9wTWVzc2FnZSBJbmJvdW5kTWVz
c2FnZTo6Z2V0X3BheWxvYWQ8U3RhcnRTdG9wTWVzc2FnZT4oKQogICAgIH0KIAogICAgIGZvciAo
c2l6ZV90IGkgPSAxOyBpIDw9IGRhdGFbMF07ICsraSkgewotICAgICAgICBtc2cuY2xpZW50X2Nv
ZGVjcy5pbnNlcnQoKFNwaWNlVmlkZW9Db2RlY1R5cGUpIGRhdGFbaV0pOworICAgICAgICBtc2cu
Y2xpZW50X2NvZGVjcy5wdXNoX2JhY2soKFNwaWNlVmlkZW9Db2RlY1R5cGUpIGRhdGFbaV0pOwog
ICAgIH0KIAogICAgIHJldHVybiBtc2c7CmRpZmYgLS1naXQgYS9zcmMvc3RyZWFtLXBvcnQuaHBw
IGIvc3JjL3N0cmVhbS1wb3J0LmhwcAppbmRleCAwODQ3M2Y3Li5iMmY3NTIwIDEwMDY0NAotLS0g
YS9zcmMvc3RyZWFtLXBvcnQuaHBwCisrKyBiL3NyYy9zdHJlYW0tcG9ydC5ocHAKQEAgLTE2LDcg
KzE2LDcgQEAKICNpbmNsdWRlIDxzdHJpbmc+CiAjaW5jbHVkZSA8bWVtb3J5PgogI2luY2x1ZGUg
PG11dGV4PgotI2luY2x1ZGUgPHNldD4KKyNpbmNsdWRlIDx2ZWN0b3I+CiAKIAogbmFtZXNwYWNl
IHNwaWNlIHsKQEAgLTQ1LDcgKzQ1LDcgQEAgcHVibGljOgogc3RydWN0IFN0YXJ0U3RvcE1lc3Nh
Z2UKIHsKICAgICBib29sIHN0YXJ0X3N0cmVhbWluZyA9IGZhbHNlOwotICAgIHN0ZDo6c2V0PFNw
aWNlVmlkZW9Db2RlY1R5cGU+IGNsaWVudF9jb2RlY3M7CisgICAgc3RkOjp2ZWN0b3I8U3BpY2VW
aWRlb0NvZGVjVHlwZT4gY2xpZW50X2NvZGVjczsKIH07CiAKIHN0cnVjdCBJbkNhcGFiaWxpdGll
c01lc3NhZ2Uge307Ci0tIAoyLjIxLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9zcGljZS1kZXZlbA==
