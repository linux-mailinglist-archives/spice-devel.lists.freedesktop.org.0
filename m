Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 08BBEBC5A6
	for <lists+spice-devel@lfdr.de>; Tue, 24 Sep 2019 12:28:00 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D2EEA6E9E4;
	Tue, 24 Sep 2019 10:27:57 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5B3FA6E9E4
 for <spice-devel@lists.freedesktop.org>; Tue, 24 Sep 2019 10:27:56 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx08.intmail.prod.int.phx2.redhat.com
 [10.5.11.23])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id AB30810C093B
 for <spice-devel@lists.freedesktop.org>; Tue, 24 Sep 2019 10:27:55 +0000 (UTC)
Received: from colo-mx.corp.redhat.com
 (colo-mx01.intmail.prod.int.phx2.redhat.com [10.5.11.20])
 by smtp.corp.redhat.com (Postfix) with ESMTPS id A184B19C58
 for <spice-devel@lists.freedesktop.org>; Tue, 24 Sep 2019 10:27:55 +0000 (UTC)
Received: from zmail25.collab.prod.int.phx2.redhat.com
 (zmail25.collab.prod.int.phx2.redhat.com [10.5.83.31])
 by colo-mx.corp.redhat.com (Postfix) with ESMTP id 999EE1808878;
 Tue, 24 Sep 2019 10:27:55 +0000 (UTC)
Date: Tue, 24 Sep 2019 06:27:55 -0400 (EDT)
From: Frediano Ziglio <fziglio@redhat.com>
To: Victor Toso <victortoso@redhat.com>
Message-ID: <753523787.3055120.1569320875233.JavaMail.zimbra@redhat.com>
In-Reply-To: <20190924091502.16038-2-victortoso@redhat.com>
References: <20190924091502.16038-1-victortoso@redhat.com>
 <20190924091502.16038-2-victortoso@redhat.com>
MIME-Version: 1.0
X-Originating-IP: [10.33.32.21, 10.4.195.27]
Thread-Topic: Avoid accessing SpiceChannel's internals
Thread-Index: TeFwxw6vltLHibdhH9aFfD/TCokpeg==
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.23
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.6.2
 (mx1.redhat.com [10.5.110.66]); Tue, 24 Sep 2019 10:27:55 +0000 (UTC)
Subject: Re: [Spice-devel] [spice-gtk v1 1/6] Avoid accessing SpiceChannel's
 internals
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: spice-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

PiAKPiBGcm9tOiBWaWN0b3IgVG9zbyA8bWVAdmljdG9ydG9zby5jb20+Cj4gCj4gU3BpY2VDaGFu
bmVsIHByb3ZpZGVzIHNvbWUgaW50ZXJuYWwgdXRpbGl0eSBmdW5jdGlvbnMgdGhhdCB0aGlzIHBh
dGNoCj4gdGFrZXMgYWR2YW50YWdlIG9mOgo+IAo+ICogc3BpY2VfY2hhbm5lbF9nZXRfY2hhbm5l
bF90eXBlKCkKPiAqIHNwaWNlX2NoYW5uZWxfZ2V0X2NoYW5uZWxfaWQoKQo+ICogc3BpY2VfY2hh
bm5lbF9nZXRfc3RhdGUoKQo+IAo+IFNpZ25lZC1vZmYtYnk6IFZpY3RvciBUb3NvIDx2aWN0b3J0
b3NvQHJlZGhhdC5jb20+CgpUaGUgcXVlc3Rpb24gaXMgYWxzbyB3aHkgYWxsIHRoZXNlIGZpbGVz
IGhhdmUgYWNjZXNzIHRvICJwcml2YXRlIiBmaWVsZHM/CkhvdyBtdWNoIE5PVCBwcml2YXRlIHRo
ZXkgYXJlPyBMb29rcyBsaWtlIGlzIG1vcmUgYW4gImV4cG9ydGVkIiB0aGFuIGEgcHJpdmF0ZS4K
Cj4gLS0tCj4gIHNyYy9jaGFubmVsLWlucHV0cy5jIHwgNjUgKysrKysrKysrKysrKysrKysrKysr
KysrKysrKystLS0tLS0tLS0tLS0tLS0KPiAgc3JjL2NoYW5uZWwtbWFpbi5jICAgfCAyOCArKysr
KysrKystLS0tLS0tLS0tCj4gIHNyYy9zcGljZS1hdWRpby5jICAgIHwgIDYgKystLQo+ICBzcmMv
c3BpY2Utc2Vzc2lvbi5jICB8ICAzICstCj4gIDQgZmlsZXMgY2hhbmdlZCwgNjIgaW5zZXJ0aW9u
cygrKSwgNDAgZGVsZXRpb25zKC0pCj4gCj4gZGlmZiAtLWdpdCBhL3NyYy9jaGFubmVsLWlucHV0
cy5jIGIvc3JjL2NoYW5uZWwtaW5wdXRzLmMKPiBpbmRleCBhOGNkZDIzLi43M2NiYjBmIDEwMDY0
NAo+IC0tLSBhL3NyYy9jaGFubmVsLWlucHV0cy5jCj4gKysrIGIvc3JjL2NoYW5uZWwtaW5wdXRz
LmMKPiBAQCAtMzA0LDE0ICszMDQsMjAgQEAgdm9pZCBzcGljZV9pbnB1dHNfY2hhbm5lbF9tb3Rp
b24oU3BpY2VJbnB1dHNDaGFubmVsCj4gKmNoYW5uZWwsIGdpbnQgZHgsIGdpbnQgZHksCj4gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdpbnQgYnV0dG9uX3N0YXRlKQo+ICB7Cj4g
ICAgICBTcGljZUlucHV0c0NoYW5uZWxQcml2YXRlICpjOwo+ICsgICAgZ2ludCBjaGFubmVsX3N0
YXRlOwoKV2h5IG5vdCBlbnVtIHNwaWNlX2NoYW5uZWxfc3RhdGUgPwpIZXJlIGFuZCBpbiBkaWZm
ZXJlbnQgaHVua3MKCj4gIAo+ICAgICAgZ19yZXR1cm5faWZfZmFpbChjaGFubmVsICE9IE5VTEwp
Owo+IC0gICAgZ19yZXR1cm5faWZfZmFpbChTUElDRV9DSEFOTkVMKGNoYW5uZWwpLT5wcml2LT5z
dGF0ZSAhPQo+IFNQSUNFX0NIQU5ORUxfU1RBVEVfVU5DT05ORUNURUQpOwo+IC0gICAgaWYgKFNQ
SUNFX0NIQU5ORUwoY2hhbm5lbCktPnByaXYtPnN0YXRlICE9IFNQSUNFX0NIQU5ORUxfU1RBVEVf
UkVBRFkpCj4gKwo+ICsgICAgY2hhbm5lbF9zdGF0ZSA9IHNwaWNlX2NoYW5uZWxfZ2V0X3N0YXRl
KFNQSUNFX0NIQU5ORUwoY2hhbm5lbCkpOwo+ICsgICAgZ19yZXR1cm5faWZfZmFpbChjaGFubmVs
X3N0YXRlICE9IFNQSUNFX0NIQU5ORUxfU1RBVEVfVU5DT05ORUNURUQpOwo+ICsKPiArICAgIGlm
IChjaGFubmVsX3N0YXRlICE9IFNQSUNFX0NIQU5ORUxfU1RBVEVfUkVBRFkpIHsKPiAgICAgICAg
ICByZXR1cm47Cj4gKyAgICB9Cj4gIAo+IC0gICAgaWYgKGR4ID09IDAgJiYgZHkgPT0gMCkKPiAr
ICAgIGlmIChkeCA9PSAwICYmIGR5ID09IDApIHsKPiAgICAgICAgICByZXR1cm47Cj4gKyAgICB9
Cj4gIAo+ICAgICAgYyA9IGNoYW5uZWwtPnByaXY7Cj4gICAgICBjLT5icyAgPSBidXR0b25fc3Rh
dGU7Cj4gQEAgLTM2MCw4ICszNjYsOSBAQCB2b2lkIHNwaWNlX2lucHV0c19jaGFubmVsX3Bvc2l0
aW9uKFNwaWNlSW5wdXRzQ2hhbm5lbAo+ICpjaGFubmVsLCBnaW50IHgsIGdpbnQgeSwKPiAgCj4g
ICAgICBnX3JldHVybl9pZl9mYWlsKGNoYW5uZWwgIT0gTlVMTCk7Cj4gIAo+IC0gICAgaWYgKFNQ
SUNFX0NIQU5ORUwoY2hhbm5lbCktPnByaXYtPnN0YXRlICE9IFNQSUNFX0NIQU5ORUxfU1RBVEVf
UkVBRFkpCj4gKyAgICBpZiAoc3BpY2VfY2hhbm5lbF9nZXRfc3RhdGUoU1BJQ0VfQ0hBTk5FTChj
aGFubmVsKSkgIT0KPiBTUElDRV9DSEFOTkVMX1NUQVRFX1JFQURZKSB7Cj4gICAgICAgICAgcmV0
dXJuOwo+ICsgICAgfQo+ICAKPiAgICAgIGMgPSBjaGFubmVsLT5wcml2Owo+ICAgICAgYy0+YnMg
ID0gYnV0dG9uX3N0YXRlOwo+IEBAIC00MTEsMTAgKzQxOCwxMiBAQCB2b2lkCj4gc3BpY2VfaW5w
dXRzX2NoYW5uZWxfYnV0dG9uX3ByZXNzKFNwaWNlSW5wdXRzQ2hhbm5lbCAqY2hhbm5lbCwgZ2lu
dCBidXR0b24sCj4gIAo+ICAgICAgZ19yZXR1cm5faWZfZmFpbChjaGFubmVsICE9IE5VTEwpOwo+
ICAKPiAtICAgIGlmIChTUElDRV9DSEFOTkVMKGNoYW5uZWwpLT5wcml2LT5zdGF0ZSAhPSBTUElD
RV9DSEFOTkVMX1NUQVRFX1JFQURZKQo+ICsgICAgaWYgKHNwaWNlX2NoYW5uZWxfZ2V0X3N0YXRl
KFNQSUNFX0NIQU5ORUwoY2hhbm5lbCkpICE9Cj4gU1BJQ0VfQ0hBTk5FTF9TVEFURV9SRUFEWSkg
ewo+ICAgICAgICAgIHJldHVybjsKPiAtICAgIGlmIChzcGljZV9jaGFubmVsX2dldF9yZWFkX29u
bHkoU1BJQ0VfQ0hBTk5FTChjaGFubmVsKSkpCj4gKyAgICB9Cj4gKyAgICBpZiAoc3BpY2VfY2hh
bm5lbF9nZXRfcmVhZF9vbmx5KFNQSUNFX0NIQU5ORUwoY2hhbm5lbCkpKSB7Cj4gICAgICAgICAg
cmV0dXJuOwo+ICsgICAgfQo+ICAKPiAgICAgIGMgPSBjaGFubmVsLT5wcml2Owo+ICAgICAgc3dp
dGNoIChidXR0b24pIHsKPiBAQCAtNDc2LDEwICs0ODUsMTIgQEAgdm9pZAo+IHNwaWNlX2lucHV0
c19jaGFubmVsX2J1dHRvbl9yZWxlYXNlKFNwaWNlSW5wdXRzQ2hhbm5lbCAqY2hhbm5lbCwgZ2lu
dCBidXR0bwo+ICAKPiAgICAgIGdfcmV0dXJuX2lmX2ZhaWwoY2hhbm5lbCAhPSBOVUxMKTsKPiAg
Cj4gLSAgICBpZiAoU1BJQ0VfQ0hBTk5FTChjaGFubmVsKS0+cHJpdi0+c3RhdGUgIT0gU1BJQ0Vf
Q0hBTk5FTF9TVEFURV9SRUFEWSkKPiArICAgIGlmIChzcGljZV9jaGFubmVsX2dldF9zdGF0ZShT
UElDRV9DSEFOTkVMKGNoYW5uZWwpKSAhPQo+IFNQSUNFX0NIQU5ORUxfU1RBVEVfUkVBRFkpIHsK
PiAgICAgICAgICByZXR1cm47Cj4gLSAgICBpZiAoc3BpY2VfY2hhbm5lbF9nZXRfcmVhZF9vbmx5
KFNQSUNFX0NIQU5ORUwoY2hhbm5lbCkpKQo+ICsgICAgfQo+ICsgICAgaWYgKHNwaWNlX2NoYW5u
ZWxfZ2V0X3JlYWRfb25seShTUElDRV9DSEFOTkVMKGNoYW5uZWwpKSkgewo+ICAgICAgICAgIHJl
dHVybjsKPiArICAgIH0KPiAgCj4gICAgICBjID0gY2hhbm5lbC0+cHJpdjsKPiAgICAgIHN3aXRj
aCAoYnV0dG9uKSB7Cj4gQEAgLTUzNSwxMyArNTQ2LDE4IEBAIHZvaWQgc3BpY2VfaW5wdXRzX2No
YW5uZWxfa2V5X3ByZXNzKFNwaWNlSW5wdXRzQ2hhbm5lbAo+ICpjaGFubmVsLCBndWludCBzY2Fu
Y29kZSkKPiAgewo+ICAgICAgU3BpY2VNc2djS2V5RG93biBkb3duOwo+ICAgICAgU3BpY2VNc2dP
dXQgKm1zZzsKPiArICAgIGdpbnQgY2hhbm5lbF9zdGF0ZTsKPiAgCj4gICAgICBnX3JldHVybl9p
Zl9mYWlsKGNoYW5uZWwgIT0gTlVMTCk7Cj4gLSAgICBnX3JldHVybl9pZl9mYWlsKFNQSUNFX0NI
QU5ORUwoY2hhbm5lbCktPnByaXYtPnN0YXRlICE9Cj4gU1BJQ0VfQ0hBTk5FTF9TVEFURV9VTkNP
Tk5FQ1RFRCk7Cj4gLSAgICBpZiAoU1BJQ0VfQ0hBTk5FTChjaGFubmVsKS0+cHJpdi0+c3RhdGUg
IT0gU1BJQ0VfQ0hBTk5FTF9TVEFURV9SRUFEWSkKPiArCj4gKyAgICBjaGFubmVsX3N0YXRlID0g
c3BpY2VfY2hhbm5lbF9nZXRfc3RhdGUoU1BJQ0VfQ0hBTk5FTChjaGFubmVsKSk7Cj4gKyAgICBn
X3JldHVybl9pZl9mYWlsKGNoYW5uZWxfc3RhdGUgIT0gU1BJQ0VfQ0hBTk5FTF9TVEFURV9VTkNP
Tk5FQ1RFRCk7Cj4gKyAgICBpZiAoY2hhbm5lbF9zdGF0ZSAhPSBTUElDRV9DSEFOTkVMX1NUQVRF
X1JFQURZKSB7Cj4gICAgICAgICAgcmV0dXJuOwo+IC0gICAgaWYgKHNwaWNlX2NoYW5uZWxfZ2V0
X3JlYWRfb25seShTUElDRV9DSEFOTkVMKGNoYW5uZWwpKSkKPiArICAgIH0KPiArICAgIGlmIChz
cGljZV9jaGFubmVsX2dldF9yZWFkX29ubHkoU1BJQ0VfQ0hBTk5FTChjaGFubmVsKSkpIHsKPiAg
ICAgICAgICByZXR1cm47Cj4gKyAgICB9Cj4gIAo+ICAgICAgZG93bi5jb2RlID0gc3BpY2VfbWFr
ZV9zY2FuY29kZShzY2FuY29kZSwgRkFMU0UpOwo+ICAgICAgbXNnID0gc3BpY2VfbXNnX291dF9u
ZXcoU1BJQ0VfQ0hBTk5FTChjaGFubmVsKSwKPiAgICAgIFNQSUNFX01TR0NfSU5QVVRTX0tFWV9E
T1dOKTsKPiBAQCAtNTc4LDEzICs1OTQsMTggQEAgdm9pZAo+IHNwaWNlX2lucHV0c19jaGFubmVs
X2tleV9yZWxlYXNlKFNwaWNlSW5wdXRzQ2hhbm5lbCAqY2hhbm5lbCwgZ3VpbnQgc2NhbmNvZAo+
ICB7Cj4gICAgICBTcGljZU1zZ2NLZXlVcCB1cDsKPiAgICAgIFNwaWNlTXNnT3V0ICptc2c7Cj4g
KyAgICBnaW50IGNoYW5uZWxfc3RhdGU7Cj4gIAo+ICAgICAgZ19yZXR1cm5faWZfZmFpbChjaGFu
bmVsICE9IE5VTEwpOwo+IC0gICAgZ19yZXR1cm5faWZfZmFpbChTUElDRV9DSEFOTkVMKGNoYW5u
ZWwpLT5wcml2LT5zdGF0ZSAhPQo+IFNQSUNFX0NIQU5ORUxfU1RBVEVfVU5DT05ORUNURUQpOwo+
IC0gICAgaWYgKFNQSUNFX0NIQU5ORUwoY2hhbm5lbCktPnByaXYtPnN0YXRlICE9IFNQSUNFX0NI
QU5ORUxfU1RBVEVfUkVBRFkpCj4gKwo+ICsgICAgY2hhbm5lbF9zdGF0ZSA9IHNwaWNlX2NoYW5u
ZWxfZ2V0X3N0YXRlKFNQSUNFX0NIQU5ORUwoY2hhbm5lbCkpOwo+ICsgICAgZ19yZXR1cm5faWZf
ZmFpbChjaGFubmVsX3N0YXRlICE9IFNQSUNFX0NIQU5ORUxfU1RBVEVfVU5DT05ORUNURUQpOwo+
ICsgICAgaWYgKGNoYW5uZWxfc3RhdGUgIT0gU1BJQ0VfQ0hBTk5FTF9TVEFURV9SRUFEWSkgewo+
ICAgICAgICAgIHJldHVybjsKPiAtICAgIGlmIChzcGljZV9jaGFubmVsX2dldF9yZWFkX29ubHko
U1BJQ0VfQ0hBTk5FTChjaGFubmVsKSkpCj4gKyAgICB9Cj4gKyAgICBpZiAoc3BpY2VfY2hhbm5l
bF9nZXRfcmVhZF9vbmx5KFNQSUNFX0NIQU5ORUwoY2hhbm5lbCkpKSB7Cj4gICAgICAgICAgcmV0
dXJuOwo+ICsgICAgfQo+ICAKPiAgICAgIHVwLmNvZGUgPSBzcGljZV9tYWtlX3NjYW5jb2RlKHNj
YW5jb2RlLCBUUlVFKTsKPiAgICAgIG1zZyA9IHNwaWNlX21zZ19vdXRfbmV3KFNQSUNFX0NIQU5O
RUwoY2hhbm5lbCksCj4gICAgICBTUElDRV9NU0dDX0lOUFVUU19LRVlfVVApOwo+IEBAIC02MjQs
MTMgKzY0NSwxNCBAQCB2b2lkCj4gc3BpY2VfaW5wdXRzX2NoYW5uZWxfa2V5X3ByZXNzX2FuZF9y
ZWxlYXNlKFNwaWNlSW5wdXRzQ2hhbm5lbCAqaW5wdXRfY2hhbm5lCj4gICAgICBTcGljZUNoYW5u
ZWwgKmNoYW5uZWwgPSBTUElDRV9DSEFOTkVMKGlucHV0X2NoYW5uZWwpOwo+ICAKPiAgICAgIGdf
cmV0dXJuX2lmX2ZhaWwoY2hhbm5lbCAhPSBOVUxMKTsKPiAtICAgIGdfcmV0dXJuX2lmX2ZhaWwo
Y2hhbm5lbC0+cHJpdi0+c3RhdGUgIT0KPiBTUElDRV9DSEFOTkVMX1NUQVRFX1VOQ09OTkVDVEVE
KTsKPiArICAgIGdfcmV0dXJuX2lmX2ZhaWwoc3BpY2VfY2hhbm5lbF9nZXRfc3RhdGUoY2hhbm5l
bCkgIT0KPiBTUElDRV9DSEFOTkVMX1NUQVRFX1VOQ09OTkVDVEVEKTsKPiAgCj4gLSAgICBpZiAo
Y2hhbm5lbC0+cHJpdi0+c3RhdGUgIT0gU1BJQ0VfQ0hBTk5FTF9TVEFURV9SRUFEWSkKPiArICAg
IGlmIChzcGljZV9jaGFubmVsX2dldF9zdGF0ZShjaGFubmVsKSAhPSBTUElDRV9DSEFOTkVMX1NU
QVRFX1JFQURZKSB7Cj4gICAgICAgICAgcmV0dXJuOwo+IC0gICAgaWYgKHNwaWNlX2NoYW5uZWxf
Z2V0X3JlYWRfb25seShjaGFubmVsKSkKPiArICAgIH0KPiArICAgIGlmIChzcGljZV9jaGFubmVs
X2dldF9yZWFkX29ubHkoY2hhbm5lbCkpIHsKPiAgICAgICAgICByZXR1cm47Cj4gLQo+ICsgICAg
fQo+ICAgICAgaWYgKHNwaWNlX2NoYW5uZWxfdGVzdF9jYXBhYmlsaXR5KGNoYW5uZWwsCj4gICAg
ICBTUElDRV9JTlBVVFNfQ0FQX0tFWV9TQ0FOQ09ERSkpIHsKPiAgICAgICAgICBTcGljZU1zZ091
dCAqbXNnOwo+ICAgICAgICAgIGd1aW50MTYgY29kZTsKPiBAQCAtNjY0LDE2ICs2ODYsMTUgQEAg
c3RhdGljIFNwaWNlTXNnT3V0KiBzZXRfa2V5X2xvY2tzKFNwaWNlSW5wdXRzQ2hhbm5lbAo+ICpj
aGFubmVsLCBndWludCBsb2NrcykKPiAgICAgIFNwaWNlTXNnY0tleU1vZGlmaWVycyBtb2RpZmll
cnM7Cj4gICAgICBTcGljZU1zZ091dCAqbXNnOwo+ICAgICAgU3BpY2VJbnB1dHNDaGFubmVsUHJp
dmF0ZSAqaWM7Cj4gLSAgICBTcGljZUNoYW5uZWxQcml2YXRlICpjOwo+ICAKPiAgICAgIGdfcmV0
dXJuX3ZhbF9pZl9mYWlsKFNQSUNFX0lTX0lOUFVUU19DSEFOTkVMKGNoYW5uZWwpLCBOVUxMKTsK
PiAgCj4gICAgICBpYyA9IGNoYW5uZWwtPnByaXY7Cj4gLSAgICBjID0gU1BJQ0VfQ0hBTk5FTChj
aGFubmVsKS0+cHJpdjsKPiAtCj4gICAgICBpYy0+bG9ja3MgPSBsb2NrczsKPiAtICAgIGlmIChj
LT5zdGF0ZSAhPSBTUElDRV9DSEFOTkVMX1NUQVRFX1JFQURZKQo+ICsKPiArICAgIGlmIChzcGlj
ZV9jaGFubmVsX2dldF9zdGF0ZShTUElDRV9DSEFOTkVMKGNoYW5uZWwpKSAhPQo+IFNQSUNFX0NI
QU5ORUxfU1RBVEVfUkVBRFkpIHsKPiAgICAgICAgICByZXR1cm4gTlVMTDsKPiArICAgIH0KPiAg
Cj4gICAgICBtc2cgPSBzcGljZV9tc2dfb3V0X25ldyhTUElDRV9DSEFOTkVMKGNoYW5uZWwpLAo+
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU1BJQ0VfTVNHQ19JTlBVVFNfS0VZX01PRElG
SUVSUyk7Cj4gZGlmZiAtLWdpdCBhL3NyYy9jaGFubmVsLW1haW4uYyBiL3NyYy9jaGFubmVsLW1h
aW4uYwo+IGluZGV4IDMzNGJlN2QuLmFjMGQ0MDggMTAwNjQ0Cj4gLS0tIGEvc3JjL2NoYW5uZWwt
bWFpbi5jCj4gKysrIGIvc3JjL2NoYW5uZWwtbWFpbi5jCj4gQEAgLTIyMDQsMTQgKzIyMDQsMTMg
QEAgc3RhdGljIHZvaWQgbWlncmF0ZV9jaGFubmVsX2V2ZW50X2NiKFNwaWNlQ2hhbm5lbAo+ICpj
aGFubmVsLCBTcGljZUNoYW5uZWxFdmVudCBldgo+ICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgZ3BvaW50ZXIgZGF0YSkKPiAgewo+ICAgICAgc3BpY2VfbWlncmF0ZSAqbWln
ID0gZGF0YTsKPiAtICAgIFNwaWNlQ2hhbm5lbFByaXZhdGUgICpjID0gU1BJQ0VfQ0hBTk5FTChj
aGFubmVsKS0+cHJpdjsKPiAgCj4gICAgICBnX3JldHVybl9pZl9mYWlsKG1pZy0+bmNoYW5uZWxz
ID4gMCk7Cj4gICAgICBnX3NpZ25hbF9oYW5kbGVyc19kaXNjb25uZWN0X2J5X2Z1bmMoY2hhbm5l
bCwgbWlncmF0ZV9jaGFubmVsX2V2ZW50X2NiLAo+ICAgICAgZGF0YSk7Cj4gIAo+ICAgICAgc3dp
dGNoIChldmVudCkgewo+ICAgICAgY2FzZSBTUElDRV9DSEFOTkVMX09QRU5FRDoKPiAtICAgICAg
ICBpZiAoYy0+Y2hhbm5lbF90eXBlID09IFNQSUNFX0NIQU5ORUxfTUFJTikgewo+ICsgICAgICAg
IGlmIChzcGljZV9jaGFubmVsX2dldF9jaGFubmVsX3R5cGUoY2hhbm5lbCkgPT0gU1BJQ0VfQ0hB
Tk5FTF9NQUlOKSB7Cj4gICAgICAgICAgICAgIFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbiA9Cj4gICAg
ICAgICAgICAgIHNwaWNlX2NoYW5uZWxfZ2V0X3Nlc3Npb24obWlnLT5zcmNfY2hhbm5lbCk7Cj4g
ICAgICAgICAgICAgIGlmIChtaWctPmRvX3NlYW1sZXNzKSB7Cj4gICAgICAgICAgICAgICAgICBT
cGljZU1haW5DaGFubmVsUHJpdmF0ZSAqbWFpbl9wcml2ID0KPiAgICAgICAgICAgICAgICAgIFNQ
SUNFX01BSU5fQ0hBTk5FTChjaGFubmVsKS0+cHJpdjsKPiBAQCAtMjIyNywxMSArMjIyNiwxNSBA
QCBzdGF0aWMgdm9pZCBtaWdyYXRlX2NoYW5uZWxfZXZlbnRfY2IoU3BpY2VDaGFubmVsCj4gKmNo
YW5uZWwsIFNwaWNlQ2hhbm5lbEV2ZW50IGV2Cj4gICAgICAgICAgICAgIEdMaXN0ICpjaGFubmVs
cywgKmw7Cj4gICAgICAgICAgICAgIGwgPSBjaGFubmVscyA9IHNwaWNlX3Nlc3Npb25fZ2V0X2No
YW5uZWxzKHNlc3Npb24pOwo+ICAgICAgICAgICAgICB3aGlsZSAobCAhPSBOVUxMKSB7Cj4gLSAg
ICAgICAgICAgICAgICBTcGljZUNoYW5uZWxQcml2YXRlICAqY3VyYyA9IFNQSUNFX0NIQU5ORUwo
bC0+ZGF0YSktPnByaXY7Cj4gKyAgICAgICAgICAgICAgICBTcGljZUNoYW5uZWwgKml0ID0gU1BJ
Q0VfQ0hBTk5FTChsLT5kYXRhKTsKPiArCj4gICAgICAgICAgICAgICAgICBsID0gbC0+bmV4dDsK
PiAtICAgICAgICAgICAgICAgIGlmIChjdXJjLT5jaGFubmVsX3R5cGUgPT0gU1BJQ0VfQ0hBTk5F
TF9NQUlOKQo+ICsgICAgICAgICAgICAgICAgaWYgKHNwaWNlX2NoYW5uZWxfZ2V0X2NoYW5uZWxf
dHlwZShpdCkgPT0KPiBTUElDRV9DSEFOTkVMX01BSU4pIHsKPiAgICAgICAgICAgICAgICAgICAg
ICBjb250aW51ZTsKPiAtICAgICAgICAgICAgICAgIG1pZ3JhdGVfY2hhbm5lbF9jb25uZWN0KG1p
ZywgY3VyYy0+Y2hhbm5lbF90eXBlLAo+IGN1cmMtPmNoYW5uZWxfaWQpOwo+ICsgICAgICAgICAg
ICAgICAgfQo+ICsgICAgICAgICAgICAgICAgbWlncmF0ZV9jaGFubmVsX2Nvbm5lY3QobWlnLAo+
ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BpY2VfY2hhbm5lbF9n
ZXRfY2hhbm5lbF90eXBlKGl0KSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHNwaWNlX2NoYW5uZWxfZ2V0X2NoYW5uZWxfaWQoaXQpKTsKPiAgICAgICAgICAgICAg
fQo+ICAgICAgICAgICAgICBnX2xpc3RfZnJlZShjaGFubmVscyk7Cj4gICAgICAgICAgfSBlbHNl
IHsKPiBAQCAtMjI1NCwxMCArMjI1NywxMCBAQCBzdGF0aWMgdm9pZCBtaWdyYXRlX2NoYW5uZWxf
ZXZlbnRfY2IoU3BpY2VDaGFubmVsCj4gKmNoYW5uZWwsIFNwaWNlQ2hhbm5lbEV2ZW50IGV2Cj4g
IHN0YXRpYyBnYm9vbGVhbiBtYWluX21pZ3JhdGVfaGFuZHNoYWtlX2RvbmUoZ3BvaW50ZXIgZGF0
YSkKPiAgewo+ICAgICAgc3BpY2VfbWlncmF0ZSAqbWlnID0gZGF0YTsKPiAtICAgIFNwaWNlQ2hh
bm5lbFByaXZhdGUgICpjID0gU1BJQ0VfQ0hBTk5FTChtaWctPmRzdF9jaGFubmVsKS0+cHJpdjsK
PiArICAgIFNwaWNlQ2hhbm5lbCAqY2hhbm5lbCA9IFNQSUNFX0NIQU5ORUwobWlnLT5kc3RfY2hh
bm5lbCk7Cj4gIAo+IC0gICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwoYy0+Y2hhbm5lbF90eXBlID09
IFNQSUNFX0NIQU5ORUxfTUFJTiwgRkFMU0UpOwo+IC0gICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwo
Yy0+c3RhdGUgPT0KPiBTUElDRV9DSEFOTkVMX1NUQVRFX01JR1JBVElPTl9IQU5EU0hBS0UsIEZB
TFNFKTsKPiArICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKHNwaWNlX2NoYW5uZWxfZ2V0X2NoYW5u
ZWxfdHlwZShjaGFubmVsKSA9PQo+IFNQSUNFX0NIQU5ORUxfTUFJTiwgRkFMU0UpOwo+ICsgICAg
Z19yZXR1cm5fdmFsX2lmX2ZhaWwoc3BpY2VfY2hhbm5lbF9nZXRfc3RhdGUoY2hhbm5lbCkgPT0K
PiBTUElDRV9DSEFOTkVMX1NUQVRFX01JR1JBVElPTl9IQU5EU0hBS0UsIEZBTFNFKTsKPiAgCj4g
ICAgICBjLT5zdGF0ZSA9IFNQSUNFX0NIQU5ORUxfU1RBVEVfTUlHUkFUSU5HOwo+ICAgICAgbWln
LT5uY2hhbm5lbHMtLTsKPiBAQCAtMjQwNywyMCArMjQxMCwxOCBAQCBzdGF0aWMgdm9pZAo+IG1h
aW5faGFuZGxlX21pZ3JhdGVfYmVnaW5fc2VhbWxlc3MoU3BpY2VDaGFubmVsICpjaGFubmVsLCBT
cGljZU1zZ0luCj4gIAo+ICBzdGF0aWMgdm9pZCBtYWluX2hhbmRsZV9taWdyYXRlX2RzdF9zZWFt
bGVzc19hY2soU3BpY2VDaGFubmVsICpjaGFubmVsLAo+ICBTcGljZU1zZ0luICppbikKPiAgewo+
IC0gICAgU3BpY2VDaGFubmVsUHJpdmF0ZSAgKmMgPSBTUElDRV9DSEFOTkVMKGNoYW5uZWwpLT5w
cml2Owo+ICAgICAgU3BpY2VNYWluQ2hhbm5lbFByaXZhdGUgKm1haW5fcHJpdiA9IFNQSUNFX01B
SU5fQ0hBTk5FTChjaGFubmVsKS0+cHJpdjsKPiAgCj4gLSAgICBnX3JldHVybl9pZl9mYWlsKGMt
PnN0YXRlID09IFNQSUNFX0NIQU5ORUxfU1RBVEVfTUlHUkFUSU9OX0hBTkRTSEFLRSk7Cj4gKyAg
ICBnX3JldHVybl9pZl9mYWlsKHNwaWNlX2NoYW5uZWxfZ2V0X3N0YXRlKGNoYW5uZWwpID09Cj4g
U1BJQ0VfQ0hBTk5FTF9TVEFURV9NSUdSQVRJT05fSEFORFNIQUtFKTsKPiAgICAgIG1haW5fcHJp
di0+bWlncmF0ZV9kYXRhLT5kb19zZWFtbGVzcyA9IHRydWU7Cj4gICAgICBnX2lkbGVfYWRkKG1h
aW5fbWlncmF0ZV9oYW5kc2hha2VfZG9uZSwgbWFpbl9wcml2LT5taWdyYXRlX2RhdGEpOwo+ICB9
Cj4gIAo+ICBzdGF0aWMgdm9pZCBtYWluX2hhbmRsZV9taWdyYXRlX2RzdF9zZWFtbGVzc19uYWNr
KFNwaWNlQ2hhbm5lbCAqY2hhbm5lbCwKPiAgU3BpY2VNc2dJbiAqaW4pCj4gIHsKPiAtICAgIFNw
aWNlQ2hhbm5lbFByaXZhdGUgICpjID0gU1BJQ0VfQ0hBTk5FTChjaGFubmVsKS0+cHJpdjsKPiAg
ICAgIFNwaWNlTWFpbkNoYW5uZWxQcml2YXRlICptYWluX3ByaXYgPSBTUElDRV9NQUlOX0NIQU5O
RUwoY2hhbm5lbCktPnByaXY7Cj4gIAo+IC0gICAgZ19yZXR1cm5faWZfZmFpbChjLT5zdGF0ZSA9
PSBTUElDRV9DSEFOTkVMX1NUQVRFX01JR1JBVElPTl9IQU5EU0hBS0UpOwo+ICsgICAgZ19yZXR1
cm5faWZfZmFpbChzcGljZV9jaGFubmVsX2dldF9zdGF0ZShjaGFubmVsKSA9PQo+IFNQSUNFX0NI
QU5ORUxfU1RBVEVfTUlHUkFUSU9OX0hBTkRTSEFLRSk7Cj4gICAgICBtYWluX3ByaXYtPm1pZ3Jh
dGVfZGF0YS0+ZG9fc2VhbWxlc3MgPSBmYWxzZTsKPiAgICAgIGdfaWRsZV9hZGQobWFpbl9taWdy
YXRlX2hhbmRzaGFrZV9kb25lLCBtYWluX3ByaXYtPm1pZ3JhdGVfZGF0YSk7Cj4gIH0KPiBAQCAt
MjU1MSwxMSArMjU1MiwxMCBAQCBzdGF0aWMgdm9pZCBzcGljZV9tYWluX2hhbmRsZV9tc2coU3Bp
Y2VDaGFubmVsCj4gKmNoYW5uZWwsIFNwaWNlTXNnSW4gKm1zZykKPiAgewo+ICAgICAgaW50IHR5
cGUgPSBzcGljZV9tc2dfaW5fdHlwZShtc2cpOwo+ICAgICAgU3BpY2VDaGFubmVsQ2xhc3MgKnBh
cmVudF9jbGFzczsKPiAtICAgIFNwaWNlQ2hhbm5lbFByaXZhdGUgKmMgPSBTUElDRV9DSEFOTkVM
KGNoYW5uZWwpLT5wcml2Owo+ICAKPiAgICAgIHBhcmVudF9jbGFzcyA9IFNQSUNFX0NIQU5ORUxf
Q0xBU1Moc3BpY2VfbWFpbl9jaGFubmVsX3BhcmVudF9jbGFzcyk7Cj4gIAo+IC0gICAgaWYgKGMt
PnN0YXRlID09IFNQSUNFX0NIQU5ORUxfU1RBVEVfTUlHUkFUSU9OX0hBTkRTSEFLRSkgewo+ICsg
ICAgaWYgKHNwaWNlX2NoYW5uZWxfZ2V0X3N0YXRlKGNoYW5uZWwpID09Cj4gU1BJQ0VfQ0hBTk5F
TF9TVEFURV9NSUdSQVRJT05fSEFORFNIQUtFKSB7Cj4gICAgICAgICAgaWYgKHR5cGUgIT0gU1BJ
Q0VfTVNHX01BSU5fTUlHUkFURV9EU1RfU0VBTUxFU1NfQUNLICYmCj4gICAgICAgICAgICAgIHR5
cGUgIT0gU1BJQ0VfTVNHX01BSU5fTUlHUkFURV9EU1RfU0VBTUxFU1NfTkFDSykgewo+ICAgICAg
ICAgICAgICBnX2NyaXRpY2FsKCJ1bmV4cGVjdGVkIG1zZyAoJWQpLiIKPiBkaWZmIC0tZ2l0IGEv
c3JjL3NwaWNlLWF1ZGlvLmMgYi9zcmMvc3BpY2UtYXVkaW8uYwo+IGluZGV4IGRhZjYyZGYuLjEw
YjMxZDcgMTAwNjQ0Cj4gLS0tIGEvc3JjL3NwaWNlLWF1ZGlvLmMKPiArKysgYi9zcmMvc3BpY2Ut
YXVkaW8uYwo+IEBAIC0xNDUsMTEgKzE0NSwxMyBAQCBzdGF0aWMgdm9pZCBzcGljZV9hdWRpb19p
bml0KFNwaWNlQXVkaW8gKnNlbGYpCj4gIAo+ICBzdGF0aWMgdm9pZCBjb25uZWN0X2NoYW5uZWwo
U3BpY2VBdWRpbyAqc2VsZiwgU3BpY2VDaGFubmVsICpjaGFubmVsKQo+ICB7Cj4gLSAgICBpZiAo
Y2hhbm5lbC0+cHJpdi0+c3RhdGUgIT0gU1BJQ0VfQ0hBTk5FTF9TVEFURV9VTkNPTk5FQ1RFRCkK
PiArICAgIGlmIChzcGljZV9jaGFubmVsX2dldF9zdGF0ZShjaGFubmVsKSAhPSBTUElDRV9DSEFO
TkVMX1NUQVRFX1VOQ09OTkVDVEVEKQo+IHsKPiAgICAgICAgICByZXR1cm47Cj4gKyAgICB9Cj4g
IAo+IC0gICAgaWYgKFNQSUNFX0FVRElPX0dFVF9DTEFTUyhzZWxmKS0+Y29ubmVjdF9jaGFubmVs
KHNlbGYsIGNoYW5uZWwpKQo+ICsgICAgaWYgKFNQSUNFX0FVRElPX0dFVF9DTEFTUyhzZWxmKS0+
Y29ubmVjdF9jaGFubmVsKHNlbGYsIGNoYW5uZWwpKSB7Cj4gICAgICAgICAgc3BpY2VfY2hhbm5l
bF9jb25uZWN0KGNoYW5uZWwpOwo+ICsgICAgfQo+ICB9Cj4gIAo+ICBzdGF0aWMgdm9pZCB1cGRh
dGVfYXVkaW9fY2hhbm5lbHMoU3BpY2VBdWRpbyAqc2VsZiwgU3BpY2VTZXNzaW9uICpzZXNzaW9u
KQo+IGRpZmYgLS1naXQgYS9zcmMvc3BpY2Utc2Vzc2lvbi5jIGIvc3JjL3NwaWNlLXNlc3Npb24u
Ywo+IGluZGV4IGQwZDllNTQuLmFmZWI3MjQgMTAwNjQ0Cj4gLS0tIGEvc3JjL3NwaWNlLXNlc3Np
b24uYwo+ICsrKyBiL3NyYy9zcGljZS1zZXNzaW9uLmMKPiBAQCAtMjIwMyw3ICsyMjAzLDYgQEAg
R1NvY2tldENvbm5lY3Rpb24qCj4gc3BpY2Vfc2Vzc2lvbl9jaGFubmVsX29wZW5faG9zdChTcGlj
ZVNlc3Npb24gKnNlc3Npb24sIFNwaWNlQwo+ICAgICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwoU1BJ
Q0VfSVNfU0VTU0lPTihzZXNzaW9uKSwgTlVMTCk7Cj4gIAo+ICAgICAgU3BpY2VTZXNzaW9uUHJp
dmF0ZSAqcyA9IHNlc3Npb24tPnByaXY7Cj4gLSAgICBTcGljZUNoYW5uZWxQcml2YXRlICpjID0g
Y2hhbm5lbC0+cHJpdjsKPiAgICAgIHNwaWNlX29wZW5faG9zdCBvcGVuX2hvc3QgPSB7IDAsIH07
Cj4gICAgICBnY2hhciAqcG9ydCwgKmVuZHB0cjsKPiAgCj4gQEAgLTIyMTIsNyArMjIxMSw3IEBA
IEdTb2NrZXRDb25uZWN0aW9uKgo+IHNwaWNlX3Nlc3Npb25fY2hhbm5lbF9vcGVuX2hvc3QoU3Bp
Y2VTZXNzaW9uICpzZXNzaW9uLCBTcGljZUMKPiAgICAgIG9wZW5faG9zdC5zZXNzaW9uID0gc2Vz
c2lvbjsKPiAgICAgIG9wZW5faG9zdC5jaGFubmVsID0gY2hhbm5lbDsKPiAgCj4gLSAgICBjb25z
dCBjaGFyICpuYW1lID0gc3BpY2VfY2hhbm5lbF90eXBlX3RvX3N0cmluZyhjLT5jaGFubmVsX3R5
cGUpOwo+ICsgICAgY29uc3QgY2hhciAqbmFtZSA9Cj4gc3BpY2VfY2hhbm5lbF90eXBlX3RvX3N0
cmluZyhzcGljZV9jaGFubmVsX2dldF9jaGFubmVsX3R5cGUoY2hhbm5lbCkpOwo+ICAgICAgaWYg
KHNwaWNlX3N0cnZfY29udGFpbnMocy0+c2VjdXJlX2NoYW5uZWxzLCAiYWxsIikgfHwKPiAgICAg
ICAgICBzcGljZV9zdHJ2X2NvbnRhaW5zKHMtPnNlY3VyZV9jaGFubmVscywgbmFtZSkpCj4gICAg
ICAgICAgKnVzZV90bHMgPSBUUlVFOwoKQnkgdGhlIHdheSwgdGhlIHBhdGNoIGRvZXMgbm90IGNv
bXBpbGUuCgpGcmVkaWFubwpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpTcGljZS1kZXZlbCBtYWlsaW5nIGxpc3QKU3BpY2UtZGV2ZWxAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
c3BpY2UtZGV2ZWw=
