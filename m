Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9D0C8916CE
	for <lists+spice-devel@lfdr.de>; Sun, 18 Aug 2019 15:37:59 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A15776E07B;
	Sun, 18 Aug 2019 13:37:57 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail.codeweavers.com (mail.codeweavers.com [50.203.203.244])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EF8B96E07B
 for <spice-devel@lists.freedesktop.org>; Sun, 18 Aug 2019 13:37:55 +0000 (UTC)
Received: from jwhite.vpn.mn.codeweavers.com ([10.69.139.101] helo=[10.0.0.11])
 by mail.codeweavers.com with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_GCM_SHA256:128)
 (Exim 4.89) (envelope-from <jwhite@codeweavers.com>)
 id 1hzLNY-0003F7-Fj; Sun, 18 Aug 2019 08:37:53 -0500
To: spice-devel@lists.freedesktop.org, Brendan Shanks <bshanks@codeweavers.com>
References: <20190816220129.22027-1-bshanks@codeweavers.com>
 <20190816220129.22027-4-bshanks@codeweavers.com>
 <1068062958.6620087.1566018330530.JavaMail.zimbra@redhat.com>
From: Jeremy White <jwhite@codeweavers.com>
Message-ID: <aeb9ba37-2581-3772-9d72-8daf22d7d698@codeweavers.com>
Date: Sun, 18 Aug 2019 08:37:52 -0500
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <1068062958.6620087.1566018330530.JavaMail.zimbra@redhat.com>
Content-Language: en-US
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; 
 d=codeweavers.com; s=6377696661; h=Content-Transfer-Encoding:Content-Type:
 In-Reply-To:MIME-Version:Date:Message-ID:From:References:To:Subject:Sender:
 Reply-To:Cc:Content-ID:Content-Description:Resent-Date:Resent-From:
 Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:
 List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=BxA35CGFdRW9mEmkmhNhcoHFjoCyyk7nM9ZAHEUYbVI=; b=GJcUvsPOTkSKG6kkQiZXoiYRmA
 kd/LDSKOTaknj0ulu/BQsg4iwgvr1oOE2OuDbAbbLk5DFiTbB49QGclmSc/X9Q7mTh6MjyGEakKQK
 uEMpHGrAcXIHc+IkqTxiM7pOFwIXcTNzkpl5b5BxrNqNPSFTYFtpOHcLjasbTHF7ZffA=;
Subject: Re: [Spice-devel] [PATCH x11spice v3 3/3] Add cache for SHM segments
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

SGksCgpJIGNvbmN1ciB3aXRoIEZyZWRpYW5vIG9uIHRob3NlIHR3byBjaGFuZ2VzLCBidXQgdGhp
cyBjb2RlIGlzIG90aGVyd2lzZSAKd29ya2luZyB3ZWxsIGZvciBtZS4KCkNoZWVycywKCkplcmVt
eQoKT24gOC8xNy8xOSAxMjowNSBBTSwgRnJlZGlhbm8gWmlnbGlvIHdyb3RlOgo+Pgo+PiBBZGQg
YSBjYWNoZSB0byBhbGxvdyB0aGUgcmV1c2Ugb2YgU0hNIHNlZ21lbnRzLgo+PiBTaGFyZWQgbWVt
b3J5IHNlZ21lbnRzIGFyZSBhZGRlZCB0byB0aGUgY2FjaGUgaW5zdGVhZCBvZiBiZWluZwo+PiBk
ZWFsbG9jYXRlZCwgYW5kIHRoZSBjYWNoZSBpcyBzZWFyY2hlZCBpbnN0ZWFkIG9mL2JlZm9yZSBh
bGxvY2F0aW5nIGEKPj4gbmV3IHNlZ21lbnQuCj4+Cj4+IEJvdGggdGhlIFNITSBzZWdtZW50cyBh
bmQgdGhlaXIgYXR0YWNobWVudCB3aXRoIHRoZSBYIHNlcnZlciBhcmUgY2FjaGVkLgo+Pgo+PiBU
aGUgY2FjaGUgY3VycmVudGx5IGhhcyBhIGZpeGVkIG51bWJlciBvZiAxMCBlbnRyaWVzLCB0aGlz
IHByb3ZpZGVkIGEKPj4gZ29vZCBjYWNoZSBoaXQgcmF0ZSB3aGlsZSBrZWVwaW5nIG1lbW9yeSB1
c2FnZSB1bmRlciBjb250cm9sLgo+PiBCdWlsZGluZyB3aXRoIERFQlVHX1NITV9DQUNIRSBkZWZp
bmVkIGFuZCBydW5uaW5nIHdpdGgKPj4gR19NRVNTQUdFU19ERUJVRz1hbGwgd2lsbCBwZXJpb2Rp
Y2FsbHkgcHJpbnQgb3V0IHRoZSBTSE0gY2FjaGUgaGl0Cj4+IHJhdGUuCj4+Cj4+IE9uIG15IFVi
dW50dSAxOC4wNCBzeXN0ZW0gcnVubmluZyBYRkNFNCB3aXRoIGEgMjU2MHgxNDQwIHNjcmVlbiwg
dGhlCj4+IGNhY2hlIGhpdCByYXRlIHN0YXJ0cyBhcm91bmQgNzIlLiBPbi1zY3JlZW4gd2luZG93
cyB0aGF0IHVwZGF0ZSBvZnRlbgo+PiBhbmQgaGF2ZSBjb25zaXN0ZW50bHktc2l6ZWQgZGFtYWdl
IHJlY3RhbmdsZXMgYXJlIHRoZSBiZXN0IGNhc2UuIFdpdGgKPj4gc2V2ZXJhbCBvZiB0aG9zZSAo
c2Nyb2xsaW5nIHRlcm1pbmFsIHdpbmRvd3MsIHdlYiBicm93c2VyIHNob3dpbmcgYQo+PiBXZWJH
TCBkZW1vKSwgdGhlIGhpdCByYXRlIHNsb3dseSByaXNlcyB0byBhcm91bmQgOTIlLgo+PiBPcGVy
YXRpb25zIHRoYXQgZ2VuZXJhdGUgcmFwaWQgZGFtYWdlIHJlcG9ydHMgKGxpa2UgcmVzaXppbmcg
b3IgbW92aW5nCj4+IHdpbmRvd3MpIHdpbGwgbG93ZXIgdGhlIGhpdCByYXRlLgo+Pgo+PiBTaWdu
ZWQtb2ZmLWJ5OiBCcmVuZGFuIFNoYW5rcyA8YnNoYW5rc0Bjb2Rld2VhdmVycy5jb20+Cj4+IC0t
LQo+PiAgIHNyYy9kaXNwbGF5LmMgfCAxNzUgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKy0tLS0KPj4gICBzcmMvZGlzcGxheS5oIHwgIDExICsrKy0KPj4gICAy
IGZpbGVzIGNoYW5nZWQsIDE3MCBpbnNlcnRpb25zKCspLCAxNiBkZWxldGlvbnMoLSkKPj4KPj4g
ZGlmZiAtLWdpdCBhL3NyYy9kaXNwbGF5LmMgYi9zcmMvZGlzcGxheS5jCj4+IGluZGV4IGEyYTE4
YjguLjU1NDYxYTIgMTAwNjQ0Cj4+IC0tLSBhL3NyYy9kaXNwbGF5LmMKPj4gKysrIGIvc3JjL2Rp
c3BsYXkuYwo+PiBAQCAtMjEzLDExICsyMTMsMTU1IEBAIHN0YXRpYyBpbnQgcmVnaXN0ZXJfZm9y
X2V2ZW50cyhkaXNwbGF5X3QgKmQpCj4+ICAgICAgIHJldHVybiAwOwo+PiAgIH0KPj4gICAKPj4g
K3N0YXRpYyB2b2lkIHNobV9zZWdtZW50X2Rlc3Ryb3koZGlzcGxheV90ICpkLCBzaG1fc2VnbWVu
dF90ICpzZWdtZW50KQo+PiArewo+PiArICAgIGlmIChzZWdtZW50LT5zaG1pZCA9PSAtMSkgewo+
PiArICAgICAgICByZXR1cm47Cj4+ICsgICAgfQo+PiArCj4+ICsgICAgeGNiX3NobV9kZXRhY2go
ZC0+Yywgc2VnbWVudC0+c2htc2VnKTsKPj4gKyAgICBzZWdtZW50LT5zaG1zZWcgPSAtMTsKPj4g
Kwo+PiArICAgIHNobWR0KHNlZ21lbnQtPnNobWFkZHIpOwo+PiArICAgIHNlZ21lbnQtPnNobWFk
ZHIgPSBOVUxMOwo+PiArCj4+ICsgICAgc2htY3RsKHNlZ21lbnQtPnNobWlkLCBJUENfUk1JRCwg
TlVMTCk7Cj4+ICsgICAgc2VnbWVudC0+c2htaWQgPSAtMTsKPj4gK30KPj4gKwo+PiArCj4+ICtz
dGF0aWMgaW50IHNobV9jYWNoZV9nZXQoZGlzcGxheV90ICpkLCBzaXplX3Qgc2l6ZSwgc2htX3Nl
Z21lbnRfdCAqc2VnbWVudCkKPj4gK3sKPj4gKyAgICBpbnQgaSwgcmV0Owo+PiArICAgIHNobV9z
ZWdtZW50X3QgKmJpZ2dlcl9lbnRyeSA9IE5VTEw7Cj4+ICsgICAgc2htX3NlZ21lbnRfdCAqZW50
cnlfdG9fdXNlID0gTlVMTDsKPj4gKwo+PiArI2lmIGRlZmluZWQoREVCVUdfU0hNX0NBQ0hFKQo+
PiArICAgIHN0YXRpYyBndWludCBjYWNoZV9oaXRzID0gMDsKPj4gKyAgICBzdGF0aWMgZ3VpbnQg
Y2FjaGVfdG90YWwgPSAwOwo+PiArCj4+ICsgICAgY2FjaGVfdG90YWwrKzsKPj4gKyNlbmRpZgo+
PiArCj4+ICsgICAgZ19tdXRleF9sb2NrKCZkLT5zaG1fY2FjaGVfbXV0ZXgpOwo+PiArCj4+ICsg
ICAgLyogQ2hlY2sgdGhlIGNhY2hlIGZvciBhIHNlZ21lbnQgb2Ygc2l6ZSAnc2l6ZScgb3IgYmln
Z2VyLgo+PiArICAgICAqIFVzZSBhbiBleGFjdC1zaXplIHNlZ21lbnQgaWYgZm91bmQuCj4+ICsg
ICAgICogSWYgbm90LCB1c2UgdGhlIHNtYWxsZXN0IGVudHJ5IHRoYXQgaXMgYmlnIGVub3VnaC4K
Pj4gKyAgICAgKi8KPj4gKyAgICBmb3IgKGkgPSAwOyBpIDwgR19OX0VMRU1FTlRTKGQtPnNobV9j
YWNoZSk7IGkrKykgewo+PiArICAgICAgICBzaG1fc2VnbWVudF90ICplbnRyeSA9ICZkLT5zaG1f
Y2FjaGVbaV07Cj4+ICsKPj4gKyAgICAgICAgaWYgKGVudHJ5LT5zaG1pZCAhPSAtMSkgewo+PiAr
ICAgICAgICAgICAgLyogSWYgYSBjYWNoZSBlbnRyeSBvZiB0aGUgZXhhY3Qgc2l6ZSBiZWluZyBy
ZXF1ZXN0ZWQgaXMgZm91bmQsCj4+IHVzZSB0aGF0ICovCj4+ICsgICAgICAgICAgICBpZiAoc2l6
ZSA9PSBlbnRyeS0+c2l6ZSkgewo+PiArICAgICAgICAgICAgICAgIGVudHJ5X3RvX3VzZSA9IGVu
dHJ5Owo+PiArICAgICAgICAgICAgICAgIGJyZWFrOwo+PiArICAgICAgICAgICAgfQo+PiArCj4+
ICsgICAgICAgICAgICAvKiBLZWVwIHRyYWNrIG9mIHRoZSBuZXh0LWJpZ2dlc3QgZW50cnkgaW4g
Y2FzZSBhbiBleGFjdC1zaXplCj4+IG1hdGNoIGlzbid0IGZvdW5kICovCj4+ICsgICAgICAgICAg
ICBpZiAoc2l6ZSA8IGVudHJ5LT5zaXplKSB7Cj4+ICsgICAgICAgICAgICAgICAgaWYgKChiaWdn
ZXJfZW50cnkgJiYgZW50cnktPnNpemUgPCBiaWdnZXJfZW50cnktPnNpemUpIHx8Cj4+ICFiaWdn
ZXJfZW50cnkpIHsKPiAKPiBUaGlzIGlzIGVxdWl2YWxlbnQgdG8KPiAKPiAgICAgaWYgKCFiaWdn
ZXJfZW50cnkgfHwgZW50cnktPnNpemUgPCBiaWdnZXJfZW50cnktPnNpemUpIHsKPiAKPj4gKyAg
ICAgICAgICAgICAgICAgICAgYmlnZ2VyX2VudHJ5ID0gZW50cnk7Cj4+ICsgICAgICAgICAgICAg
ICAgfQo+PiArICAgICAgICAgICAgfQo+PiArICAgICAgICB9Cj4+ICsgICAgfQo+PiArCj4+ICsg
ICAgLyogQW4gZXhhY3Qtc2l6ZSBlbnRyeSB3YXNuJ3QgZm91bmQsIHVzZSB0aGUgbmV4dCBiaWdn
ZXN0IGVudHJ5IHRoYXQgd2FzCj4+IGZvdW5kICovCj4+ICsgICAgaWYgKCFlbnRyeV90b191c2Up
IHsKPj4gKyAgICAgICAgZW50cnlfdG9fdXNlID0gYmlnZ2VyX2VudHJ5Owo+PiArICAgIH0KPj4g
Kwo+PiArICAgIGlmIChlbnRyeV90b191c2UpIHsKPj4gKyAgICAgICAgKnNlZ21lbnQgPSAqZW50
cnlfdG9fdXNlOwo+PiArICAgICAgICBlbnRyeV90b191c2UtPnNobWlkID0gLTE7Cj4+ICsKPj4g
KyAgICAgICAgcmV0ID0gMTsKPj4gKwo+PiArI2lmIGRlZmluZWQoREVCVUdfU0hNX0NBQ0hFKQo+
PiArICAgICAgICBjYWNoZV9oaXRzKys7Cj4+ICsgICAgICAgIGlmICgoY2FjaGVfaGl0cyAlIDEw
MCA9PSAwKSkgewo+PiArICAgICAgICAgICAgZ19kZWJ1ZygiU0hNIGNhY2hlIGhpdHJhdGU6ICV1
LyV1ICglLjJmJSUpIiwgY2FjaGVfaGl0cywKPj4gY2FjaGVfdG90YWwsCj4+ICsgICAgICAgICAg
ICAgICAgICAgIChmbG9hdCkgKChmbG9hdCkgY2FjaGVfaGl0cyAvIChmbG9hdCkgY2FjaGVfdG90
YWwpICoKPj4gMTAwKTsKPj4gKyAgICAgICAgfQo+PiArI2VuZGlmCj4+ICsgICAgfSBlbHNlIHsK
Pj4gKyAgICAgICAgLyogTm8gdXNhYmxlIGVudHJ5IGZvdW5kIGluIHRoZSBjYWNoZSAqLwo+PiAr
ICAgICAgICByZXQgPSAwOwo+PiArICAgIH0KPj4gKwo+PiArICAgIGdfbXV0ZXhfdW5sb2NrKCZk
LT5zaG1fY2FjaGVfbXV0ZXgpOwo+PiArICAgIHJldHVybiByZXQ7Cj4+ICt9Cj4+ICsKPj4gK3N0
YXRpYyBpbnQgc2htX2NhY2hlX2FkZChkaXNwbGF5X3QgKmQsIHNobV9zZWdtZW50X3QgKnNlZ21l
bnQpCj4+ICt7Cj4+ICsgICAgaW50IGksIHJldDsKPj4gKyAgICBzaG1fc2VnbWVudF90ICpzbWFs
bGVzdF9lbnRyeSA9IE5VTEw7Cj4+ICsgICAgc2htX3NlZ21lbnRfdCAqZW50cnlfdG9fdXNlID0g
TlVMTDsKPj4gKwo+PiArICAgIGdfbXV0ZXhfbG9jaygmZC0+c2htX2NhY2hlX211dGV4KTsKPj4g
Kwo+PiArICAgIC8qICdzZWdtZW50JyBpcyBub3cgdW51c2VkLCB0cnkgdG8gYWRkIGl0IHRvIHRo
ZSBjYWNoZS4KPj4gKyAgICAgKiBVc2UgYW4gZW1wdHkgc2xvdCBpbiB0aGUgY2FjaGUgaWYgYXZh
aWxhYmxlLgo+PiArICAgICAqIElmIG5vdCwgZXZpY3QgdGhlIHNtYWxsZXN0IGVudHJ5ICh3aGlj
aCBhbHNvIG11c3QgYmUgc21hbGxlciB0aGFuCj4+ICdzZWdtZW50JykgZnJvbSB0aGUgY2FjaGUu
Cj4+ICsgICAgICovCj4+ICsgICAgZm9yIChpID0gMDsgaSA8IEdfTl9FTEVNRU5UUyhkLT5zaG1f
Y2FjaGUpOyBpKyspIHsKPj4gKyAgICAgICAgc2htX3NlZ21lbnRfdCAqZW50cnkgPSAmZC0+c2ht
X2NhY2hlW2ldOwo+PiArCj4+ICsgICAgICAgIGlmIChlbnRyeS0+c2htaWQgPT0gLTEpIHsKPj4g
KyAgICAgICAgICAgIC8qIFVzZSBhbiBlbXB0eSBzbG90IGlmIGZvdW5kICovCj4+ICsgICAgICAg
ICAgICBlbnRyeV90b191c2UgPSBlbnRyeTsKPj4gKyAgICAgICAgICAgIGJyZWFrOwo+PiArICAg
ICAgICB9Cj4+ICsKPj4gKyAgICAgICAgLyogS2VlcCB0cmFjayBvZiB0aGUgc21hbGxlc3QgZW50
cnkgdGhhdCdzIHNtYWxsZXIgdGhhbiAnc2VnbWVudCcgKi8KPj4gKyAgICAgICAgaWYgKGVudHJ5
LT5zaXplIDwgc2VnbWVudC0+c2l6ZSkgewo+PiArICAgICAgICAgICAgaWYgKHNtYWxsZXN0X2Vu
dHJ5ICYmIGVudHJ5LT5zaXplIDwgc21hbGxlc3RfZW50cnktPnNpemUpIHsKPj4gKyAgICAgICAg
ICAgICAgICBzbWFsbGVzdF9lbnRyeSA9IGVudHJ5Owo+PiArICAgICAgICAgICAgfSBlbHNlIGlm
ICghc21hbGxlc3RfZW50cnkpIHsKPiAKPiBTaW1pbGFyIGhlcmUgKHNpbmdsZSBpZiksCj4gCj4g
ICAgaWYgKCFzbWFsbGVzdF9lbnRyeSB8fCBlbnRyeS0+c2l6ZSA8IHNtYWxsZXN0X2VudHJ5LT5z
aXplKSB7Cj4gCj4+ICsgICAgICAgICAgICAgICAgc21hbGxlc3RfZW50cnkgPSBlbnRyeTsKPj4g
KyAgICAgICAgICAgIH0KPj4gKyAgICAgICAgfQo+PiArICAgIH0KPj4gKwo+PiArICAgIC8qIElm
IG5vIGVtcHR5IGVudHJpZXMgd2VyZSBmb3VuZCwgZXZpY3QgJ3NtYWxsZXN0X2VudHJ5JyBhbmQg
cmV1c2UgaXQKPj4gKi8KPj4gKyAgICBpZiAoIWVudHJ5X3RvX3VzZSAmJiBzbWFsbGVzdF9lbnRy
eSkgewo+PiArICAgICAgICBzaG1fc2VnbWVudF9kZXN0cm95KGQsIHNtYWxsZXN0X2VudHJ5KTsK
Pj4gKyAgICAgICAgZW50cnlfdG9fdXNlID0gc21hbGxlc3RfZW50cnk7Cj4+ICsgICAgfQo+PiAr
Cj4+ICsgICAgaWYgKGVudHJ5X3RvX3VzZSkgewo+PiArICAgICAgICAqZW50cnlfdG9fdXNlID0g
KnNlZ21lbnQ7Cj4+ICsgICAgICAgIHJldCA9IDE7Cj4+ICsgICAgfSBlbHNlIHsKPj4gKyAgICAg
ICAgLyogQ2FjaGUgaXMgZnVsbCwgYW5kIGNvbnRhaW5lZCBubyBlbnRyaWVzIHNtYWxsZXIgdGhh
biB0aGUgb25lCj4+IGJlaW5nIGFkZGVkICovCj4+ICsgICAgICAgIHJldCA9IDA7Cj4+ICsgICAg
fQo+PiArCj4+ICsgICAgZ19tdXRleF91bmxvY2soJmQtPnNobV9jYWNoZV9tdXRleCk7Cj4+ICsg
ICAgcmV0dXJuIHJldDsKPj4gK30KPj4gKwo+PiArc3RhdGljIHZvaWQgc2htX2NhY2hlX2Rlc3Ry
b3koZGlzcGxheV90ICpkKQo+PiArewo+PiArICAgIGludCBpOwo+PiArCj4+ICsgICAgZ19tdXRl
eF9sb2NrKCZkLT5zaG1fY2FjaGVfbXV0ZXgpOwo+PiArICAgIGZvciAoaSA9IDA7IGkgPCBHX05f
RUxFTUVOVFMoZC0+c2htX2NhY2hlKTsgaSsrKSB7Cj4+ICsgICAgICAgIHNobV9zZWdtZW50X3Qg
KmVudHJ5ID0gJmQtPnNobV9jYWNoZVtpXTsKPj4gKwo+PiArICAgICAgICBzaG1fc2VnbWVudF9k
ZXN0cm95KGQsIGVudHJ5KTsKPj4gKyAgICB9Cj4+ICsgICAgZ19tdXRleF91bmxvY2soJmQtPnNo
bV9jYWNoZV9tdXRleCk7Cj4+ICt9Cj4+ICAgCj4+ICAgaW50IGRpc3BsYXlfb3BlbihkaXNwbGF5
X3QgKmQsIHNlc3Npb25fdCAqc2Vzc2lvbikKPj4gICB7Cj4+ICAgICAgIGludCBzY3I7Cj4+ICAg
ICAgIGludCByYzsKPj4gKyAgICBpbnQgaTsKPj4gICAgICAgeGNiX2RhbWFnZV9xdWVyeV92ZXJz
aW9uX2Nvb2tpZV90IGRjb29raWU7Cj4+ICAgICAgIHhjYl9kYW1hZ2VfcXVlcnlfdmVyc2lvbl9y
ZXBseV90ICpkYW1hZ2VfdmVyc2lvbjsKPj4gICAgICAgeGNiX3hrYl91c2VfZXh0ZW5zaW9uX2Nv
b2tpZV90IHVzZV9jb29raWU7Cj4+IEBAIC0zMTQsNiArNDU4LDExIEBAIGludCBkaXNwbGF5X29w
ZW4oZGlzcGxheV90ICpkLCBzZXNzaW9uX3QgKnNlc3Npb24pCj4+ICAgICAgIGlmIChyYykKPj4g
ICAgICAgICAgIHJldHVybiByYzsKPj4gICAKPj4gKyAgICBnX211dGV4X2luaXQoJmQtPnNobV9j
YWNoZV9tdXRleCk7Cj4+ICsgICAgZm9yIChpID0gMDsgaSA8IEdfTl9FTEVNRU5UUyhkLT5zaG1f
Y2FjaGUpOyBpKyspIHsKPj4gKyAgICAgICAgZC0+c2htX2NhY2hlW2ldLnNobWlkID0gLTE7Cj4+
ICsgICAgfQo+PiArCj4+ICAgICAgIHJjID0gZGlzcGxheV9jcmVhdGVfc2NyZWVuX2ltYWdlcyhk
KTsKPj4gICAKPj4gICAgICAgZ19tZXNzYWdlKCJEaXNwbGF5ICVzIG9wZW5lZCIsIHNlc3Npb24t
Pm9wdGlvbnMuZGlzcGxheSA/Cj4+ICAgICAgIHNlc3Npb24tPm9wdGlvbnMuZGlzcGxheSA6ICIi
KTsKPj4gQEAgLTMyMSwxNyArNDcwLDYgQEAgaW50IGRpc3BsYXlfb3BlbihkaXNwbGF5X3QgKmQs
IHNlc3Npb25fdCAqc2Vzc2lvbikKPj4gICAgICAgcmV0dXJuIHJjOwo+PiAgIH0KPj4gICAKPj4g
LS8qCj4+IC0gIFRPRE86IEltcGxlbWVudCBhIGNhY2hlIGZvciBzaGFyZWQgbWVtb3J5IGhhbmRs
ZXMKPj4gLSAgICAgICAgVGhhdCBpcywgaW5zdGVhZCBvZiBkb2luZyB0aGUgc2htZ2V0L3NobWF0
IGZvciBldmVyeSByZWFkLAo+PiAtICAgICAgICB3ZSBzaG91bGQgY2FjaGUgdGhlIHNobWlkLCBh
bmQgcmV1c2UgaWYgd2UncmUgZG9pbmcgYSBsYXRlcgo+PiAtICAgICAgICByZWFkIG9mIGEgc2lt
aWxhciBzaXplLgo+PiAtCj4+IC0gICAgICAgIFdlIHdvdWxkIGxpa2VseSBzZWUgYSA0MCUgaW1w
cm92ZW1lbnQgaW4gcmF3IHJlYWQgdGltZS4gIE5vdGUKPj4gLSAgICAgICAgdGhhdCBhIGNhbGxn
cmluZCBydW4gc3VnZ2VzdGVkIHRoYXQgd291bGQgYmUgb24gdGhlIG9yZGVyIG9mIDUlCj4+IC0g
ICAgICAgIG92ZXJhbGwuCj4+IC0qLwo+PiAtCj4+ICAgc2htX2ltYWdlX3QgKmNyZWF0ZV9zaG1f
aW1hZ2UoZGlzcGxheV90ICpkLCB1bnNpZ25lZCBpbnQgdywgdW5zaWduZWQgaW50IGgpCj4+ICAg
ewo+PiAgICAgICBzaG1faW1hZ2VfdCAqc2htaTsKPj4gQEAgLTM0OSw2ICs0ODcsMTEgQEAgc2ht
X2ltYWdlX3QgKmNyZWF0ZV9zaG1faW1hZ2UoZGlzcGxheV90ICpkLCB1bnNpZ25lZCBpbnQKPj4g
dywgdW5zaWduZWQgaW50IGgpCj4+ICAgICAgIHNobWktPmJ5dGVzX3Blcl9saW5lID0gKGJpdHNf
cGVyX3BpeGVsKGQpIC8gOCkgKiBzaG1pLT53Owo+PiAgICAgICBpbWdzaXplID0gc2htaS0+Ynl0
ZXNfcGVyX2xpbmUgKiBzaG1pLT5oOwo+PiAgIAo+PiArICAgIGlmIChzaG1fY2FjaGVfZ2V0KGQs
IGltZ3NpemUsICZzaG1pLT5zZWdtZW50KSkgewo+PiArICAgICAgICByZXR1cm4gc2htaTsKPj4g
KyAgICB9Cj4+ICsKPj4gKyAgICAvKiBObyB1c2FibGUgc2hhcmVkIG1lbW9yeSBzZWdtZW50IGZv
dW5kIGluIGNhY2hlLCBhbGxvY2F0ZSBhIG5ldyBvbmUgKi8KPj4gICAgICAgc2htaS0+c2VnbWVu
dC5zaG1pZCA9IHNobWdldChJUENfUFJJVkFURSwgaW1nc2l6ZSwgSVBDX0NSRUFUIHwgMDcwMCk7
Cj4+ICAgICAgIGlmIChzaG1pLT5zZWdtZW50LnNobWlkICE9IC0xKQo+PiAgICAgICAgICAgc2ht
aS0+c2VnbWVudC5zaG1hZGRyID0gc2htYXQoc2htaS0+c2VnbWVudC5zaG1pZCwgMCwgMCk7Cj4+
IEBAIC0zNjAsNiArNTAzLDcgQEAgc2htX2ltYWdlX3QgKmNyZWF0ZV9zaG1faW1hZ2UoZGlzcGxh
eV90ICpkLCB1bnNpZ25lZCBpbnQKPj4gdywgdW5zaWduZWQgaW50IGgpCj4+ICAgICAgIC8qIFdl
IHRlbGwgc2htY3RsIHRvIGRldGFjaCBub3c7IHRoYXQgcHJldmVudHMgdXMgZnJvbSBob2xkaW5n
IHRoaXMKPj4gICAgICAgICAgc2hhcmVkIG1lbW9yeSBzZWdtZW50IGZvcmV2ZXIgaW4gY2FzZSBv
ZiBhYm5vcm1hbCBwcm9jZXNzIGV4aXQuICovCj4+ICAgICAgIHNobWN0bChzaG1pLT5zZWdtZW50
LnNobWlkLCBJUENfUk1JRCwgTlVMTCk7Cj4+ICsgICAgc2htaS0+c2VnbWVudC5zaXplID0gaW1n
c2l6ZTsKPj4gICAKPj4gICAgICAgc2htaS0+c2VnbWVudC5zaG1zZWcgPSB4Y2JfZ2VuZXJhdGVf
aWQoZC0+Yyk7Cj4+ICAgICAgIGNvb2tpZSA9IHhjYl9zaG1fYXR0YWNoX2NoZWNrZWQoZC0+Yywg
c2htaS0+c2VnbWVudC5zaG1zZWcsCj4+ICAgICAgIHNobWktPnNlZ21lbnQuc2htaWQsIDApOwo+
PiBAQCAtNDUxLDkgKzU5NSwxMCBAQCB2b2lkIGRpc3BsYXlfY29weV9pbWFnZV9pbnRvX2Z1bGxz
Y3JlZW4oZGlzcGxheV90ICpkLAo+PiBzaG1faW1hZ2VfdCAqc2htaSwgaW50IHgsCj4+ICAgCj4+
ICAgdm9pZCBkZXN0cm95X3NobV9pbWFnZShkaXNwbGF5X3QgKmQsIHNobV9pbWFnZV90ICpzaG1p
KQo+PiAgIHsKPj4gLSAgICB4Y2Jfc2htX2RldGFjaChkLT5jLCBzaG1pLT5zZWdtZW50LnNobXNl
Zyk7Cj4+IC0gICAgc2htZHQoc2htaS0+c2VnbWVudC5zaG1hZGRyKTsKPj4gLSAgICBzaG1jdGwo
c2htaS0+c2VnbWVudC5zaG1pZCwgSVBDX1JNSUQsIE5VTEwpOwo+PiArICAgIGlmICghc2htX2Nh
Y2hlX2FkZChkLCAmc2htaS0+c2VnbWVudCkpIHsKPj4gKyAgICAgICAgLyogQ291bGQgbm90IGFk
ZCB0byBjYWNoZSwgZGVzdHJveSB0aGlzIHNlZ21lbnQgKi8KPj4gKyAgICAgICAgc2htX3NlZ21l
bnRfZGVzdHJveShkLCAmc2htaS0+c2VnbWVudCk7Cj4+ICsgICAgfQo+PiAgICAgICBpZiAoc2ht
aS0+ZHJhd2FibGVfcHRyKQo+PiAgICAgICAgICAgZnJlZShzaG1pLT5kcmF3YWJsZV9wdHIpOwo+
PiAgICAgICBmcmVlKHNobWkpOwo+PiBAQCAtNTIxLDYgKzY2Niw4IEBAIHZvaWQgZGlzcGxheV9z
dG9wX2V2ZW50X3RocmVhZChkaXNwbGF5X3QgKmQpCj4+ICAgCj4+ICAgdm9pZCBkaXNwbGF5X2Ns
b3NlKGRpc3BsYXlfdCAqZCkKPj4gICB7Cj4+ICsgICAgc2htX2NhY2hlX2Rlc3Ryb3koZCk7Cj4+
ICsgICAgZ19tdXRleF9jbGVhcigmZC0+c2htX2NhY2hlX211dGV4KTsKPj4gICAgICAgeGNiX2Rh
bWFnZV9kZXN0cm95KGQtPmMsIGQtPmRhbWFnZSk7Cj4+ICAgICAgIGRpc3BsYXlfZGVzdHJveV9z
Y3JlZW5faW1hZ2VzKGQpOwo+PiAgICAgICB4Y2JfZGlzY29ubmVjdChkLT5jKTsKPj4gZGlmZiAt
LWdpdCBhL3NyYy9kaXNwbGF5LmggYi9zcmMvZGlzcGxheS5oCj4+IGluZGV4IGRhMWI5OTEuLjBh
ZWEzNDggMTAwNjQ0Cj4+IC0tLSBhL3NyYy9kaXNwbGF5LmgKPj4gKysrIGIvc3JjL2Rpc3BsYXku
aAo+PiBAQCAtMjEsMTggKzIxLDE5IEBACj4+ICAgI2lmbmRlZiBESVNQTEFZX0hfCj4+ICAgI2Rl
ZmluZSBESVNQTEFZX0hfCj4+ICAgCj4+ICsjaW5jbHVkZSA8Z2xpYi5oPgo+PiAgICNpbmNsdWRl
IDx4Y2IveGNiLmg+Cj4+ICAgI2luY2x1ZGUgPHhjYi9kYW1hZ2UuaD4KPj4gICAjaW5jbHVkZSA8
eGNiL3NobS5oPgo+PiAgIAo+PiAtCj4+ICAgc3RydWN0IHNlc3Npb25fc3RydWN0Owo+PiAgIAo+
PiAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQo+PiAgICoqICBTdHJ1Y3R1cmUgZGVmaW5pdGlvbnMK
Pj4gICAqKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KPj4gICB0eXBlZGVmIHN0cnVjdCB7Cj4+IC0gICAg
aW50IHNobWlkOwo+PiArICAgIGludCBzaG1pZDsgICAgICAvKiBpZiBzaG1pZCBpcyAtMTogdGhl
IHNobV9zZWdtZW50X3QgaXMgImVtcHR5Iiwgb3RoZXIKPj4gbWVtYmVycyBhcmUgdW5kZWZpbmVk
ICovCj4+ICsgICAgc2l6ZV90IHNpemU7Cj4+ICAgICAgIHhjYl9zaG1fc2VnX3Qgc2htc2VnOwo+
PiAgICAgICB2b2lkICpzaG1hZGRyOwo+PiAgIH0gc2htX3NlZ21lbnRfdDsKPj4gQEAgLTYzLDYg
KzY0LDEyIEBAIHR5cGVkZWYgc3RydWN0IHsKPj4gICAgICAgc2htX2ltYWdlX3QgKmZ1bGxzY3Jl
ZW47Cj4+ICAgICAgIHNobV9pbWFnZV90ICpzY2FubGluZTsKPj4gICAKPj4gKyAgICAvKiBUaGUg
U0hNIGNhY2hlIGhvbGRzIHVwIHRvIDEwIHNlZ21lbnRzLCB0aGlzIHByb3ZpZGVzIGEgZ29vZCBj
YWNoZQo+PiArICAgICAqIGhpdCByYXRlIHdoaWxlIGtlZXBpbmcgbWVtb3J5IHVzYWdlIHJlYXNv
bmFibGUuCj4+ICsgICAgICovCj4+ICsgICAgc2htX3NlZ21lbnRfdCBzaG1fY2FjaGVbMTBdOwo+
PiArICAgIEdNdXRleCBzaG1fY2FjaGVfbXV0ZXg7Cj4+ICsKPj4gICAgICAgcHRocmVhZF90IGV2
ZW50X3RocmVhZDsKPj4gICAgICAgc3RydWN0IHNlc3Npb25fc3RydWN0ICpzZXNzaW9uOwo+PiAg
IH0gZGlzcGxheV90Owo+IAo+IEl0IHNlZW1zIGZpbmUsIGxhc3Qgd29yZCB0byBKZXJlbXkKPiAK
PiBGcmVkaWFubwo+IAo+IF9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCj4gU3BpY2UtZGV2ZWwgbWFpbGluZyBsaXN0Cj4gU3BpY2UtZGV2ZWxAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCj4gaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9zcGljZS1kZXZlbAo+IAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KU3BpY2UtZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL3NwaWNlLWRldmVs
