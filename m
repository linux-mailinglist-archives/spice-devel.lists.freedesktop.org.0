Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 2F21655C81
	for <lists+spice-devel@lfdr.de>; Wed, 26 Jun 2019 01:44:40 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2C96A6E185;
	Tue, 25 Jun 2019 23:44:38 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail.codeweavers.com (mail.codeweavers.com [50.203.203.244])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A64606E185
 for <spice-devel@lists.freedesktop.org>; Tue, 25 Jun 2019 23:44:36 +0000 (UTC)
Received: from 82-64-54-218.subs.proxad.net ([82.64.54.218] helo=amboise)
 by mail.codeweavers.com with esmtpsa (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.89) (envelope-from <fgouget@free.fr>) id 1hfv7a-0003Lo-Ku
 for spice-devel@lists.freedesktop.org; Tue, 25 Jun 2019 18:45:08 -0500
Received: from fgouget by amboise with local (Exim 4.92)
 (envelope-from <fgouget@amboise.dolphin>) id 1hfv73-00006Y-9Q
 for spice-devel@lists.freedesktop.org; Wed, 26 Jun 2019 01:44:33 +0200
Date: Wed, 26 Jun 2019 01:44:33 +0200 (CEST)
From: Francois Gouget <fgouget@codeweavers.com>
To: Spice devel <spice-devel@lists.freedesktop.org>
Message-ID: <9e4beeec69d6cb7be4e5c9d4b292f2761d5158e2.1561506197.git.fgouget@free.fr>
User-Agent: Alpine 2.21 (DEB 202 2017-01-01)
MIME-Version: 1.0
X-Spam-Score: -103.7
X-Spam-Report: Spam detection software,
 running on the system "mail.codeweavers.com", 
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  The client is in a better position than the server to pick
 the minimum lag needed to compensate for frame arrival time jitter and ensure
 smooth video playback. To do so: - It ignores the lag specified [...] 
 Content analysis details:   (-103.7 points, 5.0 required)
 pts rule name              description
 ---- ---------------------- --------------------------------------------------
 -100 USER_IN_WHITELIST      From: address is in the user's white-list
 -6.0 ALL_TRUSTED            Passed through trusted hosts only via SMTP
 0.0 TVD_RCVD_IP            Message was received from an IP address
 1.0 HEADER_FROM_DIFFERENT_DOMAINS From and EnvelopeFrom 2nd level
 mail domains are different
 1.0 FREEMAIL_FROM          Sender email is commonly abused enduser mail
 provider (fgouget[at]free.fr)
 0.2 FREEMAIL_FORGED_FROMDOMAIN 2nd level domains in From and
 EnvelopeFrom freemail headers are different
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; 
 d=codeweavers.com; s=6377696661; h=Content-Type:MIME-Version:Message-ID:
 Subject:To:From:Date:Sender:Reply-To:Cc:Content-Transfer-Encoding:Content-ID:
 Content-Description:Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc
 :Resent-Message-ID:In-Reply-To:References:List-Id:List-Help:List-Unsubscribe:
 List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=VboqmA6vVg71eM5H8J99T9f44ULXKcyqmWUx1qrr9TI=; b=cGy2YaeCHZYZG3cJ8nWRxkOWGU
 pKyuf83XtywozeNqVzzHHdnd9a75IKgjt+3JhR/2C7/sDPaH8hKtEhKe0n+O1z5tGi06fAa6evgkZ
 5/so26LXZYp+jt+I9dnfKkvAvhLxFePZXCCa3COvInGDEfOXVZFvLaWdKokj06EqRk6M=;
Subject: [Spice-devel] [client v3 1/6] channel-display: Minimize the stream
 lag by ignoring the server one
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

VGhlIGNsaWVudCBpcyBpbiBhIGJldHRlciBwb3NpdGlvbiB0aGFuIHRoZSBzZXJ2ZXIgdG8gcGlj
ayB0aGUgbWluaW11bQpsYWcgbmVlZGVkIHRvIGNvbXBlbnNhdGUgZm9yIGZyYW1lIGFycml2YWwg
dGltZSBqaXR0ZXIgYW5kIGVuc3VyZQpzbW9vdGggdmlkZW8gcGxheWJhY2suClRvIGRvIHNvOgot
IEl0IGlnbm9yZXMgdGhlIGxhZyBzcGVjaWZpZWQgYnkgdGhlIHNlcnZlciB0aHJvdWdoIHRoZSBt
bXRpbWUgY2xvY2sKICBhZGp1c3RtZW50cyAoYnV0IHRoaXMgbGFnIGlzIHN0aWxsIHRyYWNrZWQg
Zm9yIHRoZSBzdHJlYW0gcmVwb3J0cykuCi0gSXQgcGVyZm9ybXMgaXRzIG93biBmcmFtZSBtbXRp
bWUgY29udmVyc2lvbiB0byB0aGUgbG9jYWwgbW9ub3RvbmljCiAgY2xvY2sgc3BpY2Vfc2Vzc2lv
bl9tbXRpbWUyY2xpZW50X3RpbWUoKSBzaW5jZSB0aGUgc2VydmVyLWNvbnRyb2xsZWQKICBtbXRp
bWUgY2xvY2sgY2Fubm90IGJlIHJlbGllZCBvbi4gVGhpcyBjb252ZXJzaW9uIHVzZXMgZGF0YSBm
cm9tIGFsbAogIHN0cmVhbXMgYnV0IGlzIGdsb2JhbCBzbyBhbGwgc3RyZWFtcyBoYXZlIGEgY29t
bW9uIHRpbWUgcmVmZXJlbmNlLgotIHNwaWNlX3Nlc3Npb25fbW10aW1lMmNsaWVudF90aW1lKCkg
YWxzbyBoYW5kbGVzIHRoZSBtbXRpbWUgY2xvY2sKICBjaGFuZ2VzIGNhdXNlZCBieSBzZXJ2ZXIg
bWlncmF0aW9uLgotIEl0IHRyYWNrcyB0aGUgbWFyZ2luIGJldHdlZW4gdGhlIGNvbnZlcnRlZCB0
aW1lLXRvLWRpc3BsYXkgZnJhbWUKICB0aW1lc3RhbXAgYW5kIHRoZSBjdXJyZW50IHRpbWUgYW5k
IGFkZHMgYSBkZWxheSB0byBlbnN1cmUgdGhpcyBtYXJnaW4KICByZW1haW5zIHBvc2l0aXZlLgot
IFRoaXMgZGVsYXkgaW50cm9kdWNlcyB0aGUgdmlkZW8gc3RyZWFtIGxhZy4gSXQgaXMgY29udGlu
dW91c2x5CiAgYWRqdXN0ZWQgdG8gZWl0aGVyIGJlIGFzIGxvdyBhcyBwb3NzaWJsZSwgb3IgbWF0
Y2ggdGhlIGF1ZGlvCiAgcGxheWJhY2sgZGVsYXkgZm9yIHByb3BlciBsaXAgc3luYy4KLSBEZWxh
eSBhZGp1c3RtZW50cyBhcmUgZ3JhZHVhbCwgc3BlZWRpbmcgdXAgb3Igc2xvd2luZyBkb3duIHZp
ZGVvCiAgcGxheWJhY2sgdW50aWwgdGhlIGF2ZXJhZ2UgbWFyZ2luIG1hdGNoZXMgdGhlIHRhcmdl
dCBsYWcuCi0gQ2hhbmdlcyBpbiB0aGUgYXZlcmFnZSBtYXJnaW4gYXJlIHRyYWNrZWQgKHNlZSBt
YXJnaW5fc3ByZWFkKSB0bwogIGF2b2lkIG51ZGdpbmcgdGhlIGRlbGF5IGluIHJlc3BvbnNlIHRv
IG1pbm9yIHJhbmRvbSB2YXJpYXRpb25zLgoKU2lnbmVkLW9mZi1ieTogRnJhbmNvaXMgR291Z2V0
IDxmZ291Z2V0QGNvZGV3ZWF2ZXJzLmNvbT4KLS0tCgp2MzogTWFueSBjaGFuZ2VzIGJhc2VkIG9u
IHByZXZpb3VzIGZlZWRiYWNrLgoKIHNyYy9jaGFubmVsLWRpc3BsYXktZ3N0LmMgICB8ICAyMCAr
Ky0tCiBzcmMvY2hhbm5lbC1kaXNwbGF5LW1qcGVnLmMgfCAgMTQgKy0tCiBzcmMvY2hhbm5lbC1k
aXNwbGF5LXByaXYuaCAgfCAgMjQgKysrKy0KIHNyYy9jaGFubmVsLWRpc3BsYXkuYyAgICAgICB8
IDE4MCArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0KIHNyYy9zcGljZS1zZXNz
aW9uLXByaXYuaCAgICB8ICAgMSArCiBzcmMvc3BpY2Utc2Vzc2lvbi5jICAgICAgICAgfCAgNDYg
KysrKysrKysrCiA2IGZpbGVzIGNoYW5nZWQsIDI0NyBpbnNlcnRpb25zKCspLCAzOCBkZWxldGlv
bnMoLSkKCmRpZmYgLS1naXQgYS9zcmMvY2hhbm5lbC1kaXNwbGF5LWdzdC5jIGIvc3JjL2NoYW5u
ZWwtZGlzcGxheS1nc3QuYwppbmRleCA2ZmNjZjYyMS4uN2FkNjAwOWIgMTAwNjQ0Ci0tLSBhL3Ny
Yy9jaGFubmVsLWRpc3BsYXktZ3N0LmMKKysrIGIvc3JjL2NoYW5uZWwtZGlzcGxheS1nc3QuYwpA
QCAtNTAsNyArNTAsNyBAQCB0eXBlZGVmIHN0cnVjdCBTcGljZUdzdERlY29kZXIgewogCiAgICAg
LyogLS0tLS0tLS0tLSBEZWNvZGluZyBhbmQgZGlzcGxheSBxdWV1ZXMgLS0tLS0tLS0tLSAqLwog
Ci0gICAgdWludDMyX3QgbGFzdF9tbV90aW1lOworICAgIHVpbnQzMl90IGxhc3RfZnJhbWVfdGlt
ZTsKIAogICAgIEdNdXRleCBxdWV1ZXNfbXV0ZXg7CiAgICAgR1F1ZXVlICpkZWNvZGluZ19xdWV1
ZTsKQEAgLTI5Nyw4ICsyOTcsOCBAQCBzdGF0aWMgdm9pZCBzY2hlZHVsZV9mcmFtZShTcGljZUdz
dERlY29kZXIgKmRlY29kZXIpCiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgfQogCi0gICAg
ICAgIGlmIChzcGljZV9tbXRpbWVfZGlmZihnc3RmcmFtZS0+ZW5jb2RlZF9mcmFtZS0+bW1fdGlt
ZSwgbm93KSA+PSAwKSB7Ci0gICAgICAgICAgICBkZWNvZGVyLT50aW1lcl9pZCA9IGdfdGltZW91
dF9hZGQoZ3N0ZnJhbWUtPmVuY29kZWRfZnJhbWUtPm1tX3RpbWUgLSBub3csCisgICAgICAgIGlm
IChzcGljZV9tbXRpbWVfZGlmZihnc3RmcmFtZS0+ZW5jb2RlZF9mcmFtZS0+dGltZSwgbm93KSA+
PSAwKSB7CisgICAgICAgICAgICBkZWNvZGVyLT50aW1lcl9pZCA9IGdfdGltZW91dF9hZGQoZ3N0
ZnJhbWUtPmVuY29kZWRfZnJhbWUtPnRpbWUgLSBub3csCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheV9mcmFtZSwgZGVjb2Rlcik7CiAgICAgICAg
IH0gZWxzZSBpZiAoZGVjb2Rlci0+ZGlzcGxheV9mcmFtZSAmJiAhZGVjb2Rlci0+cGVuZGluZ19z
YW1wbGVzKSB7CiAgICAgICAgICAgICAvKiBTdGlsbCBhdHRlbXB0IHRvIGRpc3BsYXkgdGhlIGxl
YXN0IG91dCBvZiBkYXRlIGZyYW1lIHNvIHRoZQpAQCAtMzA3LDggKzMwNyw4IEBAIHN0YXRpYyB2
b2lkIHNjaGVkdWxlX2ZyYW1lKFNwaWNlR3N0RGVjb2RlciAqZGVjb2RlcikKICAgICAgICAgICAg
IGRlY29kZXItPnRpbWVyX2lkID0gZ190aW1lb3V0X2FkZCgwLCBkaXNwbGF5X2ZyYW1lLCBkZWNv
ZGVyKTsKICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgIFNQSUNFX0RFQlVHKCIlczogcmVu
ZGVyaW5nIHRvbyBsYXRlIGJ5ICV1IG1zICh0czogJXUsIG1tdGltZTogJXUpLCBkcm9wcGluZyIs
Ci0gICAgICAgICAgICAgICAgICAgICAgICBfX0ZVTkNUSU9OX18sIG5vdyAtIGdzdGZyYW1lLT5l
bmNvZGVkX2ZyYW1lLT5tbV90aW1lLAotICAgICAgICAgICAgICAgICAgICAgICAgZ3N0ZnJhbWUt
PmVuY29kZWRfZnJhbWUtPm1tX3RpbWUsIG5vdyk7CisgICAgICAgICAgICAgICAgICAgICAgICBf
X0ZVTkNUSU9OX18sIG5vdyAtIGdzdGZyYW1lLT5lbmNvZGVkX2ZyYW1lLT50aW1lLAorICAgICAg
ICAgICAgICAgICAgICAgICAgZ3N0ZnJhbWUtPmVuY29kZWRfZnJhbWUtPnRpbWUsIG5vdyk7CiAg
ICAgICAgICAgICBzdHJlYW1fZHJvcHBlZF9mcmFtZV9vbl9wbGF5YmFjayhkZWNvZGVyLT5iYXNl
LnN0cmVhbSk7CiAgICAgICAgICAgICBkZWNvZGVyLT5kaXNwbGF5X2ZyYW1lID0gTlVMTDsKICAg
ICAgICAgICAgIGZyZWVfZ3N0X2ZyYW1lKGdzdGZyYW1lKTsKQEAgLTQ0OSw3ICs0NDksNyBAQCBz
aW5rX2V2ZW50X3Byb2JlKEdzdFBhZCAqcGFkLCBHc3RQYWRQcm9iZUluZm8gKmluZm8sIGdwb2lu
dGVyIGRhdGEpCiAgICAgICAgICAgICAgKiAgIG9yIG1vcmUgZnJhbWUgaW50ZXJ2YWxzLgogICAg
ICAgICAgICAgICovCiAgICAgICAgICAgICByZWNvcmQoZnJhbWVzX3N0YXRzLAotICAgICAgICAg
ICAgICAgICAgICJmcmFtZSBtbV90aW1lICV1IHNpemUgJXUgY3JlYXRpb24gdGltZSAlIiBQUklk
NjQKKyAgICAgICAgICAgICAgICAgICAiZnJhbWUgdGltZSAldSBzaXplICV1IGNyZWF0aW9uIHRp
bWUgJSIgUFJJZDY0CiAgICAgICAgICAgICAgICAgICAgIiBkZWNvZGVkIHRpbWUgJSIgUFJJZDY0
ICIgcXVldWUgJXUgYmVmb3JlICV1IiwKICAgICAgICAgICAgICAgICAgICBmcmFtZS0+bW1fdGlt
ZSwgZnJhbWUtPnNpemUsIGZyYW1lLT5jcmVhdGlvbl90aW1lLCBkdXJhdGlvbiwKICAgICAgICAg
ICAgICAgICAgICBkZWNvZGVyLT5kZWNvZGluZ19xdWV1ZS0+bGVuZ3RoLCBnc3RmcmFtZS0+cXVl
dWVfbGVuKTsKQEAgLTY4OSwxMyArNjg5LDEzIEBAIHN0YXRpYyBnYm9vbGVhbiBzcGljZV9nc3Rf
ZGVjb2Rlcl9xdWV1ZV9mcmFtZShWaWRlb0RlY29kZXIgKnZpZGVvX2RlY29kZXIsCiAgICAgICAg
IHJldHVybiBUUlVFOwogICAgIH0KIAotICAgIGlmIChzcGljZV9tbXRpbWVfZGlmZihmcmFtZS0+
bW1fdGltZSwgZGVjb2Rlci0+bGFzdF9tbV90aW1lKSA8IDApIHsKKyAgICBpZiAoc3BpY2VfbW10
aW1lX2RpZmYoZnJhbWUtPnRpbWUsIGRlY29kZXItPmxhc3RfZnJhbWVfdGltZSkgPCAwKSB7CiAg
ICAgICAgIFNQSUNFX0RFQlVHKCJuZXctZnJhbWUtdGltZSA8IGxhc3QtZnJhbWUtdGltZSAoJXUg
PCAldSk6IgogICAgICAgICAgICAgICAgICAgICAiIHJlc2V0dGluZyBzdHJlYW0iLAotICAgICAg
ICAgICAgICAgICAgICBmcmFtZS0+bW1fdGltZSwgZGVjb2Rlci0+bGFzdF9tbV90aW1lKTsKKyAg
ICAgICAgICAgICAgICAgICAgZnJhbWUtPnRpbWUsIGRlY29kZXItPmxhc3RfZnJhbWVfdGltZSk7
CiAgICAgICAgIC8qIExldCBHU3RyZWFtZXIgZGVhbCB3aXRoIHRoZSBmcmFtZSBhbnl3YXkgKi8K
ICAgICB9Ci0gICAgZGVjb2Rlci0+bGFzdF9tbV90aW1lID0gZnJhbWUtPm1tX3RpbWU7CisgICAg
ZGVjb2Rlci0+bGFzdF9mcmFtZV90aW1lID0gZnJhbWUtPnRpbWU7CiAKICAgICBpZiAobWFyZ2lu
IDwgMCAmJgogICAgICAgICBkZWNvZGVyLT5iYXNlLmNvZGVjX3R5cGUgPT0gU1BJQ0VfVklERU9f
Q09ERUNfVFlQRV9NSlBFRykgewpAQCAtNzc4LDcgKzc3OCw3IEBAIFZpZGVvRGVjb2RlciogY3Jl
YXRlX2dzdHJlYW1lcl9kZWNvZGVyKGludCBjb2RlY190eXBlLCBkaXNwbGF5X3N0cmVhbSAqc3Ry
ZWFtKQogICAgICAgICBkZWNvZGVyLT5iYXNlLnF1ZXVlX2ZyYW1lID0gc3BpY2VfZ3N0X2RlY29k
ZXJfcXVldWVfZnJhbWU7CiAgICAgICAgIGRlY29kZXItPmJhc2UuY29kZWNfdHlwZSA9IGNvZGVj
X3R5cGU7CiAgICAgICAgIGRlY29kZXItPmJhc2Uuc3RyZWFtID0gc3RyZWFtOwotICAgICAgICBk
ZWNvZGVyLT5sYXN0X21tX3RpbWUgPSBzdHJlYW1fZ2V0X3RpbWUoc3RyZWFtKTsKKyAgICAgICAg
ZGVjb2Rlci0+bGFzdF9mcmFtZV90aW1lID0gc3RyZWFtX2dldF90aW1lKHN0cmVhbSk7CiAgICAg
ICAgIGdfbXV0ZXhfaW5pdCgmZGVjb2Rlci0+cXVldWVzX211dGV4KTsKICAgICAgICAgZGVjb2Rl
ci0+ZGVjb2RpbmdfcXVldWUgPSBnX3F1ZXVlX25ldygpOwogCmRpZmYgLS1naXQgYS9zcmMvY2hh
bm5lbC1kaXNwbGF5LW1qcGVnLmMgYi9zcmMvY2hhbm5lbC1kaXNwbGF5LW1qcGVnLmMKaW5kZXgg
NjQ3ZDMxYjAuLmQzYWI3N2M4IDEwMDY0NAotLS0gYS9zcmMvY2hhbm5lbC1kaXNwbGF5LW1qcGVn
LmMKKysrIGIvc3JjL2NoYW5uZWwtZGlzcGxheS1tanBlZy5jCkBAIC0xODEsMTYgKzE4MSwxNiBA
QCBzdGF0aWMgdm9pZCBtanBlZ19kZWNvZGVyX3NjaGVkdWxlKE1KcGVnRGVjb2RlciAqZGVjb2Rl
cikKICAgICBkZWNvZGVyLT5jdXJfZnJhbWUgPSBOVUxMOwogICAgIGRvIHsKICAgICAgICAgaWYg
KGZyYW1lKSB7Ci0gICAgICAgICAgICBpZiAoc3BpY2VfbW10aW1lX2RpZmYodGltZSwgZnJhbWUt
Pm1tX3RpbWUpIDw9IDApIHsKLSAgICAgICAgICAgICAgICBndWludDMyIGQgPSBmcmFtZS0+bW1f
dGltZSAtIHRpbWU7CisgICAgICAgICAgICBpZiAoc3BpY2VfbW10aW1lX2RpZmYodGltZSwgZnJh
bWUtPnRpbWUpIDw9IDApIHsKKyAgICAgICAgICAgICAgICBndWludDMyIGQgPSBmcmFtZS0+dGlt
ZSAtIHRpbWU7CiAgICAgICAgICAgICAgICAgZGVjb2Rlci0+Y3VyX2ZyYW1lID0gZnJhbWU7CiAg
ICAgICAgICAgICAgICAgZGVjb2Rlci0+dGltZXJfaWQgPSBnX3RpbWVvdXRfYWRkKGQsIG1qcGVn
X2RlY29kZXJfZGVjb2RlX2ZyYW1lLCBkZWNvZGVyKTsKICAgICAgICAgICAgICAgICBicmVhazsK
ICAgICAgICAgICAgIH0KIAogICAgICAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiByZW5kZXJpbmcg
dG9vIGxhdGUgYnkgJXUgbXMgKHRzOiAldSwgbW10aW1lOiAldSksIGRyb3BwaW5nICIsCi0gICAg
ICAgICAgICAgICAgICAgICAgICBfX0ZVTkNUSU9OX18sIHRpbWUgLSBmcmFtZS0+bW1fdGltZSwK
LSAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lLT5tbV90aW1lLCB0aW1lKTsKKyAgICAgICAg
ICAgICAgICAgICAgICAgIF9fRlVOQ1RJT05fXywgdGltZSAtIGZyYW1lLT50aW1lLAorICAgICAg
ICAgICAgICAgICAgICAgICAgZnJhbWUtPnRpbWUsIHRpbWUpOwogICAgICAgICAgICAgc3RyZWFt
X2Ryb3BwZWRfZnJhbWVfb25fcGxheWJhY2soZGVjb2Rlci0+YmFzZS5zdHJlYW0pOwogICAgICAg
ICAgICAgc3BpY2VfZnJhbWVfZnJlZShmcmFtZSk7CiAgICAgICAgIH0KQEAgLTIyNiwxMiArMjI2
LDEyIEBAIHN0YXRpYyBnYm9vbGVhbiBtanBlZ19kZWNvZGVyX3F1ZXVlX2ZyYW1lKFZpZGVvRGVj
b2RlciAqdmlkZW9fZGVjb2RlciwKIAogICAgIGxhc3RfZnJhbWUgPSBnX3F1ZXVlX3BlZWtfdGFp
bChkZWNvZGVyLT5tc2dxKTsKICAgICBpZiAobGFzdF9mcmFtZSkgewotICAgICAgICBpZiAoc3Bp
Y2VfbW10aW1lX2RpZmYoZnJhbWUtPm1tX3RpbWUsIGxhc3RfZnJhbWUtPm1tX3RpbWUpIDwgMCkg
eworICAgICAgICBpZiAoc3BpY2VfbW10aW1lX2RpZmYoZnJhbWUtPnRpbWUsIGxhc3RfZnJhbWUt
PnRpbWUpIDwgMCkgewogICAgICAgICAgICAgLyogVGhpcyBzaG91bGQgcmVhbGx5IG5vdCBoYXBw
ZW4gKi8KICAgICAgICAgICAgIFNQSUNFX0RFQlVHKCJuZXctZnJhbWUtdGltZSA8IGxhc3QtZnJh
bWUtdGltZSAoJXUgPCAldSk6IgogICAgICAgICAgICAgICAgICAgICAgICAgIiByZXNldHRpbmcg
c3RyZWFtIiwKLSAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lLT5tbV90aW1lLAotICAgICAg
ICAgICAgICAgICAgICAgICAgbGFzdF9mcmFtZS0+bW1fdGltZSk7CisgICAgICAgICAgICAgICAg
ICAgICAgICBmcmFtZS0+dGltZSwKKyAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RfZnJhbWUt
PnRpbWUpOwogICAgICAgICAgICAgbWpwZWdfZGVjb2Rlcl9kcm9wX3F1ZXVlKGRlY29kZXIpOwog
ICAgICAgICB9CiAgICAgfQpkaWZmIC0tZ2l0IGEvc3JjL2NoYW5uZWwtZGlzcGxheS1wcml2Lmgg
Yi9zcmMvY2hhbm5lbC1kaXNwbGF5LXByaXYuaAppbmRleCA0OTVkZjdhYy4uMmNhNDNlMjUgMTAw
NjQ0Ci0tLSBhL3NyYy9jaGFubmVsLWRpc3BsYXktcHJpdi5oCisrKyBiL3NyYy9jaGFubmVsLWRp
c3BsYXktcHJpdi5oCkBAIC0zOSwxNCArMzksMTggQEAgdHlwZWRlZiBzdHJ1Y3QgZGlzcGxheV9z
dHJlYW0gZGlzcGxheV9zdHJlYW07CiAKIHR5cGVkZWYgc3RydWN0IFNwaWNlRnJhbWUgU3BpY2VG
cmFtZTsKIHN0cnVjdCBTcGljZUZyYW1lIHsKLSAgICB1aW50MzJfdCBtbV90aW1lOworICAgIC8q
IERpc3BsYXkgdGltZS4gU2VlIHN0cmVhbV9nZXRfdGltZSgpLiAqLworICAgIHVpbnQzMl90IHRp
bWU7CisKICAgICBTcGljZVJlY3QgZGVzdDsKIAogICAgIHVpbnQ4X3QgKmRhdGE7CiAgICAgdWlu
dDMyX3Qgc2l6ZTsKICAgICBncG9pbnRlciBkYXRhX29wYXF1ZTsKIAotICAgIC8qIHN0YXRzICov
CisgICAgLyogRm9yIHN0YXRpc3RpY3MgYW5kIHRvIGNvcnJlbGF0ZSB3aXRoIHRoZSBzZXJ2ZXIg
bG9ncyBmb3IgZGVidWdnaW5nLiAqLworICAgIHVpbnQzMl90IG1tX3RpbWU7CisgICAgLyogVG8g
Y29tcHV0ZSBkZWNvZGluZyB0aW1lIGZvciBzdGF0aXN0aWNzLiAqLwogICAgIGdpbnQ2NCBjcmVh
dGlvbl90aW1lOwogfTsKIApAQCAtMTI0LDYgKzEyOCwyMiBAQCBzdHJ1Y3QgZGlzcGxheV9zdHJl
YW0gewogCiAgICAgU3BpY2VDaGFubmVsICAgICAgICAgICAgICAgICpjaGFubmVsOwogCisgICAg
dWludDMyX3QgICAgICAgICAgICAgbGFzdF9mcmFtZV9tbV90aW1lOworICAgIHVpbnQzMl90ICAg
ICAgICAgICAgIGxhc3RfZnJhbWVfdGltZTsKKworICAgIC8qIGxhZyBtYW5hZ2VtZW50IChzZWUg
ZGlzcGxheV9oYW5kbGVfc3RyZWFtX2RhdGEoKSkgKi8KKyAgICB1aW50MzJfdCAgICAgICAgICAg
ICBkZWxheTsKKyAgICBpbnQzMl90ICAgICAgICAgICAgICBtaW5fbWFyZ2luOworICAgIGZsb2F0
ICAgICAgICAgICAgICAgIGF2Z19tYXJnaW47CisgICAgdWludDMyX3QgICAgICAgICAgICAgbWFy
Z2luX3NwcmVhZDsKKworICAgIC8qIG1hcmdpbiBldmFsdWF0aW9uICovCisgICAgdWludDMyX3Qg
ICAgICAgICAgICAgbWFyZ2luX2V2YWxfc3RhcnQ7CisgICAgdWludDMyX3QgICAgICAgICAgICAg
bWFyZ2luX2V2YWxfY291bnQ7CisgICAgaW50MzJfdCAgICAgICAgICAgICAgbWluX21hcmdpbl9u
ZXh0OworICAgIGludDMyX3QgICAgICAgICAgICAgIG1pbl9hdmdfbWFyZ2luOworICAgIGludDMy
X3QgICAgICAgICAgICAgIG1heF9hdmdfbWFyZ2luOworCiAgICAgLyogc3RhdHMgKi8KICAgICB1
aW50MzJfdCAgICAgICAgICAgICBmaXJzdF9mcmFtZV9tbV90aW1lOwogICAgIHVpbnQzMl90ICAg
ICAgICAgICAgIGFycml2ZV9sYXRlX2NvdW50OwpkaWZmIC0tZ2l0IGEvc3JjL2NoYW5uZWwtZGlz
cGxheS5jIGIvc3JjL2NoYW5uZWwtZGlzcGxheS5jCmluZGV4IGIyNjMyNmQ2Li4yMWQ1ZTdjNyAx
MDA2NDQKLS0tIGEvc3JjL2NoYW5uZWwtZGlzcGxheS5jCisrKyBiL3NyYy9jaGFubmVsLWRpc3Bs
YXkuYwpAQCAtMjAsNiArMjAsNyBAQAogI2lmZGVmIEhBVkVfU1lTX1RZUEVTX0gKICNpbmNsdWRl
IDxzeXMvdHlwZXMuaD4KICNlbmRpZgorI2luY2x1ZGUgPG1hdGguaD4gLyogZm9yIGNlaWxmKCkg
Ki8KIAogI2luY2x1ZGUgInNwaWNlLWNsaWVudC5oIgogI2luY2x1ZGUgInNwaWNlLWNvbW1vbi5o
IgpAQCAtMTM3OCw4ICsxMzc5LDcgQEAgc3RhdGljIHVpbnQzMl90IHNwaWNlX21zZ19pbl9mcmFt
ZV9kYXRhKFNwaWNlTXNnSW4gKmZyYW1lX21zZywgdWludDhfdCAqKmRhdGEpCiBHX0dOVUNfSU5U
RVJOQUwKIGd1aW50MzIgc3RyZWFtX2dldF90aW1lKGRpc3BsYXlfc3RyZWFtICpzdCkKIHsKLSAg
ICBTcGljZVNlc3Npb24gKnNlc3Npb24gPSBzcGljZV9jaGFubmVsX2dldF9zZXNzaW9uKHN0LT5j
aGFubmVsKTsKLSAgICByZXR1cm4gc2Vzc2lvbiA/IHNwaWNlX3Nlc3Npb25fZ2V0X21tX3RpbWUo
c2Vzc2lvbikgOiAwOworICAgIHJldHVybiBnX2dldF9tb25vdG9uaWNfdGltZSgpIC8gMTAwMDsK
IH0KIAogLyogY29yb3V0aW5lIG9yIG1haW4gY29udGV4dCAqLwpAQCAtMTY0Myw3ICsxNjQzLDgg
QEAgc3RhdGljIHZvaWQgZGlzcGxheV9zdHJlYW1fc3RhdHNfc2F2ZShkaXNwbGF5X3N0cmVhbSAq
c3QsCiAKIHN0YXRpYyBTcGljZUZyYW1lICpzcGljZV9mcmFtZV9uZXcoZGlzcGxheV9zdHJlYW0g
KnN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZU1zZ0luICppbiwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3VpbnQzMiBmcmFtZV9tbXRpbWUp
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGd1aW50MzIgbW1fdGltZSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3VpbnQzMiBmcmFtZV90aW1lKQogewog
ICAgIFNwaWNlRnJhbWUgKmZyYW1lOwogICAgIGd1aW50OCAqZGF0YV9wdHI7CkBAIC0xNjUxLDcg
KzE2NTIsOCBAQCBzdGF0aWMgU3BpY2VGcmFtZSAqc3BpY2VfZnJhbWVfbmV3KGRpc3BsYXlfc3Ry
ZWFtICpzdCwKICAgICBndWludDMyIGRhdGFfc2l6ZSA9IHNwaWNlX21zZ19pbl9mcmFtZV9kYXRh
KGluLCAmZGF0YV9wdHIpOwogCiAgICAgZnJhbWUgPSBnX25ldyhTcGljZUZyYW1lLCAxKTsKLSAg
ICBmcmFtZS0+bW1fdGltZSA9IGZyYW1lX21tdGltZTsKKyAgICBmcmFtZS0+bW1fdGltZSA9IG1t
X3RpbWU7CisgICAgZnJhbWUtPnRpbWUgPSBmcmFtZV90aW1lOwogICAgIGZyYW1lLT5kZXN0ID0g
KmRlc3RfcmVjdDsKICAgICBmcmFtZS0+ZGF0YSA9IGRhdGFfcHRyOwogICAgIGZyYW1lLT5zaXpl
ID0gZGF0YV9zaXplOwpAQCAtMTY3Miw0NCArMTY3NCwxODQgQEAgdm9pZCBzcGljZV9mcmFtZV9m
cmVlKFNwaWNlRnJhbWUgKmZyYW1lKQogICAgIGdfZnJlZShmcmFtZSk7CiB9CiAKKy8qIFBpY2sg
YW4gaW5pdGlhbCB2YWx1ZSBsaWtlbHkgdG8gY292ZXIgdGhlIG5ldHdvcmsgaml0dGVyIGFuZCBu
b3QgdG8gY2F1c2UKKyAqIGEgc2lnbmlmaWNhbnQgbGFnLiBUaGUgZGVsYXkgd2lsbCBiZSBhZGp1
c3RlZCBmcm9tIHRoZXJlLgorICovCisjZGVmaW5lIElOSVRJQUxfREVMQVkgNDAKKworLyogQ29s
bGVjdCBkYXRhIG9uIGEgbG9uZyBlbm91Z2ggcGVyaW9kIHRvIGNhcHR1cmUgcmFyZSBldmVudHMs
IGJ1dCBzaG9ydAorICogZW5vdWdoIHNvIHRoYXQgdGhlIGFsZ29yaXRobSBpcyBzdGlsbCByZXNw
b25zaXZlIHRvIGNoYW5nZXMuCisgKi8KKyNkZWZpbmUgTUFSR0lOX0VWQUxfVElNRSAoMSAqIDEw
MDApCisKKy8qIE1ha2Ugc3VyZSB3ZSBoYXZlIGVub3VnaCBkYXRhIHBvaW50cyBldmVuIGlmIHRo
ZSBmcmFtZXJhdGUgaXMgdmVyeSBsb3cuICovCisjZGVmaW5lIE1BUkdJTl9FVkFMX0NPVU5UIDIw
CisKIC8qIGNvcm91dGluZSBjb250ZXh0ICovCiBzdGF0aWMgdm9pZCBkaXNwbGF5X2hhbmRsZV9z
dHJlYW1fZGF0YShTcGljZUNoYW5uZWwgKmNoYW5uZWwsIFNwaWNlTXNnSW4gKmluKQogeworICAg
IFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbiA9IHNwaWNlX2NoYW5uZWxfZ2V0X3Nlc3Npb24oY2hhbm5l
bCk7CiAgICAgU3BpY2VEaXNwbGF5Q2hhbm5lbFByaXZhdGUgKmMgPSBTUElDRV9ESVNQTEFZX0NI
QU5ORUwoY2hhbm5lbCktPnByaXY7CiAgICAgU3BpY2VTdHJlYW1EYXRhSGVhZGVyICpvcCA9IHNw
aWNlX21zZ19pbl9wYXJzZWQoaW4pOwogICAgIGRpc3BsYXlfc3RyZWFtICpzdCA9IGdldF9zdHJl
YW1fYnlfaWQoY2hhbm5lbCwgb3AtPmlkKTsKLSAgICBndWludDMyIG1tdGltZTsKLSAgICBpbnQz
Ml90IG1hcmdpbiwgbWFyZ2luX3JlcG9ydDsKKyAgICBndWludDMyIGN1cnJlbnRfbW10aW1lLCBm
cmFtZV9pbnRlcnZhbDsKKyAgICBndWludDMyIHN0cmVhbV90aW1lLCBmcmFtZV90aW1lOworICAg
IGdpbnQzMiBtbXRpbWVfbWFyZ2luLCBtYXJnaW47CiAgICAgU3BpY2VGcmFtZSAqZnJhbWU7CiAK
ICAgICBnX3JldHVybl9pZl9mYWlsKHN0ICE9IE5VTEwpOwotICAgIG1tdGltZSA9IHN0cmVhbV9n
ZXRfdGltZShzdCk7CisKKyAgICBjdXJyZW50X21tdGltZSA9IHNwaWNlX3Nlc3Npb25fZ2V0X21t
X3RpbWUoc2Vzc2lvbik7CiAKICAgICBpZiAoc3BpY2VfbXNnX2luX3R5cGUoaW4pID09IFNQSUNF
X01TR19ESVNQTEFZX1NUUkVBTV9EQVRBX1NJWkVEKSB7CiAgICAgICAgIENIQU5ORUxfREVCVUco
Y2hhbm5lbCwgInN0cmVhbSAldSBjb250YWlucyBzaXplZCBkYXRhIiwgb3AtPmlkKTsKICAgICB9
CiAKKyAgICBmcmFtZV9pbnRlcnZhbCA9IDA7CisgICAgbW10aW1lX21hcmdpbiA9IDQwMDsgLyog
c2VydmVyJ3MgZGVmYXVsdCBtbV90aW1lIG9mZnNldCAqLwogICAgIGlmIChvcC0+bXVsdGlfbWVk
aWFfdGltZSA9PSAwKSB7Ci0gICAgICAgIGdfY3JpdGljYWwoIlJlY2VpdmVkIGZyYW1lIHdpdGgg
aW52YWxpZCAwIHRpbWVzdGFtcCEgcGVyaGFwcyB3cm9uZyBncmFwaGljIGRyaXZlcj8iKTsKLSAg
ICAgICAgb3AtPm11bHRpX21lZGlhX3RpbWUgPSBtbXRpbWUgKyAxMDA7IC8qIHdvcmthcm91bmQu
Li4gKi8KLSAgICB9CisgICAgICAgIGdfY3JpdGljYWwoIlJlY2VpdmVkIGZyYW1lIHdpdGggaW52
YWxpZCAwIHRpbWVzdGFtcCEgUGVyaGFwcyB3cm9uZyBncmFwaGljIGRyaXZlcj8iKTsKKyAgICAg
ICAgb3AtPm11bHRpX21lZGlhX3RpbWUgPSBjdXJyZW50X21tdGltZTsgLyogd29ya2Fyb3VuZC4u
LiAqLworICAgICAgICBmcmFtZV9pbnRlcnZhbCA9IHNwaWNlX21tdGltZV9kaWZmKG9wLT5tdWx0
aV9tZWRpYV90aW1lLCBzdC0+bGFzdF9mcmFtZV9tbV90aW1lKTsKKyAgICB9IGVsc2UgaWYgKHN0
LT5sYXN0X2ZyYW1lX21tX3RpbWUgPT0gMCkgeworICAgICAgICAvKiBGaXJzdCBmcmFtZSBzbyBm
cmFtZV9pbnRlcnZhbCBpcyB1bmtub3duICovCisgICAgICAgIG1tdGltZV9tYXJnaW4gPSBzcGlj
ZV9tbXRpbWVfZGlmZihvcC0+bXVsdGlfbWVkaWFfdGltZSwgY3VycmVudF9tbXRpbWUpOworICAg
IH0gZWxzZSBpZiAoc3BpY2VfbW10aW1lX2RpZmYob3AtPm11bHRpX21lZGlhX3RpbWUsIHN0LT5s
YXN0X2ZyYW1lX21tX3RpbWUpIDwgMCkgeworICAgICAgICAvKiBUaGlzIGNhbiBoYXBwZW4gd2hl
biBtaWdyYXRpbmcgZnJvbSBhIHNlcnZlciB3aXRoIGEgaGlnaCBtbV90aW1lCisgICAgICAgICAq
IChpLmUuIGhpZ2ggdXB0aW1lKSB0byBvbmUgd2l0aCBhIGxvdyBtbV90aW1lOgorICAgICAgICAg
KiAtIHNlcnZlciBBIHNlbmRzIGEgZnJhbWUgd2l0aCBBX21tX3RpbWUKKyAgICAgICAgICogLSBj
bGllbnQgcmVjZWl2ZXMgdGhlIGZyYW1lIGFuZCBzZXRzIGxhc3RfZnJhbWVfbW1fdGltZSA9IEFf
bW1fdGltZQorICAgICAgICAgKiAtIHNlcnZlciBCIHNlbmRzIGEgZnJhbWUgd2l0aCBCX21tX3Rp
bWUKKyAgICAgICAgICogLSBjbGllbnQgcmVjZWl2ZXMgc2VydmVyIEIncyBmcmFtZSB3aXRoIEJf
bW1fdGltZSA8PCBBX21tX3RpbWUKKyAgICAgICAgICogQWxzbyBub3RlIHRoYXQgYWx0aG91Z2gg
c2VydmVyIEIgd291bGQgbm9ybWFsbHkgc2VuZCBhbiBtbV90aW1lCisgICAgICAgICAqIHJlc2V0
IG1lc3NhZ2UsIHRoZXJlIGlzIG5vIGd1YXJhbnRlZSBpdCB3aWxsIGJlIHJlY2VpdmVkIGJlZm9y
ZQorICAgICAgICAgKiBzZXJ2ZXIgQidzIGZpcnN0IGZyYW1lIHNvIGl0J3Mgbm90IG11Y2ggaGVs
cC4KKyAgICAgICAgICovCisgICAgICAgIFNQSUNFX0RFQlVHKCIldSBnb3QgYW4gb3V0IG9mIG9y
ZGVyIGZyYW1lIC0ldSIsIG9wLT5pZCwKKyAgICAgICAgICAgICAgICAgICAgc3QtPmxhc3RfZnJh
bWVfbW1fdGltZSAtIG9wLT5tdWx0aV9tZWRpYV90aW1lKTsKKyAgICAgICAgc3QtPmxhc3RfZnJh
bWVfbW1fdGltZSA9IG9wLT5tdWx0aV9tZWRpYV90aW1lOworICAgIH0gZWxzZSBpZiAoc3BpY2Vf
bW10aW1lX2RpZmYob3AtPm11bHRpX21lZGlhX3RpbWUsIHN0LT5sYXN0X2ZyYW1lX21tX3RpbWUp
ID4gMTAwMCkgeworICAgICAgICAvKiBTdHJlYW1zIGFyZSBzdXBwb3NlZCB0byBzZW5kIGF0IGxl
YXN0IDEgZnJhbWUgcGVyIHNlY29uZC4KKyAgICAgICAgICogU28gaXQncyBtb3JlIGxpa2VseSB0
aGF0IHdlIGdvdCBtaWdyYXRlZCBmcm9tIGEgc2VydmVyIHdpdGggYSBsb3cKKyAgICAgICAgICog
bW1fdGltZSAoaS5lLiBsb3cgdXB0aW1lKSB0byBvbmUgd2l0aCBhIGhpZ2ggbW1fdGltZS4gU2Vl
IHRoZSBjYXNlCisgICAgICAgICAqIGFib3ZlIGZvciBkZXRhaWxzLiBJbiBzdWNoIGEgY2FzZSBz
aW1wbHkgcmVpbml0aWFsaXplIHRoZSBzdHJlYW0uCisgICAgICAgICAqLworICAgICAgICBTUElD
RV9ERUJVRygiJXUgZ290IGFuIGFibm9ybWFsbHkgbG9uZyBtbV90aW1lIGZyYW1lIGludGVydmFs
ICV1Iiwgb3AtPmlkLAorICAgICAgICAgICAgICAgICAgICBvcC0+bXVsdGlfbWVkaWFfdGltZSAt
IHN0LT5sYXN0X2ZyYW1lX21tX3RpbWUpOworICAgICAgICBzdC0+bGFzdF9mcmFtZV90aW1lID0g
MDsKKyAgICB9IGVsc2UgeworICAgICAgICBtbXRpbWVfbWFyZ2luID0gc3BpY2VfbW10aW1lX2Rp
ZmYob3AtPm11bHRpX21lZGlhX3RpbWUsIGN1cnJlbnRfbW10aW1lKTsKKyAgICAgICAgZnJhbWVf
aW50ZXJ2YWwgPSBzcGljZV9tbXRpbWVfZGlmZihvcC0+bXVsdGlfbWVkaWFfdGltZSwgc3QtPmxh
c3RfZnJhbWVfbW1fdGltZSk7CisgICAgfQorICAgIGRpc3BsYXlfc3RyZWFtX3N0YXRzX3NhdmUo
c3QsIG9wLT5tdWx0aV9tZWRpYV90aW1lLCBjdXJyZW50X21tdGltZSk7CisgICAgc3QtPmxhc3Rf
ZnJhbWVfbW1fdGltZSA9IG9wLT5tdWx0aV9tZWRpYV90aW1lOworCisgICAgLyogQ29tcHV0ZSB0
aGUgbG9jYWwgZnJhbWUgbW10aW1lICovCisgICAgc3RyZWFtX3RpbWUgPSBzdHJlYW1fZ2V0X3Rp
bWUoc3QpOworICAgIGZyYW1lX3RpbWUgPSBzcGljZV9zZXNzaW9uX21tdGltZTJjbGllbnRfdGlt
ZShzZXNzaW9uLCBvcC0+bXVsdGlfbWVkaWFfdGltZSk7CisgICAgZ3VpbnQzMiB0YXJnZXRfbGFn
ID0gc3BpY2Vfc2Vzc2lvbl9nZXRfcGxheWJhY2tfbGF0ZW5jeShzZXNzaW9uKTsKKyAgICBpZiAo
c3QtPmxhc3RfZnJhbWVfdGltZSA9PSAwKSB7CisgICAgICAgIG1hcmdpbiA9IHNwaWNlX21tdGlt
ZV9kaWZmKGZyYW1lX3RpbWUsIHN0cmVhbV90aW1lKTsKKyAgICAgICAgc3QtPmRlbGF5ID0gTUFY
KHRhcmdldF9sYWcgLSBtYXJnaW4sIElOSVRJQUxfREVMQVkpOworICAgICAgICBmcmFtZV90aW1l
ICs9IHN0LT5kZWxheTsKKyAgICAgICAgbWFyZ2luICs9IHN0LT5kZWxheTsKKworICAgICAgICBz
dC0+bWFyZ2luX2V2YWxfc3RhcnQgPSBzdHJlYW1fdGltZTsKKyAgICAgICAgc3QtPm1hcmdpbl9l
dmFsX2NvdW50ID0gMDsKKyAgICAgICAgc3QtPm1pbl9tYXJnaW4gPSAwOyAvKiBGb3JjZSB3YWl0
IGJlZm9yZSByZWR1Y2luZyB0aGUgZGVsYXkgKi8KKyAgICAgICAgc3QtPm1pbl9tYXJnaW5fbmV4
dCA9IG1hcmdpbjsKKyAgICAgICAgc3QtPmF2Z19tYXJnaW4gPSBtYXJnaW47CisgICAgICAgIHN0
LT5tYXhfYXZnX21hcmdpbiA9IHN0LT5taW5fYXZnX21hcmdpbiA9IG1hcmdpbjsKKyAgICAgICAg
c3QtPm1hcmdpbl9zcHJlYWQgPSBzdC0+ZGVsYXk7CisgICAgfSBlbHNlIHsKKyAgICAgICAgZnJh
bWVfdGltZSA9IE1BWChmcmFtZV90aW1lICsgc3QtPmRlbGF5LAorICAgICAgICAgICAgICAgICAg
ICAgICAgIHN0LT5sYXN0X2ZyYW1lX3RpbWUgKyAoZnJhbWVfaW50ZXJ2YWwgKyAzKSAvIDQpOwor
ICAgICAgICBtYXJnaW4gPSBzcGljZV9tbXRpbWVfZGlmZihmcmFtZV90aW1lLCBzdHJlYW1fdGlt
ZSk7CisKKyAgICAgICAgLyogTm90ZSB0aGF0IHdoZW4gdXNpbmcgaW50ZWdlcnMgdGhlIG1vdmlu
ZyBhdmVyYWdlIGNhbiBzdGFiaWxpemUgdXAgdG8KKyAgICAgICAgICogd2VpZ2h0LzItMSBhd2F5
IGZyb20gdGhlIHRydWUgYXZlcmFnZSAod2hlcmUgd2VpZ2h0PTE2IGhlcmUpIGR1ZQorICAgICAg
ICAgKiB0byB0aGUgcm91bmRpbmcgZXJyb3JzIChlLmcuIGNvbnNpZGVyIDEgMTYgMTYuLi4pLgor
ICAgICAgICAgKiBTbyB1c2UgYSBmbG9hdCBmb3IgYXZnX21hcmdpbi4KKyAgICAgICAgICovCisg
ICAgICAgIHN0LT5hdmdfbWFyZ2luID0gKHN0LT5hdmdfbWFyZ2luICogMTUgKyBtYXJnaW4pIC8g
MTY7CisgICAgICAgIGlmIChzdC0+YXZnX21hcmdpbiA8IHN0LT5taW5fYXZnX21hcmdpbikgewor
ICAgICAgICAgICAgc3QtPm1pbl9hdmdfbWFyZ2luID0gc3QtPmF2Z19tYXJnaW47CisgICAgICAg
IH0gZWxzZSBpZiAoc3QtPmF2Z19tYXJnaW4gPiBzdC0+bWF4X2F2Z19tYXJnaW4pIHsKKyAgICAg
ICAgICAgIHN0LT5tYXhfYXZnX21hcmdpbiA9IGNlaWxmKHN0LT5hdmdfbWFyZ2luKTsKKyAgICAg
ICAgfQorCisgICAgICAgIGlmIChtYXJnaW4gPCBzdC0+bWluX21hcmdpbl9uZXh0KSB7CisgICAg
ICAgICAgICBzdC0+bWluX21hcmdpbl9uZXh0ID0gbWFyZ2luOworICAgICAgICAgICAgLyogVGFr
ZSBpbnRvIGFjY291bnQgc2lnbnMgdGhhdCB0aGUgc2l0dWF0aW9uIHdvcnNlbmVkIHdpdGhvdXQK
KyAgICAgICAgICAgICAqIGRlbGF5LgorICAgICAgICAgICAgICovCisgICAgICAgICAgICBzdC0+
bWluX21hcmdpbiA9IE1JTihzdC0+bWluX21hcmdpbiwgc3QtPm1pbl9tYXJnaW5fbmV4dCk7Cisg
ICAgICAgIH0KIAotICAgIG1hcmdpbiA9IG1hcmdpbl9yZXBvcnQgPSBvcC0+bXVsdGlfbWVkaWFf
dGltZSAtIG1tdGltZTsKLSAgICBpZiAobWFyZ2luID4gMCkgewotICAgICAgICBTcGljZVNlc3Np
b24gKnMgPSBzcGljZV9jaGFubmVsX2dldF9zZXNzaW9uKGNoYW5uZWwpOworICAgICAgICAvKiBP
bmx5IHJlcGxhY2UgdGhlIGN1cnJlbnQgbWluX21hcmdpbiBhbmQgbWFyZ2luX3NwcmVhZCBlc3Rp
bWF0ZXMgb25jZQorICAgICAgICAgKiBlbm91Z2ggZGF0YSBoYXMgYmVlbiBjb2xsZWN0ZWQgZm9y
IHRoZSAqX25leHQgdmFsdWVzLCBib3RoIGluIHRlcm0KKyAgICAgICAgICogb2YgZWxhcHNlZCB0
aW1lIGFuZCBudW1iZXIgb2YgZnJhbWVzLgorICAgICAgICAgKi8KKyAgICAgICAgc3QtPm1hcmdp
bl9ldmFsX2NvdW50Kys7CisgICAgICAgIGlmIChzdHJlYW1fdGltZSAtIHN0LT5tYXJnaW5fZXZh
bF9zdGFydCA+IE1BUkdJTl9FVkFMX1RJTUUgJiYKKyAgICAgICAgICAgIHN0LT5tYXJnaW5fZXZh
bF9jb3VudCA+PSBNQVJHSU5fRVZBTF9DT1VOVCkgeworICAgICAgICAgICAgc3QtPm1pbl9tYXJn
aW4gPSBzdC0+bWluX21hcmdpbl9uZXh0OworCisgICAgICAgICAgICBzdC0+bWFyZ2luX2V2YWxf
c3RhcnQgPSBzdHJlYW1fdGltZTsKKyAgICAgICAgICAgIHN0LT5tYXJnaW5fZXZhbF9jb3VudCA9
IDE7CisgICAgICAgICAgICBzdC0+bWluX21hcmdpbl9uZXh0ID0gbWFyZ2luOworCisgICAgICAg
ICAgICBzdC0+bWFyZ2luX3NwcmVhZCA9IChzdC0+bWF4X2F2Z19tYXJnaW4gLSBzdC0+bWluX2F2
Z19tYXJnaW4gKyAxKSAvIDI7CisgICAgICAgICAgICBzdC0+bWluX2F2Z19tYXJnaW4gPSBzdC0+
YXZnX21hcmdpbjsKKyAgICAgICAgICAgIHN0LT5tYXhfYXZnX21hcmdpbiA9IGNlaWxmKHN0LT5h
dmdfbWFyZ2luKTsKKyAgICAgICAgfQogCi0gICAgICAgIGlmIChzdC0+c3VyZmFjZS0+c3RyZWFt
aW5nX21vZGUgJiYgIXNwaWNlX3Nlc3Npb25faXNfcGxheWJhY2tfYWN0aXZlKHMpKSB7Ci0gICAg
ICAgICAgICBDSEFOTkVMX0RFQlVHKGNoYW5uZWwsICJ2aWRlbyBtYXJnaW46ICVkLCBzZXQgdG8g
MCBzaW5jZSB0aGVyZSBpcyBubyBwbGF5YmFjayIsIG1hcmdpbik7Ci0gICAgICAgICAgICBtYXJn
aW4gPSAwOworICAgICAgICBpZiAobWFyZ2luIDwgMCkgeworICAgICAgICAgICAgZ2ludDMyIG51
ZGdlID0gLW1hcmdpbjsKKyAgICAgICAgICAgIG1hcmdpbiArPSBudWRnZTsKKyAgICAgICAgICAg
IHN0LT5kZWxheSArPSBudWRnZTsKKyAgICAgICAgICAgIGZyYW1lX3RpbWUgPSBzdHJlYW1fdGlt
ZSArIChmcmFtZV9pbnRlcnZhbCArIDMpIC8gNDsKKworICAgICAgICAgICAgLyogVGhlIGRlbGF5
IG51ZGdlIGFsc28gaW1wYWN0cyB0aGUgbWFyZ2luIGhpc3RvcnkgKi8KKyAgICAgICAgICAgIHN0
LT5taW5fbWFyZ2luX25leHQgKz0gbnVkZ2U7CisgICAgICAgICAgICBzdC0+bWluX21hcmdpbiA9
IG1hcmdpbjsKKyAgICAgICAgICAgIHN0LT5hdmdfbWFyZ2luICs9IG51ZGdlOworICAgICAgICAg
ICAgc3QtPm1pbl9hdmdfbWFyZ2luICs9IG51ZGdlOworICAgICAgICAgICAgc3QtPm1heF9hdmdf
bWFyZ2luICs9IG51ZGdlOworICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgLyogVHJ5IHRv
IG1hdGNoIHRoZSB0YXJnZXQgbGFnIHdpdGhvdXQgbWFraW5nIG5lZWRsZXNzIGFkanVzdG1lbnRz
CisgICAgICAgICAgICAgKiBmb3IgbWlub3Igb2Zmc2V0cy4KKyAgICAgICAgICAgICAqLworICAg
ICAgICAgICAgZ2ludDMyIG51ZGdlID0gMDsKKyAgICAgICAgICAgIGlmIChzdC0+YXZnX21hcmdp
biArIHN0LT5tYXJnaW5fc3ByZWFkIDwgdGFyZ2V0X2xhZykgeworICAgICAgICAgICAgICAgIG51
ZGdlID0gTUlOKChmcmFtZV9pbnRlcnZhbCArIDMpIC8gNCwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB0YXJnZXRfbGFnIC0gc3QtPmF2Z19tYXJnaW4pOworICAgICAgICAgICAgfSBlbHNl
IGlmIChzdC0+bWluX21hcmdpbiA+IDAgJiYKKyAgICAgICAgICAgICAgICAgICAgICAgc3QtPmF2
Z19tYXJnaW4gID4gdGFyZ2V0X2xhZyArIHN0LT5tYXJnaW5fc3ByZWFkKSB7CisgICAgICAgICAg
ICAgICAgbnVkZ2UgPSAtTUlOKChmcmFtZV9pbnRlcnZhbCArIDMpIC8gNCwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgTUlOKHN0LT5hdmdfbWFyZ2luIC0gdGFyZ2V0X2xhZywKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0LT5taW5fbWFyZ2luKSk7CisgICAgICAgICAg
ICB9CisgICAgICAgICAgICBpZiAobnVkZ2UpIHsKKyAgICAgICAgICAgICAgICBzdC0+ZGVsYXkg
Kz0gbnVkZ2U7CisgICAgICAgICAgICAgICAgZnJhbWVfdGltZSArPSBudWRnZTsKKworICAgICAg
ICAgICAgICAgIC8qIFRoZSBkZWxheSBudWRnZSBhbHNvIGltcGFjdHMgdGhlIG1hcmdpbiBoaXN0
b3J5ICovCisgICAgICAgICAgICAgICAgc3QtPm1pbl9tYXJnaW5fbmV4dCArPSBudWRnZTsKKyAg
ICAgICAgICAgICAgICBzdC0+bWluX21hcmdpbiArPSBudWRnZTsKKyAgICAgICAgICAgICAgICBz
dC0+YXZnX21hcmdpbiArPSBudWRnZTsKKyAgICAgICAgICAgICAgICBzdC0+bWluX2F2Z19tYXJn
aW4gKz0gbnVkZ2U7CisgICAgICAgICAgICAgICAgc3QtPm1heF9hdmdfbWFyZ2luICs9IG51ZGdl
OworICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgfQotICAgIGRpc3BsYXlfc3RyZWFtX3N0
YXRzX3NhdmUoc3QsIG9wLT5tdWx0aV9tZWRpYV90aW1lLCBtbXRpbWUpOworICAgIHN0LT5sYXN0
X2ZyYW1lX3RpbWUgPSBmcmFtZV90aW1lOwogCiAgICAgLyogTGV0IHRoZSB2aWRlbyBkZWNvZGVy
IHF1ZXVlIHRoZSBmcmFtZXMgc28gaXQgY2FuIG9wdGltaXplIHRoZWlyCiAgICAgICogZGVjb2Rp
bmcgYW5kIGJlc3QgZGVjaWRlIGlmL3doZW4gdG8gZHJvcCB0aGVtIHdoZW4gdGhleSBhcmUgbGF0
ZSwKICAgICAgKiB0YWtpbmcgaW50byBhY2NvdW50IHRoZSBpbXBhY3Qgb24gbGF0ZXIgZnJhbWVz
LgogICAgICAqLwotICAgIGZyYW1lID0gc3BpY2VfZnJhbWVfbmV3KHN0LCBpbiwgb3AtPm11bHRp
X21lZGlhX3RpbWUpOworICAgIGZyYW1lID0gc3BpY2VfZnJhbWVfbmV3KHN0LCBpbiwgb3AtPm11
bHRpX21lZGlhX3RpbWUsIGZyYW1lX3RpbWUpOwogICAgIGlmICghc3QtPnZpZGVvX2RlY29kZXIt
PnF1ZXVlX2ZyYW1lKHN0LT52aWRlb19kZWNvZGVyLCBmcmFtZSwgbWFyZ2luKSkgewogICAgICAg
ICBkZXN0cm95X3N0cmVhbShjaGFubmVsLCBvcC0+aWQpOwogICAgICAgICByZXBvcnRfaW52YWxp
ZF9zdHJlYW0oY2hhbm5lbCwgb3AtPmlkKTsKQEAgLTE3MTgsNyArMTg2MCw3IEBAIHN0YXRpYyB2
b2lkIGRpc3BsYXlfaGFuZGxlX3N0cmVhbV9kYXRhKFNwaWNlQ2hhbm5lbCAqY2hhbm5lbCwgU3Bp
Y2VNc2dJbiAqaW4pCiAKICAgICBpZiAoYy0+ZW5hYmxlX2FkYXB0aXZlX3N0cmVhbWluZykgewog
ICAgICAgICBkaXNwbGF5X3VwZGF0ZV9zdHJlYW1fcmVwb3J0KFNQSUNFX0RJU1BMQVlfQ0hBTk5F
TChjaGFubmVsKSwgb3AtPmlkLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IG9wLT5tdWx0aV9tZWRpYV90aW1lLCBtYXJnaW5fcmVwb3J0KTsKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBvcC0+bXVsdGlfbWVkaWFfdGltZSwgbW10aW1lX21hcmdpbik7
CiAgICAgICAgIGlmIChzdC0+cGxheWJhY2tfc3luY19kcm9wc19zZXFfbGVuID49IFNUUkVBTV9Q
TEFZQkFDS19TWU5DX0RST1BfU0VRX0xFTl9MSU1JVCkgewogICAgICAgICAgICAgc3BpY2Vfc2Vz
c2lvbl9zeW5jX3BsYXliYWNrX2xhdGVuY3koc3BpY2VfY2hhbm5lbF9nZXRfc2Vzc2lvbihjaGFu
bmVsKSk7CiAgICAgICAgICAgICBzdC0+cGxheWJhY2tfc3luY19kcm9wc19zZXFfbGVuID0gMDsK
ZGlmZiAtLWdpdCBhL3NyYy9zcGljZS1zZXNzaW9uLXByaXYuaCBiL3NyYy9zcGljZS1zZXNzaW9u
LXByaXYuaAppbmRleCA2ZWNlN2UwMS4uZDg4Mjc2ZjEgMTAwNjQ0Ci0tLSBhL3NyYy9zcGljZS1z
ZXNzaW9uLXByaXYuaAorKysgYi9zcmMvc3BpY2Utc2Vzc2lvbi1wcml2LmgKQEAgLTUwLDYgKzUw
LDcgQEAgR1NvY2tldENvbm5lY3Rpb24qIHNwaWNlX3Nlc3Npb25fY2hhbm5lbF9vcGVuX2hvc3Qo
U3BpY2VTZXNzaW9uICpzZXNzaW9uLCBTcGljZUMKIHZvaWQgc3BpY2Vfc2Vzc2lvbl9jaGFubmVs
X25ldyhTcGljZVNlc3Npb24gKnNlc3Npb24sIFNwaWNlQ2hhbm5lbCAqY2hhbm5lbCk7CiB2b2lk
IHNwaWNlX3Nlc3Npb25fY2hhbm5lbF9taWdyYXRlKFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbiwgU3Bp
Y2VDaGFubmVsICpjaGFubmVsKTsKIAorZ3VpbnQzMiBzcGljZV9zZXNzaW9uX21tdGltZTJjbGll
bnRfdGltZShTcGljZVNlc3Npb24gKnNlc3Npb24sIGd1aW50MzIgc3JjX3RpbWUpOwogdm9pZCBz
cGljZV9zZXNzaW9uX3NldF9tbV90aW1lKFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbiwgZ3VpbnQzMiB0
aW1lKTsKIGd1aW50MzIgc3BpY2Vfc2Vzc2lvbl9nZXRfbW1fdGltZShTcGljZVNlc3Npb24gKnNl
c3Npb24pOwogCmRpZmYgLS1naXQgYS9zcmMvc3BpY2Utc2Vzc2lvbi5jIGIvc3JjL3NwaWNlLXNl
c3Npb24uYwppbmRleCAwNGJhMTI0YS4uZTZhOTYxMzMgMTAwNjQ0Ci0tLSBhL3NyYy9zcGljZS1z
ZXNzaW9uLmMKKysrIGIvc3JjL3NwaWNlLXNlc3Npb24uYwpAQCAtMTAyLDYgKzEwMiw3IEBAIHN0
cnVjdCBfU3BpY2VTZXNzaW9uUHJpdmF0ZSB7CiAgICAgZ3VpbnQgICAgICAgICAgICAgY2hhbm5l
bHNfZGVzdHJveWluZzsKICAgICBnYm9vbGVhbiAgICAgICAgICBjbGllbnRfcHJvdmlkZWRfc29j
a2V0czsKICAgICBndWludDY0ICAgICAgICAgICBtbV90aW1lX29mZnNldDsKKyAgICBndWludDMy
ICAgICAgICAgICBjbGllbnRfdGltZV9vZmZzZXQ7CiAgICAgU3BpY2VTZXNzaW9uICAgICAgKm1p
Z3JhdGlvbjsKICAgICBHTGlzdCAgICAgICAgICAgICAqbWlncmF0aW9uX2xlZnQ7CiAgICAgU3Bp
Y2VTZXNzaW9uTWlncmF0aW9uIG1pZ3JhdGlvbl9zdGF0ZTsKQEAgLTEyOSw2ICsxMzAsMTAgQEAg
c3RydWN0IF9TcGljZVNlc3Npb25Qcml2YXRlIHsKICAgICBQaG9kYXZTZXJ2ZXIgICAgICAqd2Vi
ZGF2OwogfTsKIAorLyogSW5pdGlhbGl6ZSB0aGUgY2xpZW50X3RpbWVfb2Zmc2V0IHRvIGFuIHVu
bGlrZWx5IHZhbHVlLgorICogU2VlIHNwaWNlX3Nlc3Npb25fZ2V0X2NsaWVudF90aW1lKCkuCisg
Ki8KKyMgZGVmaW5lIFVOU0VUX0NMSUVOVF9USU1FX09GRlNFVCAweGQxY2VjYTVlCiAKIC8qKgog
ICogU0VDVElPTjpzcGljZS1zZXNzaW9uCkBAIC0yOTIsNiArMjk3LDcgQEAgc3RhdGljIHZvaWQg
c3BpY2Vfc2Vzc2lvbl9pbml0KFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbikKICAgICBTUElDRV9ERUJV
RygiU3VwcG9ydGVkIGNoYW5uZWxzOiAlcyIsIGNoYW5uZWxzKTsKICAgICBnX2ZyZWUoY2hhbm5l
bHMpOwogCisgICAgcy0+Y2xpZW50X3RpbWVfb2Zmc2V0ID0gVU5TRVRfQ0xJRU5UX1RJTUVfT0ZG
U0VUOwogICAgIHMtPmltYWdlcyA9IGNhY2hlX2ltYWdlX25ldygoR0Rlc3Ryb3lOb3RpZnkpcGl4
bWFuX2ltYWdlX3VucmVmKTsKICAgICBzLT5nbHpfd2luZG93ID0gZ2x6X2RlY29kZXJfd2luZG93
X25ldygpOwogICAgIHVwZGF0ZV9wcm94eShzZXNzaW9uLCBOVUxMKTsKQEAgLTIzODUsNiArMjM5
MSw0NiBAQCBpbnQgc3BpY2Vfc2Vzc2lvbl9nZXRfY29ubmVjdGlvbl9pZChTcGljZVNlc3Npb24g
KnNlc3Npb24pCiAgICAgcmV0dXJuIHMtPmNvbm5lY3Rpb25faWQ7CiB9CiAKK0dfR05VQ19JTlRF
Uk5BTAorZ3VpbnQzMiBzcGljZV9zZXNzaW9uX21tdGltZTJjbGllbnRfdGltZShTcGljZVNlc3Np
b24gKnNlc3Npb24sIGd1aW50MzIgbW10aW1lKQoreworICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWls
KFNQSUNFX0lTX1NFU1NJT04oc2Vzc2lvbiksIGdfZ2V0X21vbm90b25pY190aW1lKCkgLyAxMDAw
KTsKKworICAgIFNwaWNlU2Vzc2lvblByaXZhdGUgKnMgPSBzZXNzaW9uLT5wcml2OworCisgICAg
Z3VpbnQzMiBub3cgPSBnX2dldF9tb25vdG9uaWNfdGltZSgpIC8gMTAwMDsKKyAgICBndWludDMy
IG5ld19vZmZzZXQgPSBub3cgLSBtbXRpbWU7CisKKyAgICBpZiAocy0+Y2xpZW50X3RpbWVfb2Zm
c2V0ID09IFVOU0VUX0NMSUVOVF9USU1FX09GRlNFVCkgeworICAgICAgICAvKiBJbml0aWFsaXpl
IHRoZSB0aW1lIG9mZnNldC4KKyAgICAgICAgICogTm90ZSB0aGF0IFVOU0VUX0NMSUVOVF9USU1F
X09GRlNFVCBjYW4gYmUgYW55IHZhbHVlIGluY2x1ZGluZyAwCisgICAgICAgICAqIHdoaWNoIGlz
IGNvbW1vbiBvbiBsb3ctbGF0ZW5jeSBMQU5zLiBCdXQgYW4gdW5saWtlbHkgb25lIGhlbHBzIHdo
ZW4KKyAgICAgICAgICogYWRkaW5nIGEgdHJhY2UgaW4gdGhpcyBjb2RlcGF0aC4KKyAgICAgICAg
ICovCisgICAgICAgIHMtPmNsaWVudF90aW1lX29mZnNldCA9IG5ld19vZmZzZXQ7CisgICAgICAg
IHJldHVybiBub3c7CisgICAgfQorICAgIGlmIChuZXdfb2Zmc2V0IDwgcy0+Y2xpZW50X3RpbWVf
b2Zmc2V0IC0gMTAwMCB8fAorICAgICAgICBuZXdfb2Zmc2V0ID4gcy0+Y2xpZW50X3RpbWVfb2Zm
c2V0ICsgMTAwMCkgeworICAgICAgICAvKiBUaGUgY2hhbmdlIGluIG9mZnNldCB3YXMgbGlrZWx5
IGNhdXNlZCBieSBhIHNlcnZlciBtaWdyYXRpb24uCisgICAgICAgICAqIFJlc2V0IHRoZSB0aW1l
IG9mZnNldC4KKyAgICAgICAgICovCisgICAgICAgIHMtPmNsaWVudF90aW1lX29mZnNldCA9IG5l
d19vZmZzZXQ7CisgICAgICAgIHJldHVybiBub3c7CisgICAgfQorICAgIGlmIChuZXdfb2Zmc2V0
IDwgcy0+Y2xpZW50X3RpbWVfb2Zmc2V0KSB7CisgICAgICAgIC8qIFRoZSBwcmV2aW91cyBtZXNz
YWdlIHdlIHVzZWQgdG8gY29tcHV0ZSB0aGUgb2Zmc2V0IHdhcyBwcm9iYWJseQorICAgICAgICAg
KiBkZWxheWVkIHJlc3VsdGluZyBpbiBhIHRvbyBsYXJnZSBvZmZzZXQuIEV2ZW50dWFsbHkgdGhl
IG9mZnNldAorICAgICAgICAgKiBzaG91bGQgc2V0dGxlIHRvIHRoZSB0cnVlIGNsb2NrIG9mZnNl
dCBwbHVzIHRoZSBuZXR3b3JrIGxhdGVuY3ksCisgICAgICAgICAqIGV4Y2x1ZGluZyB0aGUgbmV0
d29yayBqaXR0ZXIuCisgICAgICAgICAqLworICAgICAgICBzLT5jbGllbnRfdGltZV9vZmZzZXQg
PSBuZXdfb2Zmc2V0OworICAgICAgICByZXR1cm4gbm93OworICAgIH0KKworICAgIHJldHVybiBt
bXRpbWUgKyBzLT5jbGllbnRfdGltZV9vZmZzZXQ7Cit9CisKIEdfR05VQ19JTlRFUk5BTAogZ3Vp
bnQzMiBzcGljZV9zZXNzaW9uX2dldF9tbV90aW1lKFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbikKIHsK
LS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KU3BpY2UtZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNl
LWRldmVs
