Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 59A5F98B6B
	for <lists+spice-devel@lfdr.de>; Thu, 22 Aug 2019 08:31:10 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EE19F6E43C;
	Thu, 22 Aug 2019 06:31:08 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8681D6E43C
 for <spice-devel@lists.freedesktop.org>; Thu, 22 Aug 2019 06:31:07 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx03.intmail.prod.int.phx2.redhat.com
 [10.5.11.13])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 0B67518C8905;
 Thu, 22 Aug 2019 06:31:07 +0000 (UTC)
Received: from colo-mx.corp.redhat.com
 (colo-mx01.intmail.prod.int.phx2.redhat.com [10.5.11.20])
 by smtp.corp.redhat.com (Postfix) with ESMTPS id F1F2960605;
 Thu, 22 Aug 2019 06:31:06 +0000 (UTC)
Received: from zmail25.collab.prod.int.phx2.redhat.com
 (zmail25.collab.prod.int.phx2.redhat.com [10.5.83.31])
 by colo-mx.corp.redhat.com (Postfix) with ESMTP id E7F671800202;
 Thu, 22 Aug 2019 06:31:06 +0000 (UTC)
Date: Thu, 22 Aug 2019 02:31:06 -0400 (EDT)
From: Frediano Ziglio <fziglio@redhat.com>
To: Yuri Benditovich <yuri.benditovich@daynix.com>
Message-ID: <433958340.8196819.1566455466566.JavaMail.zimbra@redhat.com>
In-Reply-To: <20190812095729.32692-8-yuri.benditovich@daynix.com>
References: <20190812095729.32692-1-yuri.benditovich@daynix.com>
 <20190812095729.32692-8-yuri.benditovich@daynix.com>
MIME-Version: 1.0
X-Originating-IP: [10.40.204.109, 10.4.195.10]
Thread-Topic: usb-redir: add implementation of emulated CD device
Thread-Index: jJea5JPmR47ZR1TwbOvnwcbzeevD0Q==
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.13
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.6.2
 (mx1.redhat.com [10.5.110.70]); Thu, 22 Aug 2019 06:31:07 +0000 (UTC)
Subject: Re: [Spice-devel] [spice-gtk v3 7/9] usb-redir: add implementation
 of emulated CD device
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: yan@daynix.com, spice-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

PiAKPiBUaGlzIG1vZHVsZSBjb250YWlucyBpbXBsZW1lbnRhdGlvbiBvZiBlbXVsYXRlZCBkZXZp
Y2UKPiBpbnRlcmZhY2UgZm9yIHNoYXJlZCBDRC4KPiAKPiBTaWduZWQtb2ZmLWJ5OiBZdXJpIEJl
bmRpdG92aWNoIDx5dXJpLmJlbmRpdG92aWNoQGRheW5peC5jb20+CgpBY2tlZC1ieTogRnJlZGlh
bm8gWmlnbGlvIDxmemlnbGlvQHJlZGhhdC5jb20+Cgo+IC0tLQo+ICBzcmMvdXNiLWRldmljZS1j
ZC5jIHwgNzgzICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCj4g
IHNyYy91c2ItZGV2aWNlLWNkLmggfCAgMzQgKysKPiAgMiBmaWxlcyBjaGFuZ2VkLCA4MTcgaW5z
ZXJ0aW9ucygrKQo+ICBjcmVhdGUgbW9kZSAxMDA2NDQgc3JjL3VzYi1kZXZpY2UtY2QuYwo+ICBj
cmVhdGUgbW9kZSAxMDA2NDQgc3JjL3VzYi1kZXZpY2UtY2QuaAo+IAo+IGRpZmYgLS1naXQgYS9z
cmMvdXNiLWRldmljZS1jZC5jIGIvc3JjL3VzYi1kZXZpY2UtY2QuYwo+IG5ldyBmaWxlIG1vZGUg
MTAwNjQ0Cj4gaW5kZXggMDAwMDAwMC4uYzMzYmIyOQo+IC0tLSAvZGV2L251bGwKPiArKysgYi9z
cmMvdXNiLWRldmljZS1jZC5jCj4gQEAgLTAsMCArMSw3ODMgQEAKPiArLyogLSotIE1vZGU6IEM7
IGMtYmFzaWMtb2Zmc2V0OiA0OyBpbmRlbnQtdGFicy1tb2RlOiBuaWwgLSotICovCj4gKy8qCj4g
KyAgICBDb3B5cmlnaHQgKEMpIDIwMTkgUmVkIEhhdCwgSW5jLgo+ICsKPiArICAgIFJlZCBIYXQg
QXV0aG9yczoKPiArICAgIFl1cmkgQmVuZGl0b3ZpY2g8eWJlbmRpdG9AcmVkaGF0LmNvbT4KPiAr
Cj4gKyAgICBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1
dGUgaXQgYW5kL29yCj4gKyAgICBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUg
TGVzc2VyIEdlbmVyYWwgUHVibGljCj4gKyAgICBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUg
RnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIKPiArICAgIHZlcnNpb24gMi4xIG9mIHRo
ZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgo+ICsKPiAr
ICAgIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwg
YmUgdXNlZnVsLAo+ICsgICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4g
dGhlIGltcGxpZWQgd2FycmFudHkgb2YKPiArICAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNT
IEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUgR05VCj4gKyAgICBMZXNzZXIgR2Vu
ZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgo+ICsKPiArICAgIFlvdSBzaG91
bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMK
PiArICAgIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgc2VlCj4gPGh0
dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+Lgo+ICsqLwo+ICsKPiArI2luY2x1ZGUgImNvbmZp
Zy5oIgo+ICsKPiArI2lmZGVmIFVTRV9VU0JSRURJUgo+ICsKPiArI2luY2x1ZGUgPGdsaWItb2Jq
ZWN0Lmg+Cj4gKyNpbmNsdWRlIDxpbnR0eXBlcy5oPgo+ICsjaW5jbHVkZSA8Z2lvL2dpby5oPgo+
ICsjaW5jbHVkZSA8Z2xpYi9naTE4bi1saWIuaD4KPiArI2luY2x1ZGUgPGVycm5vLmg+Cj4gKyNp
bmNsdWRlIDxsaWJ1c2IuaD4KPiArI2luY2x1ZGUgPGZjbnRsLmg+Cj4gKwo+ICsjaWZkZWYgR19P
U19XSU4zMgo+ICsjaW5jbHVkZSA8d2luZG93cy5oPgo+ICsjaW5jbHVkZSA8bnRkZGNkcm0uaD4K
PiArI2luY2x1ZGUgPG50ZGRtbWMuaD4KPiArI2Vsc2UKPiArI2luY2x1ZGUgPHN5cy9zdGF0Lmg+
Cj4gKyNpbmNsdWRlIDxzeXMvaW9jdGwuaD4KPiArI2luY2x1ZGUgPGxpbnV4L2ZzLmg+Cj4gKyNp
bmNsdWRlIDxsaW51eC9jZHJvbS5oPgo+ICsjZW5kaWYKPiArCj4gKyNpbmNsdWRlICJ1c2ItZW11
bGF0aW9uLmgiCj4gKyNpbmNsdWRlICJ1c2ItZGV2aWNlLWNkLmgiCj4gKyNpbmNsdWRlICJjZC11
c2ItYnVsay1tc2QuaCIKPiArCj4gK3R5cGVkZWYgc3RydWN0IFNwaWNlQ2RMVSB7Cj4gKyAgICBj
aGFyICpmaWxlbmFtZTsKPiArICAgIEdGaWxlSW5wdXRTdHJlYW0gKnN0cmVhbTsKPiArICAgIHVp
bnQ2NF90IHNpemU7Cj4gKyAgICB1aW50MzJfdCBibG9ja1NpemU7Cj4gKyAgICB1aW50MzJfdCBs
b2FkZWQgOiAxOwo+ICsgICAgdWludDMyX3QgZGV2aWNlIDogMTsKPiArfSBTcGljZUNkTFU7Cj4g
Kwo+ICsjZGVmaW5lIE1BWF9MVU5fUEVSX0RFVklDRSAgICAgICAgICAgICAgMQo+ICsjZGVmaW5l
IFVTQjJfQkNEICAgICAgICAgICAgICAgICAgICAgICAgMHgyMDAKPiArI2RlZmluZSBDRF9ERVZf
VklEICAgICAgICAgICAgICAgICAgICAgIDB4MmIyMwo+ICsjZGVmaW5lIENEX0RFVl9QSUQgICAg
ICAgICAgICAgICAgICAgICAgMHhDRENECj4gKyNkZWZpbmUgQ0RfREVWX0NMQVNTICAgICAgICAg
ICAgICAgICAgICA4Cj4gKyNkZWZpbmUgQ0RfREVWX1NVQkNMQVNTICAgICAgICAgICAgICAgICA2
Cj4gKyNkZWZpbmUgQ0RfREVWX1BST1RPQ09MICAgICAgICAgICAgICAgICAweDUwCj4gKyNkZWZp
bmUgQ0RfREVWX0JMT0NLX1NJWkUgICAgICAgICAgICAgICAweDIwMAo+ICsjZGVmaW5lIERWRF9E
RVZfQkxPQ0tfU0laRSAgICAgICAgICAgICAgMHg4MDAKPiArI2RlZmluZSBNQVhfQlVMS19JTl9S
RVFVRVNUUyAgICAgICAgICAgIDY0Cj4gKwo+ICtzdHJ1Y3QgQnVmZmVyZWRCdWxrUmVhZCB7Cj4g
KyAgICBzdHJ1Y3QgdXNiX3JlZGlyX2J1bGtfcGFja2V0X2hlYWRlciBob3V0Owo+ICsgICAgdWlu
dDY0X3QgaWQ7Cj4gK307Cj4gKwo+ICtzdHJ1Y3QgU3BpY2VVc2JFbXVsYXRlZERldmljZSB7Cj4g
KyAgICBVc2JEZXZpY2VPcHMgZGV2X29wczsKPiArICAgIFNwaWNlVXNiQmFja2VuZCAqYmFja2Vu
ZDsKPiArICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqcGFyZW50Owo+ICsgICAgc3RydWN0IHVz
YnJlZGlycGFyc2VyICpwYXJzZXI7Cj4gKyAgICBVc2JDZEJ1bGtNc2REZXZpY2UqIG1zYzsKPiAr
ICAgIFNwaWNlQ2RMVSB1bml0c1tNQVhfTFVOX1BFUl9ERVZJQ0VdOwo+ICsgICAgZ2Jvb2xlYW4g
bG9ja2VkOwo+ICsgICAgZ2Jvb2xlYW4gZGVsZXRlX29uX2VqZWN0Owo+ICsgICAgZ2Jvb2xlYW4g
ZGVsZXRpbmc7Cj4gKyAgICB1aW50MzJfdCBudW1fcmVhZHM7Cj4gKyAgICBzdHJ1Y3QgQnVmZmVy
ZWRCdWxrUmVhZCByZWFkX2J1bGtbTUFYX0JVTEtfSU5fUkVRVUVTVFNdOwo+ICsgICAgLyogYWNj
b3JkaW5nIHRvIFVTQiBNU0Mgc3BlYyAqLwo+ICsgICAgdWludDE2X3Qgc2VyaWFsWzEyXTsKPiAr
ICAgIHVpbnQ4X3QgIG1heF9sdW5faW5kZXg7Cj4gK307Cj4gKwo+ICt0eXBlZGVmIHN0cnVjdCBT
cGljZVVzYkVtdWxhdGVkRGV2aWNlIFVzYkNkOwo+ICsKPiArI2lmbmRlZiBHX09TX1dJTjMyCj4g
Kwo+ICtzdGF0aWMgaW50IGNkX2RldmljZV9vcGVuX3N0cmVhbShTcGljZUNkTFUgKnVuaXQsIGNv
bnN0IGNoYXIgKmZpbGVuYW1lKQo+ICt7Cj4gKyAgICB1bml0LT5kZXZpY2UgPSAwOwo+ICsKPiAr
ICAgIGlmICghdW5pdC0+ZmlsZW5hbWUgJiYgIWZpbGVuYW1lKSB7Cj4gKyAgICAgICAgU1BJQ0Vf
REVCVUcoIiVzOiBmaWxlIG5hbWUgbm90IHByb3ZpZGVkIiwgX19GVU5DVElPTl9fKTsKPiArICAg
ICAgICByZXR1cm4gLTE7Cj4gKyAgICB9Cj4gKyAgICBpZiAodW5pdC0+ZmlsZW5hbWUgJiYgZmls
ZW5hbWUpIHsKPiArICAgICAgICBnX2ZyZWUodW5pdC0+ZmlsZW5hbWUpOwo+ICsgICAgICAgIHVu
aXQtPmZpbGVuYW1lID0gTlVMTDsKPiArICAgIH0KPiArICAgIGlmIChmaWxlbmFtZSkgewo+ICsg
ICAgICAgIHVuaXQtPmZpbGVuYW1lID0gZ19zdHJkdXAoZmlsZW5hbWUpOwo+ICsgICAgfQo+ICsK
PiArICAgIGludCBmZCA9IG9wZW4odW5pdC0+ZmlsZW5hbWUsIE9fUkRPTkxZIHwgT19OT05CTE9D
Syk7Cj4gKyAgICBpZiAoZmQgPCAwKSB7Cj4gKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiBjYW4n
dCBvcGVuIGZpbGUgJXMiLCBfX0ZVTkNUSU9OX18sIHVuaXQtPmZpbGVuYW1lKTsKPiArICAgICAg
ICByZXR1cm4gLTE7Cj4gKyAgICB9Cj4gKwo+ICsgICAgc3RydWN0IHN0YXQgZmlsZV9zdGF0ID0g
eyAwIH07Cj4gKyAgICBpZiAoZnN0YXQoZmQsICZmaWxlX3N0YXQpIHx8IGZpbGVfc3RhdC5zdF9z
aXplID09IDApIHsKPiArICAgICAgICBmaWxlX3N0YXQuc3Rfc2l6ZSA9IDA7Cj4gKyAgICAgICAg
dW5pdC0+ZGV2aWNlID0gMTsKPiArICAgICAgICBpZiAoIWlvY3RsKGZkLCBCTEtHRVRTSVpFNjQs
ICZmaWxlX3N0YXQuc3Rfc2l6ZSkgJiYKPiArICAgICAgICAgICAgIWlvY3RsKGZkLCBCTEtTU1pH
RVQsICZ1bml0LT5ibG9ja1NpemUpKSB7Cj4gKyAgICAgICAgfQo+ICsgICAgfQo+ICsgICAgdW5p
dC0+c2l6ZSA9IGZpbGVfc3RhdC5zdF9zaXplOwo+ICsgICAgY2xvc2UoZmQpOwo+ICsgICAgaWYg
KHVuaXQtPnNpemUpIHsKPiArICAgICAgICBHRmlsZSAqZmlsZV9vYmplY3QgPSBnX2ZpbGVfbmV3
X2Zvcl9wYXRoKHVuaXQtPmZpbGVuYW1lKTsKPiArICAgICAgICB1bml0LT5zdHJlYW0gPSBnX2Zp
bGVfcmVhZChmaWxlX29iamVjdCwgTlVMTCwgTlVMTCk7Cj4gKyAgICAgICAgZ19jbGVhcl9vYmpl
Y3QoJmZpbGVfb2JqZWN0KTsKPiArICAgIH0KPiArICAgIGlmICghdW5pdC0+c3RyZWFtKSB7Cj4g
KyAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiBjYW4ndCBvcGVuIHN0cmVhbSBvbiAlcyIsIF9fRlVO
Q1RJT05fXywKPiB1bml0LT5maWxlbmFtZSk7Cj4gKyAgICAgICAgcmV0dXJuIC0xOwo+ICsgICAg
fQo+ICsKPiArICAgIHJldHVybiAwOwo+ICt9Cj4gKwo+ICtzdGF0aWMgaW50IGNkX2RldmljZV9s
b2FkKFNwaWNlQ2RMVSAqdW5pdCwgZ2Jvb2xlYW4gbG9hZCkKPiArewo+ICsgICAgaW50IGVycm9y
Owo+ICsgICAgaWYgKCF1bml0LT5kZXZpY2UgfHwgIXVuaXQtPmZpbGVuYW1lKSB7Cj4gKyAgICAg
ICAgcmV0dXJuIC0xOwo+ICsgICAgfQo+ICsgICAgaW50IGZkID0gb3Blbih1bml0LT5maWxlbmFt
ZSwgT19SRE9OTFkgfCBPX05PTkJMT0NLKTsKPiArICAgIGlmIChmZCA8IDApIHsKPiArICAgICAg
ICByZXR1cm4gLTE7Cj4gKyAgICB9Cj4gKyAgICBpZiAobG9hZCkgewo+ICsgICAgICAgIGVycm9y
ID0gaW9jdGwoZmQsIENEUk9NQ0xPU0VUUkFZLCAwKTsKPiArICAgIH0gZWxzZSB7Cj4gKyAgICAg
ICAgZXJyb3IgPSBpb2N0bChmZCwgQ0RST01fTE9DS0RPT1IsIDApOwo+ICsgICAgICAgIGVycm9y
ID0gaW9jdGwoZmQsIENEUk9NRUpFQ1QsIDApOwo+ICsgICAgfQo+ICsgICAgaWYgKGVycm9yKSB7
Cj4gKyAgICAgICAgLy8gbm90ZSB0aGF0IGVqZWN0aW5nIG1pZ2h0IGJlIGF2YWlsYWJsZSBvbmx5
IGZvciByb290Cj4gKyAgICAgICAgLy8gbG9hZGluZyBtaWdodCBiZSBhdmFpbGFibGUgYWxzbyBm
b3IgcmVndWxhciB1c2VyCj4gKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiBjYW4ndCAlc2xvYWQg
JXMsIHJlcyAlZCwgZXJybm8gJWQiLAo+ICsgICAgICAgICAgICBfX0ZVTkNUSU9OX18sIGxvYWQg
PyAiIiA6ICJ1biIsIHVuaXQtPmZpbGVuYW1lLCBlcnJvciwgZXJybm8pOwo+ICsgICAgfQo+ICsg
ICAgY2xvc2UoZmQpOwo+ICsgICAgcmV0dXJuIGVycm9yOwo+ICt9Cj4gKwo+ICtzdGF0aWMgaW50
IGNkX2RldmljZV9jaGVjayhTcGljZUNkTFUgKnVuaXQpCj4gK3sKPiArICAgIGludCBlcnJvcjsK
PiArICAgIGlmICghdW5pdC0+ZGV2aWNlIHx8ICF1bml0LT5maWxlbmFtZSkgewo+ICsgICAgICAg
IHJldHVybiAtMTsKPiArICAgIH0KPiArICAgIGludCBmZCA9IG9wZW4odW5pdC0+ZmlsZW5hbWUs
IE9fUkRPTkxZIHwgT19OT05CTE9DSyk7Cj4gKyAgICBpZiAoZmQgPCAwKSB7Cj4gKyAgICAgICAg
cmV0dXJuIC0xOwo+ICsgICAgfQo+ICsgICAgZXJyb3IgPSBpb2N0bChmZCwgQ0RST01fRFJJVkVf
U1RBVFVTLCAwKTsKPiArICAgIGVycm9yID0gKGVycm9yID09IENEU19ESVNDX09LKSA/IDAgOiAt
MTsKPiArICAgIGlmICghZXJyb3IpIHsKPiArICAgICAgICBlcnJvciA9IGlvY3RsKGZkLCBDRFJP
TV9ESVNDX1NUQVRVUywgMCk7Cj4gKyAgICAgICAgZXJyb3IgPSAoZXJyb3IgPT0gQ0RTX0RBVEFf
MSkgPyAwIDogLTE7Cj4gKyAgICB9Cj4gKyAgICBjbG9zZShmZCk7Cj4gKyAgICByZXR1cm4gZXJy
b3I7Cj4gK30KPiArCj4gKyNlbHNlCj4gKwo+ICtzdGF0aWMgZ2Jvb2xlYW4gaXNfZGV2aWNlX25h
bWUoY29uc3QgY2hhciAqZmlsZW5hbWUpCj4gK3sKPiArICAgIHJldHVybiBnX2FzY2lpX2lzYWxw
aGEoZmlsZW5hbWVbMF0pICYmIGZpbGVuYW1lWzFdID09ICc6JyAmJgo+ICsgICAgICAgIGZpbGVu
YW1lWzJdID09IDA7Cj4gK30KPiArCj4gK3N0YXRpYyBIQU5ETEUgb3Blbl9maWxlKGNvbnN0IGNo
YXIgKmZpbGVuYW1lKQo+ICt7Cj4gKyAgICBIQU5ETEUgaCA9IENyZWF0ZUZpbGVBKGZpbGVuYW1l
LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICBHRU5FUklDX1JFQUQsCj4gKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgIEZJTEVfU0hBUkVfUkVBRCwKPiArICAgICAgICAgICAgICAgICAg
ICAgICAgICAgTlVMTCwgT1BFTl9FWElTVElORywKPiArICAgICAgICAgICAgICAgICAgICAgICAg
ICAgMCwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgTlVMTCk7Cj4gKyAgICBpZiAoaCA9
PSBJTlZBTElEX0hBTkRMRV9WQUxVRSkgewo+ICsgICAgICAgIGggPSBOVUxMOwo+ICsgICAgfQo+
ICsgICAgcmV0dXJuIGg7Cj4gK30KPiArCj4gK3N0YXRpYyB1aW50MzJfdCBpb2N0bF9vdXQoSEFO
RExFIGgsIHVpbnQzMl90IGNvZGUsIHZvaWQgKm91dF9idWZmZXIsCj4gdWludDMyX3Qgb3V0X3Np
emUpCj4gK3sKPiArICAgIHVpbnQzMl90IGVycm9yOwo+ICsgICAgRFdPUkQgcmV0Owo+ICsgICAg
Qk9PTCBiID0gRGV2aWNlSW9Db250cm9sKGgsIGNvZGUsIE5VTEwsIDAsIG91dF9idWZmZXIsIG91
dF9zaXplLCAmcmV0LAo+IE5VTEwpOwo+ICsgICAgZXJyb3IgPSBiID8gMCA6IEdldExhc3RFcnJv
cigpOwo+ICsgICAgcmV0dXJuIGVycm9yOwo+ICt9Cj4gKwo+ICtzdGF0aWMgdWludDMyX3QgaW9j
dGxfbm9uZShIQU5ETEUgaCwgdWludDMyX3QgY29kZSkKPiArewo+ICsgICAgcmV0dXJuIGlvY3Rs
X291dChoLCBjb2RlLCBOVUxMLCAwKTsKPiArfQo+ICsKPiArc3RhdGljIGdib29sZWFuIGNoZWNr
X2RldmljZShIQU5ETEUgaCkKPiArewo+ICsgICAgR0VUX0NPTkZJR1VSQVRJT05fSU9DVExfSU5Q
VVQgY2ZnSW4gPQo+ICsgICAgICAgIHsgRmVhdHVyZUNkUmVhZCwgU0NTSV9HRVRfQ09ORklHVVJB
VElPTl9SRVFVRVNUX1RZUEVfQUxMLCB7fSB9Owo+ICsgICAgRFdPUkQgcmV0Owo+ICsgICAgR0VU
X0NPTkZJR1VSQVRJT05fSEVBREVSIGNmZ091dDsKPiArICAgIHJldHVybiBEZXZpY2VJb0NvbnRy
b2woaCwgSU9DVExfQ0RST01fR0VUX0NPTkZJR1VSQVRJT04sCj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICZjZmdJbiwgc2l6ZW9mKGNmZ0luKSwgJmNmZ091dCwgc2l6ZW9mKGNmZ091dCks
Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICZyZXQsIE5VTEwpOwo+ICt9Cj4gKwo+ICtz
dGF0aWMgaW50IGNkX2RldmljZV9vcGVuX3N0cmVhbShTcGljZUNkTFUgKnVuaXQsIGNvbnN0IGNo
YXIgKmZpbGVuYW1lKQo+ICt7Cj4gKyAgICBIQU5ETEUgaDsKPiArICAgIHVuaXQtPmRldmljZSA9
IDA7Cj4gKyAgICBpZiAoIXVuaXQtPmZpbGVuYW1lICYmICFmaWxlbmFtZSkgewo+ICsgICAgICAg
IFNQSUNFX0RFQlVHKCIlczogdW5uYW1lZCBmaWxlIiwgX19GVU5DVElPTl9fKTsKPiArICAgICAg
ICByZXR1cm4gLTE7Cj4gKyAgICB9Cj4gKyAgICBpZiAodW5pdC0+ZmlsZW5hbWUgJiYgZmlsZW5h
bWUpIHsKPiArICAgICAgICBnX2ZyZWUodW5pdC0+ZmlsZW5hbWUpOwo+ICsgICAgICAgIHVuaXQt
PmZpbGVuYW1lID0gTlVMTDsKPiArICAgIH0KPiArICAgIGlmICghZmlsZW5hbWUpIHsKPiArICAg
ICAgICAvLyByZW9wZW5pbmcgdGhlIHN0cmVhbSBvbiBleGlzdGluZyBmaWxlIG5hbWUKPiArICAg
IH0gZWxzZSBpZiAoaXNfZGV2aWNlX25hbWUoZmlsZW5hbWUpKSB7Cj4gKyAgICAgICAgdW5pdC0+
ZmlsZW5hbWUgPSBnX3N0cmR1cF9wcmludGYoIlxcXFwuXFwlcyIsIGZpbGVuYW1lKTsKPiArICAg
IH0gZWxzZSB7Cj4gKyAgICAgICAgdW5pdC0+ZmlsZW5hbWUgPSBnX3N0cmR1cChmaWxlbmFtZSk7
Cj4gKyAgICB9Cj4gKyAgICBoID0gb3Blbl9maWxlKHVuaXQtPmZpbGVuYW1lKTsKPiArICAgIGlm
ICghaCkgewo+ICsgICAgICAgIFNQSUNFX0RFQlVHKCIlczogY2FuJ3Qgb3BlbiBmaWxlICVzIiwg
X19GVU5DVElPTl9fLCB1bml0LT5maWxlbmFtZSk7Cj4gKyAgICAgICAgcmV0dXJuIC0xOwo+ICsg
ICAgfQo+ICsKPiArICAgIExBUkdFX0lOVEVHRVIgc2l6ZSA9IHsgMCB9Owo+ICsgICAgaWYgKCFH
ZXRGaWxlU2l6ZUV4KGgsICZzaXplKSkgewo+ICsgICAgICAgIHVpbnQ2NF90IGJ1ZmZlclsyNTZd
Owo+ICsgICAgICAgIHVpbnQzMl90IHJlczsKPiArICAgICAgICB1bml0LT5kZXZpY2UgPSBjaGVj
a19kZXZpY2UoaCk7Cj4gKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiBDRCBkZXZpY2UgJXNyZWNv
Z25pemVkIG9uICVzIiwKPiArICAgICAgICAgICAgX19GVU5DVElPTl9fLCB1bml0LT5kZXZpY2Ug
PyAiIiA6ICJOT1QgIiwgdW5pdC0+ZmlsZW5hbWUpOwo+ICsgICAgICAgIHJlcyA9IGlvY3RsX291
dChoLCBJT0NUTF9ESVNLX0dFVF9EUklWRV9HRU9NRVRSWV9FWCwKPiArICAgICAgICAgICAgICAg
ICAgICAgICAgYnVmZmVyLCBzaXplb2YoYnVmZmVyKSk7Cj4gKyAgICAgICAgaWYgKCFyZXMpIHsK
PiArICAgICAgICAgICAgRElTS19HRU9NRVRSWV9FWCAqcGcgPSAoRElTS19HRU9NRVRSWV9FWCAq
KWJ1ZmZlcjsKPiArICAgICAgICAgICAgdW5pdC0+YmxvY2tTaXplID0gcGctPkdlb21ldHJ5LkJ5
dGVzUGVyU2VjdG9yOwo+ICsgICAgICAgICAgICBzaXplID0gcGctPkRpc2tTaXplOwo+ICsgICAg
ICAgIH0gZWxzZSB7Cj4gKyAgICAgICAgICAgIFNQSUNFX0RFQlVHKCIlczogY2FuJ3Qgb2J0YWlu
IHNpemUgb2YgJXMgKGVycm9yICV1KSIsCj4gKyAgICAgICAgICAgICAgICBfX0ZVTkNUSU9OX18s
IHVuaXQtPmZpbGVuYW1lLCByZXMpOwo+ICsgICAgICAgIH0KPiArICAgIH0KPiArICAgIHVuaXQt
PnNpemUgPSBzaXplLlF1YWRQYXJ0Owo+ICsgICAgQ2xvc2VIYW5kbGUoaCk7Cj4gKyAgICBpZiAo
dW5pdC0+c2l6ZSkgewo+ICsgICAgICAgIEdGaWxlICpmaWxlX29iamVjdCA9IGdfZmlsZV9uZXdf
Zm9yX3BhdGgodW5pdC0+ZmlsZW5hbWUpOwo+ICsgICAgICAgIHVuaXQtPnN0cmVhbSA9IGdfZmls
ZV9yZWFkKGZpbGVfb2JqZWN0LCBOVUxMLCBOVUxMKTsKPiArICAgICAgICBnX2NsZWFyX29iamVj
dCgmZmlsZV9vYmplY3QpOwo+ICsgICAgfQo+ICsgICAgaWYgKCF1bml0LT5zdHJlYW0pIHsKPiAr
ICAgICAgICBTUElDRV9ERUJVRygiJXM6IGNhbid0IG9wZW4gc3RyZWFtIG9uICVzIiwgX19GVU5D
VElPTl9fLAo+IHVuaXQtPmZpbGVuYW1lKTsKPiArICAgICAgICByZXR1cm4gLTE7Cj4gKyAgICB9
Cj4gKyAgICByZXR1cm4gMDsKPiArfQo+ICsKPiArc3RhdGljIGludCBjZF9kZXZpY2VfbG9hZChT
cGljZUNkTFUgKnVuaXQsIGdib29sZWFuIGxvYWQpCj4gK3sKPiArICAgIGludCBlcnJvciA9IDA7
Cj4gKyAgICBIQU5ETEUgaDsKPiArICAgIGlmICghdW5pdC0+ZGV2aWNlIHx8ICF1bml0LT5maWxl
bmFtZSkgewo+ICsgICAgICAgIHJldHVybiAtMTsKPiArICAgIH0KPiArICAgIGggPSBvcGVuX2Zp
bGUodW5pdC0+ZmlsZW5hbWUpOwo+ICsgICAgaWYgKGgpIHsKPiArICAgICAgICB1aW50MzJfdCBy
ZXMgPSBpb2N0bF9ub25lKGgsIGxvYWQgPyBJT0NUTF9TVE9SQUdFX0xPQURfTUVESUEgOgo+IElP
Q1RMX1NUT1JBR0VfRUpFQ1RfTUVESUEpOwo+ICsgICAgICAgIGlmIChyZXMpIHsKPiArICAgICAg
ICAgICAgU1BJQ0VfREVCVUcoIiVzOiBjYW4ndCAlc2xvYWQgJXMsIHdpbiBlcnJvciAldSIsCj4g
KyAgICAgICAgICAgICAgICAgICAgICAgIF9fRlVOQ1RJT05fXywgbG9hZCA/ICIiIDogInVuIiwg
dW5pdC0+ZmlsZW5hbWUsCj4gcmVzKTsKPiArICAgICAgICAgICAgZXJyb3IgPSAtMTsKPiArICAg
ICAgICB9IGVsc2Ugewo+ICsgICAgICAgICAgICBTUElDRV9ERUJVRygiJXM6IGRldmljZSAlcyBb
JXNdIiwKPiArICAgICAgICAgICAgICAgICAgICAgICAgX19GVU5DVElPTl9fLCBsb2FkID8gImxv
YWRlZCIgOiAiZWplY3RlZCIsCj4gdW5pdC0+ZmlsZW5hbWUpOwo+ICsgICAgICAgIH0KPiArICAg
ICAgICBDbG9zZUhhbmRsZShoKTsKPiArICAgIH0KPiArICAgIHJldHVybiBlcnJvcjsKPiArfQo+
ICsKPiArc3RhdGljIGludCBjZF9kZXZpY2VfY2hlY2soU3BpY2VDZExVICp1bml0KQo+ICt7Cj4g
KyAgICBpbnQgZXJyb3IgPSAwOwo+ICsgICAgQ0RST01fRElTS19EQVRBIGRhdGE7Cj4gKyAgICBI
QU5ETEUgaDsKPiArICAgIGlmICghdW5pdC0+ZGV2aWNlIHx8ICF1bml0LT5maWxlbmFtZSkgewo+
ICsgICAgICAgIHJldHVybiAtMTsKPiArICAgIH0KPiArICAgIGggPSBvcGVuX2ZpbGUodW5pdC0+
ZmlsZW5hbWUpOwo+ICsgICAgaWYgKGgpIHsKPiArICAgICAgICB1aW50MzJfdCByZXMgPSBpb2N0
bF9ub25lKGgsIElPQ1RMX1NUT1JBR0VfQ0hFQ0tfVkVSSUZZKTsKPiArICAgICAgICBpZiAoIXJl
cykgewo+ICsgICAgICAgICAgICByZXMgPSBpb2N0bF9vdXQoaCwgSU9DVExfQ0RST01fRElTS19U
WVBFLCAmZGF0YSwgc2l6ZW9mKGRhdGEpKTsKPiArICAgICAgICB9Cj4gKyAgICAgICAgaWYgKHJl
cyAhPSAwIHx8IGRhdGEuRGlza0RhdGEgIT0gQ0RST01fRElTS19EQVRBX1RSQUNLKSB7Cj4gKyAg
ICAgICAgICAgIGVycm9yID0gLTE7Cj4gKyAgICAgICAgfQo+ICsgICAgICAgIENsb3NlSGFuZGxl
KGgpOwo+ICsgICAgfQo+ICsgICAgcmV0dXJuIGVycm9yOwo+ICt9Cj4gKwo+ICsjZW5kaWYKPiAr
Cj4gK3N0YXRpYyBnYm9vbGVhbiBvcGVuX3N0cmVhbShTcGljZUNkTFUgKnVuaXQsIGNvbnN0IGNo
YXIgKmZpbGVuYW1lKQo+ICt7Cj4gKyAgICBnYm9vbGVhbiBiOwo+ICsgICAgYiA9IGNkX2Rldmlj
ZV9vcGVuX3N0cmVhbSh1bml0LCBmaWxlbmFtZSkgPT0gMDsKPiArICAgIHJldHVybiBiOwo+ICt9
Cj4gKwo+ICtzdGF0aWMgdm9pZCBjbG9zZV9zdHJlYW0oU3BpY2VDZExVICp1bml0KQo+ICt7Cj4g
KyAgICBnX2NsZWFyX29iamVjdCgmdW5pdC0+c3RyZWFtKTsKPiArfQo+ICsKPiArc3RhdGljIGdi
b29sZWFuIGxvYWRfbHVuKFVzYkNkICpkLCBpbnQgdW5pdCwgZ2Jvb2xlYW4gbG9hZCkKPiArewo+
ICsgICAgZ2Jvb2xlYW4gYiA9IFRSVUU7Cj4gKyAgICBpZiAobG9hZCAmJiBkLT51bml0c1t1bml0
XS5kZXZpY2UpIHsKPiArICAgICAgICAvLyB0aGVyZSBpcyBvbmUgcG9zc2libGUgcHJvYmxlbSBp
biBjYXNlIG91ciBiYWNrZW5kIGlzIHRoZQo+ICsgICAgICAgIC8vIGxvY2FsIENEIGRldmljZSBh
bmQgaXQgaXMgZWplY3RlZAo+ICsgICAgICAgIGNkX2RldmljZV9sb2FkKCZkLT51bml0c1t1bml0
XSwgVFJVRSk7Cj4gKyAgICAgICAgY2xvc2Vfc3RyZWFtKCZkLT51bml0c1t1bml0XSk7Cj4gKyAg
ICAgICAgaWYgKGNkX2RldmljZV9jaGVjaygmZC0+dW5pdHNbdW5pdF0pIHx8Cj4gIW9wZW5fc3Ry
ZWFtKCZkLT51bml0c1t1bml0XSwgTlVMTCkpIHsKPiArICAgICAgICAgICAgcmV0dXJuIEZBTFNF
Owo+ICsgICAgICAgIH0KPiArICAgIH0KPiArCj4gKyAgICBpZiAobG9hZCkgewo+ICsgICAgICAg
IENkU2NzaU1lZGlhUGFyYW1ldGVycyBtZWRpYV9wYXJhbXMgPSB7IDAgfTsKPiArCj4gKyAgICAg
ICAgbWVkaWFfcGFyYW1zLnN0cmVhbSA9IGQtPnVuaXRzW3VuaXRdLnN0cmVhbTsKPiArICAgICAg
ICBtZWRpYV9wYXJhbXMuc2l6ZSA9IGQtPnVuaXRzW3VuaXRdLnNpemU7Cj4gKyAgICAgICAgbWVk
aWFfcGFyYW1zLmJsb2NrX3NpemUgPSBkLT51bml0c1t1bml0XS5ibG9ja1NpemU7Cj4gKyAgICAg
ICAgaWYgKG1lZGlhX3BhcmFtcy5ibG9ja19zaXplID09IENEX0RFVl9CTE9DS19TSVpFICYmCj4g
KyAgICAgICAgICAgIG1lZGlhX3BhcmFtcy5zaXplICUgRFZEX0RFVl9CTE9DS19TSVpFID09IDAp
IHsKPiArICAgICAgICAgICAgbWVkaWFfcGFyYW1zLmJsb2NrX3NpemUgPSBEVkRfREVWX0JMT0NL
X1NJWkU7Cj4gKyAgICAgICAgfQo+ICsgICAgICAgIFNQSUNFX0RFQlVHKCIlczogbG9hZGluZyAl
cywgc2l6ZSAlIiBHX0dVSU5UNjRfRk9STUFUICIsIGJsb2NrICV1IiwKPiArICAgICAgICAgICAg
ICAgICAgICBfX0ZVTkNUSU9OX18sIGQtPnVuaXRzW3VuaXRdLmZpbGVuYW1lLAo+IG1lZGlhX3Bh
cmFtcy5zaXplLCBtZWRpYV9wYXJhbXMuYmxvY2tfc2l6ZSk7Cj4gKwo+ICsgICAgICAgIGIgPSAh
Y2RfdXNiX2J1bGtfbXNkX2xvYWQoZC0+bXNjLCB1bml0LCAmbWVkaWFfcGFyYW1zKTsKPiArCj4g
KyAgICAgICAgZC0+dW5pdHNbdW5pdF0ubG9hZGVkID0gISFiOwo+ICsKPiArICAgIH0gZWxzZSB7
Cj4gKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiB1bmxvYWRpbmcgJXMiLCBfX0ZVTkNUSU9OX18s
Cj4gZC0+dW5pdHNbdW5pdF0uZmlsZW5hbWUpOwo+ICsgICAgICAgIGNkX3VzYl9idWxrX21zZF91
bmxvYWQoZC0+bXNjLCB1bml0KTsKPiArICAgICAgICBkLT51bml0c1t1bml0XS5sb2FkZWQgPSBG
QUxTRTsKPiArICAgIH0KPiArICAgIHJldHVybiBiOwo+ICt9Cj4gKwo+ICtzdGF0aWMgdm9pZCB1
c2JfY2RfdW5yZWFsaXplKFVzYkNkICpkKQo+ICt7Cj4gKyAgICB1aW50MzJfdCB1bml0ID0gMDsK
PiArICAgIGNkX3VzYl9idWxrX21zZF91bnJlYWxpemUoZC0+bXNjLCB1bml0KTsKPiArICAgIGdf
Y2xlYXJfcG9pbnRlcigmZC0+dW5pdHNbdW5pdF0uZmlsZW5hbWUsIGdfZnJlZSk7Cj4gKyAgICBj
bG9zZV9zdHJlYW0oJmQtPnVuaXRzW3VuaXRdKTsKPiArICAgIGdfY2xlYXJfcG9pbnRlcigmZC0+
bXNjLCBjZF91c2JfYnVsa19tc2RfZnJlZSk7Cj4gKyAgICBnX2ZyZWUoZCk7Cj4gK30KPiArCj4g
K3N0YXRpYyBnYm9vbGVhbiB1c2JfY2RfZ2V0X2Rlc2NyaXB0b3IoVXNiQ2QgKmQsIHVpbnQ4X3Qg
dHlwZSwgdWludDhfdCBpbmRleCwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB2b2lkICoqYnVmZmVyLCB1aW50MTZfdCAqc2l6ZSkKPiArewo+ICsgICAgc3RhdGljIHN0
cnVjdCBsaWJ1c2JfZGV2aWNlX2Rlc2NyaXB0b3IgZGVzYyA9IHsKPiArICAgICAgICAuYkxlbmd0
aCA9IDE4LAo+ICsgICAgICAgIC5iRGVzY3JpcHRvclR5cGUgPSBMSUJVU0JfRFRfREVWSUNFLAo+
ICsgICAgICAgIC5iY2RVU0IgPSBVU0IyX0JDRCwKPiArICAgICAgICAuYkRldmljZUNsYXNzID0g
MCwKPiArICAgICAgICAuYkRldmljZVN1YkNsYXNzID0gMCwKPiArICAgICAgICAuYkRldmljZVBy
b3RvY29sID0gMCwKPiArICAgICAgICAuYk1heFBhY2tldFNpemUwID0gNjQsCj4gKyAgICAgICAg
LmlkVmVuZG9yID0gQ0RfREVWX1ZJRCwKPiArICAgICAgICAuaWRQcm9kdWN0ID0gQ0RfREVWX1BJ
RCwKPiArICAgICAgICAuYmNkRGV2aWNlID0gMHgxMDAsCj4gKyAgICAgICAgLmlNYW51ZmFjdHVy
ZXIgPSAxLAo+ICsgICAgICAgIC5pUHJvZHVjdCA9IDIsCj4gKyAgICAgICAgLmlTZXJpYWxOdW1i
ZXIgPSAzLAo+ICsgICAgICAgIC5iTnVtQ29uZmlndXJhdGlvbnMgPSAxCj4gKyAgICB9Owo+ICsg
ICAgc3RhdGljIHVpbnQ4X3QgY2ZnW10gPQo+ICsgICAgewo+ICsgICAgICAgIDksIC8vbGVuIG9m
IGNmZyBkZXNjCj4gKyAgICAgICAgTElCVVNCX0RUX0NPTkZJRywgLy8gZGVzYyB0eXBlCj4gKyAg
ICAgICAgMHgyMCwgLy8gd2xlbgo+ICsgICAgICAgIDAsCj4gKyAgICAgICAgMSwgLy8gbnVtIGlm
Cj4gKyAgICAgICAgMSwgLy8gY2ZnIHZhbAo+ICsgICAgICAgIDAsIC8vIGNmZyBuYW1lCj4gKyAg
ICAgICAgMHg4MCwgLy8gYnVzIHBvd2VyZWQKPiArICAgICAgICAweDMyLCAvLyAxMDAgbWEKPiAr
ICAgICAgICA5LCAvLyBsZW4gb2YgSUYgZGVzYwo+ICsgICAgICAgIExJQlVTQl9EVF9JTlRFUkZB
Q0UsCj4gKyAgICAgICAgMCwgLy8gbnVtIGlmCj4gKyAgICAgICAgMCwgLy8gYWx0IHNldHRpbmcK
PiArICAgICAgICAyLCAvLyBudW0gb2YgZW5kcG9pbnRzCj4gKyAgICAgICAgQ0RfREVWX0NMQVNT
LAo+ICsgICAgICAgIENEX0RFVl9TVUJDTEFTUywKPiArICAgICAgICBDRF9ERVZfUFJPVE9DT0ws
Cj4gKyAgICAgICAgMCwgLy8gaWYgbmFtZQo+ICsgICAgICAgIDcsCj4gKyAgICAgICAgTElCVVNC
X0RUX0VORFBPSU5ULAo+ICsgICAgICAgIDB4ODEsIC8vLT5EaXJlY3Rpb24gOiBJTiAtIEVuZHBv
aW50SUQgOiAxCj4gKyAgICAgICAgMHgwMiwgLy8tPkJ1bGsgVHJhbnNmZXIgVHlwZQo+ICsgICAg
ICAgIDAsICAgIC8vd01heFBhY2tldFNpemUgOiAweDAyMDAgPSAweDIwMCBtYXggYnl0ZXMKPiAr
ICAgICAgICAyLAo+ICsgICAgICAgIDAsICAgIC8vYkludGVydmFsCj4gKyAgICAgICAgNywKPiAr
ICAgICAgICBMSUJVU0JfRFRfRU5EUE9JTlQsCj4gKyAgICAgICAgMHgwMiwgLy8tPkRpcmVjdGlv
biA6IE9VVCAtIEVuZHBvaW50SUQgOiAyCj4gKyAgICAgICAgMHgwMiwgLy8tPkJ1bGsgVHJhbnNm
ZXIgVHlwZQo+ICsgICAgICAgIDAsICAgIC8vd01heFBhY2tldFNpemUgOiAweDAyMDAgPSAweDIw
MCBtYXggYnl0ZXMKPiArICAgICAgICAyLAo+ICsgICAgICAgIDAsICAgIC8vYkludGVydmFsCj4g
KyAgICB9Owo+ICsgICAgc3RhdGljIHVpbnQxNl90IHMwWzJdID0geyAweDMwNCwgMHg0MDkgfTsK
PiArICAgIHN0YXRpYyB1aW50MTZfdCBzMVs4XSA9IHsgMHgzMTAsICdSJywgJ2UnLCAnZCcsICcg
JywgJ0gnLCAnYScsICd0JyB9Owo+ICsgICAgc3RhdGljIHVpbnQxNl90IHMyWzldID0geyAweDMx
MiwgJ1MnLCAncCcsICdpJywgJ2MnLCAnZScsICcgJywgJ0MnLCAnRCcKPiB9Owo+ICsKPiArICAg
IHZvaWQgKnAgPSBOVUxMOwo+ICsgICAgdWludDE2X3QgbGVuID0gMDsKPiArCj4gKyAgICBzd2l0
Y2ggKHR5cGUpIHsKPiArICAgIGNhc2UgTElCVVNCX0RUX0RFVklDRToKPiArICAgICAgICBwID0g
JmRlc2M7Cj4gKyAgICAgICAgbGVuID0gc2l6ZW9mKGRlc2MpOwo+ICsgICAgICAgIGJyZWFrOwo+
ICsgICAgY2FzZSBMSUJVU0JfRFRfQ09ORklHOgo+ICsgICAgICAgIHAgPSBjZmc7Cj4gKyAgICAg
ICAgbGVuID0gc2l6ZW9mKGNmZyk7Cj4gKyAgICAgICAgYnJlYWs7Cj4gKyAgICBjYXNlIExJQlVT
Ql9EVF9TVFJJTkc6Cj4gKyAgICAgICAgaWYgKGluZGV4ID09IDApIHsKPiArICAgICAgICAgICAg
cCA9IHMwOyBsZW4gPSBzaXplb2YoczApOwo+ICsgICAgICAgIH0gZWxzZSBpZiAoaW5kZXggPT0g
MSkgewo+ICsgICAgICAgICAgICBwID0gczE7IGxlbiA9IHNpemVvZihzMSk7Cj4gKyAgICAgICAg
fSBlbHNlIGlmIChpbmRleCA9PSAyKSB7Cj4gKyAgICAgICAgICAgIHAgPSBzMjsgbGVuID0gc2l6
ZW9mKHMyKTsKPiArICAgICAgICB9IGVsc2UgaWYgKGluZGV4ID09IDMpIHsKPiArICAgICAgICAg
ICAgcCA9IGQtPnNlcmlhbDsgbGVuID0gc2l6ZW9mKGQtPnNlcmlhbCk7Cj4gKyAgICAgICAgfQo+
ICsgICAgICAgIGJyZWFrOwo+ICsgICAgfQo+ICsKPiArICAgIGlmIChwKSB7Cj4gKyAgICAgICAg
KmJ1ZmZlciA9IHA7Cj4gKyAgICAgICAgKnNpemUgPSBsZW47Cj4gKyAgICB9Cj4gKwo+ICsgICAg
cmV0dXJuIHAgIT0gTlVMTDsKPiArfQo+ICsKPiArc3RhdGljIHZvaWQgdXNiX2NkX2F0dGFjaChV
c2JDZCAqZGV2aWNlLCBzdHJ1Y3QgdXNicmVkaXJwYXJzZXIgKnBhcnNlcikKPiArewo+ICsgICAg
ZGV2aWNlLT5wYXJzZXIgPSBwYXJzZXI7Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIHVzYl9jZF9k
ZXRhY2goVXNiQ2QgKmRldmljZSkKPiArewo+ICsgICAgZGV2aWNlLT5wYXJzZXIgPSBOVUxMOwo+
ICt9Cj4gKwo+ICtzdGF0aWMgdm9pZCB1c2JfY2RfcmVzZXQoVXNiQ2QgKmRldmljZSkKPiArewo+
ICsgICAgY2RfdXNiX2J1bGtfbXNkX3Jlc2V0KGRldmljZS0+bXNjKTsKPiArfQo+ICsKPiArc3Rh
dGljIHZvaWQgdXNiX2NkX2NvbnRyb2xfcmVxdWVzdChVc2JDZCAqZGV2aWNlLAo+ICsgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ4X3QgKmRhdGEsIGludCBkYXRhX2xlbiwK
PiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgdXNiX3JlZGlyX2Nv
bnRyb2xfcGFja2V0X2hlYWRlcgo+ICpoLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHZvaWQgKipidWZmZXIpCj4gK3sKPiArICAgIHVpbnQ4X3QgcmVxdHlwZSA9IGgtPnJl
cXVlc3R0eXBlICYgMHg3ZjsKPiArICAgIGlmICghZGV2aWNlLT5tc2MpIHsKPiArICAgICAgICBy
ZXR1cm47Cj4gKyAgICB9Cj4gKyAgICBpZiAocmVxdHlwZSA9PSAoTElCVVNCX1JFUVVFU1RfVFlQ
RV9TVEFOREFSRCB8Cj4gTElCVVNCX1JFQ0lQSUVOVF9FTkRQT0lOVCkpIHsKPiArICAgICAgICAv
LyBtaWdodCBiZSBjbGVhciBzdGFsbCByZXF1ZXN0Cj4gKyAgICAgICAgaC0+bGVuZ3RoID0gMDsK
PiArICAgICAgICBoLT5zdGF0dXMgPSB1c2JfcmVkaXJfc3VjY2Vzczs7Cj4gKyAgICAgICAgcmV0
dXJuOwo+ICsgICAgfQo+ICsKPiArICAgIGlmIChyZXF0eXBlID09IChMSUJVU0JfUkVRVUVTVF9U
WVBFX0NMQVNTIHwgTElCVVNCX1JFQ0lQSUVOVF9JTlRFUkZBQ0UpKQo+IHsKPiArICAgICAgICBz
d2l0Y2ggKGgtPnJlcXVlc3QpIHsKPiArICAgICAgICBjYXNlIDB4RkY6Cj4gKyAgICAgICAgICAg
IC8vIG1hc3Mtc3RvcmFnZSBjbGFzcyByZXF1ZXN0ICdyZXNldCcKPiArICAgICAgICAgICAgdXNi
X2NkX3Jlc2V0KGRldmljZSk7Cj4gKyAgICAgICAgICAgIGgtPmxlbmd0aCA9IDA7Cj4gKyAgICAg
ICAgICAgIGgtPnN0YXR1cyA9IHVzYl9yZWRpcl9zdWNjZXNzOwo+ICsgICAgICAgICAgICBicmVh
azsKPiArICAgICAgICBjYXNlIDB4RkU6Cj4gKyAgICAgICAgICAgIC8vIG1hc3Mtc3RvcmFnZSBj
bGFzcyByZXF1ZXN0ICdnZXQgbWF4IGx1bicKPiArICAgICAgICAgICAgLy8gcmV0dXJuaW5nIG9u
ZSBieXRlCj4gKyAgICAgICAgICAgIGlmIChoLT5sZW5ndGgpIHsKPiArICAgICAgICAgICAgICAg
IGgtPmxlbmd0aCA9IDE7Cj4gKyAgICAgICAgICAgICAgICBoLT5zdGF0dXMgPSB1c2JfcmVkaXJf
c3VjY2Vzczs7Cj4gKyAgICAgICAgICAgICAgICAqYnVmZmVyID0gJmRldmljZS0+bWF4X2x1bl9p
bmRleDsKPiArICAgICAgICAgICAgfQo+ICsgICAgICAgICAgICBicmVhazsKPiArICAgICAgICB9
Cj4gKyAgICB9Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIHVzYl9jZF9idWxrX291dF9yZXF1ZXN0
KFVzYkNkICpkZXZpY2UsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVp
bnQ4X3QgZXAsIHVpbnQ4X3QgKmRhdGEsIGludCBkYXRhX2xlbiwKPiArICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgdWludDhfdCAqc3RhdHVzKQo+ICt7Cj4gKyAgICBpZiAoIWNk
X3VzYl9idWxrX21zZF93cml0ZShkZXZpY2UtPm1zYywgZGF0YSwgZGF0YV9sZW4pKSB7Cj4gKyAg
ICAgICAgKnN0YXR1cyA9IHVzYl9yZWRpcl9zdWNjZXNzOwo+ICsgICAgfQo+ICt9Cj4gKwo+ICt2
b2lkIGNkX3VzYl9idWxrX21zZF9yZWFkX2NvbXBsZXRlKHZvaWQgKnVzZXJfZGF0YSwKPiArICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50OF90ICpkYXRhLCB1aW50MzJfdCBs
ZW5ndGgsCj4gQ2RVc2JCdWxrU3RhdHVzIHN0YXR1cykKPiArewo+ICsgICAgVXNiQ2QgKmQgPSAo
VXNiQ2QgKil1c2VyX2RhdGE7Cj4gKwo+ICsgICAgaWYgKGQtPmRlbGV0aW5nKSB7Cj4gKyAgICAg
ICAgZC0+ZGVsZXRpbmcgPSBGQUxTRTsKPiArICAgICAgICBzcGljZV91c2JfYmFja2VuZF9kZXZp
Y2VfZWplY3QoZC0+YmFja2VuZCwgZC0+cGFyZW50KTsKPiArICAgIH0KPiArCj4gKyAgICBpZiAo
ZC0+cGFyc2VyKSB7Cj4gKyAgICAgICAgaW50IG5yZWFkOwo+ICsgICAgICAgIHVpbnQzMl90IG9m
ZnNldCA9IDA7Cj4gKwo+ICsgICAgICAgIGZvciAobnJlYWQgPSAwOyBucmVhZCA8IGQtPm51bV9y
ZWFkczsgbnJlYWQrKykgewo+ICsgICAgICAgICAgICB1aW50MzJfdCBtYXhfbGVuOwo+ICsgICAg
ICAgICAgICBtYXhfbGVuID0gKGQtPnJlYWRfYnVsa1tucmVhZF0uaG91dC5sZW5ndGhfaGlnaCA8
PCAxNikgfAo+ICsgICAgICAgICAgICAgICAgICAgICAgICBkLT5yZWFkX2J1bGtbbnJlYWRdLmhv
dXQubGVuZ3RoOwo+ICsgICAgICAgICAgICBpZiAobWF4X2xlbiA+IGxlbmd0aCkgewo+ICsgICAg
ICAgICAgICAgICAgbWF4X2xlbiA9IGxlbmd0aDsKPiArICAgICAgICAgICAgICAgIGQtPnJlYWRf
YnVsa1tucmVhZF0uaG91dC5sZW5ndGggPSBsZW5ndGg7Cj4gKyAgICAgICAgICAgICAgICBkLT5y
ZWFkX2J1bGtbbnJlYWRdLmhvdXQubGVuZ3RoX2hpZ2ggPSBsZW5ndGggPj4gMTY7Cj4gKyAgICAg
ICAgICAgIH0KPiArCj4gKyAgICAgICAgICAgIHN3aXRjaCAoc3RhdHVzKSB7Cj4gKyAgICAgICAg
ICAgIGNhc2UgQlVMS19TVEFUVVNfR09PRDoKPiArICAgICAgICAgICAgICAgIGQtPnJlYWRfYnVs
a1tucmVhZF0uaG91dC5zdGF0dXMgPSB1c2JfcmVkaXJfc3VjY2VzczsKPiArICAgICAgICAgICAg
ICAgIGJyZWFrOwo+ICsgICAgICAgICAgICBjYXNlIEJVTEtfU1RBVFVTX0NBTkNFTEVEOgo+ICsg
ICAgICAgICAgICAgICAgZC0+cmVhZF9idWxrW25yZWFkXS5ob3V0LnN0YXR1cyA9IHVzYl9yZWRp
cl9jYW5jZWxsZWQ7Cj4gKyAgICAgICAgICAgICAgICBicmVhazsKPiArICAgICAgICAgICAgY2Fz
ZSBCVUxLX1NUQVRVU19FUlJPUjoKPiArICAgICAgICAgICAgICAgIGQtPnJlYWRfYnVsa1tucmVh
ZF0uaG91dC5zdGF0dXMgPSB1c2JfcmVkaXJfaW9lcnJvcjsKPiArICAgICAgICAgICAgICAgIGJy
ZWFrOwo+ICsgICAgICAgICAgICBjYXNlIEJVTEtfU1RBVFVTX1NUQUxMOgo+ICsgICAgICAgICAg
ICBkZWZhdWx0Ogo+ICsgICAgICAgICAgICAgICAgZC0+cmVhZF9idWxrW25yZWFkXS5ob3V0LnN0
YXR1cyA9IHVzYl9yZWRpcl9zdGFsbDsKPiArICAgICAgICAgICAgICAgIGJyZWFrOwo+ICsgICAg
ICAgICAgICB9Cj4gKwo+ICsgICAgICAgICAgICBTUElDRV9ERUJVRygiJXM6IHJlc3BvbmRpbmcg
JSIgR19HVUlOVDY0X0ZPUk1BVCAiIHdpdGggbGVuICV1Cj4gb3V0IG9mICV1LCBzdGF0dXMgJWQi
LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICBfX0ZVTkNUSU9OX18sIGQtPnJlYWRfYnVsa1tu
cmVhZF0uaWQsIG1heF9sZW4sCj4gKyAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aCwgZC0+
cmVhZF9idWxrW25yZWFkXS5ob3V0LnN0YXR1cyk7Cj4gKyAgICAgICAgICAgIHVzYnJlZGlycGFy
c2VyX3NlbmRfYnVsa19wYWNrZXQoZC0+cGFyc2VyLAo+IGQtPnJlYWRfYnVsa1tucmVhZF0uaWQs
Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmQtPnJlYWRf
YnVsa1tucmVhZF0uaG91dCwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBtYXhfbGVuID8gKGRhdGEgKyBvZmZzZXQpIDoKPiBOVUxMLAo+ICsgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heF9sZW4pOwo+ICsgICAgICAgICAg
ICBvZmZzZXQgKz0gbWF4X2xlbjsKPiArICAgICAgICAgICAgbGVuZ3RoIC09IG1heF9sZW47Cj4g
KyAgICAgICAgfQo+ICsgICAgICAgIGQtPm51bV9yZWFkcyA9IDA7Cj4gKyAgICAgICAgdXNicmVk
aXJwYXJzZXJfZG9fd3JpdGUoZC0+cGFyc2VyKTsKPiArCj4gKyAgICAgICAgaWYgKGxlbmd0aCkg
ewo+ICsgICAgICAgICAgICBTUElDRV9ERUJVRygiJXM6IEVSUk9SOiAldSBieXRlcyB3ZXJlIG5v
dCByZXBvcnRlZCEiLAo+IF9fRlVOQ1RJT05fXywgbGVuZ3RoKTsKPiArICAgICAgICB9Cj4gKwo+
ICsgICAgfSBlbHNlIHsKPiArICAgICAgICBTUElDRV9ERUJVRygiJXM6IGJyb2tlbiBkZXZpY2U8
LT5jaGFubmVsIHJlbGF0aW9uc2hpcCEiLAo+IF9fRlVOQ1RJT05fXyk7Cj4gKyAgICB9Cj4gK30K
PiArCj4gKy8qIGRldmljZSByZXNldCBjb21wbGV0aW9uIGNhbGxiYWNrICovCj4gK3ZvaWQgY2Rf
dXNiX2J1bGtfbXNkX3Jlc2V0X2NvbXBsZXRlKHZvaWQgKnVzZXJfZGF0YSwgaW50IHN0YXR1cykK
PiArewo+ICsgICAgLy8gVXNiQ2QgKmQgPSAoVXNiQ2QgKil1c2VyX2RhdGE7Cj4gK30KPiArCj4g
K3N0YXRpYyBnYm9vbGVhbiB1c2JfY2RfYnVsa19pbl9yZXF1ZXN0KFVzYkNkICpkLCB1aW50NjRf
dCBpZCwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHVz
Yl9yZWRpcl9idWxrX3BhY2tldF9oZWFkZXIKPiAqaCkKPiArewo+ICsgICAgaW50IHJlczsKPiAr
ICAgIHVpbnQzMl90IGxlbiA9IChoLT5sZW5ndGhfaGlnaCA8PCAxNikgfCBoLT5sZW5ndGg7Cj4g
KyAgICBpZiAoZC0+bnVtX3JlYWRzID49IE1BWF9CVUxLX0lOX1JFUVVFU1RTKSB7Cj4gKyAgICAg
ICAgaC0+bGVuZ3RoID0gaC0+bGVuZ3RoX2hpZ2ggPSAwOwo+ICsgICAgICAgIFNQSUNFX0RFQlVH
KCIlczogdG9vIG1hbnkgcGVuZGluZyByZWFkcyIsIF9fRlVOQ1RJT05fXyk7Cj4gKyAgICAgICAg
aC0+c3RhdHVzID0gdXNiX3JlZGlyX2JhYmJsZTsKPiArICAgICAgICByZXR1cm4gRkFMU0U7Cj4g
KyAgICB9Cj4gKwo+ICsgICAgaWYgKGQtPm51bV9yZWFkcykgewo+ICsgICAgICAgIFNQSUNFX0RF
QlVHKCIlczogYWxyZWFkeSBoYXMgJXUgcGVuZGluZyByZWFkcyIsIF9fRlVOQ1RJT05fXywKPiBk
LT5udW1fcmVhZHMpOwo+ICsgICAgfQo+ICsKPiArICAgIGQtPnJlYWRfYnVsa1tkLT5udW1fcmVh
ZHNdLmhvdXQgPSAqaDsKPiArICAgIGQtPnJlYWRfYnVsa1tkLT5udW1fcmVhZHNdLmlkID0gaWQ7
Cj4gKyAgICBkLT5udW1fcmVhZHMrKzsKPiArICAgIHJlcyA9IGNkX3VzYl9idWxrX21zZF9yZWFk
KGQtPm1zYywgbGVuKTsKPiArICAgIGlmICghcmVzKSB7Cj4gKyAgICAgICAgcmV0dXJuIFRSVUU7
Cj4gKyAgICB9Cj4gKwo+ICsgICAgU1BJQ0VfREVCVUcoIiVzOiBlcnJvciBvbiBidWxrIHJlYWQi
LCBfX0ZVTkNUSU9OX18pOwo+ICsgICAgZC0+bnVtX3JlYWRzLS07Cj4gKyAgICBoLT5sZW5ndGgg
PSBoLT5sZW5ndGhfaGlnaCA9IDA7Cj4gKyAgICBoLT5zdGF0dXMgPSB1c2JfcmVkaXJfaW9lcnJv
cjsKPiArCj4gKyAgICByZXR1cm4gRkFMU0U7Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIHVzYl9j
ZF9jYW5jZWxfcmVxdWVzdChVc2JDZCAqZCwgdWludDY0X3QgaWQpCj4gK3sKPiArICAgIHVpbnQz
Ml90IG5yZWFkOwo+ICsKPiArICAgIGZvciAobnJlYWQgPSAwOyBucmVhZCA8IGQtPm51bV9yZWFk
czsgbnJlYWQrKykgewo+ICsgICAgICAgIGlmIChkLT5yZWFkX2J1bGtbbnJlYWRdLmlkID09IGlk
KSB7Cj4gKyAgICAgICAgICAgIGlmIChjZF91c2JfYnVsa19tc2RfY2FuY2VsX3JlYWQoZC0+bXNj
KSkgewo+ICsgICAgICAgICAgICAgICAgY2RfdXNiX2J1bGtfbXNkX3JlYWRfY29tcGxldGUoZCwg
TlVMTCwgMCwKPiBCVUxLX1NUQVRVU19DQU5DRUxFRCk7Cj4gKyAgICAgICAgICAgIH0KPiArICAg
ICAgICAgICAgcmV0dXJuOwo+ICsgICAgICAgIH0KPiArICAgIH0KPiArICAgIFNQSUNFX0RFQlVH
KCIlczogRVJST1I6IG5vIHN1Y2ggaWQgdG8gY2FuY2VsISIsIF9fRlVOQ1RJT05fXyk7Cj4gK30K
PiArCj4gKy8vIGNhbGxlZCB3aGVuIGEgY2hhbmdlIGhhcHBlbnMgb24gU0NTSSBsYXllcgo+ICt2
b2lkIGNkX3VzYl9idWxrX21zZF9sdW5fY2hhbmdlZCh2b2lkICp1c2VyX2RhdGEsIHVpbnQzMl90
IGx1bikKPiArewo+ICsgICAgVXNiQ2QgKmQgPSAoVXNiQ2QgKil1c2VyX2RhdGE7Cj4gKyAgICBD
ZFNjc2lEZXZpY2VJbmZvIGNkX2luZm87Cj4gKwo+ICsgICAgaWYgKCFjZF91c2JfYnVsa19tc2Rf
Z2V0X2luZm8oZC0+bXNjLCBsdW4sICZjZF9pbmZvKSkgewo+ICsgICAgICAgIC8vIGxvYWQgb3Ig
dW5sb2FkIGNvbW1hbmQgcmVjZWl2ZWQgZnJvbSBTQ1NJCj4gKyAgICAgICAgaWYgKGQtPnVuaXRz
W2x1bl0ubG9hZGVkICE9IGNkX2luZm8ubG9hZGVkKSB7Cj4gKyAgICAgICAgICAgIGlmICghbG9h
ZF9sdW4oZCwgbHVuLCBjZF9pbmZvLmxvYWRlZCkpIHsKPiArICAgICAgICAgICAgICAgIFNQSUNF
X0RFQlVHKCIlczogbG9hZCBmYWlsZWQsIHVubG9hZGluZyB1bml0IiwKPiBfX0ZVTkNUSU9OX18p
Owo+ICsgICAgICAgICAgICAgICAgY2RfdXNiX2J1bGtfbXNkX3VubG9hZChkLT5tc2MsIGx1bik7
Cj4gKyAgICAgICAgICAgIH0KPiArICAgICAgICB9Cj4gKyAgICB9Cj4gKwo+ICsgICAgaWYgKGQt
PmRlbGV0ZV9vbl9lamVjdCkgewo+ICsgICAgICAgIGQtPmRlbGV0ZV9vbl9lamVjdCA9IEZBTFNF
Owo+ICsgICAgICAgIGQtPmRlbGV0aW5nID0gVFJVRTsKPiArICAgIH0gZWxzZSB7Cj4gKyAgICAg
ICAgc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX3JlcG9ydF9jaGFuZ2UoZC0+YmFja2VuZCwgZC0+
cGFyZW50KTsKPiArICAgIH0KPiArfQo+ICsKPiArc3RhdGljIGdjaGFyICp1c2JfY2RfZ2V0X3By
b2R1Y3RfZGVzY3JpcHRpb24oVXNiQ2QgKmRldmljZSkKPiArewo+ICsgICAgZ2NoYXIgKmJhc2Vf
bmFtZSA9IGdfcGF0aF9nZXRfYmFzZW5hbWUoZGV2aWNlLT51bml0c1swXS5maWxlbmFtZSk7Cj4g
KyAgICBnY2hhciAqcmVzID0gZ19zdHJkdXBfcHJpbnRmKCJTUElDRSBDRCAoJXMpIiwgYmFzZV9u
YW1lKTsKPiArICAgIGdfZnJlZShiYXNlX25hbWUpOwo+ICsgICAgcmV0dXJuIHJlczsKPiArfQo+
ICsKPiArc3RhdGljIGNvbnN0IFVzYkRldmljZU9wcyBkZXZvcHMgPQo+ICt7Cj4gKyAgICAuZ2V0
X2Rlc2NyaXB0b3IgPSB1c2JfY2RfZ2V0X2Rlc2NyaXB0b3IsCj4gKyAgICAuZ2V0X3Byb2R1Y3Rf
ZGVzY3JpcHRpb24gPSB1c2JfY2RfZ2V0X3Byb2R1Y3RfZGVzY3JpcHRpb24sCj4gKyAgICAuYXR0
YWNoID0gdXNiX2NkX2F0dGFjaCwKPiArICAgIC5yZXNldCA9IHVzYl9jZF9yZXNldCwKPiArICAg
IC5kZXRhY2ggPSB1c2JfY2RfZGV0YWNoLAo+ICsgICAgLmNvbnRyb2xfcmVxdWVzdCA9IHVzYl9j
ZF9jb250cm9sX3JlcXVlc3QsCj4gKyAgICAuYnVsa19vdXRfcmVxdWVzdCA9IHVzYl9jZF9idWxr
X291dF9yZXF1ZXN0LAo+ICsgICAgLmJ1bGtfaW5fcmVxdWVzdCA9IHVzYl9jZF9idWxrX2luX3Jl
cXVlc3QsCj4gKyAgICAuY2FuY2VsX3JlcXVlc3QgPSB1c2JfY2RfY2FuY2VsX3JlcXVlc3QsCj4g
KyAgICAudW5yZWFsaXplID0gdXNiX2NkX3VucmVhbGl6ZSwKPiArfTsKPiArCj4gK3N0YXRpYyBV
c2JDZCogdXNiX2NkX2NyZWF0ZShTcGljZVVzYkJhY2tlbmQgKmJlLAo+ICsgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpwYXJlbnQsCj4gKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB2b2lkICpvcGFxdWVfcGFyYW0sCj4gKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBHRXJyb3IgKiplcnIpCj4gK3sKPiArICAgIENkRW11bGF0aW9uUGFyYW1z
ICpwYXJhbSA9IG9wYXF1ZV9wYXJhbTsKPiArICAgIGludCBlcnJvciA9IDAsIGk7Cj4gKyAgICB1
aW50MzJfdCB1bml0ID0gMDsKPiArICAgIFVzYkNkICpkID0gZ19uZXcwKFVzYkNkLCAxKTsKPiAr
ICAgIENkU2NzaURldmljZVBhcmFtZXRlcnMgZGV2X3BhcmFtcyA9IHsgMCB9Owo+ICsgICAgdWlu
dDE2X3QgYWRkcmVzcyA9IHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9nZXRfaW5mbyhwYXJlbnQp
LT5hZGRyZXNzOwo+ICsKPiArICAgIGQtPmRldl9vcHMgPSBkZXZvcHM7Cj4gKyAgICBkLT5iYWNr
ZW5kID0gYmU7Cj4gKyAgICBkLT5wYXJlbnQgID0gcGFyZW50Owo+ICsgICAgZC0+ZGVsZXRlX29u
X2VqZWN0ID0gISFwYXJhbS0+ZGVsZXRlX29uX2VqZWN0Owo+ICsgICAgZC0+bG9ja2VkID0gIWQt
PmRlbGV0ZV9vbl9lamVjdDsKPiArICAgIGQtPnNlcmlhbFswXSA9IDB4MDMwMCArIHNpemVvZihk
LT5zZXJpYWwpOwo+ICsgICAgZC0+c2VyaWFsWzFdID0gJzAnICsgYWRkcmVzcyAvIDEwOwo+ICsg
ICAgZC0+c2VyaWFsWzJdID0gJzAnICsgYWRkcmVzcyAlIDEwOwo+ICsgICAgZm9yIChpID0gMzsg
aSA8IEdfTl9FTEVNRU5UUyhkLT5zZXJpYWwpOyArK2kpIHsKPiArICAgICAgICBkLT5zZXJpYWxb
aV0gPSAnMCc7Cj4gKyAgICB9Cj4gKyAgICBkLT5tYXhfbHVuX2luZGV4ID0gTUFYX0xVTl9QRVJf
REVWSUNFIC0gMTsKPiArCj4gKyAgICBkZXZfcGFyYW1zLnZlbmRvciA9ICJSZWQgSGF0IjsKPiAr
ICAgIGRldl9wYXJhbXMucHJvZHVjdCA9ICJTUElDRSBDRCI7Cj4gKyAgICBkZXZfcGFyYW1zLnZl
cnNpb24gPSAiMCI7Cj4gKwo+ICsgICAgZC0+bXNjID0gY2RfdXNiX2J1bGtfbXNkX2FsbG9jKGQs
IE1BWF9MVU5fUEVSX0RFVklDRSk7Cj4gKyAgICBpZiAoIWQtPm1zYykgewo+ICsgICAgICAgIGdf
Y2xlYXJfcG9pbnRlcigmZCwgZ19mcmVlKTsKPiArICAgICAgICBnX3NldF9lcnJvcihlcnIsIFNQ
SUNFX0NMSUVOVF9FUlJPUiwgU1BJQ0VfQ0xJRU5UX0VSUk9SX0ZBSUxFRCwKPiArICAgICAgICAg
ICAgICAgICAgICBfKCJjYW4ndCBhbGxvY2F0ZSBkZXZpY2UiKSk7Cj4gKyAgICAgICAgcmV0dXJu
IE5VTEw7Cj4gKyAgICB9Cj4gKyAgICBkLT51bml0c1t1bml0XS5ibG9ja1NpemUgPSBDRF9ERVZf
QkxPQ0tfU0laRTsKPiArICAgIGlmICghY2RfdXNiX2J1bGtfbXNkX3JlYWxpemUoZC0+bXNjLCB1
bml0LCAmZGV2X3BhcmFtcykpIHsKPiArICAgICAgICBpZiAob3Blbl9zdHJlYW0oJmQtPnVuaXRz
W3VuaXRdLCBwYXJhbS0+ZmlsZW5hbWUpICYmCj4gKyAgICAgICAgICAgIGxvYWRfbHVuKGQsIHVu
aXQsIFRSVUUpKSB7Cj4gKyAgICAgICAgICAgIGlmIChkLT5sb2NrZWQpIHsKPiArICAgICAgICAg
ICAgICAgIGNkX3VzYl9idWxrX21zZF9sb2NrKGQtPm1zYywgdW5pdCwgVFJVRSk7Cj4gKyAgICAg
ICAgICAgIH0KPiArICAgICAgICB9IGVsc2Ugewo+ICsgICAgICAgICAgICBjbG9zZV9zdHJlYW0o
JmQtPnVuaXRzW3VuaXRdKTsKPiArICAgICAgICAgICAgY2RfdXNiX2J1bGtfbXNkX3VucmVhbGl6
ZShkLT5tc2MsIHVuaXQpOwo+ICsgICAgICAgICAgICBnX3NldF9lcnJvcihlcnIsIFNQSUNFX0NM
SUVOVF9FUlJPUiwgU1BJQ0VfQ0xJRU5UX0VSUk9SX0ZBSUxFRCwKPiArICAgICAgICAgICAgICAg
ICAgICAgICAgXygiY2FuJ3QgY3JlYXRlIGRldmljZSB3aXRoICVzIiksCj4gKyAgICAgICAgICAg
ICAgICAgICAgICAgIHBhcmFtLT5maWxlbmFtZSk7Cj4gKyAgICAgICAgICAgIGVycm9yID0gMTsK
PiArICAgICAgICB9Cj4gKyAgICB9IGVsc2Ugewo+ICsgICAgICAgIGdfc2V0X2Vycm9yKGVyciwg
U1BJQ0VfQ0xJRU5UX0VSUk9SLCBTUElDRV9DTElFTlRfRVJST1JfRkFJTEVELAo+ICsgICAgICAg
ICAgICAgICAgICAgIF8oImNhbid0IGFsbG9jYXRlIGRldmljZSIpKTsKPiArICAgICAgICBlcnJv
ciA9IDE7Cj4gKyAgICB9Cj4gKyAgICBpZiAoZXJyb3IpIHsKPiArICAgICAgICBnX2NsZWFyX3Bv
aW50ZXIoJmQtPm1zYywgY2RfdXNiX2J1bGtfbXNkX2ZyZWUpOwo+ICsgICAgICAgIGdfY2xlYXJf
cG9pbnRlcigmZCwgZ19mcmVlKTsKPiArICAgICAgICByZXR1cm4gTlVMTDsKPiArICAgIH0KPiAr
Cj4gKyAgICByZXR1cm4gZDsKPiArfQo+ICsKPiArZ2Jvb2xlYW4KPiArY3JlYXRlX2VtdWxhdGVk
X2NkKFNwaWNlVXNiQmFja2VuZCAqYmUsCj4gKyAgICAgICAgICAgICAgICAgICBDZEVtdWxhdGlv
blBhcmFtcyAqcGFyYW0sCj4gKyAgICAgICAgICAgICAgICAgICBHRXJyb3IgKiplcnIpCj4gK3sK
PiArICAgIHJldHVybiBzcGljZV91c2JfYmFja2VuZF9jcmVhdGVfZW11bGF0ZWRfZGV2aWNlKGJl
LCB1c2JfY2RfY3JlYXRlLAo+IHBhcmFtLCBlcnIpOwo+ICt9Cj4gKwo+ICsjZW5kaWYgLyogVVNF
X1VTQlJFRElSICovCj4gZGlmZiAtLWdpdCBhL3NyYy91c2ItZGV2aWNlLWNkLmggYi9zcmMvdXNi
LWRldmljZS1jZC5oCj4gbmV3IGZpbGUgbW9kZSAxMDA2NDQKPiBpbmRleCAwMDAwMDAwLi5lOTg1
MjQyCj4gLS0tIC9kZXYvbnVsbAo+ICsrKyBiL3NyYy91c2ItZGV2aWNlLWNkLmgKPiBAQCAtMCww
ICsxLDM0IEBACj4gKy8qIC0qLSBNb2RlOiBDOyBjLWJhc2ljLW9mZnNldDogNDsgaW5kZW50LXRh
YnMtbW9kZTogbmlsIC0qLSAqLwo+ICsvKgo+ICsgICAgQ29weXJpZ2h0IChDKSAyMDE5IFJlZCBI
YXQsIEluYy4KPiArCj4gKyAgICBSZWQgSGF0IEF1dGhvcnM6Cj4gKyAgICBZdXJpIEJlbmRpdG92
aWNoPHliZW5kaXRvQHJlZGhhdC5jb20+Cj4gKwo+ICsgICAgVGhpcyBsaWJyYXJ5IGlzIGZyZWUg
c29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vcgo+ICsgICAgbW9kaWZ5IGl0
IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYwo+ICsgICAg
TGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0
aGVyCj4gKyAgICB2ZXJzaW9uIDIuMSBvZiB0aGUgTGljZW5zZSwgb3IgKGF0IHlvdXIgb3B0aW9u
KSBhbnkgbGF0ZXIgdmVyc2lvbi4KPiArCj4gKyAgICBUaGlzIGxpYnJhcnkgaXMgZGlzdHJpYnV0
ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKPiArICAgIGJ1dCBXSVRIT1VU
IEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCj4gKyAg
ICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBT
ZWUgdGhlIEdOVQo+ICsgICAgTGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUg
ZGV0YWlscy4KPiArCj4gKyAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRo
ZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCj4gKyAgICBMaWNlbnNlIGFsb25nIHdpdGggdGhp
cyBsaWJyYXJ5OyBpZiBub3QsIHNlZQo+IDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4K
PiArKi8KPiArCj4gKyNwcmFnbWEgb25jZQo+ICsKPiArI2luY2x1ZGUgInVzYi1iYWNrZW5kLmgi
Cj4gKwo+ICt0eXBlZGVmIHN0cnVjdCBDZEVtdWxhdGlvblBhcmFtcyB7Cj4gKyAgICBjb25zdCBj
aGFyICpmaWxlbmFtZTsKPiArICAgIHVpbnQzMl90IGRlbGV0ZV9vbl9lamVjdCA6IDE7Cj4gK30g
Q2RFbXVsYXRpb25QYXJhbXM7Cj4gKwo+ICtnYm9vbGVhbgo+ICtjcmVhdGVfZW11bGF0ZWRfY2Qo
U3BpY2VVc2JCYWNrZW5kICpiZSwKPiArICAgICAgICAgICAgICAgICAgIENkRW11bGF0aW9uUGFy
YW1zICpwYXJhbSwKPiArICAgICAgICAgICAgICAgICAgIEdFcnJvciAqKmVycik7Cj4gLS0KPiAy
LjE3LjEKPiAKPiBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
Xwo+IFNwaWNlLWRldmVsIG1haWxpbmcgbGlzdAo+IFNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwo+IGh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
c3BpY2UtZGV2ZWwKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KU3BpY2UtZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNl
LWRldmVs
