Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 6D976A825E
	for <lists+spice-devel@lfdr.de>; Wed,  4 Sep 2019 14:32:13 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F3E91898C8;
	Wed,  4 Sep 2019 12:32:11 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D7CC5898C8
 for <spice-devel@lists.freedesktop.org>; Wed,  4 Sep 2019 12:32:10 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx02.intmail.prod.int.phx2.redhat.com
 [10.5.11.12])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 769D83090FC6
 for <spice-devel@lists.freedesktop.org>; Wed,  4 Sep 2019 12:32:10 +0000 (UTC)
Received: from wingsuit.mxp.redhat.com (unknown [10.32.181.155])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 014BF60C18
 for <spice-devel@lists.freedesktop.org>; Wed,  4 Sep 2019 12:32:09 +0000 (UTC)
From: Victor Toso <victortoso@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Wed,  4 Sep 2019 14:32:09 +0200
Message-Id: <20190904123209.24479-1-victortoso@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.12
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.43]); Wed, 04 Sep 2019 12:32:10 +0000 (UTC)
Subject: [Spice-devel] [spice-gtk v1] Revert "channel: Abort migration in
 delayed unref"
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogVmljdG9yIFRvc28gPG1lQHZpY3RvcnRvc28uY29tPgoKVGhpcyByZXZlcnRzIGNvbW1p
dCAxMDllNTc1ICJjaGFubmVsOiBBYm9ydCBtaWdyYXRpb24gaW4gZGVsYXllZAp1bnJlZiIgaW4g
MjAxNi0wNS0wMiBieSBQYXZlbCBHcnVudCA8cGdydW50QHJlZGhhdC5jb20+CgpUaGlzIGNvbW1p
dCBpcyBiZWluZyByZXZlcnRlZCBiZWNhdXNlIGl0IGNhbGxzCnNwaWNlX3Nlc3Npb25fYWJvcnRf
bWlncmF0aW9uKCkgb24gdGhlIFNwaWNlU2Vzc2lvbiBmb3IgdGhlIHRhcmdldApob3N0IHdoaWxl
IHRoZSBmdW5jdGlvbiBzaG91bGQgcmVjZWl2ZSB0aGUgU3BpY2VTZXNzaW9uIGZvciBjdXJyZW50
Cmhvc3QuCgpJIGNhbiBhY3R1YWxseSByZXByb2R1Y2UgYSBidWcgd2hlcmUgdGhlIHBhc3N3b3Jk
IGV4cGlyZXMgZm9yIHRoZQpjdXJyZW50IFNwaWNlIHNlc3Npb24gYW5kIHRoZSBtaWdyYXRpb24g
aXMgZ29pbmcgdG8gZmFpbCBiZWNhdXNlIG9mCnRoYXQuIEJlZm9yZSByZXZlcnRpbmcgdGhpcyBj
b21taXQsIHJlbW90ZS12aWV3ZXIgd291bGQgaGFuZyBhbmQgdGhlCmZvbGxvd2luZyBsb2dzIHdv
dWxkIG9jY3VyOgoKLSBNaWdyYXRpb24gc3RhcnRzIG9uIGNoYW5uZWwtbWFpbgogPiAuLi9zcmMv
Y2hhbm5lbC1tYWluLmM6MjE3NCBtaWdyYXRlX2NoYW5uZWxfY29ubmVjdCAxOjAKCi0gVXNpbmcg
VExTCiA+IC4uL3NyYy9zcGljZS1jaGFubmVsLmM6MTkzNCBtYWluLTE6MDogc3dpdGNoaW5nIHRv
IHRscwoKLSBGb2xsb3dpbmcgbG9ncyBhcmUgcmVsYXRlZCB0byBmYWlsdXJlIHRvIGNvbm5lY3Qg
ZHVlIEF1dGhlbnRpY2F0aW9uCiA+IC4uL3NyYy9zcGljZS1jaGFubmVsLmM6MjAwMCBtYWluLTE6
MDogdXNlIG1pbmkgaGVhZGVyOiAxCiA+IC4uL3NyYy9zcGljZS1jaGFubmVsLmM6MTI3NCBtYWlu
LTE6MDogbGluayByZXN1bHQ6IHJlcGx5IDcKID4gLi4vc3JjL3NwaWNlLWNoYW5uZWwuYzoyNjgw
IG1haW4tMTowOiBDb3JvdXRpbmUgZXhpdCBtYWluLTE6MAogPiAuLi9zcmMvc3BpY2UtY2hhbm5l
bC5jOjI4NzEgbWFpbi0xOjA6IHJlc2V0CgpSZW1vdGUtdmlld2VyIHdvdWxkIGhhbmcgYmVjYXVz
ZSB3ZSBhcmUgaW4gYSBzdGF0ZSBvZiBtaWdyYXRpb24gYW5kClNwaWNlTWFpbkNoYW5uZWwgZG9l
cyBub3Qga25vdyB0aGF0IGl0IGZhaWxlZCBiZWNhdXNlCnNwaWNlX3Nlc3Npb25fYWJvcnRfbWln
cmF0aW9uKCkgaXMgYmVpbmcgY2FsbGVkIG9uIFNwaWNlU2Vzc2lvbiBvZgp0YXJnZXQgaG9zdCBh
bmQgbm8gU3BpY2VDaGFubmVsOjpjaGFubmVsLWV2ZW50IGlzIGJlaW5nIGVtaXR0ZWQuCgpSZXZl
cnRpbmcgdGhpcyBwYXRjaCBkb2VzIGFib3J0IG1pZ3JhdGlvbiB0aGFua3MgdG8KU3BpY2VDaGFu
bmVsOjpjaGFubmVsLWV2ZW50IGJlaW5nIGVtaXR0ZWQgYW5kIGNhdWdodCBieQpTcGljZU1haW5D
aGFubmVsIGF0IG1pZ3JhdGVfY2hhbm5lbF9ldmVudF9jYigpIHdpdGggdGhlIGxvZzoKCiA+IC4u
L3NyYy9jaGFubmVsLW1haW4uYzoyMjQ3IG1haW4tMTowOiBlcnJvciBvciB1bmhhbmRsZWQgY2hh
bm5lbCBldmVudCBkdXJpbmcgbWlncmF0aW9uOiAyMwogPiAuLi9zcmMvY2hhbm5lbC1tYWluLmM6
MjM3MyBtYWluLTE6MDogbWlncmF0ZSBmYWlsZWQ6IHNvbWUgY2hhbm5lbHMgZmFpbGVkIHRvIGNv
bm5lY3QKCk5vdGUgdGhhdCB0aGUgcmV2ZXJ0ZWQgcGF0Y2ggbWVudGlvbnMgdGhlIGZpeCBvZiBi
dWcgWzBdIHdoaWNoIGlzIGFsc28KYSB2aXJ0LXZpZXdlciB3aXRoIGEgaGFuZ2luZyBzdGF0ZS4g
TG9va2luZyBiYWNrIHRvIHRoZSBsb2dzLCB0aGUKaW50ZXJlc3RpbmcgcGFydCBhcm91bmQgaXNz
dWVzIGFyb3VuZCB1c2JyZWRpciwgdGhhdCBpczoKCiA+IEdTcGljZS1ERUJVRzogY2hhbm5lbC1t
YWluLmM6MjIzNiBtaWdyYXRpb246IGNoYW5uZWwgb3BlbmVkIGNoYW46MHgyOWRkY2UwLCBsZWZ0
IDYKID4gR1NwaWNlLURFQlVHOiBzcGljZS1jaGFubmVsLmM6OTE2IHVzYnJlZGlyLTk6MDogUmVh
ZCBlcnJvciBFcnJvciByZWNlaXZpbmcgZGF0YTogQ29ubmVjdGlvbiByZXNldCBieSBwZWVyCiA+
IEdTcGljZS1ERUJVRzogc3BpY2UtY2hhbm5lbC5jOjEyMTAgdXNicmVkaXItOTowOiBlcnJvciwg
c3dpdGNoaW5nIHRvIHByb3RvY29sIDEgKHNwaWNlIDAuNCkKID4gR1NwaWNlLURFQlVHOiBzcGlj
ZS1jaGFubmVsLmM6MjQzMyB1c2JyZWRpci05OjA6IENvcm91dGluZSBleGl0IHVzYnJlZGlyLTk6
MAogPiBHU3BpY2UtREVCVUc6IHNwaWNlLWNoYW5uZWwuYzoyNDU1IHVzYnJlZGlyLTk6MDogT3Bl
biBjb3JvdXRpbmUgc3RhcnRpbmcgMHgyOWUxMGQwCiA+IEdTcGljZS1ERUJVRzogc3BpY2UtY2hh
bm5lbC5jOjIyODkgdXNicmVkaXItOTowOiBTdGFydGVkIGJhY2tncm91bmQgY29yb3V0aW5lIDB4
MjllMDc1MAogPiBHU3BpY2UtREVCVUc6IHNwaWNlLWNoYW5uZWwuYzo5MTYgdXNicmVkaXItOTox
OiBSZWFkIGVycm9yIEVycm9yIHJlY2VpdmluZyBkYXRhOiBDb25uZWN0aW9uIHJlc2V0IGJ5IHBl
ZXIKID4gR1NwaWNlLURFQlVHOiBzcGljZS1jaGFubmVsLmM6MTA3NiB1c2JyZWRpci05OjE6IGlu
Y29tcGxldGUgYXV0aCByZXBseSAoLTEwNC80KQogPiBHU3BpY2UtREVCVUc6IHNwaWNlLWNoYW5u
ZWwuYzo5MTYgcGxheWJhY2stNTowOiBSZWFkIGVycm9yIEVycm9yIHJlY2VpdmluZyBkYXRhOiBD
b25uZWN0aW9uIHJlc2V0IGJ5IHBlZXIKID4gR1NwaWNlLURFQlVHOiBzcGljZS1jaGFubmVsLmM6
MTA3NiBwbGF5YmFjay01OjA6IGluY29tcGxldGUgYXV0aCByZXBseSAoLTEwNC80KQogPiBHU3Bp
Y2UtREVCVUc6IHNwaWNlLWNoYW5uZWwuYzo5MTYgZGlzcGxheS0yOjA6IFJlYWQgZXJyb3IgRXJy
b3IgcmVjZWl2aW5nIGRhdGE6IENvbm5lY3Rpb24gcmVzZXQgYnkgcGVlcgogPiBHU3BpY2UtREVC
VUc6IHNwaWNlLWNoYW5uZWwuYzoxMDc2IGRpc3BsYXktMjowOiBpbmNvbXBsZXRlIGF1dGggcmVw
bHkgKC0xMDQvNCkKID4gR1NwaWNlLURFQlVHOiBzcGljZS1zZXNzaW9uLmM6MTc3NSBjb25uZWN0
aW5nIDB4N2YxMmJmZmZmYTUwLi4uCiA+IEdTcGljZS1ERUJVRzogc3BpY2Utc2Vzc2lvbi5jOjE4
NTAgb3BlbiBob3N0IGxhYi50ZXN0Lm1lOjU5MDAKID4gR1NwaWNlLURFQlVHOiBjaGFubmVsLW1h
aW4uYzoyMjQxIGVycm9yIG9yIHVuaGFuZGxlZCBjaGFubmVsIGV2ZW50IGR1cmluZyBtaWdyYXRp
b246IDIyCiA+IEdTcGljZS1ERUJVRzogc3BpY2Utc2Vzc2lvbi5jOjE2NjUgc2Vzc2lvbjogZGlz
Y29ubmVjdGluZyAwCiA+IEdTcGljZS1ERUJVRzogc3BpY2UtY2hhbm5lbC5jOjIxNjAgdXNicmVk
aXItOToxOiBjaGFubmVsIGdvdCBlcnJvcgogPiBHU3BpY2UtREVCVUc6IHNwaWNlLWNoYW5uZWwu
YzoyNDMzIHVzYnJlZGlyLTk6MTogQ29yb3V0aW5lIGV4aXQgdXNicmVkaXItOToxCiA+IEdTcGlj
ZS1ERUJVRzogY2hhbm5lbC1tYWluLmM6MjI0MSBlcnJvciBvciB1bmhhbmRsZWQgY2hhbm5lbCBl
dmVudCBkdXJpbmcgbWlncmF0aW9uOiAyMgoKU28sIHRoZSBleHBlY3RlZCBiZWhhdmlvciB3YXMg
aGFwcGVuaW5nIG9uIGVycm9yLCB3aGljaCBpcwpjaGFubmVsLW1haW4gYWJvcnRpbmcgdGhlIG1p
Z3JhdGlvbiBkdWUgU3BpY2VDaGFubmVsOjpjaGFubmVsLWV2ZW50CmJlaW5nIGVtaXR0ZWQgd2l0
aCBzb21lIGZhaWx1cmUuCgpBbHNvIG5vdGUgdGhhdCwgd2l0aCB0aGlzIGNvbW1pdCByZXZlcnRl
ZCwgSSBkb24ndCBleHBlcmllbmNlIGFueQpoYW5naW5nIGFmdGVyIG1pZ3JhdGlvbiBpcyBhYm9y
dGVkLiBMaWtlbHkgdGhlIG9yaWdpbmFsIGJ1ZyB3YXMgZml4ZWQuCgpbMF0gaHR0cHM6Ly9idWd6
aWxsYS5yZWRoYXQuY29tL3Nob3dfYnVnLmNnaT9pZD0xMzE4NTc0CgpSZWxhdGVkOiBodHRwczov
L2J1Z3ppbGxhLnJlZGhhdC5jb20vc2hvd19idWcuY2dpP2lkPTE2OTU2MTgKClNpZ25lZC1vZmYt
Ynk6IFZpY3RvciBUb3NvIDx2aWN0b3J0b3NvQHJlZGhhdC5jb20+Ci0tLQogc3JjL3NwaWNlLWNo
YW5uZWwuYyB8IDggLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCA4IGRlbGV0aW9ucygtKQoKZGlm
ZiAtLWdpdCBhL3NyYy9zcGljZS1jaGFubmVsLmMgYi9zcmMvc3BpY2UtY2hhbm5lbC5jCmluZGV4
IDYxZGUxNzcuLjMxNWUyODcgMTAwNjQ0Ci0tLSBhL3NyYy9zcGljZS1jaGFubmVsLmMKKysrIGIv
c3JjL3NwaWNlLWNoYW5uZWwuYwpAQCAtMjQyMCw3ICsyNDIwLDYgQEAgc3RhdGljIGdib29sZWFu
IHNwaWNlX2NoYW5uZWxfZGVsYXllZF91bnJlZihncG9pbnRlciBkYXRhKQogICAgIFNwaWNlQ2hh
bm5lbCAqY2hhbm5lbCA9IFNQSUNFX0NIQU5ORUwoZGF0YSk7CiAgICAgU3BpY2VDaGFubmVsUHJp
dmF0ZSAqYyA9IGNoYW5uZWwtPnByaXY7CiAgICAgZ2Jvb2xlYW4gd2FzX3JlYWR5ID0gYy0+c3Rh
dGUgPT0gU1BJQ0VfQ0hBTk5FTF9TVEFURV9SRUFEWTsKLSAgICBTcGljZVNlc3Npb24gKnNlc3Np
b247CiAKICAgICBDSEFOTkVMX0RFQlVHKGNoYW5uZWwsICJEZWxheWVkIHVucmVmIGNoYW5uZWwg
JXAiLCBjaGFubmVsKTsKIApAQCAtMjQyOCwxMyArMjQyNyw2IEBAIHN0YXRpYyBnYm9vbGVhbiBz
cGljZV9jaGFubmVsX2RlbGF5ZWRfdW5yZWYoZ3BvaW50ZXIgZGF0YSkKIAogICAgIGMtPnN0YXRl
ID0gU1BJQ0VfQ0hBTk5FTF9TVEFURV9VTkNPTk5FQ1RFRDsKIAotICAgIHNlc3Npb24gPSBzcGlj
ZV9jaGFubmVsX2dldF9zZXNzaW9uKGNoYW5uZWwpOwotICAgIGlmIChzZXNzaW9uICYmIHNwaWNl
X3Nlc3Npb25faXNfZm9yX21pZ3JhdGlvbihzZXNzaW9uKSkgewotICAgICAgICAvKiBlcnJvciBk
dXJpbmcgbWlncmF0aW9uIC0gYWJvcnQgbWlncmF0aW9uICovCi0gICAgICAgIHNwaWNlX3Nlc3Np
b25fYWJvcnRfbWlncmF0aW9uKHNlc3Npb24pOwotICAgICAgICByZXR1cm4gRkFMU0U7Ci0gICAg
fQotCiAgICAgaWYgKGMtPmV2ZW50ICE9IFNQSUNFX0NIQU5ORUxfTk9ORSkgewogICAgICAgICBn
X2Nvcm91dGluZV9zaWduYWxfZW1pdChjaGFubmVsLCBzaWduYWxzW1NQSUNFX0NIQU5ORUxfRVZF
TlRdLCAwLCBjLT5ldmVudCk7CiAgICAgICAgIGMtPmV2ZW50ID0gU1BJQ0VfQ0hBTk5FTF9OT05F
OwotLSAKMi4yMS4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpTcGljZS1kZXZlbCBtYWlsaW5nIGxpc3QKU3BpY2UtZGV2ZWxAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vc3Bp
Y2UtZGV2ZWw=
