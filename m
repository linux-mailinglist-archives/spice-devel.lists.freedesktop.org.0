Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 99E0C7A76D
	for <lists+spice-devel@lfdr.de>; Tue, 30 Jul 2019 14:03:42 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C9FED89079;
	Tue, 30 Jul 2019 12:03:40 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 61A1389079
 for <spice-devel@lists.freedesktop.org>; Tue, 30 Jul 2019 12:03:38 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
 [10.5.11.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 0B2393016726;
 Tue, 30 Jul 2019 12:03:38 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.10])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 0AD695D6A7;
 Tue, 30 Jul 2019 12:03:36 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Tue, 30 Jul 2019 13:02:50 +0100
Message-Id: <20190730120331.17967-2-fziglio@redhat.com>
In-Reply-To: <20190730120331.17967-1-fziglio@redhat.com>
References: <20190730120331.17967-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.42]); Tue, 30 Jul 2019 12:03:38 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-gtk 01/44] usb-redir: define interfaces
 to support emulated devices
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogWXVyaSBCZW5kaXRvdmljaCA8eXVyaS5iZW5kaXRvdmljaEBkYXluaXguY29tPgoKU3Bp
Y2VVc2JCYWNrZW5kRGV2aWNlIHN0cnVjdHVyZSBpcyBleHRlbmRlZCB0byBzdXBwb3J0CmFkZGl0
aW9uYWwga2luZCBvZiBkZXZpY2UgdGhhdCBpcyBlbXVsYXRlZCBieSBTcGljZS1HVEsKYW5kIG5v
dCBwcmVzZW50IGxvY2FsbHkgKGFuZCBkb2VzIG5vdCBoYXZlIGxpYnVzYl9kZXZpY2UpLApzdWNo
IGRldmljZSBoYXMgaW5zdGVhZCBwb2ludGVyIHRvIFNwaWNlVXNiRW11bGF0ZWREZXZpY2UKYWJz
dHJhY3Qgc3RydWN0dXJlLiBTcGVjaWZpYyBpbXBsZW1lbnRhdGlvbiBvZiBzdWNoIGRldmljZQpk
ZXBlbmRzIG9uIGl0cyBkZXZpY2UgdHlwZSAoY3VycmVudGx5IG9ubHkgJ0NEIGRldmljZScKZGVm
aW5lZCkuIEltcGxlbWVudGF0aW9uIG1vZHVsZSByZWdpc3RlcnMgY29uc3RydWN0b3IgZm9yCnRo
aXMgZGV2aWNlIHR5cGUuIERldmljZSBzdHJ1Y3R1cmUgaXMgYWJzdHJhY3QgYnV0IGFsd2F5cwpz
dGFydHMgZnJvbSB0YWJsZSBvZiB2aXJ0dWFsIGZ1bmN0aW9ucyByZXF1aXJlZCB0byByZWRpcmVj
dApzdWNoIHZpcnR1YWwgZGV2aWNlLgoKU2lnbmVkLW9mZi1ieTogWXVyaSBCZW5kaXRvdmljaCA8
eXVyaS5iZW5kaXRvdmljaEBkYXluaXguY29tPgotLS0KIHNyYy9tZXNvbi5idWlsZCAgICAgfCAg
IDEgKwogc3JjL3VzYi1iYWNrZW5kLmMgICB8IDEyOCArKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrLQogc3JjL3VzYi1iYWNrZW5kLmggICB8ICAzNiArKysrKysrKysr
KystCiBzcmMvdXNiLWVtdWxhdGlvbi5oIHwgIDg4ICsrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKwogNCBmaWxlcyBjaGFuZ2VkLCAyNTAgaW5zZXJ0aW9ucygrKSwgMyBkZWxldGlvbnMoLSkK
IGNyZWF0ZSBtb2RlIDEwMDY0NCBzcmMvdXNiLWVtdWxhdGlvbi5oCgpkaWZmIC0tZ2l0IGEvc3Jj
L21lc29uLmJ1aWxkIGIvc3JjL21lc29uLmJ1aWxkCmluZGV4IGFkY2ZhZWNkLi40OWZlYzUyZSAx
MDA2NDQKLS0tIGEvc3JjL21lc29uLmJ1aWxkCisrKyBiL3NyYy9tZXNvbi5idWlsZApAQCAtMTIy
LDYgKzEyMiw3IEBAIHNwaWNlX2NsaWVudF9nbGliX3NvdXJjZXMgPSBbCiAgICd1c2J1dGlsLmMn
LAogICAndXNidXRpbC5oJywKICAgJ3VzYi1iYWNrZW5kLmMnLAorICAndXNiLWVtdWxhdGlvbi5o
JywKICAgJ3VzYi1iYWNrZW5kLmgnLAogICAndm1jc3RyZWFtLmMnLAogICAndm1jc3RyZWFtLmgn
LApkaWZmIC0tZ2l0IGEvc3JjL3VzYi1iYWNrZW5kLmMgYi9zcmMvdXNiLWJhY2tlbmQuYwppbmRl
eCA5YWM4NTk1Yy4uMGJmMmVjY2YgMTAwNjQ0Ci0tLSBhL3NyYy91c2ItYmFja2VuZC5jCisrKyBi
L3NyYy91c2ItYmFja2VuZC5jCkBAIC0zOSw2ICszOSw3IEBACiAjaW5jbHVkZSAidXNicmVkaXJw
YXJzZXIuaCIKICNpbmNsdWRlICJzcGljZS11dGlsLmgiCiAjaW5jbHVkZSAidXNiLWJhY2tlbmQu
aCIKKyNpbmNsdWRlICJ1c2ItZW11bGF0aW9uLmgiCiAjaW5jbHVkZSAiY2hhbm5lbC11c2JyZWRp
ci1wcml2LmgiCiAjaW5jbHVkZSAic3BpY2UtY2hhbm5lbC1wcml2LmgiCiAKQEAgLTQ3LDYgKzQ4
LDcgQEAKIHN0cnVjdCBfU3BpY2VVc2JCYWNrZW5kRGV2aWNlCiB7CiAgICAgbGlidXNiX2Rldmlj
ZSAqbGlidXNiX2RldmljZTsKKyAgICBTcGljZVVzYkVtdWxhdGVkRGV2aWNlICplZGV2OwogICAg
IGdpbnQgcmVmX2NvdW50OwogICAgIFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmF0dGFjaGVkX3Rv
OwogICAgIFVzYkRldmljZUluZm9ybWF0aW9uIGRldmljZV9pbmZvOwpAQCAtNjYsNiArNjgsOSBA
QCBzdHJ1Y3QgX1NwaWNlVXNiQmFja2VuZAogICAgIGxpYnVzYl9kZXZpY2UgKipsaWJ1c2JfZGV2
aWNlX2xpc3Q7CiAgICAgZ2ludCByZWRpcmVjdGluZzsKICNlbmRpZgorCisgICAgU3BpY2VVc2JF
bXVsYXRlZERldmljZUNyZWF0ZSBkZXZfaW5pdFtVU0JfREVWX1RZUEVfTUFYXTsKKyAgICB1aW50
MzJfdCBvd25fZGV2aWNlc19tYXNrOwogfTsKIAogc3RydWN0IF9TcGljZVVzYkJhY2tlbmRDaGFu
bmVsCkBAIC00MDgsNiArNDEzLDcgQEAgU3BpY2VVc2JCYWNrZW5kICpzcGljZV91c2JfYmFja2Vu
ZF9uZXcoR0Vycm9yICoqZXJyb3IpCiAgICAgICAgIGxpYnVzYl9zZXRfb3B0aW9uKGJlLT5saWJ1
c2JfY29udGV4dCwgTElCVVNCX09QVElPTl9VU0VfVVNCREspOwogI2VuZGlmCiAjZW5kaWYKKyAg
ICAgICAgYmUtPm93bl9kZXZpY2VzX21hc2sgPSAzOyAvKiBleGNsdWRlIGFkZHJlc3NlcyAwIGFu
ZCAxICovCiAgICAgfQogICAgIFNQSUNFX0RFQlVHKCIlcyA8PCIsIF9fRlVOQ1RJT05fXyk7CiAg
ICAgcmV0dXJuIGJlOwpAQCAtNTI0LDggKzUzMCwxMiBAQCB2b2lkIHNwaWNlX3VzYl9iYWNrZW5k
X2RldmljZV91bnJlZihTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldikKIHsKICAgICBMT1VEX0RF
QlVHKCIlcyA+PiAlcCglZCkiLCBfX0ZVTkNUSU9OX18sIGRldiwgZGV2LT5yZWZfY291bnQpOwog
ICAgIGlmIChnX2F0b21pY19pbnRfZGVjX2FuZF90ZXN0KCZkZXYtPnJlZl9jb3VudCkpIHsKLSAg
ICAgICAgbGlidXNiX3VucmVmX2RldmljZShkZXYtPmxpYnVzYl9kZXZpY2UpOwotICAgICAgICBM
T1VEX0RFQlVHKCIlcyBmcmVlaW5nICVwIChsaWJ1c2IgJXApIiwgX19GVU5DVElPTl9fLCBkZXYs
IGRldi0+bGlidXNiX2RldmljZSk7CisgICAgICAgIGlmIChkZXYtPmxpYnVzYl9kZXZpY2UpIHsK
KyAgICAgICAgICAgIGxpYnVzYl91bnJlZl9kZXZpY2UoZGV2LT5saWJ1c2JfZGV2aWNlKTsKKyAg
ICAgICAgICAgIExPVURfREVCVUcoIiVzIGZyZWVpbmcgJXAgKGxpYnVzYiAlcCkiLCBfX0ZVTkNU
SU9OX18sIGRldiwgZGV2LT5saWJ1c2JfZGV2aWNlKTsKKyAgICAgICAgfSBlbHNlIGlmIChkZXYt
PmVkZXYpIHsKKyAgICAgICAgICAgIGRldmljZV9vcHMoZGV2LT5lZGV2KS0+ZGVsZXRlKGRldi0+
ZWRldik7CisgICAgICAgIH0KICAgICAgICAgZ19mcmVlKGRldik7CiAgICAgfQogfQpAQCAtODI0
LDQgKzgzNCwxMTggQEAgc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9nZXRfZ3Vlc3RfZmlsdGVy
KFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLAogICAgIH0KIH0KIAorZ2NoYXIgKiBzcGljZV91
c2JfYmFja2VuZF9kZXZpY2VfZGVzY3JpcHRpb24oU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBnY2hh
ciAqZm9ybWF0KQoreworICAgIGlmICghZGV2LT5lZGV2KSB7CisgICAgICAgIHJldHVybiBnX3N0
cmR1cCgiTm90IGF2YWlsYWJsZSBmb3IgbGlidXNiIGRldmljZXMiKTsKKyAgICB9CisgICAgZ2No
YXIgKmRlc2NyaXB0aW9uLCAqZGVzY3JpcHRvciwgKnByb2R1Y3Q7CisgICAgZGVzY3JpcHRvciA9
IGdfc3RyZHVwX3ByaW50ZigiWyUwNHg6JTA0eF0iLCBkZXYtPmRldmljZV9pbmZvLnZpZCwgZGV2
LT5kZXZpY2VfaW5mby5waWQpOworICAgIHByb2R1Y3QgPSBkZXZpY2Vfb3BzKGRldi0+ZWRldikt
PmdldF9wcm9kdWN0X2Rlc2NyaXB0aW9uKGRldi0+ZWRldik7CisgICAgZGVzY3JpcHRpb24gPSBn
X3N0cmR1cF9wcmludGYoZm9ybWF0LCAiIiwgcHJvZHVjdCwgZGVzY3JpcHRvciwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBkZXYtPmRldmljZV9pbmZvLmJ1cywgZGV2LT5kZXZp
Y2VfaW5mby5hZGRyZXNzKTsKKyAgICBnX2ZyZWUoZGVzY3JpcHRvcik7CisgICAgZ19mcmVlKHBy
b2R1Y3QpOworICAgIHJldHVybiBkZXNjcmlwdGlvbjsKK30KKwordm9pZCBzcGljZV91c2JfYmFj
a2VuZF9yZWdpc3Rlcl9kZXZpY2VfdHlwZShTcGljZVVzYkJhY2tlbmQgKmJlLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVc2JFbXVsYXRlZERldmljZVR5cGUg
ZGV2X3R5cGUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNw
aWNlVXNiRW11bGF0ZWREZXZpY2VDcmVhdGUgaW5pdF9wcm9jKQoreworICAgIGlmIChkZXZfdHlw
ZSA+PSBVU0JfREVWX1RZUEVfTUFYKSB7CisgICAgICAgIGdfcmV0dXJuX2lmX3JlYWNoZWQoKTsK
KyAgICB9CisgICAgYmUtPmRldl9pbml0W2Rldl90eXBlXSA9IGluaXRfcHJvYzsKK30KKwordm9p
ZCBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfcmVwb3J0X2NoYW5nZShTcGljZVVzYkJhY2tlbmQg
KmJlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZVVz
YkJhY2tlbmREZXZpY2UgKmRldikKK3sKKyAgICBnY2hhciAqZGVzYzsKKyAgICBnX3JldHVybl9p
Zl9mYWlsKGRldiAmJiBkZXYtPmVkZXYpOworCisgICAgZGVzYyA9IGRldmljZV9vcHMoZGV2LT5l
ZGV2KS0+Z2V0X3Byb2R1Y3RfZGVzY3JpcHRpb24oZGV2LT5lZGV2KTsKKyAgICBTUElDRV9ERUJV
RygiJXM6ICVzIiwgX19GVU5DVElPTl9fLCBkZXNjKTsKKyAgICBnX2ZyZWUoZGVzYyk7Cit9CisK
K3ZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX2VqZWN0KFNwaWNlVXNiQmFja2VuZCAqYmUs
IFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2KQoreworICAgIGdfcmV0dXJuX2lmX2ZhaWwoZGV2
ICYmIGRldi0+ZWRldik7CisKKyAgICBpZiAoYmUtPmhvdHBsdWdfY2FsbGJhY2spIHsKKyAgICAg
ICAgYmUtPmhvdHBsdWdfY2FsbGJhY2soYmUtPmhvdHBsdWdfdXNlcl9kYXRhLCBkZXYsIEZBTFNF
KTsKKyAgICB9CisgICAgc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX3VucmVmKGRldik7Cit9CisK
K2dib29sZWFuIHNwaWNlX3VzYl9iYWNrZW5kX2NyZWF0ZV9kZXZpY2UoU3BpY2VVc2JCYWNrZW5k
ICpiZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXNiRW11bGF0
ZWREZXZpY2VUeXBlIGRldl90eXBlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBVc2JDcmVhdGVEZXZpY2VQYXJhbWV0ZXJzICpwYXJhbSkKK3sKKyAgICBTcGljZVVz
YkVtdWxhdGVkRGV2aWNlICplZGV2ID0gTlVMTDsKKyAgICBTcGljZVVzYkJhY2tlbmREZXZpY2Ug
ICpkZXY7CisgICAgc3RydWN0IGxpYnVzYl9kZXZpY2VfZGVzY3JpcHRvciAqZGVzYzsKKyAgICB1
aW50MTZfdCBkZXZpY2VfZGVzY19zaXplOworICAgIHVpbnQ4X3QgYWRkcmVzcyA9IDA7CisKKyAg
ICBpZiAoZGV2X3R5cGUgPj0gVVNCX0RFVl9UWVBFX01BWCB8fCAhYmUtPmRldl9pbml0W2Rldl90
eXBlXSkgeworICAgICAgICBwYXJhbS0+ZXJyb3IgPSBnX2Vycm9yX25ldyhTUElDRV9DTElFTlRf
RVJST1IsIFNQSUNFX0NMSUVOVF9FUlJPUl9GQUlMRUQsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIF8oImNhbid0IGNyZWF0ZSBkZXZpY2UgLSBub3Qgc3VwcG9ydGVkIikpOwor
ICAgICAgICByZXR1cm4gRkFMU0U7CisgICAgfQorCisgICAgaWYgKGJlLT5vd25fZGV2aWNlc19t
YXNrID09IDB4ZmZmZmZmZmYpIHsKKyAgICAgICAgcGFyYW0tPmVycm9yID0gZ19lcnJvcl9uZXco
U1BJQ0VfQ0xJRU5UX0VSUk9SLCBTUElDRV9DTElFTlRfRVJST1JfRkFJTEVELAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBfKCJjYW4ndCBjcmVhdGUgZGV2aWNlIC0gbGltaXQg
cmVhY2hlZCIpKTsKKyAgICAgICAgcmV0dXJuIEZBTFNFOworICAgIH0KKyAgICBmb3IgKGFkZHJl
c3MgPSAwOyBhZGRyZXNzIDwgMzI7ICsrYWRkcmVzcykgeworICAgICAgICBpZiAofmJlLT5vd25f
ZGV2aWNlc19tYXNrICYgKDEgPDwgYWRkcmVzcykpIHsKKyAgICAgICAgICAgIGJyZWFrOworICAg
ICAgICB9CisgICAgfQorCisgICAgZGV2ID0gZ19uZXcwKFNwaWNlVXNiQmFja2VuZERldmljZSwg
MSk7CisKKyAgICBwYXJhbS0+YWRkcmVzcyA9IGFkZHJlc3M7CisgICAgaWYgKGJlLT5kZXZfaW5p
dFtkZXZfdHlwZV0oYmUsIGRldiwgcGFyYW0sICZlZGV2KSkgeworICAgICAgICBnX2ZyZWUoZGV2
KTsKKyAgICAgICAgcmV0dXJuIEZBTFNFOworICAgIH0KKworICAgIGlmICghZGV2aWNlX29wcyhl
ZGV2KS0+Z2V0X2Rlc2NyaXB0b3IoZWRldiwgTElCVVNCX0RUX0RFVklDRSwgMCwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh2b2lkICoqKSZkZXNjLCAmZGV2aWNl
X2Rlc2Nfc2l6ZSkKKyAgICAgICAgfHwgZGV2aWNlX2Rlc2Nfc2l6ZSAhPSBzaXplb2YoKmRlc2Mp
KSB7CisKKyAgICAgICAgZGV2aWNlX29wcyhlZGV2KS0+ZGVsZXRlKGVkZXYpOworICAgICAgICBn
X2ZyZWUoZGV2KTsKKyAgICAgICAgcGFyYW0tPmVycm9yID0gZ19lcnJvcl9uZXcoU1BJQ0VfQ0xJ
RU5UX0VSUk9SLCBTUElDRV9DTElFTlRfRVJST1JfRkFJTEVELAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBfKCJjYW4ndCBjcmVhdGUgZGV2aWNlIC0gaW50ZXJuYWwgZXJyb3Ii
KSk7CisgICAgICAgIHJldHVybiBGQUxTRTsKKyAgICB9CisKKyAgICBiZS0+b3duX2RldmljZXNf
bWFzayB8PSAxIDw8IGFkZHJlc3M7CisKKyAgICBkZXYtPmRldmljZV9pbmZvLmJ1cyA9IEJVU19O
VU1CRVJfRk9SX0VNVUxBVEVEX1VTQjsKKyAgICBkZXYtPmRldmljZV9pbmZvLmFkZHJlc3MgPSBh
ZGRyZXNzOworICAgIGRldi0+ZGV2aWNlX2luZm8udmlkID0gZGVzYy0+aWRWZW5kb3I7CisgICAg
ZGV2LT5kZXZpY2VfaW5mby5waWQgPSBkZXNjLT5pZFByb2R1Y3Q7CisgICAgZGV2LT5kZXZpY2Vf
aW5mby5iY2RVU0IgPSBkZXNjLT5iY2RVU0I7CisgICAgZGV2LT5kZXZpY2VfaW5mby5jbGFzcyA9
IGRlc2MtPmJEZXZpY2VDbGFzczsKKyAgICBkZXYtPmRldmljZV9pbmZvLnN1YmNsYXNzID0gZGVz
Yy0+YkRldmljZVN1YkNsYXNzOworICAgIGRldi0+ZGV2aWNlX2luZm8ucHJvdG9jb2wgPSBkZXNj
LT5iRGV2aWNlUHJvdG9jb2w7CisgICAgZGV2LT5kZXZpY2VfaW5mby5kZXZpY2VfdHlwZSA9IGRl
dl90eXBlOworICAgIGRldi0+cmVmX2NvdW50ID0gMTsKKyAgICBkZXYtPmVkZXYgPSBlZGV2Owor
CisgICAgaWYgKGJlLT5ob3RwbHVnX2NhbGxiYWNrKSB7CisgICAgICAgIGJlLT5ob3RwbHVnX2Nh
bGxiYWNrKGJlLT5ob3RwbHVnX3VzZXJfZGF0YSwgZGV2LCBUUlVFKTsKKyAgICB9CisKKyAgICBy
ZXR1cm4gVFJVRTsKK30KKwogI2VuZGlmIC8qIFVTQl9SRURJUiAqLwpkaWZmIC0tZ2l0IGEvc3Jj
L3VzYi1iYWNrZW5kLmggYi9zcmMvdXNiLWJhY2tlbmQuaAppbmRleCA2OWE0OTBiNS4uOGEwNGVk
MGQgMTAwNjQ0Ci0tLSBhL3NyYy91c2ItYmFja2VuZC5oCisrKyBiL3NyYy91c2ItYmFja2VuZC5o
CkBAIC0zMSwxNSArMzEsMjQgQEAgdHlwZWRlZiBzdHJ1Y3QgX1NwaWNlVXNiQmFja2VuZCBTcGlj
ZVVzYkJhY2tlbmQ7CiB0eXBlZGVmIHN0cnVjdCBfU3BpY2VVc2JCYWNrZW5kRGV2aWNlIFNwaWNl
VXNiQmFja2VuZERldmljZTsKIHR5cGVkZWYgc3RydWN0IF9TcGljZVVzYkJhY2tlbmRDaGFubmVs
IFNwaWNlVXNiQmFja2VuZENoYW5uZWw7CiAKK3R5cGVkZWYgZW51bQoreworICAgIFVTQl9ERVZf
VFlQRV9OT05FLAorICAgIFVTQl9ERVZfVFlQRV9DRCwKKyAgICBVU0JfREVWX1RZUEVfTUFYCit9
IFVzYkVtdWxhdGVkRGV2aWNlVHlwZTsKKwogdHlwZWRlZiBzdHJ1Y3QgVXNiRGV2aWNlSW5mb3Jt
YXRpb24KIHsKICAgICB1aW50MTZfdCBidXM7CiAgICAgdWludDE2X3QgYWRkcmVzczsKICAgICB1
aW50MTZfdCB2aWQ7CiAgICAgdWludDE2X3QgcGlkOworICAgIHVpbnQxNl90IGJjZFVTQjsKICAg
ICB1aW50OF90IGNsYXNzOwogICAgIHVpbnQ4X3Qgc3ViY2xhc3M7CiAgICAgdWludDhfdCBwcm90
b2NvbDsKKyAgICB1aW50OF90IGRldmljZV90eXBlOyAvKiBVc2JFbXVsYXRlZERldmljZVR5cGUg
Ki8KIH0gVXNiRGV2aWNlSW5mb3JtYXRpb247CiAKIHR5cGVkZWYgdm9pZCgqdXNiX2hvdF9wbHVn
X2NhbGxiYWNrKSh2b2lkICp1c2VyX2RhdGEsIFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2LCBn
Ym9vbGVhbiBhZGRlZCk7CkBAIC03MSw3ICs4MCw2IEBAIGdib29sZWFuIHNwaWNlX3VzYl9iYWNr
ZW5kX2RldmljZV9pc29jaChTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldik7CiAvKiByZXR1cm5z
IDAgaWYgdGhlIGRldmljZSBwYXNzZXMgdGhlIGZpbHRlciAqLwogaW50IHNwaWNlX3VzYl9iYWNr
ZW5kX2RldmljZV9jaGVja19maWx0ZXIoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJ1Y3QgdXNicmVk
aXJmaWx0ZXJfcnVsZSAqcnVsZXMsIGludCBjb3VudCk7Ci0KIC8qIFNwaWNlIFVTQiBiYWNrZW5k
IGNoYW5uZWwgQVBJICovCiBTcGljZVVzYkJhY2tlbmRDaGFubmVsICpzcGljZV91c2JfYmFja2Vu
ZF9jaGFubmVsX25ldyhTcGljZVVzYkJhY2tlbmQgKmNvbnRleHQsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICAgICAgICAgICAgKnVz
ZXJfZGF0YSk7CkBAIC04OSw2ICs5NywzMiBAQCB2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5u
ZWxfZ2V0X2d1ZXN0X2ZpbHRlcihTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCAqY291bnQpOwogdm9p
ZCBzcGljZV91c2JfYmFja2VuZF9yZXR1cm5fd3JpdGVfZGF0YShTcGljZVVzYkJhY2tlbmRDaGFu
bmVsICpjaCwgdm9pZCAqZGF0YSk7CiAKKyNkZWZpbmUgQlVTX05VTUJFUl9GT1JfRU1VTEFURURf
VVNCICAgICAgICAgMjU1CisKK3R5cGVkZWYgc3RydWN0IFVzYkNyZWF0ZURldmljZVBhcmFtZXRl
cnMKK3sKKyAgICBHRXJyb3IgKmVycm9yOworICAgIHVpbnQzMl90ICAgIGFkZHJlc3M7CisgICAg
dWludDMyX3QgICAgcmVzZXJ2ZWQ7CisgICAgdW5pb24KKyAgICB7CisgICAgICAgIHN0cnVjdAor
ICAgICAgICB7CisgICAgICAgICAgICBjb25zdCBjaGFyICpmaWxlbmFtZTsKKyAgICAgICAgICAg
IHVpbnQzMl90ICAgZGVsZXRlX29uX2VqZWN0ICA6IDE7CisgICAgICAgIH0gY3JlYXRlX2NkOwor
ICAgIH0gZGV2aWNlX3BhcmFtOworCit9IFVzYkNyZWF0ZURldmljZVBhcmFtZXRlcnM7CisKKy8q
IEFQSSByZWxhdGVkIHRvIGVtdWxhdGVkIGRldmljZXMgKi8KK2dib29sZWFuIHNwaWNlX3VzYl9i
YWNrZW5kX2NyZWF0ZV9kZXZpY2UoU3BpY2VVc2JCYWNrZW5kICpiZSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgVXNiRW11bGF0ZWREZXZpY2VUeXBlIGRldl90eXBl
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVc2JDcmVhdGVEZXZp
Y2VQYXJhbWV0ZXJzICpwYXJhbSk7CitnY2hhciAqc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX2Rl
c2NyaXB0aW9uKFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2LCBjb25zdCBnY2hhciAqZm9ybWF0
KTsKK3ZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX2VqZWN0KFNwaWNlVXNiQmFja2VuZCAq
YmUsIFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2aWNlKTsKK3ZvaWQgc3BpY2VfdXNiX2JhY2tl
bmRfZGV2aWNlX3JlcG9ydF9jaGFuZ2UoU3BpY2VVc2JCYWNrZW5kICpiZSwgU3BpY2VVc2JCYWNr
ZW5kRGV2aWNlICpkZXZpY2UpOworCiBHX0VORF9ERUNMUwogCiAjZW5kaWYKZGlmZiAtLWdpdCBh
L3NyYy91c2ItZW11bGF0aW9uLmggYi9zcmMvdXNiLWVtdWxhdGlvbi5oCm5ldyBmaWxlIG1vZGUg
MTAwNjQ0CmluZGV4IDAwMDAwMDAwLi40NDczMzYxNQotLS0gL2Rldi9udWxsCisrKyBiL3NyYy91
c2ItZW11bGF0aW9uLmgKQEAgLTAsMCArMSw4OCBAQAorLyogLSotIE1vZGU6IEM7IGMtYmFzaWMt
b2Zmc2V0OiA0OyBpbmRlbnQtdGFicy1tb2RlOiBuaWwgLSotICovCisvKgorICAgIENvcHlyaWdo
dCAoQykgMjAxOSBSZWQgSGF0LCBJbmMuCisKKyAgICBSZWQgSGF0IEF1dGhvcnM6CisgICAgWXVy
aSBCZW5kaXRvdmljaDx5YmVuZGl0b0ByZWRoYXQuY29tPgorCisgICAgVGhpcyBsaWJyYXJ5IGlz
IGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vcgorICAgIG1vZGlm
eSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKKyAg
ICBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBl
aXRoZXIKKyAgICB2ZXJzaW9uIDIuMSBvZiB0aGUgTGljZW5zZSwgb3IgKGF0IHlvdXIgb3B0aW9u
KSBhbnkgbGF0ZXIgdmVyc2lvbi4KKworICAgIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBp
biB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAorICAgIGJ1dCBXSVRIT1VUIEFOWSBX
QVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCisgICAgTUVSQ0hB
TlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBH
TlUKKyAgICBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgor
CisgICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIExlc3NlciBH
ZW5lcmFsIFB1YmxpYworICAgIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5v
dCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KKyovCisKKyNpZm5kZWYgX19T
UElDRV9VU0JfRU1VTEFUSU9OX0hfXworI2RlZmluZSBfX1NQSUNFX1VTQl9FTVVMQVRJT05fSF9f
CisKKyNpbmNsdWRlICJ1c2JyZWRpcnBhcnNlci5oIgorI2luY2x1ZGUgInVzYi1iYWNrZW5kLmgi
CisKK3R5cGVkZWYgc3RydWN0IF9TcGljZVVzYkVtdWxhdGVkRGV2aWNlIFNwaWNlVXNiRW11bGF0
ZWREZXZpY2U7Cit0eXBlZGVmIGludCAoKlNwaWNlVXNiRW11bGF0ZWREZXZpY2VDcmVhdGUpKFNw
aWNlVXNiQmFja2VuZCAqYmUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqcGFyZW50LAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBVc2JDcmVhdGVEZXZpY2VQYXJhbWV0ZXJzICpwYXJh
bSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VVc2JF
bXVsYXRlZERldmljZSAqKmRldmljZSk7CisKKy8qCisgICAgZnVuY3Rpb24gdGFibGUgZm9yIGVt
dWxhdGVkIFVTQiBkZXZpY2UKKyAgICBtdXN0IGJlIGZpcnN0IG1lbWJlciBvZiBkZXZpY2Ugc3Ry
dWN0dXJlCisgICAgYWxsIGZ1bmN0aW9ucyBhcmUgbWFuZGF0b3J5IGZvciBpbXBsZW1lbnRhdGlv
bgorKi8KK3R5cGVkZWYgc3RydWN0IFVzYkRldmljZU9wcworeworICAgIGdib29sZWFuICgqZ2V0
X2Rlc2NyaXB0b3IpKFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmRldmljZSwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB1aW50OF90IHR5cGUsIHVpbnQ4X3QgaW5kZXgsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqKmJ1ZmZlciwgdWludDE2X3QgKnNpemUpOwor
ICAgIGdjaGFyICogKCpnZXRfcHJvZHVjdF9kZXNjcmlwdGlvbikoU3BpY2VVc2JFbXVsYXRlZERl
dmljZSAqZGV2aWNlKTsKKyAgICB2b2lkICgqYXR0YWNoKShTcGljZVVzYkVtdWxhdGVkRGV2aWNl
ICpkZXZpY2UsIHN0cnVjdCB1c2JyZWRpcnBhcnNlciAqcGFyc2VyKTsKKyAgICB2b2lkICgqcmVz
ZXQpKFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmRldmljZSk7CisgICAgLyoKKyAgICAgICAgcHJv
Y2Vzc2luZyBpcyBzeW5jaHJvbm91cywgZGVmYXVsdCA9IHN0YWxsOgorICAgICAgICAtIHJldHVy
biBzdWNjZXNzIHdpdGhvdXQgZGF0YTogc2V0IHN0YXR1cyB0byAwCisgICAgICAgIC0gcmV0dXJu
IGVycm9yIC0gc2V0IHN0YXR1cyB0byBlcnJvcgorICAgICAgICAtIHJldHVybiBzdWNjZXNzIHdp
dGggZGF0YSAtIHNldCBzdGF0dXMgdG8gMCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHNldCBidWZmZXIgdG8gc29tZSBidWZmZXIKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHNldCBsZW5ndGggdG8gb3V0IGxlbgorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdHJ1bmNhdGlvbiBpcyBhdXRvbWF0aWMKKyAgICAqLworICAgIHZvaWQg
KCpjb250cm9sX3JlcXVlc3QpKFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmRldmljZSwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB1aW50OF90ICpkYXRhLCBpbnQgZGF0YV9sZW4sCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHVzYl9yZWRpcl9jb250cm9sX3BhY2tldF9o
ZWFkZXIgKmgsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqKmJ1ZmZlcik7Cisg
ICAgLyoKKyAgICAgICAgcHJvY2Vzc2luZyBpcyBzeW5jaHJvbm91czoKKyAgICAgICAgLSBzZXQg
aC0+c3RhdHVzIHRvIHJlc3VsdGluZyBzdGF0dXMsIGRlZmF1bHQgPSBzdGFsbAorICAgICovCisg
ICAgdm9pZCAoKmJ1bGtfb3V0X3JlcXVlc3QpKFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmRldmlj
ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDhfdCBlcCwgdWludDhfdCAqZGF0
YSwgaW50IGRhdGFfbGVuLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50OF90ICpz
dGF0dXMpOworICAgIC8qCisgICAgICAgIGlmIHJldHVybnMgdHJ1ZSwgcHJvY2Vzc2luZyBpcyBh
c3luY2hyb25vdXMKKyAgICAgICAgb3RoZXJ3aXNlIGhlYWRlciBjb250YWlucyBlcnJvciBzdGF0
dXMKKyAgICAqLworICAgIGdib29sZWFuICgqYnVsa19pbl9yZXF1ZXN0KShTcGljZVVzYkVtdWxh
dGVkRGV2aWNlICpkZXZpY2UsIHVpbnQ2NF90IGlkLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHN0cnVjdCB1c2JfcmVkaXJfYnVsa19wYWNrZXRfaGVhZGVyICpidWxrX2hlYWRlcik7Cisg
ICAgdm9pZCAoKmNhbmNlbF9yZXF1ZXN0KShTcGljZVVzYkVtdWxhdGVkRGV2aWNlICpkZXZpY2Us
IHVpbnQ2NF90IGlkKTsKKyAgICB2b2lkICgqZGV0YWNoKShTcGljZVVzYkVtdWxhdGVkRGV2aWNl
ICpkZXZpY2UpOworICAgIHZvaWQgKCpkZWxldGUpKFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmRl
dmljZSk7Cit9IFVzYkRldmljZU9wczsKKworc3RhdGljIGlubGluZSBjb25zdCBVc2JEZXZpY2VP
cHMgKmRldmljZV9vcHMoU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZGV2KSB7CisgICAgcmV0dXJu
IChjb25zdCBVc2JEZXZpY2VPcHMgKilkZXY7Cit9CisKK3ZvaWQgc3BpY2VfdXNiX2JhY2tlbmRf
cmVnaXN0ZXJfZGV2aWNlX3R5cGUoU3BpY2VVc2JCYWNrZW5kICpiZSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXNiRW11bGF0ZWREZXZpY2VUeXBlIGRldl90
eXBlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZVVz
YkVtdWxhdGVkRGV2aWNlQ3JlYXRlIGluaXRfcHJvYyk7CisvKiBzdXBwb3J0ZWQgZGV2aWNlIHR5
cGVzICovCit2b2lkIHNwaWNlX3VzYl9kZXZpY2VfcmVnaXN0ZXJfY2QoU3BpY2VVc2JCYWNrZW5k
ICpiZSk7CisKKyNlbmRpZgotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpTcGljZS1kZXZlbCBtYWlsaW5nIGxpc3QKU3BpY2UtZGV2ZWxA
bGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxt
YW4vbGlzdGluZm8vc3BpY2UtZGV2ZWw=
