Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 75F1ECDF72
	for <lists+spice-devel@lfdr.de>; Mon,  7 Oct 2019 12:39:17 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F2F3D6E527;
	Mon,  7 Oct 2019 10:39:14 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5FADD6E526
 for <spice-devel@lists.freedesktop.org>; Mon,  7 Oct 2019 10:39:13 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
 [10.5.11.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 0A92D315C03D
 for <spice-devel@lists.freedesktop.org>; Mon,  7 Oct 2019 10:39:13 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.7])
 by smtp.corp.redhat.com (Postfix) with ESMTP id D3B0C5D6D0;
 Mon,  7 Oct 2019 10:39:11 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Mon,  7 Oct 2019 11:38:59 +0100
Message-Id: <20191007103906.30517-2-fziglio@redhat.com>
In-Reply-To: <20191007103906.30517-1-fziglio@redhat.com>
References: <20191007103906.30517-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.41]); Mon, 07 Oct 2019 10:39:13 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-server 1/8] test-stream-device: Factor
 out VMC emulation
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

QWxsb3dzIHRvIHJldXNlIGNvZGUgZm9yIGVtdWxhdGluZyBhIGNoYXJhY3RlciBkZXZpY2UuCkl0
IHdpbGwgYmUgdXNlZCBmb3IgU21hcmRjYXJkIHRlc3QuCgpTaWduZWQtb2ZmLWJ5OiBGcmVkaWFu
byBaaWdsaW8gPGZ6aWdsaW9AcmVkaGF0LmNvbT4KLS0tCiBzZXJ2ZXIvdGVzdHMvTWFrZWZpbGUu
YW0gICAgICAgICAgfCAgIDIgKwogc2VydmVyL3Rlc3RzL21lc29uLmJ1aWxkICAgICAgICAgIHwg
ICAyICsKIHNlcnZlci90ZXN0cy90ZXN0LXN0cmVhbS1kZXZpY2UuYyB8IDIyNCArKysrKysrKyst
LS0tLS0tLS0tLS0tLS0tLS0tLS0KIHNlcnZlci90ZXN0cy92bWMtZW11LmMgICAgICAgICAgICB8
IDEyMSArKysrKysrKysrKysrKysrCiBzZXJ2ZXIvdGVzdHMvdm1jLWVtdS5oICAgICAgICAgICAg
fCAgNDggKysrKysrKwogNSBmaWxlcyBjaGFuZ2VkLCAyMzYgaW5zZXJ0aW9ucygrKSwgMTYxIGRl
bGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IHNlcnZlci90ZXN0cy92bWMtZW11LmMKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCBzZXJ2ZXIvdGVzdHMvdm1jLWVtdS5oCgpkaWZmIC0tZ2l0IGEvc2Vy
dmVyL3Rlc3RzL01ha2VmaWxlLmFtIGIvc2VydmVyL3Rlc3RzL01ha2VmaWxlLmFtCmluZGV4IDFl
NjI1NTdhLi45ODI1MDg1MSAxMDA2NDQKLS0tIGEvc2VydmVyL3Rlc3RzL01ha2VmaWxlLmFtCisr
KyBiL3NlcnZlci90ZXN0cy9NYWtlZmlsZS5hbQpAQCAtMzcsNiArMzcsOCBAQCBsaWJ0ZXN0X2Ff
U09VUkNFUyA9CQkJCVwKIAl0ZXN0LWdsaWItY29tcGF0LmgJCQlcCiAJd2luLWFsYXJtLmMJCQkJ
XAogCXdpbi1hbGFybS5oCQkJCVwKKwl2bWMtZW11LmMJCQkJXAorCXZtYy1lbXUuaAkJCQlcCiAJ
JChOVUxMKQogCiBMREFERCA9CQkJCQkJCQlcCmRpZmYgLS1naXQgYS9zZXJ2ZXIvdGVzdHMvbWVz
b24uYnVpbGQgYi9zZXJ2ZXIvdGVzdHMvbWVzb24uYnVpbGQKaW5kZXggYzkzNzdmMWUuLjMzNDcy
ZjE0IDEwMDY0NAotLS0gYS9zZXJ2ZXIvdGVzdHMvbWVzb24uYnVpbGQKKysrIGIvc2VydmVyL3Rl
c3RzL21lc29uLmJ1aWxkCkBAIC0xMyw2ICsxMyw4IEBAIHRlc3RfbGliX3NvdXJjZXMgPSBbCiAg
ICd0ZXN0LWdsaWItY29tcGF0LmgnLAogICAnd2luLWFsYXJtLmMnLAogICAnd2luLWFsYXJtLmgn
LAorICAndm1jLWVtdS5jJywKKyAgJ3ZtYy1lbXUuaCcsCiBdCiAKIHRlc3RfbGlicyA9IFtdCmRp
ZmYgLS1naXQgYS9zZXJ2ZXIvdGVzdHMvdGVzdC1zdHJlYW0tZGV2aWNlLmMgYi9zZXJ2ZXIvdGVz
dHMvdGVzdC1zdHJlYW0tZGV2aWNlLmMKaW5kZXggZjU2OThjN2QuLjYxM2NhZWQzIDEwMDY0NAot
LS0gYS9zZXJ2ZXIvdGVzdHMvdGVzdC1zdHJlYW0tZGV2aWNlLmMKKysrIGIvc2VydmVyL3Rlc3Rz
L3Rlc3Qtc3RyZWFtLWRldmljZS5jCkBAIC0zNCw4NCArMzQsOSBAQAogI2luY2x1ZGUgInN0cmVh
bS1jaGFubmVsLmgiCiAjaW5jbHVkZSAicmVkcy5oIgogI2luY2x1ZGUgIndpbi1hbGFybS5oIgor
I2luY2x1ZGUgInZtYy1lbXUuaCIKIAotc3RhdGljIFNwaWNlQ2hhckRldmljZUluc3RhbmNlIHZt
Y19pbnN0YW5jZTsKLQotLy8gZGV2aWNlIGJ1ZmZlciB0byByZWFkIGZyb20KLXN0YXRpYyB1aW50
OF90IG1lc3NhZ2VbMjA0OF07Ci0vLyBwb3NpdGlvbiB0byByZWFkIGZyb20KLXN0YXRpYyB1bnNp
Z25lZCBwb3M7Ci0vLyBhcnJheSBvZiBsaW1pdHMgd2hlbiB0aGUgcmVhZCBzaG91bGQgcmV0dXJu
Ci0vLyB0aGUgYXJyYXkgaXMgZGVmaW5lZCBhcyBbbWVzc2FnZV9zaXplc19jdXJyLCBtZXNzYWdl
X3NpemVzX2VuZCkKLS8vIHRoZW4gdGhlIHNpemUgaXMgcmVhY2ggd2UgbW92ZSBvbiBuZXh0IG9u
ZSB0aWxsIGV4YXVzdGVkCi1zdGF0aWMgdW5zaWduZWQgbWVzc2FnZV9zaXplc1sxNl07Ci1zdGF0
aWMgdW5zaWduZWQgKm1lc3NhZ2Vfc2l6ZXNfZW5kLCAqbWVzc2FnZV9zaXplc19jdXJyOwotc3Rh
dGljIGJvb2wgZGV2aWNlX2VuYWJsZWQgPSBmYWxzZTsKLQotc3RhdGljIHVuc2lnbmVkIHZtY193
cml0ZV9wb3M7Ci1zdGF0aWMgdWludDhfdCB2bWNfd3JpdGVfYnVmWzIwNDhdOwotCi0vLyBoYW5k
bGUgd3JpdGVzIHRvIHRoZSBkZXZpY2UKLXN0YXRpYyBpbnQgdm1jX3dyaXRlKFNQSUNFX0dOVUNf
VU5VU0VEIFNwaWNlQ2hhckRldmljZUluc3RhbmNlICpzaW4sCi0gICAgICAgICAgICAgICAgICAg
ICBTUElDRV9HTlVDX1VOVVNFRCBjb25zdCB1aW50OF90ICpidWYsCi0gICAgICAgICAgICAgICAg
ICAgICBpbnQgbGVuKQotewotICAgIC8vIGp1c3QgY29weSBpbnRvIHRoZSBidWZmZXIKLSAgICB1
bnNpZ25lZCBjb3B5ID0gTUlOKHNpemVvZih2bWNfd3JpdGVfYnVmKSAtIHZtY193cml0ZV9wb3Ms
IGxlbik7Ci0gICAgbWVtY3B5KHZtY193cml0ZV9idWYrdm1jX3dyaXRlX3BvcywgYnVmLCBjb3B5
KTsKLSAgICB2bWNfd3JpdGVfcG9zICs9IGNvcHk7Ci0gICAgcmV0dXJuIGxlbjsKLX0KLQotc3Rh
dGljIGludCB2bWNfcmVhZChTUElDRV9HTlVDX1VOVVNFRCBTcGljZUNoYXJEZXZpY2VJbnN0YW5j
ZSAqc2luLAotICAgICAgICAgICAgICAgICAgICB1aW50OF90ICpidWYsCi0gICAgICAgICAgICAg
ICAgICAgIGludCBsZW4pCi17Ci0gICAgaW50IHJldDsKLQotICAgIGlmIChwb3MgPj0gKm1lc3Nh
Z2Vfc2l6ZXNfY3VyciAmJiBtZXNzYWdlX3NpemVzX2N1cnIgPCBtZXNzYWdlX3NpemVzX2VuZCkg
ewotICAgICAgICArK21lc3NhZ2Vfc2l6ZXNfY3VycjsKLSAgICB9Ci0gICAgaWYgKG1lc3NhZ2Vf
c2l6ZXNfY3VyciA+PSBtZXNzYWdlX3NpemVzX2VuZCB8fCBwb3MgPj0gKm1lc3NhZ2Vfc2l6ZXNf
Y3VycikgewotICAgICAgICByZXR1cm4gMDsKLSAgICB9Ci0gICAgcmV0ID0gTUlOKCptZXNzYWdl
X3NpemVzX2N1cnIgLSBwb3MsIGxlbik7Ci0gICAgbWVtY3B5KGJ1ZiwgJm1lc3NhZ2VbcG9zXSwg
cmV0KTsKLSAgICBwb3MgKz0gcmV0OwotICAgIC8vIGtpY2sgb2ZmIG5leHQgbWVzc2FnZSByZWFk
Ci0gICAgLy8gY3VycmVudGx5IFFlbXUga2lja3MgdGhlIGRldmljZSBzbyB3ZSBuZWVkIHRvIGRv
IGl0IG1hbnVhbGx5Ci0gICAgLy8gaGVyZS4gSWYgbm90IGFsbCBkYXRhIGFyZSByZWFkLCB0aGUg
ZGV2aWNlIGdvZXMgaW50byBibG9ja2luZwotICAgIC8vIHN0YXRlIGFuZCB3ZSBnZXQgdGhlIHdh
a2Ugb25seSB3aGVuIHdlIHJlYWQgZnJvbSB0aGUgZGV2aWNlCi0gICAgLy8gYWdhaW4KLSAgICBp
ZiAocG9zID49ICptZXNzYWdlX3NpemVzX2N1cnIpIHsKLSAgICAgICAgc3BpY2Vfc2VydmVyX2No
YXJfZGV2aWNlX3dha2V1cCgmdm1jX2luc3RhbmNlKTsKLSAgICB9Ci0gICAgcmV0dXJuIHJldDsK
LX0KLQotc3RhdGljIHZvaWQgdm1jX3N0YXRlKFNQSUNFX0dOVUNfVU5VU0VEIFNwaWNlQ2hhckRl
dmljZUluc3RhbmNlICpzaW4sCi0gICAgICAgICAgICAgICAgICAgICAgU1BJQ0VfR05VQ19VTlVT
RUQgaW50IGNvbm5lY3RlZCkKLXsKLSAgICBkZXZpY2VfZW5hYmxlZCA9ICEhY29ubmVjdGVkOwot
fQotCi1zdGF0aWMgU3BpY2VDaGFyRGV2aWNlSW50ZXJmYWNlIHZtY19pbnRlcmZhY2UgPSB7Ci0g
ICAgLmJhc2UgPSB7Ci0gICAgICAgIC50eXBlICAgICAgICAgID0gU1BJQ0VfSU5URVJGQUNFX0NI
QVJfREVWSUNFLAotICAgICAgICAuZGVzY3JpcHRpb24gICA9ICJ0ZXN0IHNwaWNlIHZpcnR1YWwg
Y2hhbm5lbCBjaGFyIGRldmljZSIsCi0gICAgICAgIC5tYWpvcl92ZXJzaW9uID0gU1BJQ0VfSU5U
RVJGQUNFX0NIQVJfREVWSUNFX01BSk9SLAotICAgICAgICAubWlub3JfdmVyc2lvbiA9IFNQSUNF
X0lOVEVSRkFDRV9DSEFSX0RFVklDRV9NSU5PUiwKLSAgICB9LAotICAgIC5zdGF0ZSAgICAgICAg
ICAgICAgPSB2bWNfc3RhdGUsCi0gICAgLndyaXRlICAgICAgICAgICAgICA9IHZtY193cml0ZSwK
LSAgICAucmVhZCAgICAgICAgICAgICAgID0gdm1jX3JlYWQsCi19OwotCi0vLyB0aGlzIHNwZWNp
ZmljYWxseSBjcmVhdGVzIGEgc3RyZWFtIGRldmljZQotc3RhdGljIFNwaWNlQ2hhckRldmljZUlu
c3RhbmNlIHZtY19pbnN0YW5jZSA9IHsKLSAgICAuc3VidHlwZSA9ICJwb3J0IiwKLSAgICAucG9y
dG5hbWUgPSAib3JnLnNwaWNlLXNwYWNlLnN0cmVhbS4wIiwKLX07CitzdGF0aWMgVm1jRW11ICp2
bWM7CiAKIHN0YXRpYyB1aW50OF90ICphZGRfc3RyZWFtX2hkcih1aW50OF90ICpwLCBTdHJlYW1N
c2dUeXBlIHR5cGUsIHVpbnQzMl90IHNpemUpCiB7CkBAIC0xNDUsMTggKzcwLDE4IEBAIGRpc2Nh
cmRfc2VydmVyX2NhcGFiaWxpdGllcyh2b2lkKQogewogICAgIFN0cmVhbURldkhlYWRlciBoZHI7
CiAKLSAgICBpZiAodm1jX3dyaXRlX3BvcyA9PSAwKSB7CisgICAgaWYgKHZtYy0+d3JpdGVfcG9z
ID09IDApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KLSAgICBnX2Fzc2VydCh2bWNfd3JpdGVf
cG9zID49IHNpemVvZihoZHIpKTsKKyAgICBnX2Fzc2VydCh2bWMtPndyaXRlX3BvcyA+PSBzaXpl
b2YoaGRyKSk7CiAKLSAgICBtZW1jcHkoJmhkciwgdm1jX3dyaXRlX2J1Ziwgc2l6ZW9mKGhkcikp
OworICAgIG1lbWNweSgmaGRyLCB2bWMtPndyaXRlX2J1Ziwgc2l6ZW9mKGhkcikpOwogICAgIGhk
ci50eXBlID0gR1VJTlQxNl9GUk9NX0xFKGhkci50eXBlKTsKICAgICBoZHIuc2l6ZSA9IEdVSU5U
MzJfRlJPTV9MRShoZHIuc2l6ZSk7CiAgICAgaWYgKGhkci50eXBlID09IFNUUkVBTV9UWVBFX0NB
UEFCSUxJVElFUykgewotICAgICAgICBnX2Fzc2VydF9jbXBpbnQoaGRyLnNpemUsIDw9LCB2bWNf
d3JpdGVfcG9zIC0gc2l6ZW9mKGhkcikpOwotICAgICAgICB2bWNfd3JpdGVfcG9zIC09IGhkci5z
aXplICsgc2l6ZW9mKGhkcik7Ci0gICAgICAgIG1lbW1vdmUodm1jX3dyaXRlX2J1Ziwgdm1jX3dy
aXRlX2J1ZiArIGhkci5zaXplICsgc2l6ZW9mKGhkciksIHZtY193cml0ZV9wb3MpOworICAgICAg
ICBnX2Fzc2VydF9jbXBpbnQoaGRyLnNpemUsIDw9LCB2bWMtPndyaXRlX3BvcyAtIHNpemVvZiho
ZHIpKTsKKyAgICAgICAgdm1jLT53cml0ZV9wb3MgLT0gaGRyLnNpemUgKyBzaXplb2YoaGRyKTsK
KyAgICAgICAgbWVtbW92ZSh2bWMtPndyaXRlX2J1Ziwgdm1jLT53cml0ZV9idWYgKyBoZHIuc2l6
ZSArIHNpemVvZihoZHIpLCB2bWMtPndyaXRlX3Bvcyk7CiAgICAgfQogfQogCkBAIC0xNjgsMTIg
KzkzLDEyIEBAIGNoZWNrX3ZtY19lcnJvcl9tZXNzYWdlKHZvaWQpCiAKICAgICBkaXNjYXJkX3Nl
cnZlcl9jYXBhYmlsaXRpZXMoKTsKIAotICAgIGdfYXNzZXJ0X2NtcGludCh2bWNfd3JpdGVfcG9z
LCA+PSAsc2l6ZW9mKGhkcikpOworICAgIGdfYXNzZXJ0X2NtcGludCh2bWMtPndyaXRlX3Bvcywg
Pj0gLHNpemVvZihoZHIpKTsKIAotICAgIG1lbWNweSgmaGRyLCB2bWNfd3JpdGVfYnVmLCBzaXpl
b2YoaGRyKSk7CisgICAgbWVtY3B5KCZoZHIsIHZtYy0+d3JpdGVfYnVmLCBzaXplb2YoaGRyKSk7
CiAgICAgZ19hc3NlcnRfY21waW50KGhkci5wcm90b2NvbF92ZXJzaW9uLCA9PSwgU1RSRUFNX0RF
VklDRV9QUk9UT0NPTCk7CiAgICAgZ19hc3NlcnRfY21waW50KEdVSU5UMTZfRlJPTV9MRShoZHIu
dHlwZSksID09LCBTVFJFQU1fVFlQRV9OT1RJRllfRVJST1IpOwotICAgIGdfYXNzZXJ0X2NtcGlu
dChHVUlOVDMyX0ZST01fTEUoaGRyLnNpemUpLCA8PSwgdm1jX3dyaXRlX3BvcyAtIHNpemVvZiho
ZHIpKTsKKyAgICBnX2Fzc2VydF9jbXBpbnQoR1VJTlQzMl9GUk9NX0xFKGhkci5zaXplKSwgPD0s
IHZtYy0+d3JpdGVfcG9zIC0gc2l6ZW9mKGhkcikpOwogfQogCiBzdGF0aWMgaW50IG51bV9zZW5k
X2RhdGFfY2FsbHMgPSAwOwpAQCAtMjQ2LDE1ICsxNzEsMTMgQEAgc3RhdGljIHZvaWQgdGVzdF9z
dHJlYW1fZGV2aWNlX3NldHVwKFRlc3RGaXh0dXJlICpmaXh0dXJlLCBnY29uc3Rwb2ludGVyIHVz
ZXJfZGEKIHsKICAgICBnX2Fzc2VydF9udWxsKGNvcmUpOwogICAgIGdfYXNzZXJ0X251bGwodGVz
dCk7CisgICAgZ19hc3NlcnRfbnVsbCh2bWMpOwogICAgIGNvcmUgPSBiYXNpY19ldmVudF9sb29w
X2luaXQoKTsKICAgICBnX2Fzc2VydF9ub25udWxsKGNvcmUpOwogICAgIHRlc3QgPSB0ZXN0X25l
dyhjb3JlKTsKICAgICBnX2Fzc2VydF9ub25udWxsKHRlc3QpOwotCi0gICAgcG9zID0gMDsKLSAg
ICB2bWNfd3JpdGVfcG9zID0gMDsKLSAgICBtZXNzYWdlX3NpemVzX2N1cnIgPSBtZXNzYWdlX3Np
emVzOwotICAgIG1lc3NhZ2Vfc2l6ZXNfZW5kID0gbWVzc2FnZV9zaXplczsKKyAgICB2bWMgPSB2
bWNfZW11X25ldygicG9ydCIsICJvcmcuc3BpY2Utc3BhY2Uuc3RyZWFtLjAiKTsKKyAgICBnX2Fz
c2VydF9ub25udWxsKHZtYyk7CiAKICAgICBudW1fc2VuZF9kYXRhX2NhbGxzID0gMDsKICAgICBz
ZW5kX2RhdGFfYnl0ZXMgPSAwOwpAQCAtMjY1LDYgKzE4OCw4IEBAIHN0YXRpYyB2b2lkIHRlc3Rf
c3RyZWFtX2RldmljZV90ZWFyZG93bihUZXN0Rml4dHVyZSAqZml4dHVyZSwgZ2NvbnN0cG9pbnRl
ciB1c2VyCiAgICAgZ19hc3NlcnRfbm9ubnVsbChjb3JlKTsKICAgICBnX2Fzc2VydF9ub25udWxs
KHRlc3QpOwogCisgICAgdm1jX2VtdV9kZXN0cm95KHZtYyk7CisgICAgdm1jID0gTlVMTDsKICAg
ICB0ZXN0X2Rlc3Ryb3kodGVzdCk7CiAgICAgdGVzdCA9IE5VTEw7CiAgICAgYmFzaWNfZXZlbnRf
bG9vcF9kZXN0cm95KCk7CkBAIC0yNzMsMTIyICsxOTgsMTA5IEBAIHN0YXRpYyB2b2lkIHRlc3Rf
c3RyZWFtX2RldmljZV90ZWFyZG93bihUZXN0Rml4dHVyZSAqZml4dHVyZSwgZ2NvbnN0cG9pbnRl
ciB1c2VyCiAKIHN0YXRpYyB2b2lkIHRlc3Rfa2ljayh2b2lkKQogewotICAgIHZtY19pbnN0YW5j
ZS5iYXNlLnNpZiA9ICZ2bWNfaW50ZXJmYWNlLmJhc2U7Ci0gICAgc3BpY2Vfc2VydmVyX2FkZF9p
bnRlcmZhY2UodGVzdC0+c2VydmVyLCAmdm1jX2luc3RhbmNlLmJhc2UpOworICAgIHNwaWNlX3Nl
cnZlcl9hZGRfaW50ZXJmYWNlKHRlc3QtPnNlcnZlciwgJnZtYy0+aW5zdGFuY2UuYmFzZSk7CiAK
ICAgICAvLyB3ZSBuZWVkIHRvIG9wZW4gdGhlIGRldmljZSBhbmQga2ljayB0aGUgc3RhcnQKICAg
ICAvLyB0aGUgYWxhcm0gaXMgdG8gcHJldmVudCB0aGUgcHJvZ3JhbSBmcm9tIGdldHRpbmcgc3R1
Y2sKICAgICBhbGFybSg1KTsKLSAgICBzcGljZV9zZXJ2ZXJfcG9ydF9ldmVudCgmdm1jX2luc3Rh
bmNlLCBTUElDRV9QT1JUX0VWRU5UX09QRU5FRCk7Ci0gICAgc3BpY2Vfc2VydmVyX2NoYXJfZGV2
aWNlX3dha2V1cCgmdm1jX2luc3RhbmNlKTsKKyAgICBzcGljZV9zZXJ2ZXJfcG9ydF9ldmVudCgm
dm1jLT5pbnN0YW5jZSwgU1BJQ0VfUE9SVF9FVkVOVF9PUEVORUQpOworICAgIHNwaWNlX3NlcnZl
cl9jaGFyX2RldmljZV93YWtldXAoJnZtYy0+aW5zdGFuY2UpOwogICAgIGFsYXJtKDApOwogfQog
CiBzdGF0aWMgdm9pZCB0ZXN0X3N0cmVhbV9kZXZpY2UoVGVzdEZpeHR1cmUgKmZpeHR1cmUsIGdj
b25zdHBvaW50ZXIgdXNlcl9kYXRhKQogewotICAgIHVpbnQ4X3QgKnAgPSBtZXNzYWdlOwotCiAg
ICAgZm9yIChpbnQgdGVzdF9udW09MDsgdGVzdF9udW0gPCAyOyArK3Rlc3RfbnVtKSB7Ci0gICAg
ICAgIHBvcyA9IDA7Ci0gICAgICAgIHZtY193cml0ZV9wb3MgPSAwOwotICAgICAgICBtZXNzYWdl
X3NpemVzX2N1cnIgPSBtZXNzYWdlX3NpemVzOwotICAgICAgICBtZXNzYWdlX3NpemVzX2VuZCA9
IG1lc3NhZ2Vfc2l6ZXM7CisgICAgICAgIHZtY19lbXVfcmVzZXQodm1jKTsKKyAgICAgICAgdWlu
dDhfdCAqcCA9IHZtYy0+bWVzc2FnZTsKIAogICAgICAgICAvLyBhZGQgc29tZSBtZXNzYWdlcyBp
bnRvIGRldmljZSBidWZmZXIKICAgICAgICAgLy8gaGVyZSB3ZSBhcmUgdGVzdGluZyB0aGUgZGV2
aWNlIGlzIHJlYWRpbmcgYXQgbGVhc3QgdHdvCiAgICAgICAgIC8vIGNvbnNlY3V0aXZlIGZvcm1h
dCBtZXNzYWdlcwogICAgICAgICAvLyBmaXJzdCBtZXNzYWdlIHBhcnQgaGFzIDIgZXh0cmEgYnl0
ZXMgdG8gY2hlY2sgZm9yIGhlYWRlciBzcGxpdAogICAgICAgICBwID0gYWRkX2Zvcm1hdChwLCA2
NDAsIDQ4MCwgU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9NSlBFRyk7Ci0gICAgICAgICptZXNzYWdl
X3NpemVzX2VuZCA9IHAgLSBtZXNzYWdlICsgMjsKLSAgICAgICAgKyttZXNzYWdlX3NpemVzX2Vu
ZDsKKyAgICAgICAgdm1jX2VtdV9hZGRfcmVhZF90aWxsKHZtYywgcCArIDIpOwogCiAgICAgICAg
IHAgPSBhZGRfZm9ybWF0KHAsIDY0MCwgNDgwLCBTUElDRV9WSURFT19DT0RFQ19UWVBFX1ZQOSk7
CiAKICAgICAgICAgLy8gdGhpcyBzcGxpdCB0aGUgc2Vjb25kIGZvcm1hdCBpbiBoYWxmCi0gICAg
ICAgICptZXNzYWdlX3NpemVzX2VuZCA9IHAgLSBtZXNzYWdlIC0gNDsKLSAgICAgICAgKyttZXNz
YWdlX3NpemVzX2VuZDsKKyAgICAgICAgdm1jX2VtdV9hZGRfcmVhZF90aWxsKHZtYywgcCAtIDQp
OwogCi0gICAgICAgICptZXNzYWdlX3NpemVzX2VuZCA9IHAgLSBtZXNzYWdlOwotICAgICAgICAr
K21lc3NhZ2Vfc2l6ZXNfZW5kOworICAgICAgICB2bWNfZW11X2FkZF9yZWFkX3RpbGwodm1jLCBw
KTsKIAogICAgICAgICAvLyBhZGQgYSBtZXNzYWdlIHRvIHN0b3AgZGF0YSB0byBiZSByZWFkCiAg
ICAgICAgIHAgPSBhZGRfc3RyZWFtX2hkcihwLCBTVFJFQU1fVFlQRV9JTlZBTElELCAwKTsKLSAg
ICAgICAgKm1lc3NhZ2Vfc2l6ZXNfZW5kID0gcCAtIG1lc3NhZ2U7Ci0gICAgICAgICsrbWVzc2Fn
ZV9zaXplc19lbmQ7CisgICAgICAgIHZtY19lbXVfYWRkX3JlYWRfdGlsbCh2bWMsIHApOwogCiAg
ICAgICAgIC8vIHRoaXMgbWVzc2FnZSBzaG91bGQgbm90IGJlIHJlYWQKICAgICAgICAgcCA9IGFk
ZF9zdHJlYW1faGRyKHAsIFNUUkVBTV9UWVBFX0lOVkFMSUQsIDApOwotICAgICAgICAqbWVzc2Fn
ZV9zaXplc19lbmQgPSBwIC0gbWVzc2FnZTsKLSAgICAgICAgKyttZXNzYWdlX3NpemVzX2VuZDsK
KyAgICAgICAgdm1jX2VtdV9hZGRfcmVhZF90aWxsKHZtYywgcCk7CiAKLSAgICAgICAgdm1jX2lu
c3RhbmNlLmJhc2Uuc2lmID0gJnZtY19pbnRlcmZhY2UuYmFzZTsKLSAgICAgICAgc3BpY2Vfc2Vy
dmVyX2FkZF9pbnRlcmZhY2UodGVzdC0+c2VydmVyLCAmdm1jX2luc3RhbmNlLmJhc2UpOworICAg
ICAgICBzcGljZV9zZXJ2ZXJfYWRkX2ludGVyZmFjZSh0ZXN0LT5zZXJ2ZXIsICZ2bWMtPmluc3Rh
bmNlLmJhc2UpOwogCiAgICAgICAgIC8vIGRldmljZSBzaG91bGQgbm90IGhhdmUgcmVhZCBkYXRh
IGJlZm9yZSB3ZSBvcGVuIGl0Ci0gICAgICAgIHNwaWNlX3NlcnZlcl9jaGFyX2RldmljZV93YWtl
dXAoJnZtY19pbnN0YW5jZSk7Ci0gICAgICAgIGdfYXNzZXJ0X2NtcGludChwb3MsID09LCAwKTsK
KyAgICAgICAgc3BpY2Vfc2VydmVyX2NoYXJfZGV2aWNlX3dha2V1cCgmdm1jLT5pbnN0YW5jZSk7
CisgICAgICAgIGdfYXNzZXJ0X2NtcGludCh2bWMtPnBvcywgPT0sIDApOwogCiAgICAgICAgIGdf
dGVzdF9leHBlY3RfbWVzc2FnZShHX0xPR19ET01BSU4sIEdfTE9HX0xFVkVMX1dBUk5JTkcsICJT
dHJlYW0gZGV2aWNlIHJlY2VpdmVkIGludmFsaWQgbWVzc2FnZTogSW52YWxpZCBtZXNzYWdlIHR5
cGUiKTsKIAogICAgICAgICAvLyB3ZSBuZWVkIHRvIG9wZW4gdGhlIGRldmljZSBhbmQga2ljayB0
aGUgc3RhcnQKLSAgICAgICAgc3BpY2Vfc2VydmVyX3BvcnRfZXZlbnQoJnZtY19pbnN0YW5jZSwg
U1BJQ0VfUE9SVF9FVkVOVF9PUEVORUQpOwotICAgICAgICBzcGljZV9zZXJ2ZXJfY2hhcl9kZXZp
Y2Vfd2FrZXVwKCZ2bWNfaW5zdGFuY2UpOwotICAgICAgICBzcGljZV9zZXJ2ZXJfcG9ydF9ldmVu
dCgmdm1jX2luc3RhbmNlLCBTUElDRV9QT1JUX0VWRU5UX0NMT1NFRCk7CisgICAgICAgIHNwaWNl
X3NlcnZlcl9wb3J0X2V2ZW50KCZ2bWMtPmluc3RhbmNlLCBTUElDRV9QT1JUX0VWRU5UX09QRU5F
RCk7CisgICAgICAgIHNwaWNlX3NlcnZlcl9jaGFyX2RldmljZV93YWtldXAoJnZtYy0+aW5zdGFu
Y2UpOworICAgICAgICBzcGljZV9zZXJ2ZXJfcG9ydF9ldmVudCgmdm1jLT5pbnN0YW5jZSwgU1BJ
Q0VfUE9SVF9FVkVOVF9DTE9TRUQpOwogCiAgICAgICAgIC8vIG1ha2Ugc3VyZSBmaXJzdCAzIHBh
cnRzIGFyZSByZWFkIGNvbXBsZXRlbHkKLSAgICAgICAgZ19hc3NlcnQobWVzc2FnZV9zaXplc19j
dXJyIC0gbWVzc2FnZV9zaXplcyA+PSAzKTsKKyAgICAgICAgZ19hc3NlcnQodm1jLT5tZXNzYWdl
X3NpemVzX2N1cnIgLSB2bWMtPm1lc3NhZ2Vfc2l6ZXMgPj0gMyk7CiAgICAgICAgIC8vIG1ha2Ug
c3VyZSB0aGUgZGV2aWNlIHJlYWRlZCBhbGwgb3IgdGhhdCBkZXZpY2Ugd2FzCiAgICAgICAgIC8v
IGRpc2FibGVkLCB3ZSBuZWVkIHRoaXMgdG8gbWFrZSBzdXJlIHRoYXQgZGV2aWNlIHdpbGwgYmUg
aW4KICAgICAgICAgLy8gc3luYyB3aGVuIG9wZW5lZCBhZ2FpbgotICAgICAgICBnX2Fzc2VydCht
ZXNzYWdlX3NpemVzX2N1cnIgLSBtZXNzYWdlX3NpemVzID09IDUgfHwgIWRldmljZV9lbmFibGVk
KTsKKyAgICAgICAgZ19hc3NlcnQodm1jLT5tZXNzYWdlX3NpemVzX2N1cnIgLSB2bWMtPm1lc3Nh
Z2Vfc2l6ZXMgPT0gNSB8fCAhdm1jLT5kZXZpY2VfZW5hYmxlZCk7CiAKICAgICAgICAgY2hlY2tf
dm1jX2Vycm9yX21lc3NhZ2UoKTsKLSAgICAgICAgc3BpY2Vfc2VydmVyX3JlbW92ZV9pbnRlcmZh
Y2UoJnZtY19pbnN0YW5jZS5iYXNlKTsKKyAgICAgICAgc3BpY2Vfc2VydmVyX3JlbW92ZV9pbnRl
cmZhY2UoJnZtYy0+aW5zdGFuY2UuYmFzZSk7CiAgICAgfQogfQogCiAvLyBjaGVjayBpZiBzZW5k
aW5nIGEgcGFydGlhbCBtZXNzYWdlIGNhdXNlcyBpc3N1ZXMKIHN0YXRpYyB2b2lkIHRlc3Rfc3Ry
ZWFtX2RldmljZV91bmZpbmlzaGVkKFRlc3RGaXh0dXJlICpmaXh0dXJlLCBnY29uc3Rwb2ludGVy
IHVzZXJfZGF0YSkKIHsKLSAgICB1aW50OF90ICpwID0gbWVzc2FnZTsKKyAgICB1aW50OF90ICpw
ID0gdm1jLT5tZXNzYWdlOwogCiAgICAgLy8gdGhpcyBsb25nIGFuZCBub3QgZmluaXNoZWQgbWVz
c2FnZSBzaG91bGQgbm90IGNhdXNlIGFuIGluZmluaXRlIGxvb3AKICAgICBwID0gYWRkX3N0cmVh
bV9oZHIocCwgU1RSRUFNX1RZUEVfREFUQSwgMTAwMDAwKTsKLSAgICAqbWVzc2FnZV9zaXplc19l
bmQgPSBwIC0gbWVzc2FnZTsKLSAgICArK21lc3NhZ2Vfc2l6ZXNfZW5kOworICAgIHZtY19lbXVf
YWRkX3JlYWRfdGlsbCh2bWMsIHApOwogCiAgICAgdGVzdF9raWNrKCk7CiAKICAgICAvLyB3ZSBz
aG91bGQgaGF2ZSByZWFkIGFsbCBkYXRhCi0gICAgZ19hc3NlcnQobWVzc2FnZV9zaXplc19jdXJy
IC0gbWVzc2FnZV9zaXplcyA9PSAxKTsKKyAgICBnX2Fzc2VydCh2bWMtPm1lc3NhZ2Vfc2l6ZXNf
Y3VyciAtIHZtYy0+bWVzc2FnZV9zaXplcyA9PSAxKTsKIAogICAgIC8vIHdlIHNob3VsZCBoYXZl
IG5vIGRhdGEgZnJvbSB0aGUgZGV2aWNlCiAgICAgZGlzY2FyZF9zZXJ2ZXJfY2FwYWJpbGl0aWVz
KCk7Ci0gICAgZ19hc3NlcnRfY21waW50KHZtY193cml0ZV9wb3MsID09LCAwKTsKKyAgICBnX2Fz
c2VydF9jbXBpbnQodm1jLT53cml0ZV9wb3MsID09LCAwKTsKIH0KIAogLy8gY2hlY2sgaWYgc2Vu
ZGluZyBtdWx0aXBsZSBtZXNzYWdlcyBjYXVzZSBzdGFsbAogc3RhdGljIHZvaWQgdGVzdF9zdHJl
YW1fZGV2aWNlX211bHRpcGxlKFRlc3RGaXh0dXJlICpmaXh0dXJlLCBnY29uc3Rwb2ludGVyIHVz
ZXJfZGF0YSkKIHsKLSAgICB1aW50OF90ICpwID0gbWVzc2FnZTsKKyAgICB1aW50OF90ICpwID0g
dm1jLT5tZXNzYWdlOwogCiAgICAgLy8gYWRkIHNvbWUgbWVzc2FnZXMgaW50byBkZXZpY2UgYnVm
ZmVyCiAgICAgcCA9IGFkZF9mb3JtYXQocCwgNjQwLCA0ODAsIFNQSUNFX1ZJREVPX0NPREVDX1RZ
UEVfTUpQRUcpOwogICAgIHAgPSBhZGRfZm9ybWF0KHAsIDY0MCwgNDgwLCBTUElDRV9WSURFT19D
T0RFQ19UWVBFX01KUEVHKTsKICAgICBwID0gYWRkX2Zvcm1hdChwLCA2NDAsIDQ4MCwgU1BJQ0Vf
VklERU9fQ09ERUNfVFlQRV9NSlBFRyk7Ci0gICAgKm1lc3NhZ2Vfc2l6ZXNfZW5kID0gcCAtIG1l
c3NhZ2U7Ci0gICAgKyttZXNzYWdlX3NpemVzX2VuZDsKKyAgICB2bWNfZW11X2FkZF9yZWFkX3Rp
bGwodm1jLCBwKTsKIAogICAgIHRlc3Rfa2ljaygpOwogCiAgICAgLy8gd2Ugc2hvdWxkIGhhdmUg
cmVhZCBhbGwgZGF0YQotICAgIGdfYXNzZXJ0KG1lc3NhZ2Vfc2l6ZXNfY3VyciAtIG1lc3NhZ2Vf
c2l6ZXMgPT0gMSk7CisgICAgZ19hc3NlcnQodm1jLT5tZXNzYWdlX3NpemVzX2N1cnIgLSB2bWMt
Pm1lc3NhZ2Vfc2l6ZXMgPT0gMSk7CiB9CiAKIC8vIGNoZWNrIGlmIGRhdGEgbWVzc2FnZSBjb25z
dW1lIGV2ZW4gZm9sbG93aW5nIG1lc3NhZ2UKIHN0YXRpYyB2b2lkIHRlc3Rfc3RyZWFtX2Rldmlj
ZV9mb3JtYXRfYWZ0ZXJfZGF0YShUZXN0Rml4dHVyZSAqZml4dHVyZSwgZ2NvbnN0cG9pbnRlciB1
c2VyX2RhdGEpCiB7Ci0gICAgdWludDhfdCAqcCA9IG1lc3NhZ2U7CisgICAgdWludDhfdCAqcCA9
IHZtYy0+bWVzc2FnZTsKIAogICAgIC8vIGFkZCBzb21lIG1lc3NhZ2VzIGludG8gZGV2aWNlIGJ1
ZmZlcgogICAgIHAgPSBhZGRfZm9ybWF0KHAsIDY0MCwgNDgwLCBTUElDRV9WSURFT19DT0RFQ19U
WVBFX01KUEVHKTsKQEAgLTM5NiwxNSArMzA4LDE0IEBAIHN0YXRpYyB2b2lkIHRlc3Rfc3RyZWFt
X2RldmljZV9mb3JtYXRfYWZ0ZXJfZGF0YShUZXN0Rml4dHVyZSAqZml4dHVyZSwgZ2NvbnN0cG9p
CiAgICAgbWVtY3B5KHAsICJoZWxsbyIsIDUpOwogICAgIHAgKz0gNTsKICAgICBwID0gYWRkX3N0
cmVhbV9oZHIocCwgU1RSRUFNX1RZUEVfSU5WQUxJRCwgMCk7Ci0gICAgKm1lc3NhZ2Vfc2l6ZXNf
ZW5kID0gcCAtIG1lc3NhZ2U7Ci0gICAgKyttZXNzYWdlX3NpemVzX2VuZDsKKyAgICB2bWNfZW11
X2FkZF9yZWFkX3RpbGwodm1jLCBwKTsKIAogICAgIGdfdGVzdF9leHBlY3RfbWVzc2FnZShHX0xP
R19ET01BSU4sIEdfTE9HX0xFVkVMX1dBUk5JTkcsICJTdHJlYW0gZGV2aWNlIHJlY2VpdmVkIGlu
dmFsaWQgbWVzc2FnZTogSW52YWxpZCBtZXNzYWdlIHR5cGUiKTsKIAogICAgIHRlc3Rfa2ljaygp
OwogCiAgICAgLy8gd2Ugc2hvdWxkIHJlYWQgYWxsIGRhdGEKLSAgICBnX2Fzc2VydChtZXNzYWdl
X3NpemVzX2N1cnIgLSBtZXNzYWdlX3NpemVzID09IDEpOworICAgIGdfYXNzZXJ0KHZtYy0+bWVz
c2FnZV9zaXplc19jdXJyIC0gdm1jLT5tZXNzYWdlX3NpemVzID09IDEpOwogCiAgICAgLy8gd2Ug
c2hvdWxkIGhhdmUgYW4gZXJyb3IgYmFjawogICAgIGNoZWNrX3ZtY19lcnJvcl9tZXNzYWdlKCk7
CkBAIC00MTQsNDYgKzMyNSw0MiBAQCBzdGF0aWMgdm9pZCB0ZXN0X3N0cmVhbV9kZXZpY2VfZm9y
bWF0X2FmdGVyX2RhdGEoVGVzdEZpeHR1cmUgKmZpeHR1cmUsIGdjb25zdHBvaQogc3RhdGljIHZv
aWQgdGVzdF9zdHJlYW1fZGV2aWNlX2VtcHR5KFRlc3RGaXh0dXJlICpmaXh0dXJlLCBnY29uc3Rw
b2ludGVyIHVzZXJfZGF0YSkKIHsKICAgICBjb25zdCBTdHJlYW1Nc2dUeXBlIG1zZ190eXBlID0g
KFN0cmVhbU1zZ1R5cGUpIEdQT0lOVEVSX1RPX0lOVCh1c2VyX2RhdGEpOwotICAgIHVpbnQ4X3Qg
KnAgPSBtZXNzYWdlOworICAgIHVpbnQ4X3QgKnAgPSB2bWMtPm1lc3NhZ2U7CiAKICAgICAvLyBh
ZGQgc29tZSBtZXNzYWdlcyBpbnRvIGRldmljZSBidWZmZXIKICAgICBwID0gYWRkX3N0cmVhbV9o
ZHIocCwgbXNnX3R5cGUsIDApOwotICAgICptZXNzYWdlX3NpemVzX2VuZCA9IHAgLSBtZXNzYWdl
OwotICAgICsrbWVzc2FnZV9zaXplc19lbmQ7CisgICAgdm1jX2VtdV9hZGRfcmVhZF90aWxsKHZt
YywgcCk7CiAgICAgcCA9IGFkZF9mb3JtYXQocCwgNjQwLCA0ODAsIFNQSUNFX1ZJREVPX0NPREVD
X1RZUEVfTUpQRUcpOwotICAgICptZXNzYWdlX3NpemVzX2VuZCA9IHAgLSBtZXNzYWdlOwotICAg
ICsrbWVzc2FnZV9zaXplc19lbmQ7CisgICAgdm1jX2VtdV9hZGRfcmVhZF90aWxsKHZtYywgcCk7
CiAgICAgcCA9IGFkZF9mb3JtYXQocCwgNjQwLCA0ODAsIFNQSUNFX1ZJREVPX0NPREVDX1RZUEVf
TUpQRUcpOwotICAgICptZXNzYWdlX3NpemVzX2VuZCA9IHAgLSBtZXNzYWdlOwotICAgICsrbWVz
c2FnZV9zaXplc19lbmQ7CisgICAgdm1jX2VtdV9hZGRfcmVhZF90aWxsKHZtYywgcCk7CiAKICAg
ICB0ZXN0X2tpY2soKTsKIAogICAgIC8vIHdlIHNob3VsZCByZWFkIGFsbCBkYXRhCi0gICAgZ19h
c3NlcnQobWVzc2FnZV9zaXplc19jdXJyIC0gbWVzc2FnZV9zaXplcyA9PSAzKTsKKyAgICBnX2Fz
c2VydCh2bWMtPm1lc3NhZ2Vfc2l6ZXNfY3VyciAtIHZtYy0+bWVzc2FnZV9zaXplcyA9PSAzKTsK
IAogICAgIC8vIHdlIHNob3VsZCBoYXZlIG5vIGRhdGEgZnJvbSB0aGUgZGV2aWNlCiAgICAgZGlz
Y2FyZF9zZXJ2ZXJfY2FwYWJpbGl0aWVzKCk7Ci0gICAgZ19hc3NlcnRfY21waW50KHZtY193cml0
ZV9wb3MsID09LCAwKTsKKyAgICBnX2Fzc2VydF9jbXBpbnQodm1jLT53cml0ZV9wb3MsID09LCAw
KTsKIH0KIAogLy8gY2hlY2sgdGhhdCBzZXJ2ZXIgcmVmdXNlIGh1Z2UgZGF0YSBtZXNzYWdlcwog
c3RhdGljIHZvaWQgdGVzdF9zdHJlYW1fZGV2aWNlX2h1Z2VfZGF0YShUZXN0Rml4dHVyZSAqZml4
dHVyZSwgZ2NvbnN0cG9pbnRlciB1c2VyX2RhdGEpCiB7Ci0gICAgdWludDhfdCAqcCA9IG1lc3Nh
Z2U7CisgICAgdWludDhfdCAqcCA9IHZtYy0+bWVzc2FnZTsKIAogICAgIC8vIGFkZCBzb21lIG1l
c3NhZ2VzIGludG8gZGV2aWNlIGJ1ZmZlcgogICAgIHAgPSBhZGRfc3RyZWFtX2hkcihwLCBTVFJF
QU1fVFlQRV9EQVRBLCAzMyAqIDEwMjQgKiAxMDI0KTsKICAgICBwID0gYWRkX2Zvcm1hdChwLCA2
NDAsIDQ4MCwgU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9NSlBFRyk7Ci0gICAgKm1lc3NhZ2Vfc2l6
ZXNfZW5kID0gcCAtIG1lc3NhZ2U7Ci0gICAgKyttZXNzYWdlX3NpemVzX2VuZDsKKyAgICB2bWNf
ZW11X2FkZF9yZWFkX3RpbGwodm1jLCBwKTsKIAogICAgIGdfdGVzdF9leHBlY3RfbWVzc2FnZShH
X0xPR19ET01BSU4sIEdfTE9HX0xFVkVMX1dBUk5JTkcsICJTdHJlYW0gZGV2aWNlIHJlY2VpdmVk
IGludmFsaWQgbWVzc2FnZTogU1RSRUFNX0RBVEEgdG9vIGxhcmdlIik7CiAKICAgICB0ZXN0X2tp
Y2soKTsKIAogICAgIC8vIHdlIHNob3VsZCByZWFkIGFsbCBkYXRhCi0gICAgZ19hc3NlcnQobWVz
c2FnZV9zaXplc19jdXJyIC0gbWVzc2FnZV9zaXplcyA9PSAxKTsKKyAgICBnX2Fzc2VydCh2bWMt
Pm1lc3NhZ2Vfc2l6ZXNfY3VyciAtIHZtYy0+bWVzc2FnZV9zaXplcyA9PSAxKTsKIAogICAgIC8v
IHdlIHNob3VsZCBoYXZlIGFuIGVycm9yIGJhY2sKICAgICBjaGVja192bWNfZXJyb3JfbWVzc2Fn
ZSgpOwpAQCAtNDYyLDcgKzM2OSw3IEBAIHN0YXRpYyB2b2lkIHRlc3Rfc3RyZWFtX2RldmljZV9o
dWdlX2RhdGEoVGVzdEZpeHR1cmUgKmZpeHR1cmUsIGdjb25zdHBvaW50ZXIgdXNlCiAvLyBjaGVj
ayB0aGF0IHNlcnZlciBzZW5kIGFsbCBtZXNzYWdlCiBzdGF0aWMgdm9pZCB0ZXN0X3N0cmVhbV9k
ZXZpY2VfZGF0YV9tZXNzYWdlKFRlc3RGaXh0dXJlICpmaXh0dXJlLCBnY29uc3Rwb2ludGVyIHVz
ZXJfZGF0YSkKIHsKLSAgICB1aW50OF90ICpwID0gbWVzc2FnZTsKKyAgICB1aW50OF90ICpwID0g
dm1jLT5tZXNzYWdlOwogCiAgICAgLy8gYWRkIHNvbWUgbWVzc2FnZXMgaW50byBkZXZpY2UgYnVm
ZmVyCiAgICAgcCA9IGFkZF9mb3JtYXQocCwgNjQwLCA0ODAsIFNQSUNFX1ZJREVPX0NPREVDX1RZ
UEVfTUpQRUcpOwpAQCAtNDcwLDIzICszNzcsMTkgQEAgc3RhdGljIHZvaWQgdGVzdF9zdHJlYW1f
ZGV2aWNlX2RhdGFfbWVzc2FnZShUZXN0Rml4dHVyZSAqZml4dHVyZSwgZ2NvbnN0cG9pbnRlcgog
ICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTAxNzsgKytpLCArK3ApIHsKICAgICAgICAgKnAgPSAo
dWludDhfdCkgKGkgKiAxMjMgKyA1Nyk7CiAgICAgfQotICAgICptZXNzYWdlX3NpemVzX2VuZCA9
IDUxOwotICAgICsrbWVzc2FnZV9zaXplc19lbmQ7Ci0gICAgKm1lc3NhZ2Vfc2l6ZXNfZW5kID0g
MTIzOwotICAgICsrbWVzc2FnZV9zaXplc19lbmQ7Ci0gICAgKm1lc3NhZ2Vfc2l6ZXNfZW5kID0g
NTM0OwotICAgICsrbWVzc2FnZV9zaXplc19lbmQ7Ci0gICAgKm1lc3NhZ2Vfc2l6ZXNfZW5kID0g
cCAtIG1lc3NhZ2U7Ci0gICAgKyttZXNzYWdlX3NpemVzX2VuZDsKKyAgICB2bWNfZW11X2FkZF9y
ZWFkX3RpbGwodm1jLCB2bWMtPm1lc3NhZ2UgKyA1MSk7CisgICAgdm1jX2VtdV9hZGRfcmVhZF90
aWxsKHZtYywgdm1jLT5tZXNzYWdlICsgMTIzKTsKKyAgICB2bWNfZW11X2FkZF9yZWFkX3RpbGwo
dm1jLCB2bWMtPm1lc3NhZ2UgKyA1MzQpOworICAgIHZtY19lbXVfYWRkX3JlYWRfdGlsbCh2bWMs
IHApOwogCiAgICAgdGVzdF9raWNrKCk7CiAKICAgICAvLyB3ZSBzaG91bGQgcmVhZCBhbGwgZGF0
YQotICAgIGdfYXNzZXJ0KG1lc3NhZ2Vfc2l6ZXNfY3VyciAtIG1lc3NhZ2Vfc2l6ZXMgPT0gNCk7
CisgICAgZ19hc3NlcnQodm1jLT5tZXNzYWdlX3NpemVzX2N1cnIgLSB2bWMtPm1lc3NhZ2Vfc2l6
ZXMgPT0gNCk7CiAKICAgICAvLyB3ZSBzaG91bGQgaGF2ZSBubyBkYXRhIGZyb20gdGhlIGRldmlj
ZQogICAgIGRpc2NhcmRfc2VydmVyX2NhcGFiaWxpdGllcygpOwotICAgIGdfYXNzZXJ0X2NtcGlu
dCh2bWNfd3JpdGVfcG9zLCA9PSwgMCk7CisgICAgZ19hc3NlcnRfY21waW50KHZtYy0+d3JpdGVf
cG9zLCA9PSwgMCk7CiAKICAgICAvLyBtYWtlIHN1cmUgZGF0YSB3ZXJlIGNvbGxhcHNlZCBpbiBh
IHNpbmdsZSBtZXNzYWdlCiAgICAgZ19hc3NlcnRfY21waW50KG51bV9zZW5kX2RhdGFfY2FsbHMs
ID09LCAxKTsKQEAgLTUwOSwxNSArNDEyLDE0IEBAIHN0YXRpYyB2b2lkIHRlc3RfZGlzcGxheV9p
bmZvKFRlc3RGaXh0dXJlICpmaXh0dXJlLCBnY29uc3Rwb2ludGVyIHVzZXJfZGF0YSkKICAgICAg
ICAgLmRldmljZV9kaXNwbGF5X2lkID0gR1VJTlQzMl9UT19MRSgweDBhMGIwYzBkKSwKICAgICAg
ICAgLmRldmljZV9hZGRyZXNzX2xlbiA9IEdVSU5UMzJfVE9fTEUoc2l6ZW9mKGFkZHJlc3MpKSwK
ICAgICB9OwotICAgIHVpbnQ4X3QgKnAgPSBtZXNzYWdlOworICAgIHVpbnQ4X3QgKnAgPSB2bWMt
Pm1lc3NhZ2U7CiAgICAgcCA9IGFkZF9zdHJlYW1faGRyKHAsIFNUUkVBTV9UWVBFX0RFVklDRV9E
SVNQTEFZX0lORk8sIHNpemVvZihpbmZvKSArIHNpemVvZihhZGRyZXNzKSk7CiAgICAgbWVtY3B5
KHAsICZpbmZvLCBzaXplb2YoaW5mbykpOwogICAgIHAgKz0gc2l6ZW9mKGluZm8pOwogICAgIHN0
cmNweSgoY2hhciopcCwgYWRkcmVzcyk7CiAgICAgcCArPSBzaXplb2YoYWRkcmVzcyk7CiAKLSAg
ICAqbWVzc2FnZV9zaXplc19lbmQgPSBwIC0gbWVzc2FnZTsKLSAgICArK21lc3NhZ2Vfc2l6ZXNf
ZW5kOworICAgIHZtY19lbXVfYWRkX3JlYWRfdGlsbCh2bWMsIHApOwogCiAgICAgLy8gcGFyc2Ug
dGhlIHNpbXVsYXRlZCBkaXNwbGF5IGluZm8gbWVzc2FnZSBmcm9tIHRoZSBzdHJlYW0gZGV2aWNl
IHNvIHRoZSBzZXJ2ZXIgbm93IGhhcyBkaXNwbGF5CiAgICAgLy8gaW5mbyBmb3IgdGhlIG1vY2sg
c3RyZWFtIGRldmljZQpkaWZmIC0tZ2l0IGEvc2VydmVyL3Rlc3RzL3ZtYy1lbXUuYyBiL3NlcnZl
ci90ZXN0cy92bWMtZW11LmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAuLmRk
YWM1MjY5Ci0tLSAvZGV2L251bGwKKysrIGIvc2VydmVyL3Rlc3RzL3ZtYy1lbXUuYwpAQCAtMCww
ICsxLDEyMSBAQAorLyogLSotIE1vZGU6IEM7IGMtYmFzaWMtb2Zmc2V0OiA0OyBpbmRlbnQtdGFi
cy1tb2RlOiBuaWwgLSotICovCisvKgorICAgQ29weXJpZ2h0IChDKSAyMDE5IFJlZCBIYXQsIElu
Yy4KKworICAgVGhpcyBsaWJyYXJ5IGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmli
dXRlIGl0IGFuZC9vcgorICAgbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExl
c3NlciBHZW5lcmFsIFB1YmxpYworICAgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUg
U29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyCisgICB2ZXJzaW9uIDIuMSBvZiB0aGUgTGljZW5z
ZSwgb3IgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KKworICAgVGhpcyBsaWJy
YXJ5IGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCisg
ICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJy
YW50eSBvZgorICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQ
VVJQT1NFLiAgU2VlIHRoZSBHTlUKKyAgIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZv
ciBtb3JlIGRldGFpbHMuCisKKyAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2Yg
dGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKKyAgIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlz
IGxpYnJhcnk7IGlmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KKyov
CisKKyNpbmNsdWRlIDxjb25maWcuaD4KKyNpbmNsdWRlIDxnbGliLmg+CisKKyNpbmNsdWRlICJ2
bWMtZW11LmgiCisKKy8vIGhhbmRsZSB3cml0ZXMgdG8gdGhlIGRldmljZQorc3RhdGljIGludCB2
bWNfd3JpdGUoU3BpY2VDaGFyRGV2aWNlSW5zdGFuY2UgKnNpbiwKKyAgICAgICAgICAgICAgICAg
ICAgIGNvbnN0IHVpbnQ4X3QgKmJ1ZiwgaW50IGxlbikKK3sKKyAgICBWbWNFbXUgKmNvbnN0IHZt
YyA9IFNQSUNFX0NPTlRBSU5FUk9GKHNpbiwgVm1jRW11LCBpbnN0YW5jZSk7CisKKyAgICAvLyBq
dXN0IGNvcHkgaW50byB0aGUgYnVmZmVyCisgICAgdW5zaWduZWQgY29weSA9IE1JTihzaXplb2Yo
dm1jLT53cml0ZV9idWYpIC0gdm1jLT53cml0ZV9wb3MsIGxlbik7CisgICAgbWVtY3B5KHZtYy0+
d3JpdGVfYnVmK3ZtYy0+d3JpdGVfcG9zLCBidWYsIGNvcHkpOworICAgIHZtYy0+d3JpdGVfcG9z
ICs9IGNvcHk7CisgICAgcmV0dXJuIGxlbjsKK30KKworc3RhdGljIGludCB2bWNfcmVhZChTcGlj
ZUNoYXJEZXZpY2VJbnN0YW5jZSAqc2luLAorICAgICAgICAgICAgICAgICAgICB1aW50OF90ICpi
dWYsIGludCBsZW4pCit7CisgICAgVm1jRW11ICpjb25zdCB2bWMgPSBTUElDRV9DT05UQUlORVJP
RihzaW4sIFZtY0VtdSwgaW5zdGFuY2UpOworICAgIGludCByZXQ7CisKKyAgICBpZiAodm1jLT5w
b3MgPj0gKnZtYy0+bWVzc2FnZV9zaXplc19jdXJyICYmIHZtYy0+bWVzc2FnZV9zaXplc19jdXJy
IDwgdm1jLT5tZXNzYWdlX3NpemVzX2VuZCkgeworICAgICAgICArK3ZtYy0+bWVzc2FnZV9zaXpl
c19jdXJyOworICAgIH0KKyAgICBpZiAodm1jLT5tZXNzYWdlX3NpemVzX2N1cnIgPj0gdm1jLT5t
ZXNzYWdlX3NpemVzX2VuZCB8fCB2bWMtPnBvcyA+PSAqdm1jLT5tZXNzYWdlX3NpemVzX2N1cnIp
IHsKKyAgICAgICAgcmV0dXJuIDA7CisgICAgfQorICAgIHJldCA9IE1JTigqdm1jLT5tZXNzYWdl
X3NpemVzX2N1cnIgLSB2bWMtPnBvcywgbGVuKTsKKyAgICBtZW1jcHkoYnVmLCAmdm1jLT5tZXNz
YWdlW3ZtYy0+cG9zXSwgcmV0KTsKKyAgICB2bWMtPnBvcyArPSByZXQ7CisgICAgLy8ga2ljayBv
ZmYgbmV4dCBtZXNzYWdlIHJlYWQKKyAgICAvLyBjdXJyZW50bHkgUWVtdSBraWNrcyB0aGUgZGV2
aWNlIHNvIHdlIG5lZWQgdG8gZG8gaXQgbWFudWFsbHkKKyAgICAvLyBoZXJlLiBJZiBub3QgYWxs
IGRhdGEgYXJlIHJlYWQsIHRoZSBkZXZpY2UgZ29lcyBpbnRvIGJsb2NraW5nCisgICAgLy8gc3Rh
dGUgYW5kIHdlIGdldCB0aGUgd2FrZSBvbmx5IHdoZW4gd2UgcmVhZCBmcm9tIHRoZSBkZXZpY2UK
KyAgICAvLyBhZ2FpbgorICAgIGlmICh2bWMtPnBvcyA+PSAqdm1jLT5tZXNzYWdlX3NpemVzX2N1
cnIpIHsKKyAgICAgICAgc3BpY2Vfc2VydmVyX2NoYXJfZGV2aWNlX3dha2V1cCgmdm1jLT5pbnN0
YW5jZSk7CisgICAgfQorICAgIHJldHVybiByZXQ7Cit9CisKK3N0YXRpYyB2b2lkIHZtY19zdGF0
ZShTcGljZUNoYXJEZXZpY2VJbnN0YW5jZSAqc2luLAorICAgICAgICAgICAgICAgICAgICAgIGlu
dCBjb25uZWN0ZWQpCit7CisgICAgVm1jRW11ICpjb25zdCB2bWMgPSBTUElDRV9DT05UQUlORVJP
RihzaW4sIFZtY0VtdSwgaW5zdGFuY2UpOworICAgIHZtYy0+ZGV2aWNlX2VuYWJsZWQgPSAhIWNv
bm5lY3RlZDsKK30KKworc3RhdGljIGNvbnN0IFNwaWNlQ2hhckRldmljZUludGVyZmFjZSB2bWNf
aW50ZXJmYWNlID0geworICAgIC5iYXNlID0geworICAgICAgICAudHlwZSAgICAgICAgICA9IFNQ
SUNFX0lOVEVSRkFDRV9DSEFSX0RFVklDRSwKKyAgICAgICAgLmRlc2NyaXB0aW9uICAgPSAidGVz
dCBzcGljZSB2aXJ0dWFsIGNoYW5uZWwgY2hhciBkZXZpY2UiLAorICAgICAgICAubWFqb3JfdmVy
c2lvbiA9IFNQSUNFX0lOVEVSRkFDRV9DSEFSX0RFVklDRV9NQUpPUiwKKyAgICAgICAgLm1pbm9y
X3ZlcnNpb24gPSBTUElDRV9JTlRFUkZBQ0VfQ0hBUl9ERVZJQ0VfTUlOT1IsCisgICAgfSwKKyAg
ICAuc3RhdGUgICAgICAgICAgICAgID0gdm1jX3N0YXRlLAorICAgIC53cml0ZSAgICAgICAgICAg
ICAgPSB2bWNfd3JpdGUsCisgICAgLnJlYWQgICAgICAgICAgICAgICA9IHZtY19yZWFkLAorfTsK
KworVm1jRW11ICp2bWNfZW11X25ldyhjb25zdCBjaGFyICpzdWJ0eXBlLCBjb25zdCBjaGFyICpw
b3J0bmFtZSkKK3sKKyAgICBWbWNFbXUgKnZtYyA9IGdfbmV3MChWbWNFbXUsIDEpOworICAgIHZt
Yy0+aW50ZXJmYWNlID0gdm1jX2ludGVyZmFjZTsKKyAgICB2bWMtPmluc3RhbmNlLmJhc2Uuc2lm
ID0gJnZtYy0+aW50ZXJmYWNlLmJhc2U7CisgICAgdm1jLT5pbnN0YW5jZS5zdWJ0eXBlID0gZ19z
dHJkdXAoc3VidHlwZSk7CisgICAgaWYgKHBvcnRuYW1lKSB7CisgICAgICAgIHZtYy0+aW5zdGFu
Y2UucG9ydG5hbWUgPSBnX3N0cmR1cChwb3J0bmFtZSk7CisgICAgfQorICAgIHZtY19lbXVfcmVz
ZXQodm1jKTsKKyAgICByZXR1cm4gdm1jOworfQorCit2b2lkIHZtY19lbXVfZGVzdHJveShWbWNF
bXUgKnZtYykKK3sKKyAgICBnX2ZyZWUoKGNoYXIgKikgdm1jLT5pbnN0YW5jZS5wb3J0bmFtZSk7
CisgICAgZ19mcmVlKChjaGFyICopIHZtYy0+aW5zdGFuY2Uuc3VidHlwZSk7CisgICAgZ19mcmVl
KHZtYyk7Cit9CisKK3ZvaWQgdm1jX2VtdV9yZXNldChWbWNFbXUgKnZtYykKK3sKKyAgICB2bWMt
PnBvcyA9IDA7CisgICAgdm1jLT53cml0ZV9wb3MgPSAwOworICAgIHZtYy0+bWVzc2FnZV9zaXpl
c19jdXJyID0gdm1jLT5tZXNzYWdlX3NpemVzOworICAgIHZtYy0+bWVzc2FnZV9zaXplc19lbmQg
PSB2bWMtPm1lc3NhZ2Vfc2l6ZXM7Cit9CisKK3ZvaWQgdm1jX2VtdV9hZGRfcmVhZF90aWxsKFZt
Y0VtdSAqdm1jLCB1aW50OF90ICplbmQpCit7CisgICAgZ19hc3NlcnQodm1jLT5tZXNzYWdlX3Np
emVzX2VuZCAtIHZtYy0+bWVzc2FnZV9zaXplcyA8IEdfTl9FTEVNRU5UUyh2bWMtPm1lc3NhZ2Vf
c2l6ZXMpKTsKKyAgICBnX2Fzc2VydChlbmQgPj0gdm1jLT5tZXNzYWdlKTsKKyAgICBnX2Fzc2Vy
dChlbmQgLSB2bWMtPm1lc3NhZ2UgPD0gR19OX0VMRU1FTlRTKHZtYy0+bWVzc2FnZSkpOworICAg
IHVuc2lnbmVkIHByZXZfc2l6ZSA9CisgICAgICAgIHZtYy0+bWVzc2FnZV9zaXplc19lbmQgPiB2
bWMtPm1lc3NhZ2Vfc2l6ZXMgPyB2bWMtPm1lc3NhZ2Vfc2l6ZXNfZW5kWy0xXSA6IDA7CisgICAg
dW5zaWduZWQgc2l6ZSA9IGVuZCAtIHZtYy0+bWVzc2FnZTsKKyAgICBnX2Fzc2VydChzaXplID49
IHByZXZfc2l6ZSk7CisgICAgKnZtYy0+bWVzc2FnZV9zaXplc19lbmQgPSBzaXplOworICAgICsr
dm1jLT5tZXNzYWdlX3NpemVzX2VuZDsKK30KZGlmZiAtLWdpdCBhL3NlcnZlci90ZXN0cy92bWMt
ZW11LmggYi9zZXJ2ZXIvdGVzdHMvdm1jLWVtdS5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4
IDAwMDAwMDAwLi42ZmNlYTY5ZAotLS0gL2Rldi9udWxsCisrKyBiL3NlcnZlci90ZXN0cy92bWMt
ZW11LmgKQEAgLTAsMCArMSw0OCBAQAorLyogLSotIE1vZGU6IEM7IGMtYmFzaWMtb2Zmc2V0OiA0
OyBpbmRlbnQtdGFicy1tb2RlOiBuaWwgLSotICovCisvKgorICAgQ29weXJpZ2h0IChDKSAyMDE5
IFJlZCBIYXQsIEluYy4KKworICAgVGhpcyBsaWJyYXJ5IGlzIGZyZWUgc29mdHdhcmU7IHlvdSBj
YW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vcgorICAgbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBv
ZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYworICAgTGljZW5zZSBhcyBwdWJsaXNoZWQg
YnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyCisgICB2ZXJzaW9uIDIuMSBv
ZiB0aGUgTGljZW5zZSwgb3IgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KKwor
ICAgVGhpcyBsaWJyYXJ5IGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBi
ZSB1c2VmdWwsCisgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUg
aW1wbGllZCB3YXJyYW50eSBvZgorICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEg
UEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUKKyAgIExlc3NlciBHZW5lcmFsIFB1Ymxp
YyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCisKKyAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZl
ZCBhIGNvcHkgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKKyAgIExpY2Vuc2UgYWxv
bmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGlj
ZW5zZXMvPi4KKyovCisjcHJhZ21hIG9uY2UKKworI2luY2x1ZGUgImNoYXItZGV2aWNlLmgiCisK
K3R5cGVkZWYgc3RydWN0IFZtY0VtdSBWbWNFbXU7CisKK3N0cnVjdCBWbWNFbXUgeworICAgIFNw
aWNlQ2hhckRldmljZUludGVyZmFjZSBpbnRlcmZhY2U7CisgICAgU3BpY2VDaGFyRGV2aWNlSW5z
dGFuY2UgaW5zdGFuY2U7CisKKyAgICAvLyBkZXZpY2UgYnVmZmVyIHRvIHJlYWQgZnJvbQorICAg
IHVpbnQ4X3QgbWVzc2FnZVsyMDQ4XTsKKyAgICAvLyBwb3NpdGlvbiB0byByZWFkIGZyb20KKyAg
ICB1bnNpZ25lZCBwb3M7CisKKyAgICAvLyBhcnJheSBvZiBsaW1pdHMgd2hlbiB0aGUgcmVhZCBz
aG91bGQgcmV0dXJuCisgICAgLy8gdGhlIGFycmF5IGlzIGRlZmluZWQgYXMgW21lc3NhZ2Vfc2l6
ZXNfY3VyciwgbWVzc2FnZV9zaXplc19lbmQpCisgICAgLy8gdGhlbiB0aGUgc2l6ZSBpcyByZWFj
aCB3ZSBtb3ZlIG9uIG5leHQgb25lIHRpbGwgZXhhdXN0ZWQKKyAgICB1bnNpZ25lZCBtZXNzYWdl
X3NpemVzWzE2XTsKKyAgICB1bnNpZ25lZCAqbWVzc2FnZV9zaXplc19lbmQsICptZXNzYWdlX3Np
emVzX2N1cnI7CisKKyAgICBib29sIGRldmljZV9lbmFibGVkOworCisgICAgdW5zaWduZWQgd3Jp
dGVfcG9zOworICAgIHVpbnQ4X3Qgd3JpdGVfYnVmWzIwNDhdOworfTsKKworVm1jRW11ICp2bWNf
ZW11X25ldyhjb25zdCBjaGFyICpzdWJ0eXBlLCBjb25zdCBjaGFyICpwb3J0bmFtZSk7Cit2b2lk
IHZtY19lbXVfZGVzdHJveShWbWNFbXUgKnZtYyk7Cit2b2lkIHZtY19lbXVfcmVzZXQoVm1jRW11
ICp2bWMpOwordm9pZCB2bWNfZW11X2FkZF9yZWFkX3RpbGwoVm1jRW11ICp2bWMsIHVpbnQ4X3Qg
KmVuZCk7Ci0tIAoyLjIxLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9zcGljZS1kZXZlbA==
