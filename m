Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id AADD05542A
	for <lists+spice-devel@lfdr.de>; Tue, 25 Jun 2019 18:12:24 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 350AB6E191;
	Tue, 25 Jun 2019 16:12:23 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 43CA46E191
 for <spice-devel@lists.freedesktop.org>; Tue, 25 Jun 2019 16:12:21 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
 [10.5.11.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id E24DF8762E
 for <spice-devel@lists.freedesktop.org>; Tue, 25 Jun 2019 16:12:20 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.4])
 by smtp.corp.redhat.com (Postfix) with ESMTP id E55175B68D;
 Tue, 25 Jun 2019 16:12:18 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Tue, 25 Jun 2019 17:11:43 +0100
Message-Id: <20190625161147.25211-20-fziglio@redhat.com>
In-Reply-To: <20190625161147.25211-1-fziglio@redhat.com>
References: <20190625161147.25211-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.26]); Tue, 25 Jun 2019 16:12:20 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-server 19/23] test-websocket: Write a
 test helper to make possible to run Autobahn testsuite
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

U2lnbmVkLW9mZi1ieTogRnJlZGlhbm8gWmlnbGlvIDxmemlnbGlvQHJlZGhhdC5jb20+Ci0tLQog
c2VydmVyL3Rlc3RzLy5naXRpZ25vcmUgICAgICAgfCAgIDEgKwogc2VydmVyL3Rlc3RzL01ha2Vm
aWxlLmFtICAgICAgfCAgIDYgKwogc2VydmVyL3Rlc3RzL21lc29uLmJ1aWxkICAgICAgfCAgIDEg
Kwogc2VydmVyL3Rlc3RzL3Rlc3Qtd2Vic29ja2V0LmMgfCAyOTAgKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKwogNCBmaWxlcyBjaGFuZ2VkLCAyOTggaW5zZXJ0aW9ucygrKQogY3Jl
YXRlIG1vZGUgMTAwNjQ0IHNlcnZlci90ZXN0cy90ZXN0LXdlYnNvY2tldC5jCgpkaWZmIC0tZ2l0
IGEvc2VydmVyL3Rlc3RzLy5naXRpZ25vcmUgYi9zZXJ2ZXIvdGVzdHMvLmdpdGlnbm9yZQppbmRl
eCA4MWI2MDRiYzcuLjM2ZTk3OGQ0ZiAxMDA2NDQKLS0tIGEvc2VydmVyL3Rlc3RzLy5naXRpZ25v
cmUKKysrIGIvc2VydmVyL3Rlc3RzLy5naXRpZ25vcmUKQEAgLTI4LDUgKzI4LDYgQEAgdGVzdC1n
c3QKIHRlc3QtbGVha3MKIHRlc3Qtc2FzbAogdGVzdC1yZWNvcmQKK3Rlc3Qtd2Vic29ja2V0CiAv
dGVzdC0qLmxvZwogL3Rlc3QtKi50cnMKZGlmZiAtLWdpdCBhL3NlcnZlci90ZXN0cy9NYWtlZmls
ZS5hbSBiL3NlcnZlci90ZXN0cy9NYWtlZmlsZS5hbQppbmRleCBjNTA4MjZlNjIuLjI2YWFkZDVm
MSAxMDA2NDQKLS0tIGEvc2VydmVyL3Rlc3RzL01ha2VmaWxlLmFtCisrKyBiL3NlcnZlci90ZXN0
cy9NYWtlZmlsZS5hbQpAQCAtODMsNiArODMsMTIgQEAgbm9pbnN0X1BST0dSQU1TID0JCQkJXAog
CSQoY2hlY2tfUFJPR1JBTVMpCQkJXAogCSQoTlVMTCkKIAoraWYgIU9TX1dJTjMyCitub2luc3Rf
UFJPR1JBTVMgKz0gXAorCXRlc3Qtd2Vic29ja2V0IFwKKwkkKE5VTEwpCitlbmRpZgorCiBURVNU
UyA9ICQoY2hlY2tfUFJPR1JBTVMpCQkJXAogCSQoTlVMTCkKIApkaWZmIC0tZ2l0IGEvc2VydmVy
L3Rlc3RzL21lc29uLmJ1aWxkIGIvc2VydmVyL3Rlc3RzL21lc29uLmJ1aWxkCmluZGV4IGI0MjY5
YzU4Yi4uYjZjZjg5ODk0IDEwMDY0NAotLS0gYS9zZXJ2ZXIvdGVzdHMvbWVzb24uYnVpbGQKKysr
IGIvc2VydmVyL3Rlc3RzL21lc29uLmJ1aWxkCkBAIC02Nyw2ICs2Nyw3IEBAIGlmIGhvc3RfbWFj
aGluZS5zeXN0ZW0oKSAhPSAnd2luZG93cycKICAgdGVzdHMgKz0gWwogICAgIFsndGVzdC1zdHJl
YW0nLCB0cnVlXSwKICAgICBbJ3Rlc3Qtc3RhdC1maWxlJywgdHJ1ZV0sCisgICAgWyd0ZXN0LXdl
YnNvY2tldCcsIGZhbHNlXSwKICAgXQogZW5kaWYKIApkaWZmIC0tZ2l0IGEvc2VydmVyL3Rlc3Rz
L3Rlc3Qtd2Vic29ja2V0LmMgYi9zZXJ2ZXIvdGVzdHMvdGVzdC13ZWJzb2NrZXQuYwpuZXcgZmls
ZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAuLjY1OTZjMjdlZgotLS0gL2Rldi9udWxsCisr
KyBiL3NlcnZlci90ZXN0cy90ZXN0LXdlYnNvY2tldC5jCkBAIC0wLDAgKzEsMjkwIEBACisvKiAt
Ki0gTW9kZTogQzsgYy1iYXNpYy1vZmZzZXQ6IDQ7IGluZGVudC10YWJzLW1vZGU6IG5pbCAtKi0g
Ki8KKy8qCisgICBDb3B5cmlnaHQgKEMpIDIwMTctMjAxOSBSZWQgSGF0LCBJbmMuCisKKyAgIFRo
aXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQv
b3IKKyAgIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJh
bCBQdWJsaWMKKyAgIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZv
dW5kYXRpb247IGVpdGhlcgorICAgdmVyc2lvbiAyLjEgb2YgdGhlIExpY2Vuc2UsIG9yIChhdCB5
b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCisKKyAgIFRoaXMgbGlicmFyeSBpcyBkaXN0
cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAorICAgYnV0IFdJVEhP
VVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKKyAg
IE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNl
ZSB0aGUgR05VCisgICBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRh
aWxzLgorCisgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVz
c2VyIEdlbmVyYWwgUHVibGljCisgICBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBsaWJyYXJ5OyBp
ZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCisqLworLyogVXRpbGl0
eSB0byBhbGxvdyBjaGVja2luZyBvdXIgd2Vic29ja2V0IGltcGxlbWVudGFpb24gdXNpbmcgQXV0
b2JhaG4KKyAqIFRlc3QgU3VpdGUuCisgKiBUaGlzIHN1aXRlIHJlcXVpcmUgYSBXZWJTb2NrZXQg
c2VydmVyIGltcGxlbWVudGF0aW9uIGVjaG9pbmcKKyAqIGRhdGEgc2VudCB0byBpdAorICovCisj
dW5kZWYgTkRFQlVHCisjaW5jbHVkZSA8Y29uZmlnLmg+CisjaW5jbHVkZSA8c3RkaW8uaD4KKyNp
bmNsdWRlIDxzdGRsaWIuaD4KKyNpbmNsdWRlIDxzdGRib29sLmg+CisjaW5jbHVkZSA8c3RyaW5n
Lmg+CisjaW5jbHVkZSA8ZXJybm8uaD4KKyNpbmNsdWRlIDxhc3NlcnQuaD4KKyNpbmNsdWRlIDx1
bmlzdGQuaD4KKyNpbmNsdWRlIDxlcnIuaD4KKyNpbmNsdWRlIDxwb2xsLmg+CisjaW5jbHVkZSA8
c3lzL3NvY2tldC5oPgorI2luY2x1ZGUgPG5ldGluZXQvaW4uaD4KKyNpbmNsdWRlIDxuZXRpbmV0
L3RjcC5oPgorI2luY2x1ZGUgPHN5cy9pb2N0bC5oPgorI2luY2x1ZGUgPHN5cy91aW8uaD4KKyNp
bmNsdWRlIDxnbGliLmg+CisjaW5jbHVkZSA8c2lnbmFsLmg+CisKKyNpbmNsdWRlICJ3ZWJzb2Nr
ZXQuaCIKKworLyoKK29uIGRhdGEgYXJyaXZlZCBvbiBzb2NrZXQ6CisgIHRyeSB0byByZWFkIGRh
dGEsIHJlYWQgYWdhaW4gdGlsbCBlcnJvciwgaGFuZGxlIGVycm9yLCBvbiBFQUdBSU4gcG9sbGlu
ZyBhZ2FpbgorICBxdWV1ZSByZWFkZWQgZGF0YSBmb3IgZWNobworCitvbiBkYXRhIHdyaXRhYmxl
IChpZiB3ZSBoYXZlIGRhdGEgdG8gd3JpdGUpOgorICB3cml0ZSBkYXRhCisKK3F1ZXN0aW9uLi4u
IHBpbmdzIGFyZSBoYW5kbGVkID8/CisKK2lmIGRhdGEgc2l6ZSA9PSAwIHdoZW4gd2UgcmVjZWl2
ZSB3ZSBtdXN0IHNlbmQgaXQKKworKi8KKworc3RhdGljIGludCBwb3J0ID0gNzc3NzsKK3N0YXRp
YyBnYm9vbGVhbiBub25fYmxvY2tpbmcgPSBmYWxzZTsKK3N0YXRpYyBnYm9vbGVhbiBkZWJ1ZyA9
IGZhbHNlOworc3RhdGljIHZvbGF0aWxlIGJvb2wgZ290X3Rlcm0gPSBmYWxzZTsKK3N0YXRpYyB1
bnNpZ25lZCBpbnQgbnVtX2Nvbm5lY3Rpb25zID0gMDsKKworc3RhdGljIEdPcHRpb25FbnRyeSBj
bWRfZW50cmllc1tdID0geworICB7InBvcnQiLCAncCcsIDAsIEdfT1BUSU9OX0FSR19JTlQsICZw
b3J0LAorICAgIkxvY2FsIHBvcnQgdG8gYmluZCB0byIsIE5VTEx9LAorICB7Im5vbi1ibG9ja2lu
ZyIsICduJywgMCwgR19PUFRJT05fQVJHX05PTkUsICZub25fYmxvY2tpbmcsCisgICAiRW5hYmxl
IG5vbi1ibG9ja2luZyBpL28iLCBOVUxMfSwKKyAgeyJkZWJ1ZyIsIDAsIDAsIEdfT1BUSU9OX0FS
R19OT05FLCAmZGVidWcsCisgICAiRW5hYmxlIGRlYnVnIG91dHB1dCIsIE5VTEx9LAorICB7TlVM
TH0KK307CisKK3N0YXRpYyB2b2lkIGhhbmRsZV9jbGllbnQoaW50IG5ld19zb2NrKTsKKworc3Rh
dGljIHZvaWQKK3NldF9ub25ibG9ja2luZyhpbnQgc29jaykKK3sKKyAgICAgICAgdW5zaWduZWQg
aW50IGlvY3RsX25vbmJsb2NraW5nID0gMTsKKworICAgICAgICBpZiAoaW9jdGwoc29jaywgRklP
TkJJTywgJmlvY3RsX25vbmJsb2NraW5nKSA8IDApIHsKKyAgICAgICAgICAgIGVycigxLCAiaW9j
dGwiKTsKKyAgICAgICAgfQorfQorCitzdGF0aWMgaW50Cit3YWl0X2ZvcihpbnQgc29jaywgc2hv
cnQgZXZlbnRzKQoreworICAgIHN0cnVjdCBwb2xsZmQgZmRzWzFdID0geyB7IHNvY2ssIGV2ZW50
cywgMCB9IH07CisgICAgZm9yICg7OykgeworICAgICAgICBzd2l0Y2ggKHBvbGwoZmRzLCAxLCAt
MSkpIHsKKyAgICAgICAgY2FzZSAtMToKKyAgICAgICAgICAgIGlmIChlcnJubyA9PSBFSU5UUikg
eworICAgICAgICAgICAgICAgIGlmIChnb3RfdGVybSkgeworICAgICAgICAgICAgICAgICAgICBw
cmludGYoImhhbmRsZWQgJXUgY29ubmVjdGlvbnNcbiIsIG51bV9jb25uZWN0aW9ucyk7CisgICAg
ICAgICAgICAgICAgICAgIGV4aXQoMCk7CisgICAgICAgICAgICAgICAgfQorICAgICAgICAgICAg
ICAgIGJyZWFrOworICAgICAgICAgICAgfQorICAgICAgICAgICAgZXJyKDEsICJwb2xsIik7Cisg
ICAgICAgICAgICBicmVhazsKKyAgICAgICAgY2FzZSAxOgorICAgICAgICAgICAgaWYgKChmZHMt
PnJldmVudHMgJiBldmVudHMpICE9IDApIHsKKyAgICAgICAgICAgICAgICByZXR1cm4gZmRzLT5y
ZXZlbnRzICYgZXZlbnRzOworICAgICAgICAgICAgfQorICAgICAgICAgICAgYnJlYWs7CisgICAg
ICAgIGNhc2UgMDoKKyAgICAgICAgICAgIGFzc2VydCgwKTsKKyAgICAgICAgfQorICAgIH0KK30K
Kworc3RhdGljIHNzaXplX3QKK3dzX3JlYWQodm9pZCAqb3BhcXVlLCB2b2lkICpidWYsIHNpemVf
dCBuYnl0ZSkKK3sKKyAgICBpbnQgc29jayA9IEdQT0lOVEVSX1RPX0lOVChvcGFxdWUpOworICAg
IHJldHVybiByZWN2KHNvY2ssIGJ1ZiwgbmJ5dGUsIE1TR19OT1NJR05BTCk7Cit9CisKK3N0YXRp
YyBzc2l6ZV90Cit3c193cml0ZSh2b2lkICpvcGFxdWUsIGNvbnN0IHZvaWQgKmJ1Ziwgc2l6ZV90
IG5ieXRlKQoreworICAgIGludCBzb2NrID0gR1BPSU5URVJfVE9fSU5UKG9wYXF1ZSk7CisgICAg
cmV0dXJuIHNlbmQoc29jaywgYnVmLCBuYnl0ZSwgTVNHX05PU0lHTkFMKTsKK30KKworc3RhdGlj
IHNzaXplX3QKK3dzX3dyaXRldih2b2lkICpvcGFxdWUsIHN0cnVjdCBpb3ZlYyAqaW92LCBpbnQg
aW92Y250KQoreworICAgIGludCBzb2NrID0gR1BPSU5URVJfVE9fSU5UKG9wYXF1ZSk7CisgICAg
cmV0dXJuIHdyaXRldihzb2NrLCBpb3YsIGlvdmNudCk7Cit9CisKK3N0YXRpYyB2b2lkCitnb19v
dXQoaW50IHNpZykKK3sKKyAgICBnb3RfdGVybSA9IHRydWU7Cit9CisKK2ludAorbWFpbihpbnQg
YXJnYywgY2hhciAqKmFyZ3YpCit7CisgICAgR0Vycm9yICplcnJvciA9IE5VTEw7CisgICAgR09w
dGlvbkNvbnRleHQgKmNvbnRleHQ7CisKKyAgICBjb250ZXh0ID0gZ19vcHRpb25fY29udGV4dF9u
ZXcoIiAtIFdlYnNvY2tldCB0ZXN0Iik7CisgICAgZ19vcHRpb25fY29udGV4dF9hZGRfbWFpbl9l
bnRyaWVzKGNvbnRleHQsIGNtZF9lbnRyaWVzLCBOVUxMKTsKKyAgICBpZiAoIWdfb3B0aW9uX2Nv
bnRleHRfcGFyc2UoY29udGV4dCwgJmFyZ2MsICZhcmd2LCAmZXJyb3IpKSB7CisgICAgICAgIGVy
cngoMSwgIiVzOiAlc1xuIiwgYXJndlswXSwgZXJyb3ItPm1lc3NhZ2UpOworICAgIH0KKworICAg
IGludCBzb2NrID0gc29ja2V0KEFGX0lORVQsIFNPQ0tfU1RSRUFNLCAwKTsKKyAgICBpZiAoc29j
ayA8IDApIHsKKyAgICAgICAgZXJyKDEsICJzb2NrZXQiKTsKKyAgICB9CisKKyAgICBpbnQgZW5h
YmxlID0gMTsKKyAgICBzZXRzb2Nrb3B0KHNvY2ssIFNPTF9TT0NLRVQsIFNPX1JFVVNFQUREUiwg
JmVuYWJsZSwgc2l6ZW9mKGVuYWJsZSkpOworCisgICAgaWYgKG5vbl9ibG9ja2luZykgeworICAg
ICAgICBzZXRfbm9uYmxvY2tpbmcoc29jayk7CisgICAgfQorCisgICAgc3RydWN0IHNvY2thZGRy
X2luIHNpbjsKKyAgICBtZW1zZXQoJnNpbiwgMCwgc2l6ZW9mKHNpbikpOworICAgIHNpbi5zaW5f
YWRkci5zX2FkZHIgPSBodG9ubChJTkFERFJfTE9PUEJBQ0spOworICAgIHNpbi5zaW5fcG9ydCA9
IGh0b25zKChzaG9ydCkgcG9ydCk7CisgICAgc2luLnNpbl9mYW1pbHkgPSBBRl9JTkVUOworCisg
ICAgaWYgKGJpbmQoc29jaywgKHN0cnVjdCBzb2NrYWRkciAqKSAmc2luLCBzaXplb2Yoc2luKSkg
PCAwKSB7CisgICAgICAgIGVycigxLCAiYmluZCIpOworICAgIH0KKworICAgIGlmIChsaXN0ZW4o
c29jaywgNSkgPCAwKSB7CisgICAgICAgIGVycigxLCAibGlzdGVuIik7CisgICAgfQorCisgICAg
c2lnbmFsKFNJR1RFUk0sIGdvX291dCk7CisgICAgc2lnbmFsKFNJR0lOVCwgZ29fb3V0KTsKKwor
ICAgIHdoaWxlICghZ290X3Rlcm0pIHsKKyAgICAgICAgd2FpdF9mb3Ioc29jaywgUE9MTElOKTsK
KworICAgICAgICBzb2NrbGVuX3Qgc29ja19sZW4gPSBzaXplb2Yoc2luKTsKKyAgICAgICAgaW50
IG5ld19zb2NrID0gYWNjZXB0KHNvY2ssIChzdHJ1Y3Qgc29ja2FkZHIgKikgJnNpbiwgJnNvY2tf
bGVuKTsKKyAgICAgICAgaWYgKGdvdF90ZXJtKSB7CisgICAgICAgICAgICBicmVhazsKKyAgICAg
ICAgfQorICAgICAgICBpZiAobmV3X3NvY2sgPCAwKSB7CisgICAgICAgICAgICBlcnIoMSwgImFj
Y2VwdCIpOworICAgICAgICB9CisKKyAgICAgICAgKytudW1fY29ubmVjdGlvbnM7CisgICAgICAg
IGhhbmRsZV9jbGllbnQobmV3X3NvY2spOworCisgICAgICAgIGNsb3NlKG5ld19zb2NrKTsKKyAg
ICB9CisKKyAgICBjbG9zZShzb2NrKTsKKyAgICBwcmludGYoImhhbmRsZWQgJXUgY29ubmVjdGlv
bnNcbiIsIG51bV9jb25uZWN0aW9ucyk7CisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lk
CitoYW5kbGVfY2xpZW50KGludCBuZXdfc29jaykKK3sKKyAgICBpZiAobm9uX2Jsb2NraW5nKSB7
CisgICAgICAgIHNldF9ub25ibG9ja2luZyhuZXdfc29jayk7CisgICAgfQorCisgICAgaW50IGVu
YWJsZSA9IDE7CisgICAgc2V0c29ja29wdChuZXdfc29jaywgU09MX1RDUCwgVENQX05PREVMQVks
IChjb25zdCB2b2lkICopICZlbmFibGUsIHNpemVvZihlbmFibGUpKTsKKworICAgIC8vIHdhaXQg
aGVhZGVyCisgICAgd2FpdF9mb3IobmV3X3NvY2ssIFBPTExJTik7CisKKyAgICBSZWRzV2ViU29j
a2V0ICp3cyA9IHdlYnNvY2tldF9uZXcoIiIsIDAsIEdJTlRfVE9fUE9JTlRFUihuZXdfc29jayks
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdzX3JlYWQsIHdzX3dyaXRl
LCB3c193cml0ZXYpOworICAgIGFzc2VydCh3cyk7CisKKyAgICBjaGFyIGJ1ZmZlcls0MDk2XTsK
KyAgICBzaXplX3QgdG9fc2VuZCA9IDA7CisgICAgd2hpbGUgKCFnb3RfdGVybSkgeworICAgICAg
ICBpbnQgZXZlbnRzID0gMDsKKyAgICAgICAgaWYgKHNpemVvZihidWZmZXIpID4gdG9fc2VuZCkg
eworICAgICAgICAgICAgZXZlbnRzIHw9IFBPTExJTjsKKyAgICAgICAgfQorICAgICAgICBpZiAo
dG9fc2VuZCkgeworICAgICAgICAgICAgZXZlbnRzIHw9IFBPTExPVVQ7CisgICAgICAgIH0KKyAg
ICAgICAgZXZlbnRzID0gd2FpdF9mb3IobmV3X3NvY2ssIGV2ZW50cyk7CisgICAgICAgIGlmIChl
dmVudHMgJiBQT0xMSU4pIHsKKyAgICAgICAgICAgIGFzc2VydChzaXplb2YoYnVmZmVyKSA+IHRv
X3NlbmQpOworICAgICAgICAgICAgaW50IHNpemUgPSB3ZWJzb2NrZXRfcmVhZCh3cywgKHZvaWQg
KikgKGJ1ZmZlciArIHRvX3NlbmQpLCBzaXplb2YoYnVmZmVyKSAtIHRvX3NlbmQpOworCisgICAg
ICAgICAgICBpZiAoc2l6ZSA8IDApIHsKKyAgICAgICAgICAgICAgICBpZiAoZXJybm8gPT0gRUlP
KSB7CisgICAgICAgICAgICAgICAgICAgIGJyZWFrOworICAgICAgICAgICAgICAgIH0KKyAgICAg
ICAgICAgICAgICBpZiAoZXJybm8gPT0gRUFHQUlOKSB7CisgICAgICAgICAgICAgICAgICAgIGNv
bnRpbnVlOworICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAgICAgICBlcnIoMSwgInJlY3Yi
KTsKKyAgICAgICAgICAgIH0KKworICAgICAgICAgICAgaWYgKHNpemUgPT0gMCkgeworICAgICAg
ICAgICAgICAgIGJyZWFrOworICAgICAgICAgICAgfQorCisgICAgICAgICAgICBpZiAoZGVidWcp
IHsKKyAgICAgICAgICAgICAgICBwcmludGYoInJlY2VpdmVkICVkIGJ5dGVzIG9mIGRhdGFcbiIs
IHNpemUpOworICAgICAgICAgICAgfQorICAgICAgICAgICAgdG9fc2VuZCArPSBzaXplOworICAg
ICAgICB9CisKKyAgICAgICAgaWYgKGV2ZW50cyAmIFBPTExPVVQpIHsKKyAgICAgICAgICAgIGlu
dCBzaXplID0gd2Vic29ja2V0X3dyaXRlKHdzLCBidWZmZXIsIHRvX3NlbmQpOworCisgICAgICAg
ICAgICBpZiAoc2l6ZSA8IDApIHsKKyAgICAgICAgICAgICAgICBzd2l0Y2ggKGVycm5vKSB7Cisg
ICAgICAgICAgICAgICAgY2FzZSBFQUdBSU46CisgICAgICAgICAgICAgICAgY2FzZSBFSU5UUjoK
KyAgICAgICAgICAgICAgICAgICAgY29udGludWU7CisgICAgICAgICAgICAgICAgY2FzZSBFQ09O
TlJFU0VUOgorICAgICAgICAgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICAgICAgICBkZWZh
dWx0OgorICAgICAgICAgICAgICAgICAgICBlcnIoMSwgInNlbmQiKTsKKyAgICAgICAgICAgICAg
ICB9CisgICAgICAgICAgICAgICAgYnJlYWs7CisgICAgICAgICAgICB9CisKKyAgICAgICAgICAg
IGlmIChkZWJ1ZykgeworICAgICAgICAgICAgICAgIHByaW50Zigic2VudCAlZCBieXRlcyBvZiBk
YXRhXG4iLCBzaXplKTsKKyAgICAgICAgICAgIH0KKworICAgICAgICAgICAgaWYgKHNpemUgPT0g
MCkgeworICAgICAgICAgICAgICAgIGVycngoMSwgIlVuZXhwZWN0ZWQgc2hvcnQgd3JpdGVcbiIp
OworICAgICAgICAgICAgfQorCisgICAgICAgICAgICB0b19zZW5kIC09IHNpemU7CisgICAgICAg
ICAgICBtZW1tb3ZlKGJ1ZmZlciwgYnVmZmVyICsgc2l6ZSwgdG9fc2VuZCk7CisgICAgICAgIH0K
KyAgICB9CisKKyAgICB3ZWJzb2NrZXRfZnJlZSh3cyk7CisKKyAgICBpZiAoZGVidWcpIHsKKyAg
ICAgICAgcHJpbnRmKCJjb25uZWN0aW9uIGNsb3NlZFxuIik7CisgICAgfQorfQotLSAKMi4yMC4x
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpTcGljZS1k
ZXZlbCBtYWlsaW5nIGxpc3QKU3BpY2UtZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vc3BpY2UtZGV2ZWw=
