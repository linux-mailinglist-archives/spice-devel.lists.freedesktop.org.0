Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id DA9A2A130E
	for <lists+spice-devel@lfdr.de>; Thu, 29 Aug 2019 09:56:55 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7515789FD1;
	Thu, 29 Aug 2019 07:56:54 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0A05D89FD1
 for <spice-devel@lists.freedesktop.org>; Thu, 29 Aug 2019 07:56:53 +0000 (UTC)
Received: from mail-ot1-f71.google.com (mail-ot1-f71.google.com
 [209.85.210.71])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 7A15F3B3C0
 for <spice-devel@lists.freedesktop.org>; Thu, 29 Aug 2019 07:56:52 +0000 (UTC)
Received: by mail-ot1-f71.google.com with SMTP id 88so1267104otc.19
 for <spice-devel@lists.freedesktop.org>; Thu, 29 Aug 2019 00:56:52 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc;
 bh=s1T+KI2U4HZ5+0RRYaUHZx3JRRn9LM2EPVCNz0ZQ5Pc=;
 b=Kk+NN5Mdh3+eg4/2Xd3TziNjW2+/304QGzoYYUc4gjAO45qw/dYbp9kfiXuspywId+
 AC4L0GTe+BTQyPSf6rcYbC5ucQwbk7hPw4yT7HVf5cxKi399r6ZqoaIwFnvSf877wJ/i
 JLLKwkBRryZ8i4G2vyhMiEmNzVVelIUfMuKF/GASmLlrS4riL8XA3J1yCyGunffLH9wH
 U4QGZXM54hGZJtatZXGFWApOMHxFdnX7ZxRYErDgYGvTmICbQxCcfc7icsX/NQ2jbnT6
 nsa2wkDQ/V+f3U+iMtdzAh3ejfQteL/q3OtUl2j+llYX6Wp8Vm7OjoWdMVFcUnj/qgMg
 9vFw==
X-Gm-Message-State: APjAAAVsZNKn9idDCJKbG7YkawDmD45rCR+7hZJSuCJkOvVDl3oul5SU
 IiGAr5gts/4xVRRMY7H/Xe0RreCHhYiwsRK5HKFVfWZ4FaxQlOMHHL3Kidh2W+NP4YJL5wACPlC
 YO/Uo5wyqfMGekyO1Y4GbY/7OXeqGz1WN/vnk2PYg0ynQf7w=
X-Received: by 2002:a9d:69d5:: with SMTP id v21mr6260281oto.279.1567065411643; 
 Thu, 29 Aug 2019 00:56:51 -0700 (PDT)
X-Google-Smtp-Source: APXvYqzhHeBssMAZ9w2DvBDINmacCZ2E86Wcte5rIZQ/bs7XO+dequpB4aNktw5xbP2loQ3VIvZIxtJ7FlatWr9iYKk=
X-Received: by 2002:a9d:69d5:: with SMTP id v21mr6260267oto.279.1567065411430; 
 Thu, 29 Aug 2019 00:56:51 -0700 (PDT)
MIME-Version: 1.0
References: <20190806153453.20616-1-kpouget@redhat.com>
 <20190806153453.20616-2-kpouget@redhat.com>
 <829772421.5808891.1565788131423.JavaMail.zimbra@redhat.com>
In-Reply-To: <829772421.5808891.1565788131423.JavaMail.zimbra@redhat.com>
From: Kevin Pouget <kpouget@redhat.com>
Date: Thu, 29 Aug 2019 09:56:40 +0200
Message-ID: <CADJ1XR3Djisfg8jo7th0ZfxDgLDdPFS_uHkt5BcRGSZqnOTF+A@mail.gmail.com>
To: Frediano Ziglio <fziglio@redhat.com>
Subject: Re: [Spice-devel] [RFC spice-server 1/3] stream-channel: Add
 preferred video codec capability
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Spice devel <spice-devel@lists.freedesktop.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

SGVsbG8sCgpPbiBXZWQsIEF1ZyAxNCwgMjAxOSBhdCAzOjA4IFBNIEZyZWRpYW5vIFppZ2xpbyA8
ZnppZ2xpb0ByZWRoYXQuY29tPiB3cm90ZToKPgo+ID4KPiA+IFRoaXMgcGF0Y2ggZW5hYmxlcyB0
aGUgU1BJQ0VfRElTUExBWV9DQVBfUFJFRl9WSURFT19DT0RFQ19UWVBFCj4gPiBjYXBhYmlsaXR5
IGZvciB0aGUgc3RyZWFtLWNoYW5uZWwuCj4gPgo+ID4gdmlkZW9fc3RyZWFtX3BhcnNlX3ByZWZl
cnJlZF9jb2RlY3M6IG5ldyBmdW5jdGlvbiBmb3IgcGFyc2luZyB0aGUKPiA+IFNQSUNFIHByb3Rv
Y29sIG1lc3NhZ2UuIFRoaXMgY29kZSB1c2VkIHRvIGJlIGluc2lkZQo+ID4gZGNjX2hhbmRsZV9w
cmVmZXJyZWRfdmlkZW9fY29kZWNfdHlwZS4KPiA+Cj4gPiBzdHJ1Y3QgU3RyZWFtQ2hhbm5lbENs
aWVudDo6Y2xpZW50X3ByZWZlcnJlZF92aWRlb19jb2RlY3M6IG5ldyBmaWVsZC4KPiA+Cj4gPiBT
aWduZWQtb2ZmLWJ5OiBLZXZpbiBQb3VnZXQgPGtwb3VnZXRAcmVkaGF0LmNvbT4KPiA+IC0tLQo+
ID4gIHNlcnZlci9kY2MuYyAgICAgICAgICAgIHwgMzAgKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tCj4gPiAgc2VydmVyL3N0cmVhbS1jaGFubmVsLmMgfCA0MCArKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrCj4gPiAgc2VydmVyL3ZpZGVvLXN0cmVhbS5jICAgfCAz
NiArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKPiA+ICBzZXJ2ZXIvdmlkZW8t
c3RyZWFtLmggICB8ICAxICsKPiA+ICA0IGZpbGVzIGNoYW5nZWQsIDc4IGluc2VydGlvbnMoKyks
IDI5IGRlbGV0aW9ucygtKQo+ID4KPiA+IGRpZmYgLS1naXQgYS9zZXJ2ZXIvZGNjLmMgYi9zZXJ2
ZXIvZGNjLmMKPiA+IGluZGV4IDIxZTg1OThlLi41MzhmMWY1MSAxMDA2NDQKPiA+IC0tLSBhL3Nl
cnZlci9kY2MuYwo+ID4gKysrIGIvc2VydmVyL2RjYy5jCj4gPiBAQCAtMTE1OCwzOCArMTE1OCwx
MCBAQCBzdGF0aWMgdm9pZCBvbl9kaXNwbGF5X3ZpZGVvX2NvZGVjc191cGRhdGUoR09iamVjdAo+
ID4gKmdvYmplY3QsIEdQYXJhbVNwZWMgKnBzcGVjLAo+ID4gIHN0YXRpYyBpbnQgZGNjX2hhbmRs
ZV9wcmVmZXJyZWRfdmlkZW9fY29kZWNfdHlwZShEaXNwbGF5Q2hhbm5lbENsaWVudCAqZGNjLAo+
ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGlj
ZU1zZ2NEaXNwbGF5UHJlZmVycmVkVmlkZW9Db2RlY1R5cGUKPiA+ICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKm1zZykKPiA+ICB7Cj4gPiAtICAgIGdp
bnQgaSwgbGVuOwo+ID4gLSAgICBnaW50IGluZGV4ZXNbU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9F
TlVNX0VORF07Cj4gPiAtICAgIEdBcnJheSAqY2xpZW50Owo+ID4gLQo+ID4gICAgICBnX3JldHVy
bl92YWxfaWZfZmFpbChtc2ctPm51bV9vZl9jb2RlY3MgPiAwLCBUUlVFKTsKPiA+Cj4gPiAtICAg
IC8qIHNldCBkZWZhdWx0IHRvIGEgYmlnIGFuZCBwb3NpdGl2ZSBudW1iZXIgKi8KPiA+IC0gICAg
bWVtc2V0KGluZGV4ZXMsIDB4N2YsIHNpemVvZihpbmRleGVzKSk7Cj4gPiAtCj4gPiAtICAgIGZv
ciAobGVuID0gMCwgaSA9IDA7IGkgPCBtc2ctPm51bV9vZl9jb2RlY3M7IGkrKykgewo+ID4gLSAg
ICAgICAgZ2ludCB2aWRlb19jb2RlYyA9IG1zZy0+Y29kZWNzW2ldOwo+ID4gLQo+ID4gLSAgICAg
ICAgaWYgKHZpZGVvX2NvZGVjIDwgU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9NSlBFRyB8fAo+ID4g
LSAgICAgICAgICAgIHZpZGVvX2NvZGVjID49IFNQSUNFX1ZJREVPX0NPREVDX1RZUEVfRU5VTV9F
TkQpIHsKPiA+IC0gICAgICAgICAgICBzcGljZV9kZWJ1ZygiQ2xpZW50IGhhcyBzZW50IHVua25v
d24gdmlkZW8tY29kZWMgKHZhbHVlICVkIGF0Cj4gPiBpbmRleCAlZCkuICIKPiA+IC0gICAgICAg
ICAgICAgICAgICAgICAgICAiSWdub3JpbmcgYXMgc2VydmVyIGNhbid0IGhhbmRsZSBpdCIsCj4g
PiAtICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvX2NvZGVjLCBpKTsKPiA+IC0gICAgICAg
ICAgICBjb250aW51ZTsKPiA+IC0gICAgICAgIH0KPiA+IC0KPiA+IC0gICAgICAgIGlmIChpbmRl
eGVzW3ZpZGVvX2NvZGVjXSA8IFNQSUNFX1ZJREVPX0NPREVDX1RZUEVfRU5VTV9FTkQpIHsKPiA+
IC0gICAgICAgICAgICBjb250aW51ZTsKPiA+IC0gICAgICAgIH0KPiA+IC0KPiA+IC0gICAgICAg
IGxlbisrOwo+ID4gLSAgICAgICAgaW5kZXhlc1t2aWRlb19jb2RlY10gPSBsZW47Cj4gPiAtICAg
IH0KPiA+IC0gICAgY2xpZW50ID0gZ19hcnJheV9zaXplZF9uZXcoRkFMU0UsIEZBTFNFLCBzaXpl
b2YoZ2ludCksCj4gPiBTUElDRV9WSURFT19DT0RFQ19UWVBFX0VOVU1fRU5EKTsKPiA+IC0gICAg
Z19hcnJheV9hcHBlbmRfdmFscyhjbGllbnQsIGluZGV4ZXMsIFNQSUNFX1ZJREVPX0NPREVDX1RZ
UEVfRU5VTV9FTkQpOwo+ID4gLQo+ID4gICAgICBnX2NsZWFyX3BvaW50ZXIoJmRjYy0+cHJpdi0+
Y2xpZW50X3ByZWZlcnJlZF92aWRlb19jb2RlY3MsCj4gPiAgICAgIGdfYXJyYXlfdW5yZWYpOwo+
ID4gLSAgICBkY2MtPnByaXYtPmNsaWVudF9wcmVmZXJyZWRfdmlkZW9fY29kZWNzID0gY2xpZW50
Owo+ID4gKyAgICBkY2MtPnByaXYtPmNsaWVudF9wcmVmZXJyZWRfdmlkZW9fY29kZWNzID0KPiA+
IHZpZGVvX3N0cmVhbV9wYXJzZV9wcmVmZXJyZWRfY29kZWNzKG1zZyk7Cj4gPgo+ID4gICAgICAv
KiBOZXcgY2xpZW50IHByZWZlcmVuY2UgKi8KPiA+ICAgICAgZGNjX3VwZGF0ZV9wcmVmZXJyZWRf
dmlkZW9fY29kZWNzKGRjYyk7Cj4gPiBkaWZmIC0tZ2l0IGEvc2VydmVyL3N0cmVhbS1jaGFubmVs
LmMgYi9zZXJ2ZXIvc3RyZWFtLWNoYW5uZWwuYwo+ID4gaW5kZXggNzk1MzAxOGUuLmZhNDgwNGYx
IDEwMDY0NAo+ID4gLS0tIGEvc2VydmVyL3N0cmVhbS1jaGFubmVsLmMKPiA+ICsrKyBiL3NlcnZl
ci9zdHJlYW0tY2hhbm5lbC5jCj4gPiBAQCAtMjIsNiArMjIsNyBAQAo+ID4gICNpbmNsdWRlIDxz
cGljZS9zdHJlYW0tZGV2aWNlLmg+Cj4gPgo+ID4gICNpbmNsdWRlICJyZWQtY2hhbm5lbC1jbGll
bnQuaCIKPiA+ICsjaW5jbHVkZSAicmVkLWNsaWVudC5oIgo+Cj4gV2h5IHJlZC1jbGllbnQgPz8g
U2hvdWxkIG5vdCBiZSB2aWRlby1zdHJlYW0uaCA/Cgp0aGlzIGluY2x1ZGUgYWxsb3dzIG1lIHRv
IGNvbnZlcnQgdGhpcyAicmVkcyA9IHJlZF9jbGllbnRfZ2V0X3NlcnZlcihjbGllbnQpIgoKPiBz
dHJlYW1fY2hhbm5lbF9oYW5kbGVfcHJlZmVycmVkX3ZpZGVvX2NvZGVjX3R5cGUoUmVkQ2hhbm5l
bENsaWVudCAqcmNjLCAuLi4pIHsKPiAgICBSZWRDbGllbnQgKmNsaWVudCA9IHJlZF9jaGFubmVs
X2NsaWVudF9nZXRfY2xpZW50KHJjYyk7Cj4gICAgUmVkc1N0YXRlICpyZWRzID0gcmVkX2NsaWVu
dF9nZXRfc2VydmVyKGNsaWVudCk7Cj4gICAgbWFpbl9kaXNwYXRjaGVyX3Jlc2V0X3N0cmVhbV9j
aGFubmVsKHJlZHNfZ2V0X21haW5fZGlzcGF0Y2hlcihyZWRzKSwgY2hhbm5lbF9pZCk7Cgo+ID4g
ICNpbmNsdWRlICJzdHJlYW0tY2hhbm5lbC5oIgo+ID4gICNpbmNsdWRlICJyZWRzLmgiCj4gPiAg
I2luY2x1ZGUgImNvbW1vbi1ncmFwaGljcy1jaGFubmVsLmgiCj4gPiBAQCAtNTIsNiArNTMsOSBA
QCBzdHJ1Y3QgU3RyZWFtQ2hhbm5lbENsaWVudCB7Cj4gPiAgICAgIC8qIGN1cnJlbnQgdmlkZW8g
c3RyZWFtIGlkLCA8MCBpZiBub3QgaW5pdGlhbGl6ZWQgb3IKPiA+ICAgICAgICogd2UgYXJlIG5v
dCBzZW5kaW5nIGEgc3RyZWFtICovCj4gPiAgICAgIGludCBzdHJlYW1faWQ7Cj4gPiArICAgIC8q
IEFycmF5IHdpdGggU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9FTlVNX0VORCBlbGVtZW50cywgd2l0
aCB0aGUgY2xpZW50Cj4gPiArICAgICAqIHByZWZlcmVuY2Ugb3JkZXIgKGluZGV4KSBhcyB2YWx1
ZSAqLwo+ID4gKyAgICBHQXJyYXkgKmNsaWVudF9wcmVmZXJyZWRfdmlkZW9fY29kZWNzOwo+Cj4g
SSB0aGluayB0aGF0IGN1cnJlbnRseSBhIHN0YXRpYyBhcnJheSB0YWtlcyBsZXNzIHNwYWNlLCBi
dXQgaXQncyBqdXN0IG15Cj4gcGFyYW5vaWEuCgp5b3UgbWVhbiB0byBjaGFuZ2UgdGhlIHR5cGUg
dG8gIlNwaWNlVmlkZW9Db2RlY1R5cGUKX19uYW1lX19bU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9F
TlVNX0VORF0iPwp5ZXMsIGNvdWxkIGJlLCBidXQgSSB0aGluayB3aGF0IGV2ZXIgd2UgY2hhbmdl
IG9uIHRoaXMgc2lkZSwgd2Ugc2hvdWxkCmNoYW5nZSBpdCBvbiBob3N0LWVuY29kaW5nIHNpZGUs
IGZvciBjb25zaXN0ZW5jeS4KSSdtIG5vdCBzdXJlIGl0J3Mgd29ydGggdGhlIGVmZm9ydCBmb3Ig
c2F2aW5nIGEgZmV3IGJ5dGVzIG9mIGdsaWIgd3JhcHBlcj8KCj4gPiAgfTsKPiA+Cj4gPiAgc3Ry
dWN0IFN0cmVhbUNoYW5uZWxDbGllbnRDbGFzcyB7Cj4gPiBAQCAtMTE0LDYgKzExOCw4IEBAIHR5
cGVkZWYgc3RydWN0IFN0cmVhbURhdGFJdGVtIHsKPiA+ICAjZGVmaW5lIFBSSU1BUllfU1VSRkFD
RV9JRCAwCj4gPgo+ID4gIHN0YXRpYyB2b2lkIHN0cmVhbV9jaGFubmVsX2NsaWVudF9vbl9kaXNj
b25uZWN0KFJlZENoYW5uZWxDbGllbnQgKnJjYyk7Cj4gPiArc3RhdGljIGJvb2wKPiA+IHN0cmVh
bV9jaGFubmVsX2hhbmRsZV9wcmVmZXJyZWRfdmlkZW9fY29kZWNfdHlwZShSZWRDaGFubmVsQ2xp
ZW50ICpyY2MsCj4gPiArCj4gPiBTcGljZU1zZ2NEaXNwbGF5UHJlZmVycmVkVmlkZW9Db2RlY1R5
cGUKPiA+ICptc2cpOwo+ID4KPgo+IE1pbm9yOiBOb3QgY29ycmVjdGx5IGluZGVudGVkCgp0aGlz
IHdhcyBvbiBwdXJwb3NlLCBhcyB0aGUgImNvcnJlY3QiIGFsaWdubWVudCBvZiAnbXNnJyB3b3Vs
ZCBnbyA+IDEwMGNoYXJzCkkgcHV0IGEgbmV3IGxpbmUgYmV0d2VlbiAiPHJldHVybiB0eXBlPiA8
ZnVuY3Rpb24gbmFtZT4iCgo+ID4gIFJFQ09SREVSKHN0cmVhbV9jaGFubmVsX2RhdGEsIDMyLCAi
U3RyZWFtIGNoYW5uZWwgZGF0YSBwYWNrZXQiKTsKPiA+Cj4gPiBAQCAtMzI0LDYgKzMzMCwxMCBA
QCBoYW5kbGVfbWVzc2FnZShSZWRDaGFubmVsQ2xpZW50ICpyY2MsIHVpbnQxNl90IHR5cGUsCj4g
PiB1aW50MzJfdCBzaXplLCB2b2lkICptc2cpCj4gPiAgICAgIGNhc2UgU1BJQ0VfTVNHQ19ESVNQ
TEFZX0dMX0RSQVdfRE9ORToKPiA+ICAgICAgICAgIC8qIGNsaWVudCBzaG91bGQgbm90IHNlbmQg
dGhpcyBtZXNzYWdlICovCj4gPiAgICAgICAgICByZXR1cm4gZmFsc2U7Cj4gPiArICAgIGNhc2Ug
U1BJQ0VfTVNHQ19ESVNQTEFZX1BSRUZFUlJFRF9WSURFT19DT0RFQ19UWVBFOgo+ID4gKyAgICAg
ICAgcmV0dXJuIHN0cmVhbV9jaGFubmVsX2hhbmRsZV9wcmVmZXJyZWRfdmlkZW9fY29kZWNfdHlw
ZShyY2MsCj4gPiArICAgICAgICAgICAgKFNwaWNlTXNnY0Rpc3BsYXlQcmVmZXJyZWRWaWRlb0Nv
ZGVjVHlwZSAqKW1zZyk7Cj4gPiArICAgICAgICByZXR1cm4gZmFsc2U7Cj4KPiBTZWNvbmQgcmV0
dXJuIGFmdGVyIGEgcmV0dXJuIGlzIG5vdCBtdWNoIHVzZWZ1bCwgc29tZSBjb2RlIGFuYWx5c2Vy
cwo+IGNvdWxkIGFsc28gY29tcGxhaW4gYWJvdXQgaXQuCgp5ZXMsIHRoaXMgaXMgZnVsbHkgdXNl
bGVzcywgSSBjYW5jZWxsZWQgdGhlIHNlY29uZCByZXR1cm4KCj4gPiAgICAgIGRlZmF1bHQ6Cj4g
PiAgICAgICAgICByZXR1cm4gcmVkX2NoYW5uZWxfY2xpZW50X2hhbmRsZV9tZXNzYWdlKHJjYywg
dHlwZSwgc2l6ZSwgbXNnKTsKPiA+ICAgICAgfQo+ID4gQEAgLTM5MCw2ICs0MDAsMjAgQEAgc3Ry
ZWFtX2NoYW5uZWxfZ2V0X3N1cHBvcnRlZF9jb2RlY3MoU3RyZWFtQ2hhbm5lbAo+ID4gKmNoYW5u
ZWwsIHVpbnQ4X3QgKm91dF9jb2RlY3MpCj4gPiAgICAgIHJldHVybiBudW07Cj4gPiAgfQo+ID4K
PiA+ICtzdGF0aWMgYm9vbAo+ID4gK3N0cmVhbV9jaGFubmVsX2hhbmRsZV9wcmVmZXJyZWRfdmlk
ZW9fY29kZWNfdHlwZShSZWRDaGFubmVsQ2xpZW50ICpyY2MsCj4gPiArCj4gPiBTcGljZU1zZ2NE
aXNwbGF5UHJlZmVycmVkVmlkZW9Db2RlY1R5cGUKPiA+ICptc2cpCj4gPiArewo+ID4gKyAgICBT
dHJlYW1DaGFubmVsQ2xpZW50ICpzY2MgPSBTVFJFQU1fQ0hBTk5FTF9DTElFTlQocmNjKTsKPiA+
ICsKPiA+ICsgICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwobXNnLT5udW1fb2ZfY29kZWNzID4gMCwg
VFJVRSk7Cj4KPiBJIGtub3cgaXQncyBub3QgYSByZWdyZXNzaW9uLCBidXQgZG9jdW1lbnQgZm9y
IGdfcmV0dXJuX3ZhbF9pZl9mYWlsIHN0YXRlcwo+ICJWZXJpZmllcyB0aGF0IHRoZSBleHByZXNz
aW9uIGV4cHIgLCB1c3VhbGx5IHJlcHJlc2VudGluZyBhIHByZWNvbmRpdGlvbiwgZXZhbHVhdGVz
IHRvIFRSVUUiCj4gYnV0IHRoaXMgaXMgbm90IGEgcHJlY29uZGl0aW9uLCB0aGlzIGlzIGNoZWNr
aW5nIGEgdmFsdWUgZnJvbSBuZXR3b3JrLgoKSSBkb24ndCBrbm93LCBpdCBhY3R1YWxseSBsb29r
cyBsaWtlIGEgcHJlY29uZGl0aW9uIHRvIG1lLCBldmVuIGlmCml0J3MgYSBSUEMgY2FsbC4KYnV0
IHRoZSB0eXBlIG9mIG51bV9vZl9jb2RlY3MgaXMgdWludDhfdCwgc28gPj0wLgoKSSBjYW4gcmVw
bGFjZSB0aGlzIHdpdGgKPiBpZiAobXNnLT5udW1fb2ZfY29kZWNzID09IDApIHsKPiAgICAgcmV0
dXJuIHRydWU7Cj4gfQoKPiA+ICsKPiA+ICsgICAgZ19jbGVhcl9wb2ludGVyKCZzY2MtPmNsaWVu
dF9wcmVmZXJyZWRfdmlkZW9fY29kZWNzLCBnX2FycmF5X3VucmVmKTsKPiA+ICsgICAgc2NjLT5j
bGllbnRfcHJlZmVycmVkX3ZpZGVvX2NvZGVjcyA9Cj4gPiB2aWRlb19zdHJlYW1fcGFyc2VfcHJl
ZmVycmVkX2NvZGVjcyhtc2cpOwo+ID4gKwo+ID4gKyAgICByZXR1cm4gVFJVRTsKPgo+IEkgd291
bGQgdXNlIHRydWUvZmFsc2Ugd2l0aCBib29sCgpzdXJlCgo+ID4gK30KPiA+ICsKPiA+ICBzdGF0
aWMgdm9pZAo+ID4gIHN0cmVhbV9jaGFubmVsX2Nvbm5lY3QoUmVkQ2hhbm5lbCAqcmVkX2NoYW5u
ZWwsIFJlZENsaWVudCAqcmVkX2NsaWVudCwKPiA+ICBSZWRTdHJlYW0gKnN0cmVhbSwKPiA+ICAg
ICAgICAgICAgICAgICAgICAgICAgIGludCBtaWdyYXRpb24sIFJlZENoYW5uZWxDYXBhYmlsaXRp
ZXMgKmNhcHMpCj4gPiBAQCAtNDQ4LDEwICs0NzIsMjUgQEAgc3RyZWFtX2NoYW5uZWxfY29uc3Ry
dWN0ZWQoR09iamVjdCAqb2JqZWN0KQo+ID4KPiA+ICAgICAgcmVkX2NoYW5uZWxfc2V0X2NhcChy
ZWRfY2hhbm5lbCwgU1BJQ0VfRElTUExBWV9DQVBfTU9OSVRPUlNfQ09ORklHKTsKPiA+ICAgICAg
cmVkX2NoYW5uZWxfc2V0X2NhcChyZWRfY2hhbm5lbCwgU1BJQ0VfRElTUExBWV9DQVBfU1RSRUFN
X1JFUE9SVCk7Cj4gPiArICAgIHJlZF9jaGFubmVsX3NldF9jYXAocmVkX2NoYW5uZWwsCj4gPiBT
UElDRV9ESVNQTEFZX0NBUF9QUkVGX1ZJREVPX0NPREVDX1RZUEUpOwo+ID4KPiA+ICAgICAgcmVk
c19yZWdpc3Rlcl9jaGFubmVsKHJlZHMsIHJlZF9jaGFubmVsKTsKPiA+ICB9Cj4gPgo+ID4gK3N0
YXRpYyB2b2lkCj4gPiArc3RyZWFtX2NoYW5uZWxfZmluYWxpemUoR09iamVjdCAqb2JqZWN0KQo+
ID4gK3sKPiA+ICsgICAgU3RyZWFtQ2hhbm5lbCAqc2VsZiA9IFNUUkVBTV9DSEFOTkVMKG9iamVj
dCk7Cj4gPiArICAgIFJlZENoYW5uZWxDbGllbnQgKnJjYzsKPiA+ICsKPiA+ICsgICAgRk9SRUFD
SF9DTElFTlQoc2VsZiwgcmNjKSB7Cj4gPiArICAgICAgICBTdHJlYW1DaGFubmVsQ2xpZW50ICpz
Y2MgPSBTVFJFQU1fQ0hBTk5FTF9DTElFTlQocmNjKTsKPiA+ICsgICAgICAgIGdfY2xlYXJfcG9p
bnRlcigmc2NjLT5jbGllbnRfcHJlZmVycmVkX3ZpZGVvX2NvZGVjcywgZ19hcnJheV91bnJlZik7
Cj4gPiArICAgIH0KPgo+IEVhY2ggb2JqZWN0IHNob3VsZCBmcmVlIGl0c2VsZiwgdGhpcyBzaG91
bGQgYmUgaW4KPiBzdHJlYW1fY2hhbm5lbF9jbGllbnRfZmluYWxpemUsIG90aGVyd2lzZSBjb2Rl
IHdpbGwgbGVhayB3aGVuIGNsaWVudCBkaXNjb25uZWN0cy4KCkkgc2VlLCBJIGNvbmZ1c2VkIG15
c2VsZiB3aXRoIHRoZSBjaGFubmVsX2NsYXNzIHZzIGNoYW5uZWxfY2xpZW50X2NsYXNzLgpGaXhl
ZCBub3cKCj4gPiArCj4gPiArICAgIEdfT0JKRUNUX0NMQVNTKHN0cmVhbV9jaGFubmVsX3BhcmVu
dF9jbGFzcyktPmZpbmFsaXplKG9iamVjdCk7Cj4gPiArfQo+ID4gKwo+ID4gIHN0YXRpYyB2b2lk
Cj4gPiAgc3RyZWFtX2NoYW5uZWxfY2xhc3NfaW5pdChTdHJlYW1DaGFubmVsQ2xhc3MgKmtsYXNz
KQo+ID4gIHsKPiA+IEBAIC00NTksNiArNDk4LDcgQEAgc3RyZWFtX2NoYW5uZWxfY2xhc3NfaW5p
dChTdHJlYW1DaGFubmVsQ2xhc3MgKmtsYXNzKQo+ID4gICAgICBSZWRDaGFubmVsQ2xhc3MgKmNo
YW5uZWxfY2xhc3MgPSBSRURfQ0hBTk5FTF9DTEFTUyhrbGFzcyk7Cj4gPgo+ID4gICAgICBvYmpl
Y3RfY2xhc3MtPmNvbnN0cnVjdGVkID0gc3RyZWFtX2NoYW5uZWxfY29uc3RydWN0ZWQ7Cj4gPiAr
ICAgIG9iamVjdF9jbGFzcy0+ZmluYWxpemUgPSBzdHJlYW1fY2hhbm5lbF9maW5hbGl6ZTsKPiA+
Cj4gPiAgICAgIGNoYW5uZWxfY2xhc3MtPnBhcnNlciA9Cj4gPiAgICAgIHNwaWNlX2dldF9jbGll
bnRfY2hhbm5lbF9wYXJzZXIoU1BJQ0VfQ0hBTk5FTF9ESVNQTEFZLCBOVUxMKTsKPiA+ICAgICAg
Y2hhbm5lbF9jbGFzcy0+aGFuZGxlX21lc3NhZ2UgPSBoYW5kbGVfbWVzc2FnZTsKPiA+IGRpZmYg
LS1naXQgYS9zZXJ2ZXIvdmlkZW8tc3RyZWFtLmMgYi9zZXJ2ZXIvdmlkZW8tc3RyZWFtLmMKPiA+
IGluZGV4IDZhYTg1OWEwLi5hNjFjOGFiMiAxMDA2NDQKPiA+IC0tLSBhL3NlcnZlci92aWRlby1z
dHJlYW0uYwo+ID4gKysrIGIvc2VydmVyL3ZpZGVvLXN0cmVhbS5jCj4gPiBAQCAtMjAsNiArMjAs
NyBAQAo+ID4gICNpbmNsdWRlICJkaXNwbGF5LWNoYW5uZWwtcHJpdmF0ZS5oIgo+ID4gICNpbmNs
dWRlICJtYWluLWNoYW5uZWwtY2xpZW50LmgiCj4gPiAgI2luY2x1ZGUgInJlZC1jbGllbnQuaCIK
PiA+ICsjaW5jbHVkZSAic3RyZWFtLWNoYW5uZWwuaCIKPiA+Cj4KPiBXaHkgdGhpcz8KCnJlbW92
ZWQKCj4gPiAgI2RlZmluZSBGUFNfVEVTVF9JTlRFUlZBTCAxCj4gPiAgI2RlZmluZSBGT1JFQUNI
X1NUUkVBTVMoZGlzcGxheSwgaXRlbSkgICAgICAgICAgICAgICAgICBcCj4gPiBAQCAtNDY4LDYg
KzQ2OSw0MSBAQCBzdGF0aWMgYm9vbCB2aWRlb19zdHJlYW1fYWRkX2ZyYW1lKERpc3BsYXlDaGFu
bmVsCj4gPiAqZGlzcGxheSwKPiA+ICAgICAgcmV0dXJuIEZBTFNFOwo+ID4gIH0KPiA+Cj4gPiAr
LyogUmV0dXJucyBhbiBhcnJheSB3aXRoIFNQSUNFX1ZJREVPX0NPREVDX1RZUEVfRU5VTV9FTkQg
ZWxlbWVudHMsCj4gPiArICogd2l0aCB0aGUgY2xpZW50IHByZWZlcmVuY2Ugb3JkZXIgKGluZGV4
KSBhcyB2YWx1ZSAqLwo+ID4gK0dBcnJheQo+ID4gKnZpZGVvX3N0cmVhbV9wYXJzZV9wcmVmZXJy
ZWRfY29kZWNzKFNwaWNlTXNnY0Rpc3BsYXlQcmVmZXJyZWRWaWRlb0NvZGVjVHlwZQo+ID4gKm1z
ZykKPiA+ICt7Cj4gPiArICAgIGdpbnQgaSwgbGVuOwo+Cj4gZ25vdCBnYSBnYmlnIGdmdW4gZ29m
IGdhbGwgZ3RoZXNlIGdnIGdzdHJpbmdzCgpmaXhlZCwgdGhpcyBpcyBhIGNvZGUgbW92ZWQgZnJv
bSBlbHNld2hlcmUsIGJ1dCBpdCdzIHdvcnRoIGZpeGluZyB0aGUKdHlwZXMgYXMgZ2xpYiBpcyBu
b3QgaW52b2x2ZWQgd2l0aCB0aGlzIHZhcmlhYmxlcwoKPiBHQXJyYXkgKnZpZGVvX3N0cmVhbV9w
YXJzZV9wcmVmZXJyZWRfY29kZWNzKFNwaWNlTXNnY0Rpc3BsYXlQcmVmZXJyZWRWaWRlb0NvZGVj
VHlwZSAqbXNnKQo+IHsKPiAgICBpbnQgaSwgbGVuOwo+ICAgIGludCBpbmRleGVzW1NQSUNFX1ZJ
REVPX0NPREVDX1RZUEVfRU5VTV9FTkRdOwo+ICAgIEdBcnJheSAqY2xpZW50Owo+Cj4gICAgLyog
c2V0IGRlZmF1bHQgdG8gYSBiaWcgYW5kIHBvc2l0aXZlIG51bWJlciAqLwo+ICAgIG1lbXNldChp
bmRleGVzLCAweDdmLCBzaXplb2YoaW5kZXhlcykpOwo+Cj4gICAgZm9yIChsZW4gPSAwLCBpID0g
MDsgaSA8IG1zZy0+bnVtX29mX2NvZGVjczsgaSsrKSB7Cj4gICAgICAgIFNwaWNlVmlkZW9Db2Rl
Y1R5cGUgdmlkZW9fY29kZWMgPSBtc2ctPmNvZGVjc1tpXTsKPgo+ICAgICAgICBpZiAodmlkZW9f
Y29kZWMgPCBTUElDRV9WSURFT19DT0RFQ19UWVBFX01KUEVHIHx8Cj4gICAgICAgICAgICB2aWRl
b19jb2RlYyA+PSBTUElDRV9WSURFT19DT0RFQ19UWVBFX0VOVU1fRU5EKSB7Cj4gICAgICAgICAg
ICBzcGljZV9kZWJ1ZygiQ2xpZW50IGhhcyBzZW50IHVua25vd24gdmlkZW8tY29kZWMgKHZhbHVl
ICVkIGF0IGluZGV4ICVkKS4gIgo+ICAgICAgICAgICAgICAgICAgICAgICAgIklnbm9yaW5nIGFz
IHNlcnZlciBjYW4ndCBoYW5kbGUgaXQiLAo+ICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVv
X2NvZGVjLCBpKTsKPiAgICAgICAgICAgIGNvbnRpbnVlOwo+ICAgICAgICB9Cj4KPiAgICAgICAg
aWYgKGluZGV4ZXNbdmlkZW9fY29kZWNdIDwgU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9FTlVNX0VO
RCkgewo+ICAgICAgICAgICAgY29udGludWU7Cj4gICAgICAgIH0KPgo+ICAgICAgICBsZW4rKzsK
PiAgICAgICAgaW5kZXhlc1t2aWRlb19jb2RlY10gPSBsZW47Cj4gICAgfQo+ICAgIGNsaWVudCA9
IGdfYXJyYXlfc2l6ZWRfbmV3KEZBTFNFLCBGQUxTRSwgc2l6ZW9mKGludCksIFNQSUNFX1ZJREVP
X0NPREVDX1RZUEVfRU5VTV9FTkQpOwo+ICAgIGdfYXJyYXlfYXBwZW5kX3ZhbHMoY2xpZW50LCBp
bmRleGVzLCBTUElDRV9WSURFT19DT0RFQ19UWVBFX0VOVU1fRU5EKTsKPgo+ICAgIHJldHVybiBj
bGllbnQ7Cj4gfQoKLS0tCgpidXQgbm93LCBJJ20gbm90IHN1cmUgd2hhdCB0byBkbyB3aXRoIHRo
aXMgUHJlZmVycmVkIFZpZGVvIENvZGVjIGxpc3QuClRoaXMgcGF0Y2ggb25seSBzZXRzIHRoZSBT
dHJlYW1DaGFubmVsQ2xpZW50IGF0dHJpYnV0ZToKCj4gc2NjLT5jbGllbnRfcHJlZmVycmVkX3Zp
ZGVvX2NvZGVjcyA9IHZpZGVvX3N0cmVhbV9wYXJzZV9wcmVmZXJyZWRfY29kZWNzKG1zZyk7Cgpz
byBpdCBzaG91bGQgYmUgZGlzY3Vzc2VkIGluIHdpdGggdGhpcyBlbWFpbDoKCj4gW1JGQyBzcGlj
ZS1zZXJ2ZXIgMy8zXSBzdHJlYW1pbmc6IFJlc3RhcnQgZ3Vlc3QgdmlkZW8gc3RyZWFtcyBvbiB2
aWRlby1jb2RlYyBjaGFuZ2VzCgoKdGhhbmtzLAoKS2V2aW4KCj4gPiArICAgIGdpbnQgaW5kZXhl
c1tTUElDRV9WSURFT19DT0RFQ19UWVBFX0VOVU1fRU5EXTsKPiA+ICsgICAgR0FycmF5ICpjbGll
bnQ7Cj4gPiArCj4gPiArICAgIC8qIHNldCBkZWZhdWx0IHRvIGEgYmlnIGFuZCBwb3NpdGl2ZSBu
dW1iZXIgKi8KPiA+ICsgICAgbWVtc2V0KGluZGV4ZXMsIDB4N2YsIHNpemVvZihpbmRleGVzKSk7
Cj4gPiArCj4gPiArICAgIGZvciAobGVuID0gMCwgaSA9IDA7IGkgPCBtc2ctPm51bV9vZl9jb2Rl
Y3M7IGkrKykgewo+ID4gKyAgICAgICAgZ2ludCB2aWRlb19jb2RlYyA9IG1zZy0+Y29kZWNzW2ld
Owo+ID4gKwo+ID4gKyAgICAgICAgaWYgKHZpZGVvX2NvZGVjIDwgU1BJQ0VfVklERU9fQ09ERUNf
VFlQRV9NSlBFRyB8fAo+ID4gKyAgICAgICAgICAgIHZpZGVvX2NvZGVjID49IFNQSUNFX1ZJREVP
X0NPREVDX1RZUEVfRU5VTV9FTkQpIHsKPiA+ICsgICAgICAgICAgICBzcGljZV9kZWJ1ZygiQ2xp
ZW50IGhhcyBzZW50IHVua25vd24gdmlkZW8tY29kZWMgKHZhbHVlICVkIGF0Cj4gPiBpbmRleCAl
ZCkuICIKPiA+ICsgICAgICAgICAgICAgICAgICAgICAgICAiSWdub3JpbmcgYXMgc2VydmVyIGNh
bid0IGhhbmRsZSBpdCIsCj4gPiArICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvX2NvZGVj
LCBpKTsKPiA+ICsgICAgICAgICAgICBjb250aW51ZTsKPiA+ICsgICAgICAgIH0KPiA+ICsKPiA+
ICsgICAgICAgIGlmIChpbmRleGVzW3ZpZGVvX2NvZGVjXSA8IFNQSUNFX1ZJREVPX0NPREVDX1RZ
UEVfRU5VTV9FTkQpIHsKPiA+ICsgICAgICAgICAgICBjb250aW51ZTsKPiA+ICsgICAgICAgIH0K
PiA+ICsKPiA+ICsgICAgICAgIGxlbisrOwo+ID4gKyAgICAgICAgaW5kZXhlc1t2aWRlb19jb2Rl
Y10gPSBsZW47Cj4gPiArICAgIH0KPiA+ICsgICAgY2xpZW50ID0gZ19hcnJheV9zaXplZF9uZXco
RkFMU0UsIEZBTFNFLCBzaXplb2YoZ2ludCksCj4gPiBTUElDRV9WSURFT19DT0RFQ19UWVBFX0VO
VU1fRU5EKTsKPiA+ICsgICAgZ19hcnJheV9hcHBlbmRfdmFscyhjbGllbnQsIGluZGV4ZXMsIFNQ
SUNFX1ZJREVPX0NPREVDX1RZUEVfRU5VTV9FTkQpOwo+ID4gKwo+ID4gKyAgICByZXR1cm4gY2xp
ZW50Owo+ID4gK30KPiA+ICsKPiA+ICAvKiBUT0RPOiBkb2N1bWVudCB0aGUgZGlmZmVyZW5jZSBi
ZXR3ZWVuIHRoZSAyIGZ1bmN0aW9ucyBiZWxvdyAqLwo+ID4gIHZvaWQgdmlkZW9fc3RyZWFtX3Ry
YWNlX3VwZGF0ZShEaXNwbGF5Q2hhbm5lbCAqZGlzcGxheSwgRHJhd2FibGUgKmRyYXdhYmxlKQo+
ID4gIHsKPiA+IGRpZmYgLS1naXQgYS9zZXJ2ZXIvdmlkZW8tc3RyZWFtLmggYi9zZXJ2ZXIvdmlk
ZW8tc3RyZWFtLmgKPiA+IGluZGV4IDQ2YjA3NmZkLi43MzQzNTUxNSAxMDA2NDQKPiA+IC0tLSBh
L3NlcnZlci92aWRlby1zdHJlYW0uaAo+ID4gKysrIGIvc2VydmVyL3ZpZGVvLXN0cmVhbS5oCj4g
PiBAQCAtMTQ3LDYgKzE0Nyw3IEBAIHZvaWQgdmlkZW9fc3RyZWFtX2RldGFjaF9hbmRfc3RvcChE
aXNwbGF5Q2hhbm5lbAo+ID4gKmRpc3BsYXkpOwo+ID4gIHZvaWQgdmlkZW9fc3RyZWFtX3RyYWNl
X2FkZF9kcmF3YWJsZShEaXNwbGF5Q2hhbm5lbCAqZGlzcGxheSwgRHJhd2FibGUKPiA+ICAqaXRl
bSk7Cj4gPiAgdm9pZCB2aWRlb19zdHJlYW1fZGV0YWNoX2JlaGluZChEaXNwbGF5Q2hhbm5lbCAq
ZGlzcGxheSwgUVJlZ2lvbiAqcmVnaW9uLAo+ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgRHJhd2FibGUgKmRyYXdhYmxlKTsKPiA+ICtHQXJyYXkKPiA+ICp2aWRlb19zdHJlYW1f
cGFyc2VfcHJlZmVycmVkX2NvZGVjcyhTcGljZU1zZ2NEaXNwbGF5UHJlZmVycmVkVmlkZW9Db2Rl
Y1R5cGUKPiA+ICptc2cpOwo+ID4KPiA+ICB2b2lkIHZpZGVvX3N0cmVhbV9hZ2VudF91bnJlZihE
aXNwbGF5Q2hhbm5lbCAqZGlzcGxheSwgVmlkZW9TdHJlYW1BZ2VudAo+ID4gICphZ2VudCk7Cj4g
PiAgdm9pZCB2aWRlb19zdHJlYW1fYWdlbnRfc3RvcChWaWRlb1N0cmVhbUFnZW50ICphZ2VudCk7
Cj4KPiBGcmVkaWFubwpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpTcGljZS1kZXZlbCBtYWlsaW5nIGxpc3QKU3BpY2UtZGV2ZWxAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vc3Bp
Y2UtZGV2ZWw=
