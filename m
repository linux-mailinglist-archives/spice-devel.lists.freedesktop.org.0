Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 6415983456
	for <lists+spice-devel@lfdr.de>; Tue,  6 Aug 2019 16:53:02 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7EAB66E3AC;
	Tue,  6 Aug 2019 14:53:00 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 73A4F6E3AC
 for <spice-devel@lists.freedesktop.org>; Tue,  6 Aug 2019 14:52:59 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx07.intmail.prod.int.phx2.redhat.com
 [10.5.11.22])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 14A9E30583E6
 for <spice-devel@lists.freedesktop.org>; Tue,  6 Aug 2019 14:52:59 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.14])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 84FEE10016E8;
 Tue,  6 Aug 2019 14:52:57 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Tue,  6 Aug 2019 15:52:49 +0100
Message-Id: <20190806145250.31813-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.22
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.48]); Tue, 06 Aug 2019 14:52:59 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-server 1/2] event-loop: Move adapter
 interface from reds.c
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

UHV0IG1vcmUgZXZlbnQgbG9vcCBjb2RlIGluIGV2ZW50LWxvb3AuYy4KVGhpcyBpcyBhIHByZXBh
cmF0aW9uIHBhdGNoIGZvciB0aGUgbmV4dCBvbmUuCgpTaWduZWQtb2ZmLWJ5OiBGcmVkaWFubyBa
aWdsaW8gPGZ6aWdsaW9AcmVkaGF0LmNvbT4KLS0tCiBzZXJ2ZXIvZXZlbnQtbG9vcC5jIHwgNTgg
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiBzZXJ2ZXIvcmVk
LWNvbW1vbi5oIHwgIDEgKwogc2VydmVyL3JlZHMuYyAgICAgICB8IDU0IC0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAzIGZpbGVzIGNoYW5nZWQsIDU5IGluc2VydGlv
bnMoKyksIDU0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3NlcnZlci9ldmVudC1sb29wLmMg
Yi9zZXJ2ZXIvZXZlbnQtbG9vcC5jCmluZGV4IDgxMmMzYTUzYi4uMWNjZmQ2NzFmIDEwMDY0NAot
LS0gYS9zZXJ2ZXIvZXZlbnQtbG9vcC5jCisrKyBiL3NlcnZlci9ldmVudC1sb29wLmMKQEAgLTI2
NCwzICsyNjQsNjEgQEAgY29uc3QgU3BpY2VDb3JlSW50ZXJmYWNlSW50ZXJuYWwgZXZlbnRfbG9v
cF9jb3JlID0gewogICAgIC53YXRjaF91cGRhdGVfbWFzayA9IHdhdGNoX3VwZGF0ZV9tYXNrLAog
ICAgIC53YXRjaF9yZW1vdmUgPSB3YXRjaF9yZW1vdmUsCiB9OworCisvKgorICogQWRhcHRlciBm
b3IgU3BpY2VDb2RlSW50ZXJmYWNlCisgKi8KKworc3RhdGljIFNwaWNlVGltZXIgKmFkYXB0ZXJf
dGltZXJfYWRkKGNvbnN0IFNwaWNlQ29yZUludGVyZmFjZUludGVybmFsICppZmFjZSwgU3BpY2VU
aW1lckZ1bmMgZnVuYywgdm9pZCAqb3BhcXVlKQoreworICAgIHJldHVybiBpZmFjZS0+cHVibGlj
X2ludGVyZmFjZS0+dGltZXJfYWRkKGZ1bmMsIG9wYXF1ZSk7Cit9CisKK3N0YXRpYyB2b2lkIGFk
YXB0ZXJfdGltZXJfc3RhcnQoY29uc3QgU3BpY2VDb3JlSW50ZXJmYWNlSW50ZXJuYWwgKmlmYWNl
LCBTcGljZVRpbWVyICp0aW1lciwgdWludDMyX3QgbXMpCit7CisgICAgaWZhY2UtPnB1YmxpY19p
bnRlcmZhY2UtPnRpbWVyX3N0YXJ0KHRpbWVyLCBtcyk7Cit9CisKK3N0YXRpYyB2b2lkIGFkYXB0
ZXJfdGltZXJfY2FuY2VsKGNvbnN0IFNwaWNlQ29yZUludGVyZmFjZUludGVybmFsICppZmFjZSwg
U3BpY2VUaW1lciAqdGltZXIpCit7CisgICAgaWZhY2UtPnB1YmxpY19pbnRlcmZhY2UtPnRpbWVy
X2NhbmNlbCh0aW1lcik7Cit9CisKK3N0YXRpYyB2b2lkIGFkYXB0ZXJfdGltZXJfcmVtb3ZlKGNv
bnN0IFNwaWNlQ29yZUludGVyZmFjZUludGVybmFsICppZmFjZSwgU3BpY2VUaW1lciAqdGltZXIp
Cit7CisgICAgaWZhY2UtPnB1YmxpY19pbnRlcmZhY2UtPnRpbWVyX3JlbW92ZSh0aW1lcik7Cit9
CisKK3N0YXRpYyBTcGljZVdhdGNoICphZGFwdGVyX3dhdGNoX2FkZChjb25zdCBTcGljZUNvcmVJ
bnRlcmZhY2VJbnRlcm5hbCAqaWZhY2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgaW50IGZkLCBpbnQgZXZlbnRfbWFzaywgU3BpY2VXYXRjaEZ1bmMgZnVuYywgdm9pZCAq
b3BhcXVlKQoreworICAgIC8vIG5vdGU6IFFlbXUgQVBJIGlzIGZpbmUgaGF2aW5nIGEgU09DS0VU
IG9uIFdpbmRvd3MKKyAgICByZXR1cm4gaWZhY2UtPnB1YmxpY19pbnRlcmZhY2UtPndhdGNoX2Fk
ZChmZCwgZXZlbnRfbWFzaywgZnVuYywgb3BhcXVlKTsKK30KKworc3RhdGljIHZvaWQgYWRhcHRl
cl93YXRjaF91cGRhdGVfbWFzayhjb25zdCBTcGljZUNvcmVJbnRlcmZhY2VJbnRlcm5hbCAqaWZh
Y2UsIFNwaWNlV2F0Y2ggKndhdGNoLCBpbnQgZXZlbnRfbWFzaykKK3sKKyAgICBpZmFjZS0+cHVi
bGljX2ludGVyZmFjZS0+d2F0Y2hfdXBkYXRlX21hc2sod2F0Y2gsIGV2ZW50X21hc2spOworfQor
CitzdGF0aWMgdm9pZCBhZGFwdGVyX3dhdGNoX3JlbW92ZShjb25zdCBTcGljZUNvcmVJbnRlcmZh
Y2VJbnRlcm5hbCAqaWZhY2UsIFNwaWNlV2F0Y2ggKndhdGNoKQoreworICAgIGlmYWNlLT5wdWJs
aWNfaW50ZXJmYWNlLT53YXRjaF9yZW1vdmUod2F0Y2gpOworfQorCitzdGF0aWMgdm9pZCBhZGFw
dGVyX2NoYW5uZWxfZXZlbnQoY29uc3QgU3BpY2VDb3JlSW50ZXJmYWNlSW50ZXJuYWwgKmlmYWNl
LCBpbnQgZXZlbnQsIFNwaWNlQ2hhbm5lbEV2ZW50SW5mbyAqaW5mbykKK3sKKyAgICBpZiAoaWZh
Y2UtPnB1YmxpY19pbnRlcmZhY2UtPmJhc2UubWlub3JfdmVyc2lvbiA+PSAzICYmIGlmYWNlLT5w
dWJsaWNfaW50ZXJmYWNlLT5jaGFubmVsX2V2ZW50ICE9IE5VTEwpCisgICAgICAgIGlmYWNlLT5w
dWJsaWNfaW50ZXJmYWNlLT5jaGFubmVsX2V2ZW50KGV2ZW50LCBpbmZvKTsKK30KKworY29uc3Qg
U3BpY2VDb3JlSW50ZXJmYWNlSW50ZXJuYWwgY29yZV9pbnRlcmZhY2VfYWRhcHRlciA9IHsKKyAg
ICAudGltZXJfYWRkID0gYWRhcHRlcl90aW1lcl9hZGQsCisgICAgLnRpbWVyX3N0YXJ0ID0gYWRh
cHRlcl90aW1lcl9zdGFydCwKKyAgICAudGltZXJfY2FuY2VsID0gYWRhcHRlcl90aW1lcl9jYW5j
ZWwsCisgICAgLnRpbWVyX3JlbW92ZSA9IGFkYXB0ZXJfdGltZXJfcmVtb3ZlLAorICAgIC53YXRj
aF9hZGQgPSBhZGFwdGVyX3dhdGNoX2FkZCwKKyAgICAud2F0Y2hfdXBkYXRlX21hc2sgPSBhZGFw
dGVyX3dhdGNoX3VwZGF0ZV9tYXNrLAorICAgIC53YXRjaF9yZW1vdmUgPSBhZGFwdGVyX3dhdGNo
X3JlbW92ZSwKKyAgICAuY2hhbm5lbF9ldmVudCA9IGFkYXB0ZXJfY2hhbm5lbF9ldmVudCwKK307
CmRpZmYgLS1naXQgYS9zZXJ2ZXIvcmVkLWNvbW1vbi5oIGIvc2VydmVyL3JlZC1jb21tb24uaApp
bmRleCAyMjNmMjg2OTAuLjIyZWE4ZmMzNyAxMDA2NDQKLS0tIGEvc2VydmVyL3JlZC1jb21tb24u
aAorKysgYi9zZXJ2ZXIvcmVkLWNvbW1vbi5oCkBAIC03MSw2ICs3MSw3IEBAIHN0cnVjdCBTcGlj
ZUNvcmVJbnRlcmZhY2VJbnRlcm5hbCB7CiB9OwogCiBleHRlcm4gY29uc3QgU3BpY2VDb3JlSW50
ZXJmYWNlSW50ZXJuYWwgZXZlbnRfbG9vcF9jb3JlOworZXh0ZXJuIGNvbnN0IFNwaWNlQ29yZUlu
dGVyZmFjZUludGVybmFsIGNvcmVfaW50ZXJmYWNlX2FkYXB0ZXI7CiAKIHR5cGVkZWYgc3RydWN0
IFJlZHNTdGF0ZSBSZWRzU3RhdGU7CiAKZGlmZiAtLWdpdCBhL3NlcnZlci9yZWRzLmMgYi9zZXJ2
ZXIvcmVkcy5jCmluZGV4IGEzNzk1YWI5MC4uZjQzMmY1NWE0IDEwMDY0NAotLS0gYS9zZXJ2ZXIv
cmVkcy5jCisrKyBiL3NlcnZlci9yZWRzLmMKQEAgLTgzLDYwICs4Myw2IEBAIHN0YXRpYyB2b2lk
IHJlZHNfY2xpZW50X21vbml0b3JzX2NvbmZpZyhSZWRzU3RhdGUgKnJlZHMsIFZEQWdlbnRNb25p
dG9yc0NvbmZpZyAqCiBzdGF0aWMgZ2Jvb2xlYW4gcmVkc191c2VfY2xpZW50X21vbml0b3JzX2Nv
bmZpZyhSZWRzU3RhdGUgKnJlZHMpOwogc3RhdGljIHZvaWQgcmVkc19zZXRfdmlkZW9fY29kZWNz
KFJlZHNTdGF0ZSAqcmVkcywgR0FycmF5ICp2aWRlb19jb2RlY3MpOwogCi1zdGF0aWMgU3BpY2VU
aW1lciAqYWRhcHRlcl90aW1lcl9hZGQoY29uc3QgU3BpY2VDb3JlSW50ZXJmYWNlSW50ZXJuYWwg
KmlmYWNlLCBTcGljZVRpbWVyRnVuYyBmdW5jLCB2b2lkICpvcGFxdWUpCi17Ci0gICAgcmV0dXJu
IGlmYWNlLT5wdWJsaWNfaW50ZXJmYWNlLT50aW1lcl9hZGQoZnVuYywgb3BhcXVlKTsKLX0KLQot
c3RhdGljIHZvaWQgYWRhcHRlcl90aW1lcl9zdGFydChjb25zdCBTcGljZUNvcmVJbnRlcmZhY2VJ
bnRlcm5hbCAqaWZhY2UsIFNwaWNlVGltZXIgKnRpbWVyLCB1aW50MzJfdCBtcykKLXsKLSAgICBp
ZmFjZS0+cHVibGljX2ludGVyZmFjZS0+dGltZXJfc3RhcnQodGltZXIsIG1zKTsKLX0KLQotc3Rh
dGljIHZvaWQgYWRhcHRlcl90aW1lcl9jYW5jZWwoY29uc3QgU3BpY2VDb3JlSW50ZXJmYWNlSW50
ZXJuYWwgKmlmYWNlLCBTcGljZVRpbWVyICp0aW1lcikKLXsKLSAgICBpZmFjZS0+cHVibGljX2lu
dGVyZmFjZS0+dGltZXJfY2FuY2VsKHRpbWVyKTsKLX0KLQotc3RhdGljIHZvaWQgYWRhcHRlcl90
aW1lcl9yZW1vdmUoY29uc3QgU3BpY2VDb3JlSW50ZXJmYWNlSW50ZXJuYWwgKmlmYWNlLCBTcGlj
ZVRpbWVyICp0aW1lcikKLXsKLSAgICBpZmFjZS0+cHVibGljX2ludGVyZmFjZS0+dGltZXJfcmVt
b3ZlKHRpbWVyKTsKLX0KLQotc3RhdGljIFNwaWNlV2F0Y2ggKmFkYXB0ZXJfd2F0Y2hfYWRkKGNv
bnN0IFNwaWNlQ29yZUludGVyZmFjZUludGVybmFsICppZmFjZSwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBpbnQgZmQsIGludCBldmVudF9tYXNrLCBTcGljZVdhdGNoRnVu
YyBmdW5jLCB2b2lkICpvcGFxdWUpCi17Ci0gICAgLy8gbm90ZTogUWVtdSBBUEkgaXMgZmluZSBo
YXZpbmcgYSBTT0NLRVQgb24gV2luZG93cwotICAgIHJldHVybiBpZmFjZS0+cHVibGljX2ludGVy
ZmFjZS0+d2F0Y2hfYWRkKGZkLCBldmVudF9tYXNrLCBmdW5jLCBvcGFxdWUpOwotfQotCi1zdGF0
aWMgdm9pZCBhZGFwdGVyX3dhdGNoX3VwZGF0ZV9tYXNrKGNvbnN0IFNwaWNlQ29yZUludGVyZmFj
ZUludGVybmFsICppZmFjZSwgU3BpY2VXYXRjaCAqd2F0Y2gsIGludCBldmVudF9tYXNrKQotewot
ICAgIGlmYWNlLT5wdWJsaWNfaW50ZXJmYWNlLT53YXRjaF91cGRhdGVfbWFzayh3YXRjaCwgZXZl
bnRfbWFzayk7Ci19Ci0KLXN0YXRpYyB2b2lkIGFkYXB0ZXJfd2F0Y2hfcmVtb3ZlKGNvbnN0IFNw
aWNlQ29yZUludGVyZmFjZUludGVybmFsICppZmFjZSwgU3BpY2VXYXRjaCAqd2F0Y2gpCi17Ci0g
ICAgaWZhY2UtPnB1YmxpY19pbnRlcmZhY2UtPndhdGNoX3JlbW92ZSh3YXRjaCk7Ci19Ci0KLXN0
YXRpYyB2b2lkIGFkYXB0ZXJfY2hhbm5lbF9ldmVudChjb25zdCBTcGljZUNvcmVJbnRlcmZhY2VJ
bnRlcm5hbCAqaWZhY2UsIGludCBldmVudCwgU3BpY2VDaGFubmVsRXZlbnRJbmZvICppbmZvKQot
ewotICAgIGlmIChpZmFjZS0+cHVibGljX2ludGVyZmFjZS0+YmFzZS5taW5vcl92ZXJzaW9uID49
IDMgJiYgaWZhY2UtPnB1YmxpY19pbnRlcmZhY2UtPmNoYW5uZWxfZXZlbnQgIT0gTlVMTCkKLSAg
ICAgICAgaWZhY2UtPnB1YmxpY19pbnRlcmZhY2UtPmNoYW5uZWxfZXZlbnQoZXZlbnQsIGluZm8p
OwotfQotCi1zdGF0aWMgY29uc3QgU3BpY2VDb3JlSW50ZXJmYWNlSW50ZXJuYWwgY29yZV9pbnRl
cmZhY2VfYWRhcHRlciA9IHsKLSAgICAudGltZXJfYWRkID0gYWRhcHRlcl90aW1lcl9hZGQsCi0g
ICAgLnRpbWVyX3N0YXJ0ID0gYWRhcHRlcl90aW1lcl9zdGFydCwKLSAgICAudGltZXJfY2FuY2Vs
ID0gYWRhcHRlcl90aW1lcl9jYW5jZWwsCi0gICAgLnRpbWVyX3JlbW92ZSA9IGFkYXB0ZXJfdGlt
ZXJfcmVtb3ZlLAotICAgIC53YXRjaF9hZGQgPSBhZGFwdGVyX3dhdGNoX2FkZCwKLSAgICAud2F0
Y2hfdXBkYXRlX21hc2sgPSBhZGFwdGVyX3dhdGNoX3VwZGF0ZV9tYXNrLAotICAgIC53YXRjaF9y
ZW1vdmUgPSBhZGFwdGVyX3dhdGNoX3JlbW92ZSwKLSAgICAuY2hhbm5lbF9ldmVudCA9IGFkYXB0
ZXJfY2hhbm5lbF9ldmVudCwKLX07Ci0KIC8qIERlYnVnZ2luZyBvbmx5IHZhcmlhYmxlOiBhbGxv
dyBtdWx0aXBsZSBjbGllbnQgY29ubmVjdGlvbnMgdG8gdGhlIHNwaWNlCiAgKiBzZXJ2ZXIgKi8K
ICNkZWZpbmUgU1BJQ0VfREVCVUdfQUxMT1dfTUNfRU5WICJTUElDRV9ERUJVR19BTExPV19NQyIK
LS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KU3BpY2UtZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNl
LWRldmVs
