Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 541921147C5
	for <lists+spice-devel@lfdr.de>; Thu,  5 Dec 2019 20:43:01 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 91E136F8DD;
	Thu,  5 Dec 2019 19:42:57 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail-wm1-x341.google.com (mail-wm1-x341.google.com
 [IPv6:2a00:1450:4864:20::341])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6EA8A6E150
 for <spice-devel@lists.freedesktop.org>; Thu,  5 Dec 2019 17:43:49 +0000 (UTC)
Received: by mail-wm1-x341.google.com with SMTP id g206so4865702wme.1
 for <spice-devel@lists.freedesktop.org>; Thu, 05 Dec 2019 09:43:49 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=F1gF/yRN5DlSsFDC5wl8CYNwhV+OqPYBaXjKeK9wLxY=;
 b=HWu9VKb0N2CkOM8/A0Kf2P5mymKldFMAyOEBT/fg9/1tAM2+Wu1jEKuRPzq8xpMs1x
 840apzHMlEbGmrAYlMM6pArw9vmyyzpQIuiYlKmaX6lX4mdD343lCh9byqPRSFWYqw9y
 rGVgVnZ7o/a14/sYhiLgTHmQn2Bglacq/jlVoJ62pbd03AH5rJzqhSPU5HA3Q9fprDJT
 SiTYvMG9McesLM4D0is3dZSU4h63aTIDbQGmatGayuPJmpLHmhtm0JnfEMX3/ErqF/R7
 DXtiSlLmcpY0hP8aPqWGIZT7v4t7trb+cr2ECdhOfvjyw3h+Igch3paFHj/1ARyVoZ9s
 /4rw==
X-Gm-Message-State: APjAAAX6T5IB3lTTHbGg9pEEDlBPqUms/uGqphIZPRTlLaljBRYX4PS1
 7XRaSO8UxPa4HGMl4cg1V/ZCCfmFzZruEA==
X-Google-Smtp-Source: APXvYqzqUCtymh1Ov2hKcIr4+6ZCXd5gQkYDheOe/ppvEpL456rnsCOPiFhQOn0nPuP/n/5+ngxr7g==
X-Received: by 2002:a05:600c:507:: with SMTP id
 i7mr6749396wmc.135.1575567827921; 
 Thu, 05 Dec 2019 09:43:47 -0800 (PST)
Received: from localhost.localdomain ([94.188.175.54])
 by smtp.gmail.com with ESMTPSA id j12sm13888954wrw.54.2019.12.05.09.43.46
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 05 Dec 2019 09:43:47 -0800 (PST)
From: alexander@daynix.com
X-Google-Original-From: anezhins@redhat.com
To: spice-devel@lists.freedesktop.org
Date: Thu,  5 Dec 2019 19:49:11 +0200
Message-Id: <20191205174915.24546-6-anezhins@redhat.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20191205174915.24546-1-anezhins@redhat.com>
References: <20191205174915.24546-1-anezhins@redhat.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Thu, 05 Dec 2019 19:42:56 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=daynix-com.20150623.gappssmtp.com; s=20150623;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=F1gF/yRN5DlSsFDC5wl8CYNwhV+OqPYBaXjKeK9wLxY=;
 b=nGbkyYeeQg4z62ZTW8QcltpU+IMfNEhHTyx2Z/cwUYz6cQhOrkFli7GF2BnEQJm3OD
 cz//R/2wL+WL5VhE5NxoWoP7pjIWkLeyjyY3a77NRY45CQh5abeV21kkDSWlsATruvKH
 nSZIAPvKpqgNIPi6EvOAc2MREmJC5nHBvKw6+pf3pQ362IdwO+X/YOBvOW1l4pRsseZR
 mipGVd1/3Rx9caAidCHSfWEEuHgM2lKO8kqGtqGH+BMSQUnBS3OjbI+KVzmrvJlupHFs
 VKelh9qjtLvp8HhMhYy6eBZh/GBbK1W7NxeJxYn+5qdQ6I88LgUKJ4Qkks2FSjZBMCF7
 gWLA==
Subject: [Spice-devel] [PATCH 5/9] Add empty CD entry to usb-device-widget,
 create shared CD when toggled
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Yan Vugenfirer <yan@daynix.com>, Alexander Nezhinsky <anezhins@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogQWxleGFuZGVyIE5lemhpbnNreSA8YW5lemhpbnNAcmVkaGF0LmNvbT4KClRoZSBlbXB0
eSBDRCBlbnRyeSBpcyBhIHBsYWNlaG9sZGVyIGFuZCBhcHBlYXJzIGV2ZXJ5IHRpbWUgdGhlIHdp
ZGdldCBpcyBjcmVhdGVkLgpXaGVuIGl0IGlzIHRvZ2dsZWQsIGEgZmlsZSBjaG9vc2VyIGRpYWxv
ZyBpcyBwb3BwZWQgdXAuIElmIGEgZmlsZSBvciBkZXZpY2UgaXMKc2VsZWN0ZWQsIGEgbmV3IENE
IGRldmljZSBpcyBjcmVhdGVkLiBUaGUgbmV3IENEIGRldmljZSBpcyBhdXRvLWNvbm5lY3RlZC4K
ClRoaXMgZGV2aWNlIGlzIGNvbW11bmljYXRlZCB0byB0aGUgd2lkZ2V0IHRocm91Z2ggdGhlICdk
ZXZpY2UtYWRkZWQnIHNpZ25hbC4KVGhlIGxpc3QgZW50cnkgcmVzcG9uc2libGUgZm9yIHRoZSBu
ZXcgZGV2aWNlIGNvcnJlc3BvbmRzIHRvIHRoZSBlbnRpdHkKcHJvdmlkZWQgYnkgdXNiLWRldmlj
ZS1tYW5hZ2VyLiBUaGUgZW1wdHkgQ0QgZW50cnkgaXMgYXV0b21hdGljYWxseSBtb3ZlZCB0bwp0
aGUgdG9wIG9mIHRoZSBsaXN0LgoKU2lnbmVkLW9mZi1ieTogQWxleGFuZGVyIE5lemhpbnNreSA8
YW5lemhpbnNAcmVkaGF0LmNvbT4KLS0tCiBzcmMvdXNiLWRldmljZS13aWRnZXQuYyB8IDc4ICsr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAxIGZpbGUgY2hhbmdlZCwg
NzggaW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBhL3NyYy91c2ItZGV2aWNlLXdpZGdldC5jIGIv
c3JjL3VzYi1kZXZpY2Utd2lkZ2V0LmMKaW5kZXggNmU3YTI2Ny4uZTA3NzQ4MiAxMDA2NDQKLS0t
IGEvc3JjL3VzYi1kZXZpY2Utd2lkZ2V0LmMKKysrIGIvc3JjL3VzYi1kZXZpY2Utd2lkZ2V0LmMK
QEAgLTI0LDYgKzI0LDcgQEAKICNpbmNsdWRlICJzcGljZS1jbGllbnQuaCIKICNpbmNsdWRlICJz
cGljZS1tYXJzaGFsLmgiCiAjaW5jbHVkZSAidXNiLWRldmljZS13aWRnZXQuaCIKKyNpbmNsdWRl
ICJ1c2ItZGV2aWNlLW1hbmFnZXIuaCIKIAogLyoqCiAgKiBTRUNUSU9OOnVzYi1kZXZpY2Utd2lk
Z2V0CkBAIC02Miw2ICs2Myw3IEBAIHN0YXRpYyB2b2lkIGRldmljZV9yZW1vdmVkX2NiKFNwaWNl
VXNiRGV2aWNlTWFuYWdlciAqbWFuYWdlciwKICAgICBTcGljZVVzYkRldmljZSAqZGV2aWNlLCBn
cG9pbnRlciB1c2VyX2RhdGEpOwogc3RhdGljIHZvaWQgZGV2aWNlX2Vycm9yX2NiKFNwaWNlVXNi
RGV2aWNlTWFuYWdlciAqbWFuYWdlciwKICAgICBTcGljZVVzYkRldmljZSAqZGV2aWNlLCBHRXJy
b3IgKmVyciwgZ3BvaW50ZXIgdXNlcl9kYXRhKTsKK3N0YXRpYyB2b2lkIGVtcHR5X2NkX2NsaWNr
ZWRfY2IoR3RrVG9nZ2xlQnV0dG9uICp0b2dnbGUsIGdwb2ludGVyIHVzZXJfZGF0YSk7CiBzdGF0
aWMgZ2Jvb2xlYW4gc3BpY2VfdXNiX2RldmljZV93aWRnZXRfdXBkYXRlX3N0YXR1cyhncG9pbnRl
ciB1c2VyX2RhdGEpOwogCiBlbnVtIHsKQEAgLTc5LDYgKzgxLDcgQEAgc3RydWN0IF9TcGljZVVz
YkRldmljZVdpZGdldFByaXZhdGUgewogICAgIFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbjsKICAgICBn
Y2hhciAqZGV2aWNlX2Zvcm1hdF9zdHJpbmc7CiAgICAgU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICpt
YW5hZ2VyOworICAgIEd0a1dpZGdldCAqZW1wdHlfY2Q7CiAgICAgR3RrV2lkZ2V0ICppbmZvX2Jh
cjsKICAgICBHdGtXaWRnZXQgKmxhYmVsOwogICAgIGdjaGFyICplcnJfbXNnOwpAQCAtMTg5LDYg
KzE5Miw2OCBAQCBzcGljZV91c2JfZGV2aWNlX3dpZGdldF9zaG93X2luZm9fYmFyKFNwaWNlVXNi
RGV2aWNlV2lkZ2V0ICpzZWxmLAogICAgIGd0a193aWRnZXRfc2hvd19hbGwocHJpdi0+aW5mb19i
YXIpOwogfQogCitzdGF0aWMgdm9pZCBzcGljZV91c2JfZGV2aWNlX3dpZGdldF9hZGRfZW1wdHlf
Y2QoU3BpY2VVc2JEZXZpY2VXaWRnZXQgKnNlbGYpOworCitzdGF0aWMgdm9pZAorZW1wdHlfY2Rf
Y2xpY2tlZF9jYihHdGtUb2dnbGVCdXR0b24gKnRvZ2dsZSwgZ3BvaW50ZXIgdXNlcl9kYXRhKQor
eworICAgIFNwaWNlVXNiRGV2aWNlV2lkZ2V0ICpzZWxmID0gU1BJQ0VfVVNCX0RFVklDRV9XSURH
RVQodXNlcl9kYXRhKTsKKyAgICBTcGljZVVzYkRldmljZVdpZGdldFByaXZhdGUgKnByaXYgPSBz
ZWxmLT5wcml2OworICAgIEd0a1dpZGdldCAqZGlhbG9nOworICAgIGdpbnQgZGlhbG9nX3JjOwor
CisgICAgaWYgKGd0a190b2dnbGVfYnV0dG9uX2dldF9hY3RpdmUodG9nZ2xlKSkKKyAgICAgICAg
Z3RrX3RvZ2dsZV9idXR0b25fc2V0X2FjdGl2ZSh0b2dnbGUsIEZBTFNFKTsKKyAgICBlbHNlCisg
ICAgICAgIHJldHVybjsKKworICAgIGRpYWxvZyA9IGd0a19maWxlX2Nob29zZXJfZGlhbG9nX25l
dyhfKCJTZWxlY3QgSVNPIGZpbGUgb3IgZGV2aWNlIiksCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIEdUS19XSU5ET1coZ3RrX3dpZGdldF9nZXRfdG9wbGV2ZWwoR1RL
X1dJREdFVChzZWxmKSkpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBHVEtfRklMRV9DSE9PU0VSX0FDVElPTl9PUEVOLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBfKCJfQ2FuY2VsIiksIEdUS19SRVNQT05TRV9DQU5DRUwsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8oIl9PcGVuIiksIEdUS19SRVNQ
T05TRV9BQ0NFUFQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5V
TEwpOworCisgICAgZGlhbG9nX3JjID0gZ3RrX2RpYWxvZ19ydW4oR1RLX0RJQUxPRyhkaWFsb2cp
KTsKKyAgICBpZiAoZGlhbG9nX3JjID09IEdUS19SRVNQT05TRV9BQ0NFUFQpIHsKKyAgICAgICAg
Z2NoYXIgKmZpbGVuYW1lID0gZ3RrX2ZpbGVfY2hvb3Nlcl9nZXRfZmlsZW5hbWUoR1RLX0ZJTEVf
Q0hPT1NFUihkaWFsb2cpKTsKKyAgICAgICAgR0Vycm9yICplcnIgPSBOVUxMOworICAgICAgICBn
Ym9vbGVhbiByYzsKKworICAgICAgICByYyA9IHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9jcmVh
dGVfc2hhcmVkX2NkX2RldmljZShwcml2LT5tYW5hZ2VyLCBmaWxlbmFtZSwgJmVycik7CisgICAg
ICAgIGlmICghcmMgJiYgZXJyKSB7CisgICAgICAgICAgICBnY2hhciAqZXJyX21zZyA9IGdfc3Ry
ZHVwX3ByaW50Zigic2hhcmVkIENEICVzLCAlcyIsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBnX3BhdGhfZ2V0X2Jhc2VuYW1lKGZpbGVuYW1lKSwgZXJyLT5t
ZXNzYWdlKTsKKworICAgICAgICAgICAgU1BJQ0VfREVCVUcoIkZhaWxlZCB0byBjcmVhdGUgJXMi
LCBlcnJfbXNnKTsKKyAgICAgICAgICAgIHNwaWNlX3VzYl9kZXZpY2Vfd2lkZ2V0X2FkZF9lcnJf
bXNnKHNlbGYsIGVycl9tc2cpOworICAgICAgICAgICAgc3BpY2VfdXNiX2RldmljZV93aWRnZXRf
dXBkYXRlX3N0YXR1cyh1c2VyX2RhdGEpOworICAgICAgICB9CisgICAgICAgIGdfY2xlYXJfZXJy
b3IoJmVycik7CisgICAgfQorICAgIGd0a193aWRnZXRfZGVzdHJveShkaWFsb2cpOworfQorCitz
dGF0aWMgdm9pZCBzcGljZV91c2JfZGV2aWNlX3dpZGdldF9hZGRfZW1wdHlfY2QoU3BpY2VVc2JE
ZXZpY2VXaWRnZXQgKnNlbGYpCit7CisgICAgU3BpY2VVc2JEZXZpY2VXaWRnZXRQcml2YXRlICpw
cml2ID0gc2VsZi0+cHJpdjsKKyAgICBHdGtXaWRnZXQgKmVtcHR5X2NkLCAqY2RfbGFiZWw7CisK
KyAgICBpZiAocHJpdi0+ZW1wdHlfY2QpCisgICAgICAgIHJldHVybjsKKworICAgIGVtcHR5X2Nk
ID0gZ3RrX2NoZWNrX2J1dHRvbl9uZXdfd2l0aF9sYWJlbCgiU1BJQ0UgQ0QgKGVtcHR5KSIpOwor
ICAgIGNkX2xhYmVsID0gZ3RrX2Jpbl9nZXRfY2hpbGQoR1RLX0JJTihlbXB0eV9jZCkpOworICAg
IGd0a19sYWJlbF9zZXRfZWxsaXBzaXplKEdUS19MQUJFTChjZF9sYWJlbCksIFBBTkdPX0VMTElQ
U0laRV9NSURETEUpOworICAgIGdfc2lnbmFsX2Nvbm5lY3QoR19PQkpFQ1QoZW1wdHlfY2QpLCAi
dG9nZ2xlZCIsIEdfQ0FMTEJBQ0soZW1wdHlfY2RfY2xpY2tlZF9jYiksIHNlbGYpOworCisgICAg
Z3RrX3dpZGdldF9zZXRfbWFyZ2luX3N0YXJ0KGVtcHR5X2NkLCAxMik7CisgICAgZ3RrX2JveF9w
YWNrX2VuZChHVEtfQk9YKHNlbGYpLCBlbXB0eV9jZCwgRkFMU0UsIEZBTFNFLCAwKTsKKyAgICBn
dGtfd2lkZ2V0X3Nob3dfYWxsKGVtcHR5X2NkKTsKKworICAgIHByaXYtPmVtcHR5X2NkID0gZW1w
dHlfY2Q7Cit9CisKIHN0YXRpYyB2b2lkIHNwaWNlX3VzYl9kZXZpY2Vfd2lkZ2V0X2NvbnN0cnVj
dGVkKEdPYmplY3QgKmdvYmplY3QpCiB7CiAgICAgU3BpY2VVc2JEZXZpY2VXaWRnZXQgKnNlbGY7
CkBAIC0yMjYsNiArMjkxLDggQEAgc3RhdGljIHZvaWQgc3BpY2VfdXNiX2RldmljZV93aWRnZXRf
Y29uc3RydWN0ZWQoR09iamVjdCAqZ29iamVjdCkKICAgICBnX3NpZ25hbF9jb25uZWN0KHByaXYt
Pm1hbmFnZXIsICJkZXZpY2UtZXJyb3IiLAogICAgICAgICAgICAgICAgICAgICAgR19DQUxMQkFD
SyhkZXZpY2VfZXJyb3JfY2IpLCBzZWxmKTsKIAorICAgIHByaXYtPmVtcHR5X2NkID0gTlVMTDsK
KwogICAgIGRldmljZXMgPSBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfZ2V0X2RldmljZXMocHJp
di0+bWFuYWdlcik7CiAgICAgaWYgKGRldmljZXMgIT0gTlVMTCkgewogICAgICAgICBpbnQgaTsK
QEAgLTIzNiw2ICszMDMsOCBAQCBzdGF0aWMgdm9pZCBzcGljZV91c2JfZGV2aWNlX3dpZGdldF9j
b25zdHJ1Y3RlZChHT2JqZWN0ICpnb2JqZWN0KQogICAgICAgICBnX3B0cl9hcnJheV91bnJlZihk
ZXZpY2VzKTsKICAgICB9CiAKKyAgICBzcGljZV91c2JfZGV2aWNlX3dpZGdldF9hZGRfZW1wdHlf
Y2Qoc2VsZik7CisKICAgICBzcGljZV91c2JfZGV2aWNlX3dpZGdldF91cGRhdGVfc3RhdHVzKHNl
bGYpOwogfQogCkBAIC01NTQsNiArNjIzLDE1IEBAIHN0YXRpYyB2b2lkIGRldmljZV9hZGRlZF9j
YihTcGljZVVzYkRldmljZU1hbmFnZXIgKm1hbmFnZXIsCiAKICAgICBndGtfd2lkZ2V0X3NldF9t
YXJnaW5fc3RhcnQoY2hlY2ssIDEyKTsKICAgICBndGtfYm94X3BhY2tfZW5kKEdUS19CT1goc2Vs
ZiksIGNoZWNrLCBGQUxTRSwgRkFMU0UsIDApOworICAgIGlmIChwcml2LT5lbXB0eV9jZCkgewor
ICAgICAgICBndGtfYm94X3Jlb3JkZXJfY2hpbGQoR1RLX0JPWChzZWxmKSwgcHJpdi0+ZW1wdHlf
Y2QsIC0xKTsKKyAgICAgICAgaWYgKHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9pc19kZXZpY2Vf
c2hhcmVkX2NkKHByaXYtPm1hbmFnZXIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2UpICYmCisgICAgICAgICAgICAhZ3RrX3Rv
Z2dsZV9idXR0b25fZ2V0X2FjdGl2ZShHVEtfVE9HR0xFX0JVVFRPTihjaGVjaykpKSB7CisgICAg
ICAgICAgICAgICAgLyogY2hlY2tib3ggdG9nZ2wgd2lsbCBpbml0aWF0ZSByZWRpcmVjdCAqLwor
ICAgICAgICAgICAgICAgIGd0a190b2dnbGVfYnV0dG9uX3NldF9hY3RpdmUoR1RLX1RPR0dMRV9C
VVRUT04oY2hlY2spLCBUUlVFKTsKKyAgICAgICAgfQorICAgIH0KICAgICBzcGljZV91c2JfZGV2
aWNlX3dpZGdldF91cGRhdGVfc3RhdHVzKHNlbGYpOwogICAgIGd0a193aWRnZXRfc2hvd19hbGwo
Y2hlY2spOwogfQotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpTcGljZS1kZXZlbCBtYWlsaW5nIGxpc3QKU3BpY2UtZGV2ZWxAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vc3BpY2UtZGV2ZWw=
