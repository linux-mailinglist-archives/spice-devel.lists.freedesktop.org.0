Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 45A4A712D3
	for <lists+spice-devel@lfdr.de>; Tue, 23 Jul 2019 09:27:44 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id AE63F6E0F0;
	Tue, 23 Jul 2019 07:27:42 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail-wm1-x32f.google.com (mail-wm1-x32f.google.com
 [IPv6:2a00:1450:4864:20::32f])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 32B496E0F0
 for <spice-devel@lists.freedesktop.org>; Tue, 23 Jul 2019 07:27:41 +0000 (UTC)
Received: by mail-wm1-x32f.google.com with SMTP id f17so37479000wme.2
 for <spice-devel@lists.freedesktop.org>; Tue, 23 Jul 2019 00:27:41 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=DEEVOC52DZomwfbxCAf396UgYO61Vft9zgeEl6Pr7Ns=;
 b=k7l8dcMijzbA5OzLAJBrpeBv7NE+PQYt5XBAnfpbUgu5KOUDEQOopv9KWVvKMTfiqM
 lpw/1QZSIEQb2OVedSydlj0eYHiZ2rMi/rtWNhD+tO7mhxy0f1uTKCR3HHJOBNTf9+X7
 Vy0IQ4IMJT536k4g40244ztQLbJ8fK7PhypQ0PNMoObVDYAy+oLivYN68sqmY2pWtGZn
 BxJpIoQ5qSYoPfNi5acS5LkaMsnyyOPqVINAoNlnKlSaxxSZgCkbWNced84HTWHjMyDd
 5jmtffXWCHn+l6vEanQTX3QztrmH59dxtjS+L2h38GsOd9v9SOW2xbLAvQazUHGmQGKZ
 h+0Q==
X-Gm-Message-State: APjAAAXU+J65kiAuUO6qU0sLvTheVSueI+f54hGYgrdNBWUE4fw13NVC
 A5WDOzTULh9DReI6ObwkoCmoS2hx
X-Google-Smtp-Source: APXvYqz0obT+0CuEuTY/gCojGdmJoRrjXDTKzADkWvxyHn4Q+uPk0ZtJGsMRdRdu1LzBy+fWUeKpyw==
X-Received: by 2002:a7b:c04f:: with SMTP id u15mr66454597wmc.106.1563866859575; 
 Tue, 23 Jul 2019 00:27:39 -0700 (PDT)
Received: from f2.redhat.com (bzq-79-182-115-245.red.bezeqint.net.
 [79.182.115.245])
 by smtp.gmail.com with ESMTPSA id y7sm31495613wmm.19.2019.07.23.00.27.38
 (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
 Tue, 23 Jul 2019 00:27:39 -0700 (PDT)
From: Yuri Benditovich <yuri.benditovich@daynix.com>
To: spice-devel@lists.freedesktop.org
Date: Tue, 23 Jul 2019 10:27:01 +0300
Message-Id: <20190723072708.2575-3-yuri.benditovich@daynix.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190723072708.2575-1-yuri.benditovich@daynix.com>
References: <20190723072708.2575-1-yuri.benditovich@daynix.com>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=daynix-com.20150623.gappssmtp.com; s=20150623;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=DEEVOC52DZomwfbxCAf396UgYO61Vft9zgeEl6Pr7Ns=;
 b=J77SnhhN9Rm8AdDcjZIfdJKl8bAGMAJUJaRn+3FTkWXBE81j0r0tWLAAz6sPZqI53H
 MYu2t2sIos3o+E03gJ/Zq4kgdMIaw580Z0hNmjkiLvCDun6OSQLKT+PSy4Wr8ellBqon
 2PMVmt0P+9RTupacgELlIEX5rgA8s/gZF6SfCLgwmPrAGD5/tyge/ruSH4s/jwJWJnuP
 dNCb8aEMtnWyWFMw7zhjABf8GggKYMYFu9AGbmnyLCIRBAEfm92YvcUj4mINW2eAK9sU
 7JIOCzdutRS3SnWpMHC5oWbk/DjSmPzSvXnMPRjcnLeuHb8UOtahLu5C0InxCfOMnWEG
 SC5w==
Subject: [Spice-devel] [spice-gtk v2 2/9] usb-redir: move 3 static
 procedures up for further reuse
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: yan@daynix.com
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

UHJvY2VkdXJlcyBtb3ZlZCB3aXRob3V0IGNoYW5nZXMsIHRoZXkgd2lsbCBiZSByZXVzZWQKaW4g
bGF0ZXIgY29tbWl0cy4KClNpZ25lZC1vZmYtYnk6IFl1cmkgQmVuZGl0b3ZpY2ggPHl1cmkuYmVu
ZGl0b3ZpY2hAZGF5bml4LmNvbT4KLS0tCiBzcmMvdXNiLWJhY2tlbmQuYyB8IDExMCArKysrKysr
KysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwg
NTUgaW5zZXJ0aW9ucygrKSwgNTUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvc3JjL3VzYi1i
YWNrZW5kLmMgYi9zcmMvdXNiLWJhY2tlbmQuYwppbmRleCBhMmM1MDJkLi5hMzNjYmU2IDEwMDY0
NAotLS0gYS9zcmMvdXNiLWJhY2tlbmQuYworKysgYi9zcmMvdXNiLWJhY2tlbmQuYwpAQCAtNjks
NiArNjksNjEgQEAgc3RydWN0IF9TcGljZVVzYkJhY2tlbmRDaGFubmVsCiAgICAgR0Vycm9yICoq
ZXJyb3I7CiB9OwogCitzdGF0aWMgZ2Jvb2xlYW4gZmlsbF91c2JfaW5mbyhTcGljZVVzYkJhY2tl
bmREZXZpY2UgKmJkZXYpCit7CisgICAgVXNiRGV2aWNlSW5mb3JtYXRpb24gKmluZm8gPSAmYmRl
di0+ZGV2aWNlX2luZm87CisKKyAgICBzdHJ1Y3QgbGlidXNiX2RldmljZV9kZXNjcmlwdG9yIGRl
c2M7CisgICAgbGlidXNiX2RldmljZSAqbGliZGV2ID0gYmRldi0+bGlidXNiX2RldmljZTsKKyAg
ICBsaWJ1c2JfZ2V0X2RldmljZV9kZXNjcmlwdG9yKGxpYmRldiwgJmRlc2MpOworICAgIGluZm8t
PmJ1cyA9IGxpYnVzYl9nZXRfYnVzX251bWJlcihsaWJkZXYpOworICAgIGluZm8tPmFkZHJlc3Mg
PSBsaWJ1c2JfZ2V0X2RldmljZV9hZGRyZXNzKGxpYmRldik7CisgICAgaWYgKGluZm8tPmFkZHJl
c3MgPT0gMHhmZiB8fCAvKiByb290IGh1YiAoSENEKSAqLworICAgICAgICBpbmZvLT5hZGRyZXNz
IDw9IDEgfHwgLyogcm9vdCBodWIgb3IgYmFkIGFkZHJlc3MgKi8KKyAgICAgICAgKGRlc2MuYkRl
dmljZUNsYXNzID09IExJQlVTQl9DTEFTU19IVUIpIC8qaHViKi8pIHsKKyAgICAgICAgcmV0dXJu
IEZBTFNFOworICAgIH0KKworICAgIGluZm8tPnZpZCA9IGRlc2MuaWRWZW5kb3I7CisgICAgaW5m
by0+cGlkID0gZGVzYy5pZFByb2R1Y3Q7CisgICAgaW5mby0+Y2xhc3MgPSBkZXNjLmJEZXZpY2VD
bGFzczsKKyAgICBpbmZvLT5zdWJjbGFzcyA9IGRlc2MuYkRldmljZVN1YkNsYXNzOworICAgIGlu
Zm8tPnByb3RvY29sID0gZGVzYy5iRGV2aWNlUHJvdG9jb2w7CisKKyAgICByZXR1cm4gVFJVRTsK
K30KKworc3RhdGljIFNwaWNlVXNiQmFja2VuZERldmljZSAqYWxsb2NhdGVfYmFja2VuZF9kZXZp
Y2UobGlidXNiX2RldmljZSAqbGliZGV2KQoreworICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAq
ZGV2ID0gZ19uZXcwKFNwaWNlVXNiQmFja2VuZERldmljZSwgMSk7CisgICAgZGV2LT5yZWZfY291
bnQgPSAxOworICAgIGRldi0+bGlidXNiX2RldmljZSA9IGxpYmRldjsKKyAgICBpZiAoIWZpbGxf
dXNiX2luZm8oZGV2KSkgeworICAgICAgICBnX2NsZWFyX3BvaW50ZXIoJmRldiwgZ19mcmVlKTsK
KyAgICB9CisgICAgcmV0dXJuIGRldjsKK30KKworc3RhdGljIGludCBMSUJVU0JfQ0FMTCBob3Rw
bHVnX2NhbGxiYWNrKGxpYnVzYl9jb250ZXh0ICpjdHgsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgbGlidXNiX2RldmljZSAqZGV2aWNlLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnVzYl9ob3RwbHVnX2V2ZW50IGV2ZW50LAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKnVzZXJfZGF0YSkKK3sK
KyAgICBTcGljZVVzYkJhY2tlbmQgKmJlID0gKFNwaWNlVXNiQmFja2VuZCAqKXVzZXJfZGF0YTsK
KyAgICBpZiAoYmUtPmhvdHBsdWdfY2FsbGJhY2spIHsKKyAgICAgICAgU3BpY2VVc2JCYWNrZW5k
RGV2aWNlICpkZXY7CisgICAgICAgIGdib29sZWFuIHZhbCA9IGV2ZW50ID09IExJQlVTQl9IT1RQ
TFVHX0VWRU5UX0RFVklDRV9BUlJJVkVEOworICAgICAgICBkZXYgPSBhbGxvY2F0ZV9iYWNrZW5k
X2RldmljZShkZXZpY2UpOworICAgICAgICBpZiAoZGV2KSB7CisgICAgICAgICAgICBTUElDRV9E
RUJVRygiY3JlYXRlZCBkZXYgJXAsIHVzYmxpYiBkZXYgJXAiLCBkZXYsIGRldmljZSk7CisgICAg
ICAgICAgICBsaWJ1c2JfcmVmX2RldmljZShkZXZpY2UpOworICAgICAgICAgICAgYmUtPmhvdHBs
dWdfY2FsbGJhY2soYmUtPmhvdHBsdWdfdXNlcl9kYXRhLCBkZXYsIHZhbCk7CisgICAgICAgICAg
ICBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfdW5yZWYoZGV2KTsKKyAgICAgICAgfQorICAgIH0K
KyAgICByZXR1cm4gMDsKK30KKwogLyogbG9jayBmdW5jdGlvbnMgZm9yIHVzYnJlZGlyaG9zdCBh
bmQgdXNicmVkaXJwYXJzZXIgKi8KIHN0YXRpYyB2b2lkICp1c2JyZWRpcl9hbGxvY19sb2NrKHZv
aWQpIHsKICAgICBHTXV0ZXggKm11dGV4OwpAQCAtMTMxLDQxICsxODYsNiBAQCBnYm9vbGVhbiBz
cGljZV91c2JfYmFja2VuZF9kZXZpY2VfaXNvY2goU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYp
CiAgICAgcmV0dXJuIGlzb2NfZm91bmQ7CiB9CiAKLXN0YXRpYyBnYm9vbGVhbiBmaWxsX3VzYl9p
bmZvKFNwaWNlVXNiQmFja2VuZERldmljZSAqYmRldikKLXsKLSAgICBVc2JEZXZpY2VJbmZvcm1h
dGlvbiAqaW5mbyA9ICZiZGV2LT5kZXZpY2VfaW5mbzsKLQotICAgIHN0cnVjdCBsaWJ1c2JfZGV2
aWNlX2Rlc2NyaXB0b3IgZGVzYzsKLSAgICBsaWJ1c2JfZGV2aWNlICpsaWJkZXYgPSBiZGV2LT5s
aWJ1c2JfZGV2aWNlOwotICAgIGxpYnVzYl9nZXRfZGV2aWNlX2Rlc2NyaXB0b3IobGliZGV2LCAm
ZGVzYyk7Ci0gICAgaW5mby0+YnVzID0gbGlidXNiX2dldF9idXNfbnVtYmVyKGxpYmRldik7Ci0g
ICAgaW5mby0+YWRkcmVzcyA9IGxpYnVzYl9nZXRfZGV2aWNlX2FkZHJlc3MobGliZGV2KTsKLSAg
ICBpZiAoaW5mby0+YWRkcmVzcyA9PSAweGZmIHx8IC8qIHJvb3QgaHViIChIQ0QpICovCi0gICAg
ICAgIGluZm8tPmFkZHJlc3MgPD0gMSB8fCAvKiByb290IGh1YiBvciBiYWQgYWRkcmVzcyAqLwot
ICAgICAgICAoZGVzYy5iRGV2aWNlQ2xhc3MgPT0gTElCVVNCX0NMQVNTX0hVQikgLypodWIqLykg
ewotICAgICAgICByZXR1cm4gRkFMU0U7Ci0gICAgfQotCi0gICAgaW5mby0+dmlkID0gZGVzYy5p
ZFZlbmRvcjsKLSAgICBpbmZvLT5waWQgPSBkZXNjLmlkUHJvZHVjdDsKLSAgICBpbmZvLT5jbGFz
cyA9IGRlc2MuYkRldmljZUNsYXNzOwotICAgIGluZm8tPnN1YmNsYXNzID0gZGVzYy5iRGV2aWNl
U3ViQ2xhc3M7Ci0gICAgaW5mby0+cHJvdG9jb2wgPSBkZXNjLmJEZXZpY2VQcm90b2NvbDsKLQot
ICAgIHJldHVybiBUUlVFOwotfQotCi1zdGF0aWMgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICphbGxv
Y2F0ZV9iYWNrZW5kX2RldmljZShsaWJ1c2JfZGV2aWNlICpsaWJkZXYpCi17Ci0gICAgU3BpY2VV
c2JCYWNrZW5kRGV2aWNlICpkZXYgPSBnX25ldzAoU3BpY2VVc2JCYWNrZW5kRGV2aWNlLCAxKTsK
LSAgICBkZXYtPnJlZl9jb3VudCA9IDE7Ci0gICAgZGV2LT5saWJ1c2JfZGV2aWNlID0gbGliZGV2
OwotICAgIGlmICghZmlsbF91c2JfaW5mbyhkZXYpKSB7Ci0gICAgICAgIGdfY2xlYXJfcG9pbnRl
cigmZGV2LCBnX2ZyZWUpOwotICAgIH0KLSAgICByZXR1cm4gZGV2OwotfQotCiBzdGF0aWMgZ2Jv
b2xlYW4gaXNfY2hhbm5lbF9yZWFkeShTcGljZVVzYnJlZGlyQ2hhbm5lbCAqY2hhbm5lbCkKIHsK
ICAgICByZXR1cm4gc3BpY2VfY2hhbm5lbF9nZXRfc3RhdGUoU1BJQ0VfQ0hBTk5FTChjaGFubmVs
KSkgPT0gU1BJQ0VfQ0hBTk5FTF9TVEFURV9SRUFEWTsKQEAgLTIzNywyNiArMjU3LDYgQEAgdm9p
ZCBzcGljZV91c2JfYmFja2VuZF9pbnRlcnJ1cHRfZXZlbnRfaGFuZGxlcihTcGljZVVzYkJhY2tl
bmQgKmJlKQogICAgIH0KIH0KIAotc3RhdGljIGludCBMSUJVU0JfQ0FMTCBob3RwbHVnX2NhbGxi
YWNrKGxpYnVzYl9jb250ZXh0ICpjdHgsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbGlidXNiX2RldmljZSAqZGV2aWNlLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGxpYnVzYl9ob3RwbHVnX2V2ZW50IGV2ZW50LAotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKnVzZXJfZGF0YSkKLXsKLSAgICBTcGlj
ZVVzYkJhY2tlbmQgKmJlID0gKFNwaWNlVXNiQmFja2VuZCAqKXVzZXJfZGF0YTsKLSAgICBpZiAo
YmUtPmhvdHBsdWdfY2FsbGJhY2spIHsKLSAgICAgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpk
ZXY7Ci0gICAgICAgIGdib29sZWFuIHZhbCA9IGV2ZW50ID09IExJQlVTQl9IT1RQTFVHX0VWRU5U
X0RFVklDRV9BUlJJVkVEOwotICAgICAgICBkZXYgPSBhbGxvY2F0ZV9iYWNrZW5kX2RldmljZShk
ZXZpY2UpOwotICAgICAgICBpZiAoZGV2KSB7Ci0gICAgICAgICAgICBTUElDRV9ERUJVRygiY3Jl
YXRlZCBkZXYgJXAsIHVzYmxpYiBkZXYgJXAiLCBkZXYsIGRldmljZSk7Ci0gICAgICAgICAgICBs
aWJ1c2JfcmVmX2RldmljZShkZXZpY2UpOwotICAgICAgICAgICAgYmUtPmhvdHBsdWdfY2FsbGJh
Y2soYmUtPmhvdHBsdWdfdXNlcl9kYXRhLCBkZXYsIHZhbCk7Ci0gICAgICAgICAgICBzcGljZV91
c2JfYmFja2VuZF9kZXZpY2VfdW5yZWYoZGV2KTsKLSAgICAgICAgfQotICAgIH0KLSAgICByZXR1
cm4gMDsKLX0KLQogdm9pZCBzcGljZV91c2JfYmFja2VuZF9kZXJlZ2lzdGVyX2hvdHBsdWcoU3Bp
Y2VVc2JCYWNrZW5kICpiZSkKIHsKICAgICBnX3JldHVybl9pZl9mYWlsKGJlICE9IE5VTEwpOwot
LSAKMi4xNy4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpTcGljZS1kZXZlbCBtYWlsaW5nIGxpc3QKU3BpY2UtZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Au
b3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vc3BpY2Ut
ZGV2ZWw=
