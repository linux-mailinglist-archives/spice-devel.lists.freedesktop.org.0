Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 5E402D0AFB
	for <lists+spice-devel@lfdr.de>; Wed,  9 Oct 2019 11:23:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CD8296E941;
	Wed,  9 Oct 2019 09:23:18 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C790C6E941
 for <spice-devel@lists.freedesktop.org>; Wed,  9 Oct 2019 09:23:16 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx03.intmail.prod.int.phx2.redhat.com
 [10.5.11.13])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 712DE81DE1
 for <spice-devel@lists.freedesktop.org>; Wed,  9 Oct 2019 09:23:16 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.15])
 by smtp.corp.redhat.com (Postfix) with ESMTP id A6EF260920;
 Wed,  9 Oct 2019 09:23:12 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Wed,  9 Oct 2019 10:23:00 +0100
Message-Id: <20191009092302.15025-4-fziglio@redhat.com>
In-Reply-To: <20191009092302.15025-1-fziglio@redhat.com>
References: <20191009092302.15025-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.13
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.25]); Wed, 09 Oct 2019 09:23:16 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-server v3 3/5] test-stream-device:
 Factor out VMC emulation
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

QWxsb3dzIHRvIHJldXNlIGNvZGUgZm9yIGVtdWxhdGluZyBhIGNoYXJhY3RlciBkZXZpY2UuCkl0
IHdpbGwgYmUgdXNlZCBmb3IgU21hcmRjYXJkIHRlc3QuCgpTaWduZWQtb2ZmLWJ5OiBGcmVkaWFu
byBaaWdsaW8gPGZ6aWdsaW9AcmVkaGF0LmNvbT4KQWNrZWQtYnk6IFZpY3RvciBUb3NvIDx2aWN0
b3J0b3NvQHJlZGhhdC5jb20+Ci0tLQogc2VydmVyL3Rlc3RzL01ha2VmaWxlLmFtICAgICAgICAg
IHwgICAyICsKIHNlcnZlci90ZXN0cy9tZXNvbi5idWlsZCAgICAgICAgICB8ICAgMiArCiBzZXJ2
ZXIvdGVzdHMvdGVzdC1zdHJlYW0tZGV2aWNlLmMgfCAyMjQgKysrKysrKysrLS0tLS0tLS0tLS0t
LS0tLS0tLS0tCiBzZXJ2ZXIvdGVzdHMvdm1jLWVtdS5jICAgICAgICAgICAgfCAxMjEgKysrKysr
KysrKysrKysrKwogc2VydmVyL3Rlc3RzL3ZtYy1lbXUuaCAgICAgICAgICAgIHwgIDQ4ICsrKysr
KysKIDUgZmlsZXMgY2hhbmdlZCwgMjM2IGluc2VydGlvbnMoKyksIDE2MSBkZWxldGlvbnMoLSkK
IGNyZWF0ZSBtb2RlIDEwMDY0NCBzZXJ2ZXIvdGVzdHMvdm1jLWVtdS5jCiBjcmVhdGUgbW9kZSAx
MDA2NDQgc2VydmVyL3Rlc3RzL3ZtYy1lbXUuaAoKZGlmZiAtLWdpdCBhL3NlcnZlci90ZXN0cy9N
YWtlZmlsZS5hbSBiL3NlcnZlci90ZXN0cy9NYWtlZmlsZS5hbQppbmRleCAxZTYyNTU3YTguLjk4
MjUwODUxMCAxMDA2NDQKLS0tIGEvc2VydmVyL3Rlc3RzL01ha2VmaWxlLmFtCisrKyBiL3NlcnZl
ci90ZXN0cy9NYWtlZmlsZS5hbQpAQCAtMzcsNiArMzcsOCBAQCBsaWJ0ZXN0X2FfU09VUkNFUyA9
CQkJCVwKIAl0ZXN0LWdsaWItY29tcGF0LmgJCQlcCiAJd2luLWFsYXJtLmMJCQkJXAogCXdpbi1h
bGFybS5oCQkJCVwKKwl2bWMtZW11LmMJCQkJXAorCXZtYy1lbXUuaAkJCQlcCiAJJChOVUxMKQog
CiBMREFERCA9CQkJCQkJCQlcCmRpZmYgLS1naXQgYS9zZXJ2ZXIvdGVzdHMvbWVzb24uYnVpbGQg
Yi9zZXJ2ZXIvdGVzdHMvbWVzb24uYnVpbGQKaW5kZXggYzkzNzdmMWViLi4zMzQ3MmYxNGUgMTAw
NjQ0Ci0tLSBhL3NlcnZlci90ZXN0cy9tZXNvbi5idWlsZAorKysgYi9zZXJ2ZXIvdGVzdHMvbWVz
b24uYnVpbGQKQEAgLTEzLDYgKzEzLDggQEAgdGVzdF9saWJfc291cmNlcyA9IFsKICAgJ3Rlc3Qt
Z2xpYi1jb21wYXQuaCcsCiAgICd3aW4tYWxhcm0uYycsCiAgICd3aW4tYWxhcm0uaCcsCisgICd2
bWMtZW11LmMnLAorICAndm1jLWVtdS5oJywKIF0KIAogdGVzdF9saWJzID0gW10KZGlmZiAtLWdp
dCBhL3NlcnZlci90ZXN0cy90ZXN0LXN0cmVhbS1kZXZpY2UuYyBiL3NlcnZlci90ZXN0cy90ZXN0
LXN0cmVhbS1kZXZpY2UuYwppbmRleCBhNWU4NWYxMTguLmFiZjY2ZjA0MyAxMDA2NDQKLS0tIGEv
c2VydmVyL3Rlc3RzL3Rlc3Qtc3RyZWFtLWRldmljZS5jCisrKyBiL3NlcnZlci90ZXN0cy90ZXN0
LXN0cmVhbS1kZXZpY2UuYwpAQCAtMzQsODQgKzM0LDkgQEAKICNpbmNsdWRlICJzdHJlYW0tY2hh
bm5lbC5oIgogI2luY2x1ZGUgInJlZHMuaCIKICNpbmNsdWRlICJ3aW4tYWxhcm0uaCIKKyNpbmNs
dWRlICJ2bWMtZW11LmgiCiAKLXN0YXRpYyBTcGljZUNoYXJEZXZpY2VJbnN0YW5jZSB2bWNfaW5z
dGFuY2U7Ci0KLS8vIGRldmljZSBidWZmZXIgdG8gcmVhZCBmcm9tCi1zdGF0aWMgdWludDhfdCBt
ZXNzYWdlWzIwNDhdOwotLy8gcG9zaXRpb24gdG8gcmVhZCBmcm9tCi1zdGF0aWMgdW5zaWduZWQg
cG9zOwotLy8gYXJyYXkgb2YgbGltaXRzIHdoZW4gdGhlIHJlYWQgc2hvdWxkIHJldHVybgotLy8g
dGhlIGFycmF5IGlzIGRlZmluZWQgYXMgW21lc3NhZ2Vfc2l6ZXNfY3VyciwgbWVzc2FnZV9zaXpl
c19lbmQpCi0vLyB0aGVuIHRoZSBzaXplIGlzIHJlYWNoIHdlIG1vdmUgb24gbmV4dCBvbmUgdGls
bCBleGF1c3RlZAotc3RhdGljIHVuc2lnbmVkIG1lc3NhZ2Vfc2l6ZXNbMTZdOwotc3RhdGljIHVu
c2lnbmVkICptZXNzYWdlX3NpemVzX2VuZCwgKm1lc3NhZ2Vfc2l6ZXNfY3VycjsKLXN0YXRpYyBi
b29sIGRldmljZV9lbmFibGVkID0gZmFsc2U7Ci0KLXN0YXRpYyB1bnNpZ25lZCB2bWNfd3JpdGVf
cG9zOwotc3RhdGljIHVpbnQ4X3Qgdm1jX3dyaXRlX2J1ZlsyMDQ4XTsKLQotLy8gaGFuZGxlIHdy
aXRlcyB0byB0aGUgZGV2aWNlCi1zdGF0aWMgaW50IHZtY193cml0ZShTUElDRV9HTlVDX1VOVVNF
RCBTcGljZUNoYXJEZXZpY2VJbnN0YW5jZSAqc2luLAotICAgICAgICAgICAgICAgICAgICAgU1BJ
Q0VfR05VQ19VTlVTRUQgY29uc3QgdWludDhfdCAqYnVmLAotICAgICAgICAgICAgICAgICAgICAg
aW50IGxlbikKLXsKLSAgICAvLyBqdXN0IGNvcHkgaW50byB0aGUgYnVmZmVyCi0gICAgdW5zaWdu
ZWQgY29weSA9IE1JTihzaXplb2Yodm1jX3dyaXRlX2J1ZikgLSB2bWNfd3JpdGVfcG9zLCBsZW4p
OwotICAgIG1lbWNweSh2bWNfd3JpdGVfYnVmK3ZtY193cml0ZV9wb3MsIGJ1ZiwgY29weSk7Ci0g
ICAgdm1jX3dyaXRlX3BvcyArPSBjb3B5OwotICAgIHJldHVybiBsZW47Ci19Ci0KLXN0YXRpYyBp
bnQgdm1jX3JlYWQoU1BJQ0VfR05VQ19VTlVTRUQgU3BpY2VDaGFyRGV2aWNlSW5zdGFuY2UgKnNp
biwKLSAgICAgICAgICAgICAgICAgICAgdWludDhfdCAqYnVmLAotICAgICAgICAgICAgICAgICAg
ICBpbnQgbGVuKQotewotICAgIGludCByZXQ7Ci0KLSAgICBpZiAocG9zID49ICptZXNzYWdlX3Np
emVzX2N1cnIgJiYgbWVzc2FnZV9zaXplc19jdXJyIDwgbWVzc2FnZV9zaXplc19lbmQpIHsKLSAg
ICAgICAgKyttZXNzYWdlX3NpemVzX2N1cnI7Ci0gICAgfQotICAgIGlmIChtZXNzYWdlX3NpemVz
X2N1cnIgPj0gbWVzc2FnZV9zaXplc19lbmQgfHwgcG9zID49ICptZXNzYWdlX3NpemVzX2N1cnIp
IHsKLSAgICAgICAgcmV0dXJuIDA7Ci0gICAgfQotICAgIHJldCA9IE1JTigqbWVzc2FnZV9zaXpl
c19jdXJyIC0gcG9zLCBsZW4pOwotICAgIG1lbWNweShidWYsICZtZXNzYWdlW3Bvc10sIHJldCk7
Ci0gICAgcG9zICs9IHJldDsKLSAgICAvLyBraWNrIG9mZiBuZXh0IG1lc3NhZ2UgcmVhZAotICAg
IC8vIGN1cnJlbnRseSBRZW11IGtpY2tzIHRoZSBkZXZpY2Ugc28gd2UgbmVlZCB0byBkbyBpdCBt
YW51YWxseQotICAgIC8vIGhlcmUuIElmIG5vdCBhbGwgZGF0YSBhcmUgcmVhZCwgdGhlIGRldmlj
ZSBnb2VzIGludG8gYmxvY2tpbmcKLSAgICAvLyBzdGF0ZSBhbmQgd2UgZ2V0IHRoZSB3YWtlIG9u
bHkgd2hlbiB3ZSByZWFkIGZyb20gdGhlIGRldmljZQotICAgIC8vIGFnYWluCi0gICAgaWYgKHBv
cyA+PSAqbWVzc2FnZV9zaXplc19jdXJyKSB7Ci0gICAgICAgIHNwaWNlX3NlcnZlcl9jaGFyX2Rl
dmljZV93YWtldXAoJnZtY19pbnN0YW5jZSk7Ci0gICAgfQotICAgIHJldHVybiByZXQ7Ci19Ci0K
LXN0YXRpYyB2b2lkIHZtY19zdGF0ZShTUElDRV9HTlVDX1VOVVNFRCBTcGljZUNoYXJEZXZpY2VJ
bnN0YW5jZSAqc2luLAotICAgICAgICAgICAgICAgICAgICAgIFNQSUNFX0dOVUNfVU5VU0VEIGlu
dCBjb25uZWN0ZWQpCi17Ci0gICAgZGV2aWNlX2VuYWJsZWQgPSAhIWNvbm5lY3RlZDsKLX0KLQot
c3RhdGljIFNwaWNlQ2hhckRldmljZUludGVyZmFjZSB2bWNfaW50ZXJmYWNlID0gewotICAgIC5i
YXNlID0gewotICAgICAgICAudHlwZSAgICAgICAgICA9IFNQSUNFX0lOVEVSRkFDRV9DSEFSX0RF
VklDRSwKLSAgICAgICAgLmRlc2NyaXB0aW9uICAgPSAidGVzdCBzcGljZSB2aXJ0dWFsIGNoYW5u
ZWwgY2hhciBkZXZpY2UiLAotICAgICAgICAubWFqb3JfdmVyc2lvbiA9IFNQSUNFX0lOVEVSRkFD
RV9DSEFSX0RFVklDRV9NQUpPUiwKLSAgICAgICAgLm1pbm9yX3ZlcnNpb24gPSBTUElDRV9JTlRF
UkZBQ0VfQ0hBUl9ERVZJQ0VfTUlOT1IsCi0gICAgfSwKLSAgICAuc3RhdGUgICAgICAgICAgICAg
ID0gdm1jX3N0YXRlLAotICAgIC53cml0ZSAgICAgICAgICAgICAgPSB2bWNfd3JpdGUsCi0gICAg
LnJlYWQgICAgICAgICAgICAgICA9IHZtY19yZWFkLAotfTsKLQotLy8gdGhpcyBzcGVjaWZpY2Fs
bHkgY3JlYXRlcyBhIHN0cmVhbSBkZXZpY2UKLXN0YXRpYyBTcGljZUNoYXJEZXZpY2VJbnN0YW5j
ZSB2bWNfaW5zdGFuY2UgPSB7Ci0gICAgLnN1YnR5cGUgPSAicG9ydCIsCi0gICAgLnBvcnRuYW1l
ID0gIm9yZy5zcGljZS1zcGFjZS5zdHJlYW0uMCIsCi19Oworc3RhdGljIFZtY0VtdSAqdm1jOwog
CiBzdGF0aWMgdWludDhfdCAqYWRkX3N0cmVhbV9oZHIodWludDhfdCAqcCwgU3RyZWFtTXNnVHlw
ZSB0eXBlLCB1aW50MzJfdCBzaXplKQogewpAQCAtMTQ1LDE4ICs3MCwxOCBAQCBkaXNjYXJkX3Nl
cnZlcl9jYXBhYmlsaXRpZXModm9pZCkKIHsKICAgICBTdHJlYW1EZXZIZWFkZXIgaGRyOwogCi0g
ICAgaWYgKHZtY193cml0ZV9wb3MgPT0gMCkgeworICAgIGlmICh2bWMtPndyaXRlX3BvcyA9PSAw
KSB7CiAgICAgICAgIHJldHVybjsKICAgICB9Ci0gICAgZ19hc3NlcnQodm1jX3dyaXRlX3BvcyA+
PSBzaXplb2YoaGRyKSk7CisgICAgZ19hc3NlcnQodm1jLT53cml0ZV9wb3MgPj0gc2l6ZW9mKGhk
cikpOwogCi0gICAgbWVtY3B5KCZoZHIsIHZtY193cml0ZV9idWYsIHNpemVvZihoZHIpKTsKKyAg
ICBtZW1jcHkoJmhkciwgdm1jLT53cml0ZV9idWYsIHNpemVvZihoZHIpKTsKICAgICBoZHIudHlw
ZSA9IEdVSU5UMTZfRlJPTV9MRShoZHIudHlwZSk7CiAgICAgaGRyLnNpemUgPSBHVUlOVDMyX0ZS
T01fTEUoaGRyLnNpemUpOwogICAgIGlmIChoZHIudHlwZSA9PSBTVFJFQU1fVFlQRV9DQVBBQklM
SVRJRVMpIHsKLSAgICAgICAgZ19hc3NlcnRfY21waW50KGhkci5zaXplLCA8PSwgdm1jX3dyaXRl
X3BvcyAtIHNpemVvZihoZHIpKTsKLSAgICAgICAgdm1jX3dyaXRlX3BvcyAtPSBoZHIuc2l6ZSAr
IHNpemVvZihoZHIpOwotICAgICAgICBtZW1tb3ZlKHZtY193cml0ZV9idWYsIHZtY193cml0ZV9i
dWYgKyBoZHIuc2l6ZSArIHNpemVvZihoZHIpLCB2bWNfd3JpdGVfcG9zKTsKKyAgICAgICAgZ19h
c3NlcnRfY21waW50KGhkci5zaXplLCA8PSwgdm1jLT53cml0ZV9wb3MgLSBzaXplb2YoaGRyKSk7
CisgICAgICAgIHZtYy0+d3JpdGVfcG9zIC09IGhkci5zaXplICsgc2l6ZW9mKGhkcik7CisgICAg
ICAgIG1lbW1vdmUodm1jLT53cml0ZV9idWYsIHZtYy0+d3JpdGVfYnVmICsgaGRyLnNpemUgKyBz
aXplb2YoaGRyKSwgdm1jLT53cml0ZV9wb3MpOwogICAgIH0KIH0KIApAQCAtMTY4LDEyICs5Mywx
MiBAQCBjaGVja192bWNfZXJyb3JfbWVzc2FnZSh2b2lkKQogCiAgICAgZGlzY2FyZF9zZXJ2ZXJf
Y2FwYWJpbGl0aWVzKCk7CiAKLSAgICBnX2Fzc2VydF9jbXBpbnQodm1jX3dyaXRlX3BvcywgPj0g
LHNpemVvZihoZHIpKTsKKyAgICBnX2Fzc2VydF9jbXBpbnQodm1jLT53cml0ZV9wb3MsID49ICxz
aXplb2YoaGRyKSk7CiAKLSAgICBtZW1jcHkoJmhkciwgdm1jX3dyaXRlX2J1Ziwgc2l6ZW9mKGhk
cikpOworICAgIG1lbWNweSgmaGRyLCB2bWMtPndyaXRlX2J1Ziwgc2l6ZW9mKGhkcikpOwogICAg
IGdfYXNzZXJ0X2NtcGludChoZHIucHJvdG9jb2xfdmVyc2lvbiwgPT0sIFNUUkVBTV9ERVZJQ0Vf
UFJPVE9DT0wpOwogICAgIGdfYXNzZXJ0X2NtcGludChHVUlOVDE2X0ZST01fTEUoaGRyLnR5cGUp
LCA9PSwgU1RSRUFNX1RZUEVfTk9USUZZX0VSUk9SKTsKLSAgICBnX2Fzc2VydF9jbXBpbnQoR1VJ
TlQzMl9GUk9NX0xFKGhkci5zaXplKSwgPD0sIHZtY193cml0ZV9wb3MgLSBzaXplb2YoaGRyKSk7
CisgICAgZ19hc3NlcnRfY21waW50KEdVSU5UMzJfRlJPTV9MRShoZHIuc2l6ZSksIDw9LCB2bWMt
PndyaXRlX3BvcyAtIHNpemVvZihoZHIpKTsKIH0KIAogc3RhdGljIGludCBudW1fc2VuZF9kYXRh
X2NhbGxzID0gMDsKQEAgLTI0OSwxNSArMTc0LDEzIEBAIHN0YXRpYyB2b2lkIHRlc3Rfc3RyZWFt
X2RldmljZV9zZXR1cChUZXN0Rml4dHVyZSAqZml4dHVyZSwgZ2NvbnN0cG9pbnRlciB1c2VyX2Rh
CiB7CiAgICAgZ19hc3NlcnRfbnVsbChjb3JlKTsKICAgICBnX2Fzc2VydF9udWxsKHRlc3QpOwor
ICAgIGdfYXNzZXJ0X251bGwodm1jKTsKICAgICBjb3JlID0gYmFzaWNfZXZlbnRfbG9vcF9pbml0
KCk7CiAgICAgZ19hc3NlcnRfbm9ubnVsbChjb3JlKTsKICAgICB0ZXN0ID0gdGVzdF9uZXcoY29y
ZSk7CiAgICAgZ19hc3NlcnRfbm9ubnVsbCh0ZXN0KTsKLQotICAgIHBvcyA9IDA7Ci0gICAgdm1j
X3dyaXRlX3BvcyA9IDA7Ci0gICAgbWVzc2FnZV9zaXplc19jdXJyID0gbWVzc2FnZV9zaXplczsK
LSAgICBtZXNzYWdlX3NpemVzX2VuZCA9IG1lc3NhZ2Vfc2l6ZXM7CisgICAgdm1jID0gdm1jX2Vt
dV9uZXcoInBvcnQiLCAib3JnLnNwaWNlLXNwYWNlLnN0cmVhbS4wIik7CisgICAgZ19hc3NlcnRf
bm9ubnVsbCh2bWMpOwogCiAgICAgbnVtX3NlbmRfZGF0YV9jYWxscyA9IDA7CiAgICAgc2VuZF9k
YXRhX2J5dGVzID0gMDsKQEAgLTI2OCw2ICsxOTEsOCBAQCBzdGF0aWMgdm9pZCB0ZXN0X3N0cmVh
bV9kZXZpY2VfdGVhcmRvd24oVGVzdEZpeHR1cmUgKmZpeHR1cmUsIGdjb25zdHBvaW50ZXIgdXNl
cgogICAgIGdfYXNzZXJ0X25vbm51bGwoY29yZSk7CiAgICAgZ19hc3NlcnRfbm9ubnVsbCh0ZXN0
KTsKIAorICAgIHZtY19lbXVfZGVzdHJveSh2bWMpOworICAgIHZtYyA9IE5VTEw7CiAgICAgdGVz
dF9kZXN0cm95KHRlc3QpOwogICAgIHRlc3QgPSBOVUxMOwogICAgIGJhc2ljX2V2ZW50X2xvb3Bf
ZGVzdHJveSgpOwpAQCAtMjc2LDEyMiArMjAxLDEwOSBAQCBzdGF0aWMgdm9pZCB0ZXN0X3N0cmVh
bV9kZXZpY2VfdGVhcmRvd24oVGVzdEZpeHR1cmUgKmZpeHR1cmUsIGdjb25zdHBvaW50ZXIgdXNl
cgogCiBzdGF0aWMgdm9pZCB0ZXN0X2tpY2sodm9pZCkKIHsKLSAgICB2bWNfaW5zdGFuY2UuYmFz
ZS5zaWYgPSAmdm1jX2ludGVyZmFjZS5iYXNlOwotICAgIHNwaWNlX3NlcnZlcl9hZGRfaW50ZXJm
YWNlKHRlc3QtPnNlcnZlciwgJnZtY19pbnN0YW5jZS5iYXNlKTsKKyAgICBzcGljZV9zZXJ2ZXJf
YWRkX2ludGVyZmFjZSh0ZXN0LT5zZXJ2ZXIsICZ2bWMtPmluc3RhbmNlLmJhc2UpOwogCiAgICAg
Ly8gd2UgbmVlZCB0byBvcGVuIHRoZSBkZXZpY2UgYW5kIGtpY2sgdGhlIHN0YXJ0CiAgICAgLy8g
dGhlIGFsYXJtIGlzIHRvIHByZXZlbnQgdGhlIHByb2dyYW0gZnJvbSBnZXR0aW5nIHN0dWNrCiAg
ICAgYWxhcm0oNSk7Ci0gICAgc3BpY2Vfc2VydmVyX3BvcnRfZXZlbnQoJnZtY19pbnN0YW5jZSwg
U1BJQ0VfUE9SVF9FVkVOVF9PUEVORUQpOwotICAgIHNwaWNlX3NlcnZlcl9jaGFyX2RldmljZV93
YWtldXAoJnZtY19pbnN0YW5jZSk7CisgICAgc3BpY2Vfc2VydmVyX3BvcnRfZXZlbnQoJnZtYy0+
aW5zdGFuY2UsIFNQSUNFX1BPUlRfRVZFTlRfT1BFTkVEKTsKKyAgICBzcGljZV9zZXJ2ZXJfY2hh
cl9kZXZpY2Vfd2FrZXVwKCZ2bWMtPmluc3RhbmNlKTsKICAgICBhbGFybSgwKTsKIH0KIAogc3Rh
dGljIHZvaWQgdGVzdF9zdHJlYW1fZGV2aWNlKFRlc3RGaXh0dXJlICpmaXh0dXJlLCBnY29uc3Rw
b2ludGVyIHVzZXJfZGF0YSkKIHsKLSAgICB1aW50OF90ICpwID0gbWVzc2FnZTsKLQogICAgIGZv
ciAoaW50IHRlc3RfbnVtPTA7IHRlc3RfbnVtIDwgMjsgKyt0ZXN0X251bSkgewotICAgICAgICBw
b3MgPSAwOwotICAgICAgICB2bWNfd3JpdGVfcG9zID0gMDsKLSAgICAgICAgbWVzc2FnZV9zaXpl
c19jdXJyID0gbWVzc2FnZV9zaXplczsKLSAgICAgICAgbWVzc2FnZV9zaXplc19lbmQgPSBtZXNz
YWdlX3NpemVzOworICAgICAgICB2bWNfZW11X3Jlc2V0KHZtYyk7CisgICAgICAgIHVpbnQ4X3Qg
KnAgPSB2bWMtPm1lc3NhZ2U7CiAKICAgICAgICAgLy8gYWRkIHNvbWUgbWVzc2FnZXMgaW50byBk
ZXZpY2UgYnVmZmVyCiAgICAgICAgIC8vIGhlcmUgd2UgYXJlIHRlc3RpbmcgdGhlIGRldmljZSBp
cyByZWFkaW5nIGF0IGxlYXN0IHR3bwogICAgICAgICAvLyBjb25zZWN1dGl2ZSBmb3JtYXQgbWVz
c2FnZXMKICAgICAgICAgLy8gZmlyc3QgbWVzc2FnZSBwYXJ0IGhhcyAyIGV4dHJhIGJ5dGVzIHRv
IGNoZWNrIGZvciBoZWFkZXIgc3BsaXQKICAgICAgICAgcCA9IGFkZF9mb3JtYXQocCwgNjQwLCA0
ODAsIFNQSUNFX1ZJREVPX0NPREVDX1RZUEVfTUpQRUcpOwotICAgICAgICAqbWVzc2FnZV9zaXpl
c19lbmQgPSBwIC0gbWVzc2FnZSArIDI7Ci0gICAgICAgICsrbWVzc2FnZV9zaXplc19lbmQ7Cisg
ICAgICAgIHZtY19lbXVfYWRkX3JlYWRfdGlsbCh2bWMsIHAgKyAyKTsKIAogICAgICAgICBwID0g
YWRkX2Zvcm1hdChwLCA2NDAsIDQ4MCwgU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9WUDkpOwogCiAg
ICAgICAgIC8vIHRoaXMgc3BsaXQgdGhlIHNlY29uZCBmb3JtYXQgaW4gaGFsZgotICAgICAgICAq
bWVzc2FnZV9zaXplc19lbmQgPSBwIC0gbWVzc2FnZSAtIDQ7Ci0gICAgICAgICsrbWVzc2FnZV9z
aXplc19lbmQ7CisgICAgICAgIHZtY19lbXVfYWRkX3JlYWRfdGlsbCh2bWMsIHAgLSA0KTsKIAot
ICAgICAgICAqbWVzc2FnZV9zaXplc19lbmQgPSBwIC0gbWVzc2FnZTsKLSAgICAgICAgKyttZXNz
YWdlX3NpemVzX2VuZDsKKyAgICAgICAgdm1jX2VtdV9hZGRfcmVhZF90aWxsKHZtYywgcCk7CiAK
ICAgICAgICAgLy8gYWRkIGEgbWVzc2FnZSB0byBzdG9wIGRhdGEgdG8gYmUgcmVhZAogICAgICAg
ICBwID0gYWRkX3N0cmVhbV9oZHIocCwgU1RSRUFNX1RZUEVfSU5WQUxJRCwgMCk7Ci0gICAgICAg
ICptZXNzYWdlX3NpemVzX2VuZCA9IHAgLSBtZXNzYWdlOwotICAgICAgICArK21lc3NhZ2Vfc2l6
ZXNfZW5kOworICAgICAgICB2bWNfZW11X2FkZF9yZWFkX3RpbGwodm1jLCBwKTsKIAogICAgICAg
ICAvLyB0aGlzIG1lc3NhZ2Ugc2hvdWxkIG5vdCBiZSByZWFkCiAgICAgICAgIHAgPSBhZGRfc3Ry
ZWFtX2hkcihwLCBTVFJFQU1fVFlQRV9JTlZBTElELCAwKTsKLSAgICAgICAgKm1lc3NhZ2Vfc2l6
ZXNfZW5kID0gcCAtIG1lc3NhZ2U7Ci0gICAgICAgICsrbWVzc2FnZV9zaXplc19lbmQ7CisgICAg
ICAgIHZtY19lbXVfYWRkX3JlYWRfdGlsbCh2bWMsIHApOwogCi0gICAgICAgIHZtY19pbnN0YW5j
ZS5iYXNlLnNpZiA9ICZ2bWNfaW50ZXJmYWNlLmJhc2U7Ci0gICAgICAgIHNwaWNlX3NlcnZlcl9h
ZGRfaW50ZXJmYWNlKHRlc3QtPnNlcnZlciwgJnZtY19pbnN0YW5jZS5iYXNlKTsKKyAgICAgICAg
c3BpY2Vfc2VydmVyX2FkZF9pbnRlcmZhY2UodGVzdC0+c2VydmVyLCAmdm1jLT5pbnN0YW5jZS5i
YXNlKTsKIAogICAgICAgICAvLyBkZXZpY2Ugc2hvdWxkIG5vdCBoYXZlIHJlYWQgZGF0YSBiZWZv
cmUgd2Ugb3BlbiBpdAotICAgICAgICBzcGljZV9zZXJ2ZXJfY2hhcl9kZXZpY2Vfd2FrZXVwKCZ2
bWNfaW5zdGFuY2UpOwotICAgICAgICBnX2Fzc2VydF9jbXBpbnQocG9zLCA9PSwgMCk7CisgICAg
ICAgIHNwaWNlX3NlcnZlcl9jaGFyX2RldmljZV93YWtldXAoJnZtYy0+aW5zdGFuY2UpOworICAg
ICAgICBnX2Fzc2VydF9jbXBpbnQodm1jLT5wb3MsID09LCAwKTsKIAogICAgICAgICBnX3Rlc3Rf
ZXhwZWN0X21lc3NhZ2UoR19MT0dfRE9NQUlOLCBHX0xPR19MRVZFTF9XQVJOSU5HLCAiU3RyZWFt
IGRldmljZSByZWNlaXZlZCBpbnZhbGlkIG1lc3NhZ2U6IEludmFsaWQgbWVzc2FnZSB0eXBlIik7
CiAKICAgICAgICAgLy8gd2UgbmVlZCB0byBvcGVuIHRoZSBkZXZpY2UgYW5kIGtpY2sgdGhlIHN0
YXJ0Ci0gICAgICAgIHNwaWNlX3NlcnZlcl9wb3J0X2V2ZW50KCZ2bWNfaW5zdGFuY2UsIFNQSUNF
X1BPUlRfRVZFTlRfT1BFTkVEKTsKLSAgICAgICAgc3BpY2Vfc2VydmVyX2NoYXJfZGV2aWNlX3dh
a2V1cCgmdm1jX2luc3RhbmNlKTsKLSAgICAgICAgc3BpY2Vfc2VydmVyX3BvcnRfZXZlbnQoJnZt
Y19pbnN0YW5jZSwgU1BJQ0VfUE9SVF9FVkVOVF9DTE9TRUQpOworICAgICAgICBzcGljZV9zZXJ2
ZXJfcG9ydF9ldmVudCgmdm1jLT5pbnN0YW5jZSwgU1BJQ0VfUE9SVF9FVkVOVF9PUEVORUQpOwor
ICAgICAgICBzcGljZV9zZXJ2ZXJfY2hhcl9kZXZpY2Vfd2FrZXVwKCZ2bWMtPmluc3RhbmNlKTsK
KyAgICAgICAgc3BpY2Vfc2VydmVyX3BvcnRfZXZlbnQoJnZtYy0+aW5zdGFuY2UsIFNQSUNFX1BP
UlRfRVZFTlRfQ0xPU0VEKTsKIAogICAgICAgICAvLyBtYWtlIHN1cmUgZmlyc3QgMyBwYXJ0cyBh
cmUgcmVhZCBjb21wbGV0ZWx5Ci0gICAgICAgIGdfYXNzZXJ0KG1lc3NhZ2Vfc2l6ZXNfY3VyciAt
IG1lc3NhZ2Vfc2l6ZXMgPj0gMyk7CisgICAgICAgIGdfYXNzZXJ0KHZtYy0+bWVzc2FnZV9zaXpl
c19jdXJyIC0gdm1jLT5tZXNzYWdlX3NpemVzID49IDMpOwogICAgICAgICAvLyBtYWtlIHN1cmUg
dGhlIGRldmljZSByZWFkZWQgYWxsIG9yIHRoYXQgZGV2aWNlIHdhcwogICAgICAgICAvLyBkaXNh
YmxlZCwgd2UgbmVlZCB0aGlzIHRvIG1ha2Ugc3VyZSB0aGF0IGRldmljZSB3aWxsIGJlIGluCiAg
ICAgICAgIC8vIHN5bmMgd2hlbiBvcGVuZWQgYWdhaW4KLSAgICAgICAgZ19hc3NlcnQobWVzc2Fn
ZV9zaXplc19jdXJyIC0gbWVzc2FnZV9zaXplcyA9PSA1IHx8ICFkZXZpY2VfZW5hYmxlZCk7Cisg
ICAgICAgIGdfYXNzZXJ0KHZtYy0+bWVzc2FnZV9zaXplc19jdXJyIC0gdm1jLT5tZXNzYWdlX3Np
emVzID09IDUgfHwgIXZtYy0+ZGV2aWNlX2VuYWJsZWQpOwogCiAgICAgICAgIGNoZWNrX3ZtY19l
cnJvcl9tZXNzYWdlKCk7Ci0gICAgICAgIHNwaWNlX3NlcnZlcl9yZW1vdmVfaW50ZXJmYWNlKCZ2
bWNfaW5zdGFuY2UuYmFzZSk7CisgICAgICAgIHNwaWNlX3NlcnZlcl9yZW1vdmVfaW50ZXJmYWNl
KCZ2bWMtPmluc3RhbmNlLmJhc2UpOwogICAgIH0KIH0KIAogLy8gY2hlY2sgaWYgc2VuZGluZyBh
IHBhcnRpYWwgbWVzc2FnZSBjYXVzZXMgaXNzdWVzCiBzdGF0aWMgdm9pZCB0ZXN0X3N0cmVhbV9k
ZXZpY2VfdW5maW5pc2hlZChUZXN0Rml4dHVyZSAqZml4dHVyZSwgZ2NvbnN0cG9pbnRlciB1c2Vy
X2RhdGEpCiB7Ci0gICAgdWludDhfdCAqcCA9IG1lc3NhZ2U7CisgICAgdWludDhfdCAqcCA9IHZt
Yy0+bWVzc2FnZTsKIAogICAgIC8vIHRoaXMgbG9uZyBhbmQgbm90IGZpbmlzaGVkIG1lc3NhZ2Ug
c2hvdWxkIG5vdCBjYXVzZSBhbiBpbmZpbml0ZSBsb29wCiAgICAgcCA9IGFkZF9zdHJlYW1faGRy
KHAsIFNUUkVBTV9UWVBFX0RBVEEsIDEwMDAwMCk7Ci0gICAgKm1lc3NhZ2Vfc2l6ZXNfZW5kID0g
cCAtIG1lc3NhZ2U7Ci0gICAgKyttZXNzYWdlX3NpemVzX2VuZDsKKyAgICB2bWNfZW11X2FkZF9y
ZWFkX3RpbGwodm1jLCBwKTsKIAogICAgIHRlc3Rfa2ljaygpOwogCiAgICAgLy8gd2Ugc2hvdWxk
IGhhdmUgcmVhZCBhbGwgZGF0YQotICAgIGdfYXNzZXJ0KG1lc3NhZ2Vfc2l6ZXNfY3VyciAtIG1l
c3NhZ2Vfc2l6ZXMgPT0gMSk7CisgICAgZ19hc3NlcnQodm1jLT5tZXNzYWdlX3NpemVzX2N1cnIg
LSB2bWMtPm1lc3NhZ2Vfc2l6ZXMgPT0gMSk7CiAKICAgICAvLyB3ZSBzaG91bGQgaGF2ZSBubyBk
YXRhIGZyb20gdGhlIGRldmljZQogICAgIGRpc2NhcmRfc2VydmVyX2NhcGFiaWxpdGllcygpOwot
ICAgIGdfYXNzZXJ0X2NtcGludCh2bWNfd3JpdGVfcG9zLCA9PSwgMCk7CisgICAgZ19hc3NlcnRf
Y21waW50KHZtYy0+d3JpdGVfcG9zLCA9PSwgMCk7CiB9CiAKIC8vIGNoZWNrIGlmIHNlbmRpbmcg
bXVsdGlwbGUgbWVzc2FnZXMgY2F1c2Ugc3RhbGwKIHN0YXRpYyB2b2lkIHRlc3Rfc3RyZWFtX2Rl
dmljZV9tdWx0aXBsZShUZXN0Rml4dHVyZSAqZml4dHVyZSwgZ2NvbnN0cG9pbnRlciB1c2VyX2Rh
dGEpCiB7Ci0gICAgdWludDhfdCAqcCA9IG1lc3NhZ2U7CisgICAgdWludDhfdCAqcCA9IHZtYy0+
bWVzc2FnZTsKIAogICAgIC8vIGFkZCBzb21lIG1lc3NhZ2VzIGludG8gZGV2aWNlIGJ1ZmZlcgog
ICAgIHAgPSBhZGRfZm9ybWF0KHAsIDY0MCwgNDgwLCBTUElDRV9WSURFT19DT0RFQ19UWVBFX01K
UEVHKTsKICAgICBwID0gYWRkX2Zvcm1hdChwLCA2NDAsIDQ4MCwgU1BJQ0VfVklERU9fQ09ERUNf
VFlQRV9NSlBFRyk7CiAgICAgcCA9IGFkZF9mb3JtYXQocCwgNjQwLCA0ODAsIFNQSUNFX1ZJREVP
X0NPREVDX1RZUEVfTUpQRUcpOwotICAgICptZXNzYWdlX3NpemVzX2VuZCA9IHAgLSBtZXNzYWdl
OwotICAgICsrbWVzc2FnZV9zaXplc19lbmQ7CisgICAgdm1jX2VtdV9hZGRfcmVhZF90aWxsKHZt
YywgcCk7CiAKICAgICB0ZXN0X2tpY2soKTsKIAogICAgIC8vIHdlIHNob3VsZCBoYXZlIHJlYWQg
YWxsIGRhdGEKLSAgICBnX2Fzc2VydChtZXNzYWdlX3NpemVzX2N1cnIgLSBtZXNzYWdlX3NpemVz
ID09IDEpOworICAgIGdfYXNzZXJ0KHZtYy0+bWVzc2FnZV9zaXplc19jdXJyIC0gdm1jLT5tZXNz
YWdlX3NpemVzID09IDEpOwogfQogCiAvLyBjaGVjayBpZiBkYXRhIG1lc3NhZ2UgY29uc3VtZSBl
dmVuIGZvbGxvd2luZyBtZXNzYWdlCiBzdGF0aWMgdm9pZCB0ZXN0X3N0cmVhbV9kZXZpY2VfZm9y
bWF0X2FmdGVyX2RhdGEoVGVzdEZpeHR1cmUgKmZpeHR1cmUsIGdjb25zdHBvaW50ZXIgdXNlcl9k
YXRhKQogewotICAgIHVpbnQ4X3QgKnAgPSBtZXNzYWdlOworICAgIHVpbnQ4X3QgKnAgPSB2bWMt
Pm1lc3NhZ2U7CiAKICAgICAvLyBhZGQgc29tZSBtZXNzYWdlcyBpbnRvIGRldmljZSBidWZmZXIK
ICAgICBwID0gYWRkX2Zvcm1hdChwLCA2NDAsIDQ4MCwgU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9N
SlBFRyk7CkBAIC0zOTksMTUgKzMxMSwxNCBAQCBzdGF0aWMgdm9pZCB0ZXN0X3N0cmVhbV9kZXZp
Y2VfZm9ybWF0X2FmdGVyX2RhdGEoVGVzdEZpeHR1cmUgKmZpeHR1cmUsIGdjb25zdHBvaQogICAg
IG1lbWNweShwLCAiaGVsbG8iLCA1KTsKICAgICBwICs9IDU7CiAgICAgcCA9IGFkZF9zdHJlYW1f
aGRyKHAsIFNUUkVBTV9UWVBFX0lOVkFMSUQsIDApOwotICAgICptZXNzYWdlX3NpemVzX2VuZCA9
IHAgLSBtZXNzYWdlOwotICAgICsrbWVzc2FnZV9zaXplc19lbmQ7CisgICAgdm1jX2VtdV9hZGRf
cmVhZF90aWxsKHZtYywgcCk7CiAKICAgICBnX3Rlc3RfZXhwZWN0X21lc3NhZ2UoR19MT0dfRE9N
QUlOLCBHX0xPR19MRVZFTF9XQVJOSU5HLCAiU3RyZWFtIGRldmljZSByZWNlaXZlZCBpbnZhbGlk
IG1lc3NhZ2U6IEludmFsaWQgbWVzc2FnZSB0eXBlIik7CiAKICAgICB0ZXN0X2tpY2soKTsKIAog
ICAgIC8vIHdlIHNob3VsZCByZWFkIGFsbCBkYXRhCi0gICAgZ19hc3NlcnQobWVzc2FnZV9zaXpl
c19jdXJyIC0gbWVzc2FnZV9zaXplcyA9PSAxKTsKKyAgICBnX2Fzc2VydCh2bWMtPm1lc3NhZ2Vf
c2l6ZXNfY3VyciAtIHZtYy0+bWVzc2FnZV9zaXplcyA9PSAxKTsKIAogICAgIC8vIHdlIHNob3Vs
ZCBoYXZlIGFuIGVycm9yIGJhY2sKICAgICBjaGVja192bWNfZXJyb3JfbWVzc2FnZSgpOwpAQCAt
NDE3LDQ2ICszMjgsNDIgQEAgc3RhdGljIHZvaWQgdGVzdF9zdHJlYW1fZGV2aWNlX2Zvcm1hdF9h
ZnRlcl9kYXRhKFRlc3RGaXh0dXJlICpmaXh0dXJlLCBnY29uc3Rwb2kKIHN0YXRpYyB2b2lkIHRl
c3Rfc3RyZWFtX2RldmljZV9lbXB0eShUZXN0Rml4dHVyZSAqZml4dHVyZSwgZ2NvbnN0cG9pbnRl
ciB1c2VyX2RhdGEpCiB7CiAgICAgY29uc3QgU3RyZWFtTXNnVHlwZSBtc2dfdHlwZSA9IChTdHJl
YW1Nc2dUeXBlKSBHUE9JTlRFUl9UT19JTlQodXNlcl9kYXRhKTsKLSAgICB1aW50OF90ICpwID0g
bWVzc2FnZTsKKyAgICB1aW50OF90ICpwID0gdm1jLT5tZXNzYWdlOwogCiAgICAgLy8gYWRkIHNv
bWUgbWVzc2FnZXMgaW50byBkZXZpY2UgYnVmZmVyCiAgICAgcCA9IGFkZF9zdHJlYW1faGRyKHAs
IG1zZ190eXBlLCAwKTsKLSAgICAqbWVzc2FnZV9zaXplc19lbmQgPSBwIC0gbWVzc2FnZTsKLSAg
ICArK21lc3NhZ2Vfc2l6ZXNfZW5kOworICAgIHZtY19lbXVfYWRkX3JlYWRfdGlsbCh2bWMsIHAp
OwogICAgIHAgPSBhZGRfZm9ybWF0KHAsIDY0MCwgNDgwLCBTUElDRV9WSURFT19DT0RFQ19UWVBF
X01KUEVHKTsKLSAgICAqbWVzc2FnZV9zaXplc19lbmQgPSBwIC0gbWVzc2FnZTsKLSAgICArK21l
c3NhZ2Vfc2l6ZXNfZW5kOworICAgIHZtY19lbXVfYWRkX3JlYWRfdGlsbCh2bWMsIHApOwogICAg
IHAgPSBhZGRfZm9ybWF0KHAsIDY0MCwgNDgwLCBTUElDRV9WSURFT19DT0RFQ19UWVBFX01KUEVH
KTsKLSAgICAqbWVzc2FnZV9zaXplc19lbmQgPSBwIC0gbWVzc2FnZTsKLSAgICArK21lc3NhZ2Vf
c2l6ZXNfZW5kOworICAgIHZtY19lbXVfYWRkX3JlYWRfdGlsbCh2bWMsIHApOwogCiAgICAgdGVz
dF9raWNrKCk7CiAKICAgICAvLyB3ZSBzaG91bGQgcmVhZCBhbGwgZGF0YQotICAgIGdfYXNzZXJ0
KG1lc3NhZ2Vfc2l6ZXNfY3VyciAtIG1lc3NhZ2Vfc2l6ZXMgPT0gMyk7CisgICAgZ19hc3NlcnQo
dm1jLT5tZXNzYWdlX3NpemVzX2N1cnIgLSB2bWMtPm1lc3NhZ2Vfc2l6ZXMgPT0gMyk7CiAKICAg
ICAvLyB3ZSBzaG91bGQgaGF2ZSBubyBkYXRhIGZyb20gdGhlIGRldmljZQogICAgIGRpc2NhcmRf
c2VydmVyX2NhcGFiaWxpdGllcygpOwotICAgIGdfYXNzZXJ0X2NtcGludCh2bWNfd3JpdGVfcG9z
LCA9PSwgMCk7CisgICAgZ19hc3NlcnRfY21waW50KHZtYy0+d3JpdGVfcG9zLCA9PSwgMCk7CiB9
CiAKIC8vIGNoZWNrIHRoYXQgc2VydmVyIHJlZnVzZSBodWdlIGRhdGEgbWVzc2FnZXMKIHN0YXRp
YyB2b2lkIHRlc3Rfc3RyZWFtX2RldmljZV9odWdlX2RhdGEoVGVzdEZpeHR1cmUgKmZpeHR1cmUs
IGdjb25zdHBvaW50ZXIgdXNlcl9kYXRhKQogewotICAgIHVpbnQ4X3QgKnAgPSBtZXNzYWdlOwor
ICAgIHVpbnQ4X3QgKnAgPSB2bWMtPm1lc3NhZ2U7CiAKICAgICAvLyBhZGQgc29tZSBtZXNzYWdl
cyBpbnRvIGRldmljZSBidWZmZXIKICAgICBwID0gYWRkX3N0cmVhbV9oZHIocCwgU1RSRUFNX1RZ
UEVfREFUQSwgMzMgKiAxMDI0ICogMTAyNCk7CiAgICAgcCA9IGFkZF9mb3JtYXQocCwgNjQwLCA0
ODAsIFNQSUNFX1ZJREVPX0NPREVDX1RZUEVfTUpQRUcpOwotICAgICptZXNzYWdlX3NpemVzX2Vu
ZCA9IHAgLSBtZXNzYWdlOwotICAgICsrbWVzc2FnZV9zaXplc19lbmQ7CisgICAgdm1jX2VtdV9h
ZGRfcmVhZF90aWxsKHZtYywgcCk7CiAKICAgICBnX3Rlc3RfZXhwZWN0X21lc3NhZ2UoR19MT0df
RE9NQUlOLCBHX0xPR19MRVZFTF9XQVJOSU5HLCAiU3RyZWFtIGRldmljZSByZWNlaXZlZCBpbnZh
bGlkIG1lc3NhZ2U6IFNUUkVBTV9EQVRBIHRvbyBsYXJnZSIpOwogCiAgICAgdGVzdF9raWNrKCk7
CiAKICAgICAvLyB3ZSBzaG91bGQgcmVhZCBhbGwgZGF0YQotICAgIGdfYXNzZXJ0KG1lc3NhZ2Vf
c2l6ZXNfY3VyciAtIG1lc3NhZ2Vfc2l6ZXMgPT0gMSk7CisgICAgZ19hc3NlcnQodm1jLT5tZXNz
YWdlX3NpemVzX2N1cnIgLSB2bWMtPm1lc3NhZ2Vfc2l6ZXMgPT0gMSk7CiAKICAgICAvLyB3ZSBz
aG91bGQgaGF2ZSBhbiBlcnJvciBiYWNrCiAgICAgY2hlY2tfdm1jX2Vycm9yX21lc3NhZ2UoKTsK
QEAgLTQ2NSw3ICszNzIsNyBAQCBzdGF0aWMgdm9pZCB0ZXN0X3N0cmVhbV9kZXZpY2VfaHVnZV9k
YXRhKFRlc3RGaXh0dXJlICpmaXh0dXJlLCBnY29uc3Rwb2ludGVyIHVzZQogLy8gY2hlY2sgdGhh
dCBzZXJ2ZXIgc2VuZCBhbGwgbWVzc2FnZQogc3RhdGljIHZvaWQgdGVzdF9zdHJlYW1fZGV2aWNl
X2RhdGFfbWVzc2FnZShUZXN0Rml4dHVyZSAqZml4dHVyZSwgZ2NvbnN0cG9pbnRlciB1c2VyX2Rh
dGEpCiB7Ci0gICAgdWludDhfdCAqcCA9IG1lc3NhZ2U7CisgICAgdWludDhfdCAqcCA9IHZtYy0+
bWVzc2FnZTsKIAogICAgIC8vIGFkZCBzb21lIG1lc3NhZ2VzIGludG8gZGV2aWNlIGJ1ZmZlcgog
ICAgIHAgPSBhZGRfZm9ybWF0KHAsIDY0MCwgNDgwLCBTUElDRV9WSURFT19DT0RFQ19UWVBFX01K
UEVHKTsKQEAgLTQ3MywyMyArMzgwLDE5IEBAIHN0YXRpYyB2b2lkIHRlc3Rfc3RyZWFtX2Rldmlj
ZV9kYXRhX21lc3NhZ2UoVGVzdEZpeHR1cmUgKmZpeHR1cmUsIGdjb25zdHBvaW50ZXIKICAgICBm
b3IgKGludCBpID0gMDsgaSA8IDEwMTc7ICsraSwgKytwKSB7CiAgICAgICAgICpwID0gKHVpbnQ4
X3QpIChpICogMTIzICsgNTcpOwogICAgIH0KLSAgICAqbWVzc2FnZV9zaXplc19lbmQgPSA1MTsK
LSAgICArK21lc3NhZ2Vfc2l6ZXNfZW5kOwotICAgICptZXNzYWdlX3NpemVzX2VuZCA9IDEyMzsK
LSAgICArK21lc3NhZ2Vfc2l6ZXNfZW5kOwotICAgICptZXNzYWdlX3NpemVzX2VuZCA9IDUzNDsK
LSAgICArK21lc3NhZ2Vfc2l6ZXNfZW5kOwotICAgICptZXNzYWdlX3NpemVzX2VuZCA9IHAgLSBt
ZXNzYWdlOwotICAgICsrbWVzc2FnZV9zaXplc19lbmQ7CisgICAgdm1jX2VtdV9hZGRfcmVhZF90
aWxsKHZtYywgdm1jLT5tZXNzYWdlICsgNTEpOworICAgIHZtY19lbXVfYWRkX3JlYWRfdGlsbCh2
bWMsIHZtYy0+bWVzc2FnZSArIDEyMyk7CisgICAgdm1jX2VtdV9hZGRfcmVhZF90aWxsKHZtYywg
dm1jLT5tZXNzYWdlICsgNTM0KTsKKyAgICB2bWNfZW11X2FkZF9yZWFkX3RpbGwodm1jLCBwKTsK
IAogICAgIHRlc3Rfa2ljaygpOwogCiAgICAgLy8gd2Ugc2hvdWxkIHJlYWQgYWxsIGRhdGEKLSAg
ICBnX2Fzc2VydChtZXNzYWdlX3NpemVzX2N1cnIgLSBtZXNzYWdlX3NpemVzID09IDQpOworICAg
IGdfYXNzZXJ0KHZtYy0+bWVzc2FnZV9zaXplc19jdXJyIC0gdm1jLT5tZXNzYWdlX3NpemVzID09
IDQpOwogCiAgICAgLy8gd2Ugc2hvdWxkIGhhdmUgbm8gZGF0YSBmcm9tIHRoZSBkZXZpY2UKICAg
ICBkaXNjYXJkX3NlcnZlcl9jYXBhYmlsaXRpZXMoKTsKLSAgICBnX2Fzc2VydF9jbXBpbnQodm1j
X3dyaXRlX3BvcywgPT0sIDApOworICAgIGdfYXNzZXJ0X2NtcGludCh2bWMtPndyaXRlX3Bvcywg
PT0sIDApOwogCiAgICAgLy8gbWFrZSBzdXJlIGRhdGEgd2VyZSBjb2xsYXBzZWQgaW4gYSBzaW5n
bGUgbWVzc2FnZQogICAgIGdfYXNzZXJ0X2NtcGludChudW1fc2VuZF9kYXRhX2NhbGxzLCA9PSwg
MSk7CkBAIC01MTIsMTUgKzQxNSwxNCBAQCBzdGF0aWMgdm9pZCB0ZXN0X2Rpc3BsYXlfaW5mbyhU
ZXN0Rml4dHVyZSAqZml4dHVyZSwgZ2NvbnN0cG9pbnRlciB1c2VyX2RhdGEpCiAgICAgICAgIC5k
ZXZpY2VfZGlzcGxheV9pZCA9IEdVSU5UMzJfVE9fTEUoMHgwYTBiMGMwZCksCiAgICAgICAgIC5k
ZXZpY2VfYWRkcmVzc19sZW4gPSBHVUlOVDMyX1RPX0xFKHNpemVvZihhZGRyZXNzKSksCiAgICAg
fTsKLSAgICB1aW50OF90ICpwID0gbWVzc2FnZTsKKyAgICB1aW50OF90ICpwID0gdm1jLT5tZXNz
YWdlOwogICAgIHAgPSBhZGRfc3RyZWFtX2hkcihwLCBTVFJFQU1fVFlQRV9ERVZJQ0VfRElTUExB
WV9JTkZPLCBzaXplb2YoaW5mbykgKyBzaXplb2YoYWRkcmVzcykpOwogICAgIG1lbWNweShwLCAm
aW5mbywgc2l6ZW9mKGluZm8pKTsKICAgICBwICs9IHNpemVvZihpbmZvKTsKICAgICBzdHJjcHko
KGNoYXIqKXAsIGFkZHJlc3MpOwogICAgIHAgKz0gc2l6ZW9mKGFkZHJlc3MpOwogCi0gICAgKm1l
c3NhZ2Vfc2l6ZXNfZW5kID0gcCAtIG1lc3NhZ2U7Ci0gICAgKyttZXNzYWdlX3NpemVzX2VuZDsK
KyAgICB2bWNfZW11X2FkZF9yZWFkX3RpbGwodm1jLCBwKTsKIAogICAgIC8vIHBhcnNlIHRoZSBz
aW11bGF0ZWQgZGlzcGxheSBpbmZvIG1lc3NhZ2UgZnJvbSB0aGUgc3RyZWFtIGRldmljZSBzbyB0
aGUgc2VydmVyIG5vdyBoYXMgZGlzcGxheQogICAgIC8vIGluZm8gZm9yIHRoZSBtb2NrIHN0cmVh
bSBkZXZpY2UKZGlmZiAtLWdpdCBhL3NlcnZlci90ZXN0cy92bWMtZW11LmMgYi9zZXJ2ZXIvdGVz
dHMvdm1jLWVtdS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMC4uNDE4YTAy
MTM5Ci0tLSAvZGV2L251bGwKKysrIGIvc2VydmVyL3Rlc3RzL3ZtYy1lbXUuYwpAQCAtMCwwICsx
LDEyMSBAQAorLyogLSotIE1vZGU6IEM7IGMtYmFzaWMtb2Zmc2V0OiA0OyBpbmRlbnQtdGFicy1t
b2RlOiBuaWwgLSotICovCisvKgorICAgQ29weXJpZ2h0IChDKSAyMDE5IFJlZCBIYXQsIEluYy4K
KworICAgVGhpcyBsaWJyYXJ5IGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRl
IGl0IGFuZC9vcgorICAgbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3Nl
ciBHZW5lcmFsIFB1YmxpYworICAgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29m
dHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyCisgICB2ZXJzaW9uIDIuMSBvZiB0aGUgTGljZW5zZSwg
b3IgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KKworICAgVGhpcyBsaWJyYXJ5
IGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCisgICBi
dXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50
eSBvZgorICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQ
T1NFLiAgU2VlIHRoZSBHTlUKKyAgIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBt
b3JlIGRldGFpbHMuCisKKyAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhl
IEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKKyAgIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxp
YnJhcnk7IGlmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KKyovCisK
KyNpbmNsdWRlIDxjb25maWcuaD4KKyNpbmNsdWRlIDxnbGliLmg+CisKKyNpbmNsdWRlICJ2bWMt
ZW11LmgiCisKKy8vIGhhbmRsZSB3cml0ZXMgdG8gdGhlIGRldmljZQorc3RhdGljIGludCB2bWNf
d3JpdGUoU3BpY2VDaGFyRGV2aWNlSW5zdGFuY2UgKnNpbiwKKyAgICAgICAgICAgICAgICAgICAg
IGNvbnN0IHVpbnQ4X3QgKmJ1ZiwgaW50IGxlbikKK3sKKyAgICBWbWNFbXUgKmNvbnN0IHZtYyA9
IFNQSUNFX0NPTlRBSU5FUk9GKHNpbiwgVm1jRW11LCBpbnN0YW5jZSk7CisKKyAgICAvLyBqdXN0
IGNvcHkgaW50byB0aGUgYnVmZmVyCisgICAgdW5zaWduZWQgY29weSA9IE1JTihzaXplb2Yodm1j
LT53cml0ZV9idWYpIC0gdm1jLT53cml0ZV9wb3MsIGxlbik7CisgICAgbWVtY3B5KHZtYy0+d3Jp
dGVfYnVmK3ZtYy0+d3JpdGVfcG9zLCBidWYsIGNvcHkpOworICAgIHZtYy0+d3JpdGVfcG9zICs9
IGNvcHk7CisgICAgcmV0dXJuIGxlbjsKK30KKworc3RhdGljIGludCB2bWNfcmVhZChTcGljZUNo
YXJEZXZpY2VJbnN0YW5jZSAqc2luLAorICAgICAgICAgICAgICAgICAgICB1aW50OF90ICpidWYs
IGludCBsZW4pCit7CisgICAgVm1jRW11ICpjb25zdCB2bWMgPSBTUElDRV9DT05UQUlORVJPRihz
aW4sIFZtY0VtdSwgaW5zdGFuY2UpOworICAgIGludCByZXQ7CisKKyAgICBpZiAodm1jLT5wb3Mg
Pj0gKnZtYy0+bWVzc2FnZV9zaXplc19jdXJyICYmIHZtYy0+bWVzc2FnZV9zaXplc19jdXJyIDwg
dm1jLT5tZXNzYWdlX3NpemVzX2VuZCkgeworICAgICAgICArK3ZtYy0+bWVzc2FnZV9zaXplc19j
dXJyOworICAgIH0KKyAgICBpZiAodm1jLT5tZXNzYWdlX3NpemVzX2N1cnIgPj0gdm1jLT5tZXNz
YWdlX3NpemVzX2VuZCB8fCB2bWMtPnBvcyA+PSAqdm1jLT5tZXNzYWdlX3NpemVzX2N1cnIpIHsK
KyAgICAgICAgcmV0dXJuIDA7CisgICAgfQorICAgIHJldCA9IE1JTigqdm1jLT5tZXNzYWdlX3Np
emVzX2N1cnIgLSB2bWMtPnBvcywgbGVuKTsKKyAgICBtZW1jcHkoYnVmLCAmdm1jLT5tZXNzYWdl
W3ZtYy0+cG9zXSwgcmV0KTsKKyAgICB2bWMtPnBvcyArPSByZXQ7CisgICAgLy8ga2ljayBvZmYg
bmV4dCBtZXNzYWdlIHJlYWQKKyAgICAvLyBjdXJyZW50bHkgUWVtdSBraWNrcyB0aGUgZGV2aWNl
IHNvIHdlIG5lZWQgdG8gZG8gaXQgbWFudWFsbHkKKyAgICAvLyBoZXJlLiBJZiBub3QgYWxsIGRh
dGEgYXJlIHJlYWQsIHRoZSBkZXZpY2UgZ29lcyBpbnRvIGJsb2NraW5nCisgICAgLy8gc3RhdGUg
YW5kIHdlIGdldCB0aGUgd2FrZSBvbmx5IHdoZW4gd2UgcmVhZCBmcm9tIHRoZSBkZXZpY2UKKyAg
ICAvLyBhZ2FpbgorICAgIGlmICh2bWMtPnBvcyA+PSAqdm1jLT5tZXNzYWdlX3NpemVzX2N1cnIp
IHsKKyAgICAgICAgc3BpY2Vfc2VydmVyX2NoYXJfZGV2aWNlX3dha2V1cCgmdm1jLT5pbnN0YW5j
ZSk7CisgICAgfQorICAgIHJldHVybiByZXQ7Cit9CisKK3N0YXRpYyB2b2lkIHZtY19zdGF0ZShT
cGljZUNoYXJEZXZpY2VJbnN0YW5jZSAqc2luLAorICAgICAgICAgICAgICAgICAgICAgIGludCBj
b25uZWN0ZWQpCit7CisgICAgVm1jRW11ICpjb25zdCB2bWMgPSBTUElDRV9DT05UQUlORVJPRihz
aW4sIFZtY0VtdSwgaW5zdGFuY2UpOworICAgIHZtYy0+ZGV2aWNlX2VuYWJsZWQgPSAhIWNvbm5l
Y3RlZDsKK30KKworc3RhdGljIGNvbnN0IFNwaWNlQ2hhckRldmljZUludGVyZmFjZSB2bWNfaW50
ZXJmYWNlID0geworICAgIC5iYXNlID0geworICAgICAgICAudHlwZSAgICAgICAgICA9IFNQSUNF
X0lOVEVSRkFDRV9DSEFSX0RFVklDRSwKKyAgICAgICAgLmRlc2NyaXB0aW9uICAgPSAidGVzdCBz
cGljZSB2aXJ0dWFsIGNoYW5uZWwgY2hhciBkZXZpY2UiLAorICAgICAgICAubWFqb3JfdmVyc2lv
biA9IFNQSUNFX0lOVEVSRkFDRV9DSEFSX0RFVklDRV9NQUpPUiwKKyAgICAgICAgLm1pbm9yX3Zl
cnNpb24gPSBTUElDRV9JTlRFUkZBQ0VfQ0hBUl9ERVZJQ0VfTUlOT1IsCisgICAgfSwKKyAgICAu
c3RhdGUgICAgICAgICAgICAgID0gdm1jX3N0YXRlLAorICAgIC53cml0ZSAgICAgICAgICAgICAg
PSB2bWNfd3JpdGUsCisgICAgLnJlYWQgICAgICAgICAgICAgICA9IHZtY19yZWFkLAorfTsKKwor
Vm1jRW11ICp2bWNfZW11X25ldyhjb25zdCBjaGFyICpzdWJ0eXBlLCBjb25zdCBjaGFyICpwb3J0
bmFtZSkKK3sKKyAgICBWbWNFbXUgKnZtYyA9IGdfbmV3MChWbWNFbXUsIDEpOworICAgIHZtYy0+
dm1jX2ludGVyZmFjZSA9IHZtY19pbnRlcmZhY2U7CisgICAgdm1jLT5pbnN0YW5jZS5iYXNlLnNp
ZiA9ICZ2bWMtPnZtY19pbnRlcmZhY2UuYmFzZTsKKyAgICB2bWMtPmluc3RhbmNlLnN1YnR5cGUg
PSBnX3N0cmR1cChzdWJ0eXBlKTsKKyAgICBpZiAocG9ydG5hbWUpIHsKKyAgICAgICAgdm1jLT5p
bnN0YW5jZS5wb3J0bmFtZSA9IGdfc3RyZHVwKHBvcnRuYW1lKTsKKyAgICB9CisgICAgdm1jX2Vt
dV9yZXNldCh2bWMpOworICAgIHJldHVybiB2bWM7Cit9CisKK3ZvaWQgdm1jX2VtdV9kZXN0cm95
KFZtY0VtdSAqdm1jKQoreworICAgIGdfZnJlZSgoY2hhciAqKSB2bWMtPmluc3RhbmNlLnBvcnRu
YW1lKTsKKyAgICBnX2ZyZWUoKGNoYXIgKikgdm1jLT5pbnN0YW5jZS5zdWJ0eXBlKTsKKyAgICBn
X2ZyZWUodm1jKTsKK30KKwordm9pZCB2bWNfZW11X3Jlc2V0KFZtY0VtdSAqdm1jKQoreworICAg
IHZtYy0+cG9zID0gMDsKKyAgICB2bWMtPndyaXRlX3BvcyA9IDA7CisgICAgdm1jLT5tZXNzYWdl
X3NpemVzX2N1cnIgPSB2bWMtPm1lc3NhZ2Vfc2l6ZXM7CisgICAgdm1jLT5tZXNzYWdlX3NpemVz
X2VuZCA9IHZtYy0+bWVzc2FnZV9zaXplczsKK30KKwordm9pZCB2bWNfZW11X2FkZF9yZWFkX3Rp
bGwoVm1jRW11ICp2bWMsIHVpbnQ4X3QgKmVuZCkKK3sKKyAgICBnX2Fzc2VydCh2bWMtPm1lc3Nh
Z2Vfc2l6ZXNfZW5kIC0gdm1jLT5tZXNzYWdlX3NpemVzIDwgR19OX0VMRU1FTlRTKHZtYy0+bWVz
c2FnZV9zaXplcykpOworICAgIGdfYXNzZXJ0KGVuZCA+PSB2bWMtPm1lc3NhZ2UpOworICAgIGdf
YXNzZXJ0KGVuZCAtIHZtYy0+bWVzc2FnZSA8PSBHX05fRUxFTUVOVFModm1jLT5tZXNzYWdlKSk7
CisgICAgdW5zaWduZWQgcHJldl9zaXplID0KKyAgICAgICAgdm1jLT5tZXNzYWdlX3NpemVzX2Vu
ZCA+IHZtYy0+bWVzc2FnZV9zaXplcyA/IHZtYy0+bWVzc2FnZV9zaXplc19lbmRbLTFdIDogMDsK
KyAgICB1bnNpZ25lZCBzaXplID0gZW5kIC0gdm1jLT5tZXNzYWdlOworICAgIGdfYXNzZXJ0KHNp
emUgPj0gcHJldl9zaXplKTsKKyAgICAqdm1jLT5tZXNzYWdlX3NpemVzX2VuZCA9IHNpemU7Cisg
ICAgKyt2bWMtPm1lc3NhZ2Vfc2l6ZXNfZW5kOworfQpkaWZmIC0tZ2l0IGEvc2VydmVyL3Rlc3Rz
L3ZtYy1lbXUuaCBiL3NlcnZlci90ZXN0cy92bWMtZW11LmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQK
aW5kZXggMDAwMDAwMDAwLi43YzI2OTM4ZWIKLS0tIC9kZXYvbnVsbAorKysgYi9zZXJ2ZXIvdGVz
dHMvdm1jLWVtdS5oCkBAIC0wLDAgKzEsNDggQEAKKy8qIC0qLSBNb2RlOiBDOyBjLWJhc2ljLW9m
ZnNldDogNDsgaW5kZW50LXRhYnMtbW9kZTogbmlsIC0qLSAqLworLyoKKyAgIENvcHlyaWdodCAo
QykgMjAxOSBSZWQgSGF0LCBJbmMuCisKKyAgIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJl
OyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IKKyAgIG1vZGlmeSBpdCB1bmRlciB0aGUg
dGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKKyAgIExpY2Vuc2UgYXMgcHVi
bGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlcgorICAgdmVyc2lv
biAyLjEgb2YgdGhlIExpY2Vuc2UsIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNp
b24uCisKKyAgIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0
IHdpbGwgYmUgdXNlZnVsLAorICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2
ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKKyAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNT
IEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUgR05VCisgICBMZXNzZXIgR2VuZXJh
bCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgorCisgICBZb3Ugc2hvdWxkIGhhdmUg
cmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCisgICBMaWNl
bnNlIGFsb25nIHdpdGggdGhpcyBsaWJyYXJ5OyBpZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUu
b3JnL2xpY2Vuc2VzLz4uCisqLworI3ByYWdtYSBvbmNlCisKKyNpbmNsdWRlICJjaGFyLWRldmlj
ZS5oIgorCit0eXBlZGVmIHN0cnVjdCBWbWNFbXUgVm1jRW11OworCitzdHJ1Y3QgVm1jRW11IHsK
KyAgICBTcGljZUNoYXJEZXZpY2VJbnRlcmZhY2Ugdm1jX2ludGVyZmFjZTsKKyAgICBTcGljZUNo
YXJEZXZpY2VJbnN0YW5jZSBpbnN0YW5jZTsKKworICAgIC8vIGRldmljZSBidWZmZXIgdG8gcmVh
ZCBmcm9tCisgICAgdWludDhfdCBtZXNzYWdlWzIwNDhdOworICAgIC8vIHBvc2l0aW9uIHRvIHJl
YWQgZnJvbQorICAgIHVuc2lnbmVkIHBvczsKKworICAgIC8vIGFycmF5IG9mIGxpbWl0cyB3aGVu
IHRoZSByZWFkIHNob3VsZCByZXR1cm4KKyAgICAvLyB0aGUgYXJyYXkgaXMgZGVmaW5lZCBhcyBb
bWVzc2FnZV9zaXplc19jdXJyLCBtZXNzYWdlX3NpemVzX2VuZCkKKyAgICAvLyB0aGVuIHRoZSBz
aXplIGlzIHJlYWNoIHdlIG1vdmUgb24gbmV4dCBvbmUgdGlsbCBleGF1c3RlZAorICAgIHVuc2ln
bmVkIG1lc3NhZ2Vfc2l6ZXNbMTZdOworICAgIHVuc2lnbmVkICptZXNzYWdlX3NpemVzX2VuZCwg
Km1lc3NhZ2Vfc2l6ZXNfY3VycjsKKworICAgIGJvb2wgZGV2aWNlX2VuYWJsZWQ7CisKKyAgICB1
bnNpZ25lZCB3cml0ZV9wb3M7CisgICAgdWludDhfdCB3cml0ZV9idWZbMjA0OF07Cit9OworCitW
bWNFbXUgKnZtY19lbXVfbmV3KGNvbnN0IGNoYXIgKnN1YnR5cGUsIGNvbnN0IGNoYXIgKnBvcnRu
YW1lKTsKK3ZvaWQgdm1jX2VtdV9kZXN0cm95KFZtY0VtdSAqdm1jKTsKK3ZvaWQgdm1jX2VtdV9y
ZXNldChWbWNFbXUgKnZtYyk7Cit2b2lkIHZtY19lbXVfYWRkX3JlYWRfdGlsbChWbWNFbXUgKnZt
YywgdWludDhfdCAqZW5kKTsKLS0gCjIuMjEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KU3BpY2UtZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVs
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
