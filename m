Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 8418C32AAB
	for <lists+spice-devel@lfdr.de>; Mon,  3 Jun 2019 10:22:46 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8752A891B4;
	Mon,  3 Jun 2019 08:22:44 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2604C891B4
 for <spice-devel@lists.freedesktop.org>; Mon,  3 Jun 2019 08:22:40 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
 [10.5.11.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 47DD9308402F
 for <spice-devel@lists.freedesktop.org>; Mon,  3 Jun 2019 08:22:40 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.4])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 26E9B5D739;
 Mon,  3 Jun 2019 08:22:38 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Mon,  3 Jun 2019 09:22:34 +0100
Message-Id: <20190603082234.26208-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.40]); Mon, 03 Jun 2019 08:22:40 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-server] char-device: Reuse macros to
 scan GList
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

U2lnbmVkLW9mZi1ieTogRnJlZGlhbm8gWmlnbGlvIDxmemlnbGlvQHJlZGhhdC5jb20+Ci0tLQog
c2VydmVyL2NoYXItZGV2aWNlLmMgfCAyNyArKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0KIDEg
ZmlsZSBjaGFuZ2VkLCA4IGluc2VydGlvbnMoKyksIDE5IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL3NlcnZlci9jaGFyLWRldmljZS5jIGIvc2VydmVyL2NoYXItZGV2aWNlLmMKaW5kZXggOWVl
MjU1NjY0Li5jYWFiZGQzZTEgMTAwNjQ0Ci0tLSBhL3NlcnZlci9jaGFyLWRldmljZS5jCisrKyBi
L3NlcnZlci9jaGFyLWRldmljZS5jCkBAIC0yMjQsMTEgKzIyNCw5IEBAIHN0YXRpYyB2b2lkIHJl
ZF9jaGFyX2RldmljZV9oYW5kbGVfY2xpZW50X292ZXJmbG93KFJlZENoYXJEZXZpY2VDbGllbnQg
KmRldl9jbGllCiBzdGF0aWMgUmVkQ2hhckRldmljZUNsaWVudCAqcmVkX2NoYXJfZGV2aWNlX2Ns
aWVudF9maW5kKFJlZENoYXJEZXZpY2UgKmRldiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVkQ2xpZW50ICpjbGllbnQpCiB7Ci0gICAg
R0xpc3QgKml0ZW07Ci0KLSAgICBmb3IgKGl0ZW0gPSBkZXYtPnByaXYtPmNsaWVudHM7IGl0ZW0g
IT0gTlVMTDsgaXRlbSA9IGl0ZW0tPm5leHQpIHsKLSAgICAgICAgUmVkQ2hhckRldmljZUNsaWVu
dCAqZGV2X2NsaWVudCA9IGl0ZW0tPmRhdGE7CisgICAgUmVkQ2hhckRldmljZUNsaWVudCAqZGV2
X2NsaWVudDsKIAorICAgIEdMSVNUX0ZPUkVBQ0goZGV2LT5wcml2LT5jbGllbnRzLCBSZWRDaGFy
RGV2aWNlQ2xpZW50LCBkZXZfY2xpZW50KSB7CiAgICAgICAgIGlmIChkZXZfY2xpZW50LT5jbGll
bnQgPT0gY2xpZW50KSB7CiAgICAgICAgICAgICByZXR1cm4gZGV2X2NsaWVudDsKICAgICAgICAg
fQpAQCAtMjU0LDEyICsyNTIsMTAgQEAgc3RhdGljIGludCByZWRfY2hhcl9kZXZpY2VfY2FuX3Nl
bmRfdG9fY2xpZW50KFJlZENoYXJEZXZpY2VDbGllbnQgKmRldl9jbGllbnQpCiAKIHN0YXRpYyB1
aW50NjRfdCByZWRfY2hhcl9kZXZpY2VfbWF4X3NlbmRfdG9rZW5zKFJlZENoYXJEZXZpY2UgKmRl
dikKIHsKLSAgICBHTGlzdCAqaXRlbTsKKyAgICBSZWRDaGFyRGV2aWNlQ2xpZW50ICpkZXZfY2xp
ZW50OwogICAgIHVpbnQ2NF90IG1heCA9IDA7CiAKLSAgICBmb3IgKGl0ZW0gPSBkZXYtPnByaXYt
PmNsaWVudHM7IGl0ZW0gIT0gTlVMTDsgaXRlbSA9IGl0ZW0tPm5leHQpIHsKLSAgICAgICAgUmVk
Q2hhckRldmljZUNsaWVudCAqZGV2X2NsaWVudCA9IGl0ZW0tPmRhdGE7Ci0KKyAgICBHTElTVF9G
T1JFQUNIKGRldi0+cHJpdi0+Y2xpZW50cywgUmVkQ2hhckRldmljZUNsaWVudCwgZGV2X2NsaWVu
dCkgewogICAgICAgICBpZiAoIWRldl9jbGllbnQtPmRvX2Zsb3dfY29udHJvbCkgewogICAgICAg
ICAgICAgbWF4ID0gfjA7CiAgICAgICAgICAgICBicmVhazsKQEAgLTI5NCwxMyArMjkwLDkgQEAg
c3RhdGljIHZvaWQgcmVkX2NoYXJfZGV2aWNlX2FkZF9tc2dfdG9fY2xpZW50X3F1ZXVlKFJlZENo
YXJEZXZpY2VDbGllbnQgKmRldl9jbGkKIHN0YXRpYyB2b2lkIHJlZF9jaGFyX2RldmljZV9zZW5k
X21zZ190b19jbGllbnRzKFJlZENoYXJEZXZpY2UgKmRldiwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlZFBpcGVJdGVtICptc2cpCiB7Ci0gICAgR0xp
c3QgKmw7Ci0KLSAgICBsID0gZGV2LT5wcml2LT5jbGllbnRzOwotICAgIHdoaWxlIChsKSB7Ci0g
ICAgICAgIEdMaXN0ICpuZXh0ID0gbC0+bmV4dDsKLSAgICAgICAgUmVkQ2hhckRldmljZUNsaWVu
dCAqZGV2X2NsaWVudCA9IGwtPmRhdGE7CisgICAgUmVkQ2hhckRldmljZUNsaWVudCAqZGV2X2Ns
aWVudDsKIAorICAgIEdMSVNUX0ZPUkVBQ0goZGV2LT5wcml2LT5jbGllbnRzLCBSZWRDaGFyRGV2
aWNlQ2xpZW50LCBkZXZfY2xpZW50KSB7CiAgICAgICAgIGlmIChyZWRfY2hhcl9kZXZpY2VfY2Fu
X3NlbmRfdG9fY2xpZW50KGRldl9jbGllbnQpKSB7CiAgICAgICAgICAgICBkZXZfY2xpZW50LT5u
dW1fc2VuZF90b2tlbnMtLTsKICAgICAgICAgICAgIHNwaWNlX2Fzc2VydChnX3F1ZXVlX2lzX2Vt
cHR5KGRldl9jbGllbnQtPnNlbmRfcXVldWUpKTsKQEAgLTMxMCw3ICszMDIsNiBAQCBzdGF0aWMg
dm9pZCByZWRfY2hhcl9kZXZpY2Vfc2VuZF9tc2dfdG9fY2xpZW50cyhSZWRDaGFyRGV2aWNlICpk
ZXYsCiAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICByZWRfY2hhcl9kZXZpY2VfYWRkX21z
Z190b19jbGllbnRfcXVldWUoZGV2X2NsaWVudCwgbXNnKTsKICAgICAgICAgfQotICAgICAgICBs
ID0gbmV4dDsKICAgICB9CiB9CiAKQEAgLTgyMyw3ICs4MTQsNyBAQCB2b2lkIHJlZF9jaGFyX2Rl
dmljZV9zdG9wKFJlZENoYXJEZXZpY2UgKmRldikKIAogdm9pZCByZWRfY2hhcl9kZXZpY2VfcmVz
ZXQoUmVkQ2hhckRldmljZSAqZGV2KQogewotICAgIEdMaXN0ICpjbGllbnRfaXRlbTsKKyAgICBS
ZWRDaGFyRGV2aWNlQ2xpZW50ICpkZXZfY2xpZW50OwogICAgIFJlZENoYXJEZXZpY2VXcml0ZUJ1
ZmZlciAqYnVmOwogCiAgICAgZGV2LT5wcml2LT53YWl0X2Zvcl9taWdyYXRlX2RhdGEgPSBGQUxT
RTsKQEAgLTgzMyw5ICs4MjQsNyBAQCB2b2lkIHJlZF9jaGFyX2RldmljZV9yZXNldChSZWRDaGFy
RGV2aWNlICpkZXYpCiAgICAgfQogICAgIHJlZF9jaGFyX2RldmljZV93cml0ZV9idWZmZXJfcmVs
ZWFzZShkZXYsICZkZXYtPnByaXYtPmN1cl93cml0ZV9idWYpOwogCi0gICAgZm9yIChjbGllbnRf
aXRlbSA9IGRldi0+cHJpdi0+Y2xpZW50czsgY2xpZW50X2l0ZW0gIT0gTlVMTDsgY2xpZW50X2l0
ZW0gPSBjbGllbnRfaXRlbS0+bmV4dCkgewotICAgICAgICBSZWRDaGFyRGV2aWNlQ2xpZW50ICpk
ZXZfY2xpZW50ID0gY2xpZW50X2l0ZW0tPmRhdGE7Ci0KKyAgICBHTElTVF9GT1JFQUNIKGRldi0+
cHJpdi0+Y2xpZW50cywgUmVkQ2hhckRldmljZUNsaWVudCwgZGV2X2NsaWVudCkgewogICAgICAg
ICBzcGljZV9kZWJ1Zygic2VuZF9xdWV1ZV9lbXB0eSAlZCIsIGdfcXVldWVfaXNfZW1wdHkoZGV2
X2NsaWVudC0+c2VuZF9xdWV1ZSkpOwogICAgICAgICBkZXZfY2xpZW50LT5udW1fc2VuZF90b2tl
bnMgKz0gZ19xdWV1ZV9nZXRfbGVuZ3RoKGRldl9jbGllbnQtPnNlbmRfcXVldWUpOwogICAgICAg
ICBnX3F1ZXVlX2ZyZWVfZnVsbChkZXZfY2xpZW50LT5zZW5kX3F1ZXVlLCAoR0Rlc3Ryb3lOb3Rp
ZnkpcmVkX3BpcGVfaXRlbV91bnJlZik7Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGlj
ZS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9zcGljZS1kZXZlbA==
