Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2CDB0A0467
	for <lists+spice-devel@lfdr.de>; Wed, 28 Aug 2019 16:14:44 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 97F84892FF;
	Wed, 28 Aug 2019 14:14:42 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B102088FF7
 for <spice-devel@lists.freedesktop.org>; Wed, 28 Aug 2019 14:14:41 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx02.intmail.prod.int.phx2.redhat.com
 [10.5.11.12])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 5BE52308FB82;
 Wed, 28 Aug 2019 14:14:41 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.21])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 53DE260F82;
 Wed, 28 Aug 2019 14:14:38 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Wed, 28 Aug 2019 15:14:11 +0100
Message-Id: <20190828141421.18902-9-fziglio@redhat.com>
In-Reply-To: <20190828141421.18902-1-fziglio@redhat.com>
References: <20190828141421.18902-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.12
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.43]); Wed, 28 Aug 2019 14:14:41 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-gtk v5 08/18] usb-redir: add
 implementation of emulated CD device
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogWXVyaSBCZW5kaXRvdmljaCA8eXVyaS5iZW5kaXRvdmljaEBkYXluaXguY29tPgoKVGhp
cyBtb2R1bGUgY29udGFpbnMgaW1wbGVtZW50YXRpb24gb2YgZW11bGF0ZWQgZGV2aWNlCmludGVy
ZmFjZSBmb3Igc2hhcmVkIENELgoKU2lnbmVkLW9mZi1ieTogWXVyaSBCZW5kaXRvdmljaCA8eXVy
aS5iZW5kaXRvdmljaEBkYXluaXguY29tPgpBY2tlZC1ieTogRnJlZGlhbm8gWmlnbGlvIDxmemln
bGlvQHJlZGhhdC5jb20+Ci0tLQogc3JjL3VzYi1kZXZpY2UtY2QuYyB8IDc4NCArKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogc3JjL3VzYi1kZXZpY2UtY2QuaCB8
ICAzNCArKwogMiBmaWxlcyBjaGFuZ2VkLCA4MTggaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUg
MTAwNjQ0IHNyYy91c2ItZGV2aWNlLWNkLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBzcmMvdXNiLWRl
dmljZS1jZC5oCgpkaWZmIC0tZ2l0IGEvc3JjL3VzYi1kZXZpY2UtY2QuYyBiL3NyYy91c2ItZGV2
aWNlLWNkLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAuLjJmNDIxYzQyCi0t
LSAvZGV2L251bGwKKysrIGIvc3JjL3VzYi1kZXZpY2UtY2QuYwpAQCAtMCwwICsxLDc4NCBAQAor
LyogLSotIE1vZGU6IEM7IGMtYmFzaWMtb2Zmc2V0OiA0OyBpbmRlbnQtdGFicy1tb2RlOiBuaWwg
LSotICovCisvKgorICAgIENvcHlyaWdodCAoQykgMjAxOSBSZWQgSGF0LCBJbmMuCisKKyAgICBS
ZWQgSGF0IEF1dGhvcnM6CisgICAgWXVyaSBCZW5kaXRvdmljaDx5YmVuZGl0b0ByZWRoYXQuY29t
PgorCisgICAgVGhpcyBsaWJyYXJ5IGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmli
dXRlIGl0IGFuZC9vcgorICAgIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBM
ZXNzZXIgR2VuZXJhbCBQdWJsaWMKKyAgICBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJl
ZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIKKyAgICB2ZXJzaW9uIDIuMSBvZiB0aGUgTGlj
ZW5zZSwgb3IgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KKworICAgIFRoaXMg
bGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVs
LAorICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVk
IHdhcnJhbnR5IG9mCisgICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElD
VUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUKKyAgICBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGlj
ZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgorCisgICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEg
Y29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYworICAgIExpY2Vuc2UgYWxvbmcg
d2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5z
ZXMvPi4KKyovCisKKyNpbmNsdWRlICJjb25maWcuaCIKKworI2lmZGVmIFVTRV9VU0JSRURJUgor
CisjaW5jbHVkZSA8Z2xpYi1vYmplY3QuaD4KKyNpbmNsdWRlIDxpbnR0eXBlcy5oPgorI2luY2x1
ZGUgPGdpby9naW8uaD4KKyNpbmNsdWRlIDxnbGliL2dpMThuLWxpYi5oPgorI2luY2x1ZGUgPGVy
cm5vLmg+CisjaW5jbHVkZSA8bGlidXNiLmg+CisjaW5jbHVkZSA8ZmNudGwuaD4KKworI2lmZGVm
IEdfT1NfV0lOMzIKKyNpbmNsdWRlIDx3aW5kb3dzLmg+CisjaW5jbHVkZSA8bnRkZGNkcm0uaD4K
KyNpbmNsdWRlIDxudGRkbW1jLmg+CisjZWxzZQorI2luY2x1ZGUgPHN5cy9zdGF0Lmg+CisjaW5j
bHVkZSA8c3lzL2lvY3RsLmg+CisjaW5jbHVkZSA8bGludXgvZnMuaD4KKyNpbmNsdWRlIDxsaW51
eC9jZHJvbS5oPgorI2VuZGlmCisKKyNpbmNsdWRlICJ1c2ItZW11bGF0aW9uLmgiCisjaW5jbHVk
ZSAidXNiLWRldmljZS1jZC5oIgorI2luY2x1ZGUgImNkLXVzYi1idWxrLW1zZC5oIgorCit0eXBl
ZGVmIHN0cnVjdCBTcGljZUNkTFUgeworICAgIGNoYXIgKmZpbGVuYW1lOworICAgIEdGaWxlSW5w
dXRTdHJlYW0gKnN0cmVhbTsKKyAgICB1aW50NjRfdCBzaXplOworICAgIHVpbnQzMl90IGJsb2Nr
U2l6ZTsKKyAgICB1aW50MzJfdCBsb2FkZWQgOiAxOworICAgIHVpbnQzMl90IGRldmljZSA6IDE7
Cit9IFNwaWNlQ2RMVTsKKworI2RlZmluZSBNQVhfTFVOX1BFUl9ERVZJQ0UgICAgICAgICAgICAg
IDEKKyNkZWZpbmUgVVNCMl9CQ0QgICAgICAgICAgICAgICAgICAgICAgICAweDIwMAorLyogUmVk
IEhhdCBVU0IgVklEICovCisjZGVmaW5lIENEX0RFVl9WSUQgICAgICAgICAgICAgICAgICAgICAg
MHgyYjIzCisjZGVmaW5lIENEX0RFVl9QSUQgICAgICAgICAgICAgICAgICAgICAgMHhDRENECisj
ZGVmaW5lIENEX0RFVl9DTEFTUyAgICAgICAgICAgICAgICAgICAgOAorI2RlZmluZSBDRF9ERVZf
U1VCQ0xBU1MgICAgICAgICAgICAgICAgIDYKKyNkZWZpbmUgQ0RfREVWX1BST1RPQ09MICAgICAg
ICAgICAgICAgICAweDUwCisjZGVmaW5lIENEX0RFVl9CTE9DS19TSVpFICAgICAgICAgICAgICAg
MHgyMDAKKyNkZWZpbmUgRFZEX0RFVl9CTE9DS19TSVpFICAgICAgICAgICAgICAweDgwMAorI2Rl
ZmluZSBNQVhfQlVMS19JTl9SRVFVRVNUUyAgICAgICAgICAgIDY0CisKK3N0cnVjdCBCdWZmZXJl
ZEJ1bGtSZWFkIHsKKyAgICBzdHJ1Y3QgdXNiX3JlZGlyX2J1bGtfcGFja2V0X2hlYWRlciBob3V0
OworICAgIHVpbnQ2NF90IGlkOworfTsKKworc3RydWN0IFNwaWNlVXNiRW11bGF0ZWREZXZpY2Ug
eworICAgIFVzYkRldmljZU9wcyBkZXZfb3BzOworICAgIFNwaWNlVXNiQmFja2VuZCAqYmFja2Vu
ZDsKKyAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKnBhcmVudDsKKyAgICBzdHJ1Y3QgdXNicmVk
aXJwYXJzZXIgKnBhcnNlcjsKKyAgICBVc2JDZEJ1bGtNc2REZXZpY2UqIG1zYzsKKyAgICBTcGlj
ZUNkTFUgdW5pdHNbTUFYX0xVTl9QRVJfREVWSUNFXTsKKyAgICBnYm9vbGVhbiBsb2NrZWQ7Cisg
ICAgZ2Jvb2xlYW4gZGVsZXRlX29uX2VqZWN0OworICAgIGdib29sZWFuIGRlbGV0aW5nOworICAg
IHVpbnQzMl90IG51bV9yZWFkczsKKyAgICBzdHJ1Y3QgQnVmZmVyZWRCdWxrUmVhZCByZWFkX2J1
bGtbTUFYX0JVTEtfSU5fUkVRVUVTVFNdOworICAgIC8qIGFjY29yZGluZyB0byBVU0IgTVNDIHNw
ZWMgKi8KKyAgICB1aW50MTZfdCBzZXJpYWxbMTJdOworICAgIHVpbnQ4X3QgbWF4X2x1bl9pbmRl
eDsKK307CisKK3R5cGVkZWYgc3RydWN0IFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgVXNiQ2Q7CisK
KyNpZm5kZWYgR19PU19XSU4zMgorCitzdGF0aWMgaW50IGNkX2RldmljZV9vcGVuX3N0cmVhbShT
cGljZUNkTFUgKnVuaXQsIGNvbnN0IGNoYXIgKmZpbGVuYW1lKQoreworICAgIHVuaXQtPmRldmlj
ZSA9IDA7CisKKyAgICBpZiAoIXVuaXQtPmZpbGVuYW1lICYmICFmaWxlbmFtZSkgeworICAgICAg
ICBTUElDRV9ERUJVRygiJXM6IGZpbGUgbmFtZSBub3QgcHJvdmlkZWQiLCBfX0ZVTkNUSU9OX18p
OworICAgICAgICByZXR1cm4gLTE7CisgICAgfQorICAgIGlmICh1bml0LT5maWxlbmFtZSAmJiBm
aWxlbmFtZSkgeworICAgICAgICBnX2ZyZWUodW5pdC0+ZmlsZW5hbWUpOworICAgICAgICB1bml0
LT5maWxlbmFtZSA9IE5VTEw7CisgICAgfQorICAgIGlmIChmaWxlbmFtZSkgeworICAgICAgICB1
bml0LT5maWxlbmFtZSA9IGdfc3RyZHVwKGZpbGVuYW1lKTsKKyAgICB9CisKKyAgICBpbnQgZmQg
PSBvcGVuKHVuaXQtPmZpbGVuYW1lLCBPX1JET05MWSB8IE9fTk9OQkxPQ0spOworICAgIGlmIChm
ZCA8IDApIHsKKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiBjYW4ndCBvcGVuIGZpbGUgJXMiLCBf
X0ZVTkNUSU9OX18sIHVuaXQtPmZpbGVuYW1lKTsKKyAgICAgICAgcmV0dXJuIC0xOworICAgIH0K
KworICAgIHN0cnVjdCBzdGF0IGZpbGVfc3RhdCA9IHsgMCB9OworICAgIGlmIChmc3RhdChmZCwg
JmZpbGVfc3RhdCkgfHwgZmlsZV9zdGF0LnN0X3NpemUgPT0gMCkgeworICAgICAgICBmaWxlX3N0
YXQuc3Rfc2l6ZSA9IDA7CisgICAgICAgIHVuaXQtPmRldmljZSA9IDE7CisgICAgICAgIGlmICgh
aW9jdGwoZmQsIEJMS0dFVFNJWkU2NCwgJmZpbGVfc3RhdC5zdF9zaXplKSAmJgorICAgICAgICAg
ICAgIWlvY3RsKGZkLCBCTEtTU1pHRVQsICZ1bml0LT5ibG9ja1NpemUpKSB7CisgICAgICAgIH0K
KyAgICB9CisgICAgdW5pdC0+c2l6ZSA9IGZpbGVfc3RhdC5zdF9zaXplOworICAgIGNsb3NlKGZk
KTsKKyAgICBpZiAodW5pdC0+c2l6ZSkgeworICAgICAgICBHRmlsZSAqZmlsZV9vYmplY3QgPSBn
X2ZpbGVfbmV3X2Zvcl9wYXRoKHVuaXQtPmZpbGVuYW1lKTsKKyAgICAgICAgdW5pdC0+c3RyZWFt
ID0gZ19maWxlX3JlYWQoZmlsZV9vYmplY3QsIE5VTEwsIE5VTEwpOworICAgICAgICBnX2NsZWFy
X29iamVjdCgmZmlsZV9vYmplY3QpOworICAgIH0KKyAgICBpZiAoIXVuaXQtPnN0cmVhbSkgewor
ICAgICAgICBTUElDRV9ERUJVRygiJXM6IGNhbid0IG9wZW4gc3RyZWFtIG9uICVzIiwgX19GVU5D
VElPTl9fLCB1bml0LT5maWxlbmFtZSk7CisgICAgICAgIHJldHVybiAtMTsKKyAgICB9CisKKyAg
ICByZXR1cm4gMDsKK30KKworc3RhdGljIGludCBjZF9kZXZpY2VfbG9hZChTcGljZUNkTFUgKnVu
aXQsIGdib29sZWFuIGxvYWQpCit7CisgICAgaW50IGVycm9yOworICAgIGlmICghdW5pdC0+ZGV2
aWNlIHx8ICF1bml0LT5maWxlbmFtZSkgeworICAgICAgICByZXR1cm4gLTE7CisgICAgfQorICAg
IGludCBmZCA9IG9wZW4odW5pdC0+ZmlsZW5hbWUsIE9fUkRPTkxZIHwgT19OT05CTE9DSyk7Cisg
ICAgaWYgKGZkIDwgMCkgeworICAgICAgICByZXR1cm4gLTE7CisgICAgfQorICAgIGlmIChsb2Fk
KSB7CisgICAgICAgIGVycm9yID0gaW9jdGwoZmQsIENEUk9NQ0xPU0VUUkFZLCAwKTsKKyAgICB9
IGVsc2UgeworICAgICAgICBlcnJvciA9IGlvY3RsKGZkLCBDRFJPTV9MT0NLRE9PUiwgMCk7Cisg
ICAgICAgIGVycm9yID0gaW9jdGwoZmQsIENEUk9NRUpFQ1QsIDApOworICAgIH0KKyAgICBpZiAo
ZXJyb3IpIHsKKyAgICAgICAgLy8gbm90ZSB0aGF0IGVqZWN0aW5nIG1pZ2h0IGJlIGF2YWlsYWJs
ZSBvbmx5IGZvciByb290CisgICAgICAgIC8vIGxvYWRpbmcgbWlnaHQgYmUgYXZhaWxhYmxlIGFs
c28gZm9yIHJlZ3VsYXIgdXNlcgorICAgICAgICBTUElDRV9ERUJVRygiJXM6IGNhbid0ICVzbG9h
ZCAlcywgcmVzICVkLCBlcnJubyAlZCIsCisgICAgICAgICAgICBfX0ZVTkNUSU9OX18sIGxvYWQg
PyAiIiA6ICJ1biIsIHVuaXQtPmZpbGVuYW1lLCBlcnJvciwgZXJybm8pOworICAgIH0KKyAgICBj
bG9zZShmZCk7CisgICAgcmV0dXJuIGVycm9yOworfQorCitzdGF0aWMgaW50IGNkX2RldmljZV9j
aGVjayhTcGljZUNkTFUgKnVuaXQpCit7CisgICAgaW50IGVycm9yOworICAgIGlmICghdW5pdC0+
ZGV2aWNlIHx8ICF1bml0LT5maWxlbmFtZSkgeworICAgICAgICByZXR1cm4gLTE7CisgICAgfQor
ICAgIGludCBmZCA9IG9wZW4odW5pdC0+ZmlsZW5hbWUsIE9fUkRPTkxZIHwgT19OT05CTE9DSyk7
CisgICAgaWYgKGZkIDwgMCkgeworICAgICAgICByZXR1cm4gLTE7CisgICAgfQorICAgIGVycm9y
ID0gaW9jdGwoZmQsIENEUk9NX0RSSVZFX1NUQVRVUywgMCk7CisgICAgZXJyb3IgPSAoZXJyb3Ig
PT0gQ0RTX0RJU0NfT0spID8gMCA6IC0xOworICAgIGlmICghZXJyb3IpIHsKKyAgICAgICAgZXJy
b3IgPSBpb2N0bChmZCwgQ0RST01fRElTQ19TVEFUVVMsIDApOworICAgICAgICBlcnJvciA9IChl
cnJvciA9PSBDRFNfREFUQV8xKSA/IDAgOiAtMTsKKyAgICB9CisgICAgY2xvc2UoZmQpOworICAg
IHJldHVybiBlcnJvcjsKK30KKworI2Vsc2UKKworc3RhdGljIGdib29sZWFuIGlzX2RldmljZV9u
YW1lKGNvbnN0IGNoYXIgKmZpbGVuYW1lKQoreworICAgIHJldHVybiBnX2FzY2lpX2lzYWxwaGEo
ZmlsZW5hbWVbMF0pICYmIGZpbGVuYW1lWzFdID09ICc6JyAmJgorICAgICAgICBmaWxlbmFtZVsy
XSA9PSAwOworfQorCitzdGF0aWMgSEFORExFIG9wZW5fZmlsZShjb25zdCBjaGFyICpmaWxlbmFt
ZSkKK3sKKyAgICBIQU5ETEUgaCA9IENyZWF0ZUZpbGVBKGZpbGVuYW1lLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgR0VORVJJQ19SRUFELAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
RklMRV9TSEFSRV9SRUFELAorICAgICAgICAgICAgICAgICAgICAgICAgICAgTlVMTCwgT1BFTl9F
WElTVElORywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIDAsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICBOVUxMKTsKKyAgICBpZiAoaCA9PSBJTlZBTElEX0hBTkRMRV9WQUxVRSkgewor
ICAgICAgICBoID0gTlVMTDsKKyAgICB9CisgICAgcmV0dXJuIGg7Cit9CisKK3N0YXRpYyB1aW50
MzJfdCBpb2N0bF9vdXQoSEFORExFIGgsIHVpbnQzMl90IGNvZGUsIHZvaWQgKm91dF9idWZmZXIs
IHVpbnQzMl90IG91dF9zaXplKQoreworICAgIHVpbnQzMl90IGVycm9yOworICAgIERXT1JEIHJl
dDsKKyAgICBCT09MIGIgPSBEZXZpY2VJb0NvbnRyb2woaCwgY29kZSwgTlVMTCwgMCwgb3V0X2J1
ZmZlciwgb3V0X3NpemUsICZyZXQsIE5VTEwpOworICAgIGVycm9yID0gYiA/IDAgOiBHZXRMYXN0
RXJyb3IoKTsKKyAgICByZXR1cm4gZXJyb3I7Cit9CisKK3N0YXRpYyB1aW50MzJfdCBpb2N0bF9u
b25lKEhBTkRMRSBoLCB1aW50MzJfdCBjb2RlKQoreworICAgIHJldHVybiBpb2N0bF9vdXQoaCwg
Y29kZSwgTlVMTCwgMCk7Cit9CisKK3N0YXRpYyBnYm9vbGVhbiBjaGVja19kZXZpY2UoSEFORExF
IGgpCit7CisgICAgR0VUX0NPTkZJR1VSQVRJT05fSU9DVExfSU5QVVQgY2ZnSW4gPQorICAgICAg
ICB7IEZlYXR1cmVDZFJlYWQsIFNDU0lfR0VUX0NPTkZJR1VSQVRJT05fUkVRVUVTVF9UWVBFX0FM
TCwge30gfTsKKyAgICBEV09SRCByZXQ7CisgICAgR0VUX0NPTkZJR1VSQVRJT05fSEVBREVSIGNm
Z091dDsKKyAgICByZXR1cm4gRGV2aWNlSW9Db250cm9sKGgsIElPQ1RMX0NEUk9NX0dFVF9DT05G
SUdVUkFUSU9OLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgJmNmZ0luLCBzaXplb2YoY2Zn
SW4pLCAmY2ZnT3V0LCBzaXplb2YoY2ZnT3V0KSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICZyZXQsIE5VTEwpOworfQorCitzdGF0aWMgaW50IGNkX2RldmljZV9vcGVuX3N0cmVhbShTcGlj
ZUNkTFUgKnVuaXQsIGNvbnN0IGNoYXIgKmZpbGVuYW1lKQoreworICAgIEhBTkRMRSBoOworICAg
IHVuaXQtPmRldmljZSA9IDA7CisgICAgaWYgKCF1bml0LT5maWxlbmFtZSAmJiAhZmlsZW5hbWUp
IHsKKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiB1bm5hbWVkIGZpbGUiLCBfX0ZVTkNUSU9OX18p
OworICAgICAgICByZXR1cm4gLTE7CisgICAgfQorICAgIGlmICh1bml0LT5maWxlbmFtZSAmJiBm
aWxlbmFtZSkgeworICAgICAgICBnX2ZyZWUodW5pdC0+ZmlsZW5hbWUpOworICAgICAgICB1bml0
LT5maWxlbmFtZSA9IE5VTEw7CisgICAgfQorICAgIGlmICghZmlsZW5hbWUpIHsKKyAgICAgICAg
Ly8gcmVvcGVuaW5nIHRoZSBzdHJlYW0gb24gZXhpc3RpbmcgZmlsZSBuYW1lCisgICAgfSBlbHNl
IGlmIChpc19kZXZpY2VfbmFtZShmaWxlbmFtZSkpIHsKKyAgICAgICAgdW5pdC0+ZmlsZW5hbWUg
PSBnX3N0cmR1cF9wcmludGYoIlxcXFwuXFwlcyIsIGZpbGVuYW1lKTsKKyAgICB9IGVsc2Ugewor
ICAgICAgICB1bml0LT5maWxlbmFtZSA9IGdfc3RyZHVwKGZpbGVuYW1lKTsKKyAgICB9CisgICAg
aCA9IG9wZW5fZmlsZSh1bml0LT5maWxlbmFtZSk7CisgICAgaWYgKCFoKSB7CisgICAgICAgIFNQ
SUNFX0RFQlVHKCIlczogY2FuJ3Qgb3BlbiBmaWxlICVzIiwgX19GVU5DVElPTl9fLCB1bml0LT5m
aWxlbmFtZSk7CisgICAgICAgIHJldHVybiAtMTsKKyAgICB9CisKKyAgICBMQVJHRV9JTlRFR0VS
IHNpemUgPSB7IDAgfTsKKyAgICBpZiAoIUdldEZpbGVTaXplRXgoaCwgJnNpemUpKSB7CisgICAg
ICAgIHVpbnQ2NF90IGJ1ZmZlclsyNTZdOworICAgICAgICB1aW50MzJfdCByZXM7CisgICAgICAg
IHVuaXQtPmRldmljZSA9IGNoZWNrX2RldmljZShoKTsKKyAgICAgICAgU1BJQ0VfREVCVUcoIiVz
OiBDRCBkZXZpY2UgJXNyZWNvZ25pemVkIG9uICVzIiwKKyAgICAgICAgICAgIF9fRlVOQ1RJT05f
XywgdW5pdC0+ZGV2aWNlID8gIiIgOiAiTk9UICIsIHVuaXQtPmZpbGVuYW1lKTsKKyAgICAgICAg
cmVzID0gaW9jdGxfb3V0KGgsIElPQ1RMX0RJU0tfR0VUX0RSSVZFX0dFT01FVFJZX0VYLAorICAg
ICAgICAgICAgICAgICAgICAgICAgYnVmZmVyLCBzaXplb2YoYnVmZmVyKSk7CisgICAgICAgIGlm
ICghcmVzKSB7CisgICAgICAgICAgICBESVNLX0dFT01FVFJZX0VYICpwZyA9IChESVNLX0dFT01F
VFJZX0VYICopYnVmZmVyOworICAgICAgICAgICAgdW5pdC0+YmxvY2tTaXplID0gcGctPkdlb21l
dHJ5LkJ5dGVzUGVyU2VjdG9yOworICAgICAgICAgICAgc2l6ZSA9IHBnLT5EaXNrU2l6ZTsKKyAg
ICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgIFNQSUNFX0RFQlVHKCIlczogY2FuJ3Qgb2J0YWlu
IHNpemUgb2YgJXMgKGVycm9yICV1KSIsCisgICAgICAgICAgICAgICAgX19GVU5DVElPTl9fLCB1
bml0LT5maWxlbmFtZSwgcmVzKTsKKyAgICAgICAgfQorICAgIH0KKyAgICB1bml0LT5zaXplID0g
c2l6ZS5RdWFkUGFydDsKKyAgICBDbG9zZUhhbmRsZShoKTsKKyAgICBpZiAodW5pdC0+c2l6ZSkg
eworICAgICAgICBHRmlsZSAqZmlsZV9vYmplY3QgPSBnX2ZpbGVfbmV3X2Zvcl9wYXRoKHVuaXQt
PmZpbGVuYW1lKTsKKyAgICAgICAgdW5pdC0+c3RyZWFtID0gZ19maWxlX3JlYWQoZmlsZV9vYmpl
Y3QsIE5VTEwsIE5VTEwpOworICAgICAgICBnX2NsZWFyX29iamVjdCgmZmlsZV9vYmplY3QpOwor
ICAgIH0KKyAgICBpZiAoIXVuaXQtPnN0cmVhbSkgeworICAgICAgICBTUElDRV9ERUJVRygiJXM6
IGNhbid0IG9wZW4gc3RyZWFtIG9uICVzIiwgX19GVU5DVElPTl9fLCB1bml0LT5maWxlbmFtZSk7
CisgICAgICAgIHJldHVybiAtMTsKKyAgICB9CisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBp
bnQgY2RfZGV2aWNlX2xvYWQoU3BpY2VDZExVICp1bml0LCBnYm9vbGVhbiBsb2FkKQoreworICAg
IGludCBlcnJvciA9IDA7CisgICAgSEFORExFIGg7CisgICAgaWYgKCF1bml0LT5kZXZpY2UgfHwg
IXVuaXQtPmZpbGVuYW1lKSB7CisgICAgICAgIHJldHVybiAtMTsKKyAgICB9CisgICAgaCA9IG9w
ZW5fZmlsZSh1bml0LT5maWxlbmFtZSk7CisgICAgaWYgKGgpIHsKKyAgICAgICAgdWludDMyX3Qg
cmVzID0gaW9jdGxfbm9uZShoLCBsb2FkID8gSU9DVExfU1RPUkFHRV9MT0FEX01FRElBIDogSU9D
VExfU1RPUkFHRV9FSkVDVF9NRURJQSk7CisgICAgICAgIGlmIChyZXMpIHsKKyAgICAgICAgICAg
IFNQSUNFX0RFQlVHKCIlczogY2FuJ3QgJXNsb2FkICVzLCB3aW4gZXJyb3IgJXUiLAorICAgICAg
ICAgICAgICAgICAgICAgICAgX19GVU5DVElPTl9fLCBsb2FkID8gIiIgOiAidW4iLCB1bml0LT5m
aWxlbmFtZSwgcmVzKTsKKyAgICAgICAgICAgIGVycm9yID0gLTE7CisgICAgICAgIH0gZWxzZSB7
CisgICAgICAgICAgICBTUElDRV9ERUJVRygiJXM6IGRldmljZSAlcyBbJXNdIiwKKyAgICAgICAg
ICAgICAgICAgICAgICAgIF9fRlVOQ1RJT05fXywgbG9hZCA/ICJsb2FkZWQiIDogImVqZWN0ZWQi
LCB1bml0LT5maWxlbmFtZSk7CisgICAgICAgIH0KKyAgICAgICAgQ2xvc2VIYW5kbGUoaCk7Cisg
ICAgfQorICAgIHJldHVybiBlcnJvcjsKK30KKworc3RhdGljIGludCBjZF9kZXZpY2VfY2hlY2so
U3BpY2VDZExVICp1bml0KQoreworICAgIGludCBlcnJvciA9IDA7CisgICAgQ0RST01fRElTS19E
QVRBIGRhdGE7CisgICAgSEFORExFIGg7CisgICAgaWYgKCF1bml0LT5kZXZpY2UgfHwgIXVuaXQt
PmZpbGVuYW1lKSB7CisgICAgICAgIHJldHVybiAtMTsKKyAgICB9CisgICAgaCA9IG9wZW5fZmls
ZSh1bml0LT5maWxlbmFtZSk7CisgICAgaWYgKGgpIHsKKyAgICAgICAgdWludDMyX3QgcmVzID0g
aW9jdGxfbm9uZShoLCBJT0NUTF9TVE9SQUdFX0NIRUNLX1ZFUklGWSk7CisgICAgICAgIGlmICgh
cmVzKSB7CisgICAgICAgICAgICByZXMgPSBpb2N0bF9vdXQoaCwgSU9DVExfQ0RST01fRElTS19U
WVBFLCAmZGF0YSwgc2l6ZW9mKGRhdGEpKTsKKyAgICAgICAgfQorICAgICAgICBpZiAocmVzICE9
IDAgfHwgZGF0YS5EaXNrRGF0YSAhPSBDRFJPTV9ESVNLX0RBVEFfVFJBQ0spIHsKKyAgICAgICAg
ICAgIGVycm9yID0gLTE7CisgICAgICAgIH0KKyAgICAgICAgQ2xvc2VIYW5kbGUoaCk7CisgICAg
fQorICAgIHJldHVybiBlcnJvcjsKK30KKworI2VuZGlmCisKK3N0YXRpYyBnYm9vbGVhbiBvcGVu
X3N0cmVhbShTcGljZUNkTFUgKnVuaXQsIGNvbnN0IGNoYXIgKmZpbGVuYW1lKQoreworICAgIGdi
b29sZWFuIGI7CisgICAgYiA9IGNkX2RldmljZV9vcGVuX3N0cmVhbSh1bml0LCBmaWxlbmFtZSkg
PT0gMDsKKyAgICByZXR1cm4gYjsKK30KKworc3RhdGljIHZvaWQgY2xvc2Vfc3RyZWFtKFNwaWNl
Q2RMVSAqdW5pdCkKK3sKKyAgICBnX2NsZWFyX29iamVjdCgmdW5pdC0+c3RyZWFtKTsKK30KKwor
c3RhdGljIGdib29sZWFuIGxvYWRfbHVuKFVzYkNkICpkLCBpbnQgdW5pdCwgZ2Jvb2xlYW4gbG9h
ZCkKK3sKKyAgICBnYm9vbGVhbiBiID0gVFJVRTsKKyAgICBpZiAobG9hZCAmJiBkLT51bml0c1t1
bml0XS5kZXZpY2UpIHsKKyAgICAgICAgLy8gdGhlcmUgaXMgb25lIHBvc3NpYmxlIHByb2JsZW0g
aW4gY2FzZSBvdXIgYmFja2VuZCBpcyB0aGUKKyAgICAgICAgLy8gbG9jYWwgQ0QgZGV2aWNlIGFu
ZCBpdCBpcyBlamVjdGVkCisgICAgICAgIGNkX2RldmljZV9sb2FkKCZkLT51bml0c1t1bml0XSwg
VFJVRSk7CisgICAgICAgIGNsb3NlX3N0cmVhbSgmZC0+dW5pdHNbdW5pdF0pOworICAgICAgICBp
ZiAoY2RfZGV2aWNlX2NoZWNrKCZkLT51bml0c1t1bml0XSkgfHwgIW9wZW5fc3RyZWFtKCZkLT51
bml0c1t1bml0XSwgTlVMTCkpIHsKKyAgICAgICAgICAgIHJldHVybiBGQUxTRTsKKyAgICAgICAg
fQorICAgIH0KKworICAgIGlmIChsb2FkKSB7CisgICAgICAgIENkU2NzaU1lZGlhUGFyYW1ldGVy
cyBtZWRpYV9wYXJhbXMgPSB7IDAgfTsKKworICAgICAgICBtZWRpYV9wYXJhbXMuc3RyZWFtID0g
ZC0+dW5pdHNbdW5pdF0uc3RyZWFtOworICAgICAgICBtZWRpYV9wYXJhbXMuc2l6ZSA9IGQtPnVu
aXRzW3VuaXRdLnNpemU7CisgICAgICAgIG1lZGlhX3BhcmFtcy5ibG9ja19zaXplID0gZC0+dW5p
dHNbdW5pdF0uYmxvY2tTaXplOworICAgICAgICBpZiAobWVkaWFfcGFyYW1zLmJsb2NrX3NpemUg
PT0gQ0RfREVWX0JMT0NLX1NJWkUgJiYKKyAgICAgICAgICAgIG1lZGlhX3BhcmFtcy5zaXplICUg
RFZEX0RFVl9CTE9DS19TSVpFID09IDApIHsKKyAgICAgICAgICAgIG1lZGlhX3BhcmFtcy5ibG9j
a19zaXplID0gRFZEX0RFVl9CTE9DS19TSVpFOworICAgICAgICB9CisgICAgICAgIFNQSUNFX0RF
QlVHKCIlczogbG9hZGluZyAlcywgc2l6ZSAlIiBHX0dVSU5UNjRfRk9STUFUICIsIGJsb2NrICV1
IiwKKyAgICAgICAgICAgICAgICAgICAgX19GVU5DVElPTl9fLCBkLT51bml0c1t1bml0XS5maWxl
bmFtZSwgbWVkaWFfcGFyYW1zLnNpemUsIG1lZGlhX3BhcmFtcy5ibG9ja19zaXplKTsKKworICAg
ICAgICBiID0gIWNkX3VzYl9idWxrX21zZF9sb2FkKGQtPm1zYywgdW5pdCwgJm1lZGlhX3BhcmFt
cyk7CisKKyAgICAgICAgZC0+dW5pdHNbdW5pdF0ubG9hZGVkID0gISFiOworCisgICAgfSBlbHNl
IHsKKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiB1bmxvYWRpbmcgJXMiLCBfX0ZVTkNUSU9OX18s
IGQtPnVuaXRzW3VuaXRdLmZpbGVuYW1lKTsKKyAgICAgICAgY2RfdXNiX2J1bGtfbXNkX3VubG9h
ZChkLT5tc2MsIHVuaXQpOworICAgICAgICBkLT51bml0c1t1bml0XS5sb2FkZWQgPSBGQUxTRTsK
KyAgICB9CisgICAgcmV0dXJuIGI7Cit9CisKK3N0YXRpYyB2b2lkIHVzYl9jZF91bnJlYWxpemUo
VXNiQ2QgKmQpCit7CisgICAgdWludDMyX3QgdW5pdCA9IDA7CisgICAgY2RfdXNiX2J1bGtfbXNk
X3VucmVhbGl6ZShkLT5tc2MsIHVuaXQpOworICAgIGdfY2xlYXJfcG9pbnRlcigmZC0+dW5pdHNb
dW5pdF0uZmlsZW5hbWUsIGdfZnJlZSk7CisgICAgY2xvc2Vfc3RyZWFtKCZkLT51bml0c1t1bml0
XSk7CisgICAgZ19jbGVhcl9wb2ludGVyKCZkLT5tc2MsIGNkX3VzYl9idWxrX21zZF9mcmVlKTsK
KyAgICBnX2ZyZWUoZCk7Cit9CisKK3N0YXRpYyBnYm9vbGVhbiB1c2JfY2RfZ2V0X2Rlc2NyaXB0
b3IoVXNiQ2QgKmQsIHVpbnQ4X3QgdHlwZSwgdWludDhfdCBpbmRleCwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqKmJ1ZmZlciwgdWludDE2X3QgKnNpemUpCit7
CisgICAgc3RhdGljIHN0cnVjdCBsaWJ1c2JfZGV2aWNlX2Rlc2NyaXB0b3IgZGVzYyA9IHsKKyAg
ICAgICAgLmJMZW5ndGggPSAxOCwKKyAgICAgICAgLmJEZXNjcmlwdG9yVHlwZSA9IExJQlVTQl9E
VF9ERVZJQ0UsCisgICAgICAgIC5iY2RVU0IgPSBVU0IyX0JDRCwKKyAgICAgICAgLmJEZXZpY2VD
bGFzcyA9IDAsCisgICAgICAgIC5iRGV2aWNlU3ViQ2xhc3MgPSAwLAorICAgICAgICAuYkRldmlj
ZVByb3RvY29sID0gMCwKKyAgICAgICAgLmJNYXhQYWNrZXRTaXplMCA9IDY0LAorICAgICAgICAu
aWRWZW5kb3IgPSBDRF9ERVZfVklELAorICAgICAgICAuaWRQcm9kdWN0ID0gQ0RfREVWX1BJRCwK
KyAgICAgICAgLmJjZERldmljZSA9IDB4MTAwLAorICAgICAgICAuaU1hbnVmYWN0dXJlciA9IDEs
CisgICAgICAgIC5pUHJvZHVjdCA9IDIsCisgICAgICAgIC5pU2VyaWFsTnVtYmVyID0gMywKKyAg
ICAgICAgLmJOdW1Db25maWd1cmF0aW9ucyA9IDEKKyAgICB9OworICAgIHN0YXRpYyB1aW50OF90
IGNmZ1tdID0KKyAgICB7CisgICAgICAgIDksIC8vbGVuIG9mIGNmZyBkZXNjCisgICAgICAgIExJ
QlVTQl9EVF9DT05GSUcsIC8vIGRlc2MgdHlwZQorICAgICAgICAweDIwLCAvLyB3bGVuCisgICAg
ICAgIDAsCisgICAgICAgIDEsIC8vIG51bSBpZgorICAgICAgICAxLCAvLyBjZmcgdmFsCisgICAg
ICAgIDAsIC8vIGNmZyBuYW1lCisgICAgICAgIDB4ODAsIC8vIGJ1cyBwb3dlcmVkCisgICAgICAg
IDB4MzIsIC8vIDEwMCBtYQorICAgICAgICA5LCAvLyBsZW4gb2YgSUYgZGVzYworICAgICAgICBM
SUJVU0JfRFRfSU5URVJGQUNFLAorICAgICAgICAwLCAvLyBudW0gaWYKKyAgICAgICAgMCwgLy8g
YWx0IHNldHRpbmcKKyAgICAgICAgMiwgLy8gbnVtIG9mIGVuZHBvaW50cworICAgICAgICBDRF9E
RVZfQ0xBU1MsCisgICAgICAgIENEX0RFVl9TVUJDTEFTUywKKyAgICAgICAgQ0RfREVWX1BST1RP
Q09MLAorICAgICAgICAwLCAvLyBpZiBuYW1lCisgICAgICAgIDcsCisgICAgICAgIExJQlVTQl9E
VF9FTkRQT0lOVCwKKyAgICAgICAgMHg4MSwgLy8tPkRpcmVjdGlvbiA6IElOIC0gRW5kcG9pbnRJ
RCA6IDEKKyAgICAgICAgMHgwMiwgLy8tPkJ1bGsgVHJhbnNmZXIgVHlwZQorICAgICAgICAwLCAg
ICAvL3dNYXhQYWNrZXRTaXplIDogMHgwMjAwID0gMHgyMDAgbWF4IGJ5dGVzCisgICAgICAgIDIs
CisgICAgICAgIDAsICAgIC8vYkludGVydmFsCisgICAgICAgIDcsCisgICAgICAgIExJQlVTQl9E
VF9FTkRQT0lOVCwKKyAgICAgICAgMHgwMiwgLy8tPkRpcmVjdGlvbiA6IE9VVCAtIEVuZHBvaW50
SUQgOiAyCisgICAgICAgIDB4MDIsIC8vLT5CdWxrIFRyYW5zZmVyIFR5cGUKKyAgICAgICAgMCwg
ICAgLy93TWF4UGFja2V0U2l6ZSA6IDB4MDIwMCA9IDB4MjAwIG1heCBieXRlcworICAgICAgICAy
LAorICAgICAgICAwLCAgICAvL2JJbnRlcnZhbAorICAgIH07CisgICAgc3RhdGljIHVpbnQxNl90
IHMwWzJdID0geyAweDMwNCwgMHg0MDkgfTsKKyAgICBzdGF0aWMgdWludDE2X3QgczFbOF0gPSB7
IDB4MzEwLCAnUicsICdlJywgJ2QnLCAnICcsICdIJywgJ2EnLCAndCcgfTsKKyAgICBzdGF0aWMg
dWludDE2X3QgczJbOV0gPSB7IDB4MzEyLCAnUycsICdwJywgJ2knLCAnYycsICdlJywgJyAnLCAn
QycsICdEJyB9OworCisgICAgdm9pZCAqcCA9IE5VTEw7CisgICAgdWludDE2X3QgbGVuID0gMDsK
KworICAgIHN3aXRjaCAodHlwZSkgeworICAgIGNhc2UgTElCVVNCX0RUX0RFVklDRToKKyAgICAg
ICAgcCA9ICZkZXNjOworICAgICAgICBsZW4gPSBzaXplb2YoZGVzYyk7CisgICAgICAgIGJyZWFr
OworICAgIGNhc2UgTElCVVNCX0RUX0NPTkZJRzoKKyAgICAgICAgcCA9IGNmZzsKKyAgICAgICAg
bGVuID0gc2l6ZW9mKGNmZyk7CisgICAgICAgIGJyZWFrOworICAgIGNhc2UgTElCVVNCX0RUX1NU
UklORzoKKyAgICAgICAgaWYgKGluZGV4ID09IDApIHsKKyAgICAgICAgICAgIHAgPSBzMDsgbGVu
ID0gc2l6ZW9mKHMwKTsKKyAgICAgICAgfSBlbHNlIGlmIChpbmRleCA9PSAxKSB7CisgICAgICAg
ICAgICBwID0gczE7IGxlbiA9IHNpemVvZihzMSk7CisgICAgICAgIH0gZWxzZSBpZiAoaW5kZXgg
PT0gMikgeworICAgICAgICAgICAgcCA9IHMyOyBsZW4gPSBzaXplb2YoczIpOworICAgICAgICB9
IGVsc2UgaWYgKGluZGV4ID09IDMpIHsKKyAgICAgICAgICAgIHAgPSBkLT5zZXJpYWw7IGxlbiA9
IHNpemVvZihkLT5zZXJpYWwpOworICAgICAgICB9CisgICAgICAgIGJyZWFrOworICAgIH0KKwor
ICAgIGlmIChwKSB7CisgICAgICAgICpidWZmZXIgPSBwOworICAgICAgICAqc2l6ZSA9IGxlbjsK
KyAgICB9CisKKyAgICByZXR1cm4gcCAhPSBOVUxMOworfQorCitzdGF0aWMgdm9pZCB1c2JfY2Rf
YXR0YWNoKFVzYkNkICpkZXZpY2UsIHN0cnVjdCB1c2JyZWRpcnBhcnNlciAqcGFyc2VyKQorewor
ICAgIGRldmljZS0+cGFyc2VyID0gcGFyc2VyOworfQorCitzdGF0aWMgdm9pZCB1c2JfY2RfZGV0
YWNoKFVzYkNkICpkZXZpY2UpCit7CisgICAgZGV2aWNlLT5wYXJzZXIgPSBOVUxMOworfQorCitz
dGF0aWMgdm9pZCB1c2JfY2RfcmVzZXQoVXNiQ2QgKmRldmljZSkKK3sKKyAgICBjZF91c2JfYnVs
a19tc2RfcmVzZXQoZGV2aWNlLT5tc2MpOworfQorCitzdGF0aWMgdm9pZCB1c2JfY2RfY29udHJv
bF9yZXF1ZXN0KFVzYkNkICpkZXZpY2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHVpbnQ4X3QgKmRhdGEsIGludCBkYXRhX2xlbiwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc3RydWN0IHVzYl9yZWRpcl9jb250cm9sX3BhY2tldF9oZWFkZXIgKmgsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKipidWZmZXIpCit7CisgICAg
dWludDhfdCByZXF0eXBlID0gaC0+cmVxdWVzdHR5cGUgJiAweDdmOworICAgIGlmICghZGV2aWNl
LT5tc2MpIHsKKyAgICAgICAgcmV0dXJuOworICAgIH0KKyAgICBpZiAocmVxdHlwZSA9PSAoTElC
VVNCX1JFUVVFU1RfVFlQRV9TVEFOREFSRCB8IExJQlVTQl9SRUNJUElFTlRfRU5EUE9JTlQpKSB7
CisgICAgICAgIC8vIG1pZ2h0IGJlIGNsZWFyIHN0YWxsIHJlcXVlc3QKKyAgICAgICAgaC0+bGVu
Z3RoID0gMDsKKyAgICAgICAgaC0+c3RhdHVzID0gdXNiX3JlZGlyX3N1Y2Nlc3M7OworICAgICAg
ICByZXR1cm47CisgICAgfQorCisgICAgaWYgKHJlcXR5cGUgPT0gKExJQlVTQl9SRVFVRVNUX1RZ
UEVfQ0xBU1MgfCBMSUJVU0JfUkVDSVBJRU5UX0lOVEVSRkFDRSkpIHsKKyAgICAgICAgc3dpdGNo
IChoLT5yZXF1ZXN0KSB7CisgICAgICAgIGNhc2UgMHhGRjoKKyAgICAgICAgICAgIC8vIG1hc3Mt
c3RvcmFnZSBjbGFzcyByZXF1ZXN0ICdyZXNldCcKKyAgICAgICAgICAgIHVzYl9jZF9yZXNldChk
ZXZpY2UpOworICAgICAgICAgICAgaC0+bGVuZ3RoID0gMDsKKyAgICAgICAgICAgIGgtPnN0YXR1
cyA9IHVzYl9yZWRpcl9zdWNjZXNzOworICAgICAgICAgICAgYnJlYWs7CisgICAgICAgIGNhc2Ug
MHhGRToKKyAgICAgICAgICAgIC8vIG1hc3Mtc3RvcmFnZSBjbGFzcyByZXF1ZXN0ICdnZXQgbWF4
IGx1bicKKyAgICAgICAgICAgIC8vIHJldHVybmluZyBvbmUgYnl0ZQorICAgICAgICAgICAgaWYg
KGgtPmxlbmd0aCkgeworICAgICAgICAgICAgICAgIGgtPmxlbmd0aCA9IDE7CisgICAgICAgICAg
ICAgICAgaC0+c3RhdHVzID0gdXNiX3JlZGlyX3N1Y2Nlc3M7CisgICAgICAgICAgICAgICAgKmJ1
ZmZlciA9ICZkZXZpY2UtPm1heF9sdW5faW5kZXg7CisgICAgICAgICAgICB9CisgICAgICAgICAg
ICBicmVhazsKKyAgICAgICAgfQorICAgIH0KK30KKworc3RhdGljIHZvaWQgdXNiX2NkX2J1bGtf
b3V0X3JlcXVlc3QoVXNiQ2QgKmRldmljZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHVpbnQ4X3QgZXAsIHVpbnQ4X3QgKmRhdGEsIGludCBkYXRhX2xlbiwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ4X3QgKnN0YXR1cykKK3sKKyAgICBpZiAo
IWNkX3VzYl9idWxrX21zZF93cml0ZShkZXZpY2UtPm1zYywgZGF0YSwgZGF0YV9sZW4pKSB7Cisg
ICAgICAgICpzdGF0dXMgPSB1c2JfcmVkaXJfc3VjY2VzczsKKyAgICB9Cit9CisKK3ZvaWQgY2Rf
dXNiX2J1bGtfbXNkX3JlYWRfY29tcGxldGUodm9pZCAqdXNlcl9kYXRhLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB1aW50OF90ICpkYXRhLCB1aW50MzJfdCBsZW5ndGgsIENk
VXNiQnVsa1N0YXR1cyBzdGF0dXMpCit7CisgICAgVXNiQ2QgKmQgPSAoVXNiQ2QgKil1c2VyX2Rh
dGE7CisKKyAgICBpZiAoZC0+ZGVsZXRpbmcpIHsKKyAgICAgICAgZC0+ZGVsZXRpbmcgPSBGQUxT
RTsKKyAgICAgICAgc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX2VqZWN0KGQtPmJhY2tlbmQsIGQt
PnBhcmVudCk7CisgICAgfQorCisgICAgaWYgKGQtPnBhcnNlcikgeworICAgICAgICBpbnQgbnJl
YWQ7CisgICAgICAgIHVpbnQzMl90IG9mZnNldCA9IDA7CisKKyAgICAgICAgZm9yIChucmVhZCA9
IDA7IG5yZWFkIDwgZC0+bnVtX3JlYWRzOyBucmVhZCsrKSB7CisgICAgICAgICAgICB1aW50MzJf
dCBtYXhfbGVuOworICAgICAgICAgICAgbWF4X2xlbiA9IChkLT5yZWFkX2J1bGtbbnJlYWRdLmhv
dXQubGVuZ3RoX2hpZ2ggPDwgMTYpIHwKKyAgICAgICAgICAgICAgICAgICAgICAgIGQtPnJlYWRf
YnVsa1tucmVhZF0uaG91dC5sZW5ndGg7CisgICAgICAgICAgICBpZiAobWF4X2xlbiA+IGxlbmd0
aCkgeworICAgICAgICAgICAgICAgIG1heF9sZW4gPSBsZW5ndGg7CisgICAgICAgICAgICAgICAg
ZC0+cmVhZF9idWxrW25yZWFkXS5ob3V0Lmxlbmd0aCA9IGxlbmd0aDsKKyAgICAgICAgICAgICAg
ICBkLT5yZWFkX2J1bGtbbnJlYWRdLmhvdXQubGVuZ3RoX2hpZ2ggPSBsZW5ndGggPj4gMTY7Cisg
ICAgICAgICAgICB9CisKKyAgICAgICAgICAgIHN3aXRjaCAoc3RhdHVzKSB7CisgICAgICAgICAg
ICBjYXNlIEJVTEtfU1RBVFVTX0dPT0Q6CisgICAgICAgICAgICAgICAgZC0+cmVhZF9idWxrW25y
ZWFkXS5ob3V0LnN0YXR1cyA9IHVzYl9yZWRpcl9zdWNjZXNzOworICAgICAgICAgICAgICAgIGJy
ZWFrOworICAgICAgICAgICAgY2FzZSBCVUxLX1NUQVRVU19DQU5DRUxFRDoKKyAgICAgICAgICAg
ICAgICBkLT5yZWFkX2J1bGtbbnJlYWRdLmhvdXQuc3RhdHVzID0gdXNiX3JlZGlyX2NhbmNlbGxl
ZDsKKyAgICAgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICAgIGNhc2UgQlVMS19TVEFUVVNf
RVJST1I6CisgICAgICAgICAgICAgICAgZC0+cmVhZF9idWxrW25yZWFkXS5ob3V0LnN0YXR1cyA9
IHVzYl9yZWRpcl9pb2Vycm9yOworICAgICAgICAgICAgICAgIGJyZWFrOworICAgICAgICAgICAg
Y2FzZSBCVUxLX1NUQVRVU19TVEFMTDoKKyAgICAgICAgICAgIGRlZmF1bHQ6CisgICAgICAgICAg
ICAgICAgZC0+cmVhZF9idWxrW25yZWFkXS5ob3V0LnN0YXR1cyA9IHVzYl9yZWRpcl9zdGFsbDsK
KyAgICAgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICAgIH0KKworICAgICAgICAgICAgU1BJ
Q0VfREVCVUcoIiVzOiByZXNwb25kaW5nICUiIEdfR1VJTlQ2NF9GT1JNQVQgIiB3aXRoIGxlbiAl
dSBvdXQgb2YgJXUsIHN0YXR1cyAlZCIsCisgICAgICAgICAgICAgICAgICAgICAgICBfX0ZVTkNU
SU9OX18sIGQtPnJlYWRfYnVsa1tucmVhZF0uaWQsIG1heF9sZW4sCisgICAgICAgICAgICAgICAg
ICAgICAgICBsZW5ndGgsIGQtPnJlYWRfYnVsa1tucmVhZF0uaG91dC5zdGF0dXMpOworICAgICAg
ICAgICAgdXNicmVkaXJwYXJzZXJfc2VuZF9idWxrX3BhY2tldChkLT5wYXJzZXIsIGQtPnJlYWRf
YnVsa1tucmVhZF0uaWQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICZkLT5yZWFkX2J1bGtbbnJlYWRdLmhvdXQsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIG1heF9sZW4gPyAoZGF0YSArIG9mZnNldCkgOiBOVUxMLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhfbGVuKTsKKyAgICAg
ICAgICAgIG9mZnNldCArPSBtYXhfbGVuOworICAgICAgICAgICAgbGVuZ3RoIC09IG1heF9sZW47
CisgICAgICAgIH0KKyAgICAgICAgZC0+bnVtX3JlYWRzID0gMDsKKyAgICAgICAgdXNicmVkaXJw
YXJzZXJfZG9fd3JpdGUoZC0+cGFyc2VyKTsKKworICAgICAgICBpZiAobGVuZ3RoKSB7CisgICAg
ICAgICAgICBTUElDRV9ERUJVRygiJXM6IEVSUk9SOiAldSBieXRlcyB3ZXJlIG5vdCByZXBvcnRl
ZCEiLCBfX0ZVTkNUSU9OX18sIGxlbmd0aCk7CisgICAgICAgIH0KKworICAgIH0gZWxzZSB7Cisg
ICAgICAgIFNQSUNFX0RFQlVHKCIlczogYnJva2VuIGRldmljZTwtPmNoYW5uZWwgcmVsYXRpb25z
aGlwISIsIF9fRlVOQ1RJT05fXyk7CisgICAgfQorfQorCisvKiBkZXZpY2UgcmVzZXQgY29tcGxl
dGlvbiBjYWxsYmFjayAqLwordm9pZCBjZF91c2JfYnVsa19tc2RfcmVzZXRfY29tcGxldGUodm9p
ZCAqdXNlcl9kYXRhLCBpbnQgc3RhdHVzKQoreworICAgIC8vIFVzYkNkICpkID0gKFVzYkNkICop
dXNlcl9kYXRhOworfQorCitzdGF0aWMgZ2Jvb2xlYW4gdXNiX2NkX2J1bGtfaW5fcmVxdWVzdChV
c2JDZCAqZCwgdWludDY0X3QgaWQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBzdHJ1Y3QgdXNiX3JlZGlyX2J1bGtfcGFja2V0X2hlYWRlciAqaCkKK3sKKyAgICBpbnQg
cmVzOworICAgIHVpbnQzMl90IGxlbiA9IChoLT5sZW5ndGhfaGlnaCA8PCAxNikgfCBoLT5sZW5n
dGg7CisgICAgaWYgKGQtPm51bV9yZWFkcyA+PSBNQVhfQlVMS19JTl9SRVFVRVNUUykgeworICAg
ICAgICBoLT5sZW5ndGggPSBoLT5sZW5ndGhfaGlnaCA9IDA7CisgICAgICAgIFNQSUNFX0RFQlVH
KCIlczogdG9vIG1hbnkgcGVuZGluZyByZWFkcyIsIF9fRlVOQ1RJT05fXyk7CisgICAgICAgIGgt
PnN0YXR1cyA9IHVzYl9yZWRpcl9iYWJibGU7CisgICAgICAgIHJldHVybiBGQUxTRTsKKyAgICB9
CisKKyAgICBpZiAoZC0+bnVtX3JlYWRzKSB7CisgICAgICAgIFNQSUNFX0RFQlVHKCIlczogYWxy
ZWFkeSBoYXMgJXUgcGVuZGluZyByZWFkcyIsIF9fRlVOQ1RJT05fXywgZC0+bnVtX3JlYWRzKTsK
KyAgICB9CisKKyAgICBkLT5yZWFkX2J1bGtbZC0+bnVtX3JlYWRzXS5ob3V0ID0gKmg7CisgICAg
ZC0+cmVhZF9idWxrW2QtPm51bV9yZWFkc10uaWQgPSBpZDsKKyAgICBkLT5udW1fcmVhZHMrKzsK
KyAgICByZXMgPSBjZF91c2JfYnVsa19tc2RfcmVhZChkLT5tc2MsIGxlbik7CisgICAgaWYgKCFy
ZXMpIHsKKyAgICAgICAgcmV0dXJuIFRSVUU7CisgICAgfQorCisgICAgU1BJQ0VfREVCVUcoIiVz
OiBlcnJvciBvbiBidWxrIHJlYWQiLCBfX0ZVTkNUSU9OX18pOworICAgIGQtPm51bV9yZWFkcy0t
OworICAgIGgtPmxlbmd0aCA9IGgtPmxlbmd0aF9oaWdoID0gMDsKKyAgICBoLT5zdGF0dXMgPSB1
c2JfcmVkaXJfaW9lcnJvcjsKKworICAgIHJldHVybiBGQUxTRTsKK30KKworc3RhdGljIHZvaWQg
dXNiX2NkX2NhbmNlbF9yZXF1ZXN0KFVzYkNkICpkLCB1aW50NjRfdCBpZCkKK3sKKyAgICB1aW50
MzJfdCBucmVhZDsKKworICAgIGZvciAobnJlYWQgPSAwOyBucmVhZCA8IGQtPm51bV9yZWFkczsg
bnJlYWQrKykgeworICAgICAgICBpZiAoZC0+cmVhZF9idWxrW25yZWFkXS5pZCA9PSBpZCkgewor
ICAgICAgICAgICAgaWYgKGNkX3VzYl9idWxrX21zZF9jYW5jZWxfcmVhZChkLT5tc2MpKSB7Cisg
ICAgICAgICAgICAgICAgY2RfdXNiX2J1bGtfbXNkX3JlYWRfY29tcGxldGUoZCwgTlVMTCwgMCwg
QlVMS19TVEFUVVNfQ0FOQ0VMRUQpOworICAgICAgICAgICAgfQorICAgICAgICAgICAgcmV0dXJu
OworICAgICAgICB9CisgICAgfQorICAgIFNQSUNFX0RFQlVHKCIlczogRVJST1I6IG5vIHN1Y2gg
aWQgdG8gY2FuY2VsISIsIF9fRlVOQ1RJT05fXyk7Cit9CisKKy8vIGNhbGxlZCB3aGVuIGEgY2hh
bmdlIGhhcHBlbnMgb24gU0NTSSBsYXllcgordm9pZCBjZF91c2JfYnVsa19tc2RfbHVuX2NoYW5n
ZWQodm9pZCAqdXNlcl9kYXRhLCB1aW50MzJfdCBsdW4pCit7CisgICAgVXNiQ2QgKmQgPSAoVXNi
Q2QgKil1c2VyX2RhdGE7CisgICAgQ2RTY3NpRGV2aWNlSW5mbyBjZF9pbmZvOworCisgICAgaWYg
KCFjZF91c2JfYnVsa19tc2RfZ2V0X2luZm8oZC0+bXNjLCBsdW4sICZjZF9pbmZvKSkgeworICAg
ICAgICAvLyBsb2FkIG9yIHVubG9hZCBjb21tYW5kIHJlY2VpdmVkIGZyb20gU0NTSQorICAgICAg
ICBpZiAoZC0+dW5pdHNbbHVuXS5sb2FkZWQgIT0gY2RfaW5mby5sb2FkZWQpIHsKKyAgICAgICAg
ICAgIGlmICghbG9hZF9sdW4oZCwgbHVuLCBjZF9pbmZvLmxvYWRlZCkpIHsKKyAgICAgICAgICAg
ICAgICBTUElDRV9ERUJVRygiJXM6IGxvYWQgZmFpbGVkLCB1bmxvYWRpbmcgdW5pdCIsIF9fRlVO
Q1RJT05fXyk7CisgICAgICAgICAgICAgICAgY2RfdXNiX2J1bGtfbXNkX3VubG9hZChkLT5tc2Ms
IGx1bik7CisgICAgICAgICAgICB9CisgICAgICAgIH0KKyAgICB9CisKKyAgICBpZiAoZC0+ZGVs
ZXRlX29uX2VqZWN0KSB7CisgICAgICAgIGQtPmRlbGV0ZV9vbl9lamVjdCA9IEZBTFNFOworICAg
ICAgICBkLT5kZWxldGluZyA9IFRSVUU7CisgICAgfSBlbHNlIHsKKyAgICAgICAgc3BpY2VfdXNi
X2JhY2tlbmRfZGV2aWNlX3JlcG9ydF9jaGFuZ2UoZC0+YmFja2VuZCwgZC0+cGFyZW50KTsKKyAg
ICB9Cit9CisKK3N0YXRpYyBnY2hhciAqdXNiX2NkX2dldF9wcm9kdWN0X2Rlc2NyaXB0aW9uKFVz
YkNkICpkZXZpY2UpCit7CisgICAgZ2NoYXIgKmJhc2VfbmFtZSA9IGdfcGF0aF9nZXRfYmFzZW5h
bWUoZGV2aWNlLT51bml0c1swXS5maWxlbmFtZSk7CisgICAgZ2NoYXIgKnJlcyA9IGdfc3RyZHVw
X3ByaW50ZigiU1BJQ0UgQ0QgKCVzKSIsIGJhc2VfbmFtZSk7CisgICAgZ19mcmVlKGJhc2VfbmFt
ZSk7CisgICAgcmV0dXJuIHJlczsKK30KKworc3RhdGljIGNvbnN0IFVzYkRldmljZU9wcyBkZXZv
cHMgPQoreworICAgIC5nZXRfZGVzY3JpcHRvciA9IHVzYl9jZF9nZXRfZGVzY3JpcHRvciwKKyAg
ICAuZ2V0X3Byb2R1Y3RfZGVzY3JpcHRpb24gPSB1c2JfY2RfZ2V0X3Byb2R1Y3RfZGVzY3JpcHRp
b24sCisgICAgLmF0dGFjaCA9IHVzYl9jZF9hdHRhY2gsCisgICAgLnJlc2V0ID0gdXNiX2NkX3Jl
c2V0LAorICAgIC5kZXRhY2ggPSB1c2JfY2RfZGV0YWNoLAorICAgIC5jb250cm9sX3JlcXVlc3Qg
PSB1c2JfY2RfY29udHJvbF9yZXF1ZXN0LAorICAgIC5idWxrX291dF9yZXF1ZXN0ID0gdXNiX2Nk
X2J1bGtfb3V0X3JlcXVlc3QsCisgICAgLmJ1bGtfaW5fcmVxdWVzdCA9IHVzYl9jZF9idWxrX2lu
X3JlcXVlc3QsCisgICAgLmNhbmNlbF9yZXF1ZXN0ID0gdXNiX2NkX2NhbmNlbF9yZXF1ZXN0LAor
ICAgIC51bnJlYWxpemUgPSB1c2JfY2RfdW5yZWFsaXplLAorfTsKKworc3RhdGljIFVzYkNkKiB1
c2JfY2RfY3JlYXRlKFNwaWNlVXNiQmFja2VuZCAqYmUsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpwYXJlbnQsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdm9pZCAqb3BhcXVlX3BhcmFtLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
IEdFcnJvciAqKmVycikKK3sKKyAgICBDZEVtdWxhdGlvblBhcmFtcyAqcGFyYW0gPSBvcGFxdWVf
cGFyYW07CisgICAgaW50IGVycm9yID0gMCwgaTsKKyAgICB1aW50MzJfdCB1bml0ID0gMDsKKyAg
ICBVc2JDZCAqZCA9IGdfbmV3MChVc2JDZCwgMSk7CisgICAgQ2RTY3NpRGV2aWNlUGFyYW1ldGVy
cyBkZXZfcGFyYW1zID0geyAwIH07CisgICAgdWludDE2X3QgYWRkcmVzcyA9IHNwaWNlX3VzYl9i
YWNrZW5kX2RldmljZV9nZXRfaW5mbyhwYXJlbnQpLT5hZGRyZXNzOworCisgICAgZC0+ZGV2X29w
cyA9IGRldm9wczsKKyAgICBkLT5iYWNrZW5kID0gYmU7CisgICAgZC0+cGFyZW50ICA9IHBhcmVu
dDsKKyAgICBkLT5kZWxldGVfb25fZWplY3QgPSAhIXBhcmFtLT5kZWxldGVfb25fZWplY3Q7Cisg
ICAgZC0+bG9ja2VkID0gIWQtPmRlbGV0ZV9vbl9lamVjdDsKKyAgICBkLT5zZXJpYWxbMF0gPSAw
eDAzMDAgKyBzaXplb2YoZC0+c2VyaWFsKTsKKyAgICBkLT5zZXJpYWxbMV0gPSAnMCcgKyBhZGRy
ZXNzIC8gMTA7CisgICAgZC0+c2VyaWFsWzJdID0gJzAnICsgYWRkcmVzcyAlIDEwOworICAgIGZv
ciAoaSA9IDM7IGkgPCBHX05fRUxFTUVOVFMoZC0+c2VyaWFsKTsgKytpKSB7CisgICAgICAgIGQt
PnNlcmlhbFtpXSA9ICcwJzsKKyAgICB9CisgICAgZC0+bWF4X2x1bl9pbmRleCA9IE1BWF9MVU5f
UEVSX0RFVklDRSAtIDE7CisKKyAgICBkZXZfcGFyYW1zLnZlbmRvciA9ICJSZWQgSGF0IjsKKyAg
ICBkZXZfcGFyYW1zLnByb2R1Y3QgPSAiU1BJQ0UgQ0QiOworICAgIGRldl9wYXJhbXMudmVyc2lv
biA9ICIwIjsKKworICAgIGQtPm1zYyA9IGNkX3VzYl9idWxrX21zZF9hbGxvYyhkLCBNQVhfTFVO
X1BFUl9ERVZJQ0UpOworICAgIGlmICghZC0+bXNjKSB7CisgICAgICAgIGdfY2xlYXJfcG9pbnRl
cigmZCwgZ19mcmVlKTsKKyAgICAgICAgZ19zZXRfZXJyb3IoZXJyLCBTUElDRV9DTElFTlRfRVJS
T1IsIFNQSUNFX0NMSUVOVF9FUlJPUl9GQUlMRUQsCisgICAgICAgICAgICAgICAgICAgIF8oImNh
bid0IGFsbG9jYXRlIGRldmljZSIpKTsKKyAgICAgICAgcmV0dXJuIE5VTEw7CisgICAgfQorICAg
IGQtPnVuaXRzW3VuaXRdLmJsb2NrU2l6ZSA9IENEX0RFVl9CTE9DS19TSVpFOworICAgIGlmICgh
Y2RfdXNiX2J1bGtfbXNkX3JlYWxpemUoZC0+bXNjLCB1bml0LCAmZGV2X3BhcmFtcykpIHsKKyAg
ICAgICAgaWYgKG9wZW5fc3RyZWFtKCZkLT51bml0c1t1bml0XSwgcGFyYW0tPmZpbGVuYW1lKSAm
JgorICAgICAgICAgICAgbG9hZF9sdW4oZCwgdW5pdCwgVFJVRSkpIHsKKyAgICAgICAgICAgIGlm
IChkLT5sb2NrZWQpIHsKKyAgICAgICAgICAgICAgICBjZF91c2JfYnVsa19tc2RfbG9jayhkLT5t
c2MsIHVuaXQsIFRSVUUpOworICAgICAgICAgICAgfQorICAgICAgICB9IGVsc2UgeworICAgICAg
ICAgICAgY2xvc2Vfc3RyZWFtKCZkLT51bml0c1t1bml0XSk7CisgICAgICAgICAgICBjZF91c2Jf
YnVsa19tc2RfdW5yZWFsaXplKGQtPm1zYywgdW5pdCk7CisgICAgICAgICAgICBnX3NldF9lcnJv
cihlcnIsIFNQSUNFX0NMSUVOVF9FUlJPUiwgU1BJQ0VfQ0xJRU5UX0VSUk9SX0ZBSUxFRCwKKyAg
ICAgICAgICAgICAgICAgICAgICAgIF8oImNhbid0IGNyZWF0ZSBkZXZpY2Ugd2l0aCAlcyIpLAor
ICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW0tPmZpbGVuYW1lKTsKKyAgICAgICAgICAgIGVy
cm9yID0gMTsKKyAgICAgICAgfQorICAgIH0gZWxzZSB7CisgICAgICAgIGdfc2V0X2Vycm9yKGVy
ciwgU1BJQ0VfQ0xJRU5UX0VSUk9SLCBTUElDRV9DTElFTlRfRVJST1JfRkFJTEVELAorICAgICAg
ICAgICAgICAgICAgICBfKCJjYW4ndCBhbGxvY2F0ZSBkZXZpY2UiKSk7CisgICAgICAgIGVycm9y
ID0gMTsKKyAgICB9CisgICAgaWYgKGVycm9yKSB7CisgICAgICAgIGdfY2xlYXJfcG9pbnRlcigm
ZC0+bXNjLCBjZF91c2JfYnVsa19tc2RfZnJlZSk7CisgICAgICAgIGdfY2xlYXJfcG9pbnRlcigm
ZCwgZ19mcmVlKTsKKyAgICAgICAgcmV0dXJuIE5VTEw7CisgICAgfQorCisgICAgcmV0dXJuIGQ7
Cit9CisKK2dib29sZWFuCitjcmVhdGVfZW11bGF0ZWRfY2QoU3BpY2VVc2JCYWNrZW5kICpiZSwK
KyAgICAgICAgICAgICAgICAgICBDZEVtdWxhdGlvblBhcmFtcyAqcGFyYW0sCisgICAgICAgICAg
ICAgICAgICAgR0Vycm9yICoqZXJyKQoreworICAgIHJldHVybiBzcGljZV91c2JfYmFja2VuZF9j
cmVhdGVfZW11bGF0ZWRfZGV2aWNlKGJlLCB1c2JfY2RfY3JlYXRlLCBwYXJhbSwgZXJyKTsKK30K
KworI2VuZGlmIC8qIFVTRV9VU0JSRURJUiAqLwpkaWZmIC0tZ2l0IGEvc3JjL3VzYi1kZXZpY2Ut
Y2QuaCBiL3NyYy91c2ItZGV2aWNlLWNkLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAw
MDAwMDAuLmU5ODUyNDIyCi0tLSAvZGV2L251bGwKKysrIGIvc3JjL3VzYi1kZXZpY2UtY2QuaApA
QCAtMCwwICsxLDM0IEBACisvKiAtKi0gTW9kZTogQzsgYy1iYXNpYy1vZmZzZXQ6IDQ7IGluZGVu
dC10YWJzLW1vZGU6IG5pbCAtKi0gKi8KKy8qCisgICAgQ29weXJpZ2h0IChDKSAyMDE5IFJlZCBI
YXQsIEluYy4KKworICAgIFJlZCBIYXQgQXV0aG9yczoKKyAgICBZdXJpIEJlbmRpdG92aWNoPHli
ZW5kaXRvQHJlZGhhdC5jb20+CisKKyAgICBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsg
eW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCisgICAgbW9kaWZ5IGl0IHVuZGVyIHRoZSB0
ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYworICAgIExpY2Vuc2UgYXMgcHVi
bGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlcgorICAgIHZlcnNp
b24gMi4xIG9mIHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJz
aW9uLgorCisgICAgVGhpcyBsaWJyYXJ5IGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQg
aXQgd2lsbCBiZSB1c2VmdWwsCisgICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0
IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKKyAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklU
TkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQorICAgIExlc3NlciBH
ZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCisKKyAgICBZb3Ugc2hvdWxk
IGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCisg
ICAgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCBzZWUgPGh0dHA6Ly93
d3cuZ251Lm9yZy9saWNlbnNlcy8+LgorKi8KKworI3ByYWdtYSBvbmNlCisKKyNpbmNsdWRlICJ1
c2ItYmFja2VuZC5oIgorCit0eXBlZGVmIHN0cnVjdCBDZEVtdWxhdGlvblBhcmFtcyB7CisgICAg
Y29uc3QgY2hhciAqZmlsZW5hbWU7CisgICAgdWludDMyX3QgZGVsZXRlX29uX2VqZWN0IDogMTsK
K30gQ2RFbXVsYXRpb25QYXJhbXM7CisKK2dib29sZWFuCitjcmVhdGVfZW11bGF0ZWRfY2QoU3Bp
Y2VVc2JCYWNrZW5kICpiZSwKKyAgICAgICAgICAgICAgICAgICBDZEVtdWxhdGlvblBhcmFtcyAq
cGFyYW0sCisgICAgICAgICAgICAgICAgICAgR0Vycm9yICoqZXJyKTsKLS0gCjIuMjAuMQoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KU3BpY2UtZGV2ZWwg
bWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
