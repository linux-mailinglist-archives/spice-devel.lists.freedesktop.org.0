Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8712467F30
	for <lists+spice-devel@lfdr.de>; Sun, 14 Jul 2019 16:07:59 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B5B5C897F0;
	Sun, 14 Jul 2019 14:07:56 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail-wr1-x434.google.com (mail-wr1-x434.google.com
 [IPv6:2a00:1450:4864:20::434])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6F421897E7
 for <spice-devel@lists.freedesktop.org>; Sun, 14 Jul 2019 14:07:54 +0000 (UTC)
Received: by mail-wr1-x434.google.com with SMTP id z1so14353561wru.13
 for <spice-devel@lists.freedesktop.org>; Sun, 14 Jul 2019 07:07:54 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=yDwWS9SowoV9PbOztaKKTTNZuG3fexCZr/WAsOyjphA=;
 b=sxyTnNh6mgExruNd3cvZ4B38MYWtNDfaIm13i9TuLVOrsypZoAm7j41OaZs66WJsfT
 /C6rnxLkDirXGedqcv9n5xFCXTM55cRXjssme2sk9C6d5V1Rrut4JL9vPKLAy8JUj2u4
 hchbXDcsLaz48CpbUeHMyWo2hFqhOxg3VriH+74tkDuv5ohUky2FyU3yCdqiVZrakPMr
 CwkSVPjLY+wb/CUluYVScPH7nOXMYic8OUiT5io4OgTZMHRvdAWTrYJwVLCvHlxGCGNJ
 8lMxcvK9riNnm9jKKSqStCZ4KsFHZJzugFFVYx5U/Evii1n/7PAuGqo4LDha8k6mYG9h
 DCOw==
X-Gm-Message-State: APjAAAVz+Wo9YYfudo3SaalGG5jZEyuKy4ewdqmjdIGLhJiqDqtW3c/V
 JXk/kGDwHqVb0XrKdjek1TEUyhgh
X-Google-Smtp-Source: APXvYqwJbZNxtwLFTqxs4lDabpU3vDTrjpRVRrn4F/dUNGq4oiBsQA9L/5MvMOapdC8Gv+Y+GrsO2A==
X-Received: by 2002:a5d:498f:: with SMTP id r15mr22103949wrq.353.1563113272128; 
 Sun, 14 Jul 2019 07:07:52 -0700 (PDT)
Received: from f2.redhat.com (bzq-79-182-115-245.red.bezeqint.net.
 [79.182.115.245])
 by smtp.gmail.com with ESMTPSA id z19sm10223328wmi.7.2019.07.14.07.07.50
 (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
 Sun, 14 Jul 2019 07:07:51 -0700 (PDT)
From: Yuri Benditovich <yuri.benditovich@daynix.com>
To: spice-devel@lists.freedesktop.org
Date: Sun, 14 Jul 2019 17:07:38 +0300
Message-Id: <20190714140741.3274-3-yuri.benditovich@daynix.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190714140741.3274-1-yuri.benditovich@daynix.com>
References: <20190714140741.3274-1-yuri.benditovich@daynix.com>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=daynix-com.20150623.gappssmtp.com; s=20150623;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=yDwWS9SowoV9PbOztaKKTTNZuG3fexCZr/WAsOyjphA=;
 b=nT4IBqMUZ1oWhqrFaRLHcLgToT3xeE1mdsSWTV+HnxG+FQZugQ2P+arOwEoHBw/+cN
 5cGpx0kWzXpaXDs9DsTn/3i2KuULlgTiQSs7sdNCIyXtlch9p57/bxs4//9Q5RV1PS5Q
 YLlHESq9E9huxvgPX/Z6S6VAkV59d/b6JhCH/74Cz3Pa1CQJ1TJOqxiHfkHMH4UqVNcc
 2mDnO60B//azsYagS/DpSkZtFwlSjnM8hzS7h7iaBA/KQ7sbI4YoqEtn3y/HDG6/EKB5
 EDA4c9M+dRHMrjq6fjMt0Hg02KOmKRbbCJcjbrJ+O7LdJUapr4QwghskFciptBoJ6+y5
 WgEQ==
Subject: [Spice-devel] [spice-gtk 2/5] usb-redir: unify device
 hotplug/unplug for Windows and Linux
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: yan@daynix.com
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

UmVtb3ZlIFdpbmRvd3Mtc3BlY2lmaWMgcGFydCBvZiBob3RwbHVnIGRldGVjdGlvbiBmcm9tCnVz
Yi1kZXZpY2UtbWFuYWdlciBhbmQgd2luLXVzYi1kZXYgYW5kIHBsYWNlIGl0IGludG8KVVNCIGJh
Y2tlbmQgbW9kdWxlLiBDb25uZWN0IHRoZSBob3RwbHVnL3VucGx1ZyBkZXRlY3Rpb24KaW4gV2lu
ZG93cyB0byB0aGUgc2FtZSBjYWxsYmFja3MgYWxyZWFkeSB1c2VkIGluIExpbnV4LgpUaGlzIHJl
bW92ZXMgc2lnbmlmaWNhbnQgcGFydCBvZiBXaW5kb3dzLXNwZWNpZmljIGNvZGUKYW5kIHNpbXBp
ZmllcyB0aGluZ3MuCk5vdGUgcmVnYXJkaW5nICdyZWRpcmVjdGluZycgcHJvcGVydHkgb2YgdXNi
LWRldmljZS1tYW5hZ2VyOgotIFByZXZpb3VzbHkgdXNiLWRldmljZS1tYW5hZ2VyIHVuZGVyIFdp
bmRvd3MgbWFpbnRhaW5lZAogICdyZWRpcmVjdGlvbicgcHJvcGVydHkgaW4gd2luLXVzYi1kZXYK
LSBOb3cgaXQgbWFpbnRhaW5zIGl0cyBvd24gcHJvcGVydHkgaW4gYm90aCBXaW5kb3dzIGFuZAog
IExpbnV4IChmb3IgR1VJIGFuZCBzaW5nbGUgcmVkaXJlY3QgYXQgYSB0aW1lKQotIFRoZSBVU0Ig
YmFja2VuZCBtYWludGFpbnMgaXRzIG93biAncmVkaXJlY3RpbmcnIGZpZWxkCiAgaW4gV2luZG93
cyB0byBwcmV2ZW50IHVwZGF0ZSBvZiBkZXZpY2UgbGlzdCB3aGVuCiAgbGlidXNiIG9wZW5zIHRo
ZSBkZXZpY2UgKGRldmljZSByZWRpcmVjdGlvbiBjYXVzZXMKICB0ZW1wb3JhcnkgcmVtb3ZhbCBv
ZiB0YXJnZXQgZGV2aWNlKQoKU2lnbmVkLW9mZi1ieTogWXVyaSBCZW5kaXRvdmljaCA8eXVyaS5i
ZW5kaXRvdmljaEBkYXluaXguY29tPgotLS0KIG1lc29uLmJ1aWxkICAgICAgICAgICAgICB8ICAg
MiArLQogc3JjL21lc29uLmJ1aWxkICAgICAgICAgIHwgICA0ICstCiBzcmMvdXNiLWJhY2tlbmQu
YyAgICAgICAgfCAzNjAgKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0KIHNyYy91c2It
YmFja2VuZC5oICAgICAgICB8ICAgOCAtCiBzcmMvdXNiLWRldmljZS1tYW5hZ2VyLmMgfCAgNjEg
Ky0tLS0tCiBzcmMvd2luLXVzYi1kZXYuYyAgICAgICAgfCA0MzYgLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tCiBzcmMvd2luLXVzYi1kZXYuaCAgICAgICAgfCAgODQgLS0t
LS0tLS0KIDcgZmlsZXMgY2hhbmdlZCwgMjU1IGluc2VydGlvbnMoKyksIDcwMCBkZWxldGlvbnMo
LSkKIGRlbGV0ZSBtb2RlIDEwMDY0NCBzcmMvd2luLXVzYi1kZXYuYwogZGVsZXRlIG1vZGUgMTAw
NjQ0IHNyYy93aW4tdXNiLWRldi5oCgpkaWZmIC0tZ2l0IGEvbWVzb24uYnVpbGQgYi9tZXNvbi5i
dWlsZAppbmRleCA1NDE2MGY5Li4xZjZlYTZkIDEwMDY0NAotLS0gYS9tZXNvbi5idWlsZAorKysg
Yi9tZXNvbi5idWlsZApAQCAtMTE3LDcgKzExNyw3IEBAIGVuZGZvcmVhY2gKIAogZGVwcyA9IFtd
CiBpZiBob3N0X21hY2hpbmUuc3lzdGVtKCkgPT0gJ3dpbmRvd3MnCi0gIGRlcHMgKz0gWydsaWJ3
czJfMzInLCAnbGliZ2RpMzInXQorICBkZXBzICs9IFsnbGlid3MyXzMyJywgJ2xpYmdkaTMyJywg
J2xpYmNvbWN0bDMyJ10KIGVuZGlmCiAKIGZvcmVhY2ggZGVwIDogZGVwcwpkaWZmIC0tZ2l0IGEv
c3JjL21lc29uLmJ1aWxkIGIvc3JjL21lc29uLmJ1aWxkCmluZGV4IGE1MWQwYTkuLmFkY2ZhZWMg
MTAwNjQ0Ci0tLSBhL3NyYy9tZXNvbi5idWlsZAorKysgYi9zcmMvbWVzb24uYnVpbGQKQEAgLTE1
OCw5ICsxNTgsNyBAQCBlbmRpZgogCiBpZiBzcGljZV9ndGtfaGFzX3VzYnJlZGlyIGFuZCBob3N0
X21hY2hpbmUuc3lzdGVtKCkgPT0gJ3dpbmRvd3MnCiAgIHNwaWNlX2NsaWVudF9nbGliX3NvdXJj
ZXMgKz0gWyd1c2Jka19hcGkuYycsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd1
c2Jka19hcGkuaCcsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd3aW4tdXNiLWRl
di5jJywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3dpbi11c2ItZGV2LmgnXQor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndXNiZGtfYXBpLmgnXQogZW5kaWYKIAog
IwpkaWZmIC0tZ2l0IGEvc3JjL3VzYi1iYWNrZW5kLmMgYi9zcmMvdXNiLWJhY2tlbmQuYwppbmRl
eCBhMmM1MDJkLi45OTY0YzRmIDEwMDY0NAotLS0gYS9zcmMvdXNiLWJhY2tlbmQuYworKysgYi9z
cmMvdXNiLWJhY2tlbmQuYwpAQCAtMzIsNiArMzIsOSBAQAogI2luY2x1ZGUgPGxpYnVzYi5oPgog
I2luY2x1ZGUgPHN0cmluZy5oPgogI2luY2x1ZGUgPGZjbnRsLmg+CisjaWZkZWYgR19PU19XSU4z
MgorI2luY2x1ZGUgPGNvbW1jdHJsLmg+CisjZW5kaWYKICNpbmNsdWRlICJ1c2JyZWRpcmhvc3Qu
aCIKICNpbmNsdWRlICJ1c2JyZWRpcnBhcnNlci5oIgogI2luY2x1ZGUgInNwaWNlLXV0aWwuaCIK
QEAgLTU1LDYgKzU4LDExIEBAIHN0cnVjdCBfU3BpY2VVc2JCYWNrZW5kCiAgICAgdXNiX2hvdF9w
bHVnX2NhbGxiYWNrIGhvdHBsdWdfY2FsbGJhY2s7CiAgICAgdm9pZCAqaG90cGx1Z191c2VyX2Rh
dGE7CiAgICAgbGlidXNiX2hvdHBsdWdfY2FsbGJhY2tfaGFuZGxlIGhvdHBsdWdfaGFuZGxlOwor
I2lmZGVmIEdfT1NfV0lOMzIKKyAgICBIQU5ETEUgaFduZDsKKyAgICBsaWJ1c2JfZGV2aWNlICoq
bGlidXNiX2RldmljZV9saXN0OworICAgIGdpbnQgcmVkaXJlY3Rpbmc7CisjZW5kaWYKIH07CiAK
IHN0cnVjdCBfU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbApAQCAtNjYsOSArNzQsMjI5IEBAIHN0cnVj
dCBfU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbAogICAgIGludCBydWxlc19jb3VudDsKICAgICBTcGlj
ZVVzYkJhY2tlbmREZXZpY2UgKmF0dGFjaGVkOwogICAgIFNwaWNlVXNicmVkaXJDaGFubmVsICAq
dXNlcl9kYXRhOworICAgIFNwaWNlVXNiQmFja2VuZCAqYmFja2VuZDsKICAgICBHRXJyb3IgKipl
cnJvcjsKIH07CiAKK3N0YXRpYyBnYm9vbGVhbiBmaWxsX3VzYl9pbmZvKFNwaWNlVXNiQmFja2Vu
ZERldmljZSAqYmRldikKK3sKKyAgICBVc2JEZXZpY2VJbmZvcm1hdGlvbiAqaW5mbyA9ICZiZGV2
LT5kZXZpY2VfaW5mbzsKKworICAgIHN0cnVjdCBsaWJ1c2JfZGV2aWNlX2Rlc2NyaXB0b3IgZGVz
YzsKKyAgICBsaWJ1c2JfZGV2aWNlICpsaWJkZXYgPSBiZGV2LT5saWJ1c2JfZGV2aWNlOworICAg
IGxpYnVzYl9nZXRfZGV2aWNlX2Rlc2NyaXB0b3IobGliZGV2LCAmZGVzYyk7CisgICAgaW5mby0+
YnVzID0gbGlidXNiX2dldF9idXNfbnVtYmVyKGxpYmRldik7CisgICAgaW5mby0+YWRkcmVzcyA9
IGxpYnVzYl9nZXRfZGV2aWNlX2FkZHJlc3MobGliZGV2KTsKKyAgICBpZiAoaW5mby0+YWRkcmVz
cyA9PSAweGZmIHx8IC8qIHJvb3QgaHViIChIQ0QpICovCisgICAgICAgIGluZm8tPmFkZHJlc3Mg
PD0gMSB8fCAvKiByb290IGh1YiBvciBiYWQgYWRkcmVzcyAqLworICAgICAgICAoZGVzYy5iRGV2
aWNlQ2xhc3MgPT0gTElCVVNCX0NMQVNTX0hVQikgLypodWIqLykgeworICAgICAgICByZXR1cm4g
RkFMU0U7CisgICAgfQorCisgICAgaW5mby0+dmlkID0gZGVzYy5pZFZlbmRvcjsKKyAgICBpbmZv
LT5waWQgPSBkZXNjLmlkUHJvZHVjdDsKKyAgICBpbmZvLT5jbGFzcyA9IGRlc2MuYkRldmljZUNs
YXNzOworICAgIGluZm8tPnN1YmNsYXNzID0gZGVzYy5iRGV2aWNlU3ViQ2xhc3M7CisgICAgaW5m
by0+cHJvdG9jb2wgPSBkZXNjLmJEZXZpY2VQcm90b2NvbDsKKworICAgIHJldHVybiBUUlVFOwor
fQorCitzdGF0aWMgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICphbGxvY2F0ZV9iYWNrZW5kX2Rldmlj
ZShsaWJ1c2JfZGV2aWNlICpsaWJkZXYpCit7CisgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpk
ZXYgPSBnX25ldzAoU3BpY2VVc2JCYWNrZW5kRGV2aWNlLCAxKTsKKyAgICBkZXYtPnJlZl9jb3Vu
dCA9IDE7CisgICAgZGV2LT5saWJ1c2JfZGV2aWNlID0gbGliZGV2OworICAgIGlmICghZmlsbF91
c2JfaW5mbyhkZXYpKSB7CisgICAgICAgIGdfY2xlYXJfcG9pbnRlcigmZGV2LCBnX2ZyZWUpOwor
ICAgIH0KKyAgICByZXR1cm4gZGV2OworfQorCitzdGF0aWMgaW50IExJQlVTQl9DQUxMIGhvdHBs
dWdfY2FsbGJhY2sobGlidXNiX2NvbnRleHQgKmN0eCwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBsaWJ1c2JfZGV2aWNlICpkZXZpY2UsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgbGlidXNiX2hvdHBsdWdfZXZlbnQgZXZlbnQsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqdXNlcl9kYXRhKQorewor
ICAgIFNwaWNlVXNiQmFja2VuZCAqYmUgPSAoU3BpY2VVc2JCYWNrZW5kICopdXNlcl9kYXRhOwor
ICAgIGlmIChiZS0+aG90cGx1Z19jYWxsYmFjaykgeworICAgICAgICBTcGljZVVzYkJhY2tlbmRE
ZXZpY2UgKmRldjsKKyAgICAgICAgZ2Jvb2xlYW4gdmFsID0gZXZlbnQgPT0gTElCVVNCX0hPVFBM
VUdfRVZFTlRfREVWSUNFX0FSUklWRUQ7CisgICAgICAgIGRldiA9IGFsbG9jYXRlX2JhY2tlbmRf
ZGV2aWNlKGRldmljZSk7CisgICAgICAgIGlmIChkZXYpIHsKKyAgICAgICAgICAgIFNQSUNFX0RF
QlVHKCJjcmVhdGVkIGRldiAlcCwgdXNibGliIGRldiAlcCIsIGRldiwgZGV2aWNlKTsKKyAgICAg
ICAgICAgIGxpYnVzYl9yZWZfZGV2aWNlKGRldmljZSk7CisgICAgICAgICAgICBiZS0+aG90cGx1
Z19jYWxsYmFjayhiZS0+aG90cGx1Z191c2VyX2RhdGEsIGRldiwgdmFsKTsKKyAgICAgICAgICAg
IHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV91bnJlZihkZXYpOworICAgICAgICB9CisgICAgfQor
ICAgIHJldHVybiAwOworfQorCisjaWZkZWYgR19PU19XSU4zMgorLyogV2luZG93cy1zcGVjaWZp
YzogZ2V0IG5vdGlmaWNhdGlvbiBvbiBkZXZpY2UgY2hhbmdlICovCisKK3N0YXRpYyBnYm9vbGVh
biBpc19zYW1lX2xpYnVzYl9kZXYobGlidXNiX2RldmljZSAqZGV2MSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgVXNiRGV2aWNlSW5mb3JtYXRpb24gKmluZm8xLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ1c2JfZGV2aWNlICpkZXYyKQoreworICAg
IHN0cnVjdCBsaWJ1c2JfZGV2aWNlX2Rlc2NyaXB0b3IgZGVzYzsKKyAgICBpbmZvMS0+YnVzID0g
bGlidXNiX2dldF9idXNfbnVtYmVyKGRldjEpOworICAgIGluZm8xLT5hZGRyZXNzID0gbGlidXNi
X2dldF9kZXZpY2VfYWRkcmVzcyhkZXYxKTsKKyAgICBsaWJ1c2JfZ2V0X2RldmljZV9kZXNjcmlw
dG9yKGRldjEsICZkZXNjKTsKKyAgICBpbmZvMS0+dmlkID0gZGVzYy5pZFZlbmRvcjsKKyAgICBp
bmZvMS0+cGlkID0gZGVzYy5pZFByb2R1Y3Q7CisgICAgaWYgKGRldjIgPT0gTlVMTCkgeworICAg
ICAgICByZXR1cm4gRkFMU0U7CisgICAgfQorICAgIGxpYnVzYl9nZXRfZGV2aWNlX2Rlc2NyaXB0
b3IoZGV2MiwgJmRlc2MpOworICAgIHJldHVybiBpbmZvMS0+YnVzID09IGxpYnVzYl9nZXRfYnVz
X251bWJlcihkZXYyKSAmJgorICAgICAgICAgICBpbmZvMS0+YWRkcmVzcyA9PSBsaWJ1c2JfZ2V0
X2RldmljZV9hZGRyZXNzKGRldjIpICYmCisgICAgICAgICAgIGluZm8xLT52aWQgPT0gZGVzYy5p
ZFZlbmRvciAmJgorICAgICAgICAgICBpbmZvMS0+cGlkID09IGRlc2MuaWRQcm9kdWN0OworfQor
CitzdGF0aWMgaW50IGNvbXBhcmVfZGV2X2xpc3QoU3BpY2VVc2JCYWNrZW5kICpiZSwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBsaWJ1c2JfZGV2aWNlICoqbDEsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgbGlidXNiX2RldmljZSAqKmwyLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGdib29sZWFuIHZhbHVlKQoreworICAgIGludCByZXMgPSAwOworICAgIHdoaWxlICgq
bDEpIHsKKyAgICAgICAgZ2Jvb2xlYW4gZm91bmQgPSAwOworICAgICAgICB1aW50MzJfdCBuID0g
MDsKKyAgICAgICAgVXNiRGV2aWNlSW5mb3JtYXRpb24gaW5mbzE7CisgICAgICAgIHdoaWxlICgh
Zm91bmQpIHsKKyAgICAgICAgICAgIGZvdW5kID0gaXNfc2FtZV9saWJ1c2JfZGV2KCpsMSwgJmlu
Zm8xLCBsMltuXSk7CisgICAgICAgICAgICBpZiAobDJbbl0gPT0gTlVMTCkgeworICAgICAgICAg
ICAgICAgIGJyZWFrOworICAgICAgICAgICAgfQorICAgICAgICAgICAgbisrOworICAgICAgICB9
CisgICAgICAgIGlmICghZm91bmQpIHsKKyAgICAgICAgICAgIFNQSUNFX0RFQlVHKCIlcyAlMDRY
OiUwNFggYXQgJWQ6JWQiLCB2YWx1ZSA/ICJhZGRpbmciIDogInJlbW92aW5nIiwKKyAgICAgICAg
ICAgICAgICBpbmZvMS52aWQsIGluZm8xLnBpZCwgaW5mbzEuYnVzLCBpbmZvMS5hZGRyZXNzKTsK
KyAgICAgICAgICAgIGhvdHBsdWdfY2FsbGJhY2soTlVMTCwgKmwxLAorICAgICAgICAgICAgICAg
IHZhbHVlID8gTElCVVNCX0hPVFBMVUdfRVZFTlRfREVWSUNFX0FSUklWRUQgOiBMSUJVU0JfSE9U
UExVR19FVkVOVF9ERVZJQ0VfTEVGVCwKKyAgICAgICAgICAgICAgICBiZSk7CisgICAgICAgICAg
ICByZXMrKzsKKyAgICAgICAgfQorICAgICAgICBsMSsrOworICAgIH0KKyAgICByZXR1cm4gcmVz
OworfQorCitzdGF0aWMgTFJFU1VMVCBzdWJjbGFzc19wcm9jKEhXTkQgaFduZCwgVUlOVCB1TXNn
LCBXUEFSQU0gd1BhcmFtLCBMUEFSQU0gbFBhcmFtLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIFVJTlRfUFRSIHVJZFN1YmNsYXNzLCBEV09SRF9QVFIgZHdSZWZEYXRhKQoreworICAgIFNw
aWNlVXNiQmFja2VuZCAqYmUgPSAoU3BpY2VVc2JCYWNrZW5kICopZHdSZWZEYXRhOworICAgIGlm
ICh1TXNnID09IFdNX0RFVklDRUNIQU5HRSAmJiAhYmUtPnJlZGlyZWN0aW5nKSB7CisgICAgICAg
IGxpYnVzYl9kZXZpY2UgKipuZXdfbGlzdCA9IE5VTEw7CisgICAgICAgIGxpYnVzYl9nZXRfZGV2
aWNlX2xpc3QoYmUtPmxpYnVzYl9jb250ZXh0LCAmbmV3X2xpc3QpOworICAgICAgICBpZiAobmV3
X2xpc3QpIHsKKyAgICAgICAgICAgIGludCByZXMgPSBjb21wYXJlX2Rldl9saXN0KGJlLCBiZS0+
bGlidXNiX2RldmljZV9saXN0LCBuZXdfbGlzdCwgRkFMU0UpOworICAgICAgICAgICAgcmVzICs9
IGNvbXBhcmVfZGV2X2xpc3QoYmUsIG5ld19saXN0LCBiZS0+bGlidXNiX2RldmljZV9saXN0LCBU
UlVFKTsKKyAgICAgICAgICAgIGlmIChyZXMpIHsKKyAgICAgICAgICAgICAgICAvKiB0aGVyZSB3
ZXJlIGNoYW5nZXMgaW4gZGV2aWNlIHRyZWUgKi8KKyAgICAgICAgICAgICAgICBsaWJ1c2JfZnJl
ZV9kZXZpY2VfbGlzdChiZS0+bGlidXNiX2RldmljZV9saXN0LCBUUlVFKTsKKyAgICAgICAgICAg
ICAgICBiZS0+bGlidXNiX2RldmljZV9saXN0ID0gbmV3X2xpc3Q7CisgICAgICAgICAgICB9IGVs
c2UgeworICAgICAgICAgICAgICAgIGxpYnVzYl9mcmVlX2RldmljZV9saXN0KG5ld19saXN0LCBU
UlVFKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgIGdfd2Fy
bl9pZl9yZWFjaGVkKCk7CisgICAgICAgIH0KKyAgICB9CisgICAgcmV0dXJuIERlZlN1YmNsYXNz
UHJvYyhoV25kLCB1TXNnLCB3UGFyYW0sIGxQYXJhbSk7Cit9CisKK3N0YXRpYyB2b2lkIGRpc2Fi
bGVfaG90cGx1Z19zdXBwb3J0KFNwaWNlVXNiQmFja2VuZCAqYmUpCit7CisgICAgaWYgKGJlLT5o
V25kKSB7CisgICAgICAgIERlc3Ryb3lXaW5kb3coYmUtPmhXbmQpOworICAgICAgICBiZS0+aFdu
ZCA9IE5VTEw7CisgICAgfQorICAgIGlmIChiZS0+bGlidXNiX2RldmljZV9saXN0KSB7CisgICAg
ICAgIGxpYnVzYl9mcmVlX2RldmljZV9saXN0KGJlLT5saWJ1c2JfZGV2aWNlX2xpc3QsIFRSVUUp
OworICAgICAgICBiZS0+bGlidXNiX2RldmljZV9saXN0ID0gTlVMTDsKKyAgICB9Cit9CisKK3N0
YXRpYyBpbnQgZW5hYmxlX2hvdHBsdWdfc3VwcG9ydChTcGljZVVzYkJhY2tlbmQgKmJlLCBjb25z
dCBjaGFyICoqZXJyb3Jfb25fZW5hYmxlKQoreworICAgIGxvbmcgd2luX2VycjsKKyAgICBsaWJ1
c2JfZGV2aWNlICoqZGV2X2xpc3QgPSBOVUxMOworICAgIGxpYnVzYl9kZXZpY2UgKmR1bW15ID0g
TlVMTDsKKworICAgIGxpYnVzYl9nZXRfZGV2aWNlX2xpc3QoYmUtPmxpYnVzYl9jb250ZXh0LCAm
ZGV2X2xpc3QpOworICAgIGlmICghZGV2X2xpc3QpIHsKKyAgICAgICAgKmVycm9yX29uX2VuYWJs
ZSA9ICJHZXR0aW5nIGRldmljZSBsaXN0IjsKKyAgICAgICAgZ290byBlcnJvcjsKKyAgICB9Cisg
ICAgYmUtPmhXbmQgPSBDcmVhdGVXaW5kb3coIlN0YXRpYyIsIE5VTEwsIDAsIDAsIDAsIDAsIDAs
IE5VTEwsIE5VTEwsIE5VTEwsIE5VTEwpOworICAgIGlmICghYmUtPmhXbmQpIHsKKyAgICAgICAg
KmVycm9yX29uX2VuYWJsZSA9ICJDcmVhdGVXaW5kb3ciOworICAgICAgICBnb3RvIGVycm9yOwor
ICAgIH0KKyAgICBpZiAoIVNldFdpbmRvd1N1YmNsYXNzKGJlLT5oV25kLCBzdWJjbGFzc19wcm9j
LCAwLCAoRFdPUkRfUFRSKWJlKSkgeworICAgICAgICAqZXJyb3Jfb25fZW5hYmxlID0gIlNldFdp
bmRvd1N1YmNsYXNzIjsKKyAgICAgICAgZ290byBlcnJvcjsKKyAgICB9CisgICAgYmUtPmhvdHBs
dWdfaGFuZGxlID0gMTsKKyAgICBiZS0+bGlidXNiX2RldmljZV9saXN0ID0gZGV2X2xpc3Q7CisK
KyAgICBjb21wYXJlX2Rldl9saXN0KGJlLCBiZS0+bGlidXNiX2RldmljZV9saXN0LCAmZHVtbXks
IFRSVUUpOworCisgICAgcmV0dXJuIExJQlVTQl9TVUNDRVNTOworZXJyb3I6CisgICAgd2luX2Vy
ciA9IEdldExhc3RFcnJvcigpOworICAgIGlmICghd2luX2VycikgeworICAgICAgICB3aW5fZXJy
ID0gLTE7CisgICAgfQorICAgIGdfd2FybmluZygiJXMgZmFpbGVkOiAlbGQiLCAqZXJyb3Jfb25f
ZW5hYmxlLCB3aW5fZXJyKTsKKyAgICBpZiAoZGV2X2xpc3QpIHsKKyAgICAgICAgbGlidXNiX2Zy
ZWVfZGV2aWNlX2xpc3QoZGV2X2xpc3QsIFRSVUUpOworICAgIH0KKyAgICByZXR1cm4gd2luX2Vy
cjsKK30KKworc3RhdGljIHZvaWQgc2V0X3JlZGlyZWN0aW5nKFNwaWNlVXNiQmFja2VuZCAqYmUs
IGdib29sZWFuIG9uKQoreworICAgIGdib29sZWFuIG5vX3JlZGlyOworICAgIGlmIChvbikgewor
ICAgICAgICBnX2F0b21pY19pbnRfaW5jKCZiZS0+cmVkaXJlY3RpbmcpOworICAgIH0gZWxzZSB7
CisgICAgICAgIG5vX3JlZGlyID0gZ19hdG9taWNfaW50X2RlY19hbmRfdGVzdCgmYmUtPnJlZGly
ZWN0aW5nKTsKKyAgICAgICAgaWYgKG5vX3JlZGlyICYmIGJlLT5oV25kKSB7CisgICAgICAgICAg
ICBQb3N0TWVzc2FnZShiZS0+aFduZCwgV01fREVWSUNFQ0hBTkdFLCAwLCAwKTsKKyAgICAgICAg
fQorICAgIH0KK30KKworI2Vsc2UKKy8qIExpbnV4LXNwZWNpZmljOiB1c2UgaG90IGNhbGxiYWNr
IGZyb20gbGlidXNiICovCisKK3N0YXRpYyB2b2lkIGRpc2FibGVfaG90cGx1Z19zdXBwb3J0KFNw
aWNlVXNiQmFja2VuZCAqYmUpCit7CisgICAgbGlidXNiX2hvdHBsdWdfZGVyZWdpc3Rlcl9jYWxs
YmFjayhiZS0+bGlidXNiX2NvbnRleHQsIGJlLT5ob3RwbHVnX2hhbmRsZSk7Cit9CisKK3N0YXRp
YyBpbnQgZW5hYmxlX2hvdHBsdWdfc3VwcG9ydChTcGljZVVzYkJhY2tlbmQgKmJlLCBjb25zdCBj
aGFyICoqZXJyb3Jfb25fZW5hYmxlKQoreworICAgIGludCByYyA9IDA7CisgICAgcmMgPSBsaWJ1
c2JfaG90cGx1Z19yZWdpc3Rlcl9jYWxsYmFjayhiZS0+bGlidXNiX2NvbnRleHQsCisgICAgICAg
IExJQlVTQl9IT1RQTFVHX0VWRU5UX0RFVklDRV9BUlJJVkVEIHwgTElCVVNCX0hPVFBMVUdfRVZF
TlRfREVWSUNFX0xFRlQsCisgICAgICAgIExJQlVTQl9IT1RQTFVHX0VOVU1FUkFURSwgTElCVVNC
X0hPVFBMVUdfTUFUQ0hfQU5ZLAorICAgICAgICBMSUJVU0JfSE9UUExVR19NQVRDSF9BTlksIExJ
QlVTQl9IT1RQTFVHX01BVENIX0FOWSwKKyAgICAgICAgaG90cGx1Z19jYWxsYmFjaywgYmUsICZi
ZS0+aG90cGx1Z19oYW5kbGUpOworICAgICplcnJvcl9vbl9lbmFibGUgPSBsaWJ1c2Jfc3RyZXJy
b3IocmMpOworICAgIHJldHVybiByYzsKK30KKworI2RlZmluZSBzZXRfcmVkaXJlY3RpbmcoLi4u
KQorCisjZW5kaWYKKwogLyogbG9jayBmdW5jdGlvbnMgZm9yIHVzYnJlZGlyaG9zdCBhbmQgdXNi
cmVkaXJwYXJzZXIgKi8KIHN0YXRpYyB2b2lkICp1c2JyZWRpcl9hbGxvY19sb2NrKHZvaWQpIHsK
ICAgICBHTXV0ZXggKm11dGV4OwpAQCAtMTMxLDQxICszNTksNiBAQCBnYm9vbGVhbiBzcGljZV91
c2JfYmFja2VuZF9kZXZpY2VfaXNvY2goU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYpCiAgICAg
cmV0dXJuIGlzb2NfZm91bmQ7CiB9CiAKLXN0YXRpYyBnYm9vbGVhbiBmaWxsX3VzYl9pbmZvKFNw
aWNlVXNiQmFja2VuZERldmljZSAqYmRldikKLXsKLSAgICBVc2JEZXZpY2VJbmZvcm1hdGlvbiAq
aW5mbyA9ICZiZGV2LT5kZXZpY2VfaW5mbzsKLQotICAgIHN0cnVjdCBsaWJ1c2JfZGV2aWNlX2Rl
c2NyaXB0b3IgZGVzYzsKLSAgICBsaWJ1c2JfZGV2aWNlICpsaWJkZXYgPSBiZGV2LT5saWJ1c2Jf
ZGV2aWNlOwotICAgIGxpYnVzYl9nZXRfZGV2aWNlX2Rlc2NyaXB0b3IobGliZGV2LCAmZGVzYyk7
Ci0gICAgaW5mby0+YnVzID0gbGlidXNiX2dldF9idXNfbnVtYmVyKGxpYmRldik7Ci0gICAgaW5m
by0+YWRkcmVzcyA9IGxpYnVzYl9nZXRfZGV2aWNlX2FkZHJlc3MobGliZGV2KTsKLSAgICBpZiAo
aW5mby0+YWRkcmVzcyA9PSAweGZmIHx8IC8qIHJvb3QgaHViIChIQ0QpICovCi0gICAgICAgIGlu
Zm8tPmFkZHJlc3MgPD0gMSB8fCAvKiByb290IGh1YiBvciBiYWQgYWRkcmVzcyAqLwotICAgICAg
ICAoZGVzYy5iRGV2aWNlQ2xhc3MgPT0gTElCVVNCX0NMQVNTX0hVQikgLypodWIqLykgewotICAg
ICAgICByZXR1cm4gRkFMU0U7Ci0gICAgfQotCi0gICAgaW5mby0+dmlkID0gZGVzYy5pZFZlbmRv
cjsKLSAgICBpbmZvLT5waWQgPSBkZXNjLmlkUHJvZHVjdDsKLSAgICBpbmZvLT5jbGFzcyA9IGRl
c2MuYkRldmljZUNsYXNzOwotICAgIGluZm8tPnN1YmNsYXNzID0gZGVzYy5iRGV2aWNlU3ViQ2xh
c3M7Ci0gICAgaW5mby0+cHJvdG9jb2wgPSBkZXNjLmJEZXZpY2VQcm90b2NvbDsKLQotICAgIHJl
dHVybiBUUlVFOwotfQotCi1zdGF0aWMgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICphbGxvY2F0ZV9i
YWNrZW5kX2RldmljZShsaWJ1c2JfZGV2aWNlICpsaWJkZXYpCi17Ci0gICAgU3BpY2VVc2JCYWNr
ZW5kRGV2aWNlICpkZXYgPSBnX25ldzAoU3BpY2VVc2JCYWNrZW5kRGV2aWNlLCAxKTsKLSAgICBk
ZXYtPnJlZl9jb3VudCA9IDE7Ci0gICAgZGV2LT5saWJ1c2JfZGV2aWNlID0gbGliZGV2OwotICAg
IGlmICghZmlsbF91c2JfaW5mbyhkZXYpKSB7Ci0gICAgICAgIGdfY2xlYXJfcG9pbnRlcigmZGV2
LCBnX2ZyZWUpOwotICAgIH0KLSAgICByZXR1cm4gZGV2OwotfQotCiBzdGF0aWMgZ2Jvb2xlYW4g
aXNfY2hhbm5lbF9yZWFkeShTcGljZVVzYnJlZGlyQ2hhbm5lbCAqY2hhbm5lbCkKIHsKICAgICBy
ZXR1cm4gc3BpY2VfY2hhbm5lbF9nZXRfc3RhdGUoU1BJQ0VfQ0hBTk5FTChjaGFubmVsKSkgPT0g
U1BJQ0VfQ0hBTk5FTF9TVEFURV9SRUFEWTsKQEAgLTIzNywzMSArNDMwLDExIEBAIHZvaWQgc3Bp
Y2VfdXNiX2JhY2tlbmRfaW50ZXJydXB0X2V2ZW50X2hhbmRsZXIoU3BpY2VVc2JCYWNrZW5kICpi
ZSkKICAgICB9CiB9CiAKLXN0YXRpYyBpbnQgTElCVVNCX0NBTEwgaG90cGx1Z19jYWxsYmFjayhs
aWJ1c2JfY29udGV4dCAqY3R4LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGxpYnVzYl9kZXZpY2UgKmRldmljZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBsaWJ1c2JfaG90cGx1Z19ldmVudCBldmVudCwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB2b2lkICp1c2VyX2RhdGEpCi17Ci0gICAgU3BpY2VVc2JC
YWNrZW5kICpiZSA9IChTcGljZVVzYkJhY2tlbmQgKil1c2VyX2RhdGE7Ci0gICAgaWYgKGJlLT5o
b3RwbHVnX2NhbGxiYWNrKSB7Ci0gICAgICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2Owot
ICAgICAgICBnYm9vbGVhbiB2YWwgPSBldmVudCA9PSBMSUJVU0JfSE9UUExVR19FVkVOVF9ERVZJ
Q0VfQVJSSVZFRDsKLSAgICAgICAgZGV2ID0gYWxsb2NhdGVfYmFja2VuZF9kZXZpY2UoZGV2aWNl
KTsKLSAgICAgICAgaWYgKGRldikgewotICAgICAgICAgICAgU1BJQ0VfREVCVUcoImNyZWF0ZWQg
ZGV2ICVwLCB1c2JsaWIgZGV2ICVwIiwgZGV2LCBkZXZpY2UpOwotICAgICAgICAgICAgbGlidXNi
X3JlZl9kZXZpY2UoZGV2aWNlKTsKLSAgICAgICAgICAgIGJlLT5ob3RwbHVnX2NhbGxiYWNrKGJl
LT5ob3RwbHVnX3VzZXJfZGF0YSwgZGV2LCB2YWwpOwotICAgICAgICAgICAgc3BpY2VfdXNiX2Jh
Y2tlbmRfZGV2aWNlX3VucmVmKGRldik7Ci0gICAgICAgIH0KLSAgICB9Ci0gICAgcmV0dXJuIDA7
Ci19Ci0KIHZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfZGVyZWdpc3Rlcl9ob3RwbHVnKFNwaWNlVXNi
QmFja2VuZCAqYmUpCiB7CiAgICAgZ19yZXR1cm5faWZfZmFpbChiZSAhPSBOVUxMKTsKICAgICBp
ZiAoYmUtPmhvdHBsdWdfaGFuZGxlKSB7Ci0gICAgICAgIGxpYnVzYl9ob3RwbHVnX2RlcmVnaXN0
ZXJfY2FsbGJhY2soYmUtPmxpYnVzYl9jb250ZXh0LCBiZS0+aG90cGx1Z19oYW5kbGUpOworICAg
ICAgICBkaXNhYmxlX2hvdHBsdWdfc3VwcG9ydChiZSk7CiAgICAgICAgIGJlLT5ob3RwbHVnX2hh
bmRsZSA9IDA7CiAgICAgfQogICAgIGJlLT5ob3RwbHVnX2NhbGxiYWNrID0gTlVMTDsKQEAgLTI3
MiwxNyArNDQ1LDE1IEBAIGdib29sZWFuIHNwaWNlX3VzYl9iYWNrZW5kX3JlZ2lzdGVyX2hvdHBs
dWcoU3BpY2VVc2JCYWNrZW5kICpiZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdXNiX2hvdF9wbHVnX2NhbGxiYWNrIHByb2MpCiB7CiAgICAgaW50IHJjOwor
ICAgIGNvbnN0IGNoYXIgKmRlc2M7CiAgICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwoYmUgIT0gTlVM
TCwgRkFMU0UpOwogCiAgICAgYmUtPmhvdHBsdWdfY2FsbGJhY2sgPSBwcm9jOwogICAgIGJlLT5o
b3RwbHVnX3VzZXJfZGF0YSA9IHVzZXJfZGF0YTsKLSAgICByYyA9IGxpYnVzYl9ob3RwbHVnX3Jl
Z2lzdGVyX2NhbGxiYWNrKGJlLT5saWJ1c2JfY29udGV4dCwKLSAgICAgICAgTElCVVNCX0hPVFBM
VUdfRVZFTlRfREVWSUNFX0FSUklWRUQgfCBMSUJVU0JfSE9UUExVR19FVkVOVF9ERVZJQ0VfTEVG
VCwKLSAgICAgICAgTElCVVNCX0hPVFBMVUdfRU5VTUVSQVRFLCBMSUJVU0JfSE9UUExVR19NQVRD
SF9BTlksCi0gICAgICAgIExJQlVTQl9IT1RQTFVHX01BVENIX0FOWSwgTElCVVNCX0hPVFBMVUdf
TUFUQ0hfQU5ZLAotICAgICAgICBob3RwbHVnX2NhbGxiYWNrLCBiZSwgJmJlLT5ob3RwbHVnX2hh
bmRsZSk7CisKKyAgICByYyA9IGVuYWJsZV9ob3RwbHVnX3N1cHBvcnQoYmUsICZkZXNjKTsKKwog
ICAgIGlmIChyYyAhPSBMSUJVU0JfU1VDQ0VTUykgewotICAgICAgICBjb25zdCBjaGFyICpkZXNj
ID0gbGlidXNiX3N0cmVycm9yKHJjKTsKICAgICAgICAgZ193YXJuaW5nKCJFcnJvciBpbml0aWFs
aXppbmcgVVNCIGhvdHBsdWcgc3VwcG9ydDogJXMgWyVpXSIsIGRlc2MsIHJjKTsKICAgICAgICAg
YmUtPmhvdHBsdWdfY2FsbGJhY2sgPSBOVUxMOwogICAgICAgICByZXR1cm4gRkFMU0U7CkBAIC0z
MDEsNDUgKzQ3Miw2IEBAIHZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfZGVsZXRlKFNwaWNlVXNiQmFj
a2VuZCAqYmUpCiAgICAgU1BJQ0VfREVCVUcoIiVzIDw8IiwgX19GVU5DVElPTl9fKTsKIH0KIAot
U3BpY2VVc2JCYWNrZW5kRGV2aWNlICoqc3BpY2VfdXNiX2JhY2tlbmRfZ2V0X2RldmljZV9saXN0
KFNwaWNlVXNiQmFja2VuZCAqYmUpCi17Ci0gICAgTE9VRF9ERUJVRygiJXMgPj4iLCBfX0ZVTkNU
SU9OX18pOwotICAgIGxpYnVzYl9kZXZpY2UgKipkZXZsaXN0ID0gTlVMTCwgKipkZXY7Ci0gICAg
U3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkLCAqKmxpc3Q7Ci0KLSAgICBpbnQgbiA9IDAsIGluZGV4
OwotCi0gICAgaWYgKGJlICYmIGJlLT5saWJ1c2JfY29udGV4dCkgewotICAgICAgICBsaWJ1c2Jf
Z2V0X2RldmljZV9saXN0KGJlLT5saWJ1c2JfY29udGV4dCwgJmRldmxpc3QpOwotICAgIH0KLQot
ICAgIC8qIGFkZCBhbGwgdGhlIGxpYnVzYiBkZXZpY2UgdGhhdCBub3QgcHJlc2VudCBpbiBvdXIg
bGlzdCAqLwotICAgIGZvciAoZGV2ID0gZGV2bGlzdDsgZGV2ICYmICpkZXY7IGRldisrKSB7Ci0g
ICAgICAgIG4rKzsKLSAgICB9Ci0KLSAgICBsaXN0ID0gZ19uZXcwKFNwaWNlVXNiQmFja2VuZERl
dmljZSosIG4gKyAxKTsKLQotICAgIGluZGV4ID0gMDsKLQotICAgIGZvciAoZGV2ID0gZGV2bGlz
dDsgZGV2ICYmICpkZXY7IGRldisrKSB7Ci0gICAgICAgIGQgPSBhbGxvY2F0ZV9iYWNrZW5kX2Rl
dmljZSgqZGV2KTsKLSAgICAgICAgaWYgKCFkKSB7Ci0gICAgICAgICAgICBsaWJ1c2JfdW5yZWZf
ZGV2aWNlKCpkZXYpOwotICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAgU1BJQ0VfREVCVUco
ImNyZWF0ZWQgZGV2ICVwLCB1c2JsaWIgZGV2ICVwIiwgZCwgKmRldik7Ci0gICAgICAgICAgICBs
aXN0W2luZGV4KytdID0gZDsKLSAgICAgICAgfQotICAgIH0KLQotICAgIGlmIChkZXZsaXN0KSB7
Ci0gICAgICAgIGxpYnVzYl9mcmVlX2RldmljZV9saXN0KGRldmxpc3QsIDApOwotICAgIH0KLQot
ICAgIExPVURfREVCVUcoIiVzIDw8IiwgX19GVU5DVElPTl9fKTsKLSAgICByZXR1cm4gbGlzdDsK
LX0KLQogY29uc3QgVXNiRGV2aWNlSW5mb3JtYXRpb24qIHNwaWNlX3VzYl9iYWNrZW5kX2Rldmlj
ZV9nZXRfaW5mbyhTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldikKIHsKICAgICByZXR1cm4gJmRl
di0+ZGV2aWNlX2luZm87CkBAIC0zNTAsMTggKzQ4Miw2IEBAIGdjb25zdHBvaW50ZXIgc3BpY2Vf
dXNiX2JhY2tlbmRfZGV2aWNlX2dldF9saWJkZXYoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYp
CiAgICAgcmV0dXJuIGRldi0+bGlidXNiX2RldmljZTsKIH0KIAotdm9pZCBzcGljZV91c2JfYmFj
a2VuZF9mcmVlX2RldmljZV9saXN0KFNwaWNlVXNiQmFja2VuZERldmljZSAqKmRldmxpc3QpCi17
Ci0gICAgTE9VRF9ERUJVRygiJXMgPj4iLCBfX0ZVTkNUSU9OX18pOwotICAgIFNwaWNlVXNiQmFj
a2VuZERldmljZSAqKmRldjsKLSAgICBmb3IgKGRldiA9IGRldmxpc3Q7ICpkZXY7IGRldisrKSB7
Ci0gICAgICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqZCA9ICpkZXY7Ci0gICAgICAgIHNwaWNl
X3VzYl9iYWNrZW5kX2RldmljZV91bnJlZihkKTsKLSAgICB9Ci0gICAgZ19mcmVlKGRldmxpc3Qp
OwotICAgIExPVURfREVCVUcoIiVzIDw8IiwgX19GVU5DVElPTl9fKTsKLX0KLQogU3BpY2VVc2JC
YWNrZW5kRGV2aWNlICpzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfcmVmKFNwaWNlVXNiQmFja2Vu
ZERldmljZSAqZGV2KQogewogICAgIExPVURfREVCVUcoIiVzID4+ICVwIiwgX19GVU5DVElPTl9f
LCBkZXYpOwpAQCAtNTI5LDEyICs2NDksMjMgQEAgZ2Jvb2xlYW4gc3BpY2VfdXNiX2JhY2tlbmRf
Y2hhbm5lbF9hdHRhY2goU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldiwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdFcnJvciAqKmVycm9y
KQogeworICAgIGludCByYzsKICAgICBTUElDRV9ERUJVRygiJXMgPj4gY2ggJXAsIGRldiAlcCAo
d2FzIGF0dGFjaGVkICVwKSIsIF9fRlVOQ1RJT05fXywgY2gsIGRldiwgY2gtPmF0dGFjaGVkKTsK
IAogICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKGRldiAhPSBOVUxMLCBGQUxTRSk7CiAKICAgICBs
aWJ1c2JfZGV2aWNlX2hhbmRsZSAqaGFuZGxlID0gTlVMTDsKLSAgICBpbnQgcmMgPSBsaWJ1c2Jf
b3BlbihkZXYtPmxpYnVzYl9kZXZpY2UsICZoYW5kbGUpOworCisgICAgLyoKKyAgICAgICBVbmRl
ciBXaW5kb3dzIHdlIG5lZWQgdG8gYXZvaWQgdXBkYXRpbmcKKyAgICAgICBsaXN0IG9mIGRldmlj
ZXMgd2hlbiB3ZSBhcmUgYWNxdWlyaW5nIHRoZSBkZXZpY2UKKyAgICAqLworICAgIHNldF9yZWRp
cmVjdGluZyhjaC0+YmFja2VuZCwgVFJVRSk7CisKKyAgICByYyA9IGxpYnVzYl9vcGVuKGRldi0+
bGlidXNiX2RldmljZSwgJmhhbmRsZSk7CisKKyAgICBzZXRfcmVkaXJlY3RpbmcoY2gtPmJhY2tl
bmQsIEZBTFNFKTsKKwogICAgIGlmIChyYykgewogICAgICAgICBjb25zdCBjaGFyICpkZXNjID0g
bGlidXNiX3N0cmVycm9yKHJjKTsKICAgICAgICAgZ19zZXRfZXJyb3IoZXJyb3IsIFNQSUNFX0NM
SUVOVF9FUlJPUiwgU1BJQ0VfQ0xJRU5UX0VSUk9SX0ZBSUxFRCwKQEAgLTU4Miw2ICs3MTMsNyBA
QCBTcGljZVVzYkJhY2tlbmRDaGFubmVsICpzcGljZV91c2JfYmFja2VuZF9jaGFubmVsX25ldyhT
cGljZVVzYkJhY2tlbmQgKmJlLAogICAgIFNQSUNFX0RFQlVHKCIlcyA+PiIsIF9fRlVOQ1RJT05f
Xyk7CiAgICAgY2gtPnVzZXJfZGF0YSA9IFNQSUNFX1VTQlJFRElSX0NIQU5ORUwodXNlcl9kYXRh
KTsKICAgICBpZiAoYmUtPmxpYnVzYl9jb250ZXh0KSB7CisgICAgICAgIGNoLT5iYWNrZW5kID0g
YmU7CiAgICAgICAgIGNoLT51c2JyZWRpcmhvc3QgPSB1c2JyZWRpcmhvc3Rfb3Blbl9mdWxsKAog
ICAgICAgICAgICAgYmUtPmxpYnVzYl9jb250ZXh0LAogICAgICAgICAgICAgTlVMTCwKZGlmZiAt
LWdpdCBhL3NyYy91c2ItYmFja2VuZC5oIGIvc3JjL3VzYi1iYWNrZW5kLmgKaW5kZXggY2JiNzNj
Mi4uNmRhMzk4MSAxMDA2NDQKLS0tIGEvc3JjL3VzYi1iYWNrZW5kLmgKKysrIGIvc3JjL3VzYi1i
YWNrZW5kLmgKQEAgLTU2LDE0ICs1Niw2IEBAIGVudW0gewogU3BpY2VVc2JCYWNrZW5kICpzcGlj
ZV91c2JfYmFja2VuZF9uZXcoR0Vycm9yICoqZXJyb3IpOwogdm9pZCBzcGljZV91c2JfYmFja2Vu
ZF9kZWxldGUoU3BpY2VVc2JCYWNrZW5kICpjb250ZXh0KTsKIAotLyoKLXJldHVybnMgbmV3bHkt
YWxsb2NhdGVkIG51bGwtdGVybWluYXRlZCBsaXN0IG9mCi1TcGljZVVzYkJhY2tlbmREZXZpY2Ug
cG9pbnRlcnMuCi1UaGUgY2FsbGVyIG11c3QgY2FsbCBzcGljZV91c2JfYmFja2VuZF9mcmVlX2Rl
dmljZV9saXN0Ci1hZnRlciBpdCBmaW5pc2hlcyBsaXN0IHByb2Nlc3NpbmcKLSovCi1TcGljZVVz
YkJhY2tlbmREZXZpY2UgKipzcGljZV91c2JfYmFja2VuZF9nZXRfZGV2aWNlX2xpc3QoU3BpY2VV
c2JCYWNrZW5kICpiYWNrZW5kKTsKLXZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfZnJlZV9kZXZpY2Vf
bGlzdChTcGljZVVzYkJhY2tlbmREZXZpY2UgKipkZXZsaXN0KTsKIGdib29sZWFuIHNwaWNlX3Vz
Yl9iYWNrZW5kX2hhbmRsZV9ldmVudHMoU3BpY2VVc2JCYWNrZW5kICpiZSk7CiB2b2lkIHNwaWNl
X3VzYl9iYWNrZW5kX2ludGVycnVwdF9ldmVudF9oYW5kbGVyKFNwaWNlVXNiQmFja2VuZCAqYmUp
OwogZ2Jvb2xlYW4gc3BpY2VfdXNiX2JhY2tlbmRfcmVnaXN0ZXJfaG90cGx1ZyhTcGljZVVzYkJh
Y2tlbmQgKmJlLApkaWZmIC0tZ2l0IGEvc3JjL3VzYi1kZXZpY2UtbWFuYWdlci5jIGIvc3JjL3Vz
Yi1kZXZpY2UtbWFuYWdlci5jCmluZGV4IDlhYmEyNzUuLjkzMDBhZDIgMTAwNjQ0Ci0tLSBhL3Ny
Yy91c2ItZGV2aWNlLW1hbmFnZXIuYworKysgYi9zcmMvdXNiLWRldmljZS1tYW5hZ2VyLmMKQEAg
LTI5LDcgKzI5LDYgQEAKICNpZmRlZiBHX09TX1dJTjMyCiAjaW5jbHVkZSA8d2luZG93cy5oPgog
I2luY2x1ZGUgInVzYmRrX2FwaS5oIgotI2luY2x1ZGUgIndpbi11c2ItZGV2LmgiCiAjZW5kaWYK
IAogI2luY2x1ZGUgImNoYW5uZWwtdXNicmVkaXItcHJpdi5oIgpAQCAtMTAxLDEyICsxMDAsMTAg
QEAgc3RydWN0IF9TcGljZVVzYkRldmljZU1hbmFnZXJQcml2YXRlIHsKICAgICBzdHJ1Y3QgdXNi
cmVkaXJmaWx0ZXJfcnVsZSAqcmVkaXJlY3Rfb25fY29ubmVjdF9ydWxlczsKICAgICBpbnQgYXV0
b19jb25uX2ZpbHRlcl9ydWxlc19jb3VudDsKICAgICBpbnQgcmVkaXJlY3Rfb25fY29ubmVjdF9y
dWxlc19jb3VudDsKKyAgICBnYm9vbGVhbiByZWRpcmVjdGluZzsKICNpZmRlZiBHX09TX1dJTjMy
Ci0gICAgR1VkZXZDbGllbnQgKnVkZXY7CiAgICAgdXNiZGtfYXBpX3dyYXBwZXIgKnVzYmRrX2Fw
aTsKICAgICBIQU5ETEUgdXNiZGtfaGlkZXJfaGFuZGxlOwotI2Vsc2UKLSAgICBnYm9vbGVhbiBy
ZWRpcmVjdGluZzsgLyogSGFuZGxlZCBieSBHVWRldkNsaWVudCBpbiB0aGUgZ3VkZXYgY2FzZSAq
LwogI2VuZGlmCiAgICAgR1B0ckFycmF5ICpkZXZpY2VzOwogICAgIEdQdHJBcnJheSAqY2hhbm5l
bHM7CkBAIC0xMzksMTYgKzEzNiw5IEBAIHN0YXRpYyB2b2lkIGNoYW5uZWxfZGVzdHJveShTcGlj
ZVNlc3Npb24gKnNlc3Npb24sIFNwaWNlQ2hhbm5lbCAqY2hhbm5lbCwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBncG9pbnRlciB1c2VyX2RhdGEpOwogc3RhdGljIHZvaWQgY2hhbm5lbF9l
dmVudChTcGljZUNoYW5uZWwgKmNoYW5uZWwsIFNwaWNlQ2hhbm5lbEV2ZW50IGV2ZW50LAogICAg
ICAgICAgICAgICAgICAgICAgICAgICBncG9pbnRlciB1c2VyX2RhdGEpOwotI2lmZGVmIEdfT1Nf
V0lOMzIKLXN0YXRpYyB2b2lkIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl91ZXZlbnRfY2IoR1Vk
ZXZDbGllbnQgICAgICpjbGllbnQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqdWRldmljZSwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2Jvb2xlYW4gICAgICAgICBhZGQs
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdwb2ludGVy
ICAgICAgICAgdXNlcl9kYXRhKTsKLSNlbHNlCiBzdGF0aWMgdm9pZCBzcGljZV91c2JfZGV2aWNl
X21hbmFnZXJfaG90cGx1Z19jYih2b2lkICp1c2VyX2RhdGEsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldiwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdib29sZWFu
IGFkZGVkKTsKLSNlbmRpZgogc3RhdGljIHZvaWQgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2No
ZWNrX3JlZGlyX29uX2Nvbm5lY3QoCiAgICAgU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICpzZWxmLCBT
cGljZUNoYW5uZWwgKmNoYW5uZWwpOwogCkBAIC0xOTAsMTEgKzE4MCw3IEBAIEdfREVGSU5FX0JP
WEVEX1RZUEUoU3BpY2VVc2JEZXZpY2UsIHNwaWNlX3VzYl9kZXZpY2UsCiBzdGF0aWMgdm9pZAog
X3NldF9yZWRpcmVjdGluZyhTcGljZVVzYkRldmljZU1hbmFnZXIgKnNlbGYsIGdib29sZWFuIGlz
X3JlZGlyZWN0aW5nKQogewotI2lmZGVmIEdfT1NfV0lOMzIKLSAgICBnX29iamVjdF9zZXQoc2Vs
Zi0+cHJpdi0+dWRldiwgInJlZGlyZWN0aW5nIiwgaXNfcmVkaXJlY3RpbmcsIE5VTEwpOwotI2Vs
c2UKICAgICBzZWxmLT5wcml2LT5yZWRpcmVjdGluZyA9IGlzX3JlZGlyZWN0aW5nOwotI2VuZGlm
CiB9CiAKICNlbHNlCkBAIC0yMTUsMTAgKzIwMSw2IEBAIGdib29sZWFuIHNwaWNlX3VzYl9kZXZp
Y2VfbWFuYWdlcl9pc19yZWRpcmVjdGluZyhTcGljZVVzYkRldmljZU1hbmFnZXIgKnNlbGYpCiB7
CiAjaWZuZGVmIFVTRV9VU0JSRURJUgogICAgIHJldHVybiBGQUxTRTsKLSNlbGlmIGRlZmluZWQo
R19PU19XSU4zMikKLSAgICBnYm9vbGVhbiByZWRpcmVjdGluZzsKLSAgICBnX29iamVjdF9nZXQo
c2VsZi0+cHJpdi0+dWRldiwgInJlZGlyZWN0aW5nIiwgJnJlZGlyZWN0aW5nLCBOVUxMKTsKLSAg
ICByZXR1cm4gcmVkaXJlY3Rpbmc7CiAjZWxzZQogICAgIHJldHVybiBzZWxmLT5wcml2LT5yZWRp
cmVjdGluZzsKICNlbmRpZgpAQCAtMjY3LDI5ICsyNDksMTggQEAgc3RhdGljIGdib29sZWFuIHNw
aWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9pbml0YWJsZV9pbml0KEdJbml0YWJsZSAgKmluaXRhYmxl
LAogICAgIEdMaXN0ICpsaXN0OwogICAgIEdMaXN0ICppdDsKIAotICAgIC8qIFN0YXJ0IGxpc3Rl
bmluZyBmb3IgdXNiIGRldmljZXMgcGx1ZyAvIHVucGx1ZyAqLwotI2lmZGVmIEdfT1NfV0lOMzIK
LSAgICBwcml2LT51ZGV2ID0gZ191ZGV2X2NsaWVudF9uZXcoKTsKLSAgICBpZiAocHJpdi0+dWRl
diA9PSBOVUxMKSB7Ci0gICAgICAgIGdfd2FybmluZygiRXJyb3IgaW5pdGlhbGl6aW5nIEdVZGV2
Q2xpZW50Iik7Ci0gICAgICAgIHJldHVybiBGQUxTRTsKLSAgICB9Ci0gICAgcHJpdi0+Y29udGV4
dCA9IGdfdWRldl9jbGllbnRfZ2V0X2NvbnRleHQocHJpdi0+dWRldik7Ci0gICAgZ19zaWduYWxf
Y29ubmVjdChHX09CSkVDVChwcml2LT51ZGV2KSwgInVldmVudCIsCi0gICAgICAgICAgICAgICAg
ICAgICBHX0NBTExCQUNLKHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl91ZXZlbnRfY2IpLCBzZWxm
KTsKLSAgICAvKiBEbyBjb2xkcGx1ZyAoZGV0ZWN0aW9uIG9mIGFscmVhZHkgY29ubmVjdGVkIGRl
dmljZXMpICovCi0gICAgZ191ZGV2X2NsaWVudF9yZXBvcnRfZGV2aWNlcyhwcml2LT51ZGV2KTsK
LSNlbHNlCiAgICAgLyogSW5pdGlhbGl6ZSBsaWJ1c2IgKi8KICAgICBwcml2LT5jb250ZXh0ID0g
c3BpY2VfdXNiX2JhY2tlbmRfbmV3KGVycik7CiAgICAgaWYgKCFwcml2LT5jb250ZXh0KSB7CiAg
ICAgICAgIHJldHVybiBGQUxTRTsKICAgICB9CiAKKyAgICAvKiBTdGFydCBsaXN0ZW5pbmcgZm9y
IHVzYiBkZXZpY2VzIHBsdWcgLyB1bnBsdWcgKi8KICAgICBpZiAoIXNwaWNlX3VzYl9iYWNrZW5k
X3JlZ2lzdGVyX2hvdHBsdWcocHJpdi0+Y29udGV4dCwgc2VsZiwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2hvdHBs
dWdfY2IpKSB7CiAgICAgICAgIHJldHVybiBGQUxTRTsKICAgICB9CisjaWZuZGVmIEdfT1NfV0lO
MzIKICAgICBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfc3RhcnRfZXZlbnRfbGlzdGVuaW5nKHNl
bGYsIE5VTEwpOwogI2VuZGlmCiAKQEAgLTMyNCw4ICsyOTUsOSBAQCBzdGF0aWMgdm9pZCBzcGlj
ZV91c2JfZGV2aWNlX21hbmFnZXJfZGlzcG9zZShHT2JqZWN0ICpnb2JqZWN0KQogICAgICAgICBn
X3dhcm5faWZfcmVhY2hlZCgpOwogICAgICAgICBnX2F0b21pY19pbnRfc2V0KCZwcml2LT5ldmVu
dF90aHJlYWRfcnVuLCBGQUxTRSk7CiAgICAgfQotICAgIHNwaWNlX3VzYl9iYWNrZW5kX2RlcmVn
aXN0ZXJfaG90cGx1Zyhwcml2LT5jb250ZXh0KTsKICNlbmRpZgorICAgIHNwaWNlX3VzYl9iYWNr
ZW5kX2RlcmVnaXN0ZXJfaG90cGx1Zyhwcml2LT5jb250ZXh0KTsKKwogICAgIGlmIChwcml2LT5l
dmVudF90aHJlYWQpIHsKICAgICAgICAgZ193YXJuX2lmX2ZhaWwoZ19hdG9taWNfaW50X2dldCgm
cHJpdi0+ZXZlbnRfdGhyZWFkX3J1bikgPT0gRkFMU0UpOwogICAgICAgICBnX2F0b21pY19pbnRf
c2V0KCZwcml2LT5ldmVudF90aHJlYWRfcnVuLCBGQUxTRSk7CkBAIC0zNTAsMTQgKzMyMiwxMCBA
QCBzdGF0aWMgdm9pZCBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfZmluYWxpemUoR09iamVjdCAq
Z29iamVjdCkKICAgICBpZiAocHJpdi0+ZGV2aWNlcykgewogICAgICAgICBnX3B0cl9hcnJheV91
bnJlZihwcml2LT5kZXZpY2VzKTsKICAgICB9Ci0jaWZkZWYgR19PU19XSU4zMgotICAgIGdfY2xl
YXJfb2JqZWN0KCZwcml2LT51ZGV2KTsKLSNlbmRpZgogICAgIGdfcmV0dXJuX2lmX2ZhaWwocHJp
di0+ZXZlbnRfdGhyZWFkID09IE5VTEwpOwotI2lmbmRlZiBHX09TX1dJTjMyCi0gICAgaWYgKHBy
aXYtPmNvbnRleHQpCisgICAgaWYgKHByaXYtPmNvbnRleHQpIHsKICAgICAgICAgc3BpY2VfdXNi
X2JhY2tlbmRfZGVsZXRlKHByaXYtPmNvbnRleHQpOwotI2VuZGlmCisgICAgfQogICAgIGZyZWUo
cHJpdi0+YXV0b19jb25uX2ZpbHRlcl9ydWxlcyk7CiAgICAgZnJlZShwcml2LT5yZWRpcmVjdF9v
bl9jb25uZWN0X3J1bGVzKTsKICNpZmRlZiBHX09TX1dJTjMyCkBAIC04OTEsMjAgKzg1OSw2IEBA
IHN0YXRpYyB2b2lkIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9yZW1vdmVfZGV2KFNwaWNlVXNi
RGV2aWNlTWFuYWdlciAqc2VsZiwKICAgICBzcGljZV91c2JfZGV2aWNlX3VucmVmKGRldmljZSk7
CiB9CiAKLSNpZmRlZiBHX09TX1dJTjMyCi1zdGF0aWMgdm9pZCBzcGljZV91c2JfZGV2aWNlX21h
bmFnZXJfdWV2ZW50X2NiKEdVZGV2Q2xpZW50ICAgICAqY2xpZW50LAotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmJk
ZXYsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdib29s
ZWFuICAgICAgICAgYWRkLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBncG9pbnRlciAgICAgICAgIHVzZXJfZGF0YSkKLXsKLSAgICBTcGljZVVzYkRldmlj
ZU1hbmFnZXIgKnNlbGYgPSBTUElDRV9VU0JfREVWSUNFX01BTkFHRVIodXNlcl9kYXRhKTsKLQot
ICAgIGlmIChhZGQpCi0gICAgICAgIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9hZGRfZGV2KHNl
bGYsIGJkZXYpOwotICAgIGVsc2UKLSAgICAgICAgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX3Jl
bW92ZV9kZXYoc2VsZiwgYmRldik7Ci19Ci0jZWxzZQogc3RydWN0IGhvdHBsdWdfaWRsZV9jYl9h
cmdzIHsKICAgICBTcGljZVVzYkRldmljZU1hbmFnZXIgKnNlbGY7CiAgICAgU3BpY2VVc2JCYWNr
ZW5kRGV2aWNlICpkZXZpY2U7CkBAIC05NDAsNyArODk0LDYgQEAgc3RhdGljIHZvaWQgc3BpY2Vf
dXNiX2RldmljZV9tYW5hZ2VyX2hvdHBsdWdfY2Iodm9pZCAqdXNlcl9kYXRhLAogICAgIGFyZ3Mt
PmFkZGVkID0gYWRkZWQ7CiAgICAgZ19pZGxlX2FkZChzcGljZV91c2JfZGV2aWNlX21hbmFnZXJf
aG90cGx1Z19pZGxlX2NiLCBhcmdzKTsKIH0KLSNlbmRpZiAvLyBVU0VfVVNCUkVESVIKIAogc3Rh
dGljIHZvaWQgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2NoYW5uZWxfY29ubmVjdF9jYigKICAg
ICBHT2JqZWN0ICpnb2JqZWN0LCBHQXN5bmNSZXN1bHQgKmNoYW5uZWxfcmVzLCBncG9pbnRlciB1
c2VyX2RhdGEpCmRpZmYgLS1naXQgYS9zcmMvd2luLXVzYi1kZXYuYyBiL3NyYy93aW4tdXNiLWRl
di5jCmRlbGV0ZWQgZmlsZSBtb2RlIDEwMDY0NAppbmRleCBjMmE1MTE1Li4wMDAwMDAwCi0tLSBh
L3NyYy93aW4tdXNiLWRldi5jCisrKyAvZGV2L251bGwKQEAgLTEsNDM2ICswLDAgQEAKLS8qIC0q
LSBNb2RlOiBDOyBjLWJhc2ljLW9mZnNldDogNDsgaW5kZW50LXRhYnMtbW9kZTogbmlsIC0qLSAq
LwotLyoKLSAgIENvcHlyaWdodCAoQykgMjAxMiBSZWQgSGF0LCBJbmMuCi0KLSAgIFJlZCBIYXQg
QXV0aG9yczoKLSAgIEFybm9uIEdpbGJvYSA8YWdpbGJvYUByZWRoYXQuY29tPgotICAgVXJpIEx1
YmxpbiAgIDx1cmlsQHJlZGhhdC5jb20+Ci0KLSAgIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3
YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IKLSAgIG1vZGlmeSBpdCB1bmRlciB0
aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKLSAgIExpY2Vuc2UgYXMg
cHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlcgotICAgdmVy
c2lvbiAyLjEgb2YgdGhlIExpY2Vuc2UsIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZl
cnNpb24uCi0KLSAgIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0
IGl0IHdpbGwgYmUgdXNlZnVsLAotICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0
IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKLSAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRO
RVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUgR05VCi0gICBMZXNzZXIgR2Vu
ZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgotCi0gICBZb3Ugc2hvdWxkIGhh
dmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCi0gICBM
aWNlbnNlIGFsb25nIHdpdGggdGhpcyBsaWJyYXJ5OyBpZiBub3QsIHNlZSA8aHR0cDovL3d3dy5n
bnUub3JnL2xpY2Vuc2VzLz4uCi0qLwotCi0jaW5jbHVkZSAiY29uZmlnLmgiCi0KLSNpbmNsdWRl
IDx3aW5kb3dzLmg+Ci0jaW5jbHVkZSAid2luLXVzYi1kZXYuaCIKLSNpbmNsdWRlICJzcGljZS1t
YXJzaGFsLmgiCi0jaW5jbHVkZSAic3BpY2UtdXRpbC5oIgotCi1lbnVtIHsKLSAgICBQUk9QXzAs
Ci0gICAgUFJPUF9SRURJUkVDVElORwotfTsKLQotc3RydWN0IF9HVWRldkNsaWVudFByaXZhdGUg
ewotICAgIFNwaWNlVXNiQmFja2VuZCAqY3R4OwotICAgIEdMaXN0ICp1ZGV2X2xpc3Q7Ci0gICAg
SFdORCBod25kOwotICAgIGdib29sZWFuIHJlZGlyZWN0aW5nOwotfTsKLQotI2RlZmluZSBHX1VE
RVZfQ0xJRU5UX1dJTkNMQVNTX05BTUUgIFRFWFQoIkdfVURFVl9DTElFTlQiKQotCi1zdGF0aWMg
dm9pZCBnX3VkZXZfY2xpZW50X2luaXRhYmxlX2lmYWNlX2luaXQoR0luaXRhYmxlSWZhY2UgICpp
ZmFjZSk7Ci0KLUdfREVGSU5FX1RZUEVfV0lUSF9DT0RFKEdVZGV2Q2xpZW50LCBnX3VkZXZfY2xp
ZW50LCBHX1RZUEVfT0JKRUNULAotICAgICAgICAgICAgICAgICAgICAgICAgR19BRERfUFJJVkFU
RShHVWRldkNsaWVudCkKLSAgICAgICAgICAgICAgICAgICAgICAgIEdfSU1QTEVNRU5UX0lOVEVS
RkFDRShHX1RZUEVfSU5JVEFCTEUsIGdfdWRldl9jbGllbnRfaW5pdGFibGVfaWZhY2VfaW5pdCkp
Ci0KLWVudW0KLXsKLSAgICBVRVZFTlRfU0lHTkFMLAotICAgIExBU1RfU0lHTkFMLAotfTsKLQot
c3RhdGljIGd1aW50IHNpZ25hbHNbTEFTVF9TSUdOQUxdID0geyAwLCB9Owotc3RhdGljIEdVZGV2
Q2xpZW50ICpzaW5nbGV0b24gPSBOVUxMOwotCi1zdGF0aWMgTFJFU1VMVCBDQUxMQkFDSyB3bmRf
cHJvYyhIV05EIGh3bmQsIFVJTlQgbWVzc2FnZSwgV1BBUkFNIHdwYXJhbSwgTFBBUkFNIGxwYXJh
bSk7Ci0KLS8vdW5jb21tZW50IHRvIGRlYnVnIGd1ZGV2IGRldmljZSBsaXN0cy4KLS8vI2RlZmlu
ZSBERUJVR19HVURFVl9ERVZJQ0VfTElTVFMKLQotI2lmZGVmIERFQlVHX0dVREVWX0RFVklDRV9M
SVNUUwotc3RhdGljIHZvaWQgZ191ZGV2X2RldmljZV9wcmludF9saXN0KEdMaXN0ICpsLCBjb25z
dCBnY2hhciAqbXNnKTsKLSNlbHNlCi1zdGF0aWMgdm9pZCBnX3VkZXZfZGV2aWNlX3ByaW50X2xp
c3QoR0xpc3QgKmwsIGNvbnN0IGdjaGFyICptc2cpIHt9Ci0jZW5kaWYKLXN0YXRpYyB2b2lkIGdf
dWRldl9kZXZpY2VfcHJpbnQoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYsIGNvbnN0IGdjaGFy
ICptc2cpOwotCi1HUXVhcmsgZ191ZGV2X2NsaWVudF9lcnJvcl9xdWFyayh2b2lkKQotewotICAg
IHJldHVybiBnX3F1YXJrX2Zyb21fc3RhdGljX3N0cmluZygid2luLWd1ZGV2LWNsaWVudC1lcnJv
ci1xdWFyayIpOwotfQotCi1HVWRldkNsaWVudCAqZ191ZGV2X2NsaWVudF9uZXcodm9pZCkKLXsK
LSAgICBpZiAoc2luZ2xldG9uICE9IE5VTEwpCi0gICAgICAgIHJldHVybiBnX29iamVjdF9yZWYo
c2luZ2xldG9uKTsKLQotICAgIHNpbmdsZXRvbiA9IGdfaW5pdGFibGVfbmV3KEdfVURFVl9UWVBF
X0NMSUVOVCwgTlVMTCwgTlVMTCwgTlVMTCk7Ci0gICAgcmV0dXJuIHNpbmdsZXRvbjsKLX0KLQot
U3BpY2VVc2JCYWNrZW5kICpnX3VkZXZfY2xpZW50X2dldF9jb250ZXh0KEdVZGV2Q2xpZW50ICpj
bGllbnQpCi17Ci0gICAgcmV0dXJuIGNsaWVudC0+cHJpdi0+Y3R4OwotfQotCi0vKgotICogZGV2
cyBbaW4sb3V0XSBhbiBlbXB0eSBkZXZzIGxpc3QgaW4sIGZ1bGwgZGV2cyBsaXN0IG91dAotICog
UmV0dXJuczogbnVtYmVyLW9mLWRldmljZXMsIG9yIGEgbmVnYXRpdmUgdmFsdWUgb24gZXJyb3Iu
Ci0gKi8KLXN0YXRpYyBzc2l6ZV90Ci1nX3VkZXZfY2xpZW50X2xpc3RfZGV2aWNlcyhHVWRldkNs
aWVudCAqc2VsZiwgR0xpc3QgKipkZXZzLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgR0Vy
cm9yICoqZXJyLCBjb25zdCBnY2hhciAqbmFtZSkKLXsKLSAgICBTcGljZVVzYkJhY2tlbmREZXZp
Y2UgKipsdXNiX2xpc3QsICoqZGV2OwotICAgIEdVZGV2Q2xpZW50UHJpdmF0ZSAqcHJpdjsKLSAg
ICBzc2l6ZV90IG47Ci0KLSAgICBnX3JldHVybl92YWxfaWZfZmFpbChHX1VERVZfSVNfQ0xJRU5U
KHNlbGYpLCAtMSk7Ci0gICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwoZGV2cyAhPSBOVUxMLCAtMik7
Ci0KLSAgICBwcml2ID0gc2VsZi0+cHJpdjsKLQotICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKHNl
bGYtPnByaXYtPmN0eCAhPSBOVUxMLCAtMyk7Ci0KLSAgICBsdXNiX2xpc3QgPSBzcGljZV91c2Jf
YmFja2VuZF9nZXRfZGV2aWNlX2xpc3QocHJpdi0+Y3R4KTsKLSAgICBpZiAoIWx1c2JfbGlzdCkg
ewotICAgICAgICBnX3NldF9lcnJvcihlcnIsIEdfVURFVl9DTElFTlRfRVJST1IsIEdfVURFVl9D
TElFTlRfTElCVVNCX0ZBSUxFRCwKLSAgICAgICAgICAgICAgICAgICAgIiVzOiBFcnJvciBnZXR0
aW5nIFVTQiBkZXZpY2UgbGlzdCIsIG5hbWUpOwotICAgICAgICByZXR1cm4gLTQ7Ci0gICAgfQot
Ci0gICAgbiA9IDA7Ci0gICAgZm9yIChkZXYgPSBsdXNiX2xpc3Q7ICpkZXY7IGRldisrKSB7Ci0g
ICAgICAgICpkZXZzID0gZ19saXN0X3ByZXBlbmQoKmRldnMsIHNwaWNlX3VzYl9iYWNrZW5kX2Rl
dmljZV9yZWYoKmRldikpOwotICAgICAgICBuKys7Ci0gICAgfQotICAgIHNwaWNlX3VzYl9iYWNr
ZW5kX2ZyZWVfZGV2aWNlX2xpc3QobHVzYl9saXN0KTsKLQotICAgIHJldHVybiBuOwotfQotCi1z
dGF0aWMgdm9pZCB1bnJlZmVyZW5jZV9iYWNrZW5kX2RldmljZShncG9pbnRlciBkYXRhKQotewot
ICAgIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV91bnJlZigoU3BpY2VVc2JCYWNrZW5kRGV2aWNl
ICopZGF0YSk7Ci19Ci0KLXN0YXRpYyB2b2lkIGdfdWRldl9jbGllbnRfZnJlZV9kZXZpY2VfbGlz
dChHTGlzdCAqKmRldnMpCi17Ci0gICAgZ19yZXR1cm5faWZfZmFpbChkZXZzICE9IE5VTEwpOwot
ICAgIGlmICgqZGV2cykgewotICAgICAgICBnX2xpc3RfZnJlZV9mdWxsKCpkZXZzLCB1bnJlZmVy
ZW5jZV9iYWNrZW5kX2RldmljZSk7Ci0gICAgICAgICpkZXZzID0gTlVMTDsKLSAgICB9Ci19Ci0K
LQotc3RhdGljIGdib29sZWFuCi1nX3VkZXZfY2xpZW50X2luaXRhYmxlX2luaXQoR0luaXRhYmxl
ICppbml0YWJsZSwgR0NhbmNlbGxhYmxlICpjYW5jZWxsYWJsZSwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBHRXJyb3IgKiplcnIpCi17Ci0gICAgR1VkZXZDbGllbnQgKnNlbGY7Ci0gICAg
R1VkZXZDbGllbnRQcml2YXRlICpwcml2OwotICAgIFdORENMQVNTIHdjbHM7Ci0KLSAgICBnX3Jl
dHVybl92YWxfaWZfZmFpbChHX1VERVZfSVNfQ0xJRU5UKGluaXRhYmxlKSwgRkFMU0UpOwotICAg
IGdfcmV0dXJuX3ZhbF9pZl9mYWlsKGNhbmNlbGxhYmxlID09IE5VTEwsIEZBTFNFKTsKLQotICAg
IHNlbGYgPSBHX1VERVZfQ0xJRU5UKGluaXRhYmxlKTsKLSAgICBwcml2ID0gc2VsZi0+cHJpdjsK
LQotICAgIHByaXYtPmN0eCA9IHNwaWNlX3VzYl9iYWNrZW5kX25ldyhlcnIpOwotICAgIGlmICgh
cHJpdi0+Y3R4KSB7Ci0gICAgICAgIHJldHVybiBGQUxTRTsKLSAgICB9Ci0KLSNpZmRlZiBHX09T
X1dJTjMyCi0jaWYgTElCVVNCX0FQSV9WRVJTSU9OID49IDB4MDEwMDAxMDYKLSAgICBsaWJ1c2Jf
c2V0X29wdGlvbihwcml2LT5jdHgsIExJQlVTQl9PUFRJT05fVVNFX1VTQkRLKTsKLSNlbmRpZgot
I2VuZGlmCi0KLSAgICAvKiBnZXQgaW5pdGlhbCBkZXZpY2UgbGlzdCAqLwotICAgIGlmIChnX3Vk
ZXZfY2xpZW50X2xpc3RfZGV2aWNlcyhzZWxmLCAmcHJpdi0+dWRldl9saXN0LCBlcnIsIF9fRlVO
Q1RJT05fXykgPCAwKSB7Ci0gICAgICAgIGdvdG8gZ191ZGV2X2NsaWVudF9pbml0X2ZhaWxlZDsK
LSAgICB9Ci0KLSAgICBnX3VkZXZfZGV2aWNlX3ByaW50X2xpc3QocHJpdi0+dWRldl9saXN0LCAi
aW5pdDogZmlyc3QgbGlzdCBpczogIik7Ci0KLSAgICAvKiBjcmVhdGUgYSBoaWRkZW4gd2luZG93
ICovCi0gICAgbWVtc2V0KCZ3Y2xzLCAwLCBzaXplb2Yod2NscykpOwotICAgIHdjbHMubHBmbldu
ZFByb2MgPSB3bmRfcHJvYzsKLSAgICB3Y2xzLmxwc3pDbGFzc05hbWUgPSBHX1VERVZfQ0xJRU5U
X1dJTkNMQVNTX05BTUU7Ci0gICAgaWYgKCFSZWdpc3RlckNsYXNzKCZ3Y2xzKSkgewotICAgICAg
ICBEV09SRCBlID0gR2V0TGFzdEVycm9yKCk7Ci0gICAgICAgIGdfd2FybmluZygiUmVnaXN0ZXJD
bGFzcyBmYWlsZWQgLCAlbGQiLCAobG9uZyllKTsKLSAgICAgICAgZ19zZXRfZXJyb3IoZXJyLCBH
X1VERVZfQ0xJRU5UX0VSUk9SLCBHX1VERVZfQ0xJRU5UX1dJTkFQSV9GQUlMRUQsCi0gICAgICAg
ICAgICAgICAgICAgICJSZWdpc3RlckNsYXNzIGZhaWxlZDogJWxkIiwgKGxvbmcpZSk7Ci0gICAg
ICAgIGdvdG8gZ191ZGV2X2NsaWVudF9pbml0X2ZhaWxlZDsKLSAgICB9Ci0gICAgcHJpdi0+aHdu
ZCA9IENyZWF0ZVdpbmRvdyhHX1VERVZfQ0xJRU5UX1dJTkNMQVNTX05BTUUsCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBOVUxMLCAwLCAwLCAwLCAwLCAwLCBOVUxMLCBOVUxMLCBOVUxM
LCBOVUxMKTsKLSAgICBpZiAoIXByaXYtPmh3bmQpIHsKLSAgICAgICAgRFdPUkQgZSA9IEdldExh
c3RFcnJvcigpOwotICAgICAgICBnX3dhcm5pbmcoIkNyZWF0ZVdpbmRvdyBmYWlsZWQ6ICVsZCIs
IChsb25nKWUpOwotICAgICAgICBnX3NldF9lcnJvcihlcnIsIEdfVURFVl9DTElFTlRfRVJST1Is
IEdfVURFVl9DTElFTlRfTElCVVNCX0ZBSUxFRCwKLSAgICAgICAgICAgICAgICAgICAgIkNyZWF0
ZVdpbmRvdyBmYWlsZWQ6ICVsZCIsIChsb25nKWUpOwotICAgICAgICBnb3RvIGdfdWRldl9jbGll
bnRfaW5pdF9mYWlsZWRfdW5yZWc7Ci0gICAgfQotCi0gICAgcmV0dXJuIFRSVUU7Ci0KLSBnX3Vk
ZXZfY2xpZW50X2luaXRfZmFpbGVkX3VucmVnOgotICAgIFVucmVnaXN0ZXJDbGFzcyhHX1VERVZf
Q0xJRU5UX1dJTkNMQVNTX05BTUUsIE5VTEwpOwotIGdfdWRldl9jbGllbnRfaW5pdF9mYWlsZWQ6
Ci0gICAgcmV0dXJuIEZBTFNFOwotfQotCi1zdGF0aWMgdm9pZCBnX3VkZXZfY2xpZW50X2luaXRh
YmxlX2lmYWNlX2luaXQoR0luaXRhYmxlSWZhY2UgKmlmYWNlKQotewotICAgIGlmYWNlLT5pbml0
ID0gZ191ZGV2X2NsaWVudF9pbml0YWJsZV9pbml0OwotfQotCi1zdGF0aWMgdm9pZCByZXBvcnRf
b25lX2RldmljZShncG9pbnRlciBkYXRhLCBncG9pbnRlciBzZWxmKQotewotICAgIGdfc2lnbmFs
X2VtaXQoc2VsZiwgc2lnbmFsc1tVRVZFTlRfU0lHTkFMXSwgMCwgZGF0YSwgVFJVRSk7Ci19Ci0K
LXZvaWQgZ191ZGV2X2NsaWVudF9yZXBvcnRfZGV2aWNlcyhHVWRldkNsaWVudCAqc2VsZikKLXsK
LSAgICBnX2xpc3RfZm9yZWFjaChzZWxmLT5wcml2LT51ZGV2X2xpc3QsIHJlcG9ydF9vbmVfZGV2
aWNlLCBzZWxmKTsKLX0KLQotc3RhdGljIHZvaWQgZ191ZGV2X2NsaWVudF9pbml0KEdVZGV2Q2xp
ZW50ICpzZWxmKQotewotICAgIHNlbGYtPnByaXYgPSBnX3VkZXZfY2xpZW50X2dldF9pbnN0YW5j
ZV9wcml2YXRlKHNlbGYpOwotfQotCi1zdGF0aWMgdm9pZCBnX3VkZXZfY2xpZW50X2ZpbmFsaXpl
KEdPYmplY3QgKmdvYmplY3QpCi17Ci0gICAgR1VkZXZDbGllbnQgKnNlbGYgPSBHX1VERVZfQ0xJ
RU5UKGdvYmplY3QpOwotICAgIEdVZGV2Q2xpZW50UHJpdmF0ZSAqcHJpdiA9IHNlbGYtPnByaXY7
Ci0KLSAgICBzaW5nbGV0b24gPSBOVUxMOwotICAgIERlc3Ryb3lXaW5kb3cocHJpdi0+aHduZCk7
Ci0gICAgVW5yZWdpc3RlckNsYXNzKEdfVURFVl9DTElFTlRfV0lOQ0xBU1NfTkFNRSwgTlVMTCk7
Ci0gICAgZ191ZGV2X2NsaWVudF9mcmVlX2RldmljZV9saXN0KCZwcml2LT51ZGV2X2xpc3QpOwot
Ci0gICAgLyogZnJlZSBiYWNrZW5kIGNvbnRleHQgKi8KLSAgICBnX3dhcm5faWZfZmFpbChwcml2
LT5jdHggIT0gTlVMTCk7Ci0gICAgc3BpY2VfdXNiX2JhY2tlbmRfZGVsZXRlKHByaXYtPmN0eCk7
Ci0KLSAgICAvKiBDaGFpbiB1cCB0byB0aGUgcGFyZW50IGNsYXNzICovCi0gICAgaWYgKEdfT0JK
RUNUX0NMQVNTKGdfdWRldl9jbGllbnRfcGFyZW50X2NsYXNzKS0+ZmluYWxpemUpCi0gICAgICAg
IEdfT0JKRUNUX0NMQVNTKGdfdWRldl9jbGllbnRfcGFyZW50X2NsYXNzKS0+ZmluYWxpemUoZ29i
amVjdCk7Ci19Ci0KLXN0YXRpYyB2b2lkIGdfdWRldl9jbGllbnRfZ2V0X3Byb3BlcnR5KEdPYmpl
Y3QgICAgICpnb2JqZWN0LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Z3VpbnQgICAgICAgIHByb3BfaWQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBHVmFsdWUgICAgICAqdmFsdWUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBHUGFyYW1TcGVjICAqcHNwZWMpCi17Ci0gICAgR1VkZXZDbGllbnQgKnNlbGYgPSBH
X1VERVZfQ0xJRU5UKGdvYmplY3QpOwotICAgIEdVZGV2Q2xpZW50UHJpdmF0ZSAqcHJpdiA9IHNl
bGYtPnByaXY7Ci0KLSAgICBzd2l0Y2ggKHByb3BfaWQpIHsKLSAgICBjYXNlIFBST1BfUkVESVJF
Q1RJTkc6Ci0gICAgICAgIGdfdmFsdWVfc2V0X2Jvb2xlYW4odmFsdWUsIHByaXYtPnJlZGlyZWN0
aW5nKTsKLSAgICAgICAgYnJlYWs7Ci0gICAgZGVmYXVsdDoKLSAgICAgICAgR19PQkpFQ1RfV0FS
Tl9JTlZBTElEX1BST1BFUlRZX0lEKGdvYmplY3QsIHByb3BfaWQsIHBzcGVjKTsKLSAgICAgICAg
YnJlYWs7Ci0gICAgfQotfQotCi1zdGF0aWMgdm9pZCBoYW5kbGVfZGV2X2NoYW5nZShHVWRldkNs
aWVudCAqc2VsZik7Ci0KLXN0YXRpYyB2b2lkIGdfdWRldl9jbGllbnRfc2V0X3Byb3BlcnR5KEdP
YmplY3QgICAgICAgKmdvYmplY3QsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBndWludCAgICAgICAgICBwcm9wX2lkLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgY29uc3QgR1ZhbHVlICAqdmFsdWUsCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBHUGFyYW1TcGVjICAgICpwc3BlYykKLXsKLSAgICBHVWRldkNsaWVu
dCAqc2VsZiA9IEdfVURFVl9DTElFTlQoZ29iamVjdCk7Ci0gICAgR1VkZXZDbGllbnRQcml2YXRl
ICpwcml2ID0gc2VsZi0+cHJpdjsKLSAgICBnYm9vbGVhbiBvbGRfdmFsOwotCi0gICAgc3dpdGNo
IChwcm9wX2lkKSB7Ci0gICAgY2FzZSBQUk9QX1JFRElSRUNUSU5HOgotICAgICAgICBvbGRfdmFs
ID0gcHJpdi0+cmVkaXJlY3Rpbmc7Ci0gICAgICAgIHByaXYtPnJlZGlyZWN0aW5nID0gZ192YWx1
ZV9nZXRfYm9vbGVhbih2YWx1ZSk7Ci0gICAgICAgIGlmIChvbGRfdmFsICYmICFwcml2LT5yZWRp
cmVjdGluZykgewotICAgICAgICAgICAgLyogVGhpcyBpcyBhIHJlZGlyZWN0aW9uIGNvbXBsZXRp
b24gY2FzZS4KLSAgICAgICAgICAgICAgIEluamVjdCBob3RwbHVnIGV2ZW50IGluIGNhc2Ugd2Ug
bWlzc2VkIGRldmljZSBjaGFuZ2VzCi0gICAgICAgICAgICAgICBkdXJpbmcgcmVkaXJlY3Rpb24g
cHJvY2Vzc2luZy4gKi8KLSAgICAgICAgICAgIGhhbmRsZV9kZXZfY2hhbmdlKHNlbGYpOwotICAg
ICAgICB9Ci0gICAgICAgIGJyZWFrOwotICAgIGRlZmF1bHQ6Ci0gICAgICAgIEdfT0JKRUNUX1dB
Uk5fSU5WQUxJRF9QUk9QRVJUWV9JRChnb2JqZWN0LCBwcm9wX2lkLCBwc3BlYyk7Ci0gICAgICAg
IGJyZWFrOwotICAgIH0KLX0KLQotc3RhdGljIHZvaWQgZ191ZGV2X2NsaWVudF9jbGFzc19pbml0
KEdVZGV2Q2xpZW50Q2xhc3MgKmtsYXNzKQotewotICAgIEdPYmplY3RDbGFzcyAqZ29iamVjdF9j
bGFzcyA9IEdfT0JKRUNUX0NMQVNTKGtsYXNzKTsKLSAgICBHUGFyYW1TcGVjICpwc3BlYzsKLQot
ICAgIGdvYmplY3RfY2xhc3MtPmZpbmFsaXplID0gZ191ZGV2X2NsaWVudF9maW5hbGl6ZTsKLSAg
ICBnb2JqZWN0X2NsYXNzLT5nZXRfcHJvcGVydHkgPSBnX3VkZXZfY2xpZW50X2dldF9wcm9wZXJ0
eTsKLSAgICBnb2JqZWN0X2NsYXNzLT5zZXRfcHJvcGVydHkgPSBnX3VkZXZfY2xpZW50X3NldF9w
cm9wZXJ0eTsKLQotICAgIHNpZ25hbHNbVUVWRU5UX1NJR05BTF0gPQotICAgICAgICBnX3NpZ25h
bF9uZXcoInVldmVudCIsCi0gICAgICAgICAgICAgICAgICAgICBHX09CSkVDVF9DTEFTU19UWVBF
KGtsYXNzKSwKLSAgICAgICAgICAgICAgICAgICAgIEdfU0lHTkFMX1JVTl9GSVJTVCwKLSAgICAg
ICAgICAgICAgICAgICAgIEdfU1RSVUNUX09GRlNFVChHVWRldkNsaWVudENsYXNzLCB1ZXZlbnQp
LAotICAgICAgICAgICAgICAgICAgICAgTlVMTCwgTlVMTCwKLSAgICAgICAgICAgICAgICAgICAg
IGdfY2Nsb3N1cmVfdXNlcl9tYXJzaGFsX1ZPSURfX1BPSU5URVJfQk9PTEVBTiwKLSAgICAgICAg
ICAgICAgICAgICAgIEdfVFlQRV9OT05FLAotICAgICAgICAgICAgICAgICAgICAgMiwKLSAgICAg
ICAgICAgICAgICAgICAgIEdfVFlQRV9QT0lOVEVSLAotICAgICAgICAgICAgICAgICAgICAgR19U
WVBFX0JPT0xFQU4pOwotCi0gICAgLyoqCi0gICAgKiBHVWRldkNsaWVudDo6cmVkaXJlY3Rpbmc6
Ci0gICAgKgotICAgICogVGhpcyBwcm9wZXJ0eSBpbmRpY2F0ZXMgd2hlbiBhIHJlZGlyZWN0aW9u
IG9wZXJhdGlvbgotICAgICogaXMgaW4gcHJvZ3Jlc3Mgb24gYSBkZXZpY2UuIEl0J3Mgc2V0IGJh
Y2sgdG8gRkFMU0UKLSAgICAqIG9uY2UgdGhlIGRldmljZSBpcyBmdWxseSByZWRpcmVjdGVkIHRv
IHRoZSBndWVzdC4KLSAgICAqLwotICAgIHBzcGVjID0gZ19wYXJhbV9zcGVjX2Jvb2xlYW4oInJl
ZGlyZWN0aW5nIiwgIlJlZGlyZWN0aW5nIiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICJVU0IgcmVkaXJlY3Rpb24gb3BlcmF0aW9uIGlzIGluIHByb2dyZXNzIiwKLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIEZBTFNFLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgR19QQVJBTV9SRUFEV1JJVEUgfCBHX1BBUkFNX1NUQVRJQ19TVFJJTkdTKTsKLQot
ICAgIGdfb2JqZWN0X2NsYXNzX2luc3RhbGxfcHJvcGVydHkoZ29iamVjdF9jbGFzcywgUFJPUF9S
RURJUkVDVElORywgcHNwZWMpOwotfQotCi0vKiBjb21wYXJpbmcgYnVzOmFkZHIgYW5kIHZpZDpw
aWQgKi8KLXN0YXRpYyBnaW50IGNvbXBhcmVfdXNiX2RldmljZXMoZ2NvbnN0cG9pbnRlciBhLCBn
Y29uc3Rwb2ludGVyIGIpCi17Ci0gICAgY29uc3QgVXNiRGV2aWNlSW5mb3JtYXRpb24gKmFfaW5m
bywgKmJfaW5mbzsKLSAgICBnYm9vbGVhbiBzYW1lX2J1cywgc2FtZV9hZGRyLCBzYW1lX3ZpZCwg
c2FtZV9waWQ7Ci0gICAgYV9pbmZvID0gc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX2dldF9pbmZv
KChTcGljZVVzYkJhY2tlbmREZXZpY2UgKilhKTsKLSAgICBiX2luZm8gPSBzcGljZV91c2JfYmFj
a2VuZF9kZXZpY2VfZ2V0X2luZm8oKFNwaWNlVXNiQmFja2VuZERldmljZSAqKWIpOwotCi0KLSAg
ICBzYW1lX2J1cyA9IChhX2luZm8tPmJ1cyA9PSBiX2luZm8tPmJ1cyk7Ci0gICAgc2FtZV9hZGRy
ID0gKGFfaW5mby0+YWRkcmVzcyA9PSBiX2luZm8tPmFkZHJlc3MpOwotICAgIHNhbWVfdmlkID0g
KGFfaW5mby0+dmlkID09IGJfaW5mby0+dmlkKTsKLSAgICBzYW1lX3BpZCA9IChhX2luZm8tPnBp
ZCA9PSBiX2luZm8tPnBpZCk7Ci0KLSAgICByZXR1cm4gKHNhbWVfYnVzICYmIHNhbWVfYWRkciAm
JiBzYW1lX3ZpZCAmJiBzYW1lX3BpZCkgPyAwIDogLTE7Ci19Ci0KLXN0YXRpYyB2b2lkIHVwZGF0
ZV9kZXZpY2VfbGlzdChHVWRldkNsaWVudCAqc2VsZiwgR0xpc3QgKm5ld19kZXZpY2VfbGlzdCkK
LXsKLSAgICBHTGlzdCAqZGV2OwotCi0gICAgZm9yIChkZXYgPSBnX2xpc3RfZmlyc3QobmV3X2Rl
dmljZV9saXN0KTsgZGV2ICE9IE5VTEw7IGRldiA9IGdfbGlzdF9uZXh0KGRldikpIHsKLSAgICAg
ICAgR0xpc3QgKmZvdW5kID0gZ19saXN0X2ZpbmRfY3VzdG9tKHNlbGYtPnByaXYtPnVkZXZfbGlz
dCwgZGV2LT5kYXRhLCBjb21wYXJlX3VzYl9kZXZpY2VzKTsKLSAgICAgICAgaWYgKGZvdW5kICE9
IE5VTEwpIHsKLSAgICAgICAgICAgIC8qIGtlZXAgb2xkIGV4aXN0aW5nIGxpYnVzYl9kZXZpY2Ug
aW4gdGhlIG5ldyBsaXN0LCB3aGVuCi0gICAgICAgICAgICAgICB1c2ItZGV2LW1hbmFnZXIgd2ls
bCBtYWludGFpbiBpdHMgb3duIGxpc3Qgb2YgbGlidXNiX2RldmljZSwKLSAgICAgICAgICAgICAg
IHRoZXNlIGxpc3RzIHdpbGwgYmUgY29tcGxldGVseSBjb25zaXN0ZW50ICovCi0gICAgICAgICAg
ICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKnRlbXAgPSBmb3VuZC0+ZGF0YTsKLSAgICAgICAgICAg
IGZvdW5kLT5kYXRhID0gZGV2LT5kYXRhOwotICAgICAgICAgICAgZGV2LT5kYXRhID0gdGVtcDsK
LSAgICAgICAgfQotICAgIH0KLQotICAgIGdfdWRldl9jbGllbnRfZnJlZV9kZXZpY2VfbGlzdCgm
c2VsZi0+cHJpdi0+dWRldl9saXN0KTsKLSAgICBzZWxmLT5wcml2LT51ZGV2X2xpc3QgPSBuZXdf
ZGV2aWNlX2xpc3Q7Ci19Ci0KLXN0YXRpYyB2b2lkIG5vdGlmeV9kZXZfc3RhdGVfY2hhbmdlKEdV
ZGV2Q2xpZW50ICpzZWxmLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR0xp
c3QgKm9sZF9saXN0LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR0xpc3Qg
Km5ld19saXN0LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2Jvb2xlYW4g
YWRkKQotewotICAgIEdMaXN0ICpkZXY7Ci0KLSAgICBmb3IgKGRldiA9IGdfbGlzdF9maXJzdChv
bGRfbGlzdCk7IGRldiAhPSBOVUxMOyBkZXYgPSBnX2xpc3RfbmV4dChkZXYpKSB7Ci0gICAgICAg
IEdMaXN0ICpmb3VuZCA9IGdfbGlzdF9maW5kX2N1c3RvbShuZXdfbGlzdCwgZGV2LT5kYXRhLCBj
b21wYXJlX3VzYl9kZXZpY2VzKTsKLSAgICAgICAgaWYgKGZvdW5kID09IE5VTEwpIHsKLSAgICAg
ICAgICAgIGdfdWRldl9kZXZpY2VfcHJpbnQoZGV2LT5kYXRhLCBhZGQgPyAiYWRkIiA6ICJyZW1v
dmUiKTsKLSAgICAgICAgICAgIGdfc2lnbmFsX2VtaXQoc2VsZiwgc2lnbmFsc1tVRVZFTlRfU0lH
TkFMXSwgMCwgZGV2LT5kYXRhLCBhZGQpOwotICAgICAgICB9Ci0gICAgfQotfQotCi1zdGF0aWMg
dm9pZCBoYW5kbGVfZGV2X2NoYW5nZShHVWRldkNsaWVudCAqc2VsZikKLXsKLSAgICBHVWRldkNs
aWVudFByaXZhdGUgKnByaXYgPSBzZWxmLT5wcml2OwotICAgIEdFcnJvciAqZXJyID0gTlVMTDsK
LSAgICBHTGlzdCAqbm93X2RldnMgPSBOVUxMOwotCi0gICAgaWYgKHByaXYtPnJlZGlyZWN0aW5n
ID09IFRSVUUpIHsKLSAgICAgICAgLyogT24gV2luZG93cywgcXVlcnlpbmcgVVNCIGRldmljZSBs
aXN0IG1heSByZXR1cm4gaW5jb25zaXN0ZW50IHJlc3VsdHMKLSAgICAgICAgICAgaWYgcGVyZm9y
bWVkIGluIHBhcmFsbGVsIHRvIHJlZGlyZWN0aW9uIGZsb3cuCi0gICAgICAgICAgIEEgc2ltdWxh
dGVkIGhvdHBsdWcgZXZlbnQgd2lsbCBiZSBpbmplY3RlZCBhZnRlciByZWRpcmVjdGlvbgotICAg
ICAgICAgICBjb21wbGV0aW9uIGluIG9yZGVyIHRvIHByb2Nlc3MgcmVhbCBkZXZpY2UgbGlzdCBj
aGFuZ2VzIHRoYXQgbWF5Ci0gICAgICAgICAgIGhhZCB0YWtlbiBwbGFjZSBkdXJpbmcgcmVkaXJl
Y3Rpb24gcHJvY2Vzcy4gKi8KLSAgICAgICAgcmV0dXJuOwotICAgIH0KLQotICAgIGlmKGdfdWRl
dl9jbGllbnRfbGlzdF9kZXZpY2VzKHNlbGYsICZub3dfZGV2cywgJmVyciwgX19GVU5DVElPTl9f
KSA8IDApIHsKLSAgICAgICAgZ193YXJuaW5nKCJjb3VsZCBub3QgcmV0cmlldmUgZGV2aWNlIGxp
c3QiKTsKLSAgICAgICAgcmV0dXJuOwotICAgIH0KLQotICAgIGdfdWRldl9kZXZpY2VfcHJpbnRf
bGlzdChub3dfZGV2cywgImhhbmRsZV9kZXZfY2hhbmdlOiBjdXJyZW50IGxpc3Q6Iik7Ci0gICAg
Z191ZGV2X2RldmljZV9wcmludF9saXN0KHByaXYtPnVkZXZfbGlzdCwgImhhbmRsZV9kZXZfY2hh
bmdlOiBwcmV2aW91cyBsaXN0OiIpOwotCi0gICAgLyogVW5yZWdpc3RlciBkZXZpY2VzIHRoYXQg
YXJlIG5vdCBwcmVzZW50IGFueW1vcmUgKi8KLSAgICBub3RpZnlfZGV2X3N0YXRlX2NoYW5nZShz
ZWxmLCBwcml2LT51ZGV2X2xpc3QsIG5vd19kZXZzLCBGQUxTRSk7Ci0KLSAgICAvKiBSZWdpc3Rl
ciBuZXdseSBpbnNlcnRlZCBkZXZpY2VzICovCi0gICAgbm90aWZ5X2Rldl9zdGF0ZV9jaGFuZ2Uo
c2VsZiwgbm93X2RldnMsIHByaXYtPnVkZXZfbGlzdCwgVFJVRSk7Ci0KLSAgICAvKiBrZWVwIG1v
c3QgcmVjZW50IGluZm86IGZyZWUgcHJldmlvdXMgbGlzdCwgYW5kIGtlZXAgY3VycmVudCBsaXN0
ICovCi0gICAgdXBkYXRlX2RldmljZV9saXN0KHNlbGYsIG5vd19kZXZzKTsKLX0KLQotc3RhdGlj
IExSRVNVTFQgQ0FMTEJBQ0sgd25kX3Byb2MoSFdORCBod25kLCBVSU5UIG1lc3NhZ2UsIFdQQVJB
TSB3cGFyYW0sIExQQVJBTSBscGFyYW0pCi17Ci0gICAgLyogT25seSBEQlRfREVWTk9ERVNfQ0hB
TkdFRCByZWNpZXZlZCAqLwotICAgIGlmIChtZXNzYWdlID09IFdNX0RFVklDRUNIQU5HRSkgewot
ICAgICAgICBoYW5kbGVfZGV2X2NoYW5nZShzaW5nbGV0b24pOwotICAgIH0KLSAgICByZXR1cm4g
RGVmV2luZG93UHJvYyhod25kLCBtZXNzYWdlLCB3cGFyYW0sIGxwYXJhbSk7Ci19Ci0KLSNpZmRl
ZiBERUJVR19HVURFVl9ERVZJQ0VfTElTVFMKLXN0YXRpYyB2b2lkIGdfdWRldl9kZXZpY2VfcHJp
bnRfbGlzdChHTGlzdCAqbCwgY29uc3QgZ2NoYXIgKm1zZykKLXsKLSAgICBHTGlzdCAqaXQ7Ci0K
LSAgICBmb3IgKGl0ID0gZ19saXN0X2ZpcnN0KGwpOyBpdCAhPSBOVUxMOyBpdD1nX2xpc3RfbmV4
dChpdCkpIHsKLSAgICAgICAgZ191ZGV2X2RldmljZV9wcmludChpdC0+ZGF0YSwgbXNnKTsKLSAg
ICB9Ci19Ci0jZW5kaWYKLQotc3RhdGljIHZvaWQgZ191ZGV2X2RldmljZV9wcmludChTcGljZVVz
YkJhY2tlbmREZXZpY2UgKmRldiwgY29uc3QgZ2NoYXIgKm1zZykKLXsKLSAgICBjb25zdCBVc2JE
ZXZpY2VJbmZvcm1hdGlvbiAqaW5mbyA9IHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9nZXRfaW5m
byhkZXYpOwotCi0gICAgU1BJQ0VfREVCVUcoIiVzOiAlZC4lZCAweCUwNHg6MHglMDR4IGNsYXNz
ICVkIiwgbXNnLAotICAgICAgICAgICAgICAgIGluZm8tPmJ1cywgaW5mby0+YWRkcmVzcywKLSAg
ICAgICAgICAgICAgICBpbmZvLT52aWQsIGluZm8tPnBpZCwgaW5mby0+Y2xhc3MpOwotfQpkaWZm
IC0tZ2l0IGEvc3JjL3dpbi11c2ItZGV2LmggYi9zcmMvd2luLXVzYi1kZXYuaApkZWxldGVkIGZp
bGUgbW9kZSAxMDA2NDQKaW5kZXggZmRmZTczYS4uMDAwMDAwMAotLS0gYS9zcmMvd2luLXVzYi1k
ZXYuaAorKysgL2Rldi9udWxsCkBAIC0xLDg0ICswLDAgQEAKLS8qIC0qLSBNb2RlOiBDOyBjLWJh
c2ljLW9mZnNldDogNDsgaW5kZW50LXRhYnMtbW9kZTogbmlsIC0qLSAqLwotLyoKLSAgIENvcHly
aWdodCAoQykgMjAxMiBSZWQgSGF0LCBJbmMuCi0KLSAgIFJlZCBIYXQgQXV0aG9yczoKLSAgIEFy
bm9uIEdpbGJvYSA8YWdpbGJvYUByZWRoYXQuY29tPgotICAgVXJpIEx1YmxpbiAgIDx1cmlsQHJl
ZGhhdC5jb20+Ci0KLSAgIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJl
ZGlzdHJpYnV0ZSBpdCBhbmQvb3IKLSAgIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhl
IEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKLSAgIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRo
ZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlcgotICAgdmVyc2lvbiAyLjEgb2YgdGhl
IExpY2Vuc2UsIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCi0KLSAgIFRo
aXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNl
ZnVsLAotICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxp
ZWQgd2FycmFudHkgb2YKLSAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJ
Q1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUgR05VCi0gICBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGlj
ZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgotCi0gICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBj
b3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCi0gICBMaWNlbnNlIGFsb25nIHdp
dGggdGhpcyBsaWJyYXJ5OyBpZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2Vz
Lz4uCi0qLwotI2lmbmRlZiBfX1dJTl9VU0JfREVWX0hfXwotI2RlZmluZSBfX1dJTl9VU0JfREVW
X0hfXwotCi0jaW5jbHVkZSA8Z2lvL2dpby5oPgotI2luY2x1ZGUgInVzYi1iYWNrZW5kLmgiCi0K
LUdfQkVHSU5fREVDTFMKLQotLyogR1VkZXZDbGllbnQgKi8KLQotI2RlZmluZSBHX1VERVZfVFlQ
RV9DTElFTlQgICAgICAgICAoZ191ZGV2X2NsaWVudF9nZXRfdHlwZSgpKQotI2RlZmluZSBHX1VE
RVZfQ0xJRU5UKG8pICAgICAgICAgICAoR19UWVBFX0NIRUNLX0lOU1RBTkNFX0NBU1QoKG8pLCBH
X1VERVZfVFlQRV9DTElFTlQsIEdVZGV2Q2xpZW50KSkKLSNkZWZpbmUgR19VREVWX0NMSUVOVF9D
TEFTUyhrKSAgICAgKEdfVFlQRV9DSEVDS19DTEFTU19DQVNUKChrKSwgR19VREVWX1RZUEVfQ0xJ
RU5ULCBHVWRldkNsaWVudENsYXNzKSkKLSNkZWZpbmUgR19VREVWX0lTX0NMSUVOVChvKSAgICAg
ICAgKEdfVFlQRV9DSEVDS19JTlNUQU5DRV9UWVBFKChvKSwgR19VREVWX1RZUEVfQ0xJRU5UKSkK
LSNkZWZpbmUgR19VREVWX0lTX0NMSUVOVF9DTEFTUyhrKSAgKEdfVFlQRV9DSEVDS19DTEFTU19U
WVBFKChrKSwgR19VREVWX1RZUEVfQ0xJRU5UKSkKLSNkZWZpbmUgR19VREVWX0NMSUVOVF9HRVRf
Q0xBU1MobykgKEdfVFlQRV9JTlNUQU5DRV9HRVRfQ0xBU1MoKG8pLCBHX1VERVZfVFlQRV9DTElF
TlQsIEdVZGV2Q2xpZW50Q2xhc3MpKQotCi10eXBlZGVmIHN0cnVjdCBfR1VkZXZDbGllbnQgR1Vk
ZXZDbGllbnQ7Ci10eXBlZGVmIHN0cnVjdCBfR1VkZXZDbGllbnRDbGFzcyBHVWRldkNsaWVudENs
YXNzOwotdHlwZWRlZiBzdHJ1Y3QgX0dVZGV2Q2xpZW50UHJpdmF0ZSBHVWRldkNsaWVudFByaXZh
dGU7Ci0KLXN0cnVjdCBfR1VkZXZDbGllbnQKLXsKLSAgICBHT2JqZWN0IHBhcmVudDsKLQotICAg
IEdVZGV2Q2xpZW50UHJpdmF0ZSAqcHJpdjsKLX07Ci0KLXN0cnVjdCBfR1VkZXZDbGllbnRDbGFz
cwotewotICAgIEdPYmplY3RDbGFzcyBwYXJlbnRfY2xhc3M7Ci0KLSAgICAvKiBzaWduYWxzICov
Ci0gICAgdm9pZCAoKnVldmVudCkoR1VkZXZDbGllbnQgKmNsaWVudCwgU3BpY2VVc2JCYWNrZW5k
RGV2aWNlICpkZXZpY2UsIGdib29sZWFuIGFkZCk7Ci19OwotCi1HVHlwZSBnX3VkZXZfY2xpZW50
X2dldF90eXBlKHZvaWQpIEdfR05VQ19DT05TVDsKLUdVZGV2Q2xpZW50ICpnX3VkZXZfY2xpZW50
X25ldyh2b2lkKTsKLVNwaWNlVXNiQmFja2VuZCAqZ191ZGV2X2NsaWVudF9nZXRfY29udGV4dChH
VWRldkNsaWVudCAqY2xpZW50KTsKLXZvaWQgZ191ZGV2X2NsaWVudF9yZXBvcnRfZGV2aWNlcyhH
VWRldkNsaWVudCAqY2xpZW50KTsKLQotR1F1YXJrIGdfdWRldl9jbGllbnRfZXJyb3JfcXVhcmso
dm9pZCk7Ci0jZGVmaW5lIEdfVURFVl9DTElFTlRfRVJST1IgZ191ZGV2X2NsaWVudF9lcnJvcl9x
dWFyaygpCi0KLS8qKgotICogR1VkZXZDbGllbnRFcnJvcjoKLSAqIEBHX1VERVZfQ0xJRU5UX0VS
Uk9SX0ZBSUxFRDogZ2VuZXJpYyBlcnJvciBjb2RlCi0gKiBAR19VREVWX0NMSUVOVF9MSUJVU0Jf
RkFJTEVEOiBhIGxpYnVzYiBjYWxsIGZhaWxlZAotICogQEdfVURFVl9DTElFTlRfV0lOQVBJX0ZB
SUxFRDogYSB3aW5hcGkgY2FsbCBmYWlsZWQKLSAqCi0gKiBFcnJvciBjb2RlcyByZXR1cm5lZCBi
eSBzcGljZS1jbGllbnQgQVBJLgotICovCi10eXBlZGVmIGVudW0KLXsKLSAgICBHX1VERVZfQ0xJ
RU5UX0VSUk9SX0ZBSUxFRCA9IDEsCi0gICAgR19VREVWX0NMSUVOVF9MSUJVU0JfRkFJTEVELAot
ICAgIEdfVURFVl9DTElFTlRfV0lOQVBJX0ZBSUxFRAotfSBHVWRldkNsaWVudEVycm9yOwotCi0K
LUdfRU5EX0RFQ0xTCi0KLSNlbmRpZiAvKiBfX1dJTl9VU0JfREVWX0hfXyAqLwotLSAKMi4xNy4x
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpTcGljZS1k
ZXZlbCBtYWlsaW5nIGxpc3QKU3BpY2UtZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vc3BpY2UtZGV2ZWw=
