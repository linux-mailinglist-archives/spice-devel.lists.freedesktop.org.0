Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9263C712D8
	for <lists+spice-devel@lfdr.de>; Tue, 23 Jul 2019 09:27:49 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C24766E151;
	Tue, 23 Jul 2019 07:27:47 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail-wm1-x334.google.com (mail-wm1-x334.google.com
 [IPv6:2a00:1450:4864:20::334])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 609D26E151
 for <spice-devel@lists.freedesktop.org>; Tue, 23 Jul 2019 07:27:46 +0000 (UTC)
Received: by mail-wm1-x334.google.com with SMTP id l2so37481041wmg.0
 for <spice-devel@lists.freedesktop.org>; Tue, 23 Jul 2019 00:27:46 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=is1oioTY7Bm2lNjyhXloNDIyMKqEiibmSlkU2jWYWpU=;
 b=ms2Q33ao+fs6kJEPyI3n/iqK6t+Og1mVwEhNJJG/7BTTiBmnrr5LIGWJ6Swy617x7d
 xtIGS6m54MRU3UVHhkSGvS2Y29nIeURbl6OHnUZscQnt6Bi+QBG2bk66yZNZ/c+9q8bG
 WsiVLb9gFum2BgaKoskJX5KMLkT0A0pG17uB8Is7yt+e1OAzrmaDkd+tlr+fYQK9Kx1+
 4fdw3zWn7GtkW2jKWkQ285eTFbgsWNg5VpGZVKBRn6sxTzQz8T1dYTvKrXk9FnyKzQkv
 Sjk8IPlsMkQyCEFE9qggdOX7y3PiBWtrpD7n7abjXEAszUU3c299w5LKjkBwzjq22C7F
 NWLg==
X-Gm-Message-State: APjAAAUYxyOQNvqrglcMwHC1VPtP3Cxt6XPCfGOHJn/+v7cLMJbSfiWm
 eXA9Vd4nfKD0npd/ypFW6HpfWSj9
X-Google-Smtp-Source: APXvYqyABzN9qBxe335RbLddviUrh66jWJ9F19eVlgsbLkJgtic4sSV/xtlST3rrnuGuN89TZ+JXIg==
X-Received: by 2002:a1c:1d4f:: with SMTP id d76mr70763953wmd.127.1563866863563; 
 Tue, 23 Jul 2019 00:27:43 -0700 (PDT)
Received: from f2.redhat.com (bzq-79-182-115-245.red.bezeqint.net.
 [79.182.115.245])
 by smtp.gmail.com with ESMTPSA id y7sm31495613wmm.19.2019.07.23.00.27.42
 (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
 Tue, 23 Jul 2019 00:27:43 -0700 (PDT)
From: Yuri Benditovich <yuri.benditovich@daynix.com>
To: spice-devel@lists.freedesktop.org
Date: Tue, 23 Jul 2019 10:27:05 +0300
Message-Id: <20190723072708.2575-7-yuri.benditovich@daynix.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190723072708.2575-1-yuri.benditovich@daynix.com>
References: <20190723072708.2575-1-yuri.benditovich@daynix.com>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=daynix-com.20150623.gappssmtp.com; s=20150623;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=is1oioTY7Bm2lNjyhXloNDIyMKqEiibmSlkU2jWYWpU=;
 b=aK+KphHAJu1MqiTJrsK/rXfeEuAxG6J7OkoP0NUXU1ybtZoGda9wsMWQiqW7/j20LR
 uPxca5QhH1n1KtirutTqPoNk43Xp6XNDZkuySxJe46V5UsMT3+MDwws0/pJthQwWWI3i
 mpi9fKvw1OqvRm8gEH/WlFhXQFlvxZfQyd6/qoQAzTy9Dfa9nm5nESVWnaQbtrIyCtwq
 oj2oQ5o7eVmR27zZUyN3Ar0eYeTuDYlAcI5B5N1Wq3tH+HfwW4I9EhlkER42Ws3Ky7im
 5BmK+QVBBKbnNd0hnd6mm0VYytjNjCBrgR0Kzt6jwZ4KAj+hPI48hTgtQO7Vo1uhdADx
 g4Iw==
Subject: [Spice-devel] [spice-gtk v2 6/9] usb-redir: unify device
 hotplug/unplug for Windows and Linux
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: yan@daynix.com
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

UmVtb3ZlIFdpbmRvd3Mtc3BlY2lmaWMgcGFydCBvZiBob3RwbHVnIGRldGVjdGlvbiBmcm9tCnVz
Yi1kZXZpY2UtbWFuYWdlciBhbmQgd2luLXVzYi1kZXYgYW5kIHBsYWNlIGl0IGludG8KVVNCIGJh
Y2tlbmQgbW9kdWxlLiBDb25uZWN0IHRoZSBob3RwbHVnL3VucGx1ZyBkZXRlY3Rpb24KaW4gV2lu
ZG93cyB0byB0aGUgc2FtZSBjYWxsYmFja3MgYWxyZWFkeSB1c2VkIGluIExpbnV4LgpUaGlzIHJl
bW92ZXMgc2lnbmlmaWNhbnQgcGFydCBvZiBXaW5kb3dzLXNwZWNpZmljIGNvZGUKYW5kIHNpbXBp
ZmllcyB0aGluZ3MuCk5vdGUgcmVnYXJkaW5nICdyZWRpcmVjdGluZycgcHJvcGVydHkgb2YgdXNi
LWRldmljZS1tYW5hZ2VyOgotIFByZXZpb3VzbHkgdXNiLWRldmljZS1tYW5hZ2VyIHVuZGVyIFdp
bmRvd3MgbWFpbnRhaW5lZAogICdyZWRpcmVjdGlvbicgcHJvcGVydHkgaW4gd2luLXVzYi1kZXYK
LSBOb3cgaXQgbWFpbnRhaW5zIGl0cyBvd24gcHJvcGVydHkgaW4gYm90aCBXaW5kb3dzIGFuZAog
IExpbnV4IChmb3IgR1VJIGFuZCBzaW5nbGUgcmVkaXJlY3QgYXQgYSB0aW1lKQotIFRoZSBVU0Ig
YmFja2VuZCBtYWludGFpbnMgaXRzIG93biAncmVkaXJlY3RpbmcnIGZpZWxkCiAgaW4gV2luZG93
cyB0byBwcmV2ZW50IHVwZGF0ZSBvZiBkZXZpY2UgbGlzdCB3aGVuCiAgbGlidXNiIG9wZW5zIHRo
ZSBkZXZpY2UgKGRldmljZSByZWRpcmVjdGlvbiBjYXVzZXMKICB0ZW1wb3JhcnkgcmVtb3ZhbCBv
ZiB0YXJnZXQgZGV2aWNlKQoKU2lnbmVkLW9mZi1ieTogWXVyaSBCZW5kaXRvdmljaCA8eXVyaS5i
ZW5kaXRvdmljaEBkYXluaXguY29tPgotLS0KIG1lc29uLmJ1aWxkICAgICAgICAgICAgICB8ICAg
MiArLQogc3JjL21lc29uLmJ1aWxkICAgICAgICAgIHwgICA0ICstCiBzcmMvdXNiLWJhY2tlbmQu
YyAgICAgICAgfCAyNDYgKysrKysrKysrKysrKysrKy0tLS0tLQogc3JjL3VzYi1iYWNrZW5kLmgg
ICAgICAgIHwgICA4IC0KIHNyYy91c2ItZGV2aWNlLW1hbmFnZXIuYyB8ICA2MSArLS0tLS0KIHNy
Yy93aW4tdXNiLWRldi5jICAgICAgICB8IDQzNiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0KIHNyYy93aW4tdXNiLWRldi5oICAgICAgICB8ICA4NCAtLS0tLS0tLQogNyBm
aWxlcyBjaGFuZ2VkLCAxOTYgaW5zZXJ0aW9ucygrKSwgNjQ1IGRlbGV0aW9ucygtKQogZGVsZXRl
IG1vZGUgMTAwNjQ0IHNyYy93aW4tdXNiLWRldi5jCiBkZWxldGUgbW9kZSAxMDA2NDQgc3JjL3dp
bi11c2ItZGV2LmgKCmRpZmYgLS1naXQgYS9tZXNvbi5idWlsZCBiL21lc29uLmJ1aWxkCmluZGV4
IDU0MTYwZjkuLjFmNmVhNmQgMTAwNjQ0Ci0tLSBhL21lc29uLmJ1aWxkCisrKyBiL21lc29uLmJ1
aWxkCkBAIC0xMTcsNyArMTE3LDcgQEAgZW5kZm9yZWFjaAogCiBkZXBzID0gW10KIGlmIGhvc3Rf
bWFjaGluZS5zeXN0ZW0oKSA9PSAnd2luZG93cycKLSAgZGVwcyArPSBbJ2xpYndzMl8zMicsICds
aWJnZGkzMiddCisgIGRlcHMgKz0gWydsaWJ3czJfMzInLCAnbGliZ2RpMzInLCAnbGliY29tY3Rs
MzInXQogZW5kaWYKIAogZm9yZWFjaCBkZXAgOiBkZXBzCmRpZmYgLS1naXQgYS9zcmMvbWVzb24u
YnVpbGQgYi9zcmMvbWVzb24uYnVpbGQKaW5kZXggYTUxZDBhOS4uYWRjZmFlYyAxMDA2NDQKLS0t
IGEvc3JjL21lc29uLmJ1aWxkCisrKyBiL3NyYy9tZXNvbi5idWlsZApAQCAtMTU4LDkgKzE1OCw3
IEBAIGVuZGlmCiAKIGlmIHNwaWNlX2d0a19oYXNfdXNicmVkaXIgYW5kIGhvc3RfbWFjaGluZS5z
eXN0ZW0oKSA9PSAnd2luZG93cycKICAgc3BpY2VfY2xpZW50X2dsaWJfc291cmNlcyArPSBbJ3Vz
YmRrX2FwaS5jJywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VzYmRrX2FwaS5o
JywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3dpbi11c2ItZGV2LmMnLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnd2luLXVzYi1kZXYuaCddCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICd1c2Jka19hcGkuaCddCiBlbmRpZgogCiAjCmRpZmYgLS1n
aXQgYS9zcmMvdXNiLWJhY2tlbmQuYyBiL3NyYy91c2ItYmFja2VuZC5jCmluZGV4IGU4Mzc1Nzku
LjE1ODFmOTAgMTAwNjQ0Ci0tLSBhL3NyYy91c2ItYmFja2VuZC5jCisrKyBiL3NyYy91c2ItYmFj
a2VuZC5jCkBAIC0zMiw2ICszMiw5IEBACiAjaW5jbHVkZSA8bGlidXNiLmg+CiAjaW5jbHVkZSA8
c3RyaW5nLmg+CiAjaW5jbHVkZSA8ZmNudGwuaD4KKyNpZmRlZiBHX09TX1dJTjMyCisjaW5jbHVk
ZSA8Y29tbWN0cmwuaD4KKyNlbmRpZgogI2luY2x1ZGUgInVzYnJlZGlyaG9zdC5oIgogI2luY2x1
ZGUgInVzYnJlZGlycGFyc2VyLmgiCiAjaW5jbHVkZSAic3BpY2UtdXRpbC5oIgpAQCAtNTUsNiAr
NTgsMTEgQEAgc3RydWN0IF9TcGljZVVzYkJhY2tlbmQKICAgICB1c2JfaG90X3BsdWdfY2FsbGJh
Y2sgaG90cGx1Z19jYWxsYmFjazsKICAgICB2b2lkICpob3RwbHVnX3VzZXJfZGF0YTsKICAgICBs
aWJ1c2JfaG90cGx1Z19jYWxsYmFja19oYW5kbGUgaG90cGx1Z19oYW5kbGU7CisjaWZkZWYgR19P
U19XSU4zMgorICAgIEhBTkRMRSBoV25kOworICAgIGxpYnVzYl9kZXZpY2UgKipsaWJ1c2JfZGV2
aWNlX2xpc3Q7CisgICAgZ2ludCByZWRpcmVjdGluZzsKKyNlbmRpZgogfTsKIAogc3RydWN0IF9T
cGljZVVzYkJhY2tlbmRDaGFubmVsCkBAIC02Niw2ICs3NCw3IEBAIHN0cnVjdCBfU3BpY2VVc2JC
YWNrZW5kQ2hhbm5lbAogICAgIGludCBydWxlc19jb3VudDsKICAgICBTcGljZVVzYkJhY2tlbmRE
ZXZpY2UgKmF0dGFjaGVkOwogICAgIFNwaWNlVXNicmVkaXJDaGFubmVsICAqdXNlcl9kYXRhOwor
ICAgIFNwaWNlVXNiQmFja2VuZCAqYmFja2VuZDsKICAgICBHRXJyb3IgKiplcnJvcjsKIH07CiAK
QEAgLTEyOCw2ICsxMzcsMTY2IEBAIHN0YXRpYyBpbnQgTElCVVNCX0NBTEwgaG90cGx1Z19jYWxs
YmFjayhsaWJ1c2JfY29udGV4dCAqY3R4LAogICAgIHJldHVybiAwOwogfQogCisjaWZkZWYgR19P
U19XSU4zMgorLyogV2luZG93cy1zcGVjaWZpYzogZ2V0IG5vdGlmaWNhdGlvbiBvbiBkZXZpY2Ug
Y2hhbmdlICovCisKK3N0YXRpYyBnYm9vbGVhbiBpc19zYW1lX2xpYnVzYl9kZXYobGlidXNiX2Rl
dmljZSAqbGliZGV2MSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlidXNi
X2RldmljZSAqbGliZGV2MikKK3sKKyAgICBVc2JEZXZpY2VJbmZvcm1hdGlvbiBpbmZvMSwgaW5m
bzI7CisgICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwobGliZGV2MSAhPSBOVUxMICYmIGxpYmRldjIg
IT0gTlVMTCwgRkFMU0UpOworCisgICAgZ2V0X3VzYl9kZXZpY2VfaW5mb19mcm9tX2xpYnVzYl9k
ZXZpY2UoJmluZm8xLCBsaWJkZXYxKTsKKyAgICBnZXRfdXNiX2RldmljZV9pbmZvX2Zyb21fbGli
dXNiX2RldmljZSgmaW5mbzIsIGxpYmRldjIpOworCisgICAgcmV0dXJuIGluZm8xLmJ1cyA9PSBp
bmZvMi5idXMgJiYKKyAgICAgICAgICAgaW5mbzEuYWRkcmVzcyA9PSBpbmZvMi5hZGRyZXNzICYm
CisgICAgICAgICAgIGluZm8xLnZpZCA9PSBpbmZvMi52aWQgJiYKKyAgICAgICAgICAgaW5mbzEu
cGlkID09IGluZm8yLnBpZDsKK30KKworc3RhdGljIGludCBjb21wYXJlX2Rldl9saXN0X2ZpcmVf
Y2FsbGJhY2soU3BpY2VVc2JCYWNrZW5kICpiZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGxpYnVzYl9kZXZpY2UgKiBjb25zdCAqbGlzdDEsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ1c2JfZGV2aWNlICogY29uc3QgKmxp
c3QyLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2Jvb2xlYW4g
YWRkKQoreworICAgIGludCByZXMgPSAwOworICAgIGxpYnVzYl9ob3RwbHVnX2V2ZW50IGV2ZW50
ID0gYWRkID8KKyAgICAgICAgTElCVVNCX0hPVFBMVUdfRVZFTlRfREVWSUNFX0FSUklWRUQgOiBM
SUJVU0JfSE9UUExVR19FVkVOVF9ERVZJQ0VfTEVGVDsKKyAgICB3aGlsZSAoKmxpc3QxKSB7Cisg
ICAgICAgIGdib29sZWFuIGZvdW5kID0gMDsKKyAgICAgICAgdWludDMyX3QgbiA9IDA7CisgICAg
ICAgIHdoaWxlICghZm91bmQgJiYgbGlzdDJbbl0pIHsKKyAgICAgICAgICAgIGZvdW5kID0gaXNf
c2FtZV9saWJ1c2JfZGV2KCpsaXN0MSwgbGlzdDJbbl0pOworICAgICAgICAgICAgbisrOworICAg
ICAgICB9CisgICAgICAgIGlmICghZm91bmQpIHsKKyAgICAgICAgICAgIFVzYkRldmljZUluZm9y
bWF0aW9uIGluZm87CisgICAgICAgICAgICBnZXRfdXNiX2RldmljZV9pbmZvX2Zyb21fbGlidXNi
X2RldmljZSgmaW5mbywgKmxpc3QxKTsKKyAgICAgICAgICAgIFNQSUNFX0RFQlVHKCIlcyAlMDRY
OiUwNFggYXQgJWQ6JWQiLCBhZGQgPyAiYWRkaW5nIiA6ICJyZW1vdmluZyIsCisgICAgICAgICAg
ICAgICAgICAgICAgICBpbmZvLnZpZCwgaW5mby5waWQsIGluZm8uYnVzLCBpbmZvLmFkZHJlc3Mp
OworICAgICAgICAgICAgaG90cGx1Z19jYWxsYmFjayhOVUxMLCAqbGlzdDEsIGV2ZW50LCBiZSk7
CisgICAgICAgICAgICByZXMrKzsKKyAgICAgICAgfQorICAgICAgICBsaXN0MSsrOworICAgIH0K
KyAgICByZXR1cm4gcmVzOworfQorCitzdGF0aWMgTFJFU1VMVCBzdWJjbGFzc19wcm9jKEhXTkQg
aFduZCwgVUlOVCB1TXNnLCBXUEFSQU0gd1BhcmFtLCBMUEFSQU0gbFBhcmFtLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIFVJTlRfUFRSIHVJZFN1YmNsYXNzLCBEV09SRF9QVFIgZHdSZWZE
YXRhKQoreworICAgIFNwaWNlVXNiQmFja2VuZCAqYmUgPSAoU3BpY2VVc2JCYWNrZW5kICopZHdS
ZWZEYXRhOworICAgIGlmICh1TXNnID09IFdNX0RFVklDRUNIQU5HRSAmJiAhYmUtPnJlZGlyZWN0
aW5nKSB7CisgICAgICAgIGxpYnVzYl9kZXZpY2UgKipuZXdfbGlzdCA9IE5VTEw7CisgICAgICAg
IGxpYnVzYl9nZXRfZGV2aWNlX2xpc3QoYmUtPmxpYnVzYl9jb250ZXh0LCAmbmV3X2xpc3QpOwor
ICAgICAgICBpZiAobmV3X2xpc3QpIHsKKyAgICAgICAgICAgIGludCByZXMgPSBjb21wYXJlX2Rl
dl9saXN0X2ZpcmVfY2FsbGJhY2soYmUsIGJlLT5saWJ1c2JfZGV2aWNlX2xpc3QsIG5ld19saXN0
LCBGQUxTRSk7CisgICAgICAgICAgICByZXMgKz0gY29tcGFyZV9kZXZfbGlzdF9maXJlX2NhbGxi
YWNrKGJlLCBuZXdfbGlzdCwgYmUtPmxpYnVzYl9kZXZpY2VfbGlzdCwgVFJVRSk7CisgICAgICAg
ICAgICBpZiAocmVzKSB7CisgICAgICAgICAgICAgICAgLyogdGhlcmUgd2VyZSBjaGFuZ2VzIGlu
IGRldmljZSB0cmVlICovCisgICAgICAgICAgICAgICAgbGlidXNiX2ZyZWVfZGV2aWNlX2xpc3Qo
YmUtPmxpYnVzYl9kZXZpY2VfbGlzdCwgVFJVRSk7CisgICAgICAgICAgICAgICAgYmUtPmxpYnVz
Yl9kZXZpY2VfbGlzdCA9IG5ld19saXN0OworICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAg
ICAgICAgICBsaWJ1c2JfZnJlZV9kZXZpY2VfbGlzdChuZXdfbGlzdCwgVFJVRSk7CisgICAgICAg
ICAgICB9CisgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICBnX3dhcm5faWZfcmVhY2hlZCgp
OworICAgICAgICB9CisgICAgfQorICAgIHJldHVybiBEZWZTdWJjbGFzc1Byb2MoaFduZCwgdU1z
Zywgd1BhcmFtLCBsUGFyYW0pOworfQorCitzdGF0aWMgdm9pZCBkaXNhYmxlX2hvdHBsdWdfc3Vw
cG9ydChTcGljZVVzYkJhY2tlbmQgKmJlKQoreworICAgIGlmIChiZS0+aFduZCkgeworICAgICAg
ICBEZXN0cm95V2luZG93KGJlLT5oV25kKTsKKyAgICAgICAgYmUtPmhXbmQgPSBOVUxMOworICAg
IH0KKyAgICBpZiAoYmUtPmxpYnVzYl9kZXZpY2VfbGlzdCkgeworICAgICAgICBsaWJ1c2JfZnJl
ZV9kZXZpY2VfbGlzdChiZS0+bGlidXNiX2RldmljZV9saXN0LCBUUlVFKTsKKyAgICAgICAgYmUt
PmxpYnVzYl9kZXZpY2VfbGlzdCA9IE5VTEw7CisgICAgfQorfQorCitzdGF0aWMgaW50IGVuYWJs
ZV9ob3RwbHVnX3N1cHBvcnQoU3BpY2VVc2JCYWNrZW5kICpiZSwgY29uc3QgY2hhciAqKmVycm9y
X29uX2VuYWJsZSkKK3sKKyAgICBsb25nIHdpbl9lcnI7CisgICAgbGlidXNiX2RldmljZSAqKmxp
YmRldl9saXN0ID0gTlVMTDsKKyAgICBsaWJ1c2JfZGV2aWNlICplbXB0eV9saXN0ID0gTlVMTDsK
KworICAgIGxpYnVzYl9nZXRfZGV2aWNlX2xpc3QoYmUtPmxpYnVzYl9jb250ZXh0LCAmbGliZGV2
X2xpc3QpOworICAgIGlmICghbGliZGV2X2xpc3QpIHsKKyAgICAgICAgKmVycm9yX29uX2VuYWJs
ZSA9ICJHZXR0aW5nIGRldmljZSBsaXN0IjsKKyAgICAgICAgZ290byBlcnJvcjsKKyAgICB9Cisg
ICAgLyogdXNpbmcgc3RhbmRhcmQgY2xhc3MgZm9yIHdpbmRvdyB0byByZWNlaXZlIG1lc3NhZ2Vz
ICovCisgICAgYmUtPmhXbmQgPSBDcmVhdGVXaW5kb3coIlN0YXRpYyIsIE5VTEwsIDAsIDAsIDAs
IDAsIDAsIE5VTEwsIE5VTEwsIE5VTEwsIE5VTEwpOworICAgIGlmICghYmUtPmhXbmQpIHsKKyAg
ICAgICAgKmVycm9yX29uX2VuYWJsZSA9ICJDcmVhdGVXaW5kb3ciOworICAgICAgICBnb3RvIGVy
cm9yOworICAgIH0KKyAgICBpZiAoIVNldFdpbmRvd1N1YmNsYXNzKGJlLT5oV25kLCBzdWJjbGFz
c19wcm9jLCAwLCAoRFdPUkRfUFRSKWJlKSkgeworICAgICAgICAqZXJyb3Jfb25fZW5hYmxlID0g
IlNldFdpbmRvd1N1YmNsYXNzIjsKKyAgICAgICAgZ290byBlcnJvcjsKKyAgICB9CisgICAgYmUt
PmhvdHBsdWdfaGFuZGxlID0gMTsKKyAgICBiZS0+bGlidXNiX2RldmljZV9saXN0ID0gbGliZGV2
X2xpc3Q7CisKKyAgICBjb21wYXJlX2Rldl9saXN0X2ZpcmVfY2FsbGJhY2soYmUsIGJlLT5saWJ1
c2JfZGV2aWNlX2xpc3QsICZlbXB0eV9saXN0LCBUUlVFKTsKKworICAgIHJldHVybiBMSUJVU0Jf
U1VDQ0VTUzsKK2Vycm9yOgorICAgIHdpbl9lcnIgPSBHZXRMYXN0RXJyb3IoKTsKKyAgICBpZiAo
IXdpbl9lcnIpIHsKKyAgICAgICAgd2luX2VyciA9IC0xOworICAgIH0KKyAgICBnX3dhcm5pbmco
IiVzIGZhaWxlZDogJWxkIiwgKmVycm9yX29uX2VuYWJsZSwgd2luX2Vycik7CisgICAgaWYgKGxp
YmRldl9saXN0KSB7CisgICAgICAgIGxpYnVzYl9mcmVlX2RldmljZV9saXN0KGxpYmRldl9saXN0
LCBUUlVFKTsKKyAgICB9CisgICAgcmV0dXJuIHdpbl9lcnI7Cit9CisKK3N0YXRpYyB2b2lkIHNl
dF9yZWRpcmVjdGluZyhTcGljZVVzYkJhY2tlbmQgKmJlLCBnYm9vbGVhbiBvbikKK3sKKyAgICBp
ZiAob24pIHsKKyAgICAgICAgZ19hdG9taWNfaW50X2luYygmYmUtPnJlZGlyZWN0aW5nKTsKKyAg
ICB9IGVsc2UgeworICAgICAgICBnYm9vbGVhbiBub19yZWRpcjsKKyAgICAgICAgbm9fcmVkaXIg
PSBnX2F0b21pY19pbnRfZGVjX2FuZF90ZXN0KCZiZS0+cmVkaXJlY3RpbmcpOworICAgICAgICBp
ZiAobm9fcmVkaXIgJiYgYmUtPmhXbmQpIHsKKyAgICAgICAgICAgIFBvc3RNZXNzYWdlKGJlLT5o
V25kLCBXTV9ERVZJQ0VDSEFOR0UsIDAsIDApOworICAgICAgICB9CisgICAgfQorfQorCisjZWxz
ZQorLyogTGludXgtc3BlY2lmaWM6IHVzZSBob3QgY2FsbGJhY2sgZnJvbSBsaWJ1c2IgKi8KKwor
c3RhdGljIHZvaWQgZGlzYWJsZV9ob3RwbHVnX3N1cHBvcnQoU3BpY2VVc2JCYWNrZW5kICpiZSkK
K3sKKyAgICBsaWJ1c2JfaG90cGx1Z19kZXJlZ2lzdGVyX2NhbGxiYWNrKGJlLT5saWJ1c2JfY29u
dGV4dCwgYmUtPmhvdHBsdWdfaGFuZGxlKTsKK30KKworc3RhdGljIGludCBlbmFibGVfaG90cGx1
Z19zdXBwb3J0KFNwaWNlVXNiQmFja2VuZCAqYmUsIGNvbnN0IGNoYXIgKiplcnJvcl9vbl9lbmFi
bGUpCit7CisgICAgaW50IHJjID0gMDsKKyAgICByYyA9IGxpYnVzYl9ob3RwbHVnX3JlZ2lzdGVy
X2NhbGxiYWNrKGJlLT5saWJ1c2JfY29udGV4dCwKKyAgICAgICAgTElCVVNCX0hPVFBMVUdfRVZF
TlRfREVWSUNFX0FSUklWRUQgfCBMSUJVU0JfSE9UUExVR19FVkVOVF9ERVZJQ0VfTEVGVCwKKyAg
ICAgICAgTElCVVNCX0hPVFBMVUdfRU5VTUVSQVRFLCBMSUJVU0JfSE9UUExVR19NQVRDSF9BTlks
CisgICAgICAgIExJQlVTQl9IT1RQTFVHX01BVENIX0FOWSwgTElCVVNCX0hPVFBMVUdfTUFUQ0hf
QU5ZLAorICAgICAgICBob3RwbHVnX2NhbGxiYWNrLCBiZSwgJmJlLT5ob3RwbHVnX2hhbmRsZSk7
CisgICAgKmVycm9yX29uX2VuYWJsZSA9IGxpYnVzYl9zdHJlcnJvcihyYyk7CisgICAgcmV0dXJu
IHJjOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgc2V0X3JlZGlyZWN0aW5nKFNwaWNlVXNiQmFj
a2VuZCAqYmUsIGdib29sZWFuIG9uKSB7CisgICAgLyogbm90aGluZyBvbiBMaW51eCAqLworfQor
CisjZW5kaWYKKwogLyogbG9jayBmdW5jdGlvbnMgZm9yIHVzYnJlZGlyaG9zdCBhbmQgdXNicmVk
aXJwYXJzZXIgKi8KIHN0YXRpYyB2b2lkICp1c2JyZWRpcl9hbGxvY19sb2NrKHZvaWQpIHsKICAg
ICBHTXV0ZXggKm11dGV4OwpAQCAtMjY1LDcgKzQzNCw3IEBAIHZvaWQgc3BpY2VfdXNiX2JhY2tl
bmRfZGVyZWdpc3Rlcl9ob3RwbHVnKFNwaWNlVXNiQmFja2VuZCAqYmUpCiB7CiAgICAgZ19yZXR1
cm5faWZfZmFpbChiZSAhPSBOVUxMKTsKICAgICBpZiAoYmUtPmhvdHBsdWdfaGFuZGxlKSB7Ci0g
ICAgICAgIGxpYnVzYl9ob3RwbHVnX2RlcmVnaXN0ZXJfY2FsbGJhY2soYmUtPmxpYnVzYl9jb250
ZXh0LCBiZS0+aG90cGx1Z19oYW5kbGUpOworICAgICAgICBkaXNhYmxlX2hvdHBsdWdfc3VwcG9y
dChiZSk7CiAgICAgICAgIGJlLT5ob3RwbHVnX2hhbmRsZSA9IDA7CiAgICAgfQogICAgIGJlLT5o
b3RwbHVnX2NhbGxiYWNrID0gTlVMTDsKQEAgLTI3NiwxNyArNDQ1LDE1IEBAIGdib29sZWFuIHNw
aWNlX3VzYl9iYWNrZW5kX3JlZ2lzdGVyX2hvdHBsdWcoU3BpY2VVc2JCYWNrZW5kICpiZSwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNiX2hvdF9wbHVnX2Nh
bGxiYWNrIHByb2MpCiB7CiAgICAgaW50IHJjOworICAgIGNvbnN0IGNoYXIgKmRlc2M7CiAgICAg
Z19yZXR1cm5fdmFsX2lmX2ZhaWwoYmUgIT0gTlVMTCwgRkFMU0UpOwogCiAgICAgYmUtPmhvdHBs
dWdfY2FsbGJhY2sgPSBwcm9jOwogICAgIGJlLT5ob3RwbHVnX3VzZXJfZGF0YSA9IHVzZXJfZGF0
YTsKLSAgICByYyA9IGxpYnVzYl9ob3RwbHVnX3JlZ2lzdGVyX2NhbGxiYWNrKGJlLT5saWJ1c2Jf
Y29udGV4dCwKLSAgICAgICAgTElCVVNCX0hPVFBMVUdfRVZFTlRfREVWSUNFX0FSUklWRUQgfCBM
SUJVU0JfSE9UUExVR19FVkVOVF9ERVZJQ0VfTEVGVCwKLSAgICAgICAgTElCVVNCX0hPVFBMVUdf
RU5VTUVSQVRFLCBMSUJVU0JfSE9UUExVR19NQVRDSF9BTlksCi0gICAgICAgIExJQlVTQl9IT1RQ
TFVHX01BVENIX0FOWSwgTElCVVNCX0hPVFBMVUdfTUFUQ0hfQU5ZLAotICAgICAgICBob3RwbHVn
X2NhbGxiYWNrLCBiZSwgJmJlLT5ob3RwbHVnX2hhbmRsZSk7CisKKyAgICByYyA9IGVuYWJsZV9o
b3RwbHVnX3N1cHBvcnQoYmUsICZkZXNjKTsKKwogICAgIGlmIChyYyAhPSBMSUJVU0JfU1VDQ0VT
UykgewotICAgICAgICBjb25zdCBjaGFyICpkZXNjID0gbGlidXNiX3N0cmVycm9yKHJjKTsKICAg
ICAgICAgZ193YXJuaW5nKCJFcnJvciBpbml0aWFsaXppbmcgVVNCIGhvdHBsdWcgc3VwcG9ydDog
JXMgWyVpXSIsIGRlc2MsIHJjKTsKICAgICAgICAgYmUtPmhvdHBsdWdfY2FsbGJhY2sgPSBOVUxM
OwogICAgICAgICByZXR1cm4gRkFMU0U7CkBAIC0zMDUsNDUgKzQ3Miw2IEBAIHZvaWQgc3BpY2Vf
dXNiX2JhY2tlbmRfZGVsZXRlKFNwaWNlVXNiQmFja2VuZCAqYmUpCiAgICAgU1BJQ0VfREVCVUco
IiVzIDw8IiwgX19GVU5DVElPTl9fKTsKIH0KIAotU3BpY2VVc2JCYWNrZW5kRGV2aWNlICoqc3Bp
Y2VfdXNiX2JhY2tlbmRfZ2V0X2RldmljZV9saXN0KFNwaWNlVXNiQmFja2VuZCAqYmUpCi17Ci0g
ICAgTE9VRF9ERUJVRygiJXMgPj4iLCBfX0ZVTkNUSU9OX18pOwotICAgIGxpYnVzYl9kZXZpY2Ug
KipkZXZsaXN0ID0gTlVMTCwgKipkZXY7Ci0gICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkLCAq
Kmxpc3Q7Ci0KLSAgICBpbnQgbiA9IDAsIGluZGV4OwotCi0gICAgaWYgKGJlICYmIGJlLT5saWJ1
c2JfY29udGV4dCkgewotICAgICAgICBsaWJ1c2JfZ2V0X2RldmljZV9saXN0KGJlLT5saWJ1c2Jf
Y29udGV4dCwgJmRldmxpc3QpOwotICAgIH0KLQotICAgIC8qIGFkZCBhbGwgdGhlIGxpYnVzYiBk
ZXZpY2UgdGhhdCBub3QgcHJlc2VudCBpbiBvdXIgbGlzdCAqLwotICAgIGZvciAoZGV2ID0gZGV2
bGlzdDsgZGV2ICYmICpkZXY7IGRldisrKSB7Ci0gICAgICAgIG4rKzsKLSAgICB9Ci0KLSAgICBs
aXN0ID0gZ19uZXcwKFNwaWNlVXNiQmFja2VuZERldmljZSosIG4gKyAxKTsKLQotICAgIGluZGV4
ID0gMDsKLQotICAgIGZvciAoZGV2ID0gZGV2bGlzdDsgZGV2ICYmICpkZXY7IGRldisrKSB7Ci0g
ICAgICAgIGQgPSBhbGxvY2F0ZV9iYWNrZW5kX2RldmljZSgqZGV2KTsKLSAgICAgICAgaWYgKCFk
KSB7Ci0gICAgICAgICAgICBsaWJ1c2JfdW5yZWZfZGV2aWNlKCpkZXYpOwotICAgICAgICB9IGVs
c2UgewotICAgICAgICAgICAgU1BJQ0VfREVCVUcoImNyZWF0ZWQgZGV2ICVwLCB1c2JsaWIgZGV2
ICVwIiwgZCwgKmRldik7Ci0gICAgICAgICAgICBsaXN0W2luZGV4KytdID0gZDsKLSAgICAgICAg
fQotICAgIH0KLQotICAgIGlmIChkZXZsaXN0KSB7Ci0gICAgICAgIGxpYnVzYl9mcmVlX2Rldmlj
ZV9saXN0KGRldmxpc3QsIDApOwotICAgIH0KLQotICAgIExPVURfREVCVUcoIiVzIDw8IiwgX19G
VU5DVElPTl9fKTsKLSAgICByZXR1cm4gbGlzdDsKLX0KLQogY29uc3QgVXNiRGV2aWNlSW5mb3Jt
YXRpb24qIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9nZXRfaW5mbyhTcGljZVVzYkJhY2tlbmRE
ZXZpY2UgKmRldikKIHsKICAgICByZXR1cm4gJmRldi0+ZGV2aWNlX2luZm87CkBAIC0zNTQsMTgg
KzQ4Miw2IEBAIGdjb25zdHBvaW50ZXIgc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX2dldF9saWJk
ZXYoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYpCiAgICAgcmV0dXJuIGRldi0+bGlidXNiX2Rl
dmljZTsKIH0KIAotdm9pZCBzcGljZV91c2JfYmFja2VuZF9mcmVlX2RldmljZV9saXN0KFNwaWNl
VXNiQmFja2VuZERldmljZSAqKmRldmxpc3QpCi17Ci0gICAgTE9VRF9ERUJVRygiJXMgPj4iLCBf
X0ZVTkNUSU9OX18pOwotICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqKmRldjsKLSAgICBmb3Ig
KGRldiA9IGRldmxpc3Q7ICpkZXY7IGRldisrKSB7Ci0gICAgICAgIFNwaWNlVXNiQmFja2VuZERl
dmljZSAqZCA9ICpkZXY7Ci0gICAgICAgIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV91bnJlZihk
KTsKLSAgICB9Ci0gICAgZ19mcmVlKGRldmxpc3QpOwotICAgIExPVURfREVCVUcoIiVzIDw8Iiwg
X19GVU5DVElPTl9fKTsKLX0KLQogU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpzcGljZV91c2JfYmFj
a2VuZF9kZXZpY2VfcmVmKFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2KQogewogICAgIExPVURf
REVCVUcoIiVzID4+ICVwIiwgX19GVU5DVElPTl9fLCBkZXYpOwpAQCAtNTMzLDEyICs2NDksMjMg
QEAgZ2Jvb2xlYW4gc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9hdHRhY2goU3BpY2VVc2JCYWNr
ZW5kQ2hhbm5lbCAqY2gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIEdFcnJvciAqKmVycm9yKQogeworICAgIGludCByYzsKICAgICBTUElD
RV9ERUJVRygiJXMgPj4gY2ggJXAsIGRldiAlcCAod2FzIGF0dGFjaGVkICVwKSIsIF9fRlVOQ1RJ
T05fXywgY2gsIGRldiwgY2gtPmF0dGFjaGVkKTsKIAogICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWls
KGRldiAhPSBOVUxMLCBGQUxTRSk7CiAKICAgICBsaWJ1c2JfZGV2aWNlX2hhbmRsZSAqaGFuZGxl
ID0gTlVMTDsKLSAgICBpbnQgcmMgPSBsaWJ1c2Jfb3BlbihkZXYtPmxpYnVzYl9kZXZpY2UsICZo
YW5kbGUpOworCisgICAgLyoKKyAgICAgICBVbmRlciBXaW5kb3dzIHdlIG5lZWQgdG8gYXZvaWQg
dXBkYXRpbmcKKyAgICAgICBsaXN0IG9mIGRldmljZXMgd2hlbiB3ZSBhcmUgYWNxdWlyaW5nIHRo
ZSBkZXZpY2UKKyAgICAqLworICAgIHNldF9yZWRpcmVjdGluZyhjaC0+YmFja2VuZCwgVFJVRSk7
CisKKyAgICByYyA9IGxpYnVzYl9vcGVuKGRldi0+bGlidXNiX2RldmljZSwgJmhhbmRsZSk7CisK
KyAgICBzZXRfcmVkaXJlY3RpbmcoY2gtPmJhY2tlbmQsIEZBTFNFKTsKKwogICAgIGlmIChyYykg
ewogICAgICAgICBjb25zdCBjaGFyICpkZXNjID0gbGlidXNiX3N0cmVycm9yKHJjKTsKICAgICAg
ICAgZ19zZXRfZXJyb3IoZXJyb3IsIFNQSUNFX0NMSUVOVF9FUlJPUiwgU1BJQ0VfQ0xJRU5UX0VS
Uk9SX0ZBSUxFRCwKQEAgLTU4Niw2ICs3MTMsNyBAQCBTcGljZVVzYkJhY2tlbmRDaGFubmVsICpz
cGljZV91c2JfYmFja2VuZF9jaGFubmVsX25ldyhTcGljZVVzYkJhY2tlbmQgKmJlLAogICAgIFNQ
SUNFX0RFQlVHKCIlcyA+PiIsIF9fRlVOQ1RJT05fXyk7CiAgICAgY2gtPnVzZXJfZGF0YSA9IFNQ
SUNFX1VTQlJFRElSX0NIQU5ORUwodXNlcl9kYXRhKTsKICAgICBpZiAoYmUtPmxpYnVzYl9jb250
ZXh0KSB7CisgICAgICAgIGNoLT5iYWNrZW5kID0gYmU7CiAgICAgICAgIGNoLT51c2JyZWRpcmhv
c3QgPSB1c2JyZWRpcmhvc3Rfb3Blbl9mdWxsKAogICAgICAgICAgICAgYmUtPmxpYnVzYl9jb250
ZXh0LAogICAgICAgICAgICAgTlVMTCwKZGlmZiAtLWdpdCBhL3NyYy91c2ItYmFja2VuZC5oIGIv
c3JjL3VzYi1iYWNrZW5kLmgKaW5kZXggY2JiNzNjMi4uNmRhMzk4MSAxMDA2NDQKLS0tIGEvc3Jj
L3VzYi1iYWNrZW5kLmgKKysrIGIvc3JjL3VzYi1iYWNrZW5kLmgKQEAgLTU2LDE0ICs1Niw2IEBA
IGVudW0gewogU3BpY2VVc2JCYWNrZW5kICpzcGljZV91c2JfYmFja2VuZF9uZXcoR0Vycm9yICoq
ZXJyb3IpOwogdm9pZCBzcGljZV91c2JfYmFja2VuZF9kZWxldGUoU3BpY2VVc2JCYWNrZW5kICpj
b250ZXh0KTsKIAotLyoKLXJldHVybnMgbmV3bHktYWxsb2NhdGVkIG51bGwtdGVybWluYXRlZCBs
aXN0IG9mCi1TcGljZVVzYkJhY2tlbmREZXZpY2UgcG9pbnRlcnMuCi1UaGUgY2FsbGVyIG11c3Qg
Y2FsbCBzcGljZV91c2JfYmFja2VuZF9mcmVlX2RldmljZV9saXN0Ci1hZnRlciBpdCBmaW5pc2hl
cyBsaXN0IHByb2Nlc3NpbmcKLSovCi1TcGljZVVzYkJhY2tlbmREZXZpY2UgKipzcGljZV91c2Jf
YmFja2VuZF9nZXRfZGV2aWNlX2xpc3QoU3BpY2VVc2JCYWNrZW5kICpiYWNrZW5kKTsKLXZvaWQg
c3BpY2VfdXNiX2JhY2tlbmRfZnJlZV9kZXZpY2VfbGlzdChTcGljZVVzYkJhY2tlbmREZXZpY2Ug
KipkZXZsaXN0KTsKIGdib29sZWFuIHNwaWNlX3VzYl9iYWNrZW5kX2hhbmRsZV9ldmVudHMoU3Bp
Y2VVc2JCYWNrZW5kICpiZSk7CiB2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2ludGVycnVwdF9ldmVu
dF9oYW5kbGVyKFNwaWNlVXNiQmFja2VuZCAqYmUpOwogZ2Jvb2xlYW4gc3BpY2VfdXNiX2JhY2tl
bmRfcmVnaXN0ZXJfaG90cGx1ZyhTcGljZVVzYkJhY2tlbmQgKmJlLApkaWZmIC0tZ2l0IGEvc3Jj
L3VzYi1kZXZpY2UtbWFuYWdlci5jIGIvc3JjL3VzYi1kZXZpY2UtbWFuYWdlci5jCmluZGV4IDlh
YmEyNzUuLjkzMDBhZDIgMTAwNjQ0Ci0tLSBhL3NyYy91c2ItZGV2aWNlLW1hbmFnZXIuYworKysg
Yi9zcmMvdXNiLWRldmljZS1tYW5hZ2VyLmMKQEAgLTI5LDcgKzI5LDYgQEAKICNpZmRlZiBHX09T
X1dJTjMyCiAjaW5jbHVkZSA8d2luZG93cy5oPgogI2luY2x1ZGUgInVzYmRrX2FwaS5oIgotI2lu
Y2x1ZGUgIndpbi11c2ItZGV2LmgiCiAjZW5kaWYKIAogI2luY2x1ZGUgImNoYW5uZWwtdXNicmVk
aXItcHJpdi5oIgpAQCAtMTAxLDEyICsxMDAsMTAgQEAgc3RydWN0IF9TcGljZVVzYkRldmljZU1h
bmFnZXJQcml2YXRlIHsKICAgICBzdHJ1Y3QgdXNicmVkaXJmaWx0ZXJfcnVsZSAqcmVkaXJlY3Rf
b25fY29ubmVjdF9ydWxlczsKICAgICBpbnQgYXV0b19jb25uX2ZpbHRlcl9ydWxlc19jb3VudDsK
ICAgICBpbnQgcmVkaXJlY3Rfb25fY29ubmVjdF9ydWxlc19jb3VudDsKKyAgICBnYm9vbGVhbiBy
ZWRpcmVjdGluZzsKICNpZmRlZiBHX09TX1dJTjMyCi0gICAgR1VkZXZDbGllbnQgKnVkZXY7CiAg
ICAgdXNiZGtfYXBpX3dyYXBwZXIgKnVzYmRrX2FwaTsKICAgICBIQU5ETEUgdXNiZGtfaGlkZXJf
aGFuZGxlOwotI2Vsc2UKLSAgICBnYm9vbGVhbiByZWRpcmVjdGluZzsgLyogSGFuZGxlZCBieSBH
VWRldkNsaWVudCBpbiB0aGUgZ3VkZXYgY2FzZSAqLwogI2VuZGlmCiAgICAgR1B0ckFycmF5ICpk
ZXZpY2VzOwogICAgIEdQdHJBcnJheSAqY2hhbm5lbHM7CkBAIC0xMzksMTYgKzEzNiw5IEBAIHN0
YXRpYyB2b2lkIGNoYW5uZWxfZGVzdHJveShTcGljZVNlc3Npb24gKnNlc3Npb24sIFNwaWNlQ2hh
bm5lbCAqY2hhbm5lbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncG9pbnRlciB1c2Vy
X2RhdGEpOwogc3RhdGljIHZvaWQgY2hhbm5lbF9ldmVudChTcGljZUNoYW5uZWwgKmNoYW5uZWws
IFNwaWNlQ2hhbm5lbEV2ZW50IGV2ZW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICBncG9p
bnRlciB1c2VyX2RhdGEpOwotI2lmZGVmIEdfT1NfV0lOMzIKLXN0YXRpYyB2b2lkIHNwaWNlX3Vz
Yl9kZXZpY2VfbWFuYWdlcl91ZXZlbnRfY2IoR1VkZXZDbGllbnQgICAgICpjbGllbnQsCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNlVXNiQmFja2Vu
ZERldmljZSAqdWRldmljZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgZ2Jvb2xlYW4gICAgICAgICBhZGQsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGdwb2ludGVyICAgICAgICAgdXNlcl9kYXRhKTsKLSNlbHNl
CiBzdGF0aWMgdm9pZCBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfaG90cGx1Z19jYih2b2lkICp1
c2VyX2RhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGdib29sZWFuIGFkZGVkKTsKLSNlbmRpZgogc3RhdGljIHZv
aWQgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2NoZWNrX3JlZGlyX29uX2Nvbm5lY3QoCiAgICAg
U3BpY2VVc2JEZXZpY2VNYW5hZ2VyICpzZWxmLCBTcGljZUNoYW5uZWwgKmNoYW5uZWwpOwogCkBA
IC0xOTAsMTEgKzE4MCw3IEBAIEdfREVGSU5FX0JPWEVEX1RZUEUoU3BpY2VVc2JEZXZpY2UsIHNw
aWNlX3VzYl9kZXZpY2UsCiBzdGF0aWMgdm9pZAogX3NldF9yZWRpcmVjdGluZyhTcGljZVVzYkRl
dmljZU1hbmFnZXIgKnNlbGYsIGdib29sZWFuIGlzX3JlZGlyZWN0aW5nKQogewotI2lmZGVmIEdf
T1NfV0lOMzIKLSAgICBnX29iamVjdF9zZXQoc2VsZi0+cHJpdi0+dWRldiwgInJlZGlyZWN0aW5n
IiwgaXNfcmVkaXJlY3RpbmcsIE5VTEwpOwotI2Vsc2UKICAgICBzZWxmLT5wcml2LT5yZWRpcmVj
dGluZyA9IGlzX3JlZGlyZWN0aW5nOwotI2VuZGlmCiB9CiAKICNlbHNlCkBAIC0yMTUsMTAgKzIw
MSw2IEBAIGdib29sZWFuIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9pc19yZWRpcmVjdGluZyhT
cGljZVVzYkRldmljZU1hbmFnZXIgKnNlbGYpCiB7CiAjaWZuZGVmIFVTRV9VU0JSRURJUgogICAg
IHJldHVybiBGQUxTRTsKLSNlbGlmIGRlZmluZWQoR19PU19XSU4zMikKLSAgICBnYm9vbGVhbiBy
ZWRpcmVjdGluZzsKLSAgICBnX29iamVjdF9nZXQoc2VsZi0+cHJpdi0+dWRldiwgInJlZGlyZWN0
aW5nIiwgJnJlZGlyZWN0aW5nLCBOVUxMKTsKLSAgICByZXR1cm4gcmVkaXJlY3Rpbmc7CiAjZWxz
ZQogICAgIHJldHVybiBzZWxmLT5wcml2LT5yZWRpcmVjdGluZzsKICNlbmRpZgpAQCAtMjY3LDI5
ICsyNDksMTggQEAgc3RhdGljIGdib29sZWFuIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9pbml0
YWJsZV9pbml0KEdJbml0YWJsZSAgKmluaXRhYmxlLAogICAgIEdMaXN0ICpsaXN0OwogICAgIEdM
aXN0ICppdDsKIAotICAgIC8qIFN0YXJ0IGxpc3RlbmluZyBmb3IgdXNiIGRldmljZXMgcGx1ZyAv
IHVucGx1ZyAqLwotI2lmZGVmIEdfT1NfV0lOMzIKLSAgICBwcml2LT51ZGV2ID0gZ191ZGV2X2Ns
aWVudF9uZXcoKTsKLSAgICBpZiAocHJpdi0+dWRldiA9PSBOVUxMKSB7Ci0gICAgICAgIGdfd2Fy
bmluZygiRXJyb3IgaW5pdGlhbGl6aW5nIEdVZGV2Q2xpZW50Iik7Ci0gICAgICAgIHJldHVybiBG
QUxTRTsKLSAgICB9Ci0gICAgcHJpdi0+Y29udGV4dCA9IGdfdWRldl9jbGllbnRfZ2V0X2NvbnRl
eHQocHJpdi0+dWRldik7Ci0gICAgZ19zaWduYWxfY29ubmVjdChHX09CSkVDVChwcml2LT51ZGV2
KSwgInVldmVudCIsCi0gICAgICAgICAgICAgICAgICAgICBHX0NBTExCQUNLKHNwaWNlX3VzYl9k
ZXZpY2VfbWFuYWdlcl91ZXZlbnRfY2IpLCBzZWxmKTsKLSAgICAvKiBEbyBjb2xkcGx1ZyAoZGV0
ZWN0aW9uIG9mIGFscmVhZHkgY29ubmVjdGVkIGRldmljZXMpICovCi0gICAgZ191ZGV2X2NsaWVu
dF9yZXBvcnRfZGV2aWNlcyhwcml2LT51ZGV2KTsKLSNlbHNlCiAgICAgLyogSW5pdGlhbGl6ZSBs
aWJ1c2IgKi8KICAgICBwcml2LT5jb250ZXh0ID0gc3BpY2VfdXNiX2JhY2tlbmRfbmV3KGVycik7
CiAgICAgaWYgKCFwcml2LT5jb250ZXh0KSB7CiAgICAgICAgIHJldHVybiBGQUxTRTsKICAgICB9
CiAKKyAgICAvKiBTdGFydCBsaXN0ZW5pbmcgZm9yIHVzYiBkZXZpY2VzIHBsdWcgLyB1bnBsdWcg
Ki8KICAgICBpZiAoIXNwaWNlX3VzYl9iYWNrZW5kX3JlZ2lzdGVyX2hvdHBsdWcocHJpdi0+Y29u
dGV4dCwgc2VsZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
c3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2hvdHBsdWdfY2IpKSB7CiAgICAgICAgIHJldHVybiBG
QUxTRTsKICAgICB9CisjaWZuZGVmIEdfT1NfV0lOMzIKICAgICBzcGljZV91c2JfZGV2aWNlX21h
bmFnZXJfc3RhcnRfZXZlbnRfbGlzdGVuaW5nKHNlbGYsIE5VTEwpOwogI2VuZGlmCiAKQEAgLTMy
NCw4ICsyOTUsOSBAQCBzdGF0aWMgdm9pZCBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfZGlzcG9z
ZShHT2JqZWN0ICpnb2JqZWN0KQogICAgICAgICBnX3dhcm5faWZfcmVhY2hlZCgpOwogICAgICAg
ICBnX2F0b21pY19pbnRfc2V0KCZwcml2LT5ldmVudF90aHJlYWRfcnVuLCBGQUxTRSk7CiAgICAg
fQotICAgIHNwaWNlX3VzYl9iYWNrZW5kX2RlcmVnaXN0ZXJfaG90cGx1Zyhwcml2LT5jb250ZXh0
KTsKICNlbmRpZgorICAgIHNwaWNlX3VzYl9iYWNrZW5kX2RlcmVnaXN0ZXJfaG90cGx1Zyhwcml2
LT5jb250ZXh0KTsKKwogICAgIGlmIChwcml2LT5ldmVudF90aHJlYWQpIHsKICAgICAgICAgZ193
YXJuX2lmX2ZhaWwoZ19hdG9taWNfaW50X2dldCgmcHJpdi0+ZXZlbnRfdGhyZWFkX3J1bikgPT0g
RkFMU0UpOwogICAgICAgICBnX2F0b21pY19pbnRfc2V0KCZwcml2LT5ldmVudF90aHJlYWRfcnVu
LCBGQUxTRSk7CkBAIC0zNTAsMTQgKzMyMiwxMCBAQCBzdGF0aWMgdm9pZCBzcGljZV91c2JfZGV2
aWNlX21hbmFnZXJfZmluYWxpemUoR09iamVjdCAqZ29iamVjdCkKICAgICBpZiAocHJpdi0+ZGV2
aWNlcykgewogICAgICAgICBnX3B0cl9hcnJheV91bnJlZihwcml2LT5kZXZpY2VzKTsKICAgICB9
Ci0jaWZkZWYgR19PU19XSU4zMgotICAgIGdfY2xlYXJfb2JqZWN0KCZwcml2LT51ZGV2KTsKLSNl
bmRpZgogICAgIGdfcmV0dXJuX2lmX2ZhaWwocHJpdi0+ZXZlbnRfdGhyZWFkID09IE5VTEwpOwot
I2lmbmRlZiBHX09TX1dJTjMyCi0gICAgaWYgKHByaXYtPmNvbnRleHQpCisgICAgaWYgKHByaXYt
PmNvbnRleHQpIHsKICAgICAgICAgc3BpY2VfdXNiX2JhY2tlbmRfZGVsZXRlKHByaXYtPmNvbnRl
eHQpOwotI2VuZGlmCisgICAgfQogICAgIGZyZWUocHJpdi0+YXV0b19jb25uX2ZpbHRlcl9ydWxl
cyk7CiAgICAgZnJlZShwcml2LT5yZWRpcmVjdF9vbl9jb25uZWN0X3J1bGVzKTsKICNpZmRlZiBH
X09TX1dJTjMyCkBAIC04OTEsMjAgKzg1OSw2IEBAIHN0YXRpYyB2b2lkIHNwaWNlX3VzYl9kZXZp
Y2VfbWFuYWdlcl9yZW1vdmVfZGV2KFNwaWNlVXNiRGV2aWNlTWFuYWdlciAqc2VsZiwKICAgICBz
cGljZV91c2JfZGV2aWNlX3VucmVmKGRldmljZSk7CiB9CiAKLSNpZmRlZiBHX09TX1dJTjMyCi1z
dGF0aWMgdm9pZCBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfdWV2ZW50X2NiKEdVZGV2Q2xpZW50
ICAgICAqY2xpZW50LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmJkZXYsCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGdib29sZWFuICAgICAgICAgYWRkLAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncG9pbnRlciAgICAgICAgIHVz
ZXJfZGF0YSkKLXsKLSAgICBTcGljZVVzYkRldmljZU1hbmFnZXIgKnNlbGYgPSBTUElDRV9VU0Jf
REVWSUNFX01BTkFHRVIodXNlcl9kYXRhKTsKLQotICAgIGlmIChhZGQpCi0gICAgICAgIHNwaWNl
X3VzYl9kZXZpY2VfbWFuYWdlcl9hZGRfZGV2KHNlbGYsIGJkZXYpOwotICAgIGVsc2UKLSAgICAg
ICAgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX3JlbW92ZV9kZXYoc2VsZiwgYmRldik7Ci19Ci0j
ZWxzZQogc3RydWN0IGhvdHBsdWdfaWRsZV9jYl9hcmdzIHsKICAgICBTcGljZVVzYkRldmljZU1h
bmFnZXIgKnNlbGY7CiAgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXZpY2U7CkBAIC05NDAs
NyArODk0LDYgQEAgc3RhdGljIHZvaWQgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2hvdHBsdWdf
Y2Iodm9pZCAqdXNlcl9kYXRhLAogICAgIGFyZ3MtPmFkZGVkID0gYWRkZWQ7CiAgICAgZ19pZGxl
X2FkZChzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfaG90cGx1Z19pZGxlX2NiLCBhcmdzKTsKIH0K
LSNlbmRpZiAvLyBVU0VfVVNCUkVESVIKIAogc3RhdGljIHZvaWQgc3BpY2VfdXNiX2RldmljZV9t
YW5hZ2VyX2NoYW5uZWxfY29ubmVjdF9jYigKICAgICBHT2JqZWN0ICpnb2JqZWN0LCBHQXN5bmNS
ZXN1bHQgKmNoYW5uZWxfcmVzLCBncG9pbnRlciB1c2VyX2RhdGEpCmRpZmYgLS1naXQgYS9zcmMv
d2luLXVzYi1kZXYuYyBiL3NyYy93aW4tdXNiLWRldi5jCmRlbGV0ZWQgZmlsZSBtb2RlIDEwMDY0
NAppbmRleCBjMmE1MTE1Li4wMDAwMDAwCi0tLSBhL3NyYy93aW4tdXNiLWRldi5jCisrKyAvZGV2
L251bGwKQEAgLTEsNDM2ICswLDAgQEAKLS8qIC0qLSBNb2RlOiBDOyBjLWJhc2ljLW9mZnNldDog
NDsgaW5kZW50LXRhYnMtbW9kZTogbmlsIC0qLSAqLwotLyoKLSAgIENvcHlyaWdodCAoQykgMjAx
MiBSZWQgSGF0LCBJbmMuCi0KLSAgIFJlZCBIYXQgQXV0aG9yczoKLSAgIEFybm9uIEdpbGJvYSA8
YWdpbGJvYUByZWRoYXQuY29tPgotICAgVXJpIEx1YmxpbiAgIDx1cmlsQHJlZGhhdC5jb20+Ci0K
LSAgIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBp
dCBhbmQvb3IKLSAgIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIg
R2VuZXJhbCBQdWJsaWMKLSAgIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3
YXJlIEZvdW5kYXRpb247IGVpdGhlcgotICAgdmVyc2lvbiAyLjEgb2YgdGhlIExpY2Vuc2UsIG9y
IChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCi0KLSAgIFRoaXMgbGlicmFyeSBp
cyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAotICAgYnV0
IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkg
b2YKLSAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9T
RS4gIFNlZSB0aGUgR05VCi0gICBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9y
ZSBkZXRhaWxzLgotCi0gICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBH
TlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCi0gICBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBsaWJy
YXJ5OyBpZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCi0qLwotCi0j
aW5jbHVkZSAiY29uZmlnLmgiCi0KLSNpbmNsdWRlIDx3aW5kb3dzLmg+Ci0jaW5jbHVkZSAid2lu
LXVzYi1kZXYuaCIKLSNpbmNsdWRlICJzcGljZS1tYXJzaGFsLmgiCi0jaW5jbHVkZSAic3BpY2Ut
dXRpbC5oIgotCi1lbnVtIHsKLSAgICBQUk9QXzAsCi0gICAgUFJPUF9SRURJUkVDVElORwotfTsK
LQotc3RydWN0IF9HVWRldkNsaWVudFByaXZhdGUgewotICAgIFNwaWNlVXNiQmFja2VuZCAqY3R4
OwotICAgIEdMaXN0ICp1ZGV2X2xpc3Q7Ci0gICAgSFdORCBod25kOwotICAgIGdib29sZWFuIHJl
ZGlyZWN0aW5nOwotfTsKLQotI2RlZmluZSBHX1VERVZfQ0xJRU5UX1dJTkNMQVNTX05BTUUgIFRF
WFQoIkdfVURFVl9DTElFTlQiKQotCi1zdGF0aWMgdm9pZCBnX3VkZXZfY2xpZW50X2luaXRhYmxl
X2lmYWNlX2luaXQoR0luaXRhYmxlSWZhY2UgICppZmFjZSk7Ci0KLUdfREVGSU5FX1RZUEVfV0lU
SF9DT0RFKEdVZGV2Q2xpZW50LCBnX3VkZXZfY2xpZW50LCBHX1RZUEVfT0JKRUNULAotICAgICAg
ICAgICAgICAgICAgICAgICAgR19BRERfUFJJVkFURShHVWRldkNsaWVudCkKLSAgICAgICAgICAg
ICAgICAgICAgICAgIEdfSU1QTEVNRU5UX0lOVEVSRkFDRShHX1RZUEVfSU5JVEFCTEUsIGdfdWRl
dl9jbGllbnRfaW5pdGFibGVfaWZhY2VfaW5pdCkpCi0KLWVudW0KLXsKLSAgICBVRVZFTlRfU0lH
TkFMLAotICAgIExBU1RfU0lHTkFMLAotfTsKLQotc3RhdGljIGd1aW50IHNpZ25hbHNbTEFTVF9T
SUdOQUxdID0geyAwLCB9Owotc3RhdGljIEdVZGV2Q2xpZW50ICpzaW5nbGV0b24gPSBOVUxMOwot
Ci1zdGF0aWMgTFJFU1VMVCBDQUxMQkFDSyB3bmRfcHJvYyhIV05EIGh3bmQsIFVJTlQgbWVzc2Fn
ZSwgV1BBUkFNIHdwYXJhbSwgTFBBUkFNIGxwYXJhbSk7Ci0KLS8vdW5jb21tZW50IHRvIGRlYnVn
IGd1ZGV2IGRldmljZSBsaXN0cy4KLS8vI2RlZmluZSBERUJVR19HVURFVl9ERVZJQ0VfTElTVFMK
LQotI2lmZGVmIERFQlVHX0dVREVWX0RFVklDRV9MSVNUUwotc3RhdGljIHZvaWQgZ191ZGV2X2Rl
dmljZV9wcmludF9saXN0KEdMaXN0ICpsLCBjb25zdCBnY2hhciAqbXNnKTsKLSNlbHNlCi1zdGF0
aWMgdm9pZCBnX3VkZXZfZGV2aWNlX3ByaW50X2xpc3QoR0xpc3QgKmwsIGNvbnN0IGdjaGFyICpt
c2cpIHt9Ci0jZW5kaWYKLXN0YXRpYyB2b2lkIGdfdWRldl9kZXZpY2VfcHJpbnQoU3BpY2VVc2JC
YWNrZW5kRGV2aWNlICpkZXYsIGNvbnN0IGdjaGFyICptc2cpOwotCi1HUXVhcmsgZ191ZGV2X2Ns
aWVudF9lcnJvcl9xdWFyayh2b2lkKQotewotICAgIHJldHVybiBnX3F1YXJrX2Zyb21fc3RhdGlj
X3N0cmluZygid2luLWd1ZGV2LWNsaWVudC1lcnJvci1xdWFyayIpOwotfQotCi1HVWRldkNsaWVu
dCAqZ191ZGV2X2NsaWVudF9uZXcodm9pZCkKLXsKLSAgICBpZiAoc2luZ2xldG9uICE9IE5VTEwp
Ci0gICAgICAgIHJldHVybiBnX29iamVjdF9yZWYoc2luZ2xldG9uKTsKLQotICAgIHNpbmdsZXRv
biA9IGdfaW5pdGFibGVfbmV3KEdfVURFVl9UWVBFX0NMSUVOVCwgTlVMTCwgTlVMTCwgTlVMTCk7
Ci0gICAgcmV0dXJuIHNpbmdsZXRvbjsKLX0KLQotU3BpY2VVc2JCYWNrZW5kICpnX3VkZXZfY2xp
ZW50X2dldF9jb250ZXh0KEdVZGV2Q2xpZW50ICpjbGllbnQpCi17Ci0gICAgcmV0dXJuIGNsaWVu
dC0+cHJpdi0+Y3R4OwotfQotCi0vKgotICogZGV2cyBbaW4sb3V0XSBhbiBlbXB0eSBkZXZzIGxp
c3QgaW4sIGZ1bGwgZGV2cyBsaXN0IG91dAotICogUmV0dXJuczogbnVtYmVyLW9mLWRldmljZXMs
IG9yIGEgbmVnYXRpdmUgdmFsdWUgb24gZXJyb3IuCi0gKi8KLXN0YXRpYyBzc2l6ZV90Ci1nX3Vk
ZXZfY2xpZW50X2xpc3RfZGV2aWNlcyhHVWRldkNsaWVudCAqc2VsZiwgR0xpc3QgKipkZXZzLAot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgR0Vycm9yICoqZXJyLCBjb25zdCBnY2hhciAqbmFt
ZSkKLXsKLSAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKipsdXNiX2xpc3QsICoqZGV2OwotICAg
IEdVZGV2Q2xpZW50UHJpdmF0ZSAqcHJpdjsKLSAgICBzc2l6ZV90IG47Ci0KLSAgICBnX3JldHVy
bl92YWxfaWZfZmFpbChHX1VERVZfSVNfQ0xJRU5UKHNlbGYpLCAtMSk7Ci0gICAgZ19yZXR1cm5f
dmFsX2lmX2ZhaWwoZGV2cyAhPSBOVUxMLCAtMik7Ci0KLSAgICBwcml2ID0gc2VsZi0+cHJpdjsK
LQotICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKHNlbGYtPnByaXYtPmN0eCAhPSBOVUxMLCAtMyk7
Ci0KLSAgICBsdXNiX2xpc3QgPSBzcGljZV91c2JfYmFja2VuZF9nZXRfZGV2aWNlX2xpc3QocHJp
di0+Y3R4KTsKLSAgICBpZiAoIWx1c2JfbGlzdCkgewotICAgICAgICBnX3NldF9lcnJvcihlcnIs
IEdfVURFVl9DTElFTlRfRVJST1IsIEdfVURFVl9DTElFTlRfTElCVVNCX0ZBSUxFRCwKLSAgICAg
ICAgICAgICAgICAgICAgIiVzOiBFcnJvciBnZXR0aW5nIFVTQiBkZXZpY2UgbGlzdCIsIG5hbWUp
OwotICAgICAgICByZXR1cm4gLTQ7Ci0gICAgfQotCi0gICAgbiA9IDA7Ci0gICAgZm9yIChkZXYg
PSBsdXNiX2xpc3Q7ICpkZXY7IGRldisrKSB7Ci0gICAgICAgICpkZXZzID0gZ19saXN0X3ByZXBl
bmQoKmRldnMsIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9yZWYoKmRldikpOwotICAgICAgICBu
Kys7Ci0gICAgfQotICAgIHNwaWNlX3VzYl9iYWNrZW5kX2ZyZWVfZGV2aWNlX2xpc3QobHVzYl9s
aXN0KTsKLQotICAgIHJldHVybiBuOwotfQotCi1zdGF0aWMgdm9pZCB1bnJlZmVyZW5jZV9iYWNr
ZW5kX2RldmljZShncG9pbnRlciBkYXRhKQotewotICAgIHNwaWNlX3VzYl9iYWNrZW5kX2Rldmlj
ZV91bnJlZigoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICopZGF0YSk7Ci19Ci0KLXN0YXRpYyB2b2lk
IGdfdWRldl9jbGllbnRfZnJlZV9kZXZpY2VfbGlzdChHTGlzdCAqKmRldnMpCi17Ci0gICAgZ19y
ZXR1cm5faWZfZmFpbChkZXZzICE9IE5VTEwpOwotICAgIGlmICgqZGV2cykgewotICAgICAgICBn
X2xpc3RfZnJlZV9mdWxsKCpkZXZzLCB1bnJlZmVyZW5jZV9iYWNrZW5kX2RldmljZSk7Ci0gICAg
ICAgICpkZXZzID0gTlVMTDsKLSAgICB9Ci19Ci0KLQotc3RhdGljIGdib29sZWFuCi1nX3VkZXZf
Y2xpZW50X2luaXRhYmxlX2luaXQoR0luaXRhYmxlICppbml0YWJsZSwgR0NhbmNlbGxhYmxlICpj
YW5jZWxsYWJsZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICBHRXJyb3IgKiplcnIpCi17
Ci0gICAgR1VkZXZDbGllbnQgKnNlbGY7Ci0gICAgR1VkZXZDbGllbnRQcml2YXRlICpwcml2Owot
ICAgIFdORENMQVNTIHdjbHM7Ci0KLSAgICBnX3JldHVybl92YWxfaWZfZmFpbChHX1VERVZfSVNf
Q0xJRU5UKGluaXRhYmxlKSwgRkFMU0UpOwotICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKGNhbmNl
bGxhYmxlID09IE5VTEwsIEZBTFNFKTsKLQotICAgIHNlbGYgPSBHX1VERVZfQ0xJRU5UKGluaXRh
YmxlKTsKLSAgICBwcml2ID0gc2VsZi0+cHJpdjsKLQotICAgIHByaXYtPmN0eCA9IHNwaWNlX3Vz
Yl9iYWNrZW5kX25ldyhlcnIpOwotICAgIGlmICghcHJpdi0+Y3R4KSB7Ci0gICAgICAgIHJldHVy
biBGQUxTRTsKLSAgICB9Ci0KLSNpZmRlZiBHX09TX1dJTjMyCi0jaWYgTElCVVNCX0FQSV9WRVJT
SU9OID49IDB4MDEwMDAxMDYKLSAgICBsaWJ1c2Jfc2V0X29wdGlvbihwcml2LT5jdHgsIExJQlVT
Ql9PUFRJT05fVVNFX1VTQkRLKTsKLSNlbmRpZgotI2VuZGlmCi0KLSAgICAvKiBnZXQgaW5pdGlh
bCBkZXZpY2UgbGlzdCAqLwotICAgIGlmIChnX3VkZXZfY2xpZW50X2xpc3RfZGV2aWNlcyhzZWxm
LCAmcHJpdi0+dWRldl9saXN0LCBlcnIsIF9fRlVOQ1RJT05fXykgPCAwKSB7Ci0gICAgICAgIGdv
dG8gZ191ZGV2X2NsaWVudF9pbml0X2ZhaWxlZDsKLSAgICB9Ci0KLSAgICBnX3VkZXZfZGV2aWNl
X3ByaW50X2xpc3QocHJpdi0+dWRldl9saXN0LCAiaW5pdDogZmlyc3QgbGlzdCBpczogIik7Ci0K
LSAgICAvKiBjcmVhdGUgYSBoaWRkZW4gd2luZG93ICovCi0gICAgbWVtc2V0KCZ3Y2xzLCAwLCBz
aXplb2Yod2NscykpOwotICAgIHdjbHMubHBmblduZFByb2MgPSB3bmRfcHJvYzsKLSAgICB3Y2xz
Lmxwc3pDbGFzc05hbWUgPSBHX1VERVZfQ0xJRU5UX1dJTkNMQVNTX05BTUU7Ci0gICAgaWYgKCFS
ZWdpc3RlckNsYXNzKCZ3Y2xzKSkgewotICAgICAgICBEV09SRCBlID0gR2V0TGFzdEVycm9yKCk7
Ci0gICAgICAgIGdfd2FybmluZygiUmVnaXN0ZXJDbGFzcyBmYWlsZWQgLCAlbGQiLCAobG9uZyll
KTsKLSAgICAgICAgZ19zZXRfZXJyb3IoZXJyLCBHX1VERVZfQ0xJRU5UX0VSUk9SLCBHX1VERVZf
Q0xJRU5UX1dJTkFQSV9GQUlMRUQsCi0gICAgICAgICAgICAgICAgICAgICJSZWdpc3RlckNsYXNz
IGZhaWxlZDogJWxkIiwgKGxvbmcpZSk7Ci0gICAgICAgIGdvdG8gZ191ZGV2X2NsaWVudF9pbml0
X2ZhaWxlZDsKLSAgICB9Ci0gICAgcHJpdi0+aHduZCA9IENyZWF0ZVdpbmRvdyhHX1VERVZfQ0xJ
RU5UX1dJTkNMQVNTX05BTUUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOVUxMLCAw
LCAwLCAwLCAwLCAwLCBOVUxMLCBOVUxMLCBOVUxMLCBOVUxMKTsKLSAgICBpZiAoIXByaXYtPmh3
bmQpIHsKLSAgICAgICAgRFdPUkQgZSA9IEdldExhc3RFcnJvcigpOwotICAgICAgICBnX3dhcm5p
bmcoIkNyZWF0ZVdpbmRvdyBmYWlsZWQ6ICVsZCIsIChsb25nKWUpOwotICAgICAgICBnX3NldF9l
cnJvcihlcnIsIEdfVURFVl9DTElFTlRfRVJST1IsIEdfVURFVl9DTElFTlRfTElCVVNCX0ZBSUxF
RCwKLSAgICAgICAgICAgICAgICAgICAgIkNyZWF0ZVdpbmRvdyBmYWlsZWQ6ICVsZCIsIChsb25n
KWUpOwotICAgICAgICBnb3RvIGdfdWRldl9jbGllbnRfaW5pdF9mYWlsZWRfdW5yZWc7Ci0gICAg
fQotCi0gICAgcmV0dXJuIFRSVUU7Ci0KLSBnX3VkZXZfY2xpZW50X2luaXRfZmFpbGVkX3VucmVn
OgotICAgIFVucmVnaXN0ZXJDbGFzcyhHX1VERVZfQ0xJRU5UX1dJTkNMQVNTX05BTUUsIE5VTEwp
OwotIGdfdWRldl9jbGllbnRfaW5pdF9mYWlsZWQ6Ci0gICAgcmV0dXJuIEZBTFNFOwotfQotCi1z
dGF0aWMgdm9pZCBnX3VkZXZfY2xpZW50X2luaXRhYmxlX2lmYWNlX2luaXQoR0luaXRhYmxlSWZh
Y2UgKmlmYWNlKQotewotICAgIGlmYWNlLT5pbml0ID0gZ191ZGV2X2NsaWVudF9pbml0YWJsZV9p
bml0OwotfQotCi1zdGF0aWMgdm9pZCByZXBvcnRfb25lX2RldmljZShncG9pbnRlciBkYXRhLCBn
cG9pbnRlciBzZWxmKQotewotICAgIGdfc2lnbmFsX2VtaXQoc2VsZiwgc2lnbmFsc1tVRVZFTlRf
U0lHTkFMXSwgMCwgZGF0YSwgVFJVRSk7Ci19Ci0KLXZvaWQgZ191ZGV2X2NsaWVudF9yZXBvcnRf
ZGV2aWNlcyhHVWRldkNsaWVudCAqc2VsZikKLXsKLSAgICBnX2xpc3RfZm9yZWFjaChzZWxmLT5w
cml2LT51ZGV2X2xpc3QsIHJlcG9ydF9vbmVfZGV2aWNlLCBzZWxmKTsKLX0KLQotc3RhdGljIHZv
aWQgZ191ZGV2X2NsaWVudF9pbml0KEdVZGV2Q2xpZW50ICpzZWxmKQotewotICAgIHNlbGYtPnBy
aXYgPSBnX3VkZXZfY2xpZW50X2dldF9pbnN0YW5jZV9wcml2YXRlKHNlbGYpOwotfQotCi1zdGF0
aWMgdm9pZCBnX3VkZXZfY2xpZW50X2ZpbmFsaXplKEdPYmplY3QgKmdvYmplY3QpCi17Ci0gICAg
R1VkZXZDbGllbnQgKnNlbGYgPSBHX1VERVZfQ0xJRU5UKGdvYmplY3QpOwotICAgIEdVZGV2Q2xp
ZW50UHJpdmF0ZSAqcHJpdiA9IHNlbGYtPnByaXY7Ci0KLSAgICBzaW5nbGV0b24gPSBOVUxMOwot
ICAgIERlc3Ryb3lXaW5kb3cocHJpdi0+aHduZCk7Ci0gICAgVW5yZWdpc3RlckNsYXNzKEdfVURF
Vl9DTElFTlRfV0lOQ0xBU1NfTkFNRSwgTlVMTCk7Ci0gICAgZ191ZGV2X2NsaWVudF9mcmVlX2Rl
dmljZV9saXN0KCZwcml2LT51ZGV2X2xpc3QpOwotCi0gICAgLyogZnJlZSBiYWNrZW5kIGNvbnRl
eHQgKi8KLSAgICBnX3dhcm5faWZfZmFpbChwcml2LT5jdHggIT0gTlVMTCk7Ci0gICAgc3BpY2Vf
dXNiX2JhY2tlbmRfZGVsZXRlKHByaXYtPmN0eCk7Ci0KLSAgICAvKiBDaGFpbiB1cCB0byB0aGUg
cGFyZW50IGNsYXNzICovCi0gICAgaWYgKEdfT0JKRUNUX0NMQVNTKGdfdWRldl9jbGllbnRfcGFy
ZW50X2NsYXNzKS0+ZmluYWxpemUpCi0gICAgICAgIEdfT0JKRUNUX0NMQVNTKGdfdWRldl9jbGll
bnRfcGFyZW50X2NsYXNzKS0+ZmluYWxpemUoZ29iamVjdCk7Ci19Ci0KLXN0YXRpYyB2b2lkIGdf
dWRldl9jbGllbnRfZ2V0X3Byb3BlcnR5KEdPYmplY3QgICAgICpnb2JqZWN0LAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3VpbnQgICAgICAgIHByb3BfaWQsCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHVmFsdWUgICAgICAqdmFsdWUsCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHUGFyYW1TcGVjICAqcHNwZWMp
Ci17Ci0gICAgR1VkZXZDbGllbnQgKnNlbGYgPSBHX1VERVZfQ0xJRU5UKGdvYmplY3QpOwotICAg
IEdVZGV2Q2xpZW50UHJpdmF0ZSAqcHJpdiA9IHNlbGYtPnByaXY7Ci0KLSAgICBzd2l0Y2ggKHBy
b3BfaWQpIHsKLSAgICBjYXNlIFBST1BfUkVESVJFQ1RJTkc6Ci0gICAgICAgIGdfdmFsdWVfc2V0
X2Jvb2xlYW4odmFsdWUsIHByaXYtPnJlZGlyZWN0aW5nKTsKLSAgICAgICAgYnJlYWs7Ci0gICAg
ZGVmYXVsdDoKLSAgICAgICAgR19PQkpFQ1RfV0FSTl9JTlZBTElEX1BST1BFUlRZX0lEKGdvYmpl
Y3QsIHByb3BfaWQsIHBzcGVjKTsKLSAgICAgICAgYnJlYWs7Ci0gICAgfQotfQotCi1zdGF0aWMg
dm9pZCBoYW5kbGVfZGV2X2NoYW5nZShHVWRldkNsaWVudCAqc2VsZik7Ci0KLXN0YXRpYyB2b2lk
IGdfdWRldl9jbGllbnRfc2V0X3Byb3BlcnR5KEdPYmplY3QgICAgICAgKmdvYmplY3QsCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBndWludCAgICAgICAgICBwcm9wX2lk
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgR1ZhbHVlICAq
dmFsdWUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHUGFyYW1TcGVj
ICAgICpwc3BlYykKLXsKLSAgICBHVWRldkNsaWVudCAqc2VsZiA9IEdfVURFVl9DTElFTlQoZ29i
amVjdCk7Ci0gICAgR1VkZXZDbGllbnRQcml2YXRlICpwcml2ID0gc2VsZi0+cHJpdjsKLSAgICBn
Ym9vbGVhbiBvbGRfdmFsOwotCi0gICAgc3dpdGNoIChwcm9wX2lkKSB7Ci0gICAgY2FzZSBQUk9Q
X1JFRElSRUNUSU5HOgotICAgICAgICBvbGRfdmFsID0gcHJpdi0+cmVkaXJlY3Rpbmc7Ci0gICAg
ICAgIHByaXYtPnJlZGlyZWN0aW5nID0gZ192YWx1ZV9nZXRfYm9vbGVhbih2YWx1ZSk7Ci0gICAg
ICAgIGlmIChvbGRfdmFsICYmICFwcml2LT5yZWRpcmVjdGluZykgewotICAgICAgICAgICAgLyog
VGhpcyBpcyBhIHJlZGlyZWN0aW9uIGNvbXBsZXRpb24gY2FzZS4KLSAgICAgICAgICAgICAgIElu
amVjdCBob3RwbHVnIGV2ZW50IGluIGNhc2Ugd2UgbWlzc2VkIGRldmljZSBjaGFuZ2VzCi0gICAg
ICAgICAgICAgICBkdXJpbmcgcmVkaXJlY3Rpb24gcHJvY2Vzc2luZy4gKi8KLSAgICAgICAgICAg
IGhhbmRsZV9kZXZfY2hhbmdlKHNlbGYpOwotICAgICAgICB9Ci0gICAgICAgIGJyZWFrOwotICAg
IGRlZmF1bHQ6Ci0gICAgICAgIEdfT0JKRUNUX1dBUk5fSU5WQUxJRF9QUk9QRVJUWV9JRChnb2Jq
ZWN0LCBwcm9wX2lkLCBwc3BlYyk7Ci0gICAgICAgIGJyZWFrOwotICAgIH0KLX0KLQotc3RhdGlj
IHZvaWQgZ191ZGV2X2NsaWVudF9jbGFzc19pbml0KEdVZGV2Q2xpZW50Q2xhc3MgKmtsYXNzKQot
ewotICAgIEdPYmplY3RDbGFzcyAqZ29iamVjdF9jbGFzcyA9IEdfT0JKRUNUX0NMQVNTKGtsYXNz
KTsKLSAgICBHUGFyYW1TcGVjICpwc3BlYzsKLQotICAgIGdvYmplY3RfY2xhc3MtPmZpbmFsaXpl
ID0gZ191ZGV2X2NsaWVudF9maW5hbGl6ZTsKLSAgICBnb2JqZWN0X2NsYXNzLT5nZXRfcHJvcGVy
dHkgPSBnX3VkZXZfY2xpZW50X2dldF9wcm9wZXJ0eTsKLSAgICBnb2JqZWN0X2NsYXNzLT5zZXRf
cHJvcGVydHkgPSBnX3VkZXZfY2xpZW50X3NldF9wcm9wZXJ0eTsKLQotICAgIHNpZ25hbHNbVUVW
RU5UX1NJR05BTF0gPQotICAgICAgICBnX3NpZ25hbF9uZXcoInVldmVudCIsCi0gICAgICAgICAg
ICAgICAgICAgICBHX09CSkVDVF9DTEFTU19UWVBFKGtsYXNzKSwKLSAgICAgICAgICAgICAgICAg
ICAgIEdfU0lHTkFMX1JVTl9GSVJTVCwKLSAgICAgICAgICAgICAgICAgICAgIEdfU1RSVUNUX09G
RlNFVChHVWRldkNsaWVudENsYXNzLCB1ZXZlbnQpLAotICAgICAgICAgICAgICAgICAgICAgTlVM
TCwgTlVMTCwKLSAgICAgICAgICAgICAgICAgICAgIGdfY2Nsb3N1cmVfdXNlcl9tYXJzaGFsX1ZP
SURfX1BPSU5URVJfQk9PTEVBTiwKLSAgICAgICAgICAgICAgICAgICAgIEdfVFlQRV9OT05FLAot
ICAgICAgICAgICAgICAgICAgICAgMiwKLSAgICAgICAgICAgICAgICAgICAgIEdfVFlQRV9QT0lO
VEVSLAotICAgICAgICAgICAgICAgICAgICAgR19UWVBFX0JPT0xFQU4pOwotCi0gICAgLyoqCi0g
ICAgKiBHVWRldkNsaWVudDo6cmVkaXJlY3Rpbmc6Ci0gICAgKgotICAgICogVGhpcyBwcm9wZXJ0
eSBpbmRpY2F0ZXMgd2hlbiBhIHJlZGlyZWN0aW9uIG9wZXJhdGlvbgotICAgICogaXMgaW4gcHJv
Z3Jlc3Mgb24gYSBkZXZpY2UuIEl0J3Mgc2V0IGJhY2sgdG8gRkFMU0UKLSAgICAqIG9uY2UgdGhl
IGRldmljZSBpcyBmdWxseSByZWRpcmVjdGVkIHRvIHRoZSBndWVzdC4KLSAgICAqLwotICAgIHBz
cGVjID0gZ19wYXJhbV9zcGVjX2Jvb2xlYW4oInJlZGlyZWN0aW5nIiwgIlJlZGlyZWN0aW5nIiwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJVU0IgcmVkaXJlY3Rpb24gb3BlcmF0
aW9uIGlzIGluIHByb2dyZXNzIiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZB
TFNFLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR19QQVJBTV9SRUFEV1JJVEUg
fCBHX1BBUkFNX1NUQVRJQ19TVFJJTkdTKTsKLQotICAgIGdfb2JqZWN0X2NsYXNzX2luc3RhbGxf
cHJvcGVydHkoZ29iamVjdF9jbGFzcywgUFJPUF9SRURJUkVDVElORywgcHNwZWMpOwotfQotCi0v
KiBjb21wYXJpbmcgYnVzOmFkZHIgYW5kIHZpZDpwaWQgKi8KLXN0YXRpYyBnaW50IGNvbXBhcmVf
dXNiX2RldmljZXMoZ2NvbnN0cG9pbnRlciBhLCBnY29uc3Rwb2ludGVyIGIpCi17Ci0gICAgY29u
c3QgVXNiRGV2aWNlSW5mb3JtYXRpb24gKmFfaW5mbywgKmJfaW5mbzsKLSAgICBnYm9vbGVhbiBz
YW1lX2J1cywgc2FtZV9hZGRyLCBzYW1lX3ZpZCwgc2FtZV9waWQ7Ci0gICAgYV9pbmZvID0gc3Bp
Y2VfdXNiX2JhY2tlbmRfZGV2aWNlX2dldF9pbmZvKChTcGljZVVzYkJhY2tlbmREZXZpY2UgKilh
KTsKLSAgICBiX2luZm8gPSBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfZ2V0X2luZm8oKFNwaWNl
VXNiQmFja2VuZERldmljZSAqKWIpOwotCi0KLSAgICBzYW1lX2J1cyA9IChhX2luZm8tPmJ1cyA9
PSBiX2luZm8tPmJ1cyk7Ci0gICAgc2FtZV9hZGRyID0gKGFfaW5mby0+YWRkcmVzcyA9PSBiX2lu
Zm8tPmFkZHJlc3MpOwotICAgIHNhbWVfdmlkID0gKGFfaW5mby0+dmlkID09IGJfaW5mby0+dmlk
KTsKLSAgICBzYW1lX3BpZCA9IChhX2luZm8tPnBpZCA9PSBiX2luZm8tPnBpZCk7Ci0KLSAgICBy
ZXR1cm4gKHNhbWVfYnVzICYmIHNhbWVfYWRkciAmJiBzYW1lX3ZpZCAmJiBzYW1lX3BpZCkgPyAw
IDogLTE7Ci19Ci0KLXN0YXRpYyB2b2lkIHVwZGF0ZV9kZXZpY2VfbGlzdChHVWRldkNsaWVudCAq
c2VsZiwgR0xpc3QgKm5ld19kZXZpY2VfbGlzdCkKLXsKLSAgICBHTGlzdCAqZGV2OwotCi0gICAg
Zm9yIChkZXYgPSBnX2xpc3RfZmlyc3QobmV3X2RldmljZV9saXN0KTsgZGV2ICE9IE5VTEw7IGRl
diA9IGdfbGlzdF9uZXh0KGRldikpIHsKLSAgICAgICAgR0xpc3QgKmZvdW5kID0gZ19saXN0X2Zp
bmRfY3VzdG9tKHNlbGYtPnByaXYtPnVkZXZfbGlzdCwgZGV2LT5kYXRhLCBjb21wYXJlX3VzYl9k
ZXZpY2VzKTsKLSAgICAgICAgaWYgKGZvdW5kICE9IE5VTEwpIHsKLSAgICAgICAgICAgIC8qIGtl
ZXAgb2xkIGV4aXN0aW5nIGxpYnVzYl9kZXZpY2UgaW4gdGhlIG5ldyBsaXN0LCB3aGVuCi0gICAg
ICAgICAgICAgICB1c2ItZGV2LW1hbmFnZXIgd2lsbCBtYWludGFpbiBpdHMgb3duIGxpc3Qgb2Yg
bGlidXNiX2RldmljZSwKLSAgICAgICAgICAgICAgIHRoZXNlIGxpc3RzIHdpbGwgYmUgY29tcGxl
dGVseSBjb25zaXN0ZW50ICovCi0gICAgICAgICAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKnRl
bXAgPSBmb3VuZC0+ZGF0YTsKLSAgICAgICAgICAgIGZvdW5kLT5kYXRhID0gZGV2LT5kYXRhOwot
ICAgICAgICAgICAgZGV2LT5kYXRhID0gdGVtcDsKLSAgICAgICAgfQotICAgIH0KLQotICAgIGdf
dWRldl9jbGllbnRfZnJlZV9kZXZpY2VfbGlzdCgmc2VsZi0+cHJpdi0+dWRldl9saXN0KTsKLSAg
ICBzZWxmLT5wcml2LT51ZGV2X2xpc3QgPSBuZXdfZGV2aWNlX2xpc3Q7Ci19Ci0KLXN0YXRpYyB2
b2lkIG5vdGlmeV9kZXZfc3RhdGVfY2hhbmdlKEdVZGV2Q2xpZW50ICpzZWxmLAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgR0xpc3QgKm9sZF9saXN0LAotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgR0xpc3QgKm5ld19saXN0LAotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZ2Jvb2xlYW4gYWRkKQotewotICAgIEdMaXN0ICpkZXY7Ci0K
LSAgICBmb3IgKGRldiA9IGdfbGlzdF9maXJzdChvbGRfbGlzdCk7IGRldiAhPSBOVUxMOyBkZXYg
PSBnX2xpc3RfbmV4dChkZXYpKSB7Ci0gICAgICAgIEdMaXN0ICpmb3VuZCA9IGdfbGlzdF9maW5k
X2N1c3RvbShuZXdfbGlzdCwgZGV2LT5kYXRhLCBjb21wYXJlX3VzYl9kZXZpY2VzKTsKLSAgICAg
ICAgaWYgKGZvdW5kID09IE5VTEwpIHsKLSAgICAgICAgICAgIGdfdWRldl9kZXZpY2VfcHJpbnQo
ZGV2LT5kYXRhLCBhZGQgPyAiYWRkIiA6ICJyZW1vdmUiKTsKLSAgICAgICAgICAgIGdfc2lnbmFs
X2VtaXQoc2VsZiwgc2lnbmFsc1tVRVZFTlRfU0lHTkFMXSwgMCwgZGV2LT5kYXRhLCBhZGQpOwot
ICAgICAgICB9Ci0gICAgfQotfQotCi1zdGF0aWMgdm9pZCBoYW5kbGVfZGV2X2NoYW5nZShHVWRl
dkNsaWVudCAqc2VsZikKLXsKLSAgICBHVWRldkNsaWVudFByaXZhdGUgKnByaXYgPSBzZWxmLT5w
cml2OwotICAgIEdFcnJvciAqZXJyID0gTlVMTDsKLSAgICBHTGlzdCAqbm93X2RldnMgPSBOVUxM
OwotCi0gICAgaWYgKHByaXYtPnJlZGlyZWN0aW5nID09IFRSVUUpIHsKLSAgICAgICAgLyogT24g
V2luZG93cywgcXVlcnlpbmcgVVNCIGRldmljZSBsaXN0IG1heSByZXR1cm4gaW5jb25zaXN0ZW50
IHJlc3VsdHMKLSAgICAgICAgICAgaWYgcGVyZm9ybWVkIGluIHBhcmFsbGVsIHRvIHJlZGlyZWN0
aW9uIGZsb3cuCi0gICAgICAgICAgIEEgc2ltdWxhdGVkIGhvdHBsdWcgZXZlbnQgd2lsbCBiZSBp
bmplY3RlZCBhZnRlciByZWRpcmVjdGlvbgotICAgICAgICAgICBjb21wbGV0aW9uIGluIG9yZGVy
IHRvIHByb2Nlc3MgcmVhbCBkZXZpY2UgbGlzdCBjaGFuZ2VzIHRoYXQgbWF5Ci0gICAgICAgICAg
IGhhZCB0YWtlbiBwbGFjZSBkdXJpbmcgcmVkaXJlY3Rpb24gcHJvY2Vzcy4gKi8KLSAgICAgICAg
cmV0dXJuOwotICAgIH0KLQotICAgIGlmKGdfdWRldl9jbGllbnRfbGlzdF9kZXZpY2VzKHNlbGYs
ICZub3dfZGV2cywgJmVyciwgX19GVU5DVElPTl9fKSA8IDApIHsKLSAgICAgICAgZ193YXJuaW5n
KCJjb3VsZCBub3QgcmV0cmlldmUgZGV2aWNlIGxpc3QiKTsKLSAgICAgICAgcmV0dXJuOwotICAg
IH0KLQotICAgIGdfdWRldl9kZXZpY2VfcHJpbnRfbGlzdChub3dfZGV2cywgImhhbmRsZV9kZXZf
Y2hhbmdlOiBjdXJyZW50IGxpc3Q6Iik7Ci0gICAgZ191ZGV2X2RldmljZV9wcmludF9saXN0KHBy
aXYtPnVkZXZfbGlzdCwgImhhbmRsZV9kZXZfY2hhbmdlOiBwcmV2aW91cyBsaXN0OiIpOwotCi0g
ICAgLyogVW5yZWdpc3RlciBkZXZpY2VzIHRoYXQgYXJlIG5vdCBwcmVzZW50IGFueW1vcmUgKi8K
LSAgICBub3RpZnlfZGV2X3N0YXRlX2NoYW5nZShzZWxmLCBwcml2LT51ZGV2X2xpc3QsIG5vd19k
ZXZzLCBGQUxTRSk7Ci0KLSAgICAvKiBSZWdpc3RlciBuZXdseSBpbnNlcnRlZCBkZXZpY2VzICov
Ci0gICAgbm90aWZ5X2Rldl9zdGF0ZV9jaGFuZ2Uoc2VsZiwgbm93X2RldnMsIHByaXYtPnVkZXZf
bGlzdCwgVFJVRSk7Ci0KLSAgICAvKiBrZWVwIG1vc3QgcmVjZW50IGluZm86IGZyZWUgcHJldmlv
dXMgbGlzdCwgYW5kIGtlZXAgY3VycmVudCBsaXN0ICovCi0gICAgdXBkYXRlX2RldmljZV9saXN0
KHNlbGYsIG5vd19kZXZzKTsKLX0KLQotc3RhdGljIExSRVNVTFQgQ0FMTEJBQ0sgd25kX3Byb2Mo
SFdORCBod25kLCBVSU5UIG1lc3NhZ2UsIFdQQVJBTSB3cGFyYW0sIExQQVJBTSBscGFyYW0pCi17
Ci0gICAgLyogT25seSBEQlRfREVWTk9ERVNfQ0hBTkdFRCByZWNpZXZlZCAqLwotICAgIGlmICht
ZXNzYWdlID09IFdNX0RFVklDRUNIQU5HRSkgewotICAgICAgICBoYW5kbGVfZGV2X2NoYW5nZShz
aW5nbGV0b24pOwotICAgIH0KLSAgICByZXR1cm4gRGVmV2luZG93UHJvYyhod25kLCBtZXNzYWdl
LCB3cGFyYW0sIGxwYXJhbSk7Ci19Ci0KLSNpZmRlZiBERUJVR19HVURFVl9ERVZJQ0VfTElTVFMK
LXN0YXRpYyB2b2lkIGdfdWRldl9kZXZpY2VfcHJpbnRfbGlzdChHTGlzdCAqbCwgY29uc3QgZ2No
YXIgKm1zZykKLXsKLSAgICBHTGlzdCAqaXQ7Ci0KLSAgICBmb3IgKGl0ID0gZ19saXN0X2ZpcnN0
KGwpOyBpdCAhPSBOVUxMOyBpdD1nX2xpc3RfbmV4dChpdCkpIHsKLSAgICAgICAgZ191ZGV2X2Rl
dmljZV9wcmludChpdC0+ZGF0YSwgbXNnKTsKLSAgICB9Ci19Ci0jZW5kaWYKLQotc3RhdGljIHZv
aWQgZ191ZGV2X2RldmljZV9wcmludChTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldiwgY29uc3Qg
Z2NoYXIgKm1zZykKLXsKLSAgICBjb25zdCBVc2JEZXZpY2VJbmZvcm1hdGlvbiAqaW5mbyA9IHNw
aWNlX3VzYl9iYWNrZW5kX2RldmljZV9nZXRfaW5mbyhkZXYpOwotCi0gICAgU1BJQ0VfREVCVUco
IiVzOiAlZC4lZCAweCUwNHg6MHglMDR4IGNsYXNzICVkIiwgbXNnLAotICAgICAgICAgICAgICAg
IGluZm8tPmJ1cywgaW5mby0+YWRkcmVzcywKLSAgICAgICAgICAgICAgICBpbmZvLT52aWQsIGlu
Zm8tPnBpZCwgaW5mby0+Y2xhc3MpOwotfQpkaWZmIC0tZ2l0IGEvc3JjL3dpbi11c2ItZGV2Lmgg
Yi9zcmMvd2luLXVzYi1kZXYuaApkZWxldGVkIGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggZmRmZTcz
YS4uMDAwMDAwMAotLS0gYS9zcmMvd2luLXVzYi1kZXYuaAorKysgL2Rldi9udWxsCkBAIC0xLDg0
ICswLDAgQEAKLS8qIC0qLSBNb2RlOiBDOyBjLWJhc2ljLW9mZnNldDogNDsgaW5kZW50LXRhYnMt
bW9kZTogbmlsIC0qLSAqLwotLyoKLSAgIENvcHlyaWdodCAoQykgMjAxMiBSZWQgSGF0LCBJbmMu
Ci0KLSAgIFJlZCBIYXQgQXV0aG9yczoKLSAgIEFybm9uIEdpbGJvYSA8YWdpbGJvYUByZWRoYXQu
Y29tPgotICAgVXJpIEx1YmxpbiAgIDx1cmlsQHJlZGhhdC5jb20+Ci0KLSAgIFRoaXMgbGlicmFy
eSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IKLSAgIG1v
ZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMK
LSAgIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247
IGVpdGhlcgotICAgdmVyc2lvbiAyLjEgb2YgdGhlIExpY2Vuc2UsIG9yIChhdCB5b3VyIG9wdGlv
bikgYW55IGxhdGVyIHZlcnNpb24uCi0KLSAgIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBp
biB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAotICAgYnV0IFdJVEhPVVQgQU5ZIFdB
UlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKLSAgIE1FUkNIQU5U
QUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUgR05V
Ci0gICBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgotCi0g
ICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVy
YWwgUHVibGljCi0gICBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBsaWJyYXJ5OyBpZiBub3QsIHNl
ZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCi0qLwotI2lmbmRlZiBfX1dJTl9VU0Jf
REVWX0hfXwotI2RlZmluZSBfX1dJTl9VU0JfREVWX0hfXwotCi0jaW5jbHVkZSA8Z2lvL2dpby5o
PgotI2luY2x1ZGUgInVzYi1iYWNrZW5kLmgiCi0KLUdfQkVHSU5fREVDTFMKLQotLyogR1VkZXZD
bGllbnQgKi8KLQotI2RlZmluZSBHX1VERVZfVFlQRV9DTElFTlQgICAgICAgICAoZ191ZGV2X2Ns
aWVudF9nZXRfdHlwZSgpKQotI2RlZmluZSBHX1VERVZfQ0xJRU5UKG8pICAgICAgICAgICAoR19U
WVBFX0NIRUNLX0lOU1RBTkNFX0NBU1QoKG8pLCBHX1VERVZfVFlQRV9DTElFTlQsIEdVZGV2Q2xp
ZW50KSkKLSNkZWZpbmUgR19VREVWX0NMSUVOVF9DTEFTUyhrKSAgICAgKEdfVFlQRV9DSEVDS19D
TEFTU19DQVNUKChrKSwgR19VREVWX1RZUEVfQ0xJRU5ULCBHVWRldkNsaWVudENsYXNzKSkKLSNk
ZWZpbmUgR19VREVWX0lTX0NMSUVOVChvKSAgICAgICAgKEdfVFlQRV9DSEVDS19JTlNUQU5DRV9U
WVBFKChvKSwgR19VREVWX1RZUEVfQ0xJRU5UKSkKLSNkZWZpbmUgR19VREVWX0lTX0NMSUVOVF9D
TEFTUyhrKSAgKEdfVFlQRV9DSEVDS19DTEFTU19UWVBFKChrKSwgR19VREVWX1RZUEVfQ0xJRU5U
KSkKLSNkZWZpbmUgR19VREVWX0NMSUVOVF9HRVRfQ0xBU1MobykgKEdfVFlQRV9JTlNUQU5DRV9H
RVRfQ0xBU1MoKG8pLCBHX1VERVZfVFlQRV9DTElFTlQsIEdVZGV2Q2xpZW50Q2xhc3MpKQotCi10
eXBlZGVmIHN0cnVjdCBfR1VkZXZDbGllbnQgR1VkZXZDbGllbnQ7Ci10eXBlZGVmIHN0cnVjdCBf
R1VkZXZDbGllbnRDbGFzcyBHVWRldkNsaWVudENsYXNzOwotdHlwZWRlZiBzdHJ1Y3QgX0dVZGV2
Q2xpZW50UHJpdmF0ZSBHVWRldkNsaWVudFByaXZhdGU7Ci0KLXN0cnVjdCBfR1VkZXZDbGllbnQK
LXsKLSAgICBHT2JqZWN0IHBhcmVudDsKLQotICAgIEdVZGV2Q2xpZW50UHJpdmF0ZSAqcHJpdjsK
LX07Ci0KLXN0cnVjdCBfR1VkZXZDbGllbnRDbGFzcwotewotICAgIEdPYmplY3RDbGFzcyBwYXJl
bnRfY2xhc3M7Ci0KLSAgICAvKiBzaWduYWxzICovCi0gICAgdm9pZCAoKnVldmVudCkoR1VkZXZD
bGllbnQgKmNsaWVudCwgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXZpY2UsIGdib29sZWFuIGFk
ZCk7Ci19OwotCi1HVHlwZSBnX3VkZXZfY2xpZW50X2dldF90eXBlKHZvaWQpIEdfR05VQ19DT05T
VDsKLUdVZGV2Q2xpZW50ICpnX3VkZXZfY2xpZW50X25ldyh2b2lkKTsKLVNwaWNlVXNiQmFja2Vu
ZCAqZ191ZGV2X2NsaWVudF9nZXRfY29udGV4dChHVWRldkNsaWVudCAqY2xpZW50KTsKLXZvaWQg
Z191ZGV2X2NsaWVudF9yZXBvcnRfZGV2aWNlcyhHVWRldkNsaWVudCAqY2xpZW50KTsKLQotR1F1
YXJrIGdfdWRldl9jbGllbnRfZXJyb3JfcXVhcmsodm9pZCk7Ci0jZGVmaW5lIEdfVURFVl9DTElF
TlRfRVJST1IgZ191ZGV2X2NsaWVudF9lcnJvcl9xdWFyaygpCi0KLS8qKgotICogR1VkZXZDbGll
bnRFcnJvcjoKLSAqIEBHX1VERVZfQ0xJRU5UX0VSUk9SX0ZBSUxFRDogZ2VuZXJpYyBlcnJvciBj
b2RlCi0gKiBAR19VREVWX0NMSUVOVF9MSUJVU0JfRkFJTEVEOiBhIGxpYnVzYiBjYWxsIGZhaWxl
ZAotICogQEdfVURFVl9DTElFTlRfV0lOQVBJX0ZBSUxFRDogYSB3aW5hcGkgY2FsbCBmYWlsZWQK
LSAqCi0gKiBFcnJvciBjb2RlcyByZXR1cm5lZCBieSBzcGljZS1jbGllbnQgQVBJLgotICovCi10
eXBlZGVmIGVudW0KLXsKLSAgICBHX1VERVZfQ0xJRU5UX0VSUk9SX0ZBSUxFRCA9IDEsCi0gICAg
R19VREVWX0NMSUVOVF9MSUJVU0JfRkFJTEVELAotICAgIEdfVURFVl9DTElFTlRfV0lOQVBJX0ZB
SUxFRAotfSBHVWRldkNsaWVudEVycm9yOwotCi0KLUdfRU5EX0RFQ0xTCi0KLSNlbmRpZiAvKiBf
X1dJTl9VU0JfREVWX0hfXyAqLwotLSAKMi4xNy4xCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpTcGljZS1kZXZlbCBtYWlsaW5nIGxpc3QKU3BpY2UtZGV2
ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vc3BpY2UtZGV2ZWw=
