Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 0722955C8B
	for <lists+spice-devel@lfdr.de>; Wed, 26 Jun 2019 01:45:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8CD236E192;
	Tue, 25 Jun 2019 23:45:14 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail.codeweavers.com (mail.codeweavers.com [50.203.203.244])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E6D016E192
 for <spice-devel@lists.freedesktop.org>; Tue, 25 Jun 2019 23:45:13 +0000 (UTC)
Received: from 82-64-54-218.subs.proxad.net ([82.64.54.218] helo=amboise)
 by mail.codeweavers.com with esmtpsa (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.89) (envelope-from <fgouget@free.fr>) id 1hfv8C-0003NE-Cl
 for spice-devel@lists.freedesktop.org; Tue, 25 Jun 2019 18:45:45 -0500
Received: from fgouget by amboise with local (Exim 4.92)
 (envelope-from <fgouget@amboise.dolphin>) id 1hfv7e-00009n-R7
 for spice-devel@lists.freedesktop.org; Wed, 26 Jun 2019 01:45:11 +0200
Date: Wed, 26 Jun 2019 01:45:10 +0200 (CEST)
From: Francois Gouget <fgouget@codeweavers.com>
To: Spice devel <spice-devel@lists.freedesktop.org>
In-Reply-To: <9e4beeec69d6cb7be4e5c9d4b292f2761d5158e2.1561506197.git.fgouget@free.fr>
Message-ID: <676ca29f9fa725f7184de85be307160fc6f2d08b.1561506197.git.fgouget@free.fr>
References: <9e4beeec69d6cb7be4e5c9d4b292f2761d5158e2.1561506197.git.fgouget@free.fr>
User-Agent: Alpine 2.21 (DEB 202 2017-01-01)
MIME-Version: 1.0
X-Spam-Score: -103.7
X-Spam-Report: Spam detection software,
 running on the system "mail.codeweavers.com", 
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview: Each video and audio stream has its own lag: for video
 streams
 it is the decoding time and for audio ones buffering by the audio subsystem.
 The only way to keep them all in sync is to synchronize to t [...] 
 Content analysis details:   (-103.7 points, 5.0 required)
 pts rule name              description
 ---- ---------------------- --------------------------------------------------
 -100 USER_IN_WHITELIST      From: address is in the user's white-list
 -6.0 ALL_TRUSTED            Passed through trusted hosts only via SMTP
 0.0 TVD_RCVD_IP            Message was received from an IP address
 1.0 HEADER_FROM_DIFFERENT_DOMAINS From and EnvelopeFrom 2nd level
 mail domains are different
 1.0 FREEMAIL_FROM          Sender email is commonly abused enduser mail
 provider (fgouget[at]free.fr)
 0.2 FREEMAIL_FORGED_FROMDOMAIN 2nd level domains in From and
 EnvelopeFrom freemail headers are different
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; 
 d=codeweavers.com; s=6377696661; h=Content-Type:MIME-Version:References:
 Message-ID:In-Reply-To:Subject:To:From:Date:Sender:Reply-To:Cc:
 Content-Transfer-Encoding:Content-ID:Content-Description:Resent-Date:
 Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:
 List-Help:List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=ZFb10VWpH7xZ0ftvSDHNQY7ziHreE/qbpslQkT5+184=; b=Dwl/TcXA84hVk6ASqHni87m0w
 rihSwd80/4wOCgSbpIeUPIhgGqCTxqPpeHG1rZ1McahAs/2jP0ZNH5z+nK3bI9CH0YdrjA57ZmrCF
 1SgQbXw5GiIK9TVKXodBgIPpSSfDfhzQPDcIKxBl1CgArHyMoKZrESkD9AUI6VUp/ky+E=;
Subject: [Spice-devel] [client v3 5/6] spice-session: Keep track of the
 global streams lag
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RWFjaCB2aWRlbyBhbmQgYXVkaW8gc3RyZWFtIGhhcyBpdHMgb3duIGxhZzogZm9yIHZpZGVvIHN0
cmVhbXMgaXQgaXMKdGhlIGRlY29kaW5nIHRpbWUgYW5kIGZvciBhdWRpbyBvbmVzIGJ1ZmZlcmlu
ZyBieSB0aGUgYXVkaW8gc3Vic3lzdGVtLgpUaGUgb25seSB3YXkgdG8ga2VlcCB0aGVtIGFsbCBp
biBzeW5jIGlzIHRvIHN5bmNocm9uaXplIHRvIHRoZSBtb3N0CmxhZ2d5IHN0cmVhbS4KClNpZ25l
ZC1vZmYtYnk6IEZyYW5jb2lzIEdvdWdldCA8ZmdvdWdldEBjb2Rld2VhdmVycy5jb20+Ci0tLQog
c3JjL2NoYW5uZWwtZGlzcGxheS1nc3QuYyAgIHwgIDkgKysrKysrKysKIHNyYy9jaGFubmVsLWRp
c3BsYXktbWpwZWcuYyB8ICA2ICsrKysrKwogc3JjL2NoYW5uZWwtZGlzcGxheS1wcml2LmggIHwg
IDQgKysrKwogc3JjL2NoYW5uZWwtZGlzcGxheS5jICAgICAgIHwgMzMgKysrKysrKysrKysrKysr
KysrKysrKysrKysrLS0KIHNyYy9jaGFubmVsLWRpc3BsYXkuaCAgICAgICB8ICAyICsrCiBzcmMv
Y2hhbm5lbC1wbGF5YmFjay1wcml2LmggfCAgMyArKy0KIHNyYy9jaGFubmVsLXBsYXliYWNrLmMg
ICAgICB8IDIyICsrKysrKysrKysrKysrKystLS0KIHNyYy9zcGljZS1zZXNzaW9uLXByaXYuaCAg
ICB8ICA2ICsrKysrLQogc3JjL3NwaWNlLXNlc3Npb24uYyAgICAgICAgIHwgNDIgKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKystLQogOSBmaWxlcyBjaGFuZ2VkLCAxMTggaW5zZXJ0
aW9ucygrKSwgOSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9zcmMvY2hhbm5lbC1kaXNwbGF5
LWdzdC5jIGIvc3JjL2NoYW5uZWwtZGlzcGxheS1nc3QuYwppbmRleCAxMWQ3OGFmYy4uZTE5Y2Zh
NzMgMTAwNjQ0Ci0tLSBhL3NyYy9jaGFubmVsLWRpc3BsYXktZ3N0LmMKKysrIGIvc3JjL2NoYW5u
ZWwtZGlzcGxheS1nc3QuYwpAQCAtNDU0LDYgKzQ1NCwxNSBAQCBzaW5rX2V2ZW50X3Byb2JlKEdz
dFBhZCAqcGFkLCBHc3RQYWRQcm9iZUluZm8gKmluZm8sIGdwb2ludGVyIGRhdGEpCiAgICAgICAg
ICAgICAgICAgICAgZnJhbWUtPm1tX3RpbWUsIGZyYW1lLT5zaXplLCBmcmFtZS0+Y3JlYXRpb25f
dGltZSwgZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgZGVjb2Rlci0+ZGVjb2RpbmdfcXVl
dWUtPmxlbmd0aCwgZ3N0ZnJhbWUtPnF1ZXVlX2xlbik7CiAKKyAgICAgICAgICAgIC8qIEFuZCB0
aGUgYXZlcmFnZSBkZWNvZGluZyB0aW1lLiBPbmx5IHRha2UgaW50byBhY2NvdW50IGZyYW1lcwor
ICAgICAgICAgICAgICogdGhhdCB3ZXJlIG5vdCBkZWxheWVkIChzZWUgYWJvdmUpLCBvciB0aGF0
IHByb3ZlIHRoZSBjdXJyZW50CisgICAgICAgICAgICAgKiBhdmVyYWdlIGlzIGNsZWFybHkgb3Zl
cmVzdGltYXRlZC4KKyAgICAgICAgICAgICAqLworICAgICAgICAgICAgaWYgKGdzdGZyYW1lLT5x
dWV1ZV9sZW4gPCBNQVhfREVDT0RFRF9GUkFNRVMgfHwKKyAgICAgICAgICAgICAgICBkdXJhdGlv
biAvIDEwMDAgPCBkZWNvZGVyLT5iYXNlLmRlY29kaW5nX3RpbWUpIHsKKyAgICAgICAgICAgICAg
ICBkZWNvZGVyLT5iYXNlLmRlY29kaW5nX3RpbWUgPSAoZGVjb2Rlci0+YmFzZS5kZWNvZGluZ190
aW1lICogMTUgKyBkdXJhdGlvbiAvIDEwMDApIC8gMTY7CisgICAgICAgICAgICB9CisKICAgICAg
ICAgICAgIGlmICghZGVjb2Rlci0+YXBwc2luaykgewogICAgICAgICAgICAgICAgIC8qIFRoZSBz
aW5rIHdpbGwgZGlzcGxheSB0aGUgZnJhbWUgZGlyZWN0bHkgc28gdGhpcwogICAgICAgICAgICAg
ICAgICAqIFNwaWNlR3N0RnJhbWUgYW5kIHRob3NlIG9mIGFueSBkcm9wcGVkIGZyYW1lIGFyZSBu
byBsb25nZXIKZGlmZiAtLWdpdCBhL3NyYy9jaGFubmVsLWRpc3BsYXktbWpwZWcuYyBiL3NyYy9j
aGFubmVsLWRpc3BsYXktbWpwZWcuYwppbmRleCBiMDU4NDI0ZS4uMjBlMTBkOWIgMTAwNjQ0Ci0t
LSBhL3NyYy9jaGFubmVsLWRpc3BsYXktbWpwZWcuYworKysgYi9zcmMvY2hhbm5lbC1kaXNwbGF5
LW1qcGVnLmMKQEAgLTg2LDYgKzg2LDcgQEAgc3RhdGljIGdib29sZWFuIG1qcGVnX2RlY29kZXJf
ZGVjb2RlX2ZyYW1lKGdwb2ludGVyIHZpZGVvX2RlY29kZXIpCiAgICAgSkRJTUVOU0lPTiB3aWR0
aCwgaGVpZ2h0OwogICAgIHVpbnQ4X3QgKmRlc3Q7CiAgICAgdWludDhfdCAqbGluZXNbNF07Cisg
ICAgaW50NjRfdCBzdGFydCA9IGdfZ2V0X21vbm90b25pY190aW1lKCk7CiAKICAgICBqcGVnX3Jl
YWRfaGVhZGVyKCZkZWNvZGVyLT5tanBlZ19jaW5mbywgMSk7CiAgICAgd2lkdGggPSBkZWNvZGVy
LT5tanBlZ19jaW5mby5pbWFnZV93aWR0aDsKQEAgLTE1Niw2ICsxNTcsMTEgQEAgc3RhdGljIGdi
b29sZWFuIG1qcGVnX2RlY29kZXJfZGVjb2RlX2ZyYW1lKGdwb2ludGVyIHZpZGVvX2RlY29kZXIp
CiAgICAgfQogICAgIGpwZWdfZmluaXNoX2RlY29tcHJlc3MoJmRlY29kZXItPm1qcGVnX2NpbmZv
KTsKIAorICAgIHVpbnQzMl90IGR1cmF0aW9uID0gKGdfZ2V0X21vbm90b25pY190aW1lKCkgLSBz
dGFydCkgLyAxMDAwOworICAgIGRlY29kZXItPmJhc2UuZGVjb2RpbmdfdGltZSA9IGRlY29kZXIt
PmJhc2UuZGVjb2RpbmdfdGltZSA/CisgICAgICAgIChkZWNvZGVyLT5iYXNlLmRlY29kaW5nX3Rp
bWUgKiAxNSArIGR1cmF0aW9uKSAvIDE2IDoKKyAgICAgICAgZHVyYXRpb247CisKICAgICAvKiBE
aXNwbGF5IHRoZSBmcmFtZSBhbmQgZGlzcG9zZSBvZiBpdCAqLwogICAgIHN0cmVhbV9kaXNwbGF5
X2ZyYW1lKGRlY29kZXItPmJhc2Uuc3RyZWFtLCBkZWNvZGVyLT5jdXJfZnJhbWUsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgd2lkdGgsIGhlaWdodCwgU1BJQ0VfVU5LTk9XTl9TVFJJREUsIGRl
Y29kZXItPm91dF9mcmFtZSk7CmRpZmYgLS1naXQgYS9zcmMvY2hhbm5lbC1kaXNwbGF5LXByaXYu
aCBiL3NyYy9jaGFubmVsLWRpc3BsYXktcHJpdi5oCmluZGV4IGEwNTViMjAzLi5hZGRhZjY5ZSAx
MDA2NDQKLS0tIGEvc3JjL2NoYW5uZWwtZGlzcGxheS1wcml2LmgKKysrIGIvc3JjL2NoYW5uZWwt
ZGlzcGxheS1wcml2LmgKQEAgLTc2LDYgKzc2LDkgQEAgc3RydWN0IFZpZGVvRGVjb2RlciB7CiAK
ICAgICAvKiBUaGUgYXNzb2NpYXRlZCBkaXNwbGF5IHN0cmVhbS4gKi8KICAgICBkaXNwbGF5X3N0
cmVhbSAqc3RyZWFtOworCisgICAgLyogVGhlIGF2ZXJhZ2UgdGltZSBpdCB0YWtlcyB0byBkZWNv
ZGUgYSBmcmFtZS4gKi8KKyAgICBmbG9hdCBkZWNvZGluZ190aW1lOwogfTsKIAogCkBAIC0xMjIs
NiArMTI1LDcgQEAgc3RydWN0IGRpc3BsYXlfc3RyZWFtIHsKICAgICBpbnQgICAgICAgICAgICAg
ICAgICAgICAgICAgaGF2ZV9yZWdpb247CiAKICAgICBWaWRlb0RlY29kZXIgICAgICAgICAgICAg
ICAgKnZpZGVvX2RlY29kZXI7CisgICAgZ3VpbnQgICAgICAgICAgICAgICAgICAgICAgIGRlY29k
ZXJfbGFnOwogCiAgICAgU3BpY2VDaGFubmVsICAgICAgICAgICAgICAgICpjaGFubmVsOwogCmRp
ZmYgLS1naXQgYS9zcmMvY2hhbm5lbC1kaXNwbGF5LmMgYi9zcmMvY2hhbm5lbC1kaXNwbGF5LmMK
aW5kZXggMDAxZmJjNWMuLmM0ZWE2MzEyIDEwMDY0NAotLS0gYS9zcmMvY2hhbm5lbC1kaXNwbGF5
LmMKKysrIGIvc3JjL2NoYW5uZWwtZGlzcGxheS5jCkBAIC0xNDExLDYgKzE0MTEsMjcgQEAgdm9p
ZCBzdHJlYW1fZGlzcGxheV9mcmFtZShkaXNwbGF5X3N0cmVhbSAqc3QsIFNwaWNlRnJhbWUgKmZy
YW1lLAogICAgIH0KIH0KIAorR19HTlVDX0lOVEVSTkFMCitndWludDMyIHNwaWNlX2Rpc3BsYXlf
Y2hhbm5lbF9nZXRfbGFnKFNwaWNlRGlzcGxheUNoYW5uZWwgKmNoYW5uZWwpCit7CisgICAgU3Bp
Y2VEaXNwbGF5Q2hhbm5lbFByaXZhdGUgKmMgPSBTUElDRV9ESVNQTEFZX0NIQU5ORUwoY2hhbm5l
bCktPnByaXY7CisgICAgaW50IGk7CisgICAgZ3VpbnQgbGFnOworCisgICAgbGFnID0gMDsKKyAg
ICBpZiAoYy0+c3RyZWFtcykgeworICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYy0+bnN0cmVhbXM7
IGkrKykgeworICAgICAgICAgICAgZGlzcGxheV9zdHJlYW0gKnN0ID0gYy0+c3RyZWFtc1tpXTsK
KyAgICAgICAgICAgIGlmIChzdCAhPSBOVUxMICYmIHN0LT52aWRlb19kZWNvZGVyKSB7CisgICAg
ICAgICAgICAgICAgc3QtPmRlY29kZXJfbGFnID0gc3QtPnZpZGVvX2RlY29kZXItPmRlY29kaW5n
X3RpbWU7CisgICAgICAgICAgICAgICAgbGFnID0gTUFYKGxhZywgc3QtPmRlY29kZXJfbGFnKTsK
KyAgICAgICAgICAgIH0KKyAgICAgICAgfQorICAgIH0KKworICAgIHJldHVybiBsYWc7Cit9CisK
IEdfR05VQ19JTlRFUk5BTAogZ2Jvb2xlYW4gaGFuZF9waXBlbGluZV90b193aWRnZXQoZGlzcGxh
eV9zdHJlYW0gKnN0LCBHc3RQaXBlbGluZSAqcGlwZWxpbmUpCiB7CkBAIC0xNDY3LDcgKzE0ODgs
NyBAQCBzdGF0aWMgdm9pZCBkaXNwbGF5X3VwZGF0ZV9zdHJlYW1fcmVwb3J0KFNwaWNlRGlzcGxh
eUNoYW5uZWwgKmNoYW5uZWwsIHVpbnQzMl90CiAgICAgICAgIHJlcG9ydC5udW1fZHJvcHMgPSBz
dC0+IHJlcG9ydF9udW1fZHJvcHM7CiAgICAgICAgIHJlcG9ydC5sYXN0X2ZyYW1lX2RlbGF5ID0g
bWFyZ2luOwogICAgICAgICBpZiAoc3BpY2Vfc2Vzc2lvbl9pc19wbGF5YmFja19hY3RpdmUoc2Vz
c2lvbikpIHsKLSAgICAgICAgICAgIHJlcG9ydC5hdWRpb19kZWxheSA9IHNwaWNlX3Nlc3Npb25f
Z2V0X3BsYXliYWNrX2xhdGVuY3koc2Vzc2lvbik7CisgICAgICAgICAgICByZXBvcnQuYXVkaW9f
ZGVsYXkgPSBzcGljZV9zZXNzaW9uX2dldF9wbGF5YmFja19sYWcoc2Vzc2lvbik7CiAgICAgICAg
IH0gZWxzZSB7CiAgICAgICAgICAgICByZXBvcnQuYXVkaW9fZGVsYXkgPSBVSU5UX01BWDsKICAg
ICAgICAgfQpAQCAtMTY4Niw3ICsxNzA3LDcgQEAgc3RhdGljIHZvaWQgZGlzcGxheV9oYW5kbGVf
c3RyZWFtX2RhdGEoU3BpY2VDaGFubmVsICpjaGFubmVsLCBTcGljZU1zZ0luICppbikKICAgICAv
KiBDb21wdXRlIHRoZSBsb2NhbCBmcmFtZSBtbXRpbWUgKi8KICAgICBzdHJlYW1fdGltZSA9IHN0
cmVhbV9nZXRfdGltZShzdCk7CiAgICAgZnJhbWVfdGltZSA9IHNwaWNlX3Nlc3Npb25fbW10aW1l
MmNsaWVudF90aW1lKHNlc3Npb24sIG9wLT5tdWx0aV9tZWRpYV90aW1lKTsKLSAgICBndWludDMy
IHRhcmdldF9sYWcgPSBzcGljZV9zZXNzaW9uX2dldF9wbGF5YmFja19sYXRlbmN5KHNlc3Npb24p
OworICAgIGd1aW50MzIgdGFyZ2V0X2xhZyA9IHNwaWNlX3Nlc3Npb25fZ2V0X2xhZyhzZXNzaW9u
KTsKICAgICBpZiAoc3QtPmxhc3RfZnJhbWVfdGltZSA9PSAwKSB7CiAgICAgICAgIG1hcmdpbiA9
IHNwaWNlX21tdGltZV9kaWZmKGZyYW1lX3RpbWUsIHN0cmVhbV90aW1lKTsKICAgICAgICAgc3Qt
PmRlbGF5ID0gTUFYKHRhcmdldF9sYWcgLSBtYXJnaW4sIElOSVRJQUxfREVMQVkpOwpAQCAtMTc5
NSw2ICsxODE2LDE0IEBAIHN0YXRpYyB2b2lkIGRpc3BsYXlfaGFuZGxlX3N0cmVhbV9kYXRhKFNw
aWNlQ2hhbm5lbCAqY2hhbm5lbCwgU3BpY2VNc2dJbiAqaW4pCiAgICAgICAgIHJldHVybjsKICAg
ICB9CiAKKyAgICBpZiAoc3QtPnZpZGVvX2RlY29kZXItPmRlY29kaW5nX3RpbWUgIT0gMCAmJgor
ICAgICAgICAoc3QtPmRlY29kZXJfbGFnID09IDAgfHwKKyAgICAgICAgIHNwaWNlX3Nlc3Npb25f
bGFnX25lZWRzX3VwZGF0ZShzdC0+ZGVjb2Rlcl9sYWcsIHN0LT52aWRlb19kZWNvZGVyLT5kZWNv
ZGluZ190aW1lKSkpIHsKKyAgICAgICAgU3BpY2VTZXNzaW9uICpzZXNzaW9uID0gc3BpY2VfY2hh
bm5lbF9nZXRfc2Vzc2lvbihTUElDRV9DSEFOTkVMKGNoYW5uZWwpKTsKKyAgICAgICAgLyogRklY
TUUgVGhpcyBtYXkgYmUgdGhlIHdyb25nIGNvbnRleHQgZm9yIHRoaXMgY2FsbCAqLworICAgICAg
ICBzcGljZV9zZXNzaW9uX3VwZGF0ZV9sYWcoc2Vzc2lvbiwgc3QtPnZpZGVvX2RlY29kZXItPmRl
Y29kaW5nX3RpbWUpOworICAgIH0KKwogICAgIGlmIChjLT5lbmFibGVfYWRhcHRpdmVfc3RyZWFt
aW5nKSB7CiAgICAgICAgIGRpc3BsYXlfdXBkYXRlX3N0cmVhbV9yZXBvcnQoU1BJQ0VfRElTUExB
WV9DSEFOTkVMKGNoYW5uZWwpLCBvcC0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgb3AtPm11bHRpX21lZGlhX3RpbWUsIG1tdGltZV9tYXJnaW4pOwpkaWZmIC0tZ2l0
IGEvc3JjL2NoYW5uZWwtZGlzcGxheS5oIGIvc3JjL2NoYW5uZWwtZGlzcGxheS5oCmluZGV4IDVi
NDhkMmZmLi41N2U1ZTNkZCAxMDA2NDQKLS0tIGEvc3JjL2NoYW5uZWwtZGlzcGxheS5oCisrKyBi
L3NyYy9jaGFubmVsLWRpc3BsYXkuaApAQCAtMTU3LDYgKzE1Nyw4IEBAIHZvaWQgICAgICAgICAg
ICBzcGljZV9nbF9zY2Fub3V0X2ZyZWUgICAgICAgICAoU3BpY2VHbFNjYW5vdXQgKnNjYW5vdXQp
OwogY29uc3QgU3BpY2VHbFNjYW5vdXQqIHNwaWNlX2Rpc3BsYXlfY2hhbm5lbF9nZXRfZ2xfc2Nh
bm91dChTcGljZURpc3BsYXlDaGFubmVsICpjaGFubmVsKTsKIHZvaWQgc3BpY2VfZGlzcGxheV9j
aGFubmVsX2dsX2RyYXdfZG9uZShTcGljZURpc3BsYXlDaGFubmVsICpjaGFubmVsKTsKIAorZ3Vp
bnQzMiBzcGljZV9kaXNwbGF5X2NoYW5uZWxfZ2V0X2xhZyhTcGljZURpc3BsYXlDaGFubmVsICpj
aGFubmVsKTsKKwogI2lmbmRlZiBTUElDRV9ESVNBQkxFX0RFUFJFQ0FURUQKIEdfREVQUkVDQVRF
RF9GT1Ioc3BpY2VfZGlzcGxheV9jaGFubmVsX2NoYW5nZV9wcmVmZXJyZWRfY29tcHJlc3Npb24p
CiB2b2lkIHNwaWNlX2Rpc3BsYXlfY2hhbmdlX3ByZWZlcnJlZF9jb21wcmVzc2lvbihTcGljZUNo
YW5uZWwgKmNoYW5uZWwsIGdpbnQgY29tcHJlc3Npb24pOwpkaWZmIC0tZ2l0IGEvc3JjL2NoYW5u
ZWwtcGxheWJhY2stcHJpdi5oIGIvc3JjL2NoYW5uZWwtcGxheWJhY2stcHJpdi5oCmluZGV4IGRj
ODllMmQ4Li43ZjBlYzMzYyAxMDA2NDQKLS0tIGEvc3JjL2NoYW5uZWwtcGxheWJhY2stcHJpdi5o
CisrKyBiL3NyYy9jaGFubmVsLXBsYXliYWNrLXByaXYuaApAQCAtMTksNSArMTksNiBAQAogI2Rl
ZmluZSBfX1NQSUNFX0NMSUVOVF9QTEFZQkFDS19DSEFOTkVMX1BSSVZfSF9fCiAKIGdib29sZWFu
IHNwaWNlX3BsYXliYWNrX2NoYW5uZWxfaXNfYWN0aXZlKFNwaWNlUGxheWJhY2tDaGFubmVsICpj
aGFubmVsKTsKLWd1aW50MzIgc3BpY2VfcGxheWJhY2tfY2hhbm5lbF9nZXRfbGF0ZW5jeShTcGlj
ZVBsYXliYWNrQ2hhbm5lbCAqY2hhbm5lbCk7CitndWludDMyIHNwaWNlX3BsYXliYWNrX2NoYW5u
ZWxfZ2V0X2xhZyhTcGljZVBsYXliYWNrQ2hhbm5lbCAqY2hhbm5lbCk7Cit2b2lkIHNwaWNlX3Bs
YXliYWNrX2NoYW5uZWxfdXBkYXRlX2xhZyhTcGljZVBsYXliYWNrQ2hhbm5lbCAqY2hhbm5lbCwg
Z3VpbnQzMiBsYWcpOwogI2VuZGlmCmRpZmYgLS1naXQgYS9zcmMvY2hhbm5lbC1wbGF5YmFjay5j
IGIvc3JjL2NoYW5uZWwtcGxheWJhY2suYwppbmRleCAwZTQzOWVmZi4uMDYxZjA3MWUgMTAwNjQ0
Ci0tLSBhL3NyYy9jaGFubmVsLXBsYXliYWNrLmMKKysrIGIvc3JjL2NoYW5uZWwtcGxheWJhY2su
YwpAQCAtNDU3LDI1ICs0NTcsMzAgQEAgc3RhdGljIHZvaWQgY2hhbm5lbF9zZXRfaGFuZGxlcnMo
U3BpY2VDaGFubmVsQ2xhc3MgKmtsYXNzKQogICogQGNoYW5uZWw6IGEgI1NwaWNlUGxheWJhY2tD
aGFubmVsCiAgKiBAZGVsYXlfbXM6IHRoZSBkZWxheSBpbiBtcwogICoKLSAqIEFkanVzdCB0aGUg
bXVsdGltZWRpYSB0aW1lIGFjY29yZGluZyB0byB0aGUgZGVsYXkuCisgKiBBZGp1c3QgdGhlIG11
bHRpbWVkaWEgdGltZSBhbmQgZ2xvYmFsIGxhZyBhY2NvcmRpbmcgdG8gdGhlIGRlbGF5LgogICoq
Lwogdm9pZCBzcGljZV9wbGF5YmFja19jaGFubmVsX3NldF9kZWxheShTcGljZVBsYXliYWNrQ2hh
bm5lbCAqY2hhbm5lbCwgZ3VpbnQzMiBkZWxheV9tcykKIHsKICAgICBTcGljZVBsYXliYWNrQ2hh
bm5lbFByaXZhdGUgKmM7CiAgICAgU3BpY2VTZXNzaW9uICpzZXNzaW9uOworICAgIGd1aW50MzIg
b2xkX2xhdGVuY3k7CiAKICAgICBnX3JldHVybl9pZl9mYWlsKFNQSUNFX0lTX1BMQVlCQUNLX0NI
QU5ORUwoY2hhbm5lbCkpOwogCiAgICAgQ0hBTk5FTF9ERUJVRyhjaGFubmVsLCAicGxheWJhY2sg
c2V0X2RlbGF5ICV1IG1zIiwgZGVsYXlfbXMpOwogCiAgICAgYyA9IGNoYW5uZWwtPnByaXY7Cisg
ICAgb2xkX2xhdGVuY3kgPSBjLT5sYXRlbmN5OwogICAgIGMtPmxhdGVuY3kgPSBkZWxheV9tczsK
IAogICAgIHNlc3Npb24gPSBzcGljZV9jaGFubmVsX2dldF9zZXNzaW9uKFNQSUNFX0NIQU5ORUwo
Y2hhbm5lbCkpOwogICAgIGlmIChzZXNzaW9uKSB7CiAgICAgICAgIHNwaWNlX3Nlc3Npb25fc2V0
X21tX3RpbWUoc2Vzc2lvbiwgYy0+bGFzdF90aW1lIC0gZGVsYXlfbXMpOworICAgICAgICBpZiAo
c3BpY2Vfc2Vzc2lvbl9sYWdfbmVlZHNfdXBkYXRlKG9sZF9sYXRlbmN5LCBkZWxheV9tcykpIHsK
KyAgICAgICAgICAgIHNwaWNlX3Nlc3Npb25fdXBkYXRlX2xhZyhzZXNzaW9uLCBkZWxheV9tcyk7
CisgICAgICAgIH0KICAgICB9IGVsc2UgewotICAgICAgICBDSEFOTkVMX0RFQlVHKGNoYW5uZWws
ICJjaGFubmVsIGRldGFjaGVkIGZyb20gc2Vzc2lvbiwgbW0gdGltZSBza2lwcGVkIik7CisgICAg
ICAgIENIQU5ORUxfREVCVUcoY2hhbm5lbCwgImNoYW5uZWwgZGV0YWNoZWQgZnJvbSBzZXNzaW9u
LCBtbSB0aW1lICYgZ2xvYmFsIGxhZyBza2lwcGVkIik7CiAgICAgfQogfQogCkBAIC00ODcsNyAr
NDkyLDcgQEAgZ2Jvb2xlYW4gc3BpY2VfcGxheWJhY2tfY2hhbm5lbF9pc19hY3RpdmUoU3BpY2VQ
bGF5YmFja0NoYW5uZWwgKmNoYW5uZWwpCiB9CiAKIEdfR05VQ19JTlRFUk5BTAotZ3VpbnQzMiBz
cGljZV9wbGF5YmFja19jaGFubmVsX2dldF9sYXRlbmN5KFNwaWNlUGxheWJhY2tDaGFubmVsICpj
aGFubmVsKQorZ3VpbnQzMiBzcGljZV9wbGF5YmFja19jaGFubmVsX2dldF9sYWcoU3BpY2VQbGF5
YmFja0NoYW5uZWwgKmNoYW5uZWwpCiB7CiAgICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwoU1BJQ0Vf
SVNfUExBWUJBQ0tfQ0hBTk5FTChjaGFubmVsKSwgMCk7CiAgICAgaWYgKCFjaGFubmVsLT5wcml2
LT5pc19hY3RpdmUpIHsKQEAgLTQ5NSwzICs1MDAsMTQgQEAgZ3VpbnQzMiBzcGljZV9wbGF5YmFj
a19jaGFubmVsX2dldF9sYXRlbmN5KFNwaWNlUGxheWJhY2tDaGFubmVsICpjaGFubmVsKQogICAg
IH0KICAgICByZXR1cm4gY2hhbm5lbC0+cHJpdi0+bGF0ZW5jeTsKIH0KKworR19HTlVDX0lOVEVS
TkFMCit2b2lkIHNwaWNlX3BsYXliYWNrX2NoYW5uZWxfdXBkYXRlX2xhZyhTcGljZVBsYXliYWNr
Q2hhbm5lbCAqY2hhbm5lbCwgZ3VpbnQzMiBsYWcpCit7CisgICAgZ19yZXR1cm5faWZfZmFpbChT
UElDRV9JU19QTEFZQkFDS19DSEFOTkVMKGNoYW5uZWwpKTsKKyAgICBjaGFubmVsLT5wcml2LT5t
aW5fbGF0ZW5jeSA9IGxhZzsKKyAgICBpZiAoY2hhbm5lbC0+cHJpdi0+aXNfYWN0aXZlKSB7Cisg
ICAgICAgIFNQSUNFX0RFQlVHKCIlczogbm90aWZ5IGxhZyB1cGRhdGUgJXUiLCBfX0ZVTkNUSU9O
X18sIGNoYW5uZWwtPnByaXYtPm1pbl9sYXRlbmN5KTsKKyAgICAgICAgZ19jb3JvdXRpbmVfb2Jq
ZWN0X25vdGlmeShHX09CSkVDVChTUElDRV9DSEFOTkVMKGNoYW5uZWwpKSwgIm1pbi1sYXRlbmN5
Iik7CisgICAgfQorfQpkaWZmIC0tZ2l0IGEvc3JjL3NwaWNlLXNlc3Npb24tcHJpdi5oIGIvc3Jj
L3NwaWNlLXNlc3Npb24tcHJpdi5oCmluZGV4IGQwZDdiZThlLi5jNjgyNzc0MCAxMDA2NDQKLS0t
IGEvc3JjL3NwaWNlLXNlc3Npb24tcHJpdi5oCisrKyBiL3NyYy9zcGljZS1zZXNzaW9uLXByaXYu
aApAQCAtODUsNyArODUsMTEgQEAgU3BpY2VDaGFubmVsKiBzcGljZV9zZXNzaW9uX2xvb2t1cF9j
aGFubmVsKFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbiwgZ2ludCBpZCwgZ2ludAogdm9pZCBzcGljZV9z
ZXNzaW9uX3NldF91dWlkKFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbiwgZ3VpbnQ4IHV1aWRbMTZdKTsK
IHZvaWQgc3BpY2Vfc2Vzc2lvbl9zZXRfbmFtZShTcGljZVNlc3Npb24gKnNlc3Npb24sIGNvbnN0
IGdjaGFyICpuYW1lKTsKIGdib29sZWFuIHNwaWNlX3Nlc3Npb25faXNfcGxheWJhY2tfYWN0aXZl
KFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbik7Ci1ndWludDMyIHNwaWNlX3Nlc3Npb25fZ2V0X3BsYXli
YWNrX2xhdGVuY3koU3BpY2VTZXNzaW9uICpzZXNzaW9uKTsKK2d1aW50MzIgc3BpY2Vfc2Vzc2lv
bl9nZXRfcGxheWJhY2tfbGFnKFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbik7CisjZGVmaW5lIHNwaWNl
X3Nlc3Npb25fbGFnX25lZWRzX3VwZGF0ZShvbGRfbGFnLCBuZXdfbGFnKSBcCisgICAgKG9sZF9s
YWcgPT0gMCB8fCAobmV3X2xhZykgKyAxMCA8IChvbGRfbGFnKSB8fCAobmV3X2xhZykgPiAob2xk
X2xhZykgKyAxMCkKK2d1aW50MzIgc3BpY2Vfc2Vzc2lvbl9nZXRfbGFnKFNwaWNlU2Vzc2lvbiAq
c2Vzc2lvbik7Cit2b2lkIHNwaWNlX3Nlc3Npb25fdXBkYXRlX2xhZyhTcGljZVNlc3Npb24gKnNl
c3Npb24sIGd1aW50MzIgbGFnKTsKIGdib29sZWFuIHNwaWNlX3Nlc3Npb25fZ2V0X2F1ZGlvX2Vu
YWJsZWQoU3BpY2VTZXNzaW9uICpzZXNzaW9uKTsKIGdib29sZWFuIHNwaWNlX3Nlc3Npb25fZ2V0
X3NtYXJ0Y2FyZF9lbmFibGVkKFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbik7CiBnYm9vbGVhbiBzcGlj
ZV9zZXNzaW9uX2dldF91c2JyZWRpcl9lbmFibGVkKFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbik7CmRp
ZmYgLS1naXQgYS9zcmMvc3BpY2Utc2Vzc2lvbi5jIGIvc3JjL3NwaWNlLXNlc3Npb24uYwppbmRl
eCAwNGEyZGE5Ni4uNTRmYTI4M2EgMTAwNjQ0Ci0tLSBhL3NyYy9zcGljZS1zZXNzaW9uLmMKKysr
IGIvc3JjL3NwaWNlLXNlc3Npb24uYwpAQCAtMTAzLDYgKzEwMyw3IEBAIHN0cnVjdCBfU3BpY2VT
ZXNzaW9uUHJpdmF0ZSB7CiAgICAgZ2Jvb2xlYW4gICAgICAgICAgY2xpZW50X3Byb3ZpZGVkX3Nv
Y2tldHM7CiAgICAgZ3VpbnQ2NCAgICAgICAgICAgbW1fdGltZV9vZmZzZXQ7CiAgICAgZ3VpbnQz
MiAgICAgICAgICAgY2xpZW50X3RpbWVfb2Zmc2V0OworICAgIGd1aW50MzIgICAgICAgICAgIGxh
ZzsKICAgICBTcGljZVNlc3Npb24gICAgICAqbWlncmF0aW9uOwogICAgIEdMaXN0ICAgICAgICAg
ICAgICptaWdyYXRpb25fbGVmdDsKICAgICBTcGljZVNlc3Npb25NaWdyYXRpb24gbWlncmF0aW9u
X3N0YXRlOwpAQCAtMjY3Miw3ICsyNjczLDcgQEAgZ2Jvb2xlYW4gc3BpY2Vfc2Vzc2lvbl9pc19w
bGF5YmFja19hY3RpdmUoU3BpY2VTZXNzaW9uICpzZXNzaW9uKQogfQogCiBHX0dOVUNfSU5URVJO
QUwKLWd1aW50MzIgc3BpY2Vfc2Vzc2lvbl9nZXRfcGxheWJhY2tfbGF0ZW5jeShTcGljZVNlc3Np
b24gKnNlc3Npb24pCitndWludDMyIHNwaWNlX3Nlc3Npb25fZ2V0X3BsYXliYWNrX2xhZyhTcGlj
ZVNlc3Npb24gKnNlc3Npb24pCiB7CiAgICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwoU1BJQ0VfSVNf
U0VTU0lPTihzZXNzaW9uKSwgMCk7CiAKQEAgLTI2ODAsMTMgKzI2ODEsNTAgQEAgZ3VpbnQzMiBz
cGljZV9zZXNzaW9uX2dldF9wbGF5YmFja19sYXRlbmN5KFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbikK
IAogICAgIGlmIChzLT5wbGF5YmFja19jaGFubmVsICYmCiAgICAgICAgIHNwaWNlX3BsYXliYWNr
X2NoYW5uZWxfaXNfYWN0aXZlKHMtPnBsYXliYWNrX2NoYW5uZWwpKSB7Ci0gICAgICAgIHJldHVy
biBzcGljZV9wbGF5YmFja19jaGFubmVsX2dldF9sYXRlbmN5KHMtPnBsYXliYWNrX2NoYW5uZWwp
OworICAgICAgICByZXR1cm4gc3BpY2VfcGxheWJhY2tfY2hhbm5lbF9nZXRfbGFnKHMtPnBsYXli
YWNrX2NoYW5uZWwpOwogICAgIH0gZWxzZSB7CiAgICAgICAgIFNQSUNFX0RFQlVHKCIlczogbm90
IGltcGxlbWVudGVkIHdoZW4gdGhlcmUgaXNuJ3QgYXVkaW8gcGxheWJhY2siLCBfX0ZVTkNUSU9O
X18pOwogICAgICAgICByZXR1cm4gMDsKICAgICB9CiB9CiAKK0dfR05VQ19JTlRFUk5BTAorZ3Vp
bnQzMiBzcGljZV9zZXNzaW9uX2dldF9sYWcoU3BpY2VTZXNzaW9uICpzZXNzaW9uKQoreworICAg
IGdfcmV0dXJuX3ZhbF9pZl9mYWlsKFNQSUNFX0lTX1NFU1NJT04oc2Vzc2lvbiksIDApOworCisg
ICAgcmV0dXJuIHNlc3Npb24tPnByaXYtPmxhZzsKK30KKworR19HTlVDX0lOVEVSTkFMCit2b2lk
IHNwaWNlX3Nlc3Npb25fdXBkYXRlX2xhZyhTcGljZVNlc3Npb24gKnNlc3Npb24sIGd1aW50MzIg
bGFnKQoreworICAgIGdfcmV0dXJuX2lmX2ZhaWwoU1BJQ0VfSVNfU0VTU0lPTihzZXNzaW9uKSk7
CisgICAgU3BpY2VTZXNzaW9uUHJpdmF0ZSAqcyA9IHNlc3Npb24tPnByaXY7CisKKyAgICBpZiAo
c3BpY2Vfc2Vzc2lvbl9sYWdfbmVlZHNfdXBkYXRlKHMtPmxhZywgbGFnKSkgeworICAgICAgICBn
dWludDMyIG5ld19sYWcgPSAwOworICAgICAgICBmb3IgKEdMaXN0ICpsID0gcy0+Y2hhbm5lbHM7
IGwgIT0gTlVMTDsgKSB7CisgICAgICAgICAgICBTcGljZUNoYW5uZWwgKmNoYW5uZWwgPSBsLT5k
YXRhOworICAgICAgICAgICAgbCA9IGwtPm5leHQ7CisgICAgICAgICAgICBzd2l0Y2ggKHNwaWNl
X2NoYW5uZWxfZ2V0X2NoYW5uZWxfdHlwZShjaGFubmVsKSkgeworICAgICAgICAgICAgY2FzZSBT
UElDRV9DSEFOTkVMX0RJU1BMQVk6CisgICAgICAgICAgICAgICAgbmV3X2xhZyA9IE1BWChuZXdf
bGFnLCBzcGljZV9kaXNwbGF5X2NoYW5uZWxfZ2V0X2xhZyhTUElDRV9ESVNQTEFZX0NIQU5ORUwo
Y2hhbm5lbCkpKTsKKyAgICAgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICAgIGNhc2UgU1BJ
Q0VfQ0hBTk5FTF9QTEFZQkFDSzoKKyAgICAgICAgICAgICAgICBuZXdfbGFnID0gTUFYKG5ld19s
YWcsIHNwaWNlX3BsYXliYWNrX2NoYW5uZWxfZ2V0X2xhZyhTUElDRV9QTEFZQkFDS19DSEFOTkVM
KGNoYW5uZWwpKSk7CisgICAgICAgICAgICAgICAgYnJlYWs7CisgICAgICAgICAgICB9CisgICAg
ICAgIH0KKyAgICAgICAgaWYgKG5ld19sYWcgIT0gcy0+bGFnKSB7CisgICAgICAgICAgICBzLT5s
YWcgPSBuZXdfbGFnOworICAgICAgICAgICAgaWYgKHMtPnBsYXliYWNrX2NoYW5uZWwpIHsKKyAg
ICAgICAgICAgICAgICBzcGljZV9wbGF5YmFja19jaGFubmVsX3VwZGF0ZV9sYWcocy0+cGxheWJh
Y2tfY2hhbm5lbCwgcy0+bGFnKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfQorICAgIH0KK30K
Kwogc3RhdGljIGNvbnN0IGdjaGFyKiBzcGljZV9zZXNzaW9uX2dldF9zaGFyZWRfZGlyKFNwaWNl
U2Vzc2lvbiAqc2Vzc2lvbikKIHsKICAgICBnX3JldHVybl92YWxfaWZfZmFpbChTUElDRV9JU19T
RVNTSU9OKHNlc3Npb24pLCBOVUxMKTsKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KU3BpY2UtZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNl
LWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9y
Zy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
