Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 038A1AA4E1
	for <lists+spice-devel@lfdr.de>; Thu,  5 Sep 2019 15:43:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8B7306E0ED;
	Thu,  5 Sep 2019 13:43:21 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0D27A6E0F0
 for <spice-devel@lists.freedesktop.org>; Thu,  5 Sep 2019 13:43:20 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx06.intmail.prod.int.phx2.redhat.com
 [10.5.11.16])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id AE66782A7
 for <spice-devel@lists.freedesktop.org>; Thu,  5 Sep 2019 13:43:19 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.10])
 by smtp.corp.redhat.com (Postfix) with ESMTP id CD43B5C553;
 Thu,  5 Sep 2019 13:43:18 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Thu,  5 Sep 2019 14:42:39 +0100
Message-Id: <20190905134241.28873-17-fziglio@redhat.com>
In-Reply-To: <20190905134241.28873-1-fziglio@redhat.com>
References: <20190905134241.28873-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.16
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.38]); Thu, 05 Sep 2019 13:43:19 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-gtk v6 16/18] test-cd-emu: Test detach
 and reattach
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

TWFrZSBzdXJlIGRldmljZSBjYW4gYmUgZGV0YWNoZWQgYW5kIGF0dGFjaGVkIGFnYWluLgoKU2ln
bmVkLW9mZi1ieTogRnJlZGlhbm8gWmlnbGlvIDxmemlnbGlvQHJlZGhhdC5jb20+Ci0tLQogdGVz
dHMvY2QtZW11LmMgfCAxMDQgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKystLS0t
LS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDc1IGluc2VydGlvbnMoKyksIDI5IGRlbGV0aW9u
cygtKQoKZGlmZiAtLWdpdCBhL3Rlc3RzL2NkLWVtdS5jIGIvdGVzdHMvY2QtZW11LmMKaW5kZXgg
ZmQ5MWM0MTYuLmZiMDIzYTk5IDEwMDY0NAotLS0gYS90ZXN0cy9jZC1lbXUuYworKysgYi90ZXN0
cy9jZC1lbXUuYwpAQCAtMTI3LDYgKzEyNyw2NiBAQCBzdGF0aWMgdm9pZCBkZWNyZW1lbnRfYWxs
b2NhdGVkKGdwb2ludGVyIGRhdGEgR19HTlVDX1VOVVNFRCwgR09iamVjdCAqb2xkX2dvYmplYwog
ICAgICAgICBzcGljZV91c2JfYmFja2VuZF9yZWFkX2d1ZXN0X2RhdGEodXNiX2NoLCAodWludDhf
dCopZGF0YSwgR19OX0VMRU1FTlRTKGRhdGEpKTsgXAogICAgIH0gd2hpbGUoMCkKIAorc3RhdGlj
IHZvaWQKK2RldmljZV9pdGVyYXRpb24oY29uc3QgaW50IGxvb3AsIGNvbnN0IGJvb2wgYXR0YWNo
X29uX2Nvbm5lY3QpCit7CisgICAgR0Vycm9yICplcnIgPSBOVUxMOworICAgIHVuc2lnbmVkIGlu
dCBoZWxsb3NfZXhwZWN0ZWQsIG1lc3NhZ2VzX2V4cGVjdGVkOworCisgICAgaGVsbG9zX2V4cGVj
dGVkID0gaGVsbG9zX3NlbnQ7CisgICAgbWVzc2FnZXNfZXhwZWN0ZWQgPSBtZXNzYWdlc19zZW50
OworCisgICAgaWYgKGNoX3N0YXRlID09IFNQSUNFX0NIQU5ORUxfU1RBVEVfVU5DT05ORUNURUQp
IHsKKyAgICAgICAgY2hfc3RhdGUgPSBTUElDRV9DSEFOTkVMX1NUQVRFX0NPTk5FQ1RJTkc7Cisg
ICAgfQorICAgIGlmIChhdHRhY2hfb25fY29ubmVjdCkgeworICAgICAgICBnX2Fzc2VydF90cnVl
KHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfYXR0YWNoKHVzYl9jaCwgZGV2aWNlLCAmZXJyKSk7
CisgICAgICAgIGdfYXNzZXJ0X251bGwoZXJyKTsKKyAgICAgICAgaWYgKGNoX3N0YXRlID09IFNQ
SUNFX0NIQU5ORUxfU1RBVEVfUkVBRFkpIHsKKyAgICAgICAgICAgIGhlbGxvc19leHBlY3RlZCA9
IE1JTihoZWxsb3NfZXhwZWN0ZWQgKyAxLCAxKTsKKyAgICAgICAgICAgIG1lc3NhZ2VzX2V4cGVj
dGVkKys7CisgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICBnX2Fzc2VydF9jbXBpbnQobWVz
c2FnZXNfc2VudCwgPT0sIG1lc3NhZ2VzX2V4cGVjdGVkKTsKKyAgICAgICAgfQorICAgIH0KKyAg
ICBnX2Fzc2VydF9jbXBpbnQoaGVsbG9zX3NlbnQsID09LCBoZWxsb3NfZXhwZWN0ZWQpOworICAg
IGdfYXNzZXJ0X2NtcGludChtZXNzYWdlc19zZW50LCA+PSwgbWVzc2FnZXNfZXhwZWN0ZWQpOwor
CisgICAgLy8gdHJ5IHRvIGdldCBpbml0aWFsIGRhdGEKKyAgICBpZiAoY2hfc3RhdGUgPT0gU1BJ
Q0VfQ0hBTk5FTF9TVEFURV9DT05ORUNUSU5HKSB7CisgICAgICAgIGNoX3N0YXRlID0gU1BJQ0Vf
Q0hBTk5FTF9TVEFURV9SRUFEWTsKKyAgICAgICAgc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9m
bHVzaF93cml0ZXModXNiX2NoKTsKKyAgICAgICAgaGVsbG9zX2V4cGVjdGVkID0gTUlOKGhlbGxv
c19leHBlY3RlZCArIDEsIDEpOworICAgICAgICBtZXNzYWdlc19leHBlY3RlZCsrOworICAgIH0K
KworICAgIC8vIHdlIHNob3VsZCBnZXQgYW4gaGVsbG8gKG9ubHkgb25lISkKKyAgICBnX2Fzc2Vy
dF9jbXBpbnQoaGVsbG9zX3NlbnQsID09LCBoZWxsb3NfZXhwZWN0ZWQpOworICAgIGdfYXNzZXJ0
X2NtcGludChtZXNzYWdlc19zZW50LCA+PSwgbWVzc2FnZXNfZXhwZWN0ZWQpOworCisgICAgLy8g
c2VuZCBoZWxsbyByZXBseQorICAgIGlmIChsb29wID09IDApIHsKKyAgICAgICAgREFUQV9TVEFS
VAorICAgICAgICAgICAgMHgwMCwweDAwLDB4MDAsMHgwMCwweDQ0LDB4MDAsMHgwMCwweDAwLDB4
MDAsMHgwMCwweDAwLDB4MDAsIC8vMDAwIC4uLi5ELi4uLi4uLgorICAgICAgICAgICAgMHg3MSww
eDY1LDB4NmQsMHg3NSwweDIwLDB4NzUsMHg3MywweDYyLDB4MmQsMHg3MiwweDY1LDB4NjQsIC8v
MDBjIHFlbXUgdXNiLXJlZAorICAgICAgICAgICAgMHg2OSwweDcyLDB4MjAsMHg2NywweDc1LDB4
NjUsMHg3MywweDc0LDB4MjAsMHgzMywweDJlLDB4MzAsIC8vMDE4IGlyIGd1ZXN0IDMuMAorICAg
ICAgICAgICAgMHgyZSwweDMxLDB4MDAsMHgwMCwweDAwLDB4MDAsMHgwMCwweDAwLDB4MDAsMHgw
MCwweDAwLDB4MDAsIC8vMDI0IC4xLi4uLi4uLi4uLgorICAgICAgICAgICAgMHgwMCwweDAwLDB4
MDAsMHgwMCwweDAwLDB4MDAsMHgwMCwweDAwLDB4MDAsMHgwMCwweDAwLDB4MDAsIC8vMDMwIC4u
Li4uLi4uLi4uLgorICAgICAgICAgICAgMHgwMCwweDAwLDB4MDAsMHgwMCwweDAwLDB4MDAsMHgw
MCwweDAwLDB4MDAsMHgwMCwweDAwLDB4MDAsIC8vMDNjIC4uLi4uLi4uLi4uLgorICAgICAgICAg
ICAgMHgwMCwweDAwLDB4MDAsMHgwMCwweGZmLDB4MDAsMHgwMCwweDAwLCAgICAgICAgICAgICAg
ICAgICAgIC8vMDQ4IC4uLi4uLi4uCisgICAgICAgIERBVEFfU0VORDsKKyAgICB9CisKKyAgICBp
ZiAoIWF0dGFjaF9vbl9jb25uZWN0KSB7CisgICAgICAgIGdfYXNzZXJ0X3RydWUoc3BpY2VfdXNi
X2JhY2tlbmRfY2hhbm5lbF9hdHRhY2godXNiX2NoLCBkZXZpY2UsICZlcnIpKTsKKyAgICAgICAg
Z19hc3NlcnRfbnVsbChlcnIpOworICAgIH0KKyAgICBnX2Fzc2VydF9jbXBpbnQoaGVsbG9zX3Nl
bnQsID09LCAxKTsKKyAgICBnX2Fzc2VydF9jbXBpbnQobWVzc2FnZXNfc2VudCwgPiwgMSk7CisK
KyAgICBzcGljZV91c2JfYmFja2VuZF9jaGFubmVsX2RldGFjaCh1c2JfY2gpOworfQorCiBzdGF0
aWMgdm9pZCBhdHRhY2goY29uc3Qgdm9pZCAqcGFyYW0pCiB7CiAgICAgY29uc3QgYm9vbCBhdHRh
Y2hfb25fY29ubmVjdCA9ICEhR1BPSU5URVJfVE9fVUlOVChwYXJhbSk7CkBAIC0xNzAsNDQgKzIz
MCwzMCBAQCBzdGF0aWMgdm9pZCBhdHRhY2goY29uc3Qgdm9pZCAqcGFyYW0pCiAgICAgZ19hc3Nl
cnRfdHJ1ZShjcmVhdGVfZW11bGF0ZWRfY2QoYmUsICZwYXJhbXMsICZlcnIpKTsKICAgICBnX2Fz
c2VydF9udWxsKGVycik7CiAgICAgZ19hc3NlcnRfbm9ubnVsbChkZXZpY2UpOworICAgIGdfYXNz
ZXJ0X2ZhbHNlKGRldmljZS0+ZWRldl9jb25maWd1cmVkKTsKIAogICAgIHVzYl9jaCA9IHNwaWNl
X3VzYl9iYWNrZW5kX2NoYW5uZWxfbmV3KGJlLCBTUElDRV9VU0JSRURJUl9DSEFOTkVMKGNoKSk7
CiAgICAgZ19hc3NlcnRfbm9ubnVsbCh1c2JfY2gpOwogCi0gICAgLy8gYXR0YWNoIG9uIGNvbm5l
Y3QKLSAgICBjaF9zdGF0ZSA9IFNQSUNFX0NIQU5ORUxfU1RBVEVfQ09OTkVDVElORzsKLSAgICBp
ZiAoYXR0YWNoX29uX2Nvbm5lY3QpIHsKLSAgICAgICAgZ19hc3NlcnRfdHJ1ZShzcGljZV91c2Jf
YmFja2VuZF9jaGFubmVsX2F0dGFjaCh1c2JfY2gsIGRldmljZSwgJmVycikpOwotICAgICAgICBn
X2Fzc2VydF9udWxsKGVycik7CisgICAgZm9yIChpbnQgbG9vcCA9IDA7IGxvb3AgPCAyOyBsb29w
KyspIHsKKyAgICAgICAgZGV2aWNlX2l0ZXJhdGlvbihsb29wLCBhdHRhY2hfb25fY29ubmVjdCk7
CiAgICAgfQotICAgIGdfYXNzZXJ0X2NtcGludChoZWxsb3Nfc2VudCwgPT0sIDApOwotICAgIGdf
YXNzZXJ0X2NtcGludChtZXNzYWdlc19zZW50LCA9PSwgMCk7CiAKLSAgICAvLyB0cnkgdG8gZ2V0
IGluaXRpYWwgZGF0YQotICAgIGNoX3N0YXRlID0gU1BJQ0VfQ0hBTk5FTF9TVEFURV9SRUFEWTsK
LSAgICBzcGljZV91c2JfYmFja2VuZF9jaGFubmVsX2ZsdXNoX3dyaXRlcyh1c2JfY2gpOworLyoK
IAotICAgIC8vIHdlIHNob3VsZCBnZXQgYW4gaGVsbG8gKG9ubHkgb25lISkKLSAgICBnX2Fzc2Vy
dF9jbXBpbnQoaGVsbG9zX3NlbnQsID09LCAxKTsKLSAgICBnX2Fzc2VydF9jbXBpbnQobWVzc2Fn
ZXNfc2VudCwgPT0sIDEpOworPiB0byBzZXJ2ZXIvZ3Vlc3QKKzwgdG8gY2xpZW50IGZyb20gc2Vy
dmVyL2d1ZXN0CiAKLSAgICAvLyBzZW5kIGhlbGxvIHJlcGx5Ci0gICAgREFUQV9TVEFSVAotICAg
ICAgICAweDAwLDB4MDAsMHgwMCwweDAwLDB4NDQsMHgwMCwweDAwLDB4MDAsMHgwMCwweDAwLDB4
MDAsMHgwMCwgLy8wMDAgLi4uLkQuLi4uLi4uCi0gICAgICAgIDB4NzEsMHg2NSwweDZkLDB4NzUs
MHgyMCwweDc1LDB4NzMsMHg2MiwweDJkLDB4NzIsMHg2NSwweDY0LCAvLzAwYyBxZW11IHVzYi1y
ZWQKLSAgICAgICAgMHg2OSwweDcyLDB4MjAsMHg2NywweDc1LDB4NjUsMHg3MywweDc0LDB4MjAs
MHgzMywweDJlLDB4MzAsIC8vMDE4IGlyIGd1ZXN0IDMuMAotICAgICAgICAweDJlLDB4MzEsMHgw
MCwweDAwLDB4MDAsMHgwMCwweDAwLDB4MDAsMHgwMCwweDAwLDB4MDAsMHgwMCwgLy8wMjQgLjEu
Li4uLi4uLi4uCi0gICAgICAgIDB4MDAsMHgwMCwweDAwLDB4MDAsMHgwMCwweDAwLDB4MDAsMHgw
MCwweDAwLDB4MDAsMHgwMCwweDAwLCAvLzAzMCAuLi4uLi4uLi4uLi4KLSAgICAgICAgMHgwMCww
eDAwLDB4MDAsMHgwMCwweDAwLDB4MDAsMHgwMCwweDAwLDB4MDAsMHgwMCwweDAwLDB4MDAsIC8v
MDNjIC4uLi4uLi4uLi4uLgotICAgICAgICAweDAwLDB4MDAsMHgwMCwweDAwLDB4ZmYsMHgwMCww
eDAwLDB4MDAsICAgICAgICAgICAgICAgICAgICAgLy8wNDggLi4uLi4uLi4KLSAgICBEQVRBX1NF
TkQ7Cis+IHVzYl9yZWRpcl9pbnRlcmZhY2VfaW5mbywKKz4gdXNiX3JlZGlyX2VwX2luZm8sCis+
IHVzYl9yZWRpcl9kZXZpY2VfY29ubmVjdAogCi0gICAgaWYgKCFhdHRhY2hfb25fY29ubmVjdCkg
ewotICAgICAgICBnX2Fzc2VydF90cnVlKHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfYXR0YWNo
KHVzYl9jaCwgZGV2aWNlLCAmZXJyKSk7Ci0gICAgICAgIGdfYXNzZXJ0X251bGwoZXJyKTsKLSAg
ICB9Ci0gICAgZ19hc3NlcnRfY21waW50KGhlbGxvc19zZW50LCA9PSwgMSk7Ci0gICAgZ19hc3Nl
cnRfY21waW50KG1lc3NhZ2VzX3NlbnQsID4sIDEpOworPCB1c2JfcmVkaXJfcmVzZXQKKzwgdXNi
X3JlZGlyX2NvbnRyb2xfcGFja2V0CisKKz4gdXNiX3JlZGlyX2NvbnRyb2xfcGFja2V0CisKKyov
CiAKICAgICAvLyBjbGVhbnVwCiAgICAgc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX3VucmVmKGRl
dmljZSk7Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9zcGljZS1kZXZlbA==
