Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C97062AFAD
	for <lists+spice-devel@lfdr.de>; Mon, 27 May 2019 10:04:14 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 532428972B;
	Mon, 27 May 2019 08:04:13 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E9D168972B
 for <spice-devel@lists.freedesktop.org>; Mon, 27 May 2019 08:04:11 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx01.intmail.prod.int.phx2.redhat.com
 [10.5.11.11])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 93C4E3079B8F
 for <spice-devel@lists.freedesktop.org>; Mon, 27 May 2019 08:04:11 +0000 (UTC)
Received: from dhcp-4-103.tlv.redhat.com (dhcp-4-103.tlv.redhat.com
 [10.35.4.103])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 010646A25F
 for <spice-devel@lists.freedesktop.org>; Mon, 27 May 2019 08:04:10 +0000 (UTC)
From: Snir Sheriber <ssheribe@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Mon, 27 May 2019 11:04:09 +0300
Message-Id: <20190527080409.3430-1-ssheribe@redhat.com>
In-Reply-To: <8f0d6136-c5a4-b541-46bf-6c2280eb302d@redhat.com>
References: <8f0d6136-c5a4-b541-46bf-6c2280eb302d@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.11
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.41]); Mon, 27 May 2019 08:04:11 +0000 (UTC)
Subject: [Spice-devel] [PATCH v3 spice-gtk] Adjust to window scaling
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

V2hlbiBHREtfU0NBTEUgaXMgIT0gMSBhbmQgZWdsIGlzIHVzZWQsIHRoZSBpbWFnZSBwcmVzZW50
ZWQgZG9lcyBub3QKZml0IHRvIHRoZSB3aW5kb3cgKHNjYWxlIG9mIDIgaXMgb2Z0ZW4gdXNlZCB3
aXRoIGhpZHBpIG1vbml0b3JzKS4KVXN1YWxseSB0aGlzIGlzIG5vdCBhIHByb2JsZW0gc2luY2Ug
YWxsIGNvbXBvbmVudHMgYXJlIGFkanVzdGVkIGJ5Cmdkay9ndGsgYnV0IHdpdGggZWdsLCBwaXhl
bC1iYXNlZCBkYXRhIGlzIG5vdCBiZWluZyBzY2FsZWQuIEluIHRoaXMKY2FzZSB3aW5kb3cncyBz
Y2FsZSB2YWx1ZSBjYW4gYmUgdXNlZCBpbiBvcmRlciB0byBkZXRlcm1pbmUgd2hldGhlcgp0byB1
c2UgYSBwaXhlbCByZXNvdXJjZSB3aXRoIGhpZ2hlciByZXNvbHV0aW9uIGRhdGEuCgpJbiBvcmRl
ciB0byByZXByb2R1Y2UgdGhlIHByb2JsZW0gc2V0IHNwaWNlIHdpdGggdmlyZ2wvSW50ZWwtdkdQ
VQphbmQgcnVuIHNwaWNlLWd0ayB3aXRoIEdES19TQ0FMRT0yCgpUaGlzIGlzc3VlIHdhcyBhbHNv
IHJlcG9ydGVkIGF0IGZyZWVkZXNrdG9wIGdpdGxhYiByZXBvOgpodHRwczovL2dpdGxhYi5mcmVl
ZGVza3RvcC5vcmcvc3BpY2Uvc3BpY2UtZ3RrL2lzc3Vlcy85OQotLS0KIHNyYy9zcGljZS13aWRn
ZXQtZWdsLmMgfCAgOCArKysrLS0tLQogc3JjL3NwaWNlLXdpZGdldC5jICAgICB8IDMxICsrKysr
KysrKysrKysrKysrKysrKysrLS0tLS0tLS0KIDIgZmlsZXMgY2hhbmdlZCwgMjcgaW5zZXJ0aW9u
cygrKSwgMTIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvc3JjL3NwaWNlLXdpZGdldC1lZ2wu
YyBiL3NyYy9zcGljZS13aWRnZXQtZWdsLmMKaW5kZXggNDNmY2NkNy4uZjY4OGZkMiAxMDA2NDQK
LS0tIGEvc3JjL3NwaWNlLXdpZGdldC1lZ2wuYworKysgYi9zcmMvc3BpY2Utd2lkZ2V0LWVnbC5j
CkBAIC0zNjAsOSArMzYwLDkgQEAgZ2Jvb2xlYW4gc3BpY2VfZWdsX3JlYWxpemVfZGlzcGxheShT
cGljZURpc3BsYXkgKmRpc3BsYXksIEdka1dpbmRvdyAqd2luLCBHRXJyb3IKICAgICBESVNQTEFZ
X0RFQlVHKGRpc3BsYXksICJlZ2wgcmVhbGl6ZSIpOwogICAgIGlmICghc3BpY2Vfd2lkZ2V0X2lu
aXRfZWdsX3dpbihkaXNwbGF5LCB3aW4sIGVycikpCiAgICAgICAgIHJldHVybiBGQUxTRTsKLQot
ICAgIHNwaWNlX2VnbF9yZXNpemVfZGlzcGxheShkaXNwbGF5LCBnZGtfd2luZG93X2dldF93aWR0
aCh3aW4pLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZGtfd2luZG93X2dldF9oZWln
aHQod2luKSk7CisgICAgZ2ludCBnZGtfc2NhbGUgPSBnZGtfd2luZG93X2dldF9zY2FsZV9mYWN0
b3Iod2luKTsKKyAgICBzcGljZV9lZ2xfcmVzaXplX2Rpc3BsYXkoZGlzcGxheSwgZ2RrX3dpbmRv
d19nZXRfd2lkdGgod2luKSAqIGdka19zY2FsZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgZ2RrX3dpbmRvd19nZXRfaGVpZ2h0KHdpbikgKiBnZGtfc2NhbGUpOwogCiAgICAgcmV0dXJu
IFRSVUU7CiB9CkBAIC00MjcsNyArNDI3LDcgQEAgdm9pZCBzcGljZV9lZ2xfdW5yZWFsaXplX2Rp
c3BsYXkoU3BpY2VEaXNwbGF5ICpkaXNwbGF5KQogfQogCiBHX0dOVUNfSU5URVJOQUwKLXZvaWQg
c3BpY2VfZWdsX3Jlc2l6ZV9kaXNwbGF5KFNwaWNlRGlzcGxheSAqZGlzcGxheSwgaW50IHcsIGlu
dCBoKQordm9pZCBzcGljZV9lZ2xfcmVzaXplX2Rpc3BsYXkoU3BpY2VEaXNwbGF5ICpkaXNwbGF5
LCBpbnQgdywgaW50IGgpIC8vIHcgYW5kIGggc2hvdWxkIGJlIGFkanVzdGVkIHRvIGdkayBzY2Fs
aW5nCiB7CiAgICAgU3BpY2VEaXNwbGF5UHJpdmF0ZSAqZCA9IGRpc3BsYXktPnByaXY7CiAgICAg
aW50IHByb2c7CmRpZmYgLS1naXQgYS9zcmMvc3BpY2Utd2lkZ2V0LmMgYi9zcmMvc3BpY2Utd2lk
Z2V0LmMKaW5kZXggMWYyYTE1NC4uYzQ3NWMzOSAxMDA2NDQKLS0tIGEvc3JjL3NwaWNlLXdpZGdl
dC5jCisrKyBiL3NyYy9zcGljZS13aWRnZXQuYwpAQCAtMTM4Miw3ICsxMzgyLDggQEAgc3RhdGlj
IHZvaWQgc2V0X2VnbF9lbmFibGVkKFNwaWNlRGlzcGxheSAqZGlzcGxheSwgYm9vbCBlbmFibGVk
KQogICAgIH0KIAogICAgIGlmIChlbmFibGVkICYmIGQtPmVnbC5jb250ZXh0X3JlYWR5KSB7Ci0g
ICAgICAgIHNwaWNlX2VnbF9yZXNpemVfZGlzcGxheShkaXNwbGF5LCBkLT53dywgZC0+d2gpOwor
ICAgICAgICBnaW50IGdka19zY2FsZSA9IGd0a193aWRnZXRfZ2V0X3NjYWxlX2ZhY3RvcihHVEtf
V0lER0VUKGRpc3BsYXkpKTsKKyAgICAgICAgc3BpY2VfZWdsX3Jlc2l6ZV9kaXNwbGF5KGRpc3Bs
YXksIGQtPnd3ICogZ2RrX3NjYWxlLCBkLT53aCAqIGdka19zY2FsZSk7CiAgICAgfQogCiAgICAg
ZC0+ZWdsLmVuYWJsZWQgPSBlbmFibGVkOwpAQCAtMTk3OCwxMSArMTk3OSwxNiBAQCBzdGF0aWMg
dm9pZCB0cmFuc2Zvcm1faW5wdXQoU3BpY2VEaXNwbGF5ICpkaXNwbGF5LAogICAgIFNwaWNlRGlz
cGxheVByaXZhdGUgKmQgPSBkaXNwbGF5LT5wcml2OwogICAgIGludCBkaXNwbGF5X3gsIGRpc3Bs
YXlfeSwgZGlzcGxheV93LCBkaXNwbGF5X2g7CiAgICAgZG91YmxlIGlzOworICAgIGdpbnQgZ2Rr
X3NjYWxlID0gMTsKIAogICAgIHNwaWNlX2Rpc3BsYXlfZ2V0X3NjYWxpbmcoZGlzcGxheSwgTlVM
TCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZkaXNwbGF5X3gsICZkaXNwbGF5X3ks
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmZGlzcGxheV93LCAmZGlzcGxheV9oKTsK
LQorI2lmIEhBVkVfRUdMCisgICAgICAgIGlmIChlZ2xfZW5hYmxlZChkKSkgeworICAgICAgICAg
ICAgZ2RrX3NjYWxlID0gZ3RrX3dpZGdldF9nZXRfc2NhbGVfZmFjdG9yKEdUS19XSURHRVQoZGlz
cGxheSkpOworICAgICAgICB9CisjZW5kaWYKICAgICAvKiBGb3IgaW5wdXQgd2UgbmVlZCBhIGRp
ZmZlcmVudCBzY2FsaW5nIGZhY3RvciBpbiBvcmRlciB0bwogICAgICAgIGJlIGFibGUgdG8gcmVh
Y2ggdGhlIGZ1bGwgd2lkdGggb2YgYSBkaXNwbGF5LiBGb3IgaW5zdGFuY2UsIGNvbnNpZGVyCiAg
ICAgICAgYSBkaXNwbGF5IG9mIDEwMCBwaXhlbHMgc2hvd2luZyBpbiBhIHdpbmRvdyAxMCBwaXhl
bHMgd2lkZS4gVGhlIG5vcm1hbApAQCAtMTk5OCw3ICsyMDA0LDcgQEAgc3RhdGljIHZvaWQgdHJh
bnNmb3JtX2lucHV0KFNwaWNlRGlzcGxheSAqZGlzcGxheSwKICAgICAgICBjb29yZGluYXRlcyBp
biB0aGUgaW52ZXJzZSBkaXJlY3Rpb24gKHdpbmRvdyAtPiBkaXNwbGF5KSBhcyB0aGUgZmIgc2l6
ZQogICAgICAgIChkaXNwbGF5IC0+IHdpbmRvdykuCiAgICAgKi8KLSAgICBpcyA9IChkb3VibGUp
KGQtPmFyZWEud2lkdGgtMSkgLyAoZG91YmxlKShkaXNwbGF5X3ctMSk7CisgICAgaXMgPSAoKGRv
dWJsZSkoZC0+YXJlYS53aWR0aC0xKSAvIChkb3VibGUpKGRpc3BsYXlfdy0xKSkgKiBnZGtfc2Nh
bGU7CiAKICAgICB3aW5kb3dfeCAtPSBkaXNwbGF5X3g7CiAgICAgd2luZG93X3kgLT0gZGlzcGxh
eV95OwpAQCAtMjE4Myw4ICsyMTg5LDEwIEBAIHN0YXRpYyB2b2lkIHNpemVfYWxsb2NhdGUoR3Rr
V2lkZ2V0ICp3aWRnZXQsIEd0a0FsbG9jYXRpb24gKmNvbmYsIGdwb2ludGVyIGRhdGEpCiAgICAg
ICAgIGQtPndoID0gY29uZi0+aGVpZ2h0OwogICAgICAgICByZWNhbGNfZ2VvbWV0cnkod2lkZ2V0
KTsKICNpZiBIQVZFX0VHTAotICAgICAgICBpZiAoZWdsX2VuYWJsZWQoZCkpCi0gICAgICAgICAg
ICBzcGljZV9lZ2xfcmVzaXplX2Rpc3BsYXkoZGlzcGxheSwgY29uZi0+d2lkdGgsIGNvbmYtPmhl
aWdodCk7CisgICAgICAgIGlmIChlZ2xfZW5hYmxlZChkKSkgeworICAgICAgICAgICAgZ2ludCBn
ZGtfc2NhbGUgPSBndGtfd2lkZ2V0X2dldF9zY2FsZV9mYWN0b3Iod2lkZ2V0KTsKKyAgICAgICAg
ICAgIHNwaWNlX2VnbF9yZXNpemVfZGlzcGxheShkaXNwbGF5LCBjb25mLT53aWR0aCAqIGdka19z
Y2FsZSwgY29uZi0+aGVpZ2h0ICogZ2RrX3NjYWxlKTsKKyAgICAgICAgfQogI2VuZGlmCiAgICAg
fQogCkBAIC0yOTQyLDEwICsyOTUwLDE2IEBAIHZvaWQgc3BpY2VfZGlzcGxheV9nZXRfc2NhbGlu
ZyhTcGljZURpc3BsYXkgKmRpc3BsYXksCiAgICAgaW50IHd3LCB3aDsKICAgICBpbnQgeCwgeSwg
dywgaDsKICAgICBkb3VibGUgczsKKyAgICBnaW50IGdka19zY2FsZSA9IDE7CiAKICAgICBpZiAo
Z3RrX3dpZGdldF9nZXRfcmVhbGl6ZWQgKEdUS19XSURHRVQoZGlzcGxheSkpKSB7Ci0gICAgICAg
IHd3ID0gZ3RrX3dpZGdldF9nZXRfYWxsb2NhdGVkX3dpZHRoKEdUS19XSURHRVQoZGlzcGxheSkp
OwotICAgICAgICB3aCA9IGd0a193aWRnZXRfZ2V0X2FsbG9jYXRlZF9oZWlnaHQoR1RLX1dJREdF
VChkaXNwbGF5KSk7CisjaWYgSEFWRV9FR0wKKyAgICAgICAgaWYgKGVnbF9lbmFibGVkKGQpKSB7
CisgICAgICAgICAgICBnZGtfc2NhbGUgPSBndGtfd2lkZ2V0X2dldF9zY2FsZV9mYWN0b3IoR1RL
X1dJREdFVChkaXNwbGF5KSk7CisgICAgICAgIH0KKyNlbmRpZgorICAgICAgICB3dyA9IGd0a193
aWRnZXRfZ2V0X2FsbG9jYXRlZF93aWR0aChHVEtfV0lER0VUKGRpc3BsYXkpKSAqIGdka19zY2Fs
ZTsKKyAgICAgICAgd2ggPSBndGtfd2lkZ2V0X2dldF9hbGxvY2F0ZWRfaGVpZ2h0KEdUS19XSURH
RVQoZGlzcGxheSkpICogZ2RrX3NjYWxlOwogICAgIH0gZWxzZSB7CiAgICAgICAgIHd3ID0gZmJ3
OwogICAgICAgICB3aCA9IGZiaDsKQEAgLTMwOTEsNyArMzEwNSw4IEBAIHZvaWQgc3BpY2VfZGlz
cGxheV93aWRnZXRfZ2xfc2Nhbm91dChTcGljZURpc3BsYXkgKmRpc3BsYXkpCiAgICAgICAgICAg
ICBnX2NsZWFyX2Vycm9yKCZlcnIpOwogICAgICAgICB9CiAKLSAgICAgICAgc3BpY2VfZWdsX3Jl
c2l6ZV9kaXNwbGF5KGRpc3BsYXksIGQtPnd3LCBkLT53aCk7CisgICAgICAgIGdpbnQgZ2RrX3Nj
YWxlID0gZ3RrX3dpZGdldF9nZXRfc2NhbGVfZmFjdG9yKEdUS19XSURHRVQoZGlzcGxheSkpOwor
ICAgICAgICBzcGljZV9lZ2xfcmVzaXplX2Rpc3BsYXkoZGlzcGxheSwgZC0+d3cgKiBnZGtfc2Nh
bGUsIGQtPndoICogZ2RrX3NjYWxlKTsKICAgICB9CiAjZW5kaWYKIAotLSAKMi4yMS4wCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpTcGljZS1kZXZlbCBt
YWlsaW5nIGxpc3QKU3BpY2UtZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vc3BpY2UtZGV2ZWw=
