Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A1F91CDF73
	for <lists+spice-devel@lfdr.de>; Mon,  7 Oct 2019 12:39:18 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8DB336E52A;
	Mon,  7 Oct 2019 10:39:15 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A2B3A6E527
 for <spice-devel@lists.freedesktop.org>; Mon,  7 Oct 2019 10:39:14 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
 [10.5.11.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 4D2BD20EE
 for <spice-devel@lists.freedesktop.org>; Mon,  7 Oct 2019 10:39:14 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.7])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 5D3965D6D0;
 Mon,  7 Oct 2019 10:39:13 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Mon,  7 Oct 2019 11:39:00 +0100
Message-Id: <20191007103906.30517-3-fziglio@redhat.com>
In-Reply-To: <20191007103906.30517-1-fziglio@redhat.com>
References: <20191007103906.30517-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.6.2
 (mx1.redhat.com [10.5.110.71]); Mon, 07 Oct 2019 10:39:14 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-server 2/8] test-smartcard: Add test for
 Smartcard device
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

Q3JlYXRlIFNtYXJkY2FyZCBkZXZpY2UuCkNvbm5lY3QgdG8gaXQgYW5kIHRlc3Qgc29tZSBtZXNz
YWdlcyBhcmUgcGFyc2VkIGFuZCBwcm9jZXNzZWQKYXMgZXhwZWN0ZWQuCgpTaWduZWQtb2ZmLWJ5
OiBGcmVkaWFubyBaaWdsaW8gPGZ6aWdsaW9AcmVkaGF0LmNvbT4KLS0tCiBzZXJ2ZXIvdGVzdHMv
LmdpdGlnbm9yZSAgICAgICB8ICAgMSArCiBzZXJ2ZXIvdGVzdHMvTWFrZWZpbGUuYW0gICAgICB8
ICAgNCArCiBzZXJ2ZXIvdGVzdHMvbWVzb24uYnVpbGQgICAgICB8ICAgNCArCiBzZXJ2ZXIvdGVz
dHMvdGVzdC1zbWFydGNhcmQuYyB8IDIxMSArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrCiA0IGZpbGVzIGNoYW5nZWQsIDIyMCBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2
NDQgc2VydmVyL3Rlc3RzL3Rlc3Qtc21hcnRjYXJkLmMKCmRpZmYgLS1naXQgYS9zZXJ2ZXIvdGVz
dHMvLmdpdGlnbm9yZSBiL3NlcnZlci90ZXN0cy8uZ2l0aWdub3JlCmluZGV4IDM2ZTk3OGQ0Li41
NmNjN2ViOSAxMDA2NDQKLS0tIGEvc2VydmVyL3Rlc3RzLy5naXRpZ25vcmUKKysrIGIvc2VydmVy
L3Rlc3RzLy5naXRpZ25vcmUKQEAgLTI5LDUgKzI5LDYgQEAgdGVzdC1sZWFrcwogdGVzdC1zYXNs
CiB0ZXN0LXJlY29yZAogdGVzdC13ZWJzb2NrZXQKK3Rlc3Qtc21hcnRjYXJkCiAvdGVzdC0qLmxv
ZwogL3Rlc3QtKi50cnMKZGlmZiAtLWdpdCBhL3NlcnZlci90ZXN0cy9NYWtlZmlsZS5hbSBiL3Nl
cnZlci90ZXN0cy9NYWtlZmlsZS5hbQppbmRleCA5ODI1MDg1MS4uZGQyODVjMjQgMTAwNjQ0Ci0t
LSBhL3NlcnZlci90ZXN0cy9NYWtlZmlsZS5hbQorKysgYi9zZXJ2ZXIvdGVzdHMvTWFrZWZpbGUu
YW0KQEAgLTY4LDYgKzY4LDEwIEBAIGNoZWNrX1BST0dSQU1TID0JCQkJXAogCXRlc3QtcmVjb3Jk
CQkJCVwKIAkkKE5VTEwpCiAKK2lmIEhBVkVfU01BUlRDQVJECitjaGVja19QUk9HUkFNUyArPSB0
ZXN0LXNtYXJ0Y2FyZAorZW5kaWYKKwogaWYgIU9TX1dJTjMyCiBjaGVja19QUk9HUkFNUyArPQkJ
CQlcCiAJdGVzdC1zdHJlYW0JCQkJXApkaWZmIC0tZ2l0IGEvc2VydmVyL3Rlc3RzL21lc29uLmJ1
aWxkIGIvc2VydmVyL3Rlc3RzL21lc29uLmJ1aWxkCmluZGV4IDMzNDcyZjE0Li45NWFkZTYwZiAx
MDA2NDQKLS0tIGEvc2VydmVyL3Rlc3RzL21lc29uLmJ1aWxkCisrKyBiL3NlcnZlci90ZXN0cy9t
ZXNvbi5idWlsZApAQCAtNjUsNiArNjUsMTAgQEAgaWYgc3BpY2Vfc2VydmVyX2hhc19zYXNsCiAg
IHRlc3RzICs9IFtbJ3Rlc3Qtc2FzbCcsIHRydWVdXQogZW5kaWYKIAoraWYgc3BpY2Vfc2VydmVy
X2hhc19zbWFydGNhcmQgPT0gdHJ1ZQorICB0ZXN0cyArPSBbWyd0ZXN0LXNtYXJ0Y2FyZCcsIHRy
dWVdXQorZW5kaWYKKwogaWYgaG9zdF9tYWNoaW5lLnN5c3RlbSgpICE9ICd3aW5kb3dzJwogICB0
ZXN0cyArPSBbCiAgICAgWyd0ZXN0LXN0cmVhbScsIHRydWVdLApkaWZmIC0tZ2l0IGEvc2VydmVy
L3Rlc3RzL3Rlc3Qtc21hcnRjYXJkLmMgYi9zZXJ2ZXIvdGVzdHMvdGVzdC1zbWFydGNhcmQuYwpu
ZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMC4uNDdlNTQxZDMKLS0tIC9kZXYvbnVs
bAorKysgYi9zZXJ2ZXIvdGVzdHMvdGVzdC1zbWFydGNhcmQuYwpAQCAtMCwwICsxLDIxMSBAQAor
LyogLSotIE1vZGU6IEM7IGMtYmFzaWMtb2Zmc2V0OiA0OyBpbmRlbnQtdGFicy1tb2RlOiBuaWwg
LSotICovCisvKgorICAgQ29weXJpZ2h0IChDKSAyMDE5IFJlZCBIYXQsIEluYy4KKworICAgVGhp
cyBsaWJyYXJ5IGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9v
cgorICAgbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFs
IFB1YmxpYworICAgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91
bmRhdGlvbjsgZWl0aGVyCisgICB2ZXJzaW9uIDIuMSBvZiB0aGUgTGljZW5zZSwgb3IgKGF0IHlv
dXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KKworICAgVGhpcyBsaWJyYXJ5IGlzIGRpc3Ry
aWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCisgICBidXQgV0lUSE9V
VCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgorICAg
TUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2Vl
IHRoZSBHTlUKKyAgIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFp
bHMuCisKKyAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBMZXNz
ZXIgR2VuZXJhbCBQdWJsaWMKKyAgIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlm
IG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KKyovCisvKioKKyAqIFRl
c3QgU21hcnRjYXJkIGRldmljZSBhbmQgY2hhbm5lbAorICovCisKKyNpbmNsdWRlIDxjb25maWcu
aD4KKyNpbmNsdWRlIDxzdHJpbmcuaD4KKyNpbmNsdWRlIDxzdGRsaWIuaD4KKyNpbmNsdWRlIDxz
dGRpby5oPgorI2luY2x1ZGUgPHN0ZGJvb2wuaD4KKyNpbmNsdWRlIDx1bmlzdGQuaD4KKworI2lu
Y2x1ZGUgPHNwaWNlL3Byb3RvY29sLmg+CisjaW5jbHVkZSA8c3BpY2Uvc3RyZWFtLWRldmljZS5o
PgorCisjaW5jbHVkZSAidGVzdC1kaXNwbGF5LWJhc2UuaCIKKyNpbmNsdWRlICJ0ZXN0LWdsaWIt
Y29tcGF0LmgiCisjaW5jbHVkZSAicmVkcy5oIgorI2luY2x1ZGUgInZtYy1lbXUuaCIKKyNpbmNs
dWRlICJyZWQtY2xpZW50LmgiCisjaW5jbHVkZSAibmV0LXV0aWxzLmgiCisKK3N0YXRpYyBTcGlj
ZUNvcmVJbnRlcmZhY2UgKmNvcmU7CitzdGF0aWMgVGVzdCAqdGVzdDsKK3N0YXRpYyBWbWNFbXUg
KnZtYzsKK3R5cGVkZWYgaW50IFRlc3RGaXh0dXJlOworCitzdGF0aWMgdm9pZCB0ZXN0X3NtYXJ0
Y2FyZF9zZXR1cChUZXN0Rml4dHVyZSAqZml4dHVyZSwgZ2NvbnN0cG9pbnRlciB1c2VyX2RhdGEp
Cit7CisgICAgZ19hc3NlcnRfbnVsbChjb3JlKTsKKyAgICBnX2Fzc2VydF9udWxsKHRlc3QpOwor
ICAgIGdfYXNzZXJ0X251bGwodm1jKTsKKyAgICBjb3JlID0gYmFzaWNfZXZlbnRfbG9vcF9pbml0
KCk7CisgICAgZ19hc3NlcnRfbm9ubnVsbChjb3JlKTsKKyAgICB0ZXN0ID0gdGVzdF9uZXcoY29y
ZSk7CisgICAgZ19hc3NlcnRfbm9ubnVsbCh0ZXN0KTsKKyAgICB2bWMgPSB2bWNfZW11X25ldygi
c21hcnRjYXJkIiwgTlVMTCk7CisgICAgZ19hc3NlcnRfbm9ubnVsbCh2bWMpOworfQorCitzdGF0
aWMgdm9pZCB0ZXN0X3NtYXJ0Y2FyZF90ZWFyZG93bihUZXN0Rml4dHVyZSAqZml4dHVyZSwgZ2Nv
bnN0cG9pbnRlciB1c2VyX2RhdGEpCit7CisgICAgZ19hc3NlcnRfbm9ubnVsbChjb3JlKTsKKyAg
ICBnX2Fzc2VydF9ub25udWxsKHRlc3QpOworICAgIGdfYXNzZXJ0X25vbm51bGwodm1jKTsKKwor
ICAgIHZtY19lbXVfZGVzdHJveSh2bWMpOworICAgIHZtYyA9IE5VTEw7CisgICAgdGVzdF9kZXN0
cm95KHRlc3QpOworICAgIHRlc3QgPSBOVUxMOworICAgIGJhc2ljX2V2ZW50X2xvb3BfZGVzdHJv
eSgpOworICAgIGNvcmUgPSBOVUxMOworfQorCitzdGF0aWMgUmVkU3RyZWFtICpjcmVhdGVfZHVt
bXlfc3RyZWFtKFNwaWNlU2VydmVyICpzZXJ2ZXIsIGludCAqcF9zb2NrZXQpCit7CisgICAgaW50
IHN2WzJdOworICAgIGdfYXNzZXJ0X2NtcGludChzb2NrZXRwYWlyKEFGX0xPQ0FMLCBTT0NLX1NU
UkVBTSwgMCwgc3YpLCA9PSwgMCk7CisgICAgaWYgKHBfc29ja2V0KSB7CisgICAgICAgICpwX3Nv
Y2tldCA9IHN2WzFdOworICAgIH0KKyAgICByZWRfc29ja2V0X3NldF9ub25fYmxvY2tpbmcoc3Zb
MF0sIHRydWUpOworICAgIHJlZF9zb2NrZXRfc2V0X25vbl9ibG9ja2luZyhzdlsxXSwgdHJ1ZSk7
CisKKyAgICBSZWRTdHJlYW0gKiBzdHJlYW0gPSByZWRfc3RyZWFtX25ldyhzZXJ2ZXIsIHN2WzBd
KTsKKyAgICBnX2Fzc2VydF9ub25udWxsKHN0cmVhbSk7CisKKyAgICByZXR1cm4gc3RyZWFtOwor
fQorCitzdGF0aWMgdm9pZCBzZW5kX2Fja19zeW5jKGludCBzb2NrZXQsIHVpbnQzMl90IGdlbmVy
YXRpb24pCit7CisgICAgc3RydWN0IHsKKyAgICAgICAgdWludDE2X3QgZHVtbXk7CisgICAgICAg
IHVpbnQxNl90IHR5cGU7CisgICAgICAgIHVpbnQzMl90IGxlbjsKKyAgICAgICAgdWludDMyX3Qg
Z2VuZXJhdGlvbjsKKyAgICB9IG1zZzsKKyAgICBTUElDRV9WRVJJRlkoc2l6ZW9mKG1zZykgPT0g
MTIpOworICAgIG1zZy50eXBlID0gR1VJTlQxNl9UT19MRShTUElDRV9NU0dDX0FDS19TWU5DKTsK
KyAgICBtc2cubGVuID0gR1VJTlQzMl9UT19MRShzaXplb2YoZ2VuZXJhdGlvbikpOworICAgIG1z
Zy5nZW5lcmF0aW9uID0gR1VJTlQzMl9UT19MRShnZW5lcmF0aW9uKTsKKworICAgIGdfYXNzZXJ0
X2NtcGludChzb2NrZXRfd3JpdGUoc29ja2V0LCAmbXNnLnR5cGUsIDEwKSwgPT0sIDEwKTsKK30K
Kworc3RhdGljIHZvaWQgc2VuZF9kYXRhKGludCBzb2NrZXQsIHVpbnQzMl90IHR5cGUpCit7Cisg
ICAgc3RydWN0IHsKKyAgICAgICAgdWludDE2X3QgZHVtbXk7CisgICAgICAgIHVpbnQxNl90IHR5
cGU7CisgICAgICAgIHVpbnQzMl90IGxlbjsKKyAgICAgICAgVlNDTXNnSGVhZGVyIHZoZWFkZXI7
CisgICAgICAgIGNoYXIgZGF0YVs2XTsKKyAgICB9IG1zZzsKKyAgICBTUElDRV9WRVJJRlkoc2l6
ZW9mKG1zZykgPT0gOCsxMis4KTsKKyAgICBtc2cudHlwZSA9IEdVSU5UMTZfVE9fTEUoU1BJQ0Vf
TVNHQ19TTUFSVENBUkRfREFUQSk7CisgICAgbXNnLmxlbiA9IEdVSU5UMzJfVE9fTEUoc2l6ZW9m
KFZTQ01zZ0hlYWRlcikrNik7CisgICAgbXNnLnZoZWFkZXIudHlwZSA9IEdVSU5UMzJfVE9fTEUo
dHlwZSk7CisgICAgbXNnLnZoZWFkZXIucmVhZGVyX2lkID0gMDsKKyAgICBtc2cudmhlYWRlci5s
ZW5ndGggPSBHVUlOVDMyX1RPX0xFKDYpOworICAgIHN0cmNweShtc2cuZGF0YSwgImhlbGxvIik7
CisKKyAgICBnX2Fzc2VydF9jbXBpbnQoc29ja2V0X3dyaXRlKHNvY2tldCwgJm1zZy50eXBlLCBz
aXplb2YobXNnKS00KSwgPT0sIHNpemVvZihtc2cpLTQpOworfQorCitzdGF0aWMgdm9pZCBjaGVj
a19kYXRhKHZvaWQgKm9wYXF1ZSkKK3sKKyAgICBzdGF0aWMgY29uc3QgY2hhciBleHBlY3RlZF9i
dWZbXSA9CisgICAgICAgIC8vIGZvcndhcmRlZCBSZWFkZXJBZGQgbWVzc2FnZSwgbm90ZSB0aGF0
IHBheWxvYWQgaXMgc3RyaXBwZWQKKyAgICAgICAgIlx4MDBceDAwXHgwMFx4MDNceDAwXHgwMFx4
MDBceDAwXHgwMFx4MDBceDAwXHgwMCIKKyAgICAgICAgLy8gZm9yd2FyZGVkIEFQRFUgbWVzc2Fn
ZQorICAgICAgICAiXHgwMFx4MDBceDAwXHgwN1x4MDBceDAwXHgwMFx4MDBceDAwXHgwMFx4MDBc
eDA2XHg2OFx4NjVceDZjXHg2Y1x4NmZceDAwIjsKKyAgICBjb25zdCBzaXplX3QgZXhwZWN0ZWRf
YnVmX2xlbiA9IHNpemVvZihleHBlY3RlZF9idWYpIC0gMTsKKyAgICBnX2Fzc2VydF9jbXBpbnQo
dm1jLT53cml0ZV9wb3MsID09LCBleHBlY3RlZF9idWZfbGVuKTsKKyAgICBnX2Fzc2VydF90cnVl
KG1lbWNtcCh2bWMtPndyaXRlX2J1ZiwgZXhwZWN0ZWRfYnVmLCBleHBlY3RlZF9idWZfbGVuKSA9
PSAwKTsKKyAgICBiYXNpY19ldmVudF9sb29wX3F1aXQoKTsKK30KKworc3RhdGljIHZvaWQgdGVz
dF9zbWFydGNhcmQoVGVzdEZpeHR1cmUgKmZpeHR1cmUsIGdjb25zdHBvaW50ZXIgdXNlcl9kYXRh
KQoreworICAgIFNwaWNlU2VydmVyICpjb25zdCBzZXJ2ZXIgPSB0ZXN0LT5zZXJ2ZXI7CisgICAg
dWludDhfdCAqcCA9IHZtYy0+bWVzc2FnZTsKKworICAgIHNwaWNlX3NlcnZlcl9hZGRfaW50ZXJm
YWNlKHNlcnZlciwgJnZtYy0+aW5zdGFuY2UuYmFzZSk7CisKKyAgICAvLyBhZGQgVlNDX0luaXQg
bWVzc2FnZQorICAgIG1lbWNweShwLCAiXHgwMFx4MDBceDAwXHgwMVx4MGFceDBiXHgwY1x4MGRc
eDAwXHgwMFx4MDBceDAwIiwgMTIpOworICAgIHAgKz0gMTI7CisgICAgdm1jX2VtdV9hZGRfcmVh
ZF90aWxsKHZtYywgcCk7CisKKyAgICAvLyBmaW5kIFNtYXJ0Y2FyZCBjaGFubmVsIHRvIGNvbm5l
Y3QgdG8KKyAgICBSZWRDaGFubmVsICpjaGFubmVsID0gcmVkc19maW5kX2NoYW5uZWwoc2VydmVy
LCBTUElDRV9DSEFOTkVMX1NNQVJUQ0FSRCwgMCk7CisgICAgZ19hc3NlcnRfbm9ubnVsbChjaGFu
bmVsKTsKKworICAgIC8vIGNyZWF0ZSBkdW1teSBSZWRDbGllbnQgYW5kIE1haW5DaGFubmVsQ2xp
ZW50CisgICAgUmVkQ2hhbm5lbENhcGFiaWxpdGllcyBjYXBzOworICAgIG1lbXNldCgmY2Fwcywg
MCwgc2l6ZW9mKGNhcHMpKTsKKyAgICB1aW50MzJfdCBjb21tb25fY2FwcyA9IDEgPDwgU1BJQ0Vf
Q09NTU9OX0NBUF9NSU5JX0hFQURFUjsKKyAgICBjYXBzLm51bV9jb21tb25fY2FwcyA9IDE7Cisg
ICAgY2Fwcy5jb21tb25fY2FwcyA9IHNwaWNlX21lbWR1cCgmY29tbW9uX2NhcHMsIHNpemVvZihj
b21tb25fY2FwcykpOworCisgICAgUmVkQ2xpZW50ICpjbGllbnQgPSByZWRfY2xpZW50X25ldyhz
ZXJ2ZXIsIEZBTFNFKTsKKyAgICBnX2Fzc2VydF9ub25udWxsKGNsaWVudCk7CisKKyAgICBNYWlu
Q2hhbm5lbCAqbWFpbl9jaGFubmVsID0gbWFpbl9jaGFubmVsX25ldyhzZXJ2ZXIpOworICAgIGdf
YXNzZXJ0X25vbm51bGwobWFpbl9jaGFubmVsKTsKKworICAgIE1haW5DaGFubmVsQ2xpZW50ICpt
Y2M7CisgICAgbWNjID0gbWFpbl9jaGFubmVsX2xpbmsobWFpbl9jaGFubmVsLCBjbGllbnQsIGNy
ZWF0ZV9kdW1teV9zdHJlYW0oc2VydmVyLCBOVUxMKSwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAwLCBGQUxTRSwgJmNhcHMpOworICAgIGdfYXNzZXJ0X25vbm51bGwobWNjKTsKKyAgICBy
ZWRfY2xpZW50X3NldF9tYWluKGNsaWVudCwgbWNjKTsKKworICAgIC8vIGNyZWF0ZSBvdXIgdGVz
dGluZyBSZWRDaGFubmVsQ2xpZW50CisgICAgaW50IGNsaWVudF9zb2NrZXQ7CisgICAgcmVkX2No
YW5uZWxfY29ubmVjdChjaGFubmVsLCBjbGllbnQsIGNyZWF0ZV9kdW1teV9zdHJlYW0oc2VydmVy
LCAmY2xpZW50X3NvY2tldCksCisgICAgICAgICAgICAgICAgICAgICAgICBGQUxTRSwgJmNhcHMp
OworICAgIHJlZF9jaGFubmVsX2NhcGFiaWxpdGllc19yZXNldCgmY2Fwcyk7CisKKyAgICBzcGlj
ZV9zZXJ2ZXJfY2hhcl9kZXZpY2Vfd2FrZXVwKCZ2bWMtPmluc3RhbmNlKTsKKworICAgIHNlbmRf
YWNrX3N5bmMoY2xpZW50X3NvY2tldCwgMSk7CisgICAgc2VuZF9kYXRhKGNsaWVudF9zb2NrZXQs
IFZTQ19SZWFkZXJBZGQpOworICAgIHNlbmRfZGF0YShjbGllbnRfc29ja2V0LCBWU0NfQVBEVSk7
CisKKyAgICBTcGljZVRpbWVyICp3YXRjaF90aW1lcjsKKyAgICB3YXRjaF90aW1lciA9IGNvcmUt
PnRpbWVyX2FkZChjaGVja19kYXRhLCBjb3JlKTsKKyAgICBjb3JlLT50aW1lcl9zdGFydCh3YXRj
aF90aW1lciwgMTAwKTsKKworICAgIC8vIHN0YXJ0IGFsbCB0ZXN0CisgICAgYmFzaWNfZXZlbnRf
bG9vcF9tYWlubG9vcCgpOworCisgICAgY29yZS0+dGltZXJfcmVtb3ZlKHdhdGNoX3RpbWVyKTsK
KworICAgIC8vIGNsZWFudXAKKyAgICByZWRfY2xpZW50X2Rlc3Ryb3koY2xpZW50KTsKKyAgICBn
X29iamVjdF91bnJlZihtYWluX2NoYW5uZWwpOworICAgIGdfb2JqZWN0X3VucmVmKGNoYW5uZWwp
OworfQorCitzdGF0aWMgdm9pZCB0ZXN0X2FkZChjb25zdCBjaGFyICpuYW1lLCB2b2lkICgqZnVu
YykoVGVzdEZpeHR1cmUgKiwgZ2NvbnN0cG9pbnRlciksCisgICAgICAgICAgICAgICAgICAgICBn
Y29uc3Rwb2ludGVyIGFyZykKK3sKKyAgICBnX3Rlc3RfYWRkKG5hbWUsIFRlc3RGaXh0dXJlLCBh
cmcsIHRlc3Rfc21hcnRjYXJkX3NldHVwLCBmdW5jLCB0ZXN0X3NtYXJ0Y2FyZF90ZWFyZG93bik7
Cit9CisKK2ludCBtYWluKGludCBhcmdjLCBjaGFyICphcmd2W10pCit7CisgICAgZ190ZXN0X2lu
aXQoJmFyZ2MsICZhcmd2LCBOVUxMKTsKKworICAgIHRlc3RfYWRkKCIvc2VydmVyL3NtYXJ0Y2Fy
ZCIsIHRlc3Rfc21hcnRjYXJkLCBOVUxMKTsKKworICAgIHJldHVybiBnX3Rlc3RfcnVuKCk7Cit9
Ci0tIAoyLjIxLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9zcGlj
ZS1kZXZlbA==
