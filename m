Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id EA1F16444D
	for <lists+spice-devel@lfdr.de>; Wed, 10 Jul 2019 11:24:06 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E161989E7B;
	Wed, 10 Jul 2019 09:24:04 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail-wr1-x430.google.com (mail-wr1-x430.google.com
 [IPv6:2a00:1450:4864:20::430])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0DF3F89E43
 for <spice-devel@lists.freedesktop.org>; Wed, 10 Jul 2019 09:24:03 +0000 (UTC)
Received: by mail-wr1-x430.google.com with SMTP id p17so1611667wrf.11
 for <spice-devel@lists.freedesktop.org>; Wed, 10 Jul 2019 02:24:02 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=ZsmpLRFTC4HOZXLNnckhMf+vFCm87IU0rppvGFvoncY=;
 b=t/wbH2i3DwNO8e4PVHRLGrI+TLIX0qznw+7hly9t1WwP6wimf11YtPMyo90hNevH39
 UEeVe1jSPp7hTiCUe4kLxmv1GJg+4ifseDDdmQ0wikVlz0tA0v/OSntwgw7ZNDAfv/Ec
 NJQzhLjY3ca1C2qFCwiJ/boAgooiznzN9Cr0cRUOXgzSG9yMTVJHl9pLPocoEP8rPl8B
 TY8sDWtszRx53QhA4ILkoOi4aZT57MQ/A4JIf8GrLU9AxUh6qSg/nGFiosJCKuG6rAxp
 xZbierVhBYTdEft2uAHXdwohE6HRakSgfCG/P5nYXqeOO/O39ZN0j5JiAVkhxUEhs+pH
 nPfA==
X-Gm-Message-State: APjAAAUKGofplC8R4OoxlN4VsStfPWqpPcXen63YvXPwsE/wJqC3F5QH
 IqZh5zrYgkOY9fSnimyz711CjusoDAQ=
X-Google-Smtp-Source: APXvYqwPEgsKd8a3wqEfo3PCyxK6zda72CXWiYpJmClI2dlJwhL7qa4nPTD2s8rdC4raikey5B7vHQ==
X-Received: by 2002:a05:6000:1203:: with SMTP id
 e3mr28791144wrx.300.1562750640231; 
 Wed, 10 Jul 2019 02:24:00 -0700 (PDT)
Received: from f2.redhat.com (bzq-79-182-115-245.red.bezeqint.net.
 [79.182.115.245])
 by smtp.gmail.com with ESMTPSA id a12sm1577151wrt.46.2019.07.10.02.23.58
 (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
 Wed, 10 Jul 2019 02:23:59 -0700 (PDT)
From: Yuri Benditovich <yuri.benditovich@daynix.com>
To: spice-devel@lists.freedesktop.org
Date: Wed, 10 Jul 2019 12:23:43 +0300
Message-Id: <20190710092345.5750-2-yuri.benditovich@daynix.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190710092345.5750-1-yuri.benditovich@daynix.com>
References: <20190710092345.5750-1-yuri.benditovich@daynix.com>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=daynix-com.20150623.gappssmtp.com; s=20150623;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=ZsmpLRFTC4HOZXLNnckhMf+vFCm87IU0rppvGFvoncY=;
 b=2TkswM4bkh9pgq4j8xb1+ofzUknYdXDFZQ01US2AfyPcn+mYvZmD749tTUXVktX8jS
 xCc/emtHWlUnpiARUI0pay4wBSBk/8ak6SSqUkeToFBN2614J0zDxRniNYfjdH8NpoUt
 JA2JDXgzL9tkLmbov/05og/w04IwgWDXXKdSKNxb8HwFmVmAr3GL6i9mgDWFIdp1qbYs
 ovYGQq+RQdEsfEmGaxnw2noSugSWQtZLEV+5NG9WXQL5dcxCql/uv5SWP/pOPGnJUZIB
 mHZINKtgUBibKwkVJcxqvpSbphCCXQsIDIuTd5wnHCTTWeKZSreM1NelkPawGEcAkIFq
 onUQ==
Subject: [Spice-devel] [spice-gtk v2 1/3] usb-redir: isolate usage of libusb
 and usbredirhost
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: yan@daynix.com
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

QXMgYSBzdGVwIHRvd2FyZCBwb3NzaWJpbGl0eSB0byBwcmVzZW50IGVtdWxhdGVkIFVTQiBkZXZp
Y2VzCnRvIHRoZSBndWVzdCwgd2UgcmVtb3ZlIHRoZSBrbm93bGVkZ2UgYWJvdXQgbGlidXNiIGFu
ZAp1c2JyZWRpcmhvc3QgKHdoaWNoIGRlcGVuZHMgb24gbGlidXNiKSBmcm9tIGFsbCB0aGUgbW9k
dWxlcwphbmQgY29uY2VudHJhdGUgaXQgaW4gb25lICh1c2IgYmFja2VuZCkgd2hpY2ggcHJlc2Vu
dHMKYWJzdHJhY3QgVVNCIG9iamVjdHMgYW5kIGludGVybmFsIEFQSSB0byBhbGwgb3RoZXIgbW9k
dWxlcy4KSW50ZXJuYWwgQVBJIHByZXNlbnRzIGZvbGxvd2luZyB0eXBlcyBvZiBvYmplY3RzOgoq
IFNwaWNlVXNiQmFja2VuZDogc3VwcG9ydHMgZW51bWVyYXRpb24gb2YgbG9jYWwgVVNCIGRldmlj
ZXMKICAoV2luZG93cyksIGhvdCBwbHVnL3VucGx1ZyBjYWxsYmFja3MgKExpbnV4KSBhbmQgZXZl
bnRzCiAgaGFuZGxpbmcuIEl0IHdyYXBzIGxpYnVzYl9jb250ZXh0CiogU3BpY2VVc2JCYWNrZW5k
RGV2aWNlOiByZXByZXNlbnQgbG9jYWwgVVNCIGRldmljZSwgcHJvdmlkZXMKICBhY2Nlc3MgdG8g
Y2FjaGVkIHByb3BlcnRpZXMgb2YgdGhlIGRldmljZSwgd3JhcHMgbGlidXNiX2RldmljZQoqIFNw
aWNlVXNiQmFja2VuZENoYW5uZWw6IGFjY3VtdWxhdGVzIHJlZGlyZWN0aW9uIGZ1bmN0aW9uYWxp
dHksCiAgd3JhcHMgdXNicmVkaXJob3N0CgpTaWduZWQtb2ZmLWJ5OiBZdXJpIEJlbmRpdG92aWNo
IDx5dXJpLmJlbmRpdG92aWNoQGRheW5peC5jb20+Ci0tLQogc3JjL01ha2VmaWxlLmFtICAgICAg
ICAgICAgICAgfCAgIDIgKwogc3JjL2NoYW5uZWwtdXNicmVkaXItcHJpdi5oICAgfCAgMTIgKy0K
IHNyYy9jaGFubmVsLXVzYnJlZGlyLmMgICAgICAgIHwgMjM2ICsrLS0tLS0tLS0tLQogc3JjL21l
c29uLmJ1aWxkICAgICAgICAgICAgICAgfCAgIDIgKwogc3JjL3VzYi1iYWNrZW5kLmMgICAgICAg
ICAgICAgfCA2NTcgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogc3JjL3VzYi1i
YWNrZW5kLmggICAgICAgICAgICAgfCAxMDIgKysrKysrCiBzcmMvdXNiLWRldmljZS1tYW5hZ2Vy
LXByaXYuaCB8ICAgMSAtCiBzcmMvdXNiLWRldmljZS1tYW5hZ2VyLmMgICAgICB8IDMzNiArKysr
KystLS0tLS0tLS0tLQogc3JjL3dpbi11c2ItZGV2LmMgICAgICAgICAgICAgfCAxMDMgKystLS0t
CiBzcmMvd2luLXVzYi1kZXYuaCAgICAgICAgICAgICB8ICAgNSArLQogMTAgZmlsZXMgY2hhbmdl
ZCwgOTQ4IGluc2VydGlvbnMoKyksIDUwOCBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0
NCBzcmMvdXNiLWJhY2tlbmQuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IHNyYy91c2ItYmFja2VuZC5o
CgpkaWZmIC0tZ2l0IGEvc3JjL01ha2VmaWxlLmFtIGIvc3JjL01ha2VmaWxlLmFtCmluZGV4IDdh
N2VjYjQuLmJlYTQxMDAgMTAwNjQ0Ci0tLSBhL3NyYy9NYWtlZmlsZS5hbQorKysgYi9zcmMvTWFr
ZWZpbGUuYW0KQEAgLTI2NCw2ICsyNjQsOCBAQCBsaWJzcGljZV9jbGllbnRfZ2xpYl9pbXBsX2xh
X1NPVVJDRVMgPQkJCVwKIAlzcGljZS11cmktcHJpdi5oCQkJCVwKIAl1c2ItZGV2aWNlLW1hbmFn
ZXIuYwkJCQlcCiAJdXNiLWRldmljZS1tYW5hZ2VyLXByaXYuaAkJCVwKKwl1c2ItYmFja2VuZC5j
CQkJCQlcCisJdXNiLWJhY2tlbmQuaAkJCQkJXAogCXVzYnV0aWwuYwkJCQkJXAogCXVzYnV0aWwu
aAkJCQkJXAogCSQoVVNCX0FDTF9IRUxQRVJfU1JDUykJCQkJXApkaWZmIC0tZ2l0IGEvc3JjL2No
YW5uZWwtdXNicmVkaXItcHJpdi5oIGIvc3JjL2NoYW5uZWwtdXNicmVkaXItcHJpdi5oCmluZGV4
IDFlYThhMTkuLjgwY2QzMWYgMTAwNjQ0Ci0tLSBhL3NyYy9jaGFubmVsLXVzYnJlZGlyLXByaXYu
aAorKysgYi9zcmMvY2hhbm5lbC11c2JyZWRpci1wcml2LmgKQEAgLTIzLDkgKzIzLDggQEAKIAog
I2lmZGVmIFVTRV9VU0JSRURJUgogCi0jaW5jbHVkZSA8bGlidXNiLmg+Ci0jaW5jbHVkZSA8dXNi
cmVkaXJmaWx0ZXIuaD4KICNpbmNsdWRlICJzcGljZS1jbGllbnQuaCIKKyNpbmNsdWRlICJ1c2It
YmFja2VuZC5oIgogCiBHX0JFR0lOX0RFQ0xTCiAKQEAgLTMzLDcgKzMyLDcgQEAgR19CRUdJTl9E
RUNMUwogICAgY29udGV4dCBzaG91bGQgbm90IGJlIGRlc3Ryb3llZCBiZWZvcmUgdGhlIGxhc3Qg
ZGV2aWNlIGhhcyBiZWVuCiAgICBkaXNjb25uZWN0ZWQgKi8KIHZvaWQgc3BpY2VfdXNicmVkaXJf
Y2hhbm5lbF9zZXRfY29udGV4dChTcGljZVVzYnJlZGlyQ2hhbm5lbCAqY2hhbm5lbCwKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ1c2JfY29udGV4dCAgICAgICAq
Y29udGV4dCk7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VV
c2JCYWNrZW5kICAgICAgKmNvbnRleHQpOwogCiB2b2lkIHNwaWNlX3VzYnJlZGlyX2NoYW5uZWxf
ZGlzY29ubmVjdF9kZXZpY2VfYXN5bmMoU3BpY2VVc2JyZWRpckNoYW5uZWwgKmNoYW5uZWwsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR0NhbmNl
bGxhYmxlICpjYW5jZWxsYWJsZSwKQEAgLTQ4LDcgKzQ3LDcgQEAgZ2Jvb2xlYW4gc3BpY2VfdXNi
cmVkaXJfY2hhbm5lbF9kaXNjb25uZWN0X2RldmljZV9maW5pc2goU3BpY2VVc2JyZWRpckNoYW5u
ZWwgKmMKICAgICh0aHJvdWdoIHNwaWNlX2NoYW5uZWxfY29ubmVjdCgpKSwgYmVmb3JlIGNhbGxp
bmcgdGhpcy4gKi8KIHZvaWQgc3BpY2VfdXNicmVkaXJfY2hhbm5lbF9jb25uZWN0X2RldmljZV9h
c3luYygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZVVzYnJl
ZGlyQ2hhbm5lbCAqY2hhbm5lbCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBsaWJ1c2JfZGV2aWNlICAgICAgICAqZGV2aWNlLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2aWNlLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNlVXNiRGV2aWNlICAgICAgICpz
cGljZV9kZXZpY2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR0Nh
bmNlbGxhYmxlICAgICAgICAgKmNhbmNlbGxhYmxlLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIEdBc3luY1JlYWR5Q2FsbGJhY2sgICBjYWxsYmFjaywKQEAgLTYwLDcg
KzU5LDcgQEAgZ2Jvb2xlYW4gc3BpY2VfdXNicmVkaXJfY2hhbm5lbF9jb25uZWN0X2RldmljZV9m
aW5pc2goCiAKIHZvaWQgc3BpY2VfdXNicmVkaXJfY2hhbm5lbF9kaXNjb25uZWN0X2RldmljZShT
cGljZVVzYnJlZGlyQ2hhbm5lbCAqY2hhbm5lbCk7CiAKLWxpYnVzYl9kZXZpY2UgKnNwaWNlX3Vz
YnJlZGlyX2NoYW5uZWxfZ2V0X2RldmljZShTcGljZVVzYnJlZGlyQ2hhbm5lbCAqY2hhbm5lbCk7
CitTcGljZVVzYkJhY2tlbmREZXZpY2UgKnNwaWNlX3VzYnJlZGlyX2NoYW5uZWxfZ2V0X2Rldmlj
ZShTcGljZVVzYnJlZGlyQ2hhbm5lbCAqY2hhbm5lbCk7CiAKIHZvaWQgc3BpY2VfdXNicmVkaXJf
Y2hhbm5lbF9sb2NrKFNwaWNlVXNicmVkaXJDaGFubmVsICpjaGFubmVsKTsKIApAQCAtNzEsNiAr
NzAsOSBAQCB2b2lkIHNwaWNlX3VzYnJlZGlyX2NoYW5uZWxfZ2V0X2d1ZXN0X2ZpbHRlcigKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RydWN0IHVzYnJlZGlyZmlsdGVyX3J1bGUg
ICoqcnVsZXNfcmV0LAogICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICpydWxlc19jb3VudF9yZXQpOwogCisvKiBDYWxsYmFjayBmb3Ig
VVNCIGJhY2tlbmQgKi8KK2ludCBzcGljZV91c2JyZWRpcl93cml0ZV9jYWxsYmFjayhTcGljZVVz
YnJlZGlyQ2hhbm5lbCAqY2hhbm5lbCwgdWludDhfdCAqZGF0YSwgaW50IGNvdW50KTsKKwogR19F
TkRfREVDTFMKIAogI2VuZGlmIC8qIFVTRV9VU0JSRURJUiAqLwpkaWZmIC0tZ2l0IGEvc3JjL2No
YW5uZWwtdXNicmVkaXIuYyBiL3NyYy9jaGFubmVsLXVzYnJlZGlyLmMKaW5kZXggYTU0ZjY3Yi4u
NzY1MzQxOCAxMDA2NDQKLS0tIGEvc3JjL2NoYW5uZWwtdXNicmVkaXIuYworKysgYi9zcmMvY2hh
bm5lbC11c2JyZWRpci5jCkBAIC0yMyw3ICsyMyw2IEBACiAKICNpZmRlZiBVU0VfVVNCUkVESVIK
ICNpbmNsdWRlIDxnbGliL2dpMThuLWxpYi5oPgotI2luY2x1ZGUgPHVzYnJlZGlyaG9zdC5oPgog
I2lmZGVmIFVTRV9MWjQKICNpbmNsdWRlIDxsejQuaD4KICNlbmRpZgpAQCAtNjMsMTUgKzYyLDEw
IEBAIGVudW0gU3BpY2VVc2JyZWRpckNoYW5uZWxTdGF0ZSB7CiB9OwogCiBzdHJ1Y3QgX1NwaWNl
VXNicmVkaXJDaGFubmVsUHJpdmF0ZSB7Ci0gICAgbGlidXNiX2RldmljZSAqZGV2aWNlOworICAg
IFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2aWNlOwogICAgIFNwaWNlVXNiRGV2aWNlICpzcGlj
ZV9kZXZpY2U7Ci0gICAgbGlidXNiX2NvbnRleHQgKmNvbnRleHQ7Ci0gICAgc3RydWN0IHVzYnJl
ZGlyaG9zdCAqaG9zdDsKLSAgICAvKiBUbyBjYXRjaCB1c2JyZWRpcmhvc3QgZXJyb3IgbWVzc2Fn
ZXMgYW5kIHJlcG9ydCB0aGVtIGFzIGEgR0Vycm9yICovCi0gICAgR0Vycm9yICoqY2F0Y2hfZXJy
b3I7Ci0gICAgLyogRGF0YSBwYXNzZWQgZnJvbSBjaGFubmVsIGhhbmRsZSBtc2cgdG8gdGhlIHVz
YnJlZGlyaG9zdCByZWFkIGNiICovCi0gICAgY29uc3QgdWludDhfdCAqcmVhZF9idWY7Ci0gICAg
aW50IHJlYWRfYnVmX3NpemU7CisgICAgU3BpY2VVc2JCYWNrZW5kICpjb250ZXh0OworICAgIFNw
aWNlVXNiQmFja2VuZENoYW5uZWwgKmhvc3Q7CiAgICAgZW51bSBTcGljZVVzYnJlZGlyQ2hhbm5l
bFN0YXRlIHN0YXRlOwogI2lmZGVmIFVTRV9QT0xLSVQKICAgICBHVGFzayAqdGFzazsKQEAgLTg3
LDE2ICs4MSw2IEBAIHN0YXRpYyB2b2lkIHNwaWNlX3VzYnJlZGlyX2NoYW5uZWxfZGlzcG9zZShH
T2JqZWN0ICpvYmopOwogc3RhdGljIHZvaWQgc3BpY2VfdXNicmVkaXJfY2hhbm5lbF9maW5hbGl6
ZShHT2JqZWN0ICpvYmopOwogc3RhdGljIHZvaWQgdXNicmVkaXJfaGFuZGxlX21zZyhTcGljZUNo
YW5uZWwgKmNoYW5uZWwsIFNwaWNlTXNnSW4gKmluKTsKIAotc3RhdGljIHZvaWQgdXNicmVkaXJf
bG9nKHZvaWQgKnVzZXJfZGF0YSwgaW50IGxldmVsLCBjb25zdCBjaGFyICptc2cpOwotc3RhdGlj
IGludCB1c2JyZWRpcl9yZWFkX2NhbGxiYWNrKHZvaWQgKnVzZXJfZGF0YSwgdWludDhfdCAqZGF0
YSwgaW50IGNvdW50KTsKLXN0YXRpYyBpbnQgdXNicmVkaXJfd3JpdGVfY2FsbGJhY2sodm9pZCAq
dXNlcl9kYXRhLCB1aW50OF90ICpkYXRhLCBpbnQgY291bnQpOwotc3RhdGljIHZvaWQgdXNicmVk
aXJfd3JpdGVfZmx1c2hfY2FsbGJhY2sodm9pZCAqdXNlcl9kYXRhKTsKLXN0YXRpYyB1aW50NjRf
dCB1c2JyZWRpcl9idWZmZXJlZF9vdXRwdXRfc2l6ZV9jYWxsYmFjayh2b2lkICp1c2VyX2RhdGEp
OwotCi1zdGF0aWMgdm9pZCAqdXNicmVkaXJfYWxsb2NfbG9jayh2b2lkKTsKLXN0YXRpYyB2b2lk
IHVzYnJlZGlyX2xvY2tfbG9jayh2b2lkICp1c2VyX2RhdGEpOwotc3RhdGljIHZvaWQgdXNicmVk
aXJfdW5sb2NrX2xvY2sodm9pZCAqdXNlcl9kYXRhKTsKLXN0YXRpYyB2b2lkIHVzYnJlZGlyX2Zy
ZWVfbG9jayh2b2lkICp1c2VyX2RhdGEpOwogCiBHX0RFRklORV9UWVBFX1dJVEhfUFJJVkFURShT
cGljZVVzYnJlZGlyQ2hhbm5lbCwgc3BpY2VfdXNicmVkaXJfY2hhbm5lbCwgU1BJQ0VfVFlQRV9D
SEFOTkVMKQogCkBAIC0xMTUsNyArOTksNyBAQCBzdGF0aWMgdm9pZCBfY2hhbm5lbF9yZXNldF9m
aW5pc2goU3BpY2VVc2JyZWRpckNoYW5uZWwgKmNoYW5uZWwsIGdib29sZWFuIG1pZ3JhdAogCiAg
ICAgc3BpY2VfdXNicmVkaXJfY2hhbm5lbF9sb2NrKGNoYW5uZWwpOwogCi0gICAgdXNicmVkaXJo
b3N0X2Nsb3NlKHByaXYtPmhvc3QpOworICAgIHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfZGVs
ZXRlKHByaXYtPmhvc3QpOwogICAgIHByaXYtPmhvc3QgPSBOVUxMOwogCiAgICAgLyogQ2FsbCBz
ZXRfY29udGV4dCB0byByZS1jcmVhdGUgdGhlIGhvc3QgKi8KQEAgLTIyMSw3ICsyMDUsNyBAQCBz
dGF0aWMgdm9pZCBzcGljZV91c2JyZWRpcl9jaGFubmVsX2ZpbmFsaXplKEdPYmplY3QgKm9iaikK
ICAgICBTcGljZVVzYnJlZGlyQ2hhbm5lbCAqY2hhbm5lbCA9IFNQSUNFX1VTQlJFRElSX0NIQU5O
RUwob2JqKTsKIAogICAgIGlmIChjaGFubmVsLT5wcml2LT5ob3N0KQotICAgICAgICB1c2JyZWRp
cmhvc3RfY2xvc2UoY2hhbm5lbC0+cHJpdi0+aG9zdCk7CisgICAgICAgIHNwaWNlX3VzYl9iYWNr
ZW5kX2NoYW5uZWxfZGVsZXRlKGNoYW5uZWwtPnByaXYtPmhvc3QpOwogICAgIGdfbXV0ZXhfY2xl
YXIoJmNoYW5uZWwtPnByaXYtPmRldmljZV9jb25uZWN0X211dGV4KTsKIAogICAgIC8qIENoYWlu
IHVwIHRvIHRoZSBwYXJlbnQgY2xhc3MgKi8KQEAgLTI0NCwzMCArMjI4LDE3IEBAIHN0YXRpYyB2
b2lkIGNoYW5uZWxfc2V0X2hhbmRsZXJzKFNwaWNlQ2hhbm5lbENsYXNzICprbGFzcykKIAogR19H
TlVDX0lOVEVSTkFMCiB2b2lkIHNwaWNlX3VzYnJlZGlyX2NoYW5uZWxfc2V0X2NvbnRleHQoU3Bp
Y2VVc2JyZWRpckNoYW5uZWwgKmNoYW5uZWwsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgbGlidXNiX2NvbnRleHQgICAgICAgKmNvbnRleHQpCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VVc2JCYWNrZW5kICAgICAgKmNvbnRleHQp
CiB7CiAgICAgU3BpY2VVc2JyZWRpckNoYW5uZWxQcml2YXRlICpwcml2ID0gY2hhbm5lbC0+cHJp
djsKIAogICAgIGdfcmV0dXJuX2lmX2ZhaWwocHJpdi0+aG9zdCA9PSBOVUxMKTsKIAogICAgIHBy
aXYtPmNvbnRleHQgPSBjb250ZXh0OwotICAgIHByaXYtPmhvc3QgPSB1c2JyZWRpcmhvc3Rfb3Bl
bl9mdWxsKAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LCBOVUxM
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2JyZWRpcl9sb2csCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzYnJlZGlyX3JlYWRfY2FsbGJhY2ssCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzYnJlZGlyX3dyaXRlX2NhbGxiYWNr
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2JyZWRpcl93cml0ZV9mbHVz
aF9jYWxsYmFjaywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNicmVkaXJf
YWxsb2NfbG9jaywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNicmVkaXJf
bG9ja19sb2NrLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2JyZWRpcl91
bmxvY2tfbG9jaywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNicmVkaXJf
ZnJlZV9sb2NrLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVsLCBQ
QUNLQUdFX1NUUklORywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BpY2Vf
dXRpbF9nZXRfZGVidWcoKSA/IHVzYnJlZGlycGFyc2VyX2RlYnVnIDogdXNicmVkaXJwYXJzZXJf
d2FybmluZywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNicmVkaXJob3N0
X2ZsX3dyaXRlX2NiX293bnNfYnVmZmVyKTsKKyAgICBwcml2LT5ob3N0ID0gc3BpY2VfdXNiX2Jh
Y2tlbmRfY2hhbm5lbF9uZXcoY29udGV4dCwgY2hhbm5lbCk7CiAgICAgaWYgKCFwcml2LT5ob3N0
KQotICAgICAgICBnX2Vycm9yKCJPdXQgb2YgbWVtb3J5IGFsbG9jYXRpbmcgdXNicmVkaXJob3N0
Iik7CisgICAgICAgIGdfZXJyb3IoIk91dCBvZiBtZW1vcnkgaW5pdGlhbGl6aW5nIHJlZGlyZWN0
aW9uIHN1cHBvcnQiKTsKIAotICAgIHVzYnJlZGlyaG9zdF9zZXRfYnVmZmVyZWRfb3V0cHV0X3Np
emVfY2IocHJpdi0+aG9zdCwgdXNicmVkaXJfYnVmZmVyZWRfb3V0cHV0X3NpemVfY2FsbGJhY2sp
OwogI2lmZGVmIFVTRV9MWjQKICAgICBzcGljZV9jaGFubmVsX3NldF9jYXBhYmlsaXR5KGNoYW5u
ZWwsIFNQSUNFX1NQSUNFVk1DX0NBUF9EQVRBX0NPTVBSRVNTX0xaNCk7CiAjZW5kaWYKQEAgLTI3
OCw4ICsyNDksNiBAQCBzdGF0aWMgZ2Jvb2xlYW4gc3BpY2VfdXNicmVkaXJfY2hhbm5lbF9vcGVu
X2RldmljZSgKIHsKICAgICBTcGljZVVzYnJlZGlyQ2hhbm5lbFByaXZhdGUgKnByaXYgPSBjaGFu
bmVsLT5wcml2OwogICAgIFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbjsKLSAgICBsaWJ1c2JfZGV2aWNl
X2hhbmRsZSAqaGFuZGxlID0gTlVMTDsKLSAgICBpbnQgcmMsIHN0YXR1czsKICAgICBTcGljZVVz
YkRldmljZU1hbmFnZXIgKm1hbmFnZXI7CiAKICAgICBnX3JldHVybl92YWxfaWZfZmFpbChwcml2
LT5zdGF0ZSA9PSBTVEFURV9ESVNDT05ORUNURUQKQEAgLTI4OCwxOSArMjU3LDExIEBAIHN0YXRp
YyBnYm9vbGVhbiBzcGljZV91c2JyZWRpcl9jaGFubmVsX29wZW5fZGV2aWNlKAogI2VuZGlmCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgLCBGQUxTRSk7CiAKLSAgICByYyA9IGxpYnVzYl9vcGVu
KHByaXYtPmRldmljZSwgJmhhbmRsZSk7Ci0gICAgaWYgKHJjICE9IDApIHsKLSAgICAgICAgZ19z
ZXRfZXJyb3IoZXJyLCBTUElDRV9DTElFTlRfRVJST1IsIFNQSUNFX0NMSUVOVF9FUlJPUl9GQUlM
RUQsCi0gICAgICAgICAgICAgICAgICAgICJDb3VsZCBub3Qgb3BlbiB1c2IgZGV2aWNlOiAlcyBb
JWldIiwKLSAgICAgICAgICAgICAgICAgICAgbGlidXNiX3N0cmVycm9yKHJjKSwgcmMpOwotICAg
ICAgICByZXR1cm4gRkFMU0U7Ci0gICAgfQotCi0gICAgcHJpdi0+Y2F0Y2hfZXJyb3IgPSBlcnI7
Ci0gICAgc3RhdHVzID0gdXNicmVkaXJob3N0X3NldF9kZXZpY2UocHJpdi0+aG9zdCwgaGFuZGxl
KTsKLSAgICBwcml2LT5jYXRjaF9lcnJvciA9IE5VTEw7Ci0gICAgaWYgKHN0YXR1cyAhPSB1c2Jf
cmVkaXJfc3VjY2VzcykgewotICAgICAgICBnX3JldHVybl92YWxfaWZfZmFpbChlcnIgPT0gTlVM
TCB8fCAqZXJyICE9IE5VTEwsIEZBTFNFKTsKKyAgICBpZiAoIXNwaWNlX3VzYl9iYWNrZW5kX2No
YW5uZWxfYXR0YWNoKHByaXYtPmhvc3QsIHByaXYtPmRldmljZSwgZXJyKSkgeworICAgICAgICBp
ZiAoKmVyciA9PSBOVUxMKSB7CisgICAgICAgICAgICBnX3NldF9lcnJvcihlcnIsIFNQSUNFX0NM
SUVOVF9FUlJPUiwgU1BJQ0VfQ0xJRU5UX0VSUk9SX0ZBSUxFRCwKKyAgICAgICAgICAgICAgICAi
RXJyb3IgYXR0YWNoaW5nIGRldmljZTogKG5vIGVycm9yIGluZm9ybWF0aW9uKSIpOworICAgICAg
ICB9CiAgICAgICAgIHJldHVybiBGQUxTRTsKICAgICB9CiAKQEAgLTMxMCw3ICsyNzEsNyBAQCBz
dGF0aWMgZ2Jvb2xlYW4gc3BpY2VfdXNicmVkaXJfY2hhbm5lbF9vcGVuX2RldmljZSgKIAogICAg
IHByaXYtPnVzYl9kZXZpY2VfbWFuYWdlciA9IGdfb2JqZWN0X3JlZihtYW5hZ2VyKTsKICAgICBp
ZiAoIXNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9zdGFydF9ldmVudF9saXN0ZW5pbmcocHJpdi0+
dXNiX2RldmljZV9tYW5hZ2VyLCBlcnIpKSB7Ci0gICAgICAgIHVzYnJlZGlyaG9zdF9zZXRfZGV2
aWNlKHByaXYtPmhvc3QsIE5VTEwpOworICAgICAgICBzcGljZV91c2JfYmFja2VuZF9jaGFubmVs
X2RldGFjaChwcml2LT5ob3N0KTsKICAgICAgICAgcmV0dXJuIEZBTFNFOwogICAgIH0KIApAQCAt
MzQxLDggKzMwMiw3IEBAIHN0YXRpYyB2b2lkIHNwaWNlX3VzYnJlZGlyX2NoYW5uZWxfb3Blbl9h
Y2xfY2IoCiAgICAgICAgIHNwaWNlX3VzYnJlZGlyX2NoYW5uZWxfb3Blbl9kZXZpY2UoY2hhbm5l
bCwgJmVycik7CiAgICAgfQogICAgIGlmIChlcnIpIHsKLSAgICAgICAgbGlidXNiX3VucmVmX2Rl
dmljZShwcml2LT5kZXZpY2UpOwotICAgICAgICBwcml2LT5kZXZpY2UgPSBOVUxMOworICAgICAg
ICBnX2NsZWFyX3BvaW50ZXIoJnByaXYtPmRldmljZSwgc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNl
X3VucmVmKTsKICAgICAgICAgZ19ib3hlZF9mcmVlKHNwaWNlX3VzYl9kZXZpY2VfZ2V0X3R5cGUo
KSwgcHJpdi0+c3BpY2VfZGV2aWNlKTsKICAgICAgICAgcHJpdi0+c3BpY2VfZGV2aWNlID0gTlVM
TDsKICAgICAgICAgcHJpdi0+c3RhdGUgID0gU1RBVEVfRElTQ09OTkVDVEVEOwpAQCAtMzczLDgg
KzMzMyw3IEBAIF9vcGVuX2RldmljZV9hc3luY19jYihHVGFzayAqdGFzaywKICAgICBzcGljZV91
c2JyZWRpcl9jaGFubmVsX2xvY2soY2hhbm5lbCk7CiAKICAgICBpZiAoIXNwaWNlX3VzYnJlZGly
X2NoYW5uZWxfb3Blbl9kZXZpY2UoY2hhbm5lbCwgJmVycikpIHsKLSAgICAgICAgbGlidXNiX3Vu
cmVmX2RldmljZShwcml2LT5kZXZpY2UpOwotICAgICAgICBwcml2LT5kZXZpY2UgPSBOVUxMOwor
ICAgICAgICBnX2NsZWFyX3BvaW50ZXIoJnByaXYtPmRldmljZSwgc3BpY2VfdXNiX2JhY2tlbmRf
ZGV2aWNlX3VucmVmKTsKICAgICAgICAgZ19ib3hlZF9mcmVlKHNwaWNlX3VzYl9kZXZpY2VfZ2V0
X3R5cGUoKSwgcHJpdi0+c3BpY2VfZGV2aWNlKTsKICAgICAgICAgcHJpdi0+c3BpY2VfZGV2aWNl
ID0gTlVMTDsKICAgICB9CkBAIC0zOTIsMTMgKzM1MSwxNiBAQCBfb3Blbl9kZXZpY2VfYXN5bmNf
Y2IoR1Rhc2sgKnRhc2ssCiBHX0dOVUNfSU5URVJOQUwKIHZvaWQgc3BpY2VfdXNicmVkaXJfY2hh
bm5lbF9jb25uZWN0X2RldmljZV9hc3luYygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIFNwaWNlVXNicmVkaXJDaGFubmVsICpjaGFubmVsLAotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlidXNiX2RldmljZSAgICAgICAgKmRldmlj
ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNlVXNiQmFj
a2VuZERldmljZSAqZGV2aWNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgU3BpY2VVc2JEZXZpY2UgICAgICAgKnNwaWNlX2RldmljZSwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdDYW5jZWxsYWJsZSAgICAgICAgICpjYW5jZWxs
YWJsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdBc3luY1Jl
YWR5Q2FsbGJhY2sgICBjYWxsYmFjaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGdwb2ludGVyICAgICAgICAgICAgICB1c2VyX2RhdGEpCiB7CiAgICAgU3BpY2VV
c2JyZWRpckNoYW5uZWxQcml2YXRlICpwcml2ID0gY2hhbm5lbC0+cHJpdjsKKyNpZmRlZiBVU0Vf
UE9MS0lUCisgICAgY29uc3QgVXNiRGV2aWNlSW5mb3JtYXRpb24gKmluZm8gPSBzcGljZV91c2Jf
YmFja2VuZF9kZXZpY2VfZ2V0X2luZm8oZGV2aWNlKTsKKyNlbmRpZgogICAgIEdUYXNrICp0YXNr
OwogCiAgICAgZ19yZXR1cm5faWZfZmFpbChTUElDRV9JU19VU0JSRURJUl9DSEFOTkVMKGNoYW5u
ZWwpKTsKQEAgLTQyNSw3ICszODcsNyBAQCB2b2lkIHNwaWNlX3VzYnJlZGlyX2NoYW5uZWxfY29u
bmVjdF9kZXZpY2VfYXN5bmMoCiAgICAgICAgIGdvdG8gZG9uZTsKICAgICB9CiAKLSAgICBwcml2
LT5kZXZpY2UgPSBsaWJ1c2JfcmVmX2RldmljZShkZXZpY2UpOworICAgIHByaXYtPmRldmljZSA9
IHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9yZWYoZGV2aWNlKTsKICAgICBwcml2LT5zcGljZV9k
ZXZpY2UgPSBnX2JveGVkX2NvcHkoc3BpY2VfdXNiX2RldmljZV9nZXRfdHlwZSgpLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGljZV9kZXZpY2UpOwogI2lmZGVmIFVT
RV9QT0xLSVQKQEAgLTQzNSw4ICszOTcsOCBAQCB2b2lkIHNwaWNlX3VzYnJlZGlyX2NoYW5uZWxf
Y29ubmVjdF9kZXZpY2VfYXN5bmMoCiAgICAgZ19vYmplY3Rfc2V0KHNwaWNlX2NoYW5uZWxfZ2V0
X3Nlc3Npb24oU1BJQ0VfQ0hBTk5FTChjaGFubmVsKSksCiAgICAgICAgICAgICAgICAgICJpbmhp
Yml0LWtleWJvYXJkLWdyYWIiLCBUUlVFLCBOVUxMKTsKICAgICBzcGljZV91c2JfYWNsX2hlbHBl
cl9vcGVuX2FjbF9hc3luYyhwcml2LT5hY2xfaGVscGVyLAotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGxpYnVzYl9nZXRfYnVzX251bWJlcihkZXZpY2UpLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnVzYl9nZXRfZGV2aWNlX2FkZHJl
c3MoZGV2aWNlKSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZv
LT5idXMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mby0+YWRk
cmVzcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxsYWJs
ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGljZV91c2JyZWRp
cl9jaGFubmVsX29wZW5fYWNsX2NiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGNoYW5uZWwpOwpAQCAtNDk0LDkgKzQ1Niw4IEBAIHZvaWQgc3BpY2VfdXNicmVkaXJf
Y2hhbm5lbF9kaXNjb25uZWN0X2RldmljZShTcGljZVVzYnJlZGlyQ2hhbm5lbCAqY2hhbm5lbCkK
ICAgICAgICAgZ19jbGVhcl9vYmplY3QoJnByaXYtPnVzYl9kZXZpY2VfbWFuYWdlcik7CiAKICAg
ICAgICAgLyogVGhpcyBhbHNvIGNsb3NlcyB0aGUgbGlidXNiIGhhbmRsZSB3ZSBwYXNzZWQgZnJv
bSBvcGVuX2RldmljZSAqLwotICAgICAgICB1c2JyZWRpcmhvc3Rfc2V0X2RldmljZShwcml2LT5o
b3N0LCBOVUxMKTsKLSAgICAgICAgbGlidXNiX3VucmVmX2RldmljZShwcml2LT5kZXZpY2UpOwot
ICAgICAgICBwcml2LT5kZXZpY2UgPSBOVUxMOworICAgICAgICBzcGljZV91c2JfYmFja2VuZF9j
aGFubmVsX2RldGFjaChwcml2LT5ob3N0KTsKKyAgICAgICAgZ19jbGVhcl9wb2ludGVyKCZwcml2
LT5kZXZpY2UsIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV91bnJlZik7CiAgICAgICAgIGdfYm94
ZWRfZnJlZShzcGljZV91c2JfZGV2aWNlX2dldF90eXBlKCksIHByaXYtPnNwaWNlX2RldmljZSk7
CiAgICAgICAgIHByaXYtPnNwaWNlX2RldmljZSA9IE5VTEw7CiAgICAgICAgIHByaXYtPnN0YXRl
ICA9IFNUQVRFX0RJU0NPTk5FQ1RFRDsKQEAgLTU0Nyw3ICs1MDgsNyBAQCBzcGljZV91c2JyZWRp
cl9jaGFubmVsX2dldF9zcGljZV91c2JfZGV2aWNlKFNwaWNlVXNicmVkaXJDaGFubmVsICpjaGFu
bmVsKQogI2VuZGlmCiAKIEdfR05VQ19JTlRFUk5BTAotbGlidXNiX2RldmljZSAqc3BpY2VfdXNi
cmVkaXJfY2hhbm5lbF9nZXRfZGV2aWNlKFNwaWNlVXNicmVkaXJDaGFubmVsICpjaGFubmVsKQor
U3BpY2VVc2JCYWNrZW5kRGV2aWNlICpzcGljZV91c2JyZWRpcl9jaGFubmVsX2dldF9kZXZpY2Uo
U3BpY2VVc2JyZWRpckNoYW5uZWwgKmNoYW5uZWwpCiB7CiAgICAgcmV0dXJuIGNoYW5uZWwtPnBy
aXYtPmRldmljZTsKIH0KQEAgLTU2Miw5MSArNTIzLDE4IEBAIHZvaWQgc3BpY2VfdXNicmVkaXJf
Y2hhbm5lbF9nZXRfZ3Vlc3RfZmlsdGVyKAogCiAgICAgZ19yZXR1cm5faWZfZmFpbChwcml2LT5o
b3N0ICE9IE5VTEwpOwogCi0gICAgdXNicmVkaXJob3N0X2dldF9ndWVzdF9maWx0ZXIocHJpdi0+
aG9zdCwgcnVsZXNfcmV0LCBydWxlc19jb3VudF9yZXQpOworICAgIHNwaWNlX3VzYl9iYWNrZW5k
X2NoYW5uZWxfZ2V0X2d1ZXN0X2ZpbHRlcihwcml2LT5ob3N0LCBydWxlc19yZXQsIHJ1bGVzX2Nv
dW50X3JldCk7CiB9CiAKIC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwogLyogY2FsbGJhY2tzIChhbnkgY29udGV4
dCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovCiAKLXN0YXRp
YyB1aW50NjRfdCB1c2JyZWRpcl9idWZmZXJlZF9vdXRwdXRfc2l6ZV9jYWxsYmFjayh2b2lkICp1
c2VyX2RhdGEpCi17Ci0gICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwoU1BJQ0VfSVNfVVNCUkVESVJf
Q0hBTk5FTCh1c2VyX2RhdGEpLCAwKTsKLSAgICByZXR1cm4gc3BpY2VfY2hhbm5lbF9nZXRfcXVl
dWVfc2l6ZShTUElDRV9DSEFOTkVMKHVzZXJfZGF0YSkpOwotfQotCi0vKiBOb3RlIHRoYXQgdGhp
cyBmdW5jdGlvbiBtdXN0IGJlIHJlLWVudHJhbnQgc2FmZSwgYXMgaXQgY2FuIGdldCBjYWxsZWQK
LSAgIGZyb20gYm90aCB0aGUgbWFpbiB0aHJlYWQgYXMgd2VsbCBhcyBmcm9tIHRoZSB1c2IgZXZl
bnQgaGFuZGxpbmcgdGhyZWFkICovCi1zdGF0aWMgdm9pZCB1c2JyZWRpcl93cml0ZV9mbHVzaF9j
YWxsYmFjayh2b2lkICp1c2VyX2RhdGEpCi17Ci0gICAgU3BpY2VVc2JyZWRpckNoYW5uZWwgKmNo
YW5uZWwgPSBTUElDRV9VU0JSRURJUl9DSEFOTkVMKHVzZXJfZGF0YSk7Ci0gICAgU3BpY2VVc2Jy
ZWRpckNoYW5uZWxQcml2YXRlICpwcml2ID0gY2hhbm5lbC0+cHJpdjsKLQotICAgIGlmIChzcGlj
ZV9jaGFubmVsX2dldF9zdGF0ZShTUElDRV9DSEFOTkVMKGNoYW5uZWwpKSAhPQotICAgICAgICAg
ICAgU1BJQ0VfQ0hBTk5FTF9TVEFURV9SRUFEWSkKLSAgICAgICAgcmV0dXJuOwotCi0gICAgaWYg
KCFwcml2LT5ob3N0KQotICAgICAgICByZXR1cm47Ci0KLSAgICB1c2JyZWRpcmhvc3Rfd3JpdGVf
Z3Vlc3RfZGF0YShwcml2LT5ob3N0KTsKLX0KLQotc3RhdGljIHZvaWQgdXNicmVkaXJfbG9nKHZv
aWQgKnVzZXJfZGF0YSwgaW50IGxldmVsLCBjb25zdCBjaGFyICptc2cpCi17Ci0gICAgU3BpY2VV
c2JyZWRpckNoYW5uZWwgKmNoYW5uZWwgPSB1c2VyX2RhdGE7Ci0gICAgU3BpY2VVc2JyZWRpckNo
YW5uZWxQcml2YXRlICpwcml2ID0gY2hhbm5lbC0+cHJpdjsKLQotICAgIGlmIChwcml2LT5jYXRj
aF9lcnJvciAmJiBsZXZlbCA9PSB1c2JyZWRpcnBhcnNlcl9lcnJvcikgewotICAgICAgICBDSEFO
TkVMX0RFQlVHKGNoYW5uZWwsICIlcyIsIG1zZyk7Ci0gICAgICAgIC8qIFJlbW92ZSAidXNicmVk
aXJob3N0OiAiIHByZWZpeCBmcm9tIHVzYnJlZGlyaG9zdCBtZXNzYWdlcyAqLwotICAgICAgICBp
ZiAoc3RybmNtcChtc2csICJ1c2JyZWRpcmhvc3Q6ICIsIDE0KSA9PSAwKQotICAgICAgICAgICAg
Z19zZXRfZXJyb3JfbGl0ZXJhbChwcml2LT5jYXRjaF9lcnJvciwgU1BJQ0VfQ0xJRU5UX0VSUk9S
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTUElDRV9DTElFTlRfRVJST1JfRkFJ
TEVELCBtc2cgKyAxNCk7Ci0gICAgICAgIGVsc2UKLSAgICAgICAgICAgIGdfc2V0X2Vycm9yX2xp
dGVyYWwocHJpdi0+Y2F0Y2hfZXJyb3IsIFNQSUNFX0NMSUVOVF9FUlJPUiwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgU1BJQ0VfQ0xJRU5UX0VSUk9SX0ZBSUxFRCwgbXNnKTsKLSAg
ICAgICAgcmV0dXJuOwotICAgIH0KLQotICAgIHN3aXRjaCAobGV2ZWwpIHsKLSAgICAgICAgY2Fz
ZSB1c2JyZWRpcnBhcnNlcl9lcnJvcjoKLSAgICAgICAgICAgIGdfY3JpdGljYWwoIiVzIiwgbXNn
KTsKLSAgICAgICAgICAgIGJyZWFrOwotICAgICAgICBjYXNlIHVzYnJlZGlycGFyc2VyX3dhcm5p
bmc6Ci0gICAgICAgICAgICBnX3dhcm5pbmcoIiVzIiwgbXNnKTsKLSAgICAgICAgICAgIGJyZWFr
OwotICAgICAgICBkZWZhdWx0OgotICAgICAgICAgICAgQ0hBTk5FTF9ERUJVRyhjaGFubmVsLCAi
JXMiLCBtc2cpOwotICAgIH0KLX0KLQotc3RhdGljIGludCB1c2JyZWRpcl9yZWFkX2NhbGxiYWNr
KHZvaWQgKnVzZXJfZGF0YSwgdWludDhfdCAqZGF0YSwgaW50IGNvdW50KQotewotICAgIFNwaWNl
VXNicmVkaXJDaGFubmVsICpjaGFubmVsID0gdXNlcl9kYXRhOwotICAgIFNwaWNlVXNicmVkaXJD
aGFubmVsUHJpdmF0ZSAqcHJpdiA9IGNoYW5uZWwtPnByaXY7Ci0KLSAgICBjb3VudCA9IE1JTihw
cml2LT5yZWFkX2J1Zl9zaXplLCBjb3VudCk7Ci0KLSAgICBpZiAoY291bnQgIT0gMCkgewotICAg
ICAgICBtZW1jcHkoZGF0YSwgcHJpdi0+cmVhZF9idWYsIGNvdW50KTsKLSAgICB9Ci0KLSAgICBw
cml2LT5yZWFkX2J1Zl9zaXplIC09IGNvdW50OwotICAgIGlmIChwcml2LT5yZWFkX2J1Zl9zaXpl
KSB7Ci0gICAgICAgIHByaXYtPnJlYWRfYnVmICs9IGNvdW50OwotICAgIH0gZWxzZSB7Ci0gICAg
ICAgIHByaXYtPnJlYWRfYnVmID0gTlVMTDsKLSAgICB9Ci0KLSAgICByZXR1cm4gY291bnQ7Ci19
Ci0KIHN0YXRpYyB2b2lkIHVzYnJlZGlyX2ZyZWVfd3JpdGVfY2JfZGF0YSh1aW50OF90ICpkYXRh
LCB2b2lkICp1c2VyX2RhdGEpCiB7CiAgICAgU3BpY2VVc2JyZWRpckNoYW5uZWwgKmNoYW5uZWwg
PSB1c2VyX2RhdGE7CiAgICAgU3BpY2VVc2JyZWRpckNoYW5uZWxQcml2YXRlICpwcml2ID0gY2hh
bm5lbC0+cHJpdjsKIAotICAgIHVzYnJlZGlyaG9zdF9mcmVlX3dyaXRlX2J1ZmZlcihwcml2LT5o
b3N0LCBkYXRhKTsKKyAgICBzcGljZV91c2JfYmFja2VuZF9yZXR1cm5fd3JpdGVfZGF0YShwcml2
LT5ob3N0LCBkYXRhKTsKIH0KIAogI2lmZGVmIFVTRV9MWjQKQEAgLTcxMSwxNCArNTk5LDE0IEBA
IHN0YXRpYyBpbnQgdHJ5X3dyaXRlX2NvbXByZXNzX0xaNChTcGljZVVzYnJlZGlyQ2hhbm5lbCAq
Y2hhbm5lbCwgdWludDhfdCAqZGF0YSwKIH0KICNlbmRpZgogCi1zdGF0aWMgaW50IHVzYnJlZGly
X3dyaXRlX2NhbGxiYWNrKHZvaWQgKnVzZXJfZGF0YSwgdWludDhfdCAqZGF0YSwgaW50IGNvdW50
KQorR19HTlVDX0lOVEVSTkFMCitpbnQgc3BpY2VfdXNicmVkaXJfd3JpdGVfY2FsbGJhY2soU3Bp
Y2VVc2JyZWRpckNoYW5uZWwgKmNoYW5uZWwsIHVpbnQ4X3QgKmRhdGEsIGludCBjb3VudCkKIHsK
LSAgICBTcGljZVVzYnJlZGlyQ2hhbm5lbCAqY2hhbm5lbCA9IHVzZXJfZGF0YTsKICAgICBTcGlj
ZU1zZ091dCAqbXNnX291dDsKIAogI2lmZGVmIFVTRV9MWjQKICAgICBpZiAodHJ5X3dyaXRlX2Nv
bXByZXNzX0xaNChjaGFubmVsLCBkYXRhLCBjb3VudCkpIHsKLSAgICAgICAgdXNicmVkaXJob3N0
X2ZyZWVfd3JpdGVfYnVmZmVyKGNoYW5uZWwtPnByaXYtPmhvc3QsIGRhdGEpOworICAgICAgICBz
cGljZV91c2JfYmFja2VuZF9yZXR1cm5fd3JpdGVfZGF0YShjaGFubmVsLT5wcml2LT5ob3N0LCBk
YXRhKTsKICAgICAgICAgcmV0dXJuIGNvdW50OwogICAgIH0KICNlbmRpZgpAQCAtNzMxLDE1ICs2
MTksNiBAQCBzdGF0aWMgaW50IHVzYnJlZGlyX3dyaXRlX2NhbGxiYWNrKHZvaWQgKnVzZXJfZGF0
YSwgdWludDhfdCAqZGF0YSwgaW50IGNvdW50KQogICAgIHJldHVybiBjb3VudDsKIH0KIAotc3Rh
dGljIHZvaWQgKnVzYnJlZGlyX2FsbG9jX2xvY2sodm9pZCkgewotICAgIEdNdXRleCAqbXV0ZXg7
Ci0KLSAgICBtdXRleCA9IGdfbmV3MChHTXV0ZXgsIDEpOwotICAgIGdfbXV0ZXhfaW5pdChtdXRl
eCk7Ci0KLSAgICByZXR1cm4gbXV0ZXg7Ci19Ci0KIEdfR05VQ19JTlRFUk5BTAogdm9pZCBzcGlj
ZV91c2JyZWRpcl9jaGFubmVsX2xvY2soU3BpY2VVc2JyZWRpckNoYW5uZWwgKmNoYW5uZWwpCiB7
CkBAIC03NTIsMjUgKzYzMSw2IEBAIHZvaWQgc3BpY2VfdXNicmVkaXJfY2hhbm5lbF91bmxvY2so
U3BpY2VVc2JyZWRpckNoYW5uZWwgKmNoYW5uZWwpCiAgICAgZ19tdXRleF91bmxvY2soJmNoYW5u
ZWwtPnByaXYtPmRldmljZV9jb25uZWN0X211dGV4KTsKIH0KIAotc3RhdGljIHZvaWQgdXNicmVk
aXJfbG9ja19sb2NrKHZvaWQgKnVzZXJfZGF0YSkgewotICAgIEdNdXRleCAqbXV0ZXggPSB1c2Vy
X2RhdGE7Ci0KLSAgICBnX211dGV4X2xvY2sobXV0ZXgpOwotfQotCi1zdGF0aWMgdm9pZCB1c2Jy
ZWRpcl91bmxvY2tfbG9jayh2b2lkICp1c2VyX2RhdGEpIHsKLSAgICBHTXV0ZXggKm11dGV4ID0g
dXNlcl9kYXRhOwotCi0gICAgZ19tdXRleF91bmxvY2sobXV0ZXgpOwotfQotCi1zdGF0aWMgdm9p
ZCB1c2JyZWRpcl9mcmVlX2xvY2sodm9pZCAqdXNlcl9kYXRhKSB7Ci0gICAgR011dGV4ICptdXRl
eCA9IHVzZXJfZGF0YTsKLQotICAgIGdfbXV0ZXhfY2xlYXIobXV0ZXgpOwotICAgIGdfZnJlZSht
dXRleCk7Ci19Ci0KIC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwogCiB0eXBlZGVmIHN0cnVjdCBkZXZpY2Vf
ZXJyb3JfZGF0YSB7CkBAIC04MDksNyArNjY5LDcgQEAgc3RhdGljIHZvaWQgc3BpY2VfdXNicmVk
aXJfY2hhbm5lbF91cChTcGljZUNoYW5uZWwgKmMpCiAKICAgICBnX3JldHVybl9pZl9mYWlsKHBy
aXYtPmhvc3QgIT0gTlVMTCk7CiAgICAgLyogRmx1c2ggYW55IHBlbmRpbmcgd3JpdGVzICovCi0g
ICAgdXNicmVkaXJob3N0X3dyaXRlX2d1ZXN0X2RhdGEocHJpdi0+aG9zdCk7CisgICAgc3BpY2Vf
dXNiX2JhY2tlbmRfY2hhbm5lbF9mbHVzaF93cml0ZXMocHJpdi0+aG9zdCk7CiB9CiAKIHN0YXRp
YyBpbnQgdHJ5X2hhbmRsZV9jb21wcmVzc2VkX21zZyhTcGljZU1zZ0NvbXByZXNzZWREYXRhICpj
b21wcmVzc2VkX2RhdGFfbXNnLApAQCAtODU5LDI2ICs3MTksMjAgQEAgc3RhdGljIHZvaWQgdXNi
cmVkaXJfaGFuZGxlX21zZyhTcGljZUNoYW5uZWwgKmMsIFNwaWNlTXNnSW4gKmluKQogCiAgICAg
Z19yZXR1cm5faWZfZmFpbChwcml2LT5ob3N0ICE9IE5VTEwpOwogCi0gICAgLyogTm8gcmVjdXJz
aW9uIGFsbG93ZWQhICovCi0gICAgZ19yZXR1cm5faWZfZmFpbChwcml2LT5yZWFkX2J1ZiA9PSBO
VUxMKTsKLQogICAgIGlmIChzcGljZV9tc2dfaW5fdHlwZShpbikgPT0gU1BJQ0VfTVNHX1NQSUNF
Vk1DX0NPTVBSRVNTRURfREFUQSkgewogICAgICAgICBTcGljZU1zZ0NvbXByZXNzZWREYXRhICpj
b21wcmVzc2VkX2RhdGFfbXNnID0gc3BpY2VfbXNnX2luX3BhcnNlZChpbik7CiAgICAgICAgIGlm
ICh0cnlfaGFuZGxlX2NvbXByZXNzZWRfbXNnKGNvbXByZXNzZWRfZGF0YV9tc2csICZidWYsICZz
aXplKSkgewotICAgICAgICAgICAgcHJpdi0+cmVhZF9idWZfc2l6ZSA9IHNpemU7Ci0gICAgICAg
ICAgICBwcml2LT5yZWFkX2J1ZiA9IGJ1ZjsKKyAgICAgICAgICAgIC8qIHVuY29tcHJlc3NlZCBv
ayovCiAgICAgICAgIH0gZWxzZSB7Ci0gICAgICAgICAgICByID0gdXNicmVkaXJob3N0X3JlYWRf
cGFyc2VfZXJyb3I7CisgICAgICAgICAgICByID0gVVNCX1JFRElSX0VSUk9SX1JFQURfUEFSU0U7
CiAgICAgICAgIH0KICAgICB9IGVsc2UgeyAvKiBSZWd1bGFyIFNQSUNFX01TR19TUElDRVZNQ19E
QVRBIG1zZyAqLwogICAgICAgICBidWYgPSBzcGljZV9tc2dfaW5fcmF3KGluLCAmc2l6ZSk7Ci0g
ICAgICAgIHByaXYtPnJlYWRfYnVmX3NpemUgPSBzaXplOwotICAgICAgICBwcml2LT5yZWFkX2J1
ZiA9IGJ1ZjsKICAgICB9CiAKICAgICBzcGljZV91c2JyZWRpcl9jaGFubmVsX2xvY2soY2hhbm5l
bCk7CiAgICAgaWYgKHIgPT0gMCkKLSAgICAgICAgciA9IHVzYnJlZGlyaG9zdF9yZWFkX2d1ZXN0
X2RhdGEocHJpdi0+aG9zdCk7CisgICAgICAgIHIgPSBzcGljZV91c2JfYmFja2VuZF9yZWFkX2d1
ZXN0X2RhdGEocHJpdi0+aG9zdCwgYnVmLCBzaXplKTsKICAgICBpZiAociAhPSAwKSB7CiAgICAg
ICAgIFNwaWNlVXNiRGV2aWNlICpzcGljZV9kZXZpY2UgPSBwcml2LT5zcGljZV9kZXZpY2U7CiAg
ICAgICAgIGRldmljZV9lcnJvcl9kYXRhIGVycl9kYXRhOwpAQCAtODkxLDI1ICs3NDUsNyBAQCBz
dGF0aWMgdm9pZCB1c2JyZWRpcl9oYW5kbGVfbXNnKFNwaWNlQ2hhbm5lbCAqYywgU3BpY2VNc2dJ
biAqaW4pCiAgICAgICAgIH0KIAogICAgICAgICBkZXNjID0gc3BpY2VfdXNiX2RldmljZV9nZXRf
ZGVzY3JpcHRpb24oc3BpY2VfZGV2aWNlLCBOVUxMKTsKLSAgICAgICAgc3dpdGNoIChyKSB7Ci0g
ICAgICAgIGNhc2UgdXNicmVkaXJob3N0X3JlYWRfcGFyc2VfZXJyb3I6Ci0gICAgICAgICAgICBl
cnIgPSBnX2Vycm9yX25ldyhTUElDRV9DTElFTlRfRVJST1IsIFNQSUNFX0NMSUVOVF9FUlJPUl9G
QUlMRUQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfKCJ1c2JyZWRpciBwcm90b2Nv
bCBwYXJzZSBlcnJvciBmb3IgJXMiKSwgZGVzYyk7Ci0gICAgICAgICAgICBicmVhazsKLSAgICAg
ICAgY2FzZSB1c2JyZWRpcmhvc3RfcmVhZF9kZXZpY2VfcmVqZWN0ZWQ6Ci0gICAgICAgICAgICBl
cnIgPSBnX2Vycm9yX25ldyhTUElDRV9DTElFTlRfRVJST1IsCi0gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBTUElDRV9DTElFTlRfRVJST1JfVVNCX0RFVklDRV9SRUpFQ1RFRCwKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIF8oIiVzIHJlamVjdGVkIGJ5IGhvc3QiKSwgZGVzYyk7
Ci0gICAgICAgICAgICBicmVhazsKLSAgICAgICAgY2FzZSB1c2JyZWRpcmhvc3RfcmVhZF9kZXZp
Y2VfbG9zdDoKLSAgICAgICAgICAgIGVyciA9IGdfZXJyb3JfbmV3KFNQSUNFX0NMSUVOVF9FUlJP
UiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNQSUNFX0NMSUVOVF9FUlJPUl9VU0Jf
REVWSUNFX0xPU1QsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfKCIlcyBkaXNjb25u
ZWN0ZWQgKGZhdGFsIElPIGVycm9yKSIpLCBkZXNjKTsKLSAgICAgICAgICAgIGJyZWFrOwotICAg
ICAgICBkZWZhdWx0OgotICAgICAgICAgICAgZXJyID0gZ19lcnJvcl9uZXcoU1BJQ0VfQ0xJRU5U
X0VSUk9SLCBTUElDRV9DTElFTlRfRVJST1JfRkFJTEVELAotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgXygiVW5rbm93biBlcnJvciAoJWQpIGZvciAlcyIpLCByLCBkZXNjKTsKLSAgICAg
ICAgfQorICAgICAgICBlcnIgPSBzcGljZV91c2JfYmFja2VuZF9nZXRfZXJyb3JfZGV0YWlscyhy
LCBkZXNjKTsKICAgICAgICAgZ19mcmVlKGRlc2MpOwogCiAgICAgICAgIENIQU5ORUxfREVCVUco
YywgIiVzIiwgZXJyLT5tZXNzYWdlKTsKZGlmZiAtLWdpdCBhL3NyYy9tZXNvbi5idWlsZCBiL3Ny
Yy9tZXNvbi5idWlsZAppbmRleCA1MzY1ZjA1Li5hNTFkMGE5IDEwMDY0NAotLS0gYS9zcmMvbWVz
b24uYnVpbGQKKysrIGIvc3JjL21lc29uLmJ1aWxkCkBAIC0xMjEsNiArMTIxLDggQEAgc3BpY2Vf
Y2xpZW50X2dsaWJfc291cmNlcyA9IFsKICAgJ3VzYi1kZXZpY2UtbWFuYWdlci1wcml2LmgnLAog
ICAndXNidXRpbC5jJywKICAgJ3VzYnV0aWwuaCcsCisgICd1c2ItYmFja2VuZC5jJywKKyAgJ3Vz
Yi1iYWNrZW5kLmgnLAogICAndm1jc3RyZWFtLmMnLAogICAndm1jc3RyZWFtLmgnLAogXQpkaWZm
IC0tZ2l0IGEvc3JjL3VzYi1iYWNrZW5kLmMgYi9zcmMvdXNiLWJhY2tlbmQuYwpuZXcgZmlsZSBt
b2RlIDEwMDY0NAppbmRleCAwMDAwMDAwLi40OGE2MmNkCi0tLSAvZGV2L251bGwKKysrIGIvc3Jj
L3VzYi1iYWNrZW5kLmMKQEAgLTAsMCArMSw2NTcgQEAKKy8qIC0qLSBNb2RlOiBDOyBjLWJhc2lj
LW9mZnNldDogNDsgaW5kZW50LXRhYnMtbW9kZTogbmlsIC0qLSAqLworLyoKKyAgICBDb3B5cmln
aHQgKEMpIDIwMTItMjAxOCBSZWQgSGF0LCBJbmMuCisKKyAgICBSZWQgSGF0IEF1dGhvcnM6Cisg
ICAgWXVyaSBCZW5kaXRvdmljaDx5YmVuZGl0b0ByZWRoYXQuY29tPgorICAgIEhhbnMgZGUgR29l
ZGUgPGhkZWdvZWRlQHJlZGhhdC5jb20+CisKKyAgICBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0
d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCisgICAgbW9kaWZ5IGl0IHVuZGVy
IHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYworICAgIExpY2Vuc2Ug
YXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlcgorICAg
IHZlcnNpb24gMi4xIG9mIHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRl
ciB2ZXJzaW9uLgorCisgICAgVGhpcyBsaWJyYXJ5IGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3Bl
IHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCisgICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3
aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKKyAgICBNRVJDSEFOVEFCSUxJVFkg
b3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQorICAgIExl
c3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCisKKyAgICBZb3Ug
c2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVi
bGljCisgICAgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCBzZWUgPGh0
dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgorKi8KKworI2luY2x1ZGUgImNvbmZpZy5oIgor
CisjaWZkZWYgVVNFX1VTQlJFRElSCisKKyNpbmNsdWRlIDxnbGliLW9iamVjdC5oPgorI2luY2x1
ZGUgPGludHR5cGVzLmg+CisjaW5jbHVkZSA8Z2lvL2dpby5oPgorI2luY2x1ZGUgPGdsaWIvZ2kx
OG4tbGliLmg+CisjaW5jbHVkZSA8ZXJybm8uaD4KKyNpbmNsdWRlIDxsaWJ1c2IuaD4KKyNpbmNs
dWRlIDxzdHJpbmcuaD4KKyNpbmNsdWRlIDxmY250bC5oPgorI2luY2x1ZGUgInVzYnJlZGlyaG9z
dC5oIgorI2luY2x1ZGUgInVzYnJlZGlycGFyc2VyLmgiCisjaW5jbHVkZSAic3BpY2UtdXRpbC5o
IgorI2luY2x1ZGUgInVzYi1iYWNrZW5kLmgiCisjaW5jbHVkZSAiY2hhbm5lbC11c2JyZWRpci1w
cml2LmgiCisjaW5jbHVkZSAic3BpY2UtY2hhbm5lbC1wcml2LmgiCisKKyNkZWZpbmUgTE9VRF9E
RUJVRyh4LCAuLi4pCisKK3N0cnVjdCBfU3BpY2VVc2JCYWNrZW5kRGV2aWNlCit7CisgICAgbGli
dXNiX2RldmljZSAqbGlidXNiX2RldmljZTsKKyAgICBnaW50IHJlZl9jb3VudDsKKyAgICBTcGlj
ZVVzYkJhY2tlbmRDaGFubmVsICphdHRhY2hlZF90bzsKKyAgICBVc2JEZXZpY2VJbmZvcm1hdGlv
biBkZXZpY2VfaW5mbzsKK307CisKK3N0cnVjdCBfU3BpY2VVc2JCYWNrZW5kCit7CisgICAgbGli
dXNiX2NvbnRleHQgKmxpYnVzYl9jb250ZXh0OworICAgIHVzYl9ob3RfcGx1Z19jYWxsYmFjayBo
b3RwbHVnX2NhbGxiYWNrOworICAgIHZvaWQgKmhvdHBsdWdfdXNlcl9kYXRhOworICAgIGxpYnVz
Yl9ob3RwbHVnX2NhbGxiYWNrX2hhbmRsZSBob3RwbHVnX2hhbmRsZTsKK307CisKK3N0cnVjdCBf
U3BpY2VVc2JCYWNrZW5kQ2hhbm5lbAoreworICAgIHN0cnVjdCB1c2JyZWRpcmhvc3QgKnVzYnJl
ZGlyaG9zdDsKKyAgICB1aW50OF90ICpyZWFkX2J1ZjsKKyAgICBpbnQgcmVhZF9idWZfc2l6ZTsK
KyAgICBzdHJ1Y3QgdXNicmVkaXJmaWx0ZXJfcnVsZSAqcnVsZXM7CisgICAgaW50IHJ1bGVzX2Nv
dW50OworICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqYXR0YWNoZWQ7CisgICAgU3BpY2VVc2Jy
ZWRpckNoYW5uZWwgICp1c2VyX2RhdGE7CisgICAgR0Vycm9yICoqZXJyb3I7Cit9OworCisvKiBs
b2NrIGZ1bmN0aW9ucyBmb3IgdXNicmVkaXJob3N0IGFuZCB1c2JyZWRpcnBhcnNlciAqLworc3Rh
dGljIHZvaWQgKnVzYnJlZGlyX2FsbG9jX2xvY2sodm9pZCkgeworICAgIEdNdXRleCAqbXV0ZXg7
CisKKyAgICBtdXRleCA9IGdfbmV3MChHTXV0ZXgsIDEpOworICAgIGdfbXV0ZXhfaW5pdChtdXRl
eCk7CisKKyAgICByZXR1cm4gbXV0ZXg7Cit9CisKK3N0YXRpYyB2b2lkIHVzYnJlZGlyX2ZyZWVf
bG9jayh2b2lkICp1c2VyX2RhdGEpIHsKKyAgICBHTXV0ZXggKm11dGV4ID0gdXNlcl9kYXRhOwor
CisgICAgZ19tdXRleF9jbGVhcihtdXRleCk7CisgICAgZ19mcmVlKG11dGV4KTsKK30KKworc3Rh
dGljIHZvaWQgdXNicmVkaXJfbG9ja19sb2NrKHZvaWQgKnVzZXJfZGF0YSkgeworICAgIEdNdXRl
eCAqbXV0ZXggPSB1c2VyX2RhdGE7CisKKyAgICBnX211dGV4X2xvY2sobXV0ZXgpOworfQorCitz
dGF0aWMgdm9pZCB1c2JyZWRpcl91bmxvY2tfbG9jayh2b2lkICp1c2VyX2RhdGEpIHsKKyAgICBH
TXV0ZXggKm11dGV4ID0gdXNlcl9kYXRhOworCisgICAgZ19tdXRleF91bmxvY2sobXV0ZXgpOwor
fQorCitnYm9vbGVhbiBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfaXNvY2goU3BpY2VVc2JCYWNr
ZW5kRGV2aWNlICpkZXYpCit7CisgICAgbGlidXNiX2RldmljZSAqbGliZGV2ID0gZGV2LT5saWJ1
c2JfZGV2aWNlOworICAgIHN0cnVjdCBsaWJ1c2JfY29uZmlnX2Rlc2NyaXB0b3IgKmNvbmZfZGVz
YzsKKyAgICBnYm9vbGVhbiBpc29jX2ZvdW5kID0gRkFMU0U7CisgICAgZ2ludCBpLCBqLCBrOwor
ICAgIGludCByYzsKKworICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKGxpYmRldiAhPSBOVUxMLCAw
KTsKKworICAgIHJjID0gbGlidXNiX2dldF9hY3RpdmVfY29uZmlnX2Rlc2NyaXB0b3IobGliZGV2
LCAmY29uZl9kZXNjKTsKKyAgICBpZiAocmMpIHsKKyAgICAgICAgY29uc3QgY2hhciAqZGVzYyA9
IGxpYnVzYl9zdHJlcnJvcihyYyk7CisgICAgICAgIGdfd2FybmluZygiY2FuJ3QgZ2V0IGNvbmZp
Z3VyYXRpb24gZGVzY3JpcHRvciwgJXMgWyVpXSIsIGRlc2MsIHJjKTsKKyAgICAgICAgcmV0dXJu
IEZBTFNFOworICAgIH0KKworICAgIGZvciAoaSA9IDA7ICFpc29jX2ZvdW5kICYmIGkgPCBjb25m
X2Rlc2MtPmJOdW1JbnRlcmZhY2VzOyBpKyspIHsKKyAgICAgICAgZm9yIChqID0gMDsgIWlzb2Nf
Zm91bmQgJiYgaiA8IGNvbmZfZGVzYy0+aW50ZXJmYWNlW2ldLm51bV9hbHRzZXR0aW5nOyBqKysp
IHsKKyAgICAgICAgICAgIGZvciAoayA9IDA7ICFpc29jX2ZvdW5kICYmIGsgPCBjb25mX2Rlc2Mt
PmludGVyZmFjZVtpXS5hbHRzZXR0aW5nW2pdLmJOdW1FbmRwb2ludHM7aysrKSB7CisgICAgICAg
ICAgICAgICAgZ2ludCBhdHRyaWJ1dGVzID0gY29uZl9kZXNjLT5pbnRlcmZhY2VbaV0uYWx0c2V0
dGluZ1tqXS5lbmRwb2ludFtrXS5ibUF0dHJpYnV0ZXM7CisgICAgICAgICAgICAgICAgZ2ludCB0
eXBlID0gYXR0cmlidXRlcyAmIExJQlVTQl9UUkFOU0ZFUl9UWVBFX01BU0s7CisgICAgICAgICAg
ICAgICAgaWYgKHR5cGUgPT0gTElCVVNCX1RSQU5TRkVSX1RZUEVfSVNPQ0hST05PVVMpIHsKKyAg
ICAgICAgICAgICAgICAgICAgaXNvY19mb3VuZCA9IFRSVUU7CisgICAgICAgICAgICAgICAgfQor
ICAgICAgICAgICAgfQorICAgICAgICB9CisgICAgfQorCisgICAgbGlidXNiX2ZyZWVfY29uZmln
X2Rlc2NyaXB0b3IoY29uZl9kZXNjKTsKKyAgICByZXR1cm4gaXNvY19mb3VuZDsKK30KKworc3Rh
dGljIGdib29sZWFuIGZpbGxfdXNiX2luZm8oU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpiZGV2KQor
eworICAgIFVzYkRldmljZUluZm9ybWF0aW9uICppbmZvID0gJmJkZXYtPmRldmljZV9pbmZvOwor
CisgICAgc3RydWN0IGxpYnVzYl9kZXZpY2VfZGVzY3JpcHRvciBkZXNjOworICAgIGxpYnVzYl9k
ZXZpY2UgKmxpYmRldiA9IGJkZXYtPmxpYnVzYl9kZXZpY2U7CisgICAgbGlidXNiX2dldF9kZXZp
Y2VfZGVzY3JpcHRvcihsaWJkZXYsICZkZXNjKTsKKyAgICBpbmZvLT5idXMgPSBsaWJ1c2JfZ2V0
X2J1c19udW1iZXIobGliZGV2KTsKKyAgICBpbmZvLT5hZGRyZXNzID0gbGlidXNiX2dldF9kZXZp
Y2VfYWRkcmVzcyhsaWJkZXYpOworICAgIGlmIChpbmZvLT5hZGRyZXNzID09IDB4ZmYgfHwgLyog
cm9vdCBodWIgKEhDRCkgKi8KKyAgICAgICAgaW5mby0+YWRkcmVzcyA8PSAxIHx8IC8qIHJvb3Qg
aHViIG9yIGJhZCBhZGRyZXNzICovCisgICAgICAgIChkZXNjLmJEZXZpY2VDbGFzcyA9PSBMSUJV
U0JfQ0xBU1NfSFVCKSAvKmh1YiovKSB7CisgICAgICAgIHJldHVybiBGQUxTRTsKKyAgICB9CisK
KyAgICBpbmZvLT52aWQgPSBkZXNjLmlkVmVuZG9yOworICAgIGluZm8tPnBpZCA9IGRlc2MuaWRQ
cm9kdWN0OworICAgIGluZm8tPmNsYXNzID0gZGVzYy5iRGV2aWNlQ2xhc3M7CisgICAgaW5mby0+
c3ViY2xhc3MgPSBkZXNjLmJEZXZpY2VTdWJDbGFzczsKKyAgICBpbmZvLT5wcm90b2NvbCA9IGRl
c2MuYkRldmljZVByb3RvY29sOworCisgICAgcmV0dXJuIFRSVUU7Cit9CisKK3N0YXRpYyBTcGlj
ZVVzYkJhY2tlbmREZXZpY2UgKmFsbG9jYXRlX2JhY2tlbmRfZGV2aWNlKGxpYnVzYl9kZXZpY2Ug
KmxpYmRldikKK3sKKyAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldiA9IGdfbmV3MChTcGlj
ZVVzYkJhY2tlbmREZXZpY2UsIDEpOworICAgIGRldi0+cmVmX2NvdW50ID0gMTsKKyAgICBkZXYt
PmxpYnVzYl9kZXZpY2UgPSBsaWJkZXY7CisgICAgaWYgKCFmaWxsX3VzYl9pbmZvKGRldikpIHsK
KyAgICAgICAgZ19jbGVhcl9wb2ludGVyKCZkZXYsIGdfZnJlZSk7CisgICAgfQorICAgIHJldHVy
biBkZXY7Cit9CisKK3N0YXRpYyBnYm9vbGVhbiBpc19jaGFubmVsX3JlYWR5KFNwaWNlVXNicmVk
aXJDaGFubmVsICpjaGFubmVsKQoreworICAgIHJldHVybiBzcGljZV9jaGFubmVsX2dldF9zdGF0
ZShTUElDRV9DSEFOTkVMKGNoYW5uZWwpKSA9PSBTUElDRV9DSEFOTkVMX1NUQVRFX1JFQURZOwor
fQorCisvKiBOb3RlIHRoYXQgdGhpcyBmdW5jdGlvbiBtdXN0IGJlIHJlLWVudHJhbnQgc2FmZSwg
YXMgaXQgY2FuIGdldCBjYWxsZWQKK2Zyb20gYm90aCB0aGUgbWFpbiB0aHJlYWQgYXMgd2VsbCBh
cyBmcm9tIHRoZSB1c2IgZXZlbnQgaGFuZGxpbmcgdGhyZWFkICovCitzdGF0aWMgdm9pZCB1c2Jy
ZWRpcl93cml0ZV9mbHVzaF9jYWxsYmFjayh2b2lkICp1c2VyX2RhdGEpCit7CisgICAgU3BpY2VV
c2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSB1c2VyX2RhdGE7CisgICAgaWYgKCFjaC0+dXNicmVkaXJo
b3N0KSB7CisgICAgICAgIC8qIGp1c3QgdG8gYmUgb24gdGhlIHNhZmUgc2lkZSAqLworICAgICAg
ICByZXR1cm47CisgICAgfQorICAgIGlmIChpc19jaGFubmVsX3JlYWR5KGNoLT51c2VyX2RhdGEp
KSB7CisgICAgICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCAtPiB1c2JyZWRpcmhvc3QiLCBfX0ZV
TkNUSU9OX18sIGNoKTsKKyAgICAgICAgdXNicmVkaXJob3N0X3dyaXRlX2d1ZXN0X2RhdGEoY2gt
PnVzYnJlZGlyaG9zdCk7CisgICAgfSBlbHNlIHsKKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzIGNo
ICVwIChub3QgcmVhZHkpIiwgX19GVU5DVElPTl9fLCBjaCk7CisgICAgfQorfQorCitTcGljZVVz
YkJhY2tlbmQgKnNwaWNlX3VzYl9iYWNrZW5kX25ldyhHRXJyb3IgKiplcnJvcikKK3sKKyAgICBp
bnQgcmM7CisgICAgU3BpY2VVc2JCYWNrZW5kICpiZTsKKyAgICBTUElDRV9ERUJVRygiJXMgPj4i
LCBfX0ZVTkNUSU9OX18pOworICAgIGJlID0gZ19uZXcwKFNwaWNlVXNiQmFja2VuZCwgMSk7Cisg
ICAgcmMgPSBsaWJ1c2JfaW5pdCgmYmUtPmxpYnVzYl9jb250ZXh0KTsKKyAgICBpZiAocmMgPCAw
KSB7CisgICAgICAgIGNvbnN0IGNoYXIgKmRlc2MgPSBsaWJ1c2Jfc3RyZXJyb3IocmMpOworICAg
ICAgICBnX3dhcm5pbmcoIkVycm9yIGluaXRpYWxpemluZyBMSUJVU0Igc3VwcG9ydDogJXMgWyVp
XSIsIGRlc2MsIHJjKTsKKyAgICAgICAgZ19zZXRfZXJyb3IoZXJyb3IsIFNQSUNFX0NMSUVOVF9F
UlJPUiwgU1BJQ0VfQ0xJRU5UX0VSUk9SX0ZBSUxFRCwKKyAgICAgICAgICAgICJFcnJvciBpbml0
aWFsaXppbmcgTElCVVNCIHN1cHBvcnQ6ICVzIFslaV0iLCBkZXNjLCByYyk7CisgICAgICAgIGdf
ZnJlZShiZSk7CisgICAgICAgIGJlID0gTlVMTDsKKyAgICB9IGVsc2UgeworI2lmZGVmIEdfT1Nf
V0lOMzIKKyNpZiBMSUJVU0JfQVBJX1ZFUlNJT04gPj0gMHgwMTAwMDEwNgorICAgICAgICBsaWJ1
c2Jfc2V0X29wdGlvbihiZS0+bGlidXNiX2NvbnRleHQsIExJQlVTQl9PUFRJT05fVVNFX1VTQkRL
KTsKKyNlbmRpZgorI2VuZGlmCisgICAgfQorICAgIFNQSUNFX0RFQlVHKCIlcyA8PCIsIF9fRlVO
Q1RJT05fXyk7CisgICAgcmV0dXJuIGJlOworfQorCitnYm9vbGVhbiBzcGljZV91c2JfYmFja2Vu
ZF9oYW5kbGVfZXZlbnRzKFNwaWNlVXNiQmFja2VuZCAqYmUpCit7CisgICAgU1BJQ0VfREVCVUco
IiVzID4+IiwgX19GVU5DVElPTl9fKTsKKyAgICBnYm9vbGVhbiBvayA9IEZBTFNFOworICAgIGlm
IChiZS0+bGlidXNiX2NvbnRleHQpIHsKKyAgICAgICAgaW50IHJlcyA9IGxpYnVzYl9oYW5kbGVf
ZXZlbnRzKGJlLT5saWJ1c2JfY29udGV4dCk7CisgICAgICAgIG9rID0gcmVzID09IDA7CisgICAg
ICAgIGlmIChyZXMgJiYgcmVzICE9IExJQlVTQl9FUlJPUl9JTlRFUlJVUFRFRCkgeworICAgICAg
ICAgICAgY29uc3QgY2hhciAqZGVzYyA9IGxpYnVzYl9zdHJlcnJvcihyZXMpOworICAgICAgICAg
ICAgZ193YXJuaW5nKCJFcnJvciBoYW5kbGluZyBVU0IgZXZlbnRzOiAlcyBbJWldIiwgZGVzYywg
cmVzKTsKKyAgICAgICAgICAgIG9rID0gRkFMU0U7CisgICAgICAgIH0KKyAgICB9CisgICAgU1BJ
Q0VfREVCVUcoIiVzIDw8ICVkIiwgX19GVU5DVElPTl9fLCBvayk7CisgICAgcmV0dXJuIG9rOwor
fQorCitzdGF0aWMgaW50IExJQlVTQl9DQUxMIGhvdHBsdWdfY2FsbGJhY2sobGlidXNiX2NvbnRl
eHQgKmN0eCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ1c2Jf
ZGV2aWNlICpkZXZpY2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
bGlidXNiX2hvdHBsdWdfZXZlbnQgZXZlbnQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdm9pZCAqdXNlcl9kYXRhKQoreworICAgIFNwaWNlVXNiQmFja2VuZCAqYmUg
PSAoU3BpY2VVc2JCYWNrZW5kICopdXNlcl9kYXRhOworICAgIGlmIChiZS0+aG90cGx1Z19jYWxs
YmFjaykgeworICAgICAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldjsKKyAgICAgICAgZ2Jv
b2xlYW4gdmFsID0gZXZlbnQgPT0gTElCVVNCX0hPVFBMVUdfRVZFTlRfREVWSUNFX0FSUklWRUQ7
CisgICAgICAgIGRldiA9IGFsbG9jYXRlX2JhY2tlbmRfZGV2aWNlKGRldmljZSk7CisgICAgICAg
IGlmIChkZXYpIHsKKyAgICAgICAgICAgIFNQSUNFX0RFQlVHKCJjcmVhdGVkIGRldiAlcCwgdXNi
bGliIGRldiAlcCIsIGRldiwgZGV2aWNlKTsKKyAgICAgICAgICAgIGxpYnVzYl9yZWZfZGV2aWNl
KGRldmljZSk7CisgICAgICAgICAgICBiZS0+aG90cGx1Z19jYWxsYmFjayhiZS0+aG90cGx1Z191
c2VyX2RhdGEsIGRldiwgdmFsKTsKKyAgICAgICAgICAgIHNwaWNlX3VzYl9iYWNrZW5kX2Rldmlj
ZV91bnJlZihkZXYpOworICAgICAgICB9CisgICAgfQorICAgIHJldHVybiAwOworfQorCit2b2lk
IHNwaWNlX3VzYl9iYWNrZW5kX2RlcmVnaXN0ZXJfaG90cGx1ZyhTcGljZVVzYkJhY2tlbmQgKmJl
KQoreworICAgIGdfcmV0dXJuX2lmX2ZhaWwoYmUgIT0gTlVMTCk7CisgICAgaWYgKGJlLT5ob3Rw
bHVnX2hhbmRsZSkgeworICAgICAgICBsaWJ1c2JfaG90cGx1Z19kZXJlZ2lzdGVyX2NhbGxiYWNr
KGJlLT5saWJ1c2JfY29udGV4dCwgYmUtPmhvdHBsdWdfaGFuZGxlKTsKKyAgICAgICAgYmUtPmhv
dHBsdWdfaGFuZGxlID0gMDsKKyAgICB9CisgICAgYmUtPmhvdHBsdWdfY2FsbGJhY2sgPSBOVUxM
OworfQorCitnYm9vbGVhbiBzcGljZV91c2JfYmFja2VuZF9yZWdpc3Rlcl9ob3RwbHVnKFNwaWNl
VXNiQmFja2VuZCAqYmUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHZvaWQgKnVzZXJfZGF0YSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdXNiX2hvdF9wbHVnX2NhbGxiYWNrIHByb2MpCit7CisgICAgaW50IHJjOworICAg
IGdfcmV0dXJuX3ZhbF9pZl9mYWlsKGJlICE9IE5VTEwsIEZBTFNFKTsKKworICAgIGJlLT5ob3Rw
bHVnX2NhbGxiYWNrID0gcHJvYzsKKyAgICBiZS0+aG90cGx1Z191c2VyX2RhdGEgPSB1c2VyX2Rh
dGE7CisgICAgcmMgPSBsaWJ1c2JfaG90cGx1Z19yZWdpc3Rlcl9jYWxsYmFjayhiZS0+bGlidXNi
X2NvbnRleHQsCisgICAgICAgIExJQlVTQl9IT1RQTFVHX0VWRU5UX0RFVklDRV9BUlJJVkVEIHwg
TElCVVNCX0hPVFBMVUdfRVZFTlRfREVWSUNFX0xFRlQsCisgICAgICAgIExJQlVTQl9IT1RQTFVH
X0VOVU1FUkFURSwgTElCVVNCX0hPVFBMVUdfTUFUQ0hfQU5ZLAorICAgICAgICBMSUJVU0JfSE9U
UExVR19NQVRDSF9BTlksIExJQlVTQl9IT1RQTFVHX01BVENIX0FOWSwKKyAgICAgICAgaG90cGx1
Z19jYWxsYmFjaywgYmUsICZiZS0+aG90cGx1Z19oYW5kbGUpOworICAgIGlmIChyYyAhPSBMSUJV
U0JfU1VDQ0VTUykgeworICAgICAgICBjb25zdCBjaGFyICpkZXNjID0gbGlidXNiX3N0cmVycm9y
KHJjKTsKKyAgICAgICAgZ193YXJuaW5nKCJFcnJvciBpbml0aWFsaXppbmcgVVNCIGhvdHBsdWcg
c3VwcG9ydDogJXMgWyVpXSIsIGRlc2MsIHJjKTsKKyAgICAgICAgYmUtPmhvdHBsdWdfY2FsbGJh
Y2sgPSBOVUxMOworICAgICAgICByZXR1cm4gRkFMU0U7CisgICAgfQorICAgIHJldHVybiBUUlVF
OworfQorCit2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2RlbGV0ZShTcGljZVVzYkJhY2tlbmQgKmJl
KQoreworICAgIGdfcmV0dXJuX2lmX2ZhaWwoYmUgIT0gTlVMTCk7CisgICAgU1BJQ0VfREVCVUco
IiVzID4+IiwgX19GVU5DVElPTl9fKTsKKyAgICBpZiAoYmUtPmxpYnVzYl9jb250ZXh0KSB7Cisg
ICAgICAgIGxpYnVzYl9leGl0KGJlLT5saWJ1c2JfY29udGV4dCk7CisgICAgfQorICAgIGdfZnJl
ZShiZSk7CisgICAgU1BJQ0VfREVCVUcoIiVzIDw8IiwgX19GVU5DVElPTl9fKTsKK30KKworU3Bp
Y2VVc2JCYWNrZW5kRGV2aWNlICoqc3BpY2VfdXNiX2JhY2tlbmRfZ2V0X2RldmljZV9saXN0KFNw
aWNlVXNiQmFja2VuZCAqYmUpCit7CisgICAgTE9VRF9ERUJVRygiJXMgPj4iLCBfX0ZVTkNUSU9O
X18pOworICAgIGxpYnVzYl9kZXZpY2UgKipkZXZsaXN0ID0gTlVMTCwgKipkZXY7CisgICAgU3Bp
Y2VVc2JCYWNrZW5kRGV2aWNlICpkLCAqKmxpc3Q7CisKKyAgICBpbnQgbiA9IDAsIGluZGV4Owor
CisgICAgaWYgKGJlICYmIGJlLT5saWJ1c2JfY29udGV4dCkgeworICAgICAgICBsaWJ1c2JfZ2V0
X2RldmljZV9saXN0KGJlLT5saWJ1c2JfY29udGV4dCwgJmRldmxpc3QpOworICAgIH0KKworICAg
IC8qIGFkZCBhbGwgdGhlIGxpYnVzYiBkZXZpY2UgdGhhdCBub3QgcHJlc2VudCBpbiBvdXIgbGlz
dCAqLworICAgIGZvciAoZGV2ID0gZGV2bGlzdDsgZGV2ICYmICpkZXY7IGRldisrKSB7CisgICAg
ICAgIG4rKzsKKyAgICB9CisKKyAgICBsaXN0ID0gZ19uZXcwKFNwaWNlVXNiQmFja2VuZERldmlj
ZSosIG4gKyAxKTsKKworICAgIGluZGV4ID0gMDsKKworICAgIGZvciAoZGV2ID0gZGV2bGlzdDsg
ZGV2ICYmICpkZXY7IGRldisrKSB7CisgICAgICAgIGQgPSBhbGxvY2F0ZV9iYWNrZW5kX2Rldmlj
ZSgqZGV2KTsKKyAgICAgICAgaWYgKCFkKSB7CisgICAgICAgICAgICBsaWJ1c2JfdW5yZWZfZGV2
aWNlKCpkZXYpOworICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgU1BJQ0VfREVCVUcoImNy
ZWF0ZWQgZGV2ICVwLCB1c2JsaWIgZGV2ICVwIiwgZCwgKmRldik7CisgICAgICAgICAgICBsaXN0
W2luZGV4KytdID0gZDsKKyAgICAgICAgfQorICAgIH0KKworICAgIGlmIChkZXZsaXN0KSB7Cisg
ICAgICAgIGxpYnVzYl9mcmVlX2RldmljZV9saXN0KGRldmxpc3QsIDApOworICAgIH0KKworICAg
IExPVURfREVCVUcoIiVzIDw8IiwgX19GVU5DVElPTl9fKTsKKyAgICByZXR1cm4gbGlzdDsKK30K
KworY29uc3QgVXNiRGV2aWNlSW5mb3JtYXRpb24qIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9n
ZXRfaW5mbyhTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldikKK3sKKyAgICByZXR1cm4gJmRldi0+
ZGV2aWNlX2luZm87Cit9CisKK2djb25zdHBvaW50ZXIgc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNl
X2dldF9saWJkZXYoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYpCit7CisgICAgcmV0dXJuIGRl
di0+bGlidXNiX2RldmljZTsKK30KKwordm9pZCBzcGljZV91c2JfYmFja2VuZF9mcmVlX2Rldmlj
ZV9saXN0KFNwaWNlVXNiQmFja2VuZERldmljZSAqKmRldmxpc3QpCit7CisgICAgTE9VRF9ERUJV
RygiJXMgPj4iLCBfX0ZVTkNUSU9OX18pOworICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqKmRl
djsKKyAgICBmb3IgKGRldiA9IGRldmxpc3Q7ICpkZXY7IGRldisrKSB7CisgICAgICAgIFNwaWNl
VXNiQmFja2VuZERldmljZSAqZCA9ICpkZXY7CisgICAgICAgIHNwaWNlX3VzYl9iYWNrZW5kX2Rl
dmljZV91bnJlZihkKTsKKyAgICB9CisgICAgZ19mcmVlKGRldmxpc3QpOworICAgIExPVURfREVC
VUcoIiVzIDw8IiwgX19GVU5DVElPTl9fKTsKK30KKworU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpz
cGljZV91c2JfYmFja2VuZF9kZXZpY2VfcmVmKFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2KQor
eworICAgIExPVURfREVCVUcoIiVzID4+ICVwIiwgX19GVU5DVElPTl9fLCBkZXYpOworICAgIGdf
YXRvbWljX2ludF9pbmMoJmRldi0+cmVmX2NvdW50KTsKKyAgICByZXR1cm4gZGV2OworfQorCit2
b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV91bnJlZihTcGljZVVzYkJhY2tlbmREZXZpY2Ug
KmRldikKK3sKKyAgICBMT1VEX0RFQlVHKCIlcyA+PiAlcCglZCkiLCBfX0ZVTkNUSU9OX18sIGRl
diwgZGV2LT5yZWZfY291bnQpOworICAgIGlmIChnX2F0b21pY19pbnRfZGVjX2FuZF90ZXN0KCZk
ZXYtPnJlZl9jb3VudCkpIHsKKyAgICAgICAgbGlidXNiX3VucmVmX2RldmljZShkZXYtPmxpYnVz
Yl9kZXZpY2UpOworICAgICAgICBMT1VEX0RFQlVHKCIlcyBmcmVlaW5nICVwIChsaWJ1c2IgJXAp
IiwgX19GVU5DVElPTl9fLCBkZXYsIGRldi0+bGlidXNiX2RldmljZSk7CisgICAgICAgIGdfZnJl
ZShkZXYpOworICAgIH0KK30KKworaW50IHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9jaGVja19m
aWx0ZXIoCisgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYsCisgICAgY29uc3Qgc3RydWN0
IHVzYnJlZGlyZmlsdGVyX3J1bGUgKnJ1bGVzLAorICAgIGludCBjb3VudCkKK3sKKyAgICByZXR1
cm4gdXNicmVkaXJob3N0X2NoZWNrX2RldmljZV9maWx0ZXIoCisgICAgICAgIHJ1bGVzLCBjb3Vu
dCwgZGV2LT5saWJ1c2JfZGV2aWNlLCAwKTsKK30KKworc3RhdGljIGludCB1c2JyZWRpcl9yZWFk
X2NhbGxiYWNrKHZvaWQgKnVzZXJfZGF0YSwgdWludDhfdCAqZGF0YSwgaW50IGNvdW50KQorewor
ICAgIFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoID0gdXNlcl9kYXRhOworCisgICAgY291bnQg
PSBNSU4oY2gtPnJlYWRfYnVmX3NpemUsIGNvdW50KTsKKworICAgIGlmIChjb3VudCAhPSAwKSB7
CisgICAgICAgIG1lbWNweShkYXRhLCBjaC0+cmVhZF9idWYsIGNvdW50KTsKKyAgICB9CisKKyAg
ICBjaC0+cmVhZF9idWZfc2l6ZSAtPSBjb3VudDsKKyAgICBpZiAoY2gtPnJlYWRfYnVmX3NpemUp
IHsKKyAgICAgICAgY2gtPnJlYWRfYnVmICs9IGNvdW50OworICAgIH0KKyAgICBlbHNlIHsKKyAg
ICAgICAgY2gtPnJlYWRfYnVmID0gTlVMTDsKKyAgICB9CisgICAgU1BJQ0VfREVCVUcoIiVzIGNo
ICVwLCAlZCBieXRlcyIsIF9fRlVOQ1RJT05fXywgY2gsIGNvdW50KTsKKworICAgIHJldHVybiBj
b3VudDsKK30KKworc3RhdGljIGNvbnN0IGNoYXIgKnN0cmlwX3VzYnJlZGlyX3ByZWZpeChjb25z
dCBjaGFyICptc2cpCit7CisgICAgaWYgKHN0cm5jbXAobXNnLCAidXNicmVkaXJob3N0OiAiLCAx
NCkgPT0gMCkgeworICAgICAgICBtc2cgKz0gMTQ7CisgICAgfQorICAgIHJldHVybiBtc2c7Cit9
CisKK3N0YXRpYyB2b2lkIGNoYW5uZWxfZXJyb3IoU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gs
IGNvbnN0IGNoYXIgKm1zZykKK3sKKyAgICBpZiAoIWNoLT5lcnJvcikKKyAgICAgICAgcmV0dXJu
OworICAgIGdfc2V0X2Vycm9yX2xpdGVyYWwoY2gtPmVycm9yLCBTUElDRV9DTElFTlRfRVJST1Is
IFNQSUNFX0NMSUVOVF9FUlJPUl9GQUlMRUQsIG1zZyk7CisgICAgY2gtPmVycm9yID0gTlVMTDsK
K30KKworc3RhdGljIHZvaWQgdXNicmVkaXJfbG9nKHZvaWQgKnVzZXJfZGF0YSwgaW50IGxldmVs
LCBjb25zdCBjaGFyICptc2cpCit7CisgICAgU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSAo
U3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqKXVzZXJfZGF0YTsKKyAgICBjb25zdCBjaGFyICpzdHJp
cHBlZF9tc2cgPSBzdHJpcF91c2JyZWRpcl9wcmVmaXgobXNnKTsKKyAgICBzd2l0Y2ggKGxldmVs
KSB7CisgICAgY2FzZSB1c2JyZWRpcnBhcnNlcl9lcnJvcjoKKyAgICAgICAgZ19jcml0aWNhbCgi
JXMiLCBtc2cpOworICAgICAgICBjaGFubmVsX2Vycm9yKGNoLCBzdHJpcHBlZF9tc2cpOworICAg
ICAgICBicmVhazsKKyAgICBjYXNlIHVzYnJlZGlycGFyc2VyX3dhcm5pbmc6CisgICAgICAgIGdf
d2FybmluZygiJXMiLCBtc2cpOworICAgICAgICBjaGFubmVsX2Vycm9yKGNoLCBzdHJpcHBlZF9t
c2cpOworICAgICAgICBicmVhazsKKyAgICBkZWZhdWx0OgorICAgICAgICBicmVhazsKKyAgICB9
Cit9CisKK3N0YXRpYyBpbnQgdXNicmVkaXJfd3JpdGVfY2FsbGJhY2sodm9pZCAqdXNlcl9kYXRh
LCB1aW50OF90ICpkYXRhLCBpbnQgY291bnQpCit7CisgICAgU3BpY2VVc2JCYWNrZW5kQ2hhbm5l
bCAqY2ggPSB1c2VyX2RhdGE7CisgICAgaW50IHJlczsKKyAgICBTUElDRV9ERUJVRygiJXMgY2gg
JXAsICVkIGJ5dGVzIiwgX19GVU5DVElPTl9fLCBjaCwgY291bnQpOworICAgIHJlcyA9IHNwaWNl
X3VzYnJlZGlyX3dyaXRlX2NhbGxiYWNrKGNoLT51c2VyX2RhdGEsIGRhdGEsIGNvdW50KTsKKyAg
ICByZXR1cm4gcmVzOworfQorCitzdGF0aWMgdWludDY0X3QgdXNicmVkaXJfYnVmZmVyZWRfb3V0
cHV0X3NpemVfY2FsbGJhY2sodm9pZCAqdXNlcl9kYXRhKQoreworICAgIFNwaWNlVXNiQmFja2Vu
ZENoYW5uZWwgKmNoID0gdXNlcl9kYXRhOworICAgIHJldHVybiBzcGljZV9jaGFubmVsX2dldF9x
dWV1ZV9zaXplKFNQSUNFX0NIQU5ORUwoY2gtPnVzZXJfZGF0YSkpOworfQorCitpbnQgc3BpY2Vf
dXNiX2JhY2tlbmRfcmVhZF9ndWVzdF9kYXRhKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLCB1
aW50OF90ICpkYXRhLCBpbnQgY291bnQpCit7CisgICAgaW50IHJlcyA9IDA7CisKKyAgICBnX3Jl
dHVybl92YWxfaWZfZmFpbChjaC0+cmVhZF9idWYgPT0gTlVMTCwgVVNCX1JFRElSX0VSUk9SX1JF
QURfUEFSU0UpOworCisgICAgY2gtPnJlYWRfYnVmID0gZGF0YTsKKyAgICBjaC0+cmVhZF9idWZf
c2l6ZSA9IGNvdW50OworICAgIGlmIChjaC0+dXNicmVkaXJob3N0KSB7CisgICAgICAgIHJlcyA9
IHVzYnJlZGlyaG9zdF9yZWFkX2d1ZXN0X2RhdGEoY2gtPnVzYnJlZGlyaG9zdCk7CisgICAgfSBl
bHNlIHsKKyAgICAgICAgcmVzID0gVVNCX1JFRElSX0VSUk9SX0lPOworICAgIH0KKyAgICBzd2l0
Y2ggKHJlcykKKyAgICB7CisgICAgY2FzZSB1c2JyZWRpcmhvc3RfcmVhZF9pb19lcnJvcjoKKyAg
ICAgICAgcmVzID0gVVNCX1JFRElSX0VSUk9SX0lPOworICAgICAgICBicmVhazsKKyAgICBjYXNl
IHVzYnJlZGlyaG9zdF9yZWFkX3BhcnNlX2Vycm9yOgorICAgICAgICByZXMgPSBVU0JfUkVESVJf
RVJST1JfUkVBRF9QQVJTRTsKKyAgICAgICAgYnJlYWs7CisgICAgY2FzZSB1c2JyZWRpcmhvc3Rf
cmVhZF9kZXZpY2VfcmVqZWN0ZWQ6CisgICAgICAgIHJlcyA9IFVTQl9SRURJUl9FUlJPUl9ERVZf
UkVKRUNURUQ7CisgICAgICAgIGJyZWFrOworICAgIGNhc2UgdXNicmVkaXJob3N0X3JlYWRfZGV2
aWNlX2xvc3Q6CisgICAgICAgIHJlcyA9IFVTQl9SRURJUl9FUlJPUl9ERVZfTE9TVDsKKyAgICAg
ICAgYnJlYWs7CisgICAgfQorICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCwgJWQgYnl0ZXMsIHJl
cyAlZCIsIF9fRlVOQ1RJT05fXywgY2gsIGNvdW50LCByZXMpOworCisgICAgcmV0dXJuIHJlczsK
K30KKworR0Vycm9yICpzcGljZV91c2JfYmFja2VuZF9nZXRfZXJyb3JfZGV0YWlscyhpbnQgZXJy
b3JfY29kZSwgZ2NoYXIgKmRlc2MpCit7CisgICAgR0Vycm9yICplcnI7CisgICAgc3dpdGNoIChl
cnJvcl9jb2RlKSB7CisgICAgICAgIGNhc2UgVVNCX1JFRElSX0VSUk9SX1JFQURfUEFSU0U6Cisg
ICAgICAgICAgICBlcnIgPSBnX2Vycm9yX25ldyhTUElDRV9DTElFTlRfRVJST1IsIFNQSUNFX0NM
SUVOVF9FUlJPUl9GQUlMRUQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfKCJ1c2Jy
ZWRpciBwcm90b2NvbCBwYXJzZSBlcnJvciBmb3IgJXMiKSwgZGVzYyk7CisgICAgICAgICAgICBi
cmVhazsKKyAgICAgICAgY2FzZSBVU0JfUkVESVJfRVJST1JfREVWX1JFSkVDVEVEOgorICAgICAg
ICAgICAgZXJyID0gZ19lcnJvcl9uZXcoU1BJQ0VfQ0xJRU5UX0VSUk9SLCBTUElDRV9DTElFTlRf
RVJST1JfVVNCX0RFVklDRV9SRUpFQ1RFRCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IF8oIiVzIHJlamVjdGVkIGJ5IGhvc3QiKSwgZGVzYyk7CisgICAgICAgICAgICBicmVhazsKKyAg
ICAgICAgY2FzZSBVU0JfUkVESVJfRVJST1JfREVWX0xPU1Q6CisgICAgICAgICAgICBlcnIgPSBn
X2Vycm9yX25ldyhTUElDRV9DTElFTlRfRVJST1IsIFNQSUNFX0NMSUVOVF9FUlJPUl9VU0JfREVW
SUNFX0xPU1QsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfKCIlcyBkaXNjb25uZWN0
ZWQgKGZhdGFsIElPIGVycm9yKSIpLCBkZXNjKTsKKyAgICAgICAgICAgIGJyZWFrOworICAgICAg
ICBkZWZhdWx0OgorICAgICAgICAgICAgZXJyID0gZ19lcnJvcl9uZXcoU1BJQ0VfQ0xJRU5UX0VS
Uk9SLCBTUElDRV9DTElFTlRfRVJST1JfRkFJTEVELAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgXygiVW5rbm93biBlcnJvciAoJWQpIGZvciAlcyIpLCBlcnJvcl9jb2RlLCBkZXNjKTsK
KyAgICAgICAgICAgIH0KKyAgICByZXR1cm4gZXJyOworfQorCit2b2lkIHNwaWNlX3VzYl9iYWNr
ZW5kX3JldHVybl93cml0ZV9kYXRhKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLCB2b2lkICpk
YXRhKQoreworICAgIGlmIChjaC0+dXNicmVkaXJob3N0KSB7CisgICAgICAgIFNQSUNFX0RFQlVH
KCIlcyBjaCAlcCIsIF9fRlVOQ1RJT05fXywgY2gpOworICAgICAgICB1c2JyZWRpcmhvc3RfZnJl
ZV93cml0ZV9idWZmZXIoY2gtPnVzYnJlZGlyaG9zdCwgZGF0YSk7CisgICAgfSBlbHNlIHsKKyAg
ICAgICAgU1BJQ0VfREVCVUcoIiVzIGNoICVwIC0gTk9CT0RZIFRPIENBTEwiLCBfX0ZVTkNUSU9O
X18sIGNoKTsKKyAgICB9Cit9CisKK2dib29sZWFuIHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxf
YXR0YWNoKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHRXJyb3IgKiplcnJvcikKK3sKKyAg
ICBTUElDRV9ERUJVRygiJXMgPj4gY2ggJXAsIGRldiAlcCAod2FzIGF0dGFjaGVkICVwKSIsIF9f
RlVOQ1RJT05fXywgY2gsIGRldiwgY2gtPmF0dGFjaGVkKTsKKworICAgIGdfcmV0dXJuX3ZhbF9p
Zl9mYWlsKGRldiAhPSBOVUxMLCBGQUxTRSk7CisKKyAgICBsaWJ1c2JfZGV2aWNlX2hhbmRsZSAq
aGFuZGxlID0gTlVMTDsKKyAgICBpbnQgcmMgPSBsaWJ1c2Jfb3BlbihkZXYtPmxpYnVzYl9kZXZp
Y2UsICZoYW5kbGUpOworICAgIGlmIChyYykgeworICAgICAgICBjb25zdCBjaGFyICpkZXNjID0g
bGlidXNiX3N0cmVycm9yKHJjKTsKKyAgICAgICAgZ19zZXRfZXJyb3IoZXJyb3IsIFNQSUNFX0NM
SUVOVF9FUlJPUiwgU1BJQ0VfQ0xJRU5UX0VSUk9SX0ZBSUxFRCwKKyAgICAgICAgICAgIkVycm9y
IGxpYnVzYl9vcGVuOiAlcyBbJWldIiwgZGVzYywgcmMpOworICAgICAgICByZXR1cm4gRkFMU0U7
CisgICAgfQorICAgIGNoLT5lcnJvciA9IGVycm9yOworICAgIHJjID0gdXNicmVkaXJob3N0X3Nl
dF9kZXZpY2UoY2gtPnVzYnJlZGlyaG9zdCwgaGFuZGxlKTsKKyAgICBpZiAocmMpIHsKKyAgICAg
ICAgU1BJQ0VfREVCVUcoIiVzIGNoICVwLCBkZXYgJXAgdXNicmVkaXJob3N0IGVycm9yICVkIiwg
X19GVU5DVElPTl9fLCBjaCwgZGV2LCByYyk7CisgICAgICAgIGNoLT5lcnJvciA9IE5VTEw7Cisg
ICAgICAgIHJldHVybiBGQUxTRTsKKyAgICB9IGVsc2UgeworICAgICAgICBjaC0+YXR0YWNoZWQg
PSBkZXY7CisgICAgICAgIGRldi0+YXR0YWNoZWRfdG8gPSBjaDsKKyAgICB9CisgICAgY2gtPmVy
cm9yID0gTlVMTDsKKyAgICByZXR1cm4gVFJVRTsKK30KKwordm9pZCBzcGljZV91c2JfYmFja2Vu
ZF9jaGFubmVsX2RldGFjaChTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCkKK3sKKyAgICBTUElD
RV9ERUJVRygiJXMgPj4gY2ggJXAsIHdhcyBhdHRhY2hlZCAlcCIsIF9fRlVOQ1RJT05fXywgY2gs
IGNoLT5hdHRhY2hlZCk7CisgICAgaWYgKCFjaC0+YXR0YWNoZWQpIHsKKyAgICAgICAgU1BJQ0Vf
REVCVUcoIiVzOiBub3RoaW5nIHRvIGRldGFjaCIsIF9fRlVOQ1RJT05fXyk7CisgICAgICAgIHJl
dHVybjsKKyAgICB9CisgICAgaWYgKGNoLT51c2JyZWRpcmhvc3QpIHsKKyAgICAgICAgLyogaXQg
d2lsbCBjYWxsIGxpYnVzYl9jbG9zZSBpbnRlcm5hbGx5ICovCisgICAgICAgIHVzYnJlZGlyaG9z
dF9zZXRfZGV2aWNlKGNoLT51c2JyZWRpcmhvc3QsIE5VTEwpOworICAgIH0KKyAgICBTUElDRV9E
RUJVRygiJXMgY2ggJXAsIGRldGFjaCBkb25lIiwgX19GVU5DVElPTl9fLCBjaCk7CisgICAgY2gt
PmF0dGFjaGVkLT5hdHRhY2hlZF90byA9IE5VTEw7CisgICAgY2gtPmF0dGFjaGVkID0gTlVMTDsK
K30KKworU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9u
ZXcoU3BpY2VVc2JCYWNrZW5kICpiZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKnVzZXJfZGF0YSkKK3sKKyAgICBTcGljZVVzYkJh
Y2tlbmRDaGFubmVsICpjaDsKKworICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKFNQSUNFX0lTX1VT
QlJFRElSX0NIQU5ORUwodXNlcl9kYXRhKSwgTlVMTCk7CisKKyAgICBjaCA9IGdfbmV3MChTcGlj
ZVVzYkJhY2tlbmRDaGFubmVsLCAxKTsKKyAgICBTUElDRV9ERUJVRygiJXMgPj4iLCBfX0ZVTkNU
SU9OX18pOworICAgIGNoLT51c2VyX2RhdGEgPSBTUElDRV9VU0JSRURJUl9DSEFOTkVMKHVzZXJf
ZGF0YSk7CisgICAgaWYgKGJlLT5saWJ1c2JfY29udGV4dCkgeworICAgICAgICBjaC0+dXNicmVk
aXJob3N0ID0gdXNicmVkaXJob3N0X29wZW5fZnVsbCgKKyAgICAgICAgICAgIGJlLT5saWJ1c2Jf
Y29udGV4dCwKKyAgICAgICAgICAgIE5VTEwsCisgICAgICAgICAgICB1c2JyZWRpcl9sb2csCisg
ICAgICAgICAgICB1c2JyZWRpcl9yZWFkX2NhbGxiYWNrLAorICAgICAgICAgICAgdXNicmVkaXJf
d3JpdGVfY2FsbGJhY2ssCisgICAgICAgICAgICB1c2JyZWRpcl93cml0ZV9mbHVzaF9jYWxsYmFj
aywKKyAgICAgICAgICAgIHVzYnJlZGlyX2FsbG9jX2xvY2ssCisgICAgICAgICAgICB1c2JyZWRp
cl9sb2NrX2xvY2ssCisgICAgICAgICAgICB1c2JyZWRpcl91bmxvY2tfbG9jaywKKyAgICAgICAg
ICAgIHVzYnJlZGlyX2ZyZWVfbG9jaywKKyAgICAgICAgICAgIGNoLCBQQUNLQUdFX1NUUklORywK
KyAgICAgICAgICAgIHNwaWNlX3V0aWxfZ2V0X2RlYnVnKCkgPyB1c2JyZWRpcnBhcnNlcl9kZWJ1
ZyA6IHVzYnJlZGlycGFyc2VyX3dhcm5pbmcsCisgICAgICAgICAgICB1c2JyZWRpcmhvc3RfZmxf
d3JpdGVfY2Jfb3duc19idWZmZXIpOworICAgICAgICBnX3dhcm5faWZfZmFpbChjaC0+dXNicmVk
aXJob3N0ICE9IE5VTEwpOworICAgIH0KKyAgICBpZiAoY2gtPnVzYnJlZGlyaG9zdCkgeworICAg
ICAgICB1c2JyZWRpcmhvc3Rfc2V0X2J1ZmZlcmVkX291dHB1dF9zaXplX2NiKGNoLT51c2JyZWRp
cmhvc3QsIHVzYnJlZGlyX2J1ZmZlcmVkX291dHB1dF9zaXplX2NhbGxiYWNrKTsKKyAgICB9IGVs
c2UgeworICAgICAgICBnX2ZyZWUoY2gpOworICAgICAgICBjaCA9IE5VTEw7CisgICAgfQorCisg
ICAgU1BJQ0VfREVCVUcoIiVzIDw8ICVwIiwgX19GVU5DVElPTl9fLCBjaCk7CisgICAgcmV0dXJu
IGNoOworfQorCit2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfZmx1c2hfd3JpdGVzKFNw
aWNlVXNiQmFja2VuZENoYW5uZWwgKmNoKQoreworICAgIFNQSUNFX0RFQlVHKCIlcyAlcCwgaG9z
dCAlcCIsIF9fRlVOQ1RJT05fXywgY2gsIGNoLT51c2JyZWRpcmhvc3QpOworICAgIGlmIChjaC0+
dXNicmVkaXJob3N0KSB7CisgICAgICAgIHVzYnJlZGlyaG9zdF93cml0ZV9ndWVzdF9kYXRhKGNo
LT51c2JyZWRpcmhvc3QpOworICAgIH0KK30KKwordm9pZCBzcGljZV91c2JfYmFja2VuZF9jaGFu
bmVsX2RlbGV0ZShTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCkKK3sKKyAgICBTUElDRV9ERUJV
RygiJXMgPj4gJXAiLCBfX0ZVTkNUSU9OX18sIGNoKTsKKyAgICBpZiAoIWNoKSB7CisgICAgICAg
IHJldHVybjsKKyAgICB9CisgICAgaWYgKGNoLT51c2JyZWRpcmhvc3QpIHsKKyAgICAgICAgdXNi
cmVkaXJob3N0X2Nsb3NlKGNoLT51c2JyZWRpcmhvc3QpOworICAgIH0KKworICAgIGlmIChjaC0+
cnVsZXMpIHsKKyAgICAgICAgZ19mcmVlKGNoLT5ydWxlcyk7CisgICAgfQorCisgICAgZ19mcmVl
KGNoKTsKKyAgICBTUElDRV9ERUJVRygiJXMgPDwgJXAiLCBfX0ZVTkNUSU9OX18sIGNoKTsKK30K
Kwordm9pZAorc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9nZXRfZ3Vlc3RfZmlsdGVyKFNwaWNl
VXNiQmFja2VuZENoYW5uZWwgKmNoLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGNvbnN0IHN0cnVjdCB1c2JyZWRpcmZpbHRlcl9ydWxlICoqciwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgKmNvdW50KQoreworICAgIGlu
dCBpOworICAgICpyID0gTlVMTDsKKyAgICAqY291bnQgPSAwOworICAgIGlmIChjaC0+dXNicmVk
aXJob3N0KSB7CisgICAgICAgIHVzYnJlZGlyaG9zdF9nZXRfZ3Vlc3RfZmlsdGVyKGNoLT51c2Jy
ZWRpcmhvc3QsIHIsIGNvdW50KTsKKyAgICB9CisgICAgaWYgKCpyID09IE5VTEwpIHsKKyAgICAg
ICAgKnIgPSBjaC0+cnVsZXM7CisgICAgICAgICpjb3VudCA9IGNoLT5ydWxlc19jb3VudDsKKyAg
ICB9CisKKyAgICBTUElDRV9ERUJVRygiJXMgY2ggJXA6ICVkIGZpbHRlcnMiLCBfX0ZVTkNUSU9O
X18sIGNoLCAqY291bnQpOworCisgICAgZm9yIChpID0gMDsgaSA8ICpjb3VudDsgaSsrKSB7Cisg
ICAgICAgIGNvbnN0IHN0cnVjdCB1c2JyZWRpcmZpbHRlcl9ydWxlICpyYSA9ICpyOworICAgICAg
ICBTUElDRV9ERUJVRygiJXMgY2xhc3MgJWQsICVYOiVYIiwKKyAgICAgICAgICAgIHJhW2ldLmFs
bG93ID8gImFsbG93ZWQiIDogImRlbmllZCIsIHJhW2ldLmRldmljZV9jbGFzcywKKyAgICAgICAg
ICAgICh1aW50MzJfdClyYVtpXS52ZW5kb3JfaWQsICh1aW50MzJfdClyYVtpXS5wcm9kdWN0X2lk
KTsKKyAgICB9Cit9CisKKyNlbmRpZiAvKiBVU0JfUkVESVIgKi8KZGlmZiAtLWdpdCBhL3NyYy91
c2ItYmFja2VuZC5oIGIvc3JjL3VzYi1iYWNrZW5kLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5k
ZXggMDAwMDAwMC4uOWYyYTk3YQotLS0gL2Rldi9udWxsCisrKyBiL3NyYy91c2ItYmFja2VuZC5o
CkBAIC0wLDAgKzEsMTAyIEBACisvKiAtKi0gTW9kZTogQzsgYy1iYXNpYy1vZmZzZXQ6IDQ7IGlu
ZGVudC10YWJzLW1vZGU6IG5pbCAtKi0gKi8KKy8qCisgICAgQ29weXJpZ2h0IChDKSAyMDE4IFJl
ZCBIYXQsIEluYy4KKworICAgIFJlZCBIYXQgQXV0aG9yczoKKyAgICBZdXJpIEJlbmRpdG92aWNo
PHliZW5kaXRvQHJlZGhhdC5jb20+CisKKyAgICBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2Fy
ZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCisgICAgbW9kaWZ5IGl0IHVuZGVyIHRo
ZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYworICAgIExpY2Vuc2UgYXMg
cHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlcgorICAgIHZl
cnNpb24gMi4xIG9mIHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2
ZXJzaW9uLgorCisgICAgVGhpcyBsaWJyYXJ5IGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRo
YXQgaXQgd2lsbCBiZSB1c2VmdWwsCisgICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRo
b3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKKyAgICBNRVJDSEFOVEFCSUxJVFkgb3Ig
RklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQorICAgIExlc3Nl
ciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCisKKyAgICBZb3Ugc2hv
dWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGlj
CisgICAgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCBzZWUgPGh0dHA6
Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgorKi8KKworI2lmbmRlZiBfX1NQSUNFX1VTQl9CQUNL
RU5EX0hfXworI2RlZmluZSBfX1NQSUNFX1VTQl9CQUNLRU5EX0hfXworCisjaW5jbHVkZSA8dXNi
cmVkaXJmaWx0ZXIuaD4KKyNpbmNsdWRlICJ1c2ItZGV2aWNlLW1hbmFnZXIuaCIKKworR19CRUdJ
Tl9ERUNMUworCit0eXBlZGVmIHN0cnVjdCBfU3BpY2VVc2JCYWNrZW5kIFNwaWNlVXNiQmFja2Vu
ZDsKK3R5cGVkZWYgc3RydWN0IF9TcGljZVVzYkJhY2tlbmREZXZpY2UgU3BpY2VVc2JCYWNrZW5k
RGV2aWNlOwordHlwZWRlZiBzdHJ1Y3QgX1NwaWNlVXNiQmFja2VuZENoYW5uZWwgU3BpY2VVc2JC
YWNrZW5kQ2hhbm5lbDsKKwordHlwZWRlZiBzdHJ1Y3QgVXNiRGV2aWNlSW5mb3JtYXRpb24KK3sK
KyAgICB1aW50MTZfdCBidXM7CisgICAgdWludDE2X3QgYWRkcmVzczsKKyAgICB1aW50MTZfdCB2
aWQ7CisgICAgdWludDE2X3QgcGlkOworICAgIHVpbnQ4X3QgY2xhc3M7CisgICAgdWludDhfdCBz
dWJjbGFzczsKKyAgICB1aW50OF90IHByb3RvY29sOworfSBVc2JEZXZpY2VJbmZvcm1hdGlvbjsK
KwordHlwZWRlZiB2b2lkKCp1c2JfaG90X3BsdWdfY2FsbGJhY2spKHZvaWQgKnVzZXJfZGF0YSwg
U3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYsIGdib29sZWFuIGFkZGVkKTsKKworZW51bSB7Cisg
ICAgVVNCX1JFRElSX0VSUk9SX0lPID0gLTEsCisgICAgVVNCX1JFRElSX0VSUk9SX1JFQURfUEFS
U0UgPSAtMiwKKyAgICBVU0JfUkVESVJfRVJST1JfREVWX1JFSkVDVEVEID0gLTMsCisgICAgVVNC
X1JFRElSX0VSUk9SX0RFVl9MT1NUID0gLTQsCit9OworCisvKiBTcGljZSBVU0IgYmFja2VuZCBB
UEkgKi8KKy8qIHNldHMgZXJyb3Igb24gZmFpbHVyZSAqLworU3BpY2VVc2JCYWNrZW5kICpzcGlj
ZV91c2JfYmFja2VuZF9uZXcoR0Vycm9yICoqZXJyb3IpOwordm9pZCBzcGljZV91c2JfYmFja2Vu
ZF9kZWxldGUoU3BpY2VVc2JCYWNrZW5kICpjb250ZXh0KTsKKworLyoKK3JldHVybnMgbmV3bHkt
YWxsb2NhdGVkIG51bGwtdGVybWluYXRlZCBsaXN0IG9mCitTcGljZVVzYkJhY2tlbmREZXZpY2Ug
cG9pbnRlcnMuCitUaGUgY2FsbGVyIG11c3QgY2FsbCBzcGljZV91c2JfYmFja2VuZF9mcmVlX2Rl
dmljZV9saXN0CithZnRlciBpdCBmaW5pc2hlcyBsaXN0IHByb2Nlc3NpbmcKKyovCitTcGljZVVz
YkJhY2tlbmREZXZpY2UgKipzcGljZV91c2JfYmFja2VuZF9nZXRfZGV2aWNlX2xpc3QoU3BpY2VV
c2JCYWNrZW5kICpiYWNrZW5kKTsKK3ZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfZnJlZV9kZXZpY2Vf
bGlzdChTcGljZVVzYkJhY2tlbmREZXZpY2UgKipkZXZsaXN0KTsKK2dib29sZWFuIHNwaWNlX3Vz
Yl9iYWNrZW5kX2hhbmRsZV9ldmVudHMoU3BpY2VVc2JCYWNrZW5kICpiZSk7CitnYm9vbGVhbiBz
cGljZV91c2JfYmFja2VuZF9yZWdpc3Rlcl9ob3RwbHVnKFNwaWNlVXNiQmFja2VuZCAqYmUsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKnVzZXJfZGF0
YSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNiX2hvdF9w
bHVnX2NhbGxiYWNrIHByb2MpOwordm9pZCBzcGljZV91c2JfYmFja2VuZF9kZXJlZ2lzdGVyX2hv
dHBsdWcoU3BpY2VVc2JCYWNrZW5kICpiZSk7CisKKy8qIFNwaWNlIFVTQiBiYWNrZW5kIGRldmlj
ZSBBUEkgKi8KK1NwaWNlVXNiQmFja2VuZERldmljZSAqc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNl
X3JlZihTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldik7Cit2b2lkIHNwaWNlX3VzYl9iYWNrZW5k
X2RldmljZV91bnJlZihTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldik7CitnY29uc3Rwb2ludGVy
IHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9nZXRfbGliZGV2KFNwaWNlVXNiQmFja2VuZERldmlj
ZSAqZGV2KTsKK2NvbnN0IFVzYkRldmljZUluZm9ybWF0aW9uKiBzcGljZV91c2JfYmFja2VuZF9k
ZXZpY2VfZ2V0X2luZm8oU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYpOworZ2Jvb2xlYW4gc3Bp
Y2VfdXNiX2JhY2tlbmRfZGV2aWNlX2lzb2NoKFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2KTsK
Ky8qIHJldHVybnMgMCBpZiB0aGUgZGV2aWNlIHBhc3NlcyB0aGUgZmlsdGVyICovCitpbnQgc3Bp
Y2VfdXNiX2JhY2tlbmRfZGV2aWNlX2NoZWNrX2ZpbHRlcihTcGljZVVzYkJhY2tlbmREZXZpY2Ug
KmRldiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0
cnVjdCB1c2JyZWRpcmZpbHRlcl9ydWxlICpydWxlcywgaW50IGNvdW50KTsKKworLyogU3BpY2Ug
VVNCIGJhY2tlbmQgY2hhbm5lbCBBUEkgKi8KK1NwaWNlVXNiQmFja2VuZENoYW5uZWwgKnNwaWNl
X3VzYl9iYWNrZW5kX2NoYW5uZWxfbmV3KFNwaWNlVXNiQmFja2VuZCAqY29udGV4dCwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgICAg
ICAgICAgICAqdXNlcl9kYXRhKTsKK3ZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9kZWxl
dGUoU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gpOworLyogcmV0dXJucyAwIGZvciBzdWNjZXNz
IG9yIGVycm9yIGNvZGUgKi8KK2ludCBzcGljZV91c2JfYmFja2VuZF9yZWFkX2d1ZXN0X2RhdGEo
U3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gsIHVpbnQ4X3QgKmRhdGEsIGludCBjb3VudCk7CitH
RXJyb3IgKnNwaWNlX3VzYl9iYWNrZW5kX2dldF9lcnJvcl9kZXRhaWxzKGludCBlcnJvcl9jb2Rl
LCBnY2hhciAqZGV2aWNlX2Rlc2MpOworZ2Jvb2xlYW4gc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5l
bF9hdHRhY2goU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldiwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdFcnJvciAqKmVycm9yKTsKK3Zv
aWQgc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9kZXRhY2goU3BpY2VVc2JCYWNrZW5kQ2hhbm5l
bCAqY2gpOwordm9pZCBzcGljZV91c2JfYmFja2VuZF9jaGFubmVsX2ZsdXNoX3dyaXRlcyhTcGlj
ZVVzYkJhY2tlbmRDaGFubmVsICpjaCk7Cit2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxf
Z2V0X2d1ZXN0X2ZpbHRlcihTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCB1c2JyZWRp
cmZpbHRlcl9ydWxlICAqKnJ1bGVzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgaW50ICpjb3VudCk7Cit2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX3JldHVy
bl93cml0ZV9kYXRhKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLCB2b2lkICpkYXRhKTsKKwor
R19FTkRfREVDTFMKKworI2VuZGlmCmRpZmYgLS1naXQgYS9zcmMvdXNiLWRldmljZS1tYW5hZ2Vy
LXByaXYuaCBiL3NyYy91c2ItZGV2aWNlLW1hbmFnZXItcHJpdi5oCmluZGV4IDgzODg0ZDcuLjM5
YWFmMmYgMTAwNjQ0Ci0tLSBhL3NyYy91c2ItZGV2aWNlLW1hbmFnZXItcHJpdi5oCisrKyBiL3Ny
Yy91c2ItZGV2aWNlLW1hbmFnZXItcHJpdi5oCkBAIC0zMiw3ICszMiw2IEBAIHZvaWQgc3BpY2Vf
dXNiX2RldmljZV9tYW5hZ2VyX3N0b3BfZXZlbnRfbGlzdGVuaW5nKAogICAgIFNwaWNlVXNiRGV2
aWNlTWFuYWdlciAqbWFuYWdlcik7CiAKICNpZmRlZiBVU0VfVVNCUkVESVIKLSNpbmNsdWRlIDxs
aWJ1c2IuaD4KIHZvaWQgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2RldmljZV9lcnJvcigKICAg
ICBTcGljZVVzYkRldmljZU1hbmFnZXIgKm1hbmFnZXIsIFNwaWNlVXNiRGV2aWNlICpkZXZpY2Us
IEdFcnJvciAqZXJyKTsKIApkaWZmIC0tZ2l0IGEvc3JjL3VzYi1kZXZpY2UtbWFuYWdlci5jIGIv
c3JjL3VzYi1kZXZpY2UtbWFuYWdlci5jCmluZGV4IDkzOTFkNmEuLjJiZWU1NWQgMTAwNjQ0Ci0t
LSBhL3NyYy91c2ItZGV2aWNlLW1hbmFnZXIuYworKysgYi9zcmMvdXNiLWRldmljZS1tYW5hZ2Vy
LmMKQEAgLTI1LDE1ICsyNSwxNCBAQAogCiAjaWZkZWYgVVNFX1VTQlJFRElSCiAjaW5jbHVkZSA8
ZXJybm8uaD4KLSNpbmNsdWRlIDxsaWJ1c2IuaD4KIAogI2lmZGVmIEdfT1NfV0lOMzIKKyNpbmNs
dWRlIDx3aW5kb3dzLmg+CiAjaW5jbHVkZSAidXNiZGtfYXBpLmgiCiAjaW5jbHVkZSAid2luLXVz
Yi1kZXYuaCIKICNlbmRpZgogCiAjaW5jbHVkZSAiY2hhbm5lbC11c2JyZWRpci1wcml2LmgiCi0j
aW5jbHVkZSAidXNicmVkaXJob3N0LmgiCiAjaW5jbHVkZSAidXNidXRpbC5oIgogI2VuZGlmCiAK
QEAgLTk0LDcgKzkzLDcgQEAgc3RydWN0IF9TcGljZVVzYkRldmljZU1hbmFnZXJQcml2YXRlIHsK
ICAgICBnY2hhciAqYXV0b19jb25uZWN0X2ZpbHRlcjsKICAgICBnY2hhciAqcmVkaXJlY3Rfb25f
Y29ubmVjdDsKICNpZmRlZiBVU0VfVVNCUkVESVIKLSAgICBsaWJ1c2JfY29udGV4dCAqY29udGV4
dDsKKyAgICBTcGljZVVzYkJhY2tlbmQgKmNvbnRleHQ7CiAgICAgaW50IGV2ZW50X2xpc3RlbmVy
czsKICAgICBHVGhyZWFkICpldmVudF90aHJlYWQ7CiAgICAgZ2ludCBldmVudF90aHJlYWRfcnVu
OwpAQCAtMTA2LDcgKzEwNSw2IEBAIHN0cnVjdCBfU3BpY2VVc2JEZXZpY2VNYW5hZ2VyUHJpdmF0
ZSB7CiAgICAgR1VkZXZDbGllbnQgKnVkZXY7CiAjZWxzZQogICAgIGdib29sZWFuIHJlZGlyZWN0
aW5nOyAvKiBIYW5kbGVkIGJ5IEdVZGV2Q2xpZW50IGluIHRoZSBndWRldiBjYXNlICovCi0gICAg
bGlidXNiX2hvdHBsdWdfY2FsbGJhY2tfaGFuZGxlIGhwX2hhbmRsZTsKICNlbmRpZgogI2lmZGVm
IEdfT1NfV0lOMzIKICAgICB1c2Jka19hcGlfd3JhcHBlciAgICAgKnVzYmRrX2FwaTsKQEAgLTEz
Niw3ICsxMzQsNyBAQCB0eXBlZGVmIHN0cnVjdCBfU3BpY2VVc2JEZXZpY2VJbmZvIHsKICAgICBn
dWludDE2IHZpZDsKICAgICBndWludDE2IHBpZDsKICAgICBnYm9vbGVhbiBpc29jaHJvbm91czsK
LSAgICBsaWJ1c2JfZGV2aWNlICpsaWJkZXY7CisgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpi
ZGV2OwogICAgIGdpbnQgICAgcmVmOwogfSBTcGljZVVzYkRldmljZUluZm87CiAKQEAgLTE0OSwx
OSArMTQ3LDE4IEBAIHN0YXRpYyB2b2lkIGNoYW5uZWxfZXZlbnQoU3BpY2VDaGFubmVsICpjaGFu
bmVsLCBTcGljZUNoYW5uZWxFdmVudCBldmVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
Z3BvaW50ZXIgdXNlcl9kYXRhKTsKICNpZmRlZiBHX09TX1dJTjMyCiBzdGF0aWMgdm9pZCBzcGlj
ZV91c2JfZGV2aWNlX21hbmFnZXJfdWV2ZW50X2NiKEdVZGV2Q2xpZW50ICAgICAqY2xpZW50LAot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ1c2JfZGV2
aWNlICAgKnVkZXZpY2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqdWRldmljZSwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2Jvb2xlYW4gICAgICAgICBhZGQsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdwb2ludGVyICAgICAg
ICAgdXNlcl9kYXRhKTsKICNlbHNlCi1zdGF0aWMgaW50IHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdl
cl9ob3RwbHVnX2NiKGxpYnVzYl9jb250ZXh0ICAgICAgICpjdHgsCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnVzYl9kZXZpY2UgICAgICAgICpkZXZp
Y2UsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnVz
Yl9ob3RwbHVnX2V2ZW50ICBldmVudCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdm9pZCAgICAgICAgICAgICAgICAgKmRhdGEpOworc3RhdGljIHZvaWQg
c3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2hvdHBsdWdfY2Iodm9pZCAqdXNlcl9kYXRhLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VVc2JCYWNr
ZW5kRGV2aWNlICpkZXYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBnYm9vbGVhbiBhZGRlZCk7CiAjZW5kaWYKIHN0YXRpYyB2b2lkIHNwaWNlX3VzYl9k
ZXZpY2VfbWFuYWdlcl9jaGVja19yZWRpcl9vbl9jb25uZWN0KAogICAgIFNwaWNlVXNiRGV2aWNl
TWFuYWdlciAqc2VsZiwgU3BpY2VDaGFubmVsICpjaGFubmVsKTsKIAotc3RhdGljIFNwaWNlVXNi
RGV2aWNlSW5mbyAqc3BpY2VfdXNiX2RldmljZV9uZXcobGlidXNiX2RldmljZSAqbGliZGV2KTsK
K3N0YXRpYyBTcGljZVVzYkRldmljZUluZm8gKnNwaWNlX3VzYl9kZXZpY2VfbmV3KFNwaWNlVXNi
QmFja2VuZERldmljZSAqYmRldik7CiBzdGF0aWMgU3BpY2VVc2JEZXZpY2UgKnNwaWNlX3VzYl9k
ZXZpY2VfcmVmKFNwaWNlVXNiRGV2aWNlICpkZXZpY2UpOwogc3RhdGljIHZvaWQgc3BpY2VfdXNi
X2RldmljZV91bnJlZihTcGljZVVzYkRldmljZSAqZGV2aWNlKTsKIApAQCAtMTcwLDEyICsxNjcs
MTIgQEAgc3RhdGljIHZvaWQgX3VzYmRrX2hpZGVyX3VwZGF0ZShTcGljZVVzYkRldmljZU1hbmFn
ZXIgKm1hbmFnZXIpOwogc3RhdGljIHZvaWQgX3VzYmRrX2hpZGVyX2NsZWFyKFNwaWNlVXNiRGV2
aWNlTWFuYWdlciAqbWFuYWdlcik7CiAjZW5kaWYKIAotc3RhdGljIGdib29sZWFuIHNwaWNlX3Vz
Yl9tYW5hZ2VyX2RldmljZV9lcXVhbF9saWJkZXYoU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICptYW5h
Z2VyLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgU3BpY2VVc2JEZXZpY2UgKmRldmljZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnVzYl9kZXZpY2UgKmxpYmRldik7Ci1zdGF0aWMg
bGlidXNiX2RldmljZSAqCi1zcGljZV91c2JfZGV2aWNlX21hbmFnZXJfZGV2aWNlX3RvX2xpYmRl
dihTcGljZVVzYkRldmljZU1hbmFnZXIgKnNlbGYsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBTcGljZVVzYkRldmljZSAqZGV2aWNlKTsKK3N0YXRpYyBnYm9vbGVh
biBzcGljZV91c2JfbWFuYWdlcl9kZXZpY2VfZXF1YWxfYmRldihTcGljZVVzYkRldmljZU1hbmFn
ZXIgKm1hbmFnZXIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgU3BpY2VVc2JEZXZpY2UgKmRldmljZSwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmJkZXYp
Oworc3RhdGljIFNwaWNlVXNiQmFja2VuZERldmljZSAqCitzcGljZV91c2JfZGV2aWNlX21hbmFn
ZXJfZGV2aWNlX3RvX2JkZXYoU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICpzZWxmLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNlVXNiRGV2aWNlICpkZXZpY2UpOwog
CiBzdGF0aWMgdm9pZAogX3NwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9jb25uZWN0X2RldmljZV9h
c3luYyhTcGljZVVzYkRldmljZU1hbmFnZXIgKnNlbGYsCkBAIC0yNzcsMTQgKzI3NCw5IEBAIHN0
YXRpYyBnYm9vbGVhbiBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfaW5pdGFibGVfaW5pdChHSW5p
dGFibGUgICppbml0YWJsZSwKICAgICBHTGlzdCAqaXQ7CiAKICNpZm5kZWYgR19PU19XSU4zMgot
ICAgIGludCByYzsKICAgICAvKiBJbml0aWFsaXplIGxpYnVzYiAqLwotICAgIHJjID0gbGlidXNi
X2luaXQoJnByaXYtPmNvbnRleHQpOwotICAgIGlmIChyYyA8IDApIHsKLSAgICAgICAgY29uc3Qg
Y2hhciAqZGVzYyA9IGxpYnVzYl9zdHJlcnJvcihyYyk7Ci0gICAgICAgIGdfd2FybmluZygiRXJy
b3IgaW5pdGlhbGl6aW5nIFVTQiBzdXBwb3J0OiAlcyBbJWldIiwgZGVzYywgcmMpOwotICAgICAg
ICBnX3NldF9lcnJvcihlcnIsIFNQSUNFX0NMSUVOVF9FUlJPUiwgU1BJQ0VfQ0xJRU5UX0VSUk9S
X0ZBSUxFRCwKLSAgICAgICAgICAgICAgICAgICAgIkVycm9yIGluaXRpYWxpemluZyBVU0Igc3Vw
cG9ydDogJXMgWyVpXSIsIGRlc2MsIHJjKTsKKyAgICBwcml2LT5jb250ZXh0ID0gc3BpY2VfdXNi
X2JhY2tlbmRfbmV3KGVycik7CisgICAgaWYgKCFwcml2LT5jb250ZXh0KSB7CiAgICAgICAgIHJl
dHVybiBGQUxTRTsKICAgICB9CiAjZW5kaWYKQEAgLTMwMiwxNiArMjk0LDggQEAgc3RhdGljIGdi
b29sZWFuIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9pbml0YWJsZV9pbml0KEdJbml0YWJsZSAg
KmluaXRhYmxlLAogICAgIC8qIERvIGNvbGRwbHVnIChkZXRlY3Rpb24gb2YgYWxyZWFkeSBjb25u
ZWN0ZWQgZGV2aWNlcykgKi8KICAgICBnX3VkZXZfY2xpZW50X3JlcG9ydF9kZXZpY2VzKHByaXYt
PnVkZXYpOwogI2Vsc2UKLSAgICByYyA9IGxpYnVzYl9ob3RwbHVnX3JlZ2lzdGVyX2NhbGxiYWNr
KHByaXYtPmNvbnRleHQsCi0gICAgICAgIExJQlVTQl9IT1RQTFVHX0VWRU5UX0RFVklDRV9BUlJJ
VkVEIHwgTElCVVNCX0hPVFBMVUdfRVZFTlRfREVWSUNFX0xFRlQsCi0gICAgICAgIExJQlVTQl9I
T1RQTFVHX0VOVU1FUkFURSwgTElCVVNCX0hPVFBMVUdfTUFUQ0hfQU5ZLAotICAgICAgICBMSUJV
U0JfSE9UUExVR19NQVRDSF9BTlksIExJQlVTQl9IT1RQTFVHX01BVENIX0FOWSwKLSAgICAgICAg
c3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2hvdHBsdWdfY2IsIHNlbGYsICZwcml2LT5ocF9oYW5k
bGUpOwotICAgIGlmIChyYyA8IDApIHsKLSAgICAgICAgY29uc3QgY2hhciAqZGVzYyA9IGxpYnVz
Yl9zdHJlcnJvcihyYyk7Ci0gICAgICAgIGdfd2FybmluZygiRXJyb3IgaW5pdGlhbGl6aW5nIFVT
QiBob3RwbHVnIHN1cHBvcnQ6ICVzIFslaV0iLCBkZXNjLCByYyk7Ci0gICAgICAgIGdfc2V0X2Vy
cm9yKGVyciwgU1BJQ0VfQ0xJRU5UX0VSUk9SLCBTUElDRV9DTElFTlRfRVJST1JfRkFJTEVELAot
ICAgICAgICAgICAgICAgICAgIkVycm9yIGluaXRpYWxpemluZyBVU0IgaG90cGx1ZyBzdXBwb3J0
OiAlcyBbJWldIiwgZGVzYywgcmMpOworICAgIGlmICghc3BpY2VfdXNiX2JhY2tlbmRfcmVnaXN0
ZXJfaG90cGx1Zyhwcml2LT5jb250ZXh0LCBzZWxmLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfaG90cGx1Z19jYikp
IHsKICAgICAgICAgcmV0dXJuIEZBTFNFOwogICAgIH0KICAgICBzcGljZV91c2JfZGV2aWNlX21h
bmFnZXJfc3RhcnRfZXZlbnRfbGlzdGVuaW5nKHNlbGYsIE5VTEwpOwpAQCAtMzQyLDIxICszMjYs
MTcgQEAgc3RhdGljIHZvaWQgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2Rpc3Bvc2UoR09iamVj
dCAqZ29iamVjdCkKICAgICBTcGljZVVzYkRldmljZU1hbmFnZXJQcml2YXRlICpwcml2ID0gc2Vs
Zi0+cHJpdjsKIAogI2lmbmRlZiBHX09TX1dJTjMyCi0gICAgaWYgKHByaXYtPmhwX2hhbmRsZSkg
ewotICAgICAgICBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfc3RvcF9ldmVudF9saXN0ZW5pbmco
c2VsZik7Ci0gICAgICAgIGlmIChnX2F0b21pY19pbnRfZ2V0KCZwcml2LT5ldmVudF90aHJlYWRf
cnVuKSkgewotICAgICAgICAgICAgLyogRm9yY2UgdGVybWluYXRpb24gb2YgdGhlIGV2ZW50IHRo
cmVhZCBldmVuIGlmIHRoZXJlIHdlcmUgc29tZQotICAgICAgICAgICAgICogbWlzbWF0Y2hlZCBz
cGljZV91c2JfZGV2aWNlX21hbmFnZXJfe3N0YXJ0LHN0b3B9X2V2ZW50X2xpc3RlbmluZwotICAg
ICAgICAgICAgICogY2FsbHMuIE90aGVyd2lzZSwgdGhlIHVzYiBldmVudCB0aHJlYWQgd2lsbCBi
ZSBsZWFrZWQsIGFuZCB3aWxsCi0gICAgICAgICAgICAgKiB0cnkgdG8gdXNlIHRoZSBsaWJ1c2Ig
Y29udGV4dCB3ZSBkZXN0cm95IGluIGZpbmFsaXplKCksIHdoaWNoIHdvdWxkCi0gICAgICAgICAg
ICAgKiBjYXVzZSBhIGNyYXNoICovCi0gICAgICAgICAgICAgZ193YXJuX2lmX3JlYWNoZWQoKTsK
LSAgICAgICAgICAgICBnX2F0b21pY19pbnRfc2V0KCZwcml2LT5ldmVudF90aHJlYWRfcnVuLCBG
QUxTRSk7Ci0gICAgICAgIH0KLSAgICAgICAgLyogVGhpcyBhbHNvIHdha2VzIHVwIHRoZSBsaWJ1
c2JfaGFuZGxlX2V2ZW50cygpIGluIHRoZSBldmVudF90aHJlYWQgKi8KLSAgICAgICAgbGlidXNi
X2hvdHBsdWdfZGVyZWdpc3Rlcl9jYWxsYmFjayhwcml2LT5jb250ZXh0LCBwcml2LT5ocF9oYW5k
bGUpOwotICAgICAgICBwcml2LT5ocF9oYW5kbGUgPSAwOworICAgIHNwaWNlX3VzYl9kZXZpY2Vf
bWFuYWdlcl9zdG9wX2V2ZW50X2xpc3RlbmluZyhzZWxmKTsKKyAgICBpZiAoZ19hdG9taWNfaW50
X2dldCgmcHJpdi0+ZXZlbnRfdGhyZWFkX3J1bikpIHsKKyAgICAgICAgLyogRm9yY2UgdGVybWlu
YXRpb24gb2YgdGhlIGV2ZW50IHRocmVhZCBldmVuIGlmIHRoZXJlIHdlcmUgc29tZQorICAgICAg
ICAgKiBtaXNtYXRjaGVkIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl97c3RhcnQsc3RvcH1fZXZl
bnRfbGlzdGVuaW5nCisgICAgICAgICAqIGNhbGxzLiBPdGhlcndpc2UsIHRoZSB1c2IgZXZlbnQg
dGhyZWFkIHdpbGwgYmUgbGVha2VkLCBhbmQgd2lsbAorICAgICAgICAgKiB0cnkgdG8gdXNlIHRo
ZSBsaWJ1c2IgY29udGV4dCB3ZSBkZXN0cm95IGluIGZpbmFsaXplKCksIHdoaWNoIHdvdWxkCisg
ICAgICAgICAqIGNhdXNlIGEgY3Jhc2ggKi8KKyAgICAgICAgZ193YXJuX2lmX3JlYWNoZWQoKTsK
KyAgICAgICAgZ19hdG9taWNfaW50X3NldCgmcHJpdi0+ZXZlbnRfdGhyZWFkX3J1biwgRkFMU0Up
OwogICAgIH0KKyAgICBzcGljZV91c2JfYmFja2VuZF9kZXJlZ2lzdGVyX2hvdHBsdWcocHJpdi0+
Y29udGV4dCk7CiAjZW5kaWYKICAgICBpZiAocHJpdi0+ZXZlbnRfdGhyZWFkKSB7CiAgICAgICAg
IGdfd2Fybl9pZl9mYWlsKGdfYXRvbWljX2ludF9nZXQoJnByaXYtPmV2ZW50X3RocmVhZF9ydW4p
ID09IEZBTFNFKTsKQEAgLTM4Niw3ICszNjYsNyBAQCBzdGF0aWMgdm9pZCBzcGljZV91c2JfZGV2
aWNlX21hbmFnZXJfZmluYWxpemUoR09iamVjdCAqZ29iamVjdCkKICAgICBnX3JldHVybl9pZl9m
YWlsKHByaXYtPmV2ZW50X3RocmVhZCA9PSBOVUxMKTsKICNpZm5kZWYgR19PU19XSU4zMgogICAg
IGlmIChwcml2LT5jb250ZXh0KQotICAgICAgICBsaWJ1c2JfZXhpdChwcml2LT5jb250ZXh0KTsK
KyAgICAgICAgc3BpY2VfdXNiX2JhY2tlbmRfZGVsZXRlKHByaXYtPmNvbnRleHQpOwogI2VuZGlm
CiAgICAgZnJlZShwcml2LT5hdXRvX2Nvbm5fZmlsdGVyX3J1bGVzKTsKICAgICBmcmVlKHByaXYt
PnJlZGlyZWN0X29uX2Nvbm5lY3RfcnVsZXMpOwpAQCAtNzA5LDM3ICs2ODksNiBAQCBzdGF0aWMg
dm9pZCBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfY2xhc3NfaW5pdChTcGljZVVzYkRldmljZU1h
bmFnZXJDbGFzcyAqa2xhcwogICAgICAgICAgICAgICAgICAgICAgR19UWVBFX0VSUk9SKTsKIH0K
IAotI2lmZGVmIFVTRV9VU0JSRURJUgotCi0vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8KLS8qIGd1ZGV2IC8gbGli
dXNiIEhlbHBlciBmdW5jdGlvbnMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAq
LwotCi1zdGF0aWMgZ2Jvb2xlYW4gc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2dldF9kZXZpY2Vf
ZGVzY3JpcHRvcigKLSAgICBsaWJ1c2JfZGV2aWNlICpsaWJkZXYsCi0gICAgc3RydWN0IGxpYnVz
Yl9kZXZpY2VfZGVzY3JpcHRvciAqZGVzYykKLXsKLSAgICBpbnQgZXJyY29kZTsKLSAgICBjb25z
dCBnY2hhciAqZXJyc3RyOwotCi0gICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwobGliZGV2ICE9IE5V
TEwsIEZBTFNFKTsKLSAgICBnX3JldHVybl92YWxfaWZfZmFpbChkZXNjICAgIT0gTlVMTCwgRkFM
U0UpOwotCi0gICAgZXJyY29kZSA9IGxpYnVzYl9nZXRfZGV2aWNlX2Rlc2NyaXB0b3IobGliZGV2
LCBkZXNjKTsKLSAgICBpZiAoZXJyY29kZSA8IDApIHsKLSAgICAgICAgaW50IGJ1cywgYWRkcjsK
LQotICAgICAgICBidXMgPSBsaWJ1c2JfZ2V0X2J1c19udW1iZXIobGliZGV2KTsKLSAgICAgICAg
YWRkciA9IGxpYnVzYl9nZXRfZGV2aWNlX2FkZHJlc3MobGliZGV2KTsKLSAgICAgICAgZXJyc3Ry
ID0gbGlidXNiX3N0cmVycm9yKGVycmNvZGUpOwotICAgICAgICBnX3dhcm5pbmcoImNhbm5vdCBn
ZXQgZGV2aWNlIGRlc2NyaXB0b3IgZm9yICglcCkgJWQuJWQgLS0gJXMoJWQpIiwKLSAgICAgICAg
ICAgICAgICAgIGxpYmRldiwgYnVzLCBhZGRyLCBlcnJzdHIsIGVycmNvZGUpOwotICAgICAgICBy
ZXR1cm4gRkFMU0U7Ci0gICAgfQotICAgIHJldHVybiBUUlVFOwotfQotCi0jZW5kaWYgLy8gVVNF
X1VTQlJFRElSCi0KIC8qKgogICogc3BpY2VfdXNiX2RldmljZV9nZXRfbGlidXNiX2RldmljZToK
ICAqIEBkZXZpY2U6ICNTcGljZVVzYkRldmljZSB0byBnZXQgdGhlIGRlc2NyaXB0b3IgaW5mb3Jt
YXRpb24gb2YKQEAgLTc1OCwzMiArNzA3LDEyIEBAIHNwaWNlX3VzYl9kZXZpY2VfZ2V0X2xpYnVz
Yl9kZXZpY2UoY29uc3QgU3BpY2VVc2JEZXZpY2UgKmRldmljZSBHX0dOVUNfVU5VU0VEKQogCiAg
ICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwoaW5mbyAhPSBOVUxMLCBGQUxTRSk7CiAKLSAgICByZXR1
cm4gaW5mby0+bGliZGV2OworICAgIHJldHVybiBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfZ2V0
X2xpYmRldihpbmZvLT5iZGV2KTsKICNlbmRpZgogICAgIHJldHVybiBOVUxMOwogfQogCiAjaWZk
ZWYgVVNFX1VTQlJFRElSCi1zdGF0aWMgZ2Jvb2xlYW4gc3BpY2VfdXNiX2RldmljZV9tYW5hZ2Vy
X2dldF9saWJkZXZfdmlkX3BpZCgKLSAgICBsaWJ1c2JfZGV2aWNlICpsaWJkZXYsIGludCAqdmlk
LCBpbnQgKnBpZCkKLXsKLSAgICBzdHJ1Y3QgbGlidXNiX2RldmljZV9kZXNjcmlwdG9yIGRlc2M7
Ci0KLSAgICBnX3JldHVybl92YWxfaWZfZmFpbChsaWJkZXYgIT0gTlVMTCwgRkFMU0UpOwotICAg
IGdfcmV0dXJuX3ZhbF9pZl9mYWlsKHZpZCAhPSBOVUxMLCBGQUxTRSk7Ci0gICAgZ19yZXR1cm5f
dmFsX2lmX2ZhaWwocGlkICE9IE5VTEwsIEZBTFNFKTsKLQotICAgICp2aWQgPSAqcGlkID0gMDsK
LQotICAgIGlmICghc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2dldF9kZXZpY2VfZGVzY3JpcHRv
cihsaWJkZXYsICZkZXNjKSkgewotICAgICAgICByZXR1cm4gRkFMU0U7Ci0gICAgfQotICAgICp2
aWQgPSBkZXNjLmlkVmVuZG9yOwotICAgICpwaWQgPSBkZXNjLmlkUHJvZHVjdDsKLQotICAgIHJl
dHVybiBUUlVFOwotfQotCiAvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8KIC8qIGNhbGxiYWNrcyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqLwogCkBAIC04
OTksMzEgKzgyOCwyNCBAQCBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfZmluZF9kZXZpY2UoU3Bp
Y2VVc2JEZXZpY2VNYW5hZ2VyICpzZWxmLAogfQogCiBzdGF0aWMgdm9pZCBzcGljZV91c2JfZGV2
aWNlX21hbmFnZXJfYWRkX2RldihTcGljZVVzYkRldmljZU1hbmFnZXIgICpzZWxmLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlidXNiX2RldmljZSAgICAg
ICAgICAqbGliZGV2KQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICAqYmRldikKIHsKICAgICBTcGljZVVzYkRldmljZU1h
bmFnZXJQcml2YXRlICpwcml2ID0gc2VsZi0+cHJpdjsKLSAgICBzdHJ1Y3QgbGlidXNiX2Rldmlj
ZV9kZXNjcmlwdG9yIGRlc2M7CisgICAgY29uc3QgVXNiRGV2aWNlSW5mb3JtYXRpb24gKmJfaW5m
byA9IHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9nZXRfaW5mbyhiZGV2KTsKICAgICBTcGljZVVz
YkRldmljZSAqZGV2aWNlOwogCi0gICAgaWYgKCFzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfZ2V0
X2RldmljZV9kZXNjcmlwdG9yKGxpYmRldiwgJmRlc2MpKQotICAgICAgICByZXR1cm47Ci0KLSAg
ICAvKiBTa2lwIGh1YnMgKi8KLSAgICBpZiAoZGVzYy5iRGV2aWNlQ2xhc3MgPT0gTElCVVNCX0NM
QVNTX0hVQikKLSAgICAgICAgcmV0dXJuOwotCiAgICAgaWYgKHNwaWNlX3VzYl9kZXZpY2VfbWFu
YWdlcl9maW5kX2RldmljZShzZWxmLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgbGlidXNiX2dldF9idXNfbnVtYmVyKGxpYmRldiksCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ1c2JfZ2V0X2RldmljZV9hZGRyZXNz
KGxpYmRldikpKSB7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBiX2luZm8tPmJ1cywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGJfaW5mby0+YWRkcmVzcykpIHsKICAgICAgICAgU1BJQ0VfREVCVUcoImRldmljZSBub3Qg
YWRkZWQgJWQ6JWQgJTA0eDolMDR4IiwKLSAgICAgICAgICAgICAgICAgICAgbGlidXNiX2dldF9i
dXNfbnVtYmVyKGxpYmRldiksCi0gICAgICAgICAgICAgICAgICAgIGxpYnVzYl9nZXRfZGV2aWNl
X2FkZHJlc3MobGliZGV2KSwKLSAgICAgICAgICAgICAgICAgICAgZGVzYy5pZFZlbmRvciwKLSAg
ICAgICAgICAgICAgICAgICAgZGVzYy5pZFByb2R1Y3QpOworICAgICAgICAgICAgICAgICAgICBi
X2luZm8tPmJ1cywKKyAgICAgICAgICAgICAgICAgICAgYl9pbmZvLT5hZGRyZXNzLAorICAgICAg
ICAgICAgICAgICAgICBiX2luZm8tPnZpZCwKKyAgICAgICAgICAgICAgICAgICAgYl9pbmZvLT5w
aWQpOwogICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgZGV2aWNlID0gKFNwaWNlVXNiRGV2
aWNlKilzcGljZV91c2JfZGV2aWNlX25ldyhsaWJkZXYpOworICAgIGRldmljZSA9IChTcGljZVVz
YkRldmljZSopc3BpY2VfdXNiX2RldmljZV9uZXcoYmRldik7CiAgICAgaWYgKCFkZXZpY2UpCiAg
ICAgICAgIHJldHVybjsKIApAQCAtOTM1LDEwICs4NTcsMTAgQEAgc3RhdGljIHZvaWQgc3BpY2Vf
dXNiX2RldmljZV9tYW5hZ2VyX2FkZF9kZXYoU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICAqc2VsZiwK
ICAgICAgICAgY2FuX3JlZGlyZWN0ID0gc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2Nhbl9yZWRp
cmVjdF9kZXZpY2UoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vs
ZiwgZGV2aWNlLCBOVUxMKTsKIAotICAgICAgICBhdXRvX29rID0gdXNicmVkaXJob3N0X2NoZWNr
X2RldmljZV9maWx0ZXIoCisgICAgICAgIGF1dG9fb2sgPSBzcGljZV91c2JfYmFja2VuZF9kZXZp
Y2VfY2hlY2tfZmlsdGVyKAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJkZXYsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgcHJpdi0+YXV0b19jb25uX2ZpbHRlcl9ydWxlcywKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBwcml2LT5hdXRvX2Nvbm5fZmlsdGVyX3J1bGVzX2Nv
dW50LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYmRldiwgMCkgPT0gMDsKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBwcml2LT5hdXRvX2Nvbm5fZmlsdGVyX3J1bGVzX2NvdW50
KSA9PSAwOwogCiAgICAgICAgIGlmIChjYW5fcmVkaXJlY3QgJiYgYXV0b19vaykKICAgICAgICAg
ICAgIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9jb25uZWN0X2RldmljZV9hc3luYyhzZWxmLApA
QCAtOTU1LDE1ICs4NzcsMTYgQEAgc3RhdGljIHZvaWQgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2Vy
X2FkZF9kZXYoU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICAqc2VsZiwKIH0KIAogc3RhdGljIHZvaWQg
c3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX3JlbW92ZV9kZXYoU3BpY2VVc2JEZXZpY2VNYW5hZ2Vy
ICpzZWxmLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Z3VpbnQgYnVzLCBndWludCBhZGRyZXNzKQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpiZGV2KQogewogICAgIFNw
aWNlVXNiRGV2aWNlTWFuYWdlclByaXZhdGUgKnByaXYgPSBzZWxmLT5wcml2OwogICAgIFNwaWNl
VXNiRGV2aWNlICpkZXZpY2U7CisgICAgY29uc3QgVXNiRGV2aWNlSW5mb3JtYXRpb24gKmJfaW5m
byA9IHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9nZXRfaW5mbyhiZGV2KTsKIAotICAgIGRldmlj
ZSA9IHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9maW5kX2RldmljZShzZWxmLCBidXMsIGFkZHJl
c3MpOworICAgIGRldmljZSA9IHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9maW5kX2RldmljZShz
ZWxmLCBiX2luZm8tPmJ1cywgYl9pbmZvLT5hZGRyZXNzKTsKICAgICBpZiAoIWRldmljZSkgewog
ICAgICAgICBnX3dhcm5pbmcoIkNvdWxkIG5vdCBmaW5kIFVTQiBkZXZpY2UgdG8gcmVtb3ZlICIg
REVWX0lEX0ZNVCwKLSAgICAgICAgICAgICAgICAgIGJ1cywgYWRkcmVzcyk7CisgICAgICAgICAg
ICAgICAgICBiX2luZm8tPmJ1cywgYl9pbmZvLT5hZGRyZXNzKTsKICAgICAgICAgcmV0dXJuOwog
ICAgIH0KIApAQCAtOTgyLDI0ICs5MDUsMjIgQEAgc3RhdGljIHZvaWQgc3BpY2VfdXNiX2Rldmlj
ZV9tYW5hZ2VyX3JlbW92ZV9kZXYoU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICpzZWxmLAogCiAjaWZk
ZWYgR19PU19XSU4zMgogc3RhdGljIHZvaWQgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX3VldmVu
dF9jYihHVWRldkNsaWVudCAgICAgKmNsaWVudCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgbGlidXNiX2RldmljZSAgICpkZXYsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAq
YmRldiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2Jv
b2xlYW4gICAgICAgICBhZGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGdwb2ludGVyICAgICAgICAgdXNlcl9kYXRhKQogewogICAgIFNwaWNlVXNiRGV2
aWNlTWFuYWdlciAqc2VsZiA9IFNQSUNFX1VTQl9ERVZJQ0VfTUFOQUdFUih1c2VyX2RhdGEpOwog
CiAgICAgaWYgKGFkZCkKLSAgICAgICAgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2FkZF9kZXYo
c2VsZiwgZGV2KTsKKyAgICAgICAgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2FkZF9kZXYoc2Vs
ZiwgYmRldik7CiAgICAgZWxzZQotICAgICAgICBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfcmVt
b3ZlX2RldihzZWxmLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBsaWJ1c2JfZ2V0X2J1c19udW1iZXIoZGV2KSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgbGlidXNiX2dldF9kZXZpY2VfYWRkcmVzcyhkZXYpKTsKKyAgICAg
ICAgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX3JlbW92ZV9kZXYoc2VsZiwgYmRldik7CiB9CiAj
ZWxzZQogc3RydWN0IGhvdHBsdWdfaWRsZV9jYl9hcmdzIHsKICAgICBTcGljZVVzYkRldmljZU1h
bmFnZXIgKnNlbGY7Ci0gICAgbGlidXNiX2RldmljZSAqZGV2aWNlOwotICAgIGxpYnVzYl9ob3Rw
bHVnX2V2ZW50IGV2ZW50OworICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2aWNlOworICAg
IGdib29sZWFuICAgICAgICAgICAgICAgYWRkZWQ7CiB9OwogCiBzdGF0aWMgZ2Jvb2xlYW4gc3Bp
Y2VfdXNiX2RldmljZV9tYW5hZ2VyX2hvdHBsdWdfaWRsZV9jYihncG9pbnRlciB1c2VyX2RhdGEp
CkBAIC0xMDA3LDM2ICs5MjgsMjkgQEAgc3RhdGljIGdib29sZWFuIHNwaWNlX3VzYl9kZXZpY2Vf
bWFuYWdlcl9ob3RwbHVnX2lkbGVfY2IoZ3BvaW50ZXIgdXNlcl9kYXRhKQogICAgIHN0cnVjdCBo
b3RwbHVnX2lkbGVfY2JfYXJncyAqYXJncyA9IHVzZXJfZGF0YTsKICAgICBTcGljZVVzYkRldmlj
ZU1hbmFnZXIgKnNlbGYgPSBTUElDRV9VU0JfREVWSUNFX01BTkFHRVIoYXJncy0+c2VsZik7CiAK
LSAgICBzd2l0Y2ggKGFyZ3MtPmV2ZW50KSB7Ci0gICAgY2FzZSBMSUJVU0JfSE9UUExVR19FVkVO
VF9ERVZJQ0VfQVJSSVZFRDoKKyAgICBpZiAoYXJncy0+YWRkZWQpCiAgICAgICAgIHNwaWNlX3Vz
Yl9kZXZpY2VfbWFuYWdlcl9hZGRfZGV2KHNlbGYsIGFyZ3MtPmRldmljZSk7Ci0gICAgICAgIGJy
ZWFrOwotICAgIGNhc2UgTElCVVNCX0hPVFBMVUdfRVZFTlRfREVWSUNFX0xFRlQ6Ci0gICAgICAg
IHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9yZW1vdmVfZGV2KHNlbGYsCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBsaWJ1c2JfZ2V0X2J1c19udW1iZXIoYXJncy0+ZGV2aWNl
KSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnVzYl9nZXRfZGV2aWNl
X2FkZHJlc3MoYXJncy0+ZGV2aWNlKSk7Ci0gICAgICAgIGJyZWFrOwotICAgIH0KLSAgICBsaWJ1
c2JfdW5yZWZfZGV2aWNlKGFyZ3MtPmRldmljZSk7CisgICAgZWxzZQorICAgICAgICBzcGljZV91
c2JfZGV2aWNlX21hbmFnZXJfcmVtb3ZlX2RldihzZWxmLCBhcmdzLT5kZXZpY2UpOworCisgICAg
c3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX3VucmVmKGFyZ3MtPmRldmljZSk7CiAgICAgZ19vYmpl
Y3RfdW5yZWYoc2VsZik7CiAgICAgZ19mcmVlKGFyZ3MpOwogICAgIHJldHVybiBGQUxTRTsKIH0K
IAogLyogQ2FuIGJlIGNhbGxlZCBmcm9tIGJvdGggdGhlIG1haW4tdGhyZWFkIGFzIHdlbGwgYXMg
dGhlIGV2ZW50X3RocmVhZCAqLwotc3RhdGljIGludCBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJf
aG90cGx1Z19jYihsaWJ1c2JfY29udGV4dCAgICAgICAqY3R4LAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ1c2JfZGV2aWNlICAgICAgICAqZGV2aWNl
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ1c2Jf
aG90cGx1Z19ldmVudCAgZXZlbnQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHZvaWQgICAgICAgICAgICAgICAgICp1c2VyX2RhdGEpCitzdGF0aWMgdm9p
ZCBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfaG90cGx1Z19jYih2b2lkICp1c2VyX2RhdGEsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZVVzYkJh
Y2tlbmREZXZpY2UgKmRldiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGdib29sZWFuIGFkZGVkKQogewogICAgIFNwaWNlVXNiRGV2aWNlTWFuYWdlciAq
c2VsZiA9IFNQSUNFX1VTQl9ERVZJQ0VfTUFOQUdFUih1c2VyX2RhdGEpOwogICAgIHN0cnVjdCBo
b3RwbHVnX2lkbGVfY2JfYXJncyAqYXJncyA9IGdfbWFsbG9jMChzaXplb2YoKmFyZ3MpKTsKIAog
ICAgIGFyZ3MtPnNlbGYgPSBnX29iamVjdF9yZWYoc2VsZik7Ci0gICAgYXJncy0+ZGV2aWNlID0g
bGlidXNiX3JlZl9kZXZpY2UoZGV2aWNlKTsKLSAgICBhcmdzLT5ldmVudCA9IGV2ZW50OworICAg
IGFyZ3MtPmRldmljZSA9IHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9yZWYoZGV2KTsKKyAgICBh
cmdzLT5hZGRlZCA9IGFkZGVkOwogICAgIGdfaWRsZV9hZGQoc3BpY2VfdXNiX2RldmljZV9tYW5h
Z2VyX2hvdHBsdWdfaWRsZV9jYiwgYXJncyk7Ci0gICAgcmV0dXJuIDA7CiB9CiAjZW5kaWYgLy8g
VVNFX1VTQlJFRElSCiAKQEAgLTEwNjMsMTMgKzk3Nyw5IEBAIHN0YXRpYyBncG9pbnRlciBzcGlj
ZV91c2JfZGV2aWNlX21hbmFnZXJfdXNiX2V2X3RocmVhZChncG9pbnRlciB1c2VyX2RhdGEpCiB7
CiAgICAgU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICpzZWxmID0gU1BJQ0VfVVNCX0RFVklDRV9NQU5B
R0VSKHVzZXJfZGF0YSk7CiAgICAgU3BpY2VVc2JEZXZpY2VNYW5hZ2VyUHJpdmF0ZSAqcHJpdiA9
IHNlbGYtPnByaXY7Ci0gICAgaW50IHJjOwogCiAgICAgd2hpbGUgKGdfYXRvbWljX2ludF9nZXQo
JnByaXYtPmV2ZW50X3RocmVhZF9ydW4pKSB7Ci0gICAgICAgIHJjID0gbGlidXNiX2hhbmRsZV9l
dmVudHMocHJpdi0+Y29udGV4dCk7Ci0gICAgICAgIGlmIChyYyAmJiByYyAhPSBMSUJVU0JfRVJS
T1JfSU5URVJSVVBURUQpIHsKLSAgICAgICAgICAgIGNvbnN0IGNoYXIgKmRlc2MgPSBsaWJ1c2Jf
c3RyZXJyb3IocmMpOwotICAgICAgICAgICAgZ193YXJuaW5nKCJFcnJvciBoYW5kbGluZyBVU0Ig
ZXZlbnRzOiAlcyBbJWldIiwgZGVzYywgcmMpOworICAgICAgICBpZiAoIXNwaWNlX3VzYl9iYWNr
ZW5kX2hhbmRsZV9ldmVudHMocHJpdi0+Y29udGV4dCkpIHsKICAgICAgICAgICAgIGJyZWFrOwog
ICAgICAgICB9CiAgICAgfQpAQCAtMTEyMCw3ICsxMDMwLDcgQEAgc3RhdGljIHZvaWQgc3BpY2Vf
dXNiX2RldmljZV9tYW5hZ2VyX2NoZWNrX3JlZGlyX29uX2Nvbm5lY3QoCiAgICAgU3BpY2VVc2JE
ZXZpY2VNYW5hZ2VyUHJpdmF0ZSAqcHJpdiA9IHNlbGYtPnByaXY7CiAgICAgR1Rhc2sgKnRhc2s7
CiAgICAgU3BpY2VVc2JEZXZpY2UgKmRldmljZTsKLSAgICBsaWJ1c2JfZGV2aWNlICpsaWJkZXY7
CisgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpiZGV2OwogICAgIGd1aW50IGk7CiAKICAgICBp
ZiAocHJpdi0+cmVkaXJlY3Rfb25fY29ubmVjdCA9PSBOVUxMKQpAQCAtMTEzMiwxMSArMTA0Miwx
MSBAQCBzdGF0aWMgdm9pZCBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfY2hlY2tfcmVkaXJfb25f
Y29ubmVjdCgKICAgICAgICAgaWYgKHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9pc19kZXZpY2Vf
Y29ubmVjdGVkKHNlbGYsIGRldmljZSkpCiAgICAgICAgICAgICBjb250aW51ZTsKIAotICAgICAg
ICBsaWJkZXYgPSBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfZGV2aWNlX3RvX2xpYmRldihzZWxm
LCBkZXZpY2UpOwotICAgICAgICBpZiAodXNicmVkaXJob3N0X2NoZWNrX2RldmljZV9maWx0ZXIo
CisgICAgICAgIGJkZXYgPSBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfZGV2aWNlX3RvX2JkZXYo
c2VsZiwgZGV2aWNlKTsKKyAgICAgICAgaWYgKHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9jaGVj
a19maWx0ZXIoCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmRldiwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBwcml2LT5yZWRpcmVjdF9vbl9jb25uZWN0X3J1bGVzLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHByaXYtPnJlZGlyZWN0X29uX2Nvbm5lY3RfcnVsZXNfY291
bnQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGliZGV2LCAwKSA9PSAwKSB7CisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgcHJpdi0+cmVkaXJlY3Rfb25fY29ubmVjdF9ydWxlc19j
b3VudCkgPT0gMCkgewogICAgICAgICAgICAgLyogTm90ZTogcmUtdXNlcyBzcGljZV91c2JfZGV2
aWNlX21hbmFnZXJfY29ubmVjdF9kZXZpY2VfYXN5bmMncwogICAgICAgICAgICAgICAgY29tcGxl
dGlvbiBoYW5kbGluZyBjb2RlISAqLwogICAgICAgICAgICAgdGFzayA9IGdfdGFza19uZXcoc2Vs
ZiwKQEAgLTExNDYsMTQgKzEwNTYsMTQgQEAgc3RhdGljIHZvaWQgc3BpY2VfdXNiX2RldmljZV9t
YW5hZ2VyX2NoZWNrX3JlZGlyX29uX2Nvbm5lY3QoCiAKICAgICAgICAgICAgIHNwaWNlX3VzYnJl
ZGlyX2NoYW5uZWxfY29ubmVjdF9kZXZpY2VfYXN5bmMoCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgU1BJQ0VfVVNCUkVESVJfQ0hBTk5FTChjaGFubmVsKSwKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBsaWJkZXYsIGRldmljZSwgTlVMTCwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBiZGV2LCBkZXZpY2UsIE5VTEwsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2NoYW5uZWxfY29ubmVjdF9jYiwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrKTsKLSAgICAgICAgICAgIGxpYnVzYl91
bnJlZl9kZXZpY2UobGliZGV2KTsKKyAgICAgICAgICAgIHNwaWNlX3VzYl9iYWNrZW5kX2Rldmlj
ZV91bnJlZihiZGV2KTsKICAgICAgICAgICAgIHJldHVybjsgLyogV2UndmUgdGFrZW4gdGhlIGNo
YW5uZWwhICovCiAgICAgICAgIH0KIAotICAgICAgICBsaWJ1c2JfdW5yZWZfZGV2aWNlKGxpYmRl
dik7CisgICAgICAgIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV91bnJlZihiZGV2KTsKICAgICB9
CiB9CiAKQEAgLTExNzcsOCArMTA4Nyw4IEBAIHN0YXRpYyBTcGljZVVzYnJlZGlyQ2hhbm5lbCAq
c3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2dldF9jaGFubmVsX2Zvcl9kZXYoCiAgICAgZm9yIChp
ID0gMDsgaSA8IHByaXYtPmNoYW5uZWxzLT5sZW47IGkrKykgewogICAgICAgICBTcGljZVVzYnJl
ZGlyQ2hhbm5lbCAqY2hhbm5lbCA9IGdfcHRyX2FycmF5X2luZGV4KHByaXYtPmNoYW5uZWxzLCBp
KTsKICAgICAgICAgc3BpY2VfdXNicmVkaXJfY2hhbm5lbF9sb2NrKGNoYW5uZWwpOwotICAgICAg
ICBsaWJ1c2JfZGV2aWNlICpsaWJkZXYgPSBzcGljZV91c2JyZWRpcl9jaGFubmVsX2dldF9kZXZp
Y2UoY2hhbm5lbCk7Ci0gICAgICAgIGlmIChzcGljZV91c2JfbWFuYWdlcl9kZXZpY2VfZXF1YWxf
bGliZGV2KG1hbmFnZXIsIGRldmljZSwgbGliZGV2KSkgeworICAgICAgICBTcGljZVVzYkJhY2tl
bmREZXZpY2UgKmJkZXYgPSBzcGljZV91c2JyZWRpcl9jaGFubmVsX2dldF9kZXZpY2UoY2hhbm5l
bCk7CisgICAgICAgIGlmIChzcGljZV91c2JfbWFuYWdlcl9kZXZpY2VfZXF1YWxfYmRldihtYW5h
Z2VyLCBkZXZpY2UsIGJkZXYpKSB7CiAgICAgICAgICAgICBzcGljZV91c2JyZWRpcl9jaGFubmVs
X3VubG9jayhjaGFubmVsKTsKICAgICAgICAgICAgIHJldHVybiBjaGFubmVsOwogICAgICAgICB9
CkBAIC0xMjM1LDkgKzExNDUsOSBAQCBHUHRyQXJyYXkqIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdl
cl9nZXRfZGV2aWNlc193aXRoX2ZpbHRlcigKICAgICAgICAgU3BpY2VVc2JEZXZpY2UgKmRldmlj
ZSA9IGdfcHRyX2FycmF5X2luZGV4KHByaXYtPmRldmljZXMsIGkpOwogCiAgICAgICAgIGlmIChy
dWxlcykgewotICAgICAgICAgICAgbGlidXNiX2RldmljZSAqbGliZGV2ID0KLSAgICAgICAgICAg
ICAgICBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfZGV2aWNlX3RvX2xpYmRldihzZWxmLCBkZXZp
Y2UpOwotICAgICAgICAgICAgaWYgKHVzYnJlZGlyaG9zdF9jaGVja19kZXZpY2VfZmlsdGVyKHJ1
bGVzLCBjb3VudCwgbGliZGV2LCAwKSAhPSAwKQorICAgICAgICAgICAgU3BpY2VVc2JCYWNrZW5k
RGV2aWNlICpiZGV2ID0KKyAgICAgICAgICAgICAgICBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJf
ZGV2aWNlX3RvX2JkZXYoc2VsZiwgZGV2aWNlKTsKKyAgICAgICAgICAgIGlmIChzcGljZV91c2Jf
YmFja2VuZF9kZXZpY2VfY2hlY2tfZmlsdGVyKGJkZXYsIHJ1bGVzLCBjb3VudCkgIT0gMCkKICAg
ICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgfQogICAgICAgICBnX3B0cl9hcnJheV9h
ZGQoZGV2aWNlc19jb3B5LCBzcGljZV91c2JfZGV2aWNlX3JlZihkZXZpY2UpKTsKQEAgLTEzMTEs
NyArMTIyMSw3IEBAIF9zcGljZV91c2JfZGV2aWNlX21hbmFnZXJfY29ubmVjdF9kZXZpY2VfYXN5
bmMoU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICpzZWxmLAogICAgIHRhc2sgPSBnX3Rhc2tfbmV3KHNl
bGYsIGNhbmNlbGxhYmxlLCBjYWxsYmFjaywgdXNlcl9kYXRhKTsKIAogICAgIFNwaWNlVXNiRGV2
aWNlTWFuYWdlclByaXZhdGUgKnByaXYgPSBzZWxmLT5wcml2OwotICAgIGxpYnVzYl9kZXZpY2Ug
KmxpYmRldjsKKyAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmJkZXY7CiAgICAgZ3VpbnQgaTsK
IAogICAgIGlmIChzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfaXNfZGV2aWNlX2Nvbm5lY3RlZChz
ZWxmLCBkZXZpY2UpKSB7CkBAIC0xMzI3LDE0ICsxMjM3LDE0IEBAIF9zcGljZV91c2JfZGV2aWNl
X21hbmFnZXJfY29ubmVjdF9kZXZpY2VfYXN5bmMoU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICpzZWxm
LAogICAgICAgICBpZiAoc3BpY2VfdXNicmVkaXJfY2hhbm5lbF9nZXRfZGV2aWNlKGNoYW5uZWwp
KQogICAgICAgICAgICAgY29udGludWU7IC8qIFNraXAgYWxyZWFkeSB1c2VkIGNoYW5uZWxzICov
CiAKLSAgICAgICAgbGliZGV2ID0gc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2RldmljZV90b19s
aWJkZXYoc2VsZiwgZGV2aWNlKTsKKyAgICAgICAgYmRldiA9IHNwaWNlX3VzYl9kZXZpY2VfbWFu
YWdlcl9kZXZpY2VfdG9fYmRldihzZWxmLCBkZXZpY2UpOwogICAgICAgICBzcGljZV91c2JyZWRp
cl9jaGFubmVsX2Nvbm5lY3RfZGV2aWNlX2FzeW5jKGNoYW5uZWwsCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBsaWJkZXYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBiZGV2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsbGFibGUsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfY2hhbm5lbF9jb25uZWN0
X2NiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzayk7Ci0gICAgICAgIGxp
YnVzYl91bnJlZl9kZXZpY2UobGliZGV2KTsKKyAgICAgICAgc3BpY2VfdXNiX2JhY2tlbmRfZGV2
aWNlX3VucmVmKGJkZXYpOwogICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC0xNTk2LDEzICsx
NTA2LDE0IEBAIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9jYW5fcmVkaXJlY3RfZGV2aWNlKFNw
aWNlVXNiRGV2aWNlTWFuYWdlciAgKnNlbGYsCiAKICAgICBpZiAoZ3Vlc3RfZmlsdGVyX3J1bGVz
KSB7CiAgICAgICAgIGdib29sZWFuIGZpbHRlcl9vazsKLSAgICAgICAgbGlidXNiX2RldmljZSAq
bGliZGV2OwotCi0gICAgICAgIGxpYmRldiA9IHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9kZXZp
Y2VfdG9fbGliZGV2KHNlbGYsIGRldmljZSk7Ci0gICAgICAgIGZpbHRlcl9vayA9ICh1c2JyZWRp
cmhvc3RfY2hlY2tfZGV2aWNlX2ZpbHRlcigKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICBn
dWVzdF9maWx0ZXJfcnVsZXMsIGd1ZXN0X2ZpbHRlcl9ydWxlc19jb3VudCwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBsaWJkZXYsIDApID09IDApOwotICAgICAgICBsaWJ1c2JfdW5yZWZf
ZGV2aWNlKGxpYmRldik7CisgICAgICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqYmRldjsKKwor
ICAgICAgICBiZGV2ID0gc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2RldmljZV90b19iZGV2KHNl
bGYsIGRldmljZSk7CisgICAgICAgIGZpbHRlcl9vayA9IChzcGljZV91c2JfYmFja2VuZF9kZXZp
Y2VfY2hlY2tfZmlsdGVyKAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJkZXYsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgZ3Vlc3RfZmlsdGVyX3J1bGVzLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGd1ZXN0X2ZpbHRlcl9ydWxlc19jb3VudCkgPT0gMCk7CisgICAgICAg
IHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV91bnJlZihiZGV2KTsKICAgICAgICAgaWYgKCFmaWx0
ZXJfb2spIHsKICAgICAgICAgICAgIGdfc2V0X2Vycm9yX2xpdGVyYWwoZXJyLCBTUElDRV9DTElF
TlRfRVJST1IsIFNQSUNFX0NMSUVOVF9FUlJPUl9GQUlMRUQsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIF8oIlNvbWUgVVNCIGRldmljZXMgYXJlIGJsb2NrZWQgYnkgaG9zdCBwb2xp
Y3kiKSk7CkBAIC0xNjk2LDYwICsxNjA3LDI3IEBAIGdjaGFyICpzcGljZV91c2JfZGV2aWNlX2dl
dF9kZXNjcmlwdGlvbihTcGljZVVzYkRldmljZSAqZGV2aWNlLCBjb25zdCBnY2hhciAqZm9yCiAK
IAogI2lmZGVmIFVTRV9VU0JSRURJUgotc3RhdGljIGdib29sZWFuIHByb2JlX2lzb2Nocm9ub3Vz
X2VuZHBvaW50KGxpYnVzYl9kZXZpY2UgKmxpYmRldikKLXsKLSAgICBzdHJ1Y3QgbGlidXNiX2Nv
bmZpZ19kZXNjcmlwdG9yICpjb25mX2Rlc2M7Ci0gICAgZ2Jvb2xlYW4gaXNvY19mb3VuZCA9IEZB
TFNFOwotICAgIGdpbnQgaSwgaiwgazsKLQotICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKGxpYmRl
diAhPSBOVUxMLCBGQUxTRSk7Ci0KLSAgICBpZiAobGlidXNiX2dldF9hY3RpdmVfY29uZmlnX2Rl
c2NyaXB0b3IobGliZGV2LCAmY29uZl9kZXNjKSAhPSAwKSB7Ci0gICAgICAgIGdfcmV0dXJuX3Zh
bF9pZl9yZWFjaGVkKEZBTFNFKTsKLSAgICB9Ci0KLSAgICBmb3IgKGkgPSAwOyAhaXNvY19mb3Vu
ZCAmJiBpIDwgY29uZl9kZXNjLT5iTnVtSW50ZXJmYWNlczsgaSsrKSB7Ci0gICAgICAgIGZvciAo
aiA9IDA7ICFpc29jX2ZvdW5kICYmIGogPCBjb25mX2Rlc2MtPmludGVyZmFjZVtpXS5udW1fYWx0
c2V0dGluZzsgaisrKSB7Ci0gICAgICAgICAgICBmb3IgKGsgPSAwOyAhaXNvY19mb3VuZCAmJiBr
IDwgY29uZl9kZXNjLT5pbnRlcmZhY2VbaV0uYWx0c2V0dGluZ1tqXS5iTnVtRW5kcG9pbnRzO2sr
KykgewotICAgICAgICAgICAgICAgIGdpbnQgYXR0cmlidXRlcyA9IGNvbmZfZGVzYy0+aW50ZXJm
YWNlW2ldLmFsdHNldHRpbmdbal0uZW5kcG9pbnRba10uYm1BdHRyaWJ1dGVzOwotICAgICAgICAg
ICAgICAgIGdpbnQgdHlwZSA9IGF0dHJpYnV0ZXMgJiBMSUJVU0JfVFJBTlNGRVJfVFlQRV9NQVNL
OwotICAgICAgICAgICAgICAgIGlmICh0eXBlID09IExJQlVTQl9UUkFOU0ZFUl9UWVBFX0lTT0NI
Uk9OT1VTKQotICAgICAgICAgICAgICAgICAgICBpc29jX2ZvdW5kID0gVFJVRTsKLSAgICAgICAg
ICAgIH0KLSAgICAgICAgfQotICAgIH0KLQotICAgIGxpYnVzYl9mcmVlX2NvbmZpZ19kZXNjcmlw
dG9yKGNvbmZfZGVzYyk7Ci0gICAgcmV0dXJuIGlzb2NfZm91bmQ7Ci19Ci0KIC8qCiAgKiBTcGlj
ZVVzYkRldmljZUluZm8KICAqLwotc3RhdGljIFNwaWNlVXNiRGV2aWNlSW5mbyAqc3BpY2VfdXNi
X2RldmljZV9uZXcobGlidXNiX2RldmljZSAqbGliZGV2KQorc3RhdGljIFNwaWNlVXNiRGV2aWNl
SW5mbyAqc3BpY2VfdXNiX2RldmljZV9uZXcoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpiZGV2KQog
ewogICAgIFNwaWNlVXNiRGV2aWNlSW5mbyAqaW5mbzsKLSAgICBpbnQgdmlkLCBwaWQ7Ci0gICAg
Z3VpbnQ4IGJ1cywgYWRkcjsKLQotICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKGxpYmRldiAhPSBO
VUxMLCBOVUxMKTsKKyAgICBjb25zdCBVc2JEZXZpY2VJbmZvcm1hdGlvbiAqYmRldl9pbmZvOwog
Ci0gICAgYnVzID0gbGlidXNiX2dldF9idXNfbnVtYmVyKGxpYmRldik7Ci0gICAgYWRkciA9IGxp
YnVzYl9nZXRfZGV2aWNlX2FkZHJlc3MobGliZGV2KTsKKyAgICBnX3JldHVybl92YWxfaWZfZmFp
bChiZGV2ICE9IE5VTEwsIE5VTEwpOwogCi0gICAgaWYgKCFzcGljZV91c2JfZGV2aWNlX21hbmFn
ZXJfZ2V0X2xpYmRldl92aWRfcGlkKGxpYmRldiwgJnZpZCwgJnBpZCkpIHsKLSAgICAgICAgcmV0
dXJuIE5VTEw7Ci0gICAgfQorICAgIGJkZXZfaW5mbyA9IHNwaWNlX3VzYl9iYWNrZW5kX2Rldmlj
ZV9nZXRfaW5mbyhiZGV2KTsKIAogICAgIGluZm8gPSBnX25ldzAoU3BpY2VVc2JEZXZpY2VJbmZv
LCAxKTsKIAotICAgIGluZm8tPmJ1c251bSAgPSBidXM7Ci0gICAgaW5mby0+ZGV2YWRkciA9IGFk
ZHI7Ci0gICAgaW5mby0+dmlkID0gdmlkOwotICAgIGluZm8tPnBpZCA9IHBpZDsKKyAgICBpbmZv
LT5idXNudW0gID0gYmRldl9pbmZvLT5idXM7CisgICAgaW5mby0+ZGV2YWRkciA9IGJkZXZfaW5m
by0+YWRkcmVzczsKKyAgICBpbmZvLT52aWQgPSBiZGV2X2luZm8tPnZpZDsKKyAgICBpbmZvLT5w
aWQgPSBiZGV2X2luZm8tPnBpZDsKICAgICBpbmZvLT5yZWYgPSAxOwotICAgIGluZm8tPmlzb2No
cm9ub3VzID0gcHJvYmVfaXNvY2hyb25vdXNfZW5kcG9pbnQobGliZGV2KTsKLSAgICBpbmZvLT5s
aWJkZXYgPSBsaWJ1c2JfcmVmX2RldmljZShsaWJkZXYpOworICAgIGluZm8tPmJkZXYgPSBzcGlj
ZV91c2JfYmFja2VuZF9kZXZpY2VfcmVmKGJkZXYpOworICAgIGluZm8tPmlzb2Nocm9ub3VzID0g
c3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX2lzb2NoKGJkZXYpOwogCiAgICAgcmV0dXJuIGluZm87
CiB9CkBAIC0xODg1LDM1ICsxNzYzLDM1IEBAIHN0YXRpYyB2b2lkIHNwaWNlX3VzYl9kZXZpY2Vf
dW5yZWYoU3BpY2VVc2JEZXZpY2UgKmRldmljZSkKIAogICAgIHJlZl9jb3VudF9pc18wID0gZ19h
dG9taWNfaW50X2RlY19hbmRfdGVzdCgmaW5mby0+cmVmKTsKICAgICBpZiAocmVmX2NvdW50X2lz
XzApIHsKLSAgICAgICAgbGlidXNiX3VucmVmX2RldmljZShpbmZvLT5saWJkZXYpOworICAgICAg
ICBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfdW5yZWYoaW5mby0+YmRldik7CiAgICAgICAgIGdf
ZnJlZShpbmZvKTsKICAgICB9CiB9CiAKIHN0YXRpYyBnYm9vbGVhbgotc3BpY2VfdXNiX21hbmFn
ZXJfZGV2aWNlX2VxdWFsX2xpYmRldihTcGljZVVzYkRldmljZU1hbmFnZXIgKm1hbmFnZXIsCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNlVXNiRGV2aWNlICpkZXZp
Y2UsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnVzYl9kZXZpY2Ug
ICpsaWJkZXYpCitzcGljZV91c2JfbWFuYWdlcl9kZXZpY2VfZXF1YWxfYmRldihTcGljZVVzYkRl
dmljZU1hbmFnZXIgKm1hbmFnZXIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBTcGljZVVzYkRldmljZSAqZGV2aWNlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpiZGV2KQogewogICAgIFNwaWNlVXNiRGV2aWNl
SW5mbyAqaW5mbyA9IChTcGljZVVzYkRldmljZUluZm8gKilkZXZpY2U7CiAKLSAgICBpZiAoKGRl
dmljZSA9PSBOVUxMKSB8fCAobGliZGV2ID09IE5VTEwpKQorICAgIGlmICgoZGV2aWNlID09IE5V
TEwpIHx8IChiZGV2ID09IE5VTEwpKQogICAgICAgICByZXR1cm4gRkFMU0U7CiAKLSAgICByZXR1
cm4gaW5mby0+bGliZGV2ID09IGxpYmRldjsKKyAgICByZXR1cm4gaW5mby0+YmRldiA9PSBiZGV2
OwogfQogCiAvKgogICogQ2FsbGVyIG11c3QgbGlidXNiX3VucmVmX2RldmljZSB0aGUgbGlidXNi
X2RldmljZSByZXR1cm5lZCBieSB0aGlzIGZ1bmN0aW9uLgogICogUmV0dXJucyBhIGxpYnVzYl9k
ZXZpY2UsIG9yIE5VTEwgdXBvbiBmYWlsdXJlCiAgKi8KLXN0YXRpYyBsaWJ1c2JfZGV2aWNlICoK
LXNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9kZXZpY2VfdG9fbGliZGV2KFNwaWNlVXNiRGV2aWNl
TWFuYWdlciAqc2VsZiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFNwaWNlVXNiRGV2aWNlICpkZXZpY2UpCitzdGF0aWMgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICoK
K3NwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9kZXZpY2VfdG9fYmRldihTcGljZVVzYkRldmljZU1h
bmFnZXIgKnNlbGYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3Bp
Y2VVc2JEZXZpY2UgKmRldmljZSkKIHsKICAgICAvKiBTaW1wbHkgcmV0dXJuIGEgcmVmIHRvIHRo
ZSBjYWNoZWQgbGliZGV2ICovCiAgICAgU3BpY2VVc2JEZXZpY2VJbmZvICppbmZvID0gKFNwaWNl
VXNiRGV2aWNlSW5mbyAqKWRldmljZTsKIAotICAgIHJldHVybiBsaWJ1c2JfcmVmX2RldmljZShp
bmZvLT5saWJkZXYpOworICAgIHJldHVybiBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfcmVmKGlu
Zm8tPmJkZXYpOwogfQogI2VuZGlmIC8qIFVTRV9VU0JSRURJUiAqLwpkaWZmIC0tZ2l0IGEvc3Jj
L3dpbi11c2ItZGV2LmMgYi9zcmMvd2luLXVzYi1kZXYuYwppbmRleCBiMDI3NGRkLi5jMmE1MTE1
IDEwMDY0NAotLS0gYS9zcmMvd2luLXVzYi1kZXYuYworKysgYi9zcmMvd2luLXVzYi1kZXYuYwpA
QCAtMjMsMTEgKzIzLDkgQEAKICNpbmNsdWRlICJjb25maWcuaCIKIAogI2luY2x1ZGUgPHdpbmRv
d3MuaD4KLSNpbmNsdWRlIDxsaWJ1c2IuaD4KICNpbmNsdWRlICJ3aW4tdXNiLWRldi5oIgogI2lu
Y2x1ZGUgInNwaWNlLW1hcnNoYWwuaCIKICNpbmNsdWRlICJzcGljZS11dGlsLmgiCi0jaW5jbHVk
ZSAidXNidXRpbC5oIgogCiBlbnVtIHsKICAgICBQUk9QXzAsCkBAIC0zNSw3ICszMyw3IEBAIGVu
dW0gewogfTsKIAogc3RydWN0IF9HVWRldkNsaWVudFByaXZhdGUgewotICAgIGxpYnVzYl9jb250
ZXh0ICpjdHg7CisgICAgU3BpY2VVc2JCYWNrZW5kICpjdHg7CiAgICAgR0xpc3QgKnVkZXZfbGlz
dDsKICAgICBIV05EIGh3bmQ7CiAgICAgZ2Jvb2xlYW4gcmVkaXJlY3Rpbmc7CkBAIC02OCw5ICs2
Niw3IEBAIHN0YXRpYyB2b2lkIGdfdWRldl9kZXZpY2VfcHJpbnRfbGlzdChHTGlzdCAqbCwgY29u
c3QgZ2NoYXIgKm1zZyk7CiAjZWxzZQogc3RhdGljIHZvaWQgZ191ZGV2X2RldmljZV9wcmludF9s
aXN0KEdMaXN0ICpsLCBjb25zdCBnY2hhciAqbXNnKSB7fQogI2VuZGlmCi1zdGF0aWMgdm9pZCBn
X3VkZXZfZGV2aWNlX3ByaW50KGxpYnVzYl9kZXZpY2UgKmRldiwgY29uc3QgZ2NoYXIgKm1zZyk7
Ci0KLXN0YXRpYyBnYm9vbGVhbiBnX3VkZXZfc2tpcF9zZWFyY2gobGlidXNiX2RldmljZSAqZGV2
KTsKK3N0YXRpYyB2b2lkIGdfdWRldl9kZXZpY2VfcHJpbnQoU3BpY2VVc2JCYWNrZW5kRGV2aWNl
ICpkZXYsIGNvbnN0IGdjaGFyICptc2cpOwogCiBHUXVhcmsgZ191ZGV2X2NsaWVudF9lcnJvcl9x
dWFyayh2b2lkKQogewpAQCAtODYsNyArODIsNyBAQCBHVWRldkNsaWVudCAqZ191ZGV2X2NsaWVu
dF9uZXcodm9pZCkKICAgICByZXR1cm4gc2luZ2xldG9uOwogfQogCi1saWJ1c2JfY29udGV4dCAq
Z191ZGV2X2NsaWVudF9nZXRfY29udGV4dChHVWRldkNsaWVudCAqY2xpZW50KQorU3BpY2VVc2JC
YWNrZW5kICpnX3VkZXZfY2xpZW50X2dldF9jb250ZXh0KEdVZGV2Q2xpZW50ICpjbGllbnQpCiB7
CiAgICAgcmV0dXJuIGNsaWVudC0+cHJpdi0+Y3R4OwogfQpAQCAtOTksOCArOTUsNyBAQCBzdGF0
aWMgc3NpemVfdAogZ191ZGV2X2NsaWVudF9saXN0X2RldmljZXMoR1VkZXZDbGllbnQgKnNlbGYs
IEdMaXN0ICoqZGV2cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdFcnJvciAqKmVyciwg
Y29uc3QgZ2NoYXIgKm5hbWUpCiB7Ci0gICAgZ3NzaXplIHJjOwotICAgIGxpYnVzYl9kZXZpY2Ug
KipsdXNiX2xpc3QsICoqZGV2OworICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqKmx1c2JfbGlz
dCwgKipkZXY7CiAgICAgR1VkZXZDbGllbnRQcml2YXRlICpwcml2OwogICAgIHNzaXplX3QgbjsK
IApAQCAtMTExLDQzICsxMDYsMzMgQEAgZ191ZGV2X2NsaWVudF9saXN0X2RldmljZXMoR1VkZXZD
bGllbnQgKnNlbGYsIEdMaXN0ICoqZGV2cywKIAogICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKHNl
bGYtPnByaXYtPmN0eCAhPSBOVUxMLCAtMyk7CiAKLSAgICByYyA9IGxpYnVzYl9nZXRfZGV2aWNl
X2xpc3QocHJpdi0+Y3R4LCAmbHVzYl9saXN0KTsKLSAgICBpZiAocmMgPCAwKSB7Ci0gICAgICAg
IGNvbnN0IGNoYXIgKmVycnN0ciA9IGxpYnVzYl9zdHJlcnJvcihyYyk7Ci0gICAgICAgIGdfd2Fy
bmluZygiJXM6IGxpYnVzYl9nZXRfZGV2aWNlX2xpc3QgZmFpbGVkIC0gJXMiLCBuYW1lLCBlcnJz
dHIpOworICAgIGx1c2JfbGlzdCA9IHNwaWNlX3VzYl9iYWNrZW5kX2dldF9kZXZpY2VfbGlzdChw
cml2LT5jdHgpOworICAgIGlmICghbHVzYl9saXN0KSB7CiAgICAgICAgIGdfc2V0X2Vycm9yKGVy
ciwgR19VREVWX0NMSUVOVF9FUlJPUiwgR19VREVWX0NMSUVOVF9MSUJVU0JfRkFJTEVELAotICAg
ICAgICAgICAgICAgICAgICAiJXM6IEVycm9yIGdldHRpbmcgZGV2aWNlIGxpc3QgZnJvbSBsaWJ1
c2I6ICVzIFslIkdfR1NTSVpFX0ZPUk1BVCJdIiwKLSAgICAgICAgICAgICAgICAgICAgbmFtZSwg
ZXJyc3RyLCByYyk7CisgICAgICAgICAgICAgICAgICAgICIlczogRXJyb3IgZ2V0dGluZyBVU0Ig
ZGV2aWNlIGxpc3QiLCBuYW1lKTsKICAgICAgICAgcmV0dXJuIC00OwogICAgIH0KIAogICAgIG4g
PSAwOwogICAgIGZvciAoZGV2ID0gbHVzYl9saXN0OyAqZGV2OyBkZXYrKykgewotICAgICAgICBp
ZiAoZ191ZGV2X3NraXBfc2VhcmNoKCpkZXYpKSB7Ci0gICAgICAgICAgICBjb250aW51ZTsKLSAg
ICAgICAgfQotICAgICAgICAqZGV2cyA9IGdfbGlzdF9wcmVwZW5kKCpkZXZzLCBsaWJ1c2JfcmVm
X2RldmljZSgqZGV2KSk7CisgICAgICAgICpkZXZzID0gZ19saXN0X3ByZXBlbmQoKmRldnMsIHNw
aWNlX3VzYl9iYWNrZW5kX2RldmljZV9yZWYoKmRldikpOwogICAgICAgICBuKys7CiAgICAgfQot
ICAgIGxpYnVzYl9mcmVlX2RldmljZV9saXN0KGx1c2JfbGlzdCwgMSk7CisgICAgc3BpY2VfdXNi
X2JhY2tlbmRfZnJlZV9kZXZpY2VfbGlzdChsdXNiX2xpc3QpOwogCiAgICAgcmV0dXJuIG47CiB9
CiAKLXN0YXRpYyB2b2lkIHVucmVmZXJlbmNlX2xpYnVzYl9kZXZpY2UoZ3BvaW50ZXIgZGF0YSkK
K3N0YXRpYyB2b2lkIHVucmVmZXJlbmNlX2JhY2tlbmRfZGV2aWNlKGdwb2ludGVyIGRhdGEpCiB7
Ci0gICAgbGlidXNiX3VucmVmX2RldmljZSgobGlidXNiX2RldmljZSAqKWRhdGEpOworICAgIHNw
aWNlX3VzYl9iYWNrZW5kX2RldmljZV91bnJlZigoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICopZGF0
YSk7CiB9CiAKIHN0YXRpYyB2b2lkIGdfdWRldl9jbGllbnRfZnJlZV9kZXZpY2VfbGlzdChHTGlz
dCAqKmRldnMpCiB7CiAgICAgZ19yZXR1cm5faWZfZmFpbChkZXZzICE9IE5VTEwpOwogICAgIGlm
ICgqZGV2cykgewotICAgICAgICAvKiB0aGUgdW5yZWZlcmVuY2VfbGlidXNiX2RldmljZSBtZXRo
b2QgaXMgcmVxdWlyZWQgYXMKLSAgICAgICAgICogbGlidXNiX3VucmVmX2RldmljZSBjYWxsaW5n
IGNvbnZlbnRpb24gZGlmZmVycyBmcm9tIGdsaWIncwotICAgICAgICAgKiBzZWUgNTU4Yzk2N2Vj
Ci0gICAgICAgICAqLwotICAgICAgICBnX2xpc3RfZnJlZV9mdWxsKCpkZXZzLCB1bnJlZmVyZW5j
ZV9saWJ1c2JfZGV2aWNlKTsKKyAgICAgICAgZ19saXN0X2ZyZWVfZnVsbCgqZGV2cywgdW5yZWZl
cmVuY2VfYmFja2VuZF9kZXZpY2UpOwogICAgICAgICAqZGV2cyA9IE5VTEw7CiAgICAgfQogfQpA
QCAtMTYwLDcgKzE0NSw2IEBAIGdfdWRldl9jbGllbnRfaW5pdGFibGVfaW5pdChHSW5pdGFibGUg
KmluaXRhYmxlLCBHQ2FuY2VsbGFibGUgKmNhbmNlbGxhYmxlLAogICAgIEdVZGV2Q2xpZW50ICpz
ZWxmOwogICAgIEdVZGV2Q2xpZW50UHJpdmF0ZSAqcHJpdjsKICAgICBXTkRDTEFTUyB3Y2xzOwot
ICAgIGludCByYzsKIAogICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKEdfVURFVl9JU19DTElFTlQo
aW5pdGFibGUpLCBGQUxTRSk7CiAgICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwoY2FuY2VsbGFibGUg
PT0gTlVMTCwgRkFMU0UpOwpAQCAtMTY4LDE0ICsxNTIsMTEgQEAgZ191ZGV2X2NsaWVudF9pbml0
YWJsZV9pbml0KEdJbml0YWJsZSAqaW5pdGFibGUsIEdDYW5jZWxsYWJsZSAqY2FuY2VsbGFibGUs
CiAgICAgc2VsZiA9IEdfVURFVl9DTElFTlQoaW5pdGFibGUpOwogICAgIHByaXYgPSBzZWxmLT5w
cml2OwogCi0gICAgcmMgPSBsaWJ1c2JfaW5pdCgmcHJpdi0+Y3R4KTsKLSAgICBpZiAocmMgPCAw
KSB7Ci0gICAgICAgIGNvbnN0IGNoYXIgKmVycnN0ciA9IGxpYnVzYl9zdHJlcnJvcihyYyk7Ci0g
ICAgICAgIGdfd2FybmluZygiRXJyb3IgaW5pdGlhbGl6aW5nIFVTQiBzdXBwb3J0OiAlcyBbJWld
IiwgZXJyc3RyLCByYyk7Ci0gICAgICAgIGdfc2V0X2Vycm9yKGVyciwgR19VREVWX0NMSUVOVF9F
UlJPUiwgR19VREVWX0NMSUVOVF9MSUJVU0JfRkFJTEVELAotICAgICAgICAgICAgICAgICAgICAi
RXJyb3IgaW5pdGlhbGl6aW5nIFVTQiBzdXBwb3J0OiAlcyBbJWldIiwgZXJyc3RyLCByYyk7Cisg
ICAgcHJpdi0+Y3R4ID0gc3BpY2VfdXNiX2JhY2tlbmRfbmV3KGVycik7CisgICAgaWYgKCFwcml2
LT5jdHgpIHsKICAgICAgICAgcmV0dXJuIEZBTFNFOwogICAgIH0KKwogI2lmZGVmIEdfT1NfV0lO
MzIKICNpZiBMSUJVU0JfQVBJX1ZFUlNJT04gPj0gMHgwMTAwMDEwNgogICAgIGxpYnVzYl9zZXRf
b3B0aW9uKHByaXYtPmN0eCwgTElCVVNCX09QVElPTl9VU0VfVVNCREspOwpAQCAtMjQ4LDkgKzIy
OSw5IEBAIHN0YXRpYyB2b2lkIGdfdWRldl9jbGllbnRfZmluYWxpemUoR09iamVjdCAqZ29iamVj
dCkKICAgICBVbnJlZ2lzdGVyQ2xhc3MoR19VREVWX0NMSUVOVF9XSU5DTEFTU19OQU1FLCBOVUxM
KTsKICAgICBnX3VkZXZfY2xpZW50X2ZyZWVfZGV2aWNlX2xpc3QoJnByaXYtPnVkZXZfbGlzdCk7
CiAKLSAgICAvKiBmcmVlIGxpYnVzYiBjb250ZXh0IGluaXRpYWxpemluZyBieSBsaWJ1c2JfaW5p
dCgpICovCisgICAgLyogZnJlZSBiYWNrZW5kIGNvbnRleHQgKi8KICAgICBnX3dhcm5faWZfZmFp
bChwcml2LT5jdHggIT0gTlVMTCk7Ci0gICAgbGlidXNiX2V4aXQocHJpdi0+Y3R4KTsKKyAgICBz
cGljZV91c2JfYmFja2VuZF9kZWxldGUocHJpdi0+Y3R4KTsKIAogICAgIC8qIENoYWluIHVwIHRv
IHRoZSBwYXJlbnQgY2xhc3MgKi8KICAgICBpZiAoR19PQkpFQ1RfQ0xBU1MoZ191ZGV2X2NsaWVu
dF9wYXJlbnRfY2xhc3MpLT5maW5hbGl6ZSkKQEAgLTM0MCwyMCArMzIxLDE4IEBAIHN0YXRpYyB2
b2lkIGdfdWRldl9jbGllbnRfY2xhc3NfaW5pdChHVWRldkNsaWVudENsYXNzICprbGFzcykKIH0K
IAogLyogY29tcGFyaW5nIGJ1czphZGRyIGFuZCB2aWQ6cGlkICovCi1zdGF0aWMgZ2ludCBjb21w
YXJlX2xpYnVzYl9kZXZpY2VzKGdjb25zdHBvaW50ZXIgYSwgZ2NvbnN0cG9pbnRlciBiKQorc3Rh
dGljIGdpbnQgY29tcGFyZV91c2JfZGV2aWNlcyhnY29uc3Rwb2ludGVyIGEsIGdjb25zdHBvaW50
ZXIgYikKIHsKLSAgICBsaWJ1c2JfZGV2aWNlICphX2RldiA9IChsaWJ1c2JfZGV2aWNlICopYTsK
LSAgICBsaWJ1c2JfZGV2aWNlICpiX2RldiA9IChsaWJ1c2JfZGV2aWNlICopYjsKLSAgICBzdHJ1
Y3QgbGlidXNiX2RldmljZV9kZXNjcmlwdG9yIGFfZGVzYywgYl9kZXNjOworICAgIGNvbnN0IFVz
YkRldmljZUluZm9ybWF0aW9uICphX2luZm8sICpiX2luZm87CiAgICAgZ2Jvb2xlYW4gc2FtZV9i
dXMsIHNhbWVfYWRkciwgc2FtZV92aWQsIHNhbWVfcGlkOworICAgIGFfaW5mbyA9IHNwaWNlX3Vz
Yl9iYWNrZW5kX2RldmljZV9nZXRfaW5mbygoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICopYSk7Cisg
ICAgYl9pbmZvID0gc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX2dldF9pbmZvKChTcGljZVVzYkJh
Y2tlbmREZXZpY2UgKiliKTsKIAotICAgIGxpYnVzYl9nZXRfZGV2aWNlX2Rlc2NyaXB0b3IoYV9k
ZXYsICZhX2Rlc2MpOwotICAgIGxpYnVzYl9nZXRfZGV2aWNlX2Rlc2NyaXB0b3IoYl9kZXYsICZi
X2Rlc2MpOwogCi0gICAgc2FtZV9idXMgPSAobGlidXNiX2dldF9idXNfbnVtYmVyKGFfZGV2KSA9
PSBsaWJ1c2JfZ2V0X2J1c19udW1iZXIoYl9kZXYpKTsKLSAgICBzYW1lX2FkZHIgPSAobGlidXNi
X2dldF9kZXZpY2VfYWRkcmVzcyhhX2RldikgPT0gbGlidXNiX2dldF9kZXZpY2VfYWRkcmVzcyhi
X2RldikpOwotICAgIHNhbWVfdmlkID0gKGFfZGVzYy5pZFZlbmRvciA9PSBiX2Rlc2MuaWRWZW5k
b3IpOwotICAgIHNhbWVfcGlkID0gKGFfZGVzYy5pZFByb2R1Y3QgPT0gYl9kZXNjLmlkUHJvZHVj
dCk7CisgICAgc2FtZV9idXMgPSAoYV9pbmZvLT5idXMgPT0gYl9pbmZvLT5idXMpOworICAgIHNh
bWVfYWRkciA9IChhX2luZm8tPmFkZHJlc3MgPT0gYl9pbmZvLT5hZGRyZXNzKTsKKyAgICBzYW1l
X3ZpZCA9IChhX2luZm8tPnZpZCA9PSBiX2luZm8tPnZpZCk7CisgICAgc2FtZV9waWQgPSAoYV9p
bmZvLT5waWQgPT0gYl9pbmZvLT5waWQpOwogCiAgICAgcmV0dXJuIChzYW1lX2J1cyAmJiBzYW1l
X2FkZHIgJiYgc2FtZV92aWQgJiYgc2FtZV9waWQpID8gMCA6IC0xOwogfQpAQCAtMzYzLDEyICsz
NDIsMTIgQEAgc3RhdGljIHZvaWQgdXBkYXRlX2RldmljZV9saXN0KEdVZGV2Q2xpZW50ICpzZWxm
LCBHTGlzdCAqbmV3X2RldmljZV9saXN0KQogICAgIEdMaXN0ICpkZXY7CiAKICAgICBmb3IgKGRl
diA9IGdfbGlzdF9maXJzdChuZXdfZGV2aWNlX2xpc3QpOyBkZXYgIT0gTlVMTDsgZGV2ID0gZ19s
aXN0X25leHQoZGV2KSkgewotICAgICAgICBHTGlzdCAqZm91bmQgPSBnX2xpc3RfZmluZF9jdXN0
b20oc2VsZi0+cHJpdi0+dWRldl9saXN0LCBkZXYtPmRhdGEsIGNvbXBhcmVfbGlidXNiX2Rldmlj
ZXMpOworICAgICAgICBHTGlzdCAqZm91bmQgPSBnX2xpc3RfZmluZF9jdXN0b20oc2VsZi0+cHJp
di0+dWRldl9saXN0LCBkZXYtPmRhdGEsIGNvbXBhcmVfdXNiX2RldmljZXMpOwogICAgICAgICBp
ZiAoZm91bmQgIT0gTlVMTCkgewogICAgICAgICAgICAgLyoga2VlcCBvbGQgZXhpc3RpbmcgbGli
dXNiX2RldmljZSBpbiB0aGUgbmV3IGxpc3QsIHdoZW4KICAgICAgICAgICAgICAgIHVzYi1kZXYt
bWFuYWdlciB3aWxsIG1haW50YWluIGl0cyBvd24gbGlzdCBvZiBsaWJ1c2JfZGV2aWNlLAogICAg
ICAgICAgICAgICAgdGhlc2UgbGlzdHMgd2lsbCBiZSBjb21wbGV0ZWx5IGNvbnNpc3RlbnQgKi8K
LSAgICAgICAgICAgIGxpYnVzYl9kZXZpY2UgKnRlbXAgPSBmb3VuZC0+ZGF0YTsKKyAgICAgICAg
ICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqdGVtcCA9IGZvdW5kLT5kYXRhOwogICAgICAgICAg
ICAgZm91bmQtPmRhdGEgPSBkZXYtPmRhdGE7CiAgICAgICAgICAgICBkZXYtPmRhdGEgPSB0ZW1w
OwogICAgICAgICB9CkBAIC0zODYsNyArMzY1LDcgQEAgc3RhdGljIHZvaWQgbm90aWZ5X2Rldl9z
dGF0ZV9jaGFuZ2UoR1VkZXZDbGllbnQgKnNlbGYsCiAgICAgR0xpc3QgKmRldjsKIAogICAgIGZv
ciAoZGV2ID0gZ19saXN0X2ZpcnN0KG9sZF9saXN0KTsgZGV2ICE9IE5VTEw7IGRldiA9IGdfbGlz
dF9uZXh0KGRldikpIHsKLSAgICAgICAgR0xpc3QgKmZvdW5kID0gZ19saXN0X2ZpbmRfY3VzdG9t
KG5ld19saXN0LCBkZXYtPmRhdGEsIGNvbXBhcmVfbGlidXNiX2RldmljZXMpOworICAgICAgICBH
TGlzdCAqZm91bmQgPSBnX2xpc3RfZmluZF9jdXN0b20obmV3X2xpc3QsIGRldi0+ZGF0YSwgY29t
cGFyZV91c2JfZGV2aWNlcyk7CiAgICAgICAgIGlmIChmb3VuZCA9PSBOVUxMKSB7CiAgICAgICAg
ICAgICBnX3VkZXZfZGV2aWNlX3ByaW50KGRldi0+ZGF0YSwgYWRkID8gImFkZCIgOiAicmVtb3Zl
Iik7CiAgICAgICAgICAgICBnX3NpZ25hbF9lbWl0KHNlbGYsIHNpZ25hbHNbVUVWRU5UX1NJR05B
TF0sIDAsIGRldi0+ZGF0YSwgYWRkKTsKQEAgLTQ0NywyOSArNDI2LDExIEBAIHN0YXRpYyB2b2lk
IGdfdWRldl9kZXZpY2VfcHJpbnRfbGlzdChHTGlzdCAqbCwgY29uc3QgZ2NoYXIgKm1zZykKIH0K
ICNlbmRpZgogCi1zdGF0aWMgdm9pZCBnX3VkZXZfZGV2aWNlX3ByaW50KGxpYnVzYl9kZXZpY2Ug
KmRldiwgY29uc3QgZ2NoYXIgKm1zZykKK3N0YXRpYyB2b2lkIGdfdWRldl9kZXZpY2VfcHJpbnQo
U3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYsIGNvbnN0IGdjaGFyICptc2cpCiB7Ci0gICAgc3Ry
dWN0IGxpYnVzYl9kZXZpY2VfZGVzY3JpcHRvciBkZXNjOwotCi0gICAgbGlidXNiX2dldF9kZXZp
Y2VfZGVzY3JpcHRvcihkZXYsICZkZXNjKTsKKyAgICBjb25zdCBVc2JEZXZpY2VJbmZvcm1hdGlv
biAqaW5mbyA9IHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9nZXRfaW5mbyhkZXYpOwogCiAgICAg
U1BJQ0VfREVCVUcoIiVzOiAlZC4lZCAweCUwNHg6MHglMDR4IGNsYXNzICVkIiwgbXNnLAotICAg
ICAgICAgICAgICAgIGxpYnVzYl9nZXRfYnVzX251bWJlcihkZXYpLAotICAgICAgICAgICAgICAg
IGxpYnVzYl9nZXRfZGV2aWNlX2FkZHJlc3MoZGV2KSwKLSAgICAgICAgICAgICAgICBkZXNjLmlk
VmVuZG9yLCBkZXNjLmlkUHJvZHVjdCwgZGVzYy5iRGV2aWNlQ2xhc3MpOwotfQotCi1zdGF0aWMg
Z2Jvb2xlYW4gZ191ZGV2X3NraXBfc2VhcmNoKGxpYnVzYl9kZXZpY2UgKmRldikKLXsKLSAgICBn
Ym9vbGVhbiBza2lwOwotICAgIHVpbnQ4X3QgYWRkciA9IGxpYnVzYl9nZXRfZGV2aWNlX2FkZHJl
c3MoZGV2KTsKLSAgICBzdHJ1Y3QgbGlidXNiX2RldmljZV9kZXNjcmlwdG9yIGRlc2M7Ci0KLSAg
ICBsaWJ1c2JfZ2V0X2RldmljZV9kZXNjcmlwdG9yKGRldiwgJmRlc2MpOwotCi0gICAgc2tpcCA9
ICgoYWRkciA9PSAweGZmKSB8fCAgLyogcm9vdCBodWIgKEhDRCkgKi8KLSAgICAgICAgICAgIChh
ZGRyID09IDEpIHx8IC8qIHJvb3QgaHViIGFkZHIgKi8KLSAgICAgICAgICAgIChkZXNjLmJEZXZp
Y2VDbGFzcyA9PSBMSUJVU0JfQ0xBU1NfSFVCKSB8fCAvKiBodWIqLwotICAgICAgICAgICAgKGFk
ZHIgPT0gMCkpOyAvKiBiYWQgYWRkcmVzcyAqLwotICAgIHJldHVybiBza2lwOworICAgICAgICAg
ICAgICAgIGluZm8tPmJ1cywgaW5mby0+YWRkcmVzcywKKyAgICAgICAgICAgICAgICBpbmZvLT52
aWQsIGluZm8tPnBpZCwgaW5mby0+Y2xhc3MpOwogfQpkaWZmIC0tZ2l0IGEvc3JjL3dpbi11c2It
ZGV2LmggYi9zcmMvd2luLXVzYi1kZXYuaAppbmRleCBiMWMwZTI3Li5mZGZlNzNhIDEwMDY0NAot
LS0gYS9zcmMvd2luLXVzYi1kZXYuaAorKysgYi9zcmMvd2luLXVzYi1kZXYuaApAQCAtMjMsNiAr
MjMsNyBAQAogI2RlZmluZSBfX1dJTl9VU0JfREVWX0hfXwogCiAjaW5jbHVkZSA8Z2lvL2dpby5o
PgorI2luY2x1ZGUgInVzYi1iYWNrZW5kLmgiCiAKIEdfQkVHSU5fREVDTFMKIApAQCAtNTEsMTIg
KzUyLDEyIEBAIHN0cnVjdCBfR1VkZXZDbGllbnRDbGFzcwogICAgIEdPYmplY3RDbGFzcyBwYXJl
bnRfY2xhc3M7CiAKICAgICAvKiBzaWduYWxzICovCi0gICAgdm9pZCAoKnVldmVudCkoR1VkZXZD
bGllbnQgKmNsaWVudCwgbGlidXNiX2RldmljZSAqZGV2aWNlLCBnYm9vbGVhbiBhZGQpOworICAg
IHZvaWQgKCp1ZXZlbnQpKEdVZGV2Q2xpZW50ICpjbGllbnQsIFNwaWNlVXNiQmFja2VuZERldmlj
ZSAqZGV2aWNlLCBnYm9vbGVhbiBhZGQpOwogfTsKIAogR1R5cGUgZ191ZGV2X2NsaWVudF9nZXRf
dHlwZSh2b2lkKSBHX0dOVUNfQ09OU1Q7CiBHVWRldkNsaWVudCAqZ191ZGV2X2NsaWVudF9uZXco
dm9pZCk7Ci1saWJ1c2JfY29udGV4dCAqZ191ZGV2X2NsaWVudF9nZXRfY29udGV4dChHVWRldkNs
aWVudCAqY2xpZW50KTsKK1NwaWNlVXNiQmFja2VuZCAqZ191ZGV2X2NsaWVudF9nZXRfY29udGV4
dChHVWRldkNsaWVudCAqY2xpZW50KTsKIHZvaWQgZ191ZGV2X2NsaWVudF9yZXBvcnRfZGV2aWNl
cyhHVWRldkNsaWVudCAqY2xpZW50KTsKIAogR1F1YXJrIGdfdWRldl9jbGllbnRfZXJyb3JfcXVh
cmsodm9pZCk7Ci0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9zcGljZS1kZXZlbA==
