Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2CC1BA045F
	for <lists+spice-devel@lfdr.de>; Wed, 28 Aug 2019 16:14:31 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4C2CB898AF;
	Wed, 28 Aug 2019 14:14:29 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 28B64898AF
 for <spice-devel@lists.freedesktop.org>; Wed, 28 Aug 2019 14:14:28 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx02.intmail.prod.int.phx2.redhat.com
 [10.5.11.12])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 90D32859FB;
 Wed, 28 Aug 2019 14:14:27 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.21])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 866F560C5D;
 Wed, 28 Aug 2019 14:14:26 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Wed, 28 Aug 2019 15:14:04 +0100
Message-Id: <20190828141421.18902-2-fziglio@redhat.com>
In-Reply-To: <20190828141421.18902-1-fziglio@redhat.com>
References: <20190828141421.18902-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.12
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.26]); Wed, 28 Aug 2019 14:14:27 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-gtk v5 01/18] usb-redir: define
 interfaces to support emulated devices
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogWXVyaSBCZW5kaXRvdmljaCA8eXVyaS5iZW5kaXRvdmljaEBkYXluaXguY29tPgoKU3Bp
Y2VVc2JCYWNrZW5kRGV2aWNlIHN0cnVjdHVyZSBpcyBleHRlbmRlZCB0byBzdXBwb3J0CmFkZGl0
aW9uYWwga2luZCBvZiBkZXZpY2UgdGhhdCBpcyBlbXVsYXRlZCBieSBTcGljZS1HVEsKYW5kIG5v
dCBwcmVzZW50IGxvY2FsbHkgKGFuZCBkb2VzIG5vdCBoYXZlIGxpYnVzYl9kZXZpY2UpLApzdWNo
IGRldmljZSBoYXMgaW5zdGVhZCBwb2ludGVyIHRvIFNwaWNlVXNiRW11bGF0ZWREZXZpY2UKYWJz
dHJhY3Qgc3RydWN0dXJlLiBTcGVjaWZpYyBpbXBsZW1lbnRhdGlvbiBvZiBzdWNoIGRldmljZQpk
ZXBlbmRzIG9uIGl0cyBkZXZpY2UgdHlwZS4gSW1wbGVtZW50YXRpb24gbW9kdWxlIHdpbGwgZGVm
aW5lCmNvbnN0cnVjdG9yIGZvciBzcGVjaWZpYyBkZXZpY2UgdHlwZS4KRGV2aWNlIHN0cnVjdHVy
ZSBpcyBhYnN0cmFjdCBidXQgYWx3YXlzIHN0YXJ0cyBmcm9tIHRhYmxlIG9mCnZpcnR1YWwgZnVu
Y3Rpb25zIHJlcXVpcmVkIHRvIHJlZGlyZWN0IHN1Y2ggdmlydHVhbCBkZXZpY2UuCgpTaWduZWQt
b2ZmLWJ5OiBZdXJpIEJlbmRpdG92aWNoIDx5dXJpLmJlbmRpdG92aWNoQGRheW5peC5jb20+CkFj
a2VkLWJ5OiBGcmVkaWFubyBaaWdsaW8gPGZ6aWdsaW9AcmVkaGF0LmNvbT4KLS0tCiBzcmMvbWVz
b24uYnVpbGQgICAgIHwgICAxICsKIHNyYy91c2ItYmFja2VuZC5jICAgfCAxMDMgKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0KIHNyYy91c2ItYmFja2VuZC5oICAg
fCAgIDMgKysKIHNyYy91c2ItZW11bGF0aW9uLmggfCAgODggKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKwogNCBmaWxlcyBjaGFuZ2VkLCAxOTMgaW5zZXJ0aW9ucygrKSwgMiBk
ZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBzcmMvdXNiLWVtdWxhdGlvbi5oCgpkaWZm
IC0tZ2l0IGEvc3JjL21lc29uLmJ1aWxkIGIvc3JjL21lc29uLmJ1aWxkCmluZGV4IGRhYzg1YTdi
Li40ZDkyMTVjOCAxMDA2NDQKLS0tIGEvc3JjL21lc29uLmJ1aWxkCisrKyBiL3NyYy9tZXNvbi5i
dWlsZApAQCAtMTIyLDYgKzEyMiw3IEBAIHNwaWNlX2NsaWVudF9nbGliX3NvdXJjZXMgPSBbCiAg
ICd1c2J1dGlsLmMnLAogICAndXNidXRpbC5oJywKICAgJ3VzYi1iYWNrZW5kLmMnLAorICAndXNi
LWVtdWxhdGlvbi5oJywKICAgJ3VzYi1iYWNrZW5kLmgnLAogICAndm1jc3RyZWFtLmMnLAogICAn
dm1jc3RyZWFtLmgnLApkaWZmIC0tZ2l0IGEvc3JjL3VzYi1iYWNrZW5kLmMgYi9zcmMvdXNiLWJh
Y2tlbmQuYwppbmRleCAzMzM0ZjU2Ni4uN2Y5ZmNjMTcgMTAwNjQ0Ci0tLSBhL3NyYy91c2ItYmFj
a2VuZC5jCisrKyBiL3NyYy91c2ItYmFja2VuZC5jCkBAIC0zOSw2ICszOSw3IEBACiAjaW5jbHVk
ZSAidXNicmVkaXJwYXJzZXIuaCIKICNpbmNsdWRlICJzcGljZS11dGlsLmgiCiAjaW5jbHVkZSAi
dXNiLWJhY2tlbmQuaCIKKyNpbmNsdWRlICJ1c2ItZW11bGF0aW9uLmgiCiAjaW5jbHVkZSAiY2hh
bm5lbC11c2JyZWRpci1wcml2LmgiCiAjaW5jbHVkZSAic3BpY2UtY2hhbm5lbC1wcml2LmgiCiAK
QEAgLTQ2LDcgKzQ3LDEwIEBACiAKIHN0cnVjdCBfU3BpY2VVc2JCYWNrZW5kRGV2aWNlCiB7Cisg
ICAgLyogUG9pbnRlciB0byBkZXZpY2UuIEVpdGhlciByZWFsIGRldmljZSAobGlidXNiX2Rldmlj
ZSkKKyAgICAgKiBvciBlbXVsYXRlZCBvbmUgKGVkZXYpICovCiAgICAgbGlidXNiX2RldmljZSAq
bGlidXNiX2RldmljZTsKKyAgICBTcGljZVVzYkVtdWxhdGVkRGV2aWNlICplZGV2OwogICAgIGdp
bnQgcmVmX2NvdW50OwogICAgIFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmF0dGFjaGVkX3RvOwog
ICAgIFVzYkRldmljZUluZm9ybWF0aW9uIGRldmljZV9pbmZvOwpAQCAtNjYsNiArNzAsMTAgQEAg
c3RydWN0IF9TcGljZVVzYkJhY2tlbmQKICAgICBsaWJ1c2JfZGV2aWNlICoqbGlidXNiX2Rldmlj
ZV9saXN0OwogICAgIGdpbnQgcmVkaXJlY3Rpbmc7CiAjZW5kaWYKKworICAgIC8qIE1hc2sgb2Yg
YWxsb2NhdGVkIGRldmljZSwgYSBzcGVjaWZpYyBiaXQgc2V0IHRvIDEgdG8gaW5kaWNhdGUgdGhh
dCB0aGUgZGV2aWNlIGF0CisgICAgICogdGhhdCBhZGRyZXNzIGlzIGFsbG9jYXRlZCAqLworICAg
IHVpbnQzMl90IG93bl9kZXZpY2VzX21hc2s7CiB9OwogCiBzdHJ1Y3QgX1NwaWNlVXNiQmFja2Vu
ZENoYW5uZWwKQEAgLTQxMyw2ICs0MjEsOCBAQCBTcGljZVVzYkJhY2tlbmQgKnNwaWNlX3VzYl9i
YWNrZW5kX25ldyhHRXJyb3IgKiplcnJvcikKICAgICAgICAgbGlidXNiX3NldF9vcHRpb24oYmUt
PmxpYnVzYl9jb250ZXh0LCBMSUJVU0JfT1BUSU9OX1VTRV9VU0JESyk7CiAjZW5kaWYKICNlbmRp
ZgorICAgICAgICAvKiBleGNsdWRlIGFkZHJlc3NlcyAwIChyZXNlcnZlZCkgYW5kIDEgKHJvb3Qg
aHViKSAqLworICAgICAgICBiZS0+b3duX2RldmljZXNfbWFzayA9IDM7CiAgICAgfQogICAgIFNQ
SUNFX0RFQlVHKCIlcyA8PCIsIF9fRlVOQ1RJT05fXyk7CiAgICAgcmV0dXJuIGJlOwpAQCAtNTI5
LDggKzUzOSwxMyBAQCB2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV91bnJlZihTcGljZVVz
YkJhY2tlbmREZXZpY2UgKmRldikKIHsKICAgICBMT1VEX0RFQlVHKCIlcyA+PiAlcCglZCkiLCBf
X0ZVTkNUSU9OX18sIGRldiwgZGV2LT5yZWZfY291bnQpOwogICAgIGlmIChnX2F0b21pY19pbnRf
ZGVjX2FuZF90ZXN0KCZkZXYtPnJlZl9jb3VudCkpIHsKLSAgICAgICAgbGlidXNiX3VucmVmX2Rl
dmljZShkZXYtPmxpYnVzYl9kZXZpY2UpOwotICAgICAgICBMT1VEX0RFQlVHKCIlcyBmcmVlaW5n
ICVwIChsaWJ1c2IgJXApIiwgX19GVU5DVElPTl9fLCBkZXYsIGRldi0+bGlidXNiX2RldmljZSk7
CisgICAgICAgIGlmIChkZXYtPmxpYnVzYl9kZXZpY2UpIHsKKyAgICAgICAgICAgIGxpYnVzYl91
bnJlZl9kZXZpY2UoZGV2LT5saWJ1c2JfZGV2aWNlKTsKKyAgICAgICAgICAgIExPVURfREVCVUco
IiVzIGZyZWVpbmcgJXAgKGxpYnVzYiAlcCkiLCBfX0ZVTkNUSU9OX18sIGRldiwgZGV2LT5saWJ1
c2JfZGV2aWNlKTsKKyAgICAgICAgfQorICAgICAgICBpZiAoZGV2LT5lZGV2KSB7CisgICAgICAg
ICAgICBkZXZpY2Vfb3BzKGRldi0+ZWRldiktPnVucmVhbGl6ZShkZXYtPmVkZXYpOworICAgICAg
ICB9CiAgICAgICAgIGdfZnJlZShkZXYpOwogICAgIH0KIH0KQEAgLTgyOSw0ICs4NDQsODggQEAg
c3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9nZXRfZ3Vlc3RfZmlsdGVyKFNwaWNlVXNiQmFja2Vu
ZENoYW5uZWwgKmNoLAogICAgIH0KIH0KIAordm9pZCBzcGljZV91c2JfYmFja2VuZF9kZXZpY2Vf
cmVwb3J0X2NoYW5nZShTcGljZVVzYkJhY2tlbmQgKmJlLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldikKK3sKKyAg
ICBnY2hhciAqZGVzYzsKKyAgICBnX3JldHVybl9pZl9mYWlsKGRldiAmJiBkZXYtPmVkZXYpOwor
CisgICAgZGVzYyA9IGRldmljZV9vcHMoZGV2LT5lZGV2KS0+Z2V0X3Byb2R1Y3RfZGVzY3JpcHRp
b24oZGV2LT5lZGV2KTsKKyAgICBTUElDRV9ERUJVRygiJXM6ICVzIiwgX19GVU5DVElPTl9fLCBk
ZXNjKTsKKyAgICBnX2ZyZWUoZGVzYyk7Cit9CisKK3ZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfZGV2
aWNlX2VqZWN0KFNwaWNlVXNiQmFja2VuZCAqYmUsIFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2
KQoreworICAgIGdfcmV0dXJuX2lmX2ZhaWwoZGV2KTsKKworICAgIGlmIChkZXYtPmVkZXYpIHsK
KyAgICAgICAgYmUtPm93bl9kZXZpY2VzX21hc2sgJj0gfigxIDw8IGRldi0+ZGV2aWNlX2luZm8u
YWRkcmVzcyk7CisgICAgfQorICAgIGlmIChiZS0+aG90cGx1Z19jYWxsYmFjaykgeworICAgICAg
ICBiZS0+aG90cGx1Z19jYWxsYmFjayhiZS0+aG90cGx1Z191c2VyX2RhdGEsIGRldiwgRkFMU0Up
OworICAgIH0KK30KKworZ2Jvb2xlYW4KK3NwaWNlX3VzYl9iYWNrZW5kX2NyZWF0ZV9lbXVsYXRl
ZF9kZXZpY2UoU3BpY2VVc2JCYWNrZW5kICpiZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgU3BpY2VVc2JFbXVsYXRlZERldmljZUNyZWF0ZSBjcmVhdGVfcHJvYywK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqY3JlYXRlX3Bh
cmFtcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR0Vycm9yICoq
ZXJyKQoreworICAgIFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmVkZXY7CisgICAgU3BpY2VVc2JC
YWNrZW5kRGV2aWNlICpkZXY7CisgICAgc3RydWN0IGxpYnVzYl9kZXZpY2VfZGVzY3JpcHRvciAq
ZGVzYzsKKyAgICB1aW50MTZfdCBkZXZpY2VfZGVzY19zaXplOworICAgIHVpbnQ4X3QgYWRkcmVz
cyA9IDA7CisKKyAgICBpZiAoYmUtPm93bl9kZXZpY2VzX21hc2sgPT0gMHhmZmZmZmZmZikgewor
ICAgICAgICBnX3NldF9lcnJvcihlcnIsIFNQSUNFX0NMSUVOVF9FUlJPUiwgU1BJQ0VfQ0xJRU5U
X0VSUk9SX0ZBSUxFRCwKKyAgICAgICAgICAgICAgICAgICAgXygiY2FuJ3QgY3JlYXRlIGRldmlj
ZSAtIGxpbWl0IHJlYWNoZWQiKSk7CisgICAgICAgIHJldHVybiBGQUxTRTsKKyAgICB9CisgICAg
Zm9yIChhZGRyZXNzID0gMDsgYWRkcmVzcyA8IDMyOyArK2FkZHJlc3MpIHsKKyAgICAgICAgaWYg
KH5iZS0+b3duX2RldmljZXNfbWFzayAmICgxIDw8IGFkZHJlc3MpKSB7CisgICAgICAgICAgICBi
cmVhazsKKyAgICAgICAgfQorICAgIH0KKworICAgIGRldiA9IGdfbmV3MChTcGljZVVzYkJhY2tl
bmREZXZpY2UsIDEpOworICAgIGRldi0+ZGV2aWNlX2luZm8uYnVzID0gQlVTX05VTUJFUl9GT1Jf
RU1VTEFURURfVVNCOworICAgIGRldi0+ZGV2aWNlX2luZm8uYWRkcmVzcyA9IGFkZHJlc3M7Cisg
ICAgZGV2LT5yZWZfY291bnQgPSAxOworCisgICAgZGV2LT5lZGV2ID0gZWRldiA9IGNyZWF0ZV9w
cm9jKGJlLCBkZXYsIGNyZWF0ZV9wYXJhbXMsIGVycik7CisgICAgaWYgKGVkZXYgPT0gTlVMTCkg
eworICAgICAgICBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfdW5yZWYoZGV2KTsKKyAgICAgICAg
cmV0dXJuIEZBTFNFOworICAgIH0KKworICAgIGlmICghZGV2aWNlX29wcyhlZGV2KS0+Z2V0X2Rl
c2NyaXB0b3IoZWRldiwgTElCVVNCX0RUX0RFVklDRSwgMCwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICh2b2lkICoqKSZkZXNjLCAmZGV2aWNlX2Rlc2Nfc2l6ZSkK
KyAgICAgICAgfHwgZGV2aWNlX2Rlc2Nfc2l6ZSAhPSBzaXplb2YoKmRlc2MpKSB7CisKKyAgICAg
ICAgc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX3VucmVmKGRldik7CisgICAgICAgIGdfc2V0X2Vy
cm9yKGVyciwgU1BJQ0VfQ0xJRU5UX0VSUk9SLCBTUElDRV9DTElFTlRfRVJST1JfRkFJTEVELAor
ICAgICAgICAgICAgICAgICAgICBfKCJjYW4ndCBjcmVhdGUgZGV2aWNlIC0gaW50ZXJuYWwgZXJy
b3IiKSk7CisgICAgICAgIHJldHVybiBGQUxTRTsKKyAgICB9CisKKyAgICBiZS0+b3duX2Rldmlj
ZXNfbWFzayB8PSAxIDw8IGFkZHJlc3M7CisKKyAgICBkZXYtPmRldmljZV9pbmZvLnZpZCA9IGRl
c2MtPmlkVmVuZG9yOworICAgIGRldi0+ZGV2aWNlX2luZm8ucGlkID0gZGVzYy0+aWRQcm9kdWN0
OworICAgIGRldi0+ZGV2aWNlX2luZm8uYmNkVVNCID0gZGVzYy0+YmNkVVNCOworICAgIGRldi0+
ZGV2aWNlX2luZm8uY2xhc3MgPSBkZXNjLT5iRGV2aWNlQ2xhc3M7CisgICAgZGV2LT5kZXZpY2Vf
aW5mby5zdWJjbGFzcyA9IGRlc2MtPmJEZXZpY2VTdWJDbGFzczsKKyAgICBkZXYtPmRldmljZV9p
bmZvLnByb3RvY29sID0gZGVzYy0+YkRldmljZVByb3RvY29sOworCisgICAgaWYgKGJlLT5ob3Rw
bHVnX2NhbGxiYWNrKSB7CisgICAgICAgIGJlLT5ob3RwbHVnX2NhbGxiYWNrKGJlLT5ob3RwbHVn
X3VzZXJfZGF0YSwgZGV2LCBUUlVFKTsKKyAgICB9CisgICAgc3BpY2VfdXNiX2JhY2tlbmRfZGV2
aWNlX3VucmVmKGRldik7CisKKyAgICByZXR1cm4gVFJVRTsKK30KKwogI2VuZGlmIC8qIFVTQl9S
RURJUiAqLwpkaWZmIC0tZ2l0IGEvc3JjL3VzYi1iYWNrZW5kLmggYi9zcmMvdXNiLWJhY2tlbmQu
aAppbmRleCA2NmUxM2Y1NC4uY2QzZmYwOTcgMTAwNjQ0Ci0tLSBhL3NyYy91c2ItYmFja2VuZC5o
CisrKyBiL3NyYy91c2ItYmFja2VuZC5oCkBAIC0zMCwxMiArMzAsMTUgQEAgdHlwZWRlZiBzdHJ1
Y3QgX1NwaWNlVXNiQmFja2VuZCBTcGljZVVzYkJhY2tlbmQ7CiB0eXBlZGVmIHN0cnVjdCBfU3Bp
Y2VVc2JCYWNrZW5kRGV2aWNlIFNwaWNlVXNiQmFja2VuZERldmljZTsKIHR5cGVkZWYgc3RydWN0
IF9TcGljZVVzYkJhY2tlbmRDaGFubmVsIFNwaWNlVXNiQmFja2VuZENoYW5uZWw7CiAKKyNkZWZp
bmUgQlVTX05VTUJFUl9GT1JfRU1VTEFURURfVVNCIEdfTUFYVUlOVDE2CisKIHR5cGVkZWYgc3Ry
dWN0IFVzYkRldmljZUluZm9ybWF0aW9uCiB7CiAgICAgdWludDE2X3QgYnVzOwogICAgIHVpbnQx
Nl90IGFkZHJlc3M7CiAgICAgdWludDE2X3QgdmlkOwogICAgIHVpbnQxNl90IHBpZDsKKyAgICB1
aW50MTZfdCBiY2RVU0I7CiAgICAgdWludDhfdCBjbGFzczsKICAgICB1aW50OF90IHN1YmNsYXNz
OwogICAgIHVpbnQ4X3QgcHJvdG9jb2w7CmRpZmYgLS1naXQgYS9zcmMvdXNiLWVtdWxhdGlvbi5o
IGIvc3JjL3VzYi1lbXVsYXRpb24uaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAw
MC4uYWMzZDhlMDUKLS0tIC9kZXYvbnVsbAorKysgYi9zcmMvdXNiLWVtdWxhdGlvbi5oCkBAIC0w
LDAgKzEsODggQEAKKy8qIC0qLSBNb2RlOiBDOyBjLWJhc2ljLW9mZnNldDogNDsgaW5kZW50LXRh
YnMtbW9kZTogbmlsIC0qLSAqLworLyoKKyAgICBDb3B5cmlnaHQgKEMpIDIwMTkgUmVkIEhhdCwg
SW5jLgorCisgICAgUmVkIEhhdCBBdXRob3JzOgorICAgIFl1cmkgQmVuZGl0b3ZpY2g8eWJlbmRp
dG9AcmVkaGF0LmNvbT4KKworICAgIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3Ug
Y2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IKKyAgICBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1z
IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCisgICAgTGljZW5zZSBhcyBwdWJsaXNo
ZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyCisgICAgdmVyc2lvbiAy
LjEgb2YgdGhlIExpY2Vuc2UsIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24u
CisKKyAgICBUaGlzIGxpYnJhcnkgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3
aWxsIGJlIHVzZWZ1bCwKKyAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZl
biB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgorICAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNT
IEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUgR05VCisgICAgTGVzc2VyIEdlbmVy
YWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKworICAgIFlvdSBzaG91bGQgaGF2
ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKKyAgICBM
aWNlbnNlIGFsb25nIHdpdGggdGhpcyBsaWJyYXJ5OyBpZiBub3QsIHNlZSA8aHR0cDovL3d3dy5n
bnUub3JnL2xpY2Vuc2VzLz4uCisqLworCisjcHJhZ21hIG9uY2UKKworI2luY2x1ZGUgInVzYnJl
ZGlycGFyc2VyLmgiCisjaW5jbHVkZSAidXNiLWJhY2tlbmQuaCIKKwordHlwZWRlZiBzdHJ1Y3Qg
U3BpY2VVc2JFbXVsYXRlZERldmljZSBTcGljZVVzYkVtdWxhdGVkRGV2aWNlOwordHlwZWRlZiBT
cGljZVVzYkVtdWxhdGVkRGV2aWNlKgorKCpTcGljZVVzYkVtdWxhdGVkRGV2aWNlQ3JlYXRlKShT
cGljZVVzYkJhY2tlbmQgKmJlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGlj
ZVVzYkJhY2tlbmREZXZpY2UgKnBhcmVudCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgdm9pZCAqY3JlYXRlX3BhcmFtcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
R0Vycm9yICoqZXJyKTsKKworLyoKKyAgICBmdW5jdGlvbiB0YWJsZSBmb3IgZW11bGF0ZWQgVVNC
IGRldmljZQorICAgIG11c3QgYmUgZmlyc3QgbWVtYmVyIG9mIGRldmljZSBzdHJ1Y3R1cmUKKyAg
ICBhbGwgZnVuY3Rpb25zIGFyZSBtYW5kYXRvcnkgZm9yIGltcGxlbWVudGF0aW9uCisqLwordHlw
ZWRlZiBzdHJ1Y3QgVXNiRGV2aWNlT3BzIHsKKyAgICBnYm9vbGVhbiAoKmdldF9kZXNjcmlwdG9y
KShTcGljZVVzYkVtdWxhdGVkRGV2aWNlICpkZXZpY2UsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdWludDhfdCB0eXBlLCB1aW50OF90IGluZGV4LAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHZvaWQgKipidWZmZXIsIHVpbnQxNl90ICpzaXplKTsKKyAgICBnY2hhciAq
ICgqZ2V0X3Byb2R1Y3RfZGVzY3JpcHRpb24pKFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmRldmlj
ZSk7CisgICAgdm9pZCAoKmF0dGFjaCkoU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZGV2aWNlLCBz
dHJ1Y3QgdXNicmVkaXJwYXJzZXIgKnBhcnNlcik7CisgICAgdm9pZCAoKnJlc2V0KShTcGljZVVz
YkVtdWxhdGVkRGV2aWNlICpkZXZpY2UpOworICAgIC8qCisgICAgICAgIHByb2Nlc3NpbmcgaXMg
c3luY2hyb25vdXMsIGRlZmF1bHQgPSBzdGFsbDoKKyAgICAgICAgLSByZXR1cm4gc3VjY2VzcyB3
aXRob3V0IGRhdGE6IHNldCBzdGF0dXMgdG8gMAorICAgICAgICAtIHJldHVybiBlcnJvciAtIHNl
dCBzdGF0dXMgdG8gZXJyb3IKKyAgICAgICAgLSByZXR1cm4gc3VjY2VzcyB3aXRoIGRhdGEgLSBz
ZXQgc3RhdHVzIHRvIDAsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXQg
YnVmZmVyIHRvIHNvbWUgYnVmZmVyCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBzZXQgbGVuZ3RoIHRvIG91dCBsZW4KKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHRydW5jYXRpb24gaXMgYXV0b21hdGljCisgICAgKi8KKyAgICB2b2lkICgqY29udHJvbF9y
ZXF1ZXN0KShTcGljZVVzYkVtdWxhdGVkRGV2aWNlICpkZXZpY2UsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdWludDhfdCAqZGF0YSwgaW50IGRhdGFfbGVuLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHN0cnVjdCB1c2JfcmVkaXJfY29udHJvbF9wYWNrZXRfaGVhZGVyICpoLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKipidWZmZXIpOworICAgIC8qCisgICAg
ICAgIHByb2Nlc3NpbmcgaXMgc3luY2hyb25vdXM6CisgICAgICAgIC0gc2V0IGgtPnN0YXR1cyB0
byByZXN1bHRpbmcgc3RhdHVzLCBkZWZhdWx0ID0gc3RhbGwKKyAgICAqLworICAgIHZvaWQgKCpi
dWxrX291dF9yZXF1ZXN0KShTcGljZVVzYkVtdWxhdGVkRGV2aWNlICpkZXZpY2UsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHVpbnQ4X3QgZXAsIHVpbnQ4X3QgKmRhdGEsIGludCBkYXRh
X2xlbiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDhfdCAqc3RhdHVzKTsKKyAg
ICAvKgorICAgICAgICBpZiByZXR1cm5zIHRydWUsIHByb2Nlc3NpbmcgaXMgYXN5bmNocm9ub3Vz
CisgICAgICAgIG90aGVyd2lzZSBoZWFkZXIgY29udGFpbnMgZXJyb3Igc3RhdHVzCisgICAgKi8K
KyAgICBnYm9vbGVhbiAoKmJ1bGtfaW5fcmVxdWVzdCkoU3BpY2VVc2JFbXVsYXRlZERldmljZSAq
ZGV2aWNlLCB1aW50NjRfdCBpZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qg
dXNiX3JlZGlyX2J1bGtfcGFja2V0X2hlYWRlciAqYnVsa19oZWFkZXIpOworICAgIHZvaWQgKCpj
YW5jZWxfcmVxdWVzdCkoU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZGV2aWNlLCB1aW50NjRfdCBp
ZCk7CisgICAgdm9pZCAoKmRldGFjaCkoU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZGV2aWNlKTsK
KyAgICB2b2lkICgqdW5yZWFsaXplKShTcGljZVVzYkVtdWxhdGVkRGV2aWNlICpkZXZpY2UpOwor
fSBVc2JEZXZpY2VPcHM7CisKK3N0YXRpYyBpbmxpbmUgY29uc3QgVXNiRGV2aWNlT3BzICpkZXZp
Y2Vfb3BzKFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmRldikKK3sKKyAgICByZXR1cm4gKGNvbnN0
IFVzYkRldmljZU9wcyAqKWRldjsKK30KKworZ2Jvb2xlYW4KK3NwaWNlX3VzYl9iYWNrZW5kX2Ny
ZWF0ZV9lbXVsYXRlZF9kZXZpY2UoU3BpY2VVc2JCYWNrZW5kICpiZSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VVc2JFbXVsYXRlZERldmljZUNyZWF0ZSBj
cmVhdGVfcHJvYywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9p
ZCAqY3JlYXRlX3BhcmFtcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgR0Vycm9yICoqZXJyKTsKK3ZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX2VqZWN0KFNw
aWNlVXNiQmFja2VuZCAqYmUsIFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2aWNlKTsKK3ZvaWQg
c3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX3JlcG9ydF9jaGFuZ2UoU3BpY2VVc2JCYWNrZW5kICpi
ZSwgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXZpY2UpOwotLSAKMi4yMC4xCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpTcGljZS1kZXZlbCBtYWlsaW5n
IGxpc3QKU3BpY2UtZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vc3BpY2UtZGV2ZWw=
