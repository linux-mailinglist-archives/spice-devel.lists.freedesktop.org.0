Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A54A2F8C2
	for <lists+spice-devel@lfdr.de>; Tue, 30 Apr 2019 14:24:32 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 31529891E2;
	Tue, 30 Apr 2019 12:24:31 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 387F3891D4
 for <spice-devel@lists.freedesktop.org>; Tue, 30 Apr 2019 12:24:29 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx08.intmail.prod.int.phx2.redhat.com
 [10.5.11.23])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id D8D29307D978
 for <spice-devel@lists.freedesktop.org>; Tue, 30 Apr 2019 12:24:28 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.22])
 by smtp.corp.redhat.com (Postfix) with ESMTP id DBC062B3A5;
 Tue, 30 Apr 2019 12:24:27 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Tue, 30 Apr 2019 13:24:03 +0100
Message-Id: <20190430122419.16241-4-fziglio@redhat.com>
In-Reply-To: <20190430122419.16241-1-fziglio@redhat.com>
References: <20190430122419.16241-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.23
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.48]); Tue, 30 Apr 2019 12:24:28 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-server v6 03/19] windows: Do not use
 conflicting preprocessor macros
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

ImludGVyZmFjZSIgYW5kICJNQVhfTU9OSVRPUlMiIGFyZSBkZWZpbmVkIGluIHNvbWUgV2luZG93
cyBzeXN0ZW0KaGVhZGVycyBjYXVzaW5nIGdhcmJhZ2UgY29kZSB0byBiZSBmZWQgdG8gdGhlIGNv
bXBpbGVyLgoKU2lnbmVkLW9mZi1ieTogRnJlZGlhbm8gWmlnbGlvIDxmemlnbGlvQHJlZGhhdC5j
b20+Ci0tLQogc2VydmVyL3JlZC1xeGwuYyB8IDUyICsrKysrKysrKysrKysrKysrKy0tLS0tLS0t
LS0tLS0tLS0tLQogc2VydmVyL3JlZHMuYyAgICB8IDY4ICsrKysrKysrKysrKysrKysrKysrKysr
Ky0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogMiBmaWxlcyBjaGFuZ2VkLCA2MCBpbnNlcnRpb25z
KCspLCA2MCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9zZXJ2ZXIvcmVkLXF4bC5jIGIvc2Vy
dmVyL3JlZC1xeGwuYwppbmRleCA1ZmE5NzRmYy4uZDQwZDM5NzAgMTAwNjQ0Ci0tLSBhL3NlcnZl
ci9yZWQtcXhsLmMKKysrIGIvc2VydmVyL3JlZC1xeGwuYwpAQCAtOTY2LDk1ICs5NjYsOTUgQEAg
UmVkc1N0YXRlKiByZWRfcXhsX2dldF9zZXJ2ZXIoUVhMU3RhdGUgKnF4bF9zdGF0ZSkKIAogdm9p
ZCByZWRfcXhsX2F0dGFjaF93b3JrZXIoUVhMSW5zdGFuY2UgKnF4bCkKIHsKLSAgICBRWExJbnRl
cmZhY2UgKmludGVyZmFjZSA9IHF4bF9nZXRfaW50ZXJmYWNlKHF4bCk7Ci0gICAgaW50ZXJmYWNl
LT5hdHRhY2hlX3dvcmtlcihxeGwsICZxeGwtPnN0LT5xeGxfd29ya2VyKTsKKyAgICBRWExJbnRl
cmZhY2UgKnF4bF9pbnRlcmZhY2UgPSBxeGxfZ2V0X2ludGVyZmFjZShxeGwpOworICAgIHF4bF9p
bnRlcmZhY2UtPmF0dGFjaGVfd29ya2VyKHF4bCwgJnF4bC0+c3QtPnF4bF93b3JrZXIpOwogfQog
CiB2b2lkIHJlZF9xeGxfc2V0X2NvbXByZXNzaW9uX2xldmVsKFFYTEluc3RhbmNlICpxeGwsIGlu
dCBsZXZlbCkKIHsKLSAgICBRWExJbnRlcmZhY2UgKmludGVyZmFjZSA9IHF4bF9nZXRfaW50ZXJm
YWNlKHF4bCk7Ci0gICAgaW50ZXJmYWNlLT5zZXRfY29tcHJlc3Npb25fbGV2ZWwocXhsLCBsZXZl
bCk7CisgICAgUVhMSW50ZXJmYWNlICpxeGxfaW50ZXJmYWNlID0gcXhsX2dldF9pbnRlcmZhY2Uo
cXhsKTsKKyAgICBxeGxfaW50ZXJmYWNlLT5zZXRfY29tcHJlc3Npb25fbGV2ZWwocXhsLCBsZXZl
bCk7CiB9CiAKIHZvaWQgcmVkX3F4bF9nZXRfaW5pdF9pbmZvKFFYTEluc3RhbmNlICpxeGwsIFFY
TERldkluaXRJbmZvICppbmZvKQogewotICAgIFFYTEludGVyZmFjZSAqaW50ZXJmYWNlID0gcXhs
X2dldF9pbnRlcmZhY2UocXhsKTsKKyAgICBRWExJbnRlcmZhY2UgKnF4bF9pbnRlcmZhY2UgPSBx
eGxfZ2V0X2ludGVyZmFjZShxeGwpOwogCi0gICAgaW50ZXJmYWNlLT5nZXRfaW5pdF9pbmZvKHF4
bCwgaW5mbyk7CisgICAgcXhsX2ludGVyZmFjZS0+Z2V0X2luaXRfaW5mbyhxeGwsIGluZm8pOwog
fQogCiBpbnQgcmVkX3F4bF9nZXRfY29tbWFuZChRWExJbnN0YW5jZSAqcXhsLCBzdHJ1Y3QgUVhM
Q29tbWFuZEV4dCAqY21kKQogewotICAgIFFYTEludGVyZmFjZSAqaW50ZXJmYWNlID0gcXhsX2dl
dF9pbnRlcmZhY2UocXhsKTsKKyAgICBRWExJbnRlcmZhY2UgKnF4bF9pbnRlcmZhY2UgPSBxeGxf
Z2V0X2ludGVyZmFjZShxeGwpOwogCi0gICAgcmV0dXJuIGludGVyZmFjZS0+Z2V0X2NvbW1hbmQo
cXhsLCBjbWQpOworICAgIHJldHVybiBxeGxfaW50ZXJmYWNlLT5nZXRfY29tbWFuZChxeGwsIGNt
ZCk7CiB9CiAKIGludCByZWRfcXhsX3JlcV9jbWRfbm90aWZpY2F0aW9uKFFYTEluc3RhbmNlICpx
eGwpCiB7Ci0gICAgUVhMSW50ZXJmYWNlICppbnRlcmZhY2UgPSBxeGxfZ2V0X2ludGVyZmFjZShx
eGwpOworICAgIFFYTEludGVyZmFjZSAqcXhsX2ludGVyZmFjZSA9IHF4bF9nZXRfaW50ZXJmYWNl
KHF4bCk7CiAKLSAgICByZXR1cm4gaW50ZXJmYWNlLT5yZXFfY21kX25vdGlmaWNhdGlvbihxeGwp
OworICAgIHJldHVybiBxeGxfaW50ZXJmYWNlLT5yZXFfY21kX25vdGlmaWNhdGlvbihxeGwpOwog
fQogCiB2b2lkIHJlZF9xeGxfcmVsZWFzZV9yZXNvdXJjZShRWExJbnN0YW5jZSAqcXhsLCBzdHJ1
Y3QgUVhMUmVsZWFzZUluZm9FeHQgcmVsZWFzZV9pbmZvKQogewotICAgIFFYTEludGVyZmFjZSAq
aW50ZXJmYWNlID0gcXhsX2dldF9pbnRlcmZhY2UocXhsKTsKKyAgICBRWExJbnRlcmZhY2UgKnF4
bF9pbnRlcmZhY2UgPSBxeGxfZ2V0X2ludGVyZmFjZShxeGwpOwogCi0gICAgaW50ZXJmYWNlLT5y
ZWxlYXNlX3Jlc291cmNlKHF4bCwgcmVsZWFzZV9pbmZvKTsKKyAgICBxeGxfaW50ZXJmYWNlLT5y
ZWxlYXNlX3Jlc291cmNlKHF4bCwgcmVsZWFzZV9pbmZvKTsKIH0KIAogaW50IHJlZF9xeGxfZ2V0
X2N1cnNvcl9jb21tYW5kKFFYTEluc3RhbmNlICpxeGwsIHN0cnVjdCBRWExDb21tYW5kRXh0ICpj
bWQpCiB7Ci0gICAgUVhMSW50ZXJmYWNlICppbnRlcmZhY2UgPSBxeGxfZ2V0X2ludGVyZmFjZShx
eGwpOworICAgIFFYTEludGVyZmFjZSAqcXhsX2ludGVyZmFjZSA9IHF4bF9nZXRfaW50ZXJmYWNl
KHF4bCk7CiAKLSAgICByZXR1cm4gaW50ZXJmYWNlLT5nZXRfY3Vyc29yX2NvbW1hbmQocXhsLCBj
bWQpOworICAgIHJldHVybiBxeGxfaW50ZXJmYWNlLT5nZXRfY3Vyc29yX2NvbW1hbmQocXhsLCBj
bWQpOwogfQogCiBpbnQgcmVkX3F4bF9yZXFfY3Vyc29yX25vdGlmaWNhdGlvbihRWExJbnN0YW5j
ZSAqcXhsKQogewotICAgIFFYTEludGVyZmFjZSAqaW50ZXJmYWNlID0gcXhsX2dldF9pbnRlcmZh
Y2UocXhsKTsKKyAgICBRWExJbnRlcmZhY2UgKnF4bF9pbnRlcmZhY2UgPSBxeGxfZ2V0X2ludGVy
ZmFjZShxeGwpOwogCi0gICAgcmV0dXJuIGludGVyZmFjZS0+cmVxX2N1cnNvcl9ub3RpZmljYXRp
b24ocXhsKTsKKyAgICByZXR1cm4gcXhsX2ludGVyZmFjZS0+cmVxX2N1cnNvcl9ub3RpZmljYXRp
b24ocXhsKTsKIH0KIAogdm9pZCByZWRfcXhsX25vdGlmeV91cGRhdGUoUVhMSW5zdGFuY2UgKnF4
bCwgdWludDMyX3QgdXBkYXRlX2lkKQogewotICAgIFFYTEludGVyZmFjZSAqaW50ZXJmYWNlID0g
cXhsX2dldF9pbnRlcmZhY2UocXhsKTsKKyAgICBRWExJbnRlcmZhY2UgKnF4bF9pbnRlcmZhY2Ug
PSBxeGxfZ2V0X2ludGVyZmFjZShxeGwpOwogCi0gICAgaW50ZXJmYWNlLT5ub3RpZnlfdXBkYXRl
KHF4bCwgdXBkYXRlX2lkKTsKKyAgICBxeGxfaW50ZXJmYWNlLT5ub3RpZnlfdXBkYXRlKHF4bCwg
dXBkYXRlX2lkKTsKIH0KIAogaW50IHJlZF9xeGxfZmx1c2hfcmVzb3VyY2VzKFFYTEluc3RhbmNl
ICpxeGwpCiB7Ci0gICAgUVhMSW50ZXJmYWNlICppbnRlcmZhY2UgPSBxeGxfZ2V0X2ludGVyZmFj
ZShxeGwpOworICAgIFFYTEludGVyZmFjZSAqcXhsX2ludGVyZmFjZSA9IHF4bF9nZXRfaW50ZXJm
YWNlKHF4bCk7CiAKLSAgICByZXR1cm4gaW50ZXJmYWNlLT5mbHVzaF9yZXNvdXJjZXMocXhsKTsK
KyAgICByZXR1cm4gcXhsX2ludGVyZmFjZS0+Zmx1c2hfcmVzb3VyY2VzKHF4bCk7CiB9CiAKIHZv
aWQgcmVkX3F4bF91cGRhdGVfYXJlYV9jb21wbGV0ZShRWExJbnN0YW5jZSAqcXhsLCB1aW50MzJf
dCBzdXJmYWNlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBR
WExSZWN0ICp1cGRhdGVkX3JlY3RzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHVpbnQzMl90IG51bV91cGRhdGVkX3JlY3RzKQogewotICAgIFFYTEludGVyZmFjZSAqaW50ZXJm
YWNlID0gcXhsX2dldF9pbnRlcmZhY2UocXhsKTsKKyAgICBRWExJbnRlcmZhY2UgKnF4bF9pbnRl
cmZhY2UgPSBxeGxfZ2V0X2ludGVyZmFjZShxeGwpOwogCi0gICAgaW50ZXJmYWNlLT51cGRhdGVf
YXJlYV9jb21wbGV0ZShxeGwsIHN1cmZhY2VfaWQsIHVwZGF0ZWRfcmVjdHMsIG51bV91cGRhdGVk
X3JlY3RzKTsKKyAgICBxeGxfaW50ZXJmYWNlLT51cGRhdGVfYXJlYV9jb21wbGV0ZShxeGwsIHN1
cmZhY2VfaWQsIHVwZGF0ZWRfcmVjdHMsIG51bV91cGRhdGVkX3JlY3RzKTsKIH0KIAogdm9pZCBy
ZWRfcXhsX3NldF9jbGllbnRfY2FwYWJpbGl0aWVzKFFYTEluc3RhbmNlICpxeGwsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDhfdCBjbGllbnRfcHJlc2VudCwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50OF90IGNhcHNbU1BJQ0VfQ0FQ
QUJJTElUSUVTX1NJWkVdKQogewotICAgIFFYTEludGVyZmFjZSAqaW50ZXJmYWNlID0gcXhsX2dl
dF9pbnRlcmZhY2UocXhsKTsKKyAgICBRWExJbnRlcmZhY2UgKnF4bF9pbnRlcmZhY2UgPSBxeGxf
Z2V0X2ludGVyZmFjZShxeGwpOwogCiAgICAgaWYgKHF4bC0+c3QtPnJ1bm5pbmcpIHsKLSAgICAg
ICAgaW50ZXJmYWNlLT5zZXRfY2xpZW50X2NhcGFiaWxpdGllcyhxeGwsIGNsaWVudF9wcmVzZW50
LCBjYXBzKTsKKyAgICAgICAgcXhsX2ludGVyZmFjZS0+c2V0X2NsaWVudF9jYXBhYmlsaXRpZXMo
cXhsLCBjbGllbnRfcHJlc2VudCwgY2Fwcyk7CiAgICAgfQogfQogCiB2b2lkIHJlZF9xeGxfYXN5
bmNfY29tcGxldGUoUVhMSW5zdGFuY2UgKnF4bCwgdWludDY0X3QgY29va2llKQogewotICAgIFFY
TEludGVyZmFjZSAqaW50ZXJmYWNlID0gcXhsX2dldF9pbnRlcmZhY2UocXhsKTsKKyAgICBRWExJ
bnRlcmZhY2UgKnF4bF9pbnRlcmZhY2UgPSBxeGxfZ2V0X2ludGVyZmFjZShxeGwpOwogCi0gICAg
aW50ZXJmYWNlLT5hc3luY19jb21wbGV0ZShxeGwsIGNvb2tpZSk7CisgICAgcXhsX2ludGVyZmFj
ZS0+YXN5bmNfY29tcGxldGUocXhsLCBjb29raWUpOwogfQpkaWZmIC0tZ2l0IGEvc2VydmVyL3Jl
ZHMuYyBiL3NlcnZlci9yZWRzLmMKaW5kZXggNGU5OTAzNTEuLjNmMWE0YTA1IDEwMDY0NAotLS0g
YS9zZXJ2ZXIvcmVkcy5jCisrKyBiL3NlcnZlci9yZWRzLmMKQEAgLTEyNjAsOSArMTI2MCw5IEBA
IHZvaWQgcmVkc19yZWxlYXNlX2FnZW50X2RhdGFfYnVmZmVyKFJlZHNTdGF0ZSAqcmVkcywgdWlu
dDhfdCAqYnVmKQogc3RhdGljIHZvaWQgcmVkc19vbl9tYWluX2FnZW50X21vbml0b3JzX2NvbmZp
ZyhSZWRzU3RhdGUgKnJlZHMsCiAgICAgICAgIE1haW5DaGFubmVsQ2xpZW50ICptY2MsIGNvbnN0
IHZvaWQgKm1lc3NhZ2UsIHNpemVfdCBzaXplKQogewotICAgIGNvbnN0IHVuc2lnbmVkIGludCBN
QVhfTU9OSVRPUlMgPSAyNTY7CisgICAgY29uc3QgdW5zaWduZWQgaW50IE1BWF9OVU1fTU9OSVRP
UlMgPSAyNTY7CiAgICAgY29uc3QgdW5zaWduZWQgaW50IE1BWF9NT05JVE9SX0NPTkZJR19TSVpF
ID0KLSAgICAgICBzaXplb2YoVkRBZ2VudE1vbml0b3JzQ29uZmlnKSArIE1BWF9NT05JVE9SUyAq
IHNpemVvZihWREFnZW50TW9uQ29uZmlnKTsKKyAgICAgICBzaXplb2YoVkRBZ2VudE1vbml0b3Jz
Q29uZmlnKSArIE1BWF9OVU1fTU9OSVRPUlMgKiBzaXplb2YoVkRBZ2VudE1vbkNvbmZpZyk7CiAK
ICAgICBWREFnZW50TWVzc2FnZSAqbXNnX2hlYWRlcjsKICAgICBWREFnZW50TW9uaXRvcnNDb25m
aWcgKm1vbml0b3JzX2NvbmZpZzsKQEAgLTMzODUsMTIgKzMzODUsMTIgQEAgc3RhdGljIGludCBz
cGljZV9zZXJ2ZXJfY2hhcl9kZXZpY2VfcmVtb3ZlX2ludGVyZmFjZShSZWRzU3RhdGUgKnJlZHMs
IFNwaWNlQmFzZUkKIFNQSUNFX0dOVUNfVklTSUJMRSBpbnQgc3BpY2Vfc2VydmVyX2FkZF9pbnRl
cmZhY2UoU3BpY2VTZXJ2ZXIgKnJlZHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIFNwaWNlQmFzZUluc3RhbmNlICpzaW4pCiB7Ci0gICAgY29uc3Qg
U3BpY2VCYXNlSW50ZXJmYWNlICppbnRlcmZhY2UgPSBzaW4tPnNpZjsKKyAgICBjb25zdCBTcGlj
ZUJhc2VJbnRlcmZhY2UgKmJhc2VfaW50ZXJmYWNlID0gc2luLT5zaWY7CiAKLSAgICBpZiAoc3Ry
Y21wKGludGVyZmFjZS0+dHlwZSwgU1BJQ0VfSU5URVJGQUNFX0tFWUJPQVJEKSA9PSAwKSB7Cisg
ICAgaWYgKHN0cmNtcChiYXNlX2ludGVyZmFjZS0+dHlwZSwgU1BJQ0VfSU5URVJGQUNFX0tFWUJP
QVJEKSA9PSAwKSB7CiAgICAgICAgIHNwaWNlX2RlYnVnKCJTUElDRV9JTlRFUkZBQ0VfS0VZQk9B
UkQiKTsKLSAgICAgICAgaWYgKGludGVyZmFjZS0+bWFqb3JfdmVyc2lvbiAhPSBTUElDRV9JTlRF
UkZBQ0VfS0VZQk9BUkRfTUFKT1IgfHwKLSAgICAgICAgICAgIGludGVyZmFjZS0+bWlub3JfdmVy
c2lvbiA+IFNQSUNFX0lOVEVSRkFDRV9LRVlCT0FSRF9NSU5PUikgeworICAgICAgICBpZiAoYmFz
ZV9pbnRlcmZhY2UtPm1ham9yX3ZlcnNpb24gIT0gU1BJQ0VfSU5URVJGQUNFX0tFWUJPQVJEX01B
Sk9SIHx8CisgICAgICAgICAgICBiYXNlX2ludGVyZmFjZS0+bWlub3JfdmVyc2lvbiA+IFNQSUNF
X0lOVEVSRkFDRV9LRVlCT0FSRF9NSU5PUikgewogICAgICAgICAgICAgc3BpY2Vfd2FybmluZygi
dW5zdXBwb3J0ZWQga2V5Ym9hcmQgaW50ZXJmYWNlIik7CiAgICAgICAgICAgICByZXR1cm4gLTE7
CiAgICAgICAgIH0KQEAgLTMzOTgsMTAgKzMzOTgsMTAgQEAgU1BJQ0VfR05VQ19WSVNJQkxFIGlu
dCBzcGljZV9zZXJ2ZXJfYWRkX2ludGVyZmFjZShTcGljZVNlcnZlciAqcmVkcywKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTUElDRV9VUENBU1QoU3BpY2VLYmRJbnN0
YW5jZSwgc2luKSkgIT0gMCkgewogICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICB9Ci0g
ICAgfSBlbHNlIGlmIChzdHJjbXAoaW50ZXJmYWNlLT50eXBlLCBTUElDRV9JTlRFUkZBQ0VfTU9V
U0UpID09IDApIHsKKyAgICB9IGVsc2UgaWYgKHN0cmNtcChiYXNlX2ludGVyZmFjZS0+dHlwZSwg
U1BJQ0VfSU5URVJGQUNFX01PVVNFKSA9PSAwKSB7CiAgICAgICAgIHNwaWNlX2RlYnVnKCJTUElD
RV9JTlRFUkZBQ0VfTU9VU0UiKTsKLSAgICAgICAgaWYgKGludGVyZmFjZS0+bWFqb3JfdmVyc2lv
biAhPSBTUElDRV9JTlRFUkZBQ0VfTU9VU0VfTUFKT1IgfHwKLSAgICAgICAgICAgIGludGVyZmFj
ZS0+bWlub3JfdmVyc2lvbiA+IFNQSUNFX0lOVEVSRkFDRV9NT1VTRV9NSU5PUikgeworICAgICAg
ICBpZiAoYmFzZV9pbnRlcmZhY2UtPm1ham9yX3ZlcnNpb24gIT0gU1BJQ0VfSU5URVJGQUNFX01P
VVNFX01BSk9SIHx8CisgICAgICAgICAgICBiYXNlX2ludGVyZmFjZS0+bWlub3JfdmVyc2lvbiA+
IFNQSUNFX0lOVEVSRkFDRV9NT1VTRV9NSU5PUikgewogICAgICAgICAgICAgc3BpY2Vfd2Fybmlu
ZygidW5zdXBwb3J0ZWQgbW91c2UgaW50ZXJmYWNlIik7CiAgICAgICAgICAgICByZXR1cm4gLTE7
CiAgICAgICAgIH0KQEAgLTM0MDksMTIgKzM0MDksMTIgQEAgU1BJQ0VfR05VQ19WSVNJQkxFIGlu
dCBzcGljZV9zZXJ2ZXJfYWRkX2ludGVyZmFjZShTcGljZVNlcnZlciAqcmVkcywKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTUElDRV9VUENBU1QoU3BpY2VNb3VzZUluc3Rh
bmNlLCBzaW4pKSAhPSAwKSB7CiAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgIH0KLSAg
ICB9IGVsc2UgaWYgKHN0cmNtcChpbnRlcmZhY2UtPnR5cGUsIFNQSUNFX0lOVEVSRkFDRV9RWEwp
ID09IDApIHsKKyAgICB9IGVsc2UgaWYgKHN0cmNtcChiYXNlX2ludGVyZmFjZS0+dHlwZSwgU1BJ
Q0VfSU5URVJGQUNFX1FYTCkgPT0gMCkgewogICAgICAgICBRWExJbnN0YW5jZSAqcXhsOwogCiAg
ICAgICAgIHNwaWNlX2RlYnVnKCJTUElDRV9JTlRFUkZBQ0VfUVhMIik7Ci0gICAgICAgIGlmIChp
bnRlcmZhY2UtPm1ham9yX3ZlcnNpb24gIT0gU1BJQ0VfSU5URVJGQUNFX1FYTF9NQUpPUiB8fAot
ICAgICAgICAgICAgaW50ZXJmYWNlLT5taW5vcl92ZXJzaW9uID4gU1BJQ0VfSU5URVJGQUNFX1FY
TF9NSU5PUikgeworICAgICAgICBpZiAoYmFzZV9pbnRlcmZhY2UtPm1ham9yX3ZlcnNpb24gIT0g
U1BJQ0VfSU5URVJGQUNFX1FYTF9NQUpPUiB8fAorICAgICAgICAgICAgYmFzZV9pbnRlcmZhY2Ut
Pm1pbm9yX3ZlcnNpb24gPiBTUElDRV9JTlRFUkZBQ0VfUVhMX01JTk9SKSB7CiAgICAgICAgICAg
ICBzcGljZV93YXJuaW5nKCJ1bnN1cHBvcnRlZCBxeGwgaW50ZXJmYWNlIik7CiAgICAgICAgICAg
ICByZXR1cm4gLTE7CiAgICAgICAgIH0KQEAgLTM0MzgsMTEgKzM0MzgsMTEgQEAgU1BJQ0VfR05V
Q19WSVNJQkxFIGludCBzcGljZV9zZXJ2ZXJfYWRkX2ludGVyZmFjZShTcGljZVNlcnZlciAqcmVk
cywKICAgICAgICAgICogYmUgY2FsbGVkLiAqLwogICAgICAgICByZWRfcXhsX2F0dGFjaF93b3Jr
ZXIocXhsKTsKICAgICAgICAgcmVkX3F4bF9zZXRfY29tcHJlc3Npb25fbGV2ZWwocXhsLCBjYWxj
X2NvbXByZXNzaW9uX2xldmVsKHJlZHMpKTsKLSAgICB9IGVsc2UgaWYgKHN0cmNtcChpbnRlcmZh
Y2UtPnR5cGUsIFNQSUNFX0lOVEVSRkFDRV9UQUJMRVQpID09IDApIHsKKyAgICB9IGVsc2UgaWYg
KHN0cmNtcChiYXNlX2ludGVyZmFjZS0+dHlwZSwgU1BJQ0VfSU5URVJGQUNFX1RBQkxFVCkgPT0g
MCkgewogICAgICAgICBTcGljZVRhYmxldEluc3RhbmNlICp0YWJsZXQgPSBTUElDRV9VUENBU1Qo
U3BpY2VUYWJsZXRJbnN0YW5jZSwgc2luKTsKICAgICAgICAgc3BpY2VfZGVidWcoIlNQSUNFX0lO
VEVSRkFDRV9UQUJMRVQiKTsKLSAgICAgICAgaWYgKGludGVyZmFjZS0+bWFqb3JfdmVyc2lvbiAh
PSBTUElDRV9JTlRFUkZBQ0VfVEFCTEVUX01BSk9SIHx8Ci0gICAgICAgICAgICBpbnRlcmZhY2Ut
Pm1pbm9yX3ZlcnNpb24gPiBTUElDRV9JTlRFUkZBQ0VfVEFCTEVUX01JTk9SKSB7CisgICAgICAg
IGlmIChiYXNlX2ludGVyZmFjZS0+bWFqb3JfdmVyc2lvbiAhPSBTUElDRV9JTlRFUkZBQ0VfVEFC
TEVUX01BSk9SIHx8CisgICAgICAgICAgICBiYXNlX2ludGVyZmFjZS0+bWlub3JfdmVyc2lvbiA+
IFNQSUNFX0lOVEVSRkFDRV9UQUJMRVRfTUlOT1IpIHsKICAgICAgICAgICAgIHNwaWNlX3dhcm5p
bmcoInVuc3VwcG9ydGVkIHRhYmxldCBpbnRlcmZhY2UiKTsKICAgICAgICAgICAgIHJldHVybiAt
MTsKICAgICAgICAgfQpAQCAtMzQ1NCw0MSArMzQ1NCw0MSBAQCBTUElDRV9HTlVDX1ZJU0lCTEUg
aW50IHNwaWNlX3NlcnZlcl9hZGRfaW50ZXJmYWNlKFNwaWNlU2VydmVyICpyZWRzLAogICAgICAg
ICAgICAgaW5wdXRzX2NoYW5uZWxfc2V0X3RhYmxldF9sb2dpY2FsX3NpemUocmVkcy0+aW5wdXRz
X2NoYW5uZWwsIHJlZHMtPm1vbml0b3JfbW9kZS54X3JlcywgcmVkcy0+bW9uaXRvcl9tb2RlLnlf
cmVzKTsKICAgICAgICAgfQogCi0gICAgfSBlbHNlIGlmIChzdHJjbXAoaW50ZXJmYWNlLT50eXBl
LCBTUElDRV9JTlRFUkZBQ0VfUExBWUJBQ0spID09IDApIHsKKyAgICB9IGVsc2UgaWYgKHN0cmNt
cChiYXNlX2ludGVyZmFjZS0+dHlwZSwgU1BJQ0VfSU5URVJGQUNFX1BMQVlCQUNLKSA9PSAwKSB7
CiAgICAgICAgIHNwaWNlX2RlYnVnKCJTUElDRV9JTlRFUkZBQ0VfUExBWUJBQ0siKTsKLSAgICAg
ICAgaWYgKGludGVyZmFjZS0+bWFqb3JfdmVyc2lvbiAhPSBTUElDRV9JTlRFUkZBQ0VfUExBWUJB
Q0tfTUFKT1IgfHwKLSAgICAgICAgICAgIGludGVyZmFjZS0+bWlub3JfdmVyc2lvbiA+IFNQSUNF
X0lOVEVSRkFDRV9QTEFZQkFDS19NSU5PUikgeworICAgICAgICBpZiAoYmFzZV9pbnRlcmZhY2Ut
Pm1ham9yX3ZlcnNpb24gIT0gU1BJQ0VfSU5URVJGQUNFX1BMQVlCQUNLX01BSk9SIHx8CisgICAg
ICAgICAgICBiYXNlX2ludGVyZmFjZS0+bWlub3JfdmVyc2lvbiA+IFNQSUNFX0lOVEVSRkFDRV9Q
TEFZQkFDS19NSU5PUikgewogICAgICAgICAgICAgc3BpY2Vfd2FybmluZygidW5zdXBwb3J0ZWQg
cGxheWJhY2sgaW50ZXJmYWNlIik7CiAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgIH0K
ICAgICAgICAgc25kX2F0dGFjaF9wbGF5YmFjayhyZWRzLCBTUElDRV9VUENBU1QoU3BpY2VQbGF5
YmFja0luc3RhbmNlLCBzaW4pKTsKIAotICAgIH0gZWxzZSBpZiAoc3RyY21wKGludGVyZmFjZS0+
dHlwZSwgU1BJQ0VfSU5URVJGQUNFX1JFQ09SRCkgPT0gMCkgeworICAgIH0gZWxzZSBpZiAoc3Ry
Y21wKGJhc2VfaW50ZXJmYWNlLT50eXBlLCBTUElDRV9JTlRFUkZBQ0VfUkVDT1JEKSA9PSAwKSB7
CiAgICAgICAgIHNwaWNlX2RlYnVnKCJTUElDRV9JTlRFUkZBQ0VfUkVDT1JEIik7Ci0gICAgICAg
IGlmIChpbnRlcmZhY2UtPm1ham9yX3ZlcnNpb24gIT0gU1BJQ0VfSU5URVJGQUNFX1JFQ09SRF9N
QUpPUiB8fAotICAgICAgICAgICAgaW50ZXJmYWNlLT5taW5vcl92ZXJzaW9uID4gU1BJQ0VfSU5U
RVJGQUNFX1JFQ09SRF9NSU5PUikgeworICAgICAgICBpZiAoYmFzZV9pbnRlcmZhY2UtPm1ham9y
X3ZlcnNpb24gIT0gU1BJQ0VfSU5URVJGQUNFX1JFQ09SRF9NQUpPUiB8fAorICAgICAgICAgICAg
YmFzZV9pbnRlcmZhY2UtPm1pbm9yX3ZlcnNpb24gPiBTUElDRV9JTlRFUkZBQ0VfUkVDT1JEX01J
Tk9SKSB7CiAgICAgICAgICAgICBzcGljZV93YXJuaW5nKCJ1bnN1cHBvcnRlZCByZWNvcmQgaW50
ZXJmYWNlIik7CiAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgIH0KICAgICAgICAgc25k
X2F0dGFjaF9yZWNvcmQocmVkcywgU1BJQ0VfVVBDQVNUKFNwaWNlUmVjb3JkSW5zdGFuY2UsIHNp
bikpOwogCi0gICAgfSBlbHNlIGlmIChzdHJjbXAoaW50ZXJmYWNlLT50eXBlLCBTUElDRV9JTlRF
UkZBQ0VfQ0hBUl9ERVZJQ0UpID09IDApIHsKLSAgICAgICAgaWYgKGludGVyZmFjZS0+bWFqb3Jf
dmVyc2lvbiAhPSBTUElDRV9JTlRFUkZBQ0VfQ0hBUl9ERVZJQ0VfTUFKT1IgfHwKLSAgICAgICAg
ICAgIGludGVyZmFjZS0+bWlub3JfdmVyc2lvbiA+IFNQSUNFX0lOVEVSRkFDRV9DSEFSX0RFVklD
RV9NSU5PUikgeworICAgIH0gZWxzZSBpZiAoc3RyY21wKGJhc2VfaW50ZXJmYWNlLT50eXBlLCBT
UElDRV9JTlRFUkZBQ0VfQ0hBUl9ERVZJQ0UpID09IDApIHsKKyAgICAgICAgaWYgKGJhc2VfaW50
ZXJmYWNlLT5tYWpvcl92ZXJzaW9uICE9IFNQSUNFX0lOVEVSRkFDRV9DSEFSX0RFVklDRV9NQUpP
UiB8fAorICAgICAgICAgICAgYmFzZV9pbnRlcmZhY2UtPm1pbm9yX3ZlcnNpb24gPiBTUElDRV9J
TlRFUkZBQ0VfQ0hBUl9ERVZJQ0VfTUlOT1IpIHsKICAgICAgICAgICAgIHNwaWNlX3dhcm5pbmco
InVuc3VwcG9ydGVkIGNoYXIgZGV2aWNlIGludGVyZmFjZSIpOwogICAgICAgICAgICAgcmV0dXJu
IC0xOwogICAgICAgICB9CiAgICAgICAgIHNwaWNlX3NlcnZlcl9jaGFyX2RldmljZV9hZGRfaW50
ZXJmYWNlKHJlZHMsIHNpbik7CiAKLSAgICB9IGVsc2UgaWYgKHN0cmNtcChpbnRlcmZhY2UtPnR5
cGUsIFNQSUNFX0lOVEVSRkFDRV9NSUdSQVRJT04pID09IDApIHsKKyAgICB9IGVsc2UgaWYgKHN0
cmNtcChiYXNlX2ludGVyZmFjZS0+dHlwZSwgU1BJQ0VfSU5URVJGQUNFX01JR1JBVElPTikgPT0g
MCkgewogICAgICAgICBzcGljZV9kZWJ1ZygiU1BJQ0VfSU5URVJGQUNFX01JR1JBVElPTiIpOwog
ICAgICAgICBpZiAocmVkcy0+bWlncmF0aW9uX2ludGVyZmFjZSkgewogICAgICAgICAgICAgc3Bp
Y2Vfd2FybmluZygiYWxyZWFkeSBoYXZlIG1pZ3JhdGlvbiIpOwogICAgICAgICAgICAgcmV0dXJu
IC0xOwogICAgICAgICB9CiAKLSAgICAgICAgaWYgKGludGVyZmFjZS0+bWFqb3JfdmVyc2lvbiAh
PSBTUElDRV9JTlRFUkZBQ0VfTUlHUkFUSU9OX01BSk9SIHx8Ci0gICAgICAgICAgICBpbnRlcmZh
Y2UtPm1pbm9yX3ZlcnNpb24gPiBTUElDRV9JTlRFUkZBQ0VfTUlHUkFUSU9OX01JTk9SKSB7Cisg
ICAgICAgIGlmIChiYXNlX2ludGVyZmFjZS0+bWFqb3JfdmVyc2lvbiAhPSBTUElDRV9JTlRFUkZB
Q0VfTUlHUkFUSU9OX01BSk9SIHx8CisgICAgICAgICAgICBiYXNlX2ludGVyZmFjZS0+bWlub3Jf
dmVyc2lvbiA+IFNQSUNFX0lOVEVSRkFDRV9NSUdSQVRJT05fTUlOT1IpIHsKICAgICAgICAgICAg
IHNwaWNlX3dhcm5pbmcoInVuc3VwcG9ydGVkIG1pZ3JhdGlvbiBpbnRlcmZhY2UiKTsKICAgICAg
ICAgICAgIHJldHVybiAtMTsKICAgICAgICAgfQpAQCAtMzUwMiwzMCArMzUwMiwzMCBAQCBTUElD
RV9HTlVDX1ZJU0lCTEUgaW50IHNwaWNlX3NlcnZlcl9hZGRfaW50ZXJmYWNlKFNwaWNlU2VydmVy
ICpyZWRzLAogU1BJQ0VfR05VQ19WSVNJQkxFIGludCBzcGljZV9zZXJ2ZXJfcmVtb3ZlX2ludGVy
ZmFjZShTcGljZUJhc2VJbnN0YW5jZSAqc2luKQogewogICAgIFJlZHNTdGF0ZSAqcmVkczsKLSAg
ICBjb25zdCBTcGljZUJhc2VJbnRlcmZhY2UgKmludGVyZmFjZTsKKyAgICBjb25zdCBTcGljZUJh
c2VJbnRlcmZhY2UgKmJhc2VfaW50ZXJmYWNlOwogCiAgICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwo
c2luICE9IE5VTEwsIC0xKTsKIAotICAgIGludGVyZmFjZSA9IHNpbi0+c2lmOwotICAgIGlmIChz
dHJjbXAoaW50ZXJmYWNlLT50eXBlLCBTUElDRV9JTlRFUkZBQ0VfVEFCTEVUKSA9PSAwKSB7Cisg
ICAgYmFzZV9pbnRlcmZhY2UgPSBzaW4tPnNpZjsKKyAgICBpZiAoc3RyY21wKGJhc2VfaW50ZXJm
YWNlLT50eXBlLCBTUElDRV9JTlRFUkZBQ0VfVEFCTEVUKSA9PSAwKSB7CiAgICAgICAgIFNwaWNl
VGFibGV0SW5zdGFuY2UgKnRhYmxldCA9IFNQSUNFX1VQQ0FTVChTcGljZVRhYmxldEluc3RhbmNl
LCBzaW4pOwogICAgICAgICBnX3JldHVybl92YWxfaWZfZmFpbCh0YWJsZXQtPnN0ICE9IE5VTEws
IC0xKTsKICAgICAgICAgcmVkcyA9IHNwaWNlX3RhYmxldF9zdGF0ZV9nZXRfc2VydmVyKHRhYmxl
dC0+c3QpOwogICAgICAgICBzcGljZV9kZWJ1ZygicmVtb3ZlIFNQSUNFX0lOVEVSRkFDRV9UQUJM
RVQiKTsKICAgICAgICAgaW5wdXRzX2NoYW5uZWxfZGV0YWNoX3RhYmxldChyZWRzLT5pbnB1dHNf
Y2hhbm5lbCwgdGFibGV0KTsKICAgICAgICAgcmVkc191cGRhdGVfbW91c2VfbW9kZShyZWRzKTsK
LSAgICB9IGVsc2UgaWYgKHN0cmNtcChpbnRlcmZhY2UtPnR5cGUsIFNQSUNFX0lOVEVSRkFDRV9Q
TEFZQkFDSykgPT0gMCkgeworICAgIH0gZWxzZSBpZiAoc3RyY21wKGJhc2VfaW50ZXJmYWNlLT50
eXBlLCBTUElDRV9JTlRFUkZBQ0VfUExBWUJBQ0spID09IDApIHsKICAgICAgICAgc3BpY2VfZGVi
dWcoInJlbW92ZSBTUElDRV9JTlRFUkZBQ0VfUExBWUJBQ0siKTsKICAgICAgICAgc25kX2RldGFj
aF9wbGF5YmFjayhTUElDRV9VUENBU1QoU3BpY2VQbGF5YmFja0luc3RhbmNlLCBzaW4pKTsKLSAg
ICB9IGVsc2UgaWYgKHN0cmNtcChpbnRlcmZhY2UtPnR5cGUsIFNQSUNFX0lOVEVSRkFDRV9SRUNP
UkQpID09IDApIHsKKyAgICB9IGVsc2UgaWYgKHN0cmNtcChiYXNlX2ludGVyZmFjZS0+dHlwZSwg
U1BJQ0VfSU5URVJGQUNFX1JFQ09SRCkgPT0gMCkgewogICAgICAgICBzcGljZV9kZWJ1ZygicmVt
b3ZlIFNQSUNFX0lOVEVSRkFDRV9SRUNPUkQiKTsKICAgICAgICAgc25kX2RldGFjaF9yZWNvcmQo
U1BJQ0VfVVBDQVNUKFNwaWNlUmVjb3JkSW5zdGFuY2UsIHNpbikpOwotICAgIH0gZWxzZSBpZiAo
c3RyY21wKGludGVyZmFjZS0+dHlwZSwgU1BJQ0VfSU5URVJGQUNFX0NIQVJfREVWSUNFKSA9PSAw
KSB7CisgICAgfSBlbHNlIGlmIChzdHJjbXAoYmFzZV9pbnRlcmZhY2UtPnR5cGUsIFNQSUNFX0lO
VEVSRkFDRV9DSEFSX0RFVklDRSkgPT0gMCkgewogICAgICAgICBTcGljZUNoYXJEZXZpY2VJbnN0
YW5jZSAqY2hhcl9kZXZpY2UgPSBTUElDRV9VUENBU1QoU3BpY2VDaGFyRGV2aWNlSW5zdGFuY2Us
IHNpbik7CiAgICAgICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKGNoYXJfZGV2aWNlLT5zdCAhPSBO
VUxMLCAtMSk7CiAgICAgICAgIHJlZHMgPSByZWRfY2hhcl9kZXZpY2VfZ2V0X3NlcnZlcihjaGFy
X2RldmljZS0+c3QpOwogICAgICAgICByZXR1cm4gc3BpY2Vfc2VydmVyX2NoYXJfZGV2aWNlX3Jl
bW92ZV9pbnRlcmZhY2UocmVkcywgc2luKTsKLSAgICB9IGVsc2UgaWYgKHN0cmNtcChpbnRlcmZh
Y2UtPnR5cGUsIFNQSUNFX0lOVEVSRkFDRV9RWEwpID09IDApIHsKKyAgICB9IGVsc2UgaWYgKHN0
cmNtcChiYXNlX2ludGVyZmFjZS0+dHlwZSwgU1BJQ0VfSU5URVJGQUNFX1FYTCkgPT0gMCkgewog
ICAgICAgICBRWExJbnN0YW5jZSAqcXhsOwogCiAgICAgICAgIHF4bCA9IFNQSUNFX1VQQ0FTVChR
WExJbnN0YW5jZSwgc2luKTsKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KU3BpY2UtZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVs
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
