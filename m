Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id BB030793BA
	for <lists+spice-devel@lfdr.de>; Mon, 29 Jul 2019 21:23:58 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E71346E1D3;
	Mon, 29 Jul 2019 19:23:56 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail.codeweavers.com (mail.codeweavers.com [50.203.203.244])
 by gabe.freedesktop.org (Postfix) with ESMTPS id ED0946E1D3
 for <spice-devel@lists.freedesktop.org>; Mon, 29 Jul 2019 19:23:55 +0000 (UTC)
Received: from jwhite.mn.codeweavers.com ([10.69.137.101])
 by mail.codeweavers.com with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_GCM_SHA256:128)
 (Exim 4.89) (envelope-from <jwhite@codeweavers.com>)
 id 1hsBFl-0004bG-OA; Mon, 29 Jul 2019 14:24:13 -0500
To: spice-devel@lists.freedesktop.org, Brendan Shanks <bshanks@codeweavers.com>
References: <20190711200305.4616-1-bshanks@codeweavers.com>
 <20190717021606.2737-1-bshanks@codeweavers.com>
 <20190717021606.2737-4-bshanks@codeweavers.com>
From: Jeremy White <jwhite@codeweavers.com>
Message-ID: <b40ee439-934a-956e-f82a-bdfa6b6f82ff@codeweavers.com>
Date: Mon, 29 Jul 2019 14:23:54 -0500
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <20190717021606.2737-4-bshanks@codeweavers.com>
Content-Language: en-US
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; 
 d=codeweavers.com; s=6377696661; h=Content-Transfer-Encoding:Content-Type:
 In-Reply-To:MIME-Version:Date:Message-ID:From:References:To:Subject:Sender:
 Reply-To:Cc:Content-ID:Content-Description:Resent-Date:Resent-From:
 Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:
 List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=n4eHu9TId/n6mZU1LZCcltZodBguepoC/Ibjtq0WIkI=; b=OMWYm5uqTa5+XIvlQQp6hlBXwH
 gwJW9VMi8AtmTZen6sN9RdCAegGz+m8pNZTjP+VvJ8rvQFEoCKpmZ/tHAMFW9U+KhRvd+xAD1UH6n
 j2z4Xtd3TnrEsbj+8e7JAD+Xf312hlTjbAoZRLJ3GmKY2NkoYQBRhB6ZABx1ayOHY3Ao=;
Subject: Re: [Spice-devel] [PATCH x11spice v2 3/3] Add cache for SHM segments
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

SGkgQnJlbmRhbiwKCkkndmUgYmVlbiBydW5uaW5nIHdpdGggdGhpcyBjb2RlIGZvciBhIHdoaWxl
LCBhbmQgaXQgd29ya3MgbmljZWx5LiAgSXQncyAKaGFyZCB0byBxdWFudGlmeSwgYnV0IHdpdGgg
bXkgdGVzdCBjYXNlIEkgZ2V0IGNhY2hlIGhpdCByYXRlcyBpbiB0aGUgOTAlIApyYW5nZSwgYW5k
IGl0IGRvZXMgc2VlbSB0byBpbXByb3ZlIG92ZXJhbGwgcGVyZm9ybWFuY2UuCgpJJ3ZlIGdvdCB0
d28gY29tbWVudHMgb24gdGhlIHBhdGNoLCBpbmxpbmUgYmVsb3c6CgpPbiA3LzE2LzE5IDk6MTYg
UE0sIEJyZW5kYW4gU2hhbmtzIHdyb3RlOgo+IEFkZCBhIGNhY2hlIHRvIGFsbG93IHRoZSByZXVz
ZSBvZiBTSE0gc2VnbWVudHMuCj4gU2hhcmVkIG1lbW9yeSBzZWdtZW50cyBhcmUgYWRkZWQgdG8g
dGhlIGNhY2hlIGluc3RlYWQgb2YgYmVpbmcKPiBkZWFsbG9jYXRlZCwgYW5kIHRoZSBjYWNoZSBp
cyBzZWFyY2hlZCBpbnN0ZWFkIG9mL2JlZm9yZSBhbGxvY2F0aW5nIGEKPiBuZXcgc2VnbWVudC4K
PiAKPiBCb3RoIHRoZSBTSE0gc2VnbWVudHMgYW5kIHRoZWlyIGF0dGFjaG1lbnQgd2l0aCB0aGUg
WCBzZXJ2ZXIgYXJlIGNhY2hlZC4KPiAKPiBUaGUgY2FjaGUgY3VycmVudGx5IGhhcyBhIGZpeGVk
IG51bWJlciBvZiAxMCBlbnRyaWVzLCB0aGlzIHByb3ZpZGVkIGEKPiBnb29kIGNhY2hlIGhpdCBy
YXRlIHdoaWxlIGtlZXBpbmcgbWVtb3J5IHVzYWdlIHVuZGVyIGNvbnRyb2wuCj4gQnVpbGRpbmcg
d2l0aCBERUJVR19TSE1fQ0FDSEUgZGVmaW5lZCBhbmQgcnVubmluZyB3aXRoCj4gR19NRVNTQUdF
U19ERUJVRz1hbGwgd2lsbCBwZXJpb2RpY2FsbHkgcHJpbnQgb3V0IHRoZSBTSE0gY2FjaGUgaGl0
Cj4gcmF0ZS4KPiAKPiBPbiBteSBVYnVudHUgMTguMDQgc3lzdGVtIHJ1bm5pbmcgWEZDRTQgd2l0
aCBhIDI1NjB4MTQ0MCBzY3JlZW4sIHRoZQo+IGNhY2hlIGhpdCByYXRlIHN0YXJ0cyBhcm91bmQg
NzIlLiBPbi1zY3JlZW4gd2luZG93cyB0aGF0IHVwZGF0ZSBvZnRlbgo+IGFuZCBoYXZlIGNvbnNp
c3RlbnRseS1zaXplZCBkYW1hZ2UgcmVjdGFuZ2xlcyBhcmUgdGhlIGJlc3QgY2FzZS4gV2l0aAo+
IHNldmVyYWwgb2YgdGhvc2UgKHNjcm9sbGluZyB0ZXJtaW5hbCB3aW5kb3dzLCB3ZWIgYnJvd3Nl
ciBzaG93aW5nIGEKPiBXZWJHTCBkZW1vKSwgdGhlIGhpdCByYXRlIHNsb3dseSByaXNlcyB0byBh
cm91bmQgOTIlLgo+IE9wZXJhdGlvbnMgdGhhdCBnZW5lcmF0ZSByYXBpZCBkYW1hZ2UgcmVwb3J0
cyAobGlrZSByZXNpemluZyBvciBtb3ZpbmcKPiB3aW5kb3dzKSB3aWxsIGxvd2VyIHRoZSBoaXQg
cmF0ZS4KPiAKPiBTaWduZWQtb2ZmLWJ5OiBCcmVuZGFuIFNoYW5rcyA8YnNoYW5rc0Bjb2Rld2Vh
dmVycy5jb20+Cj4gLS0tCj4gICBzcmMvZGlzcGxheS5jIHwgMTc3ICsrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKystLS0tCj4gICBzcmMvZGlzcGxheS5oIHwgICA3
ICstCj4gICAyIGZpbGVzIGNoYW5nZWQsIDE2OSBpbnNlcnRpb25zKCspLCAxNSBkZWxldGlvbnMo
LSkKPiAKPiBkaWZmIC0tZ2l0IGEvc3JjL2Rpc3BsYXkuYyBiL3NyYy9kaXNwbGF5LmMKPiBpbmRl
eCA5NGYxOTJjLi4xNjY4ZDhhIDEwMDY0NAo+IC0tLSBhL3NyYy9kaXNwbGF5LmMKPiArKysgYi9z
cmMvZGlzcGxheS5jCj4gQEAgLTIxMywxMSArMjEzLDE1NyBAQCBzdGF0aWMgaW50IHJlZ2lzdGVy
X2Zvcl9ldmVudHMoZGlzcGxheV90ICpkKQo+ICAgICAgIHJldHVybiAwOwo+ICAgfQo+ICAgCj4g
K3N0YXRpYyB2b2lkIHNobV9zZWdtZW50X2Rlc3Ryb3koZGlzcGxheV90ICpkLCBzaG1fc2VnbWVu
dF90ICpzZWdtZW50KQo+ICt7Cj4gKyAgICBpZiAoc2VnbWVudC0+c2htaWQgPT0gLTEpIHsKPiAr
ICAgICAgICByZXR1cm47Cj4gKyAgICB9Cj4gKwo+ICsgICAgeGNiX3NobV9kZXRhY2goZC0+Yywg
c2VnbWVudC0+c2htc2VnKTsKPiArICAgIHNlZ21lbnQtPnNobXNlZyA9IC0xOwo+ICsKPiArICAg
IHNobWR0KHNlZ21lbnQtPnNobWFkZHIpOwo+ICsgICAgc2VnbWVudC0+c2htYWRkciA9IE5VTEw7
Cj4gKwo+ICsgICAgc2htY3RsKHNlZ21lbnQtPnNobWlkLCBJUENfUk1JRCwgTlVMTCk7Cj4gKyAg
ICBzZWdtZW50LT5zaG1pZCA9IC0xOwo+ICt9Cj4gKwo+ICsKPiArc3RhdGljIGludCBzaG1fY2Fj
aGVfZ2V0KGRpc3BsYXlfdCAqZCwgc2l6ZV90IHNpemUsIHNobV9zZWdtZW50X3QgKnNlZ21lbnQp
Cj4gK3sKPiArICAgIGludCBpLCByZXQ7Cj4gKyAgICBzaG1fc2VnbWVudF90ICpiaWdnZXJfZW50
cnkgPSBOVUxMOwo+ICsgICAgc2htX3NlZ21lbnRfdCAqZW50cnlfdG9fdXNlID0gTlVMTDsKPiAr
Cj4gKyNpZiBkZWZpbmVkKERFQlVHX1NITV9DQUNIRSkKPiArICAgIHN0YXRpYyBndWludCBjYWNo
ZV9oaXRzID0gMDsKPiArICAgIHN0YXRpYyBndWludCBjYWNoZV90b3RhbCA9IDA7Cj4gKwo+ICsg
ICAgY2FjaGVfdG90YWwrKzsKPiArI2VuZGlmCj4gKwo+ICsgICAgZ19tdXRleF9sb2NrKCZkLT5z
aG1fY2FjaGVfbXV0ZXgpOwo+ICsKPiArICAgIC8qIENoZWNrIHRoZSBjYWNoZSBmb3IgYSBzZWdt
ZW50IG9mIHNpemUgJ3NpemUnIG9yIGJpZ2dlci4KPiArICAgICAqIFVzZSBhbiBleGFjdC1zaXpl
IHNlZ21lbnQgaWYgZm91bmQuCj4gKyAgICAgKiBJZiBub3QsIHVzZSB0aGUgc21hbGxlc3QgZW50
cnkgdGhhdCBpcyBiaWcgZW5vdWdoLgo+ICsgICAgICovCj4gKyAgICBmb3IgKGkgPSAwOyBpIDwg
R19OX0VMRU1FTlRTKGQtPnNobV9jYWNoZSk7IGkrKykgewo+ICsgICAgICAgIHNobV9zZWdtZW50
X3QgKmVudHJ5ID0gJmQtPnNobV9jYWNoZVtpXTsKPiArCj4gKyAgICAgICAgaWYgKGVudHJ5LT5z
aG1pZCAhPSAtMSkgewo+ICsgICAgICAgICAgICAvKiBJZiBhIGNhY2hlIGVudHJ5IG9mIHRoZSBl
eGFjdCBzaXplIGJlaW5nIHJlcXVlc3RlZCBpcyBmb3VuZCwgdXNlIHRoYXQgKi8KPiArICAgICAg
ICAgICAgaWYgKHNpemUgPT0gZW50cnktPnNpemUpIHsKPiArICAgICAgICAgICAgICAgIGVudHJ5
X3RvX3VzZSA9IGVudHJ5Owo+ICsgICAgICAgICAgICAgICAgYnJlYWs7Cj4gKyAgICAgICAgICAg
IH0KPiArCj4gKyAgICAgICAgICAgIC8qIEtlZXAgdHJhY2sgb2YgdGhlIG5leHQtYmlnZ2VzdCBl
bnRyeSBpbiBjYXNlIGFuIGV4YWN0LXNpemUgbWF0Y2ggaXNuJ3QgZm91bmQgKi8KPiArICAgICAg
ICAgICAgaWYgKHNpemUgPCBlbnRyeS0+c2l6ZSkgewo+ICsgICAgICAgICAgICAgICAgaWYgKGJp
Z2dlcl9lbnRyeSAmJiBlbnRyeS0+c2l6ZSA8IGJpZ2dlcl9lbnRyeS0+c2l6ZSkgewo+ICsgICAg
ICAgICAgICAgICAgICAgIGJpZ2dlcl9lbnRyeSA9IGVudHJ5Owo+ICsgICAgICAgICAgICAgICAg
fSBlbHNlIHsKPiArICAgICAgICAgICAgICAgICAgICBiaWdnZXJfZW50cnkgPSBlbnRyeTsKPiAr
ICAgICAgICAgICAgICAgIH0KCklzbid0IHRoaXMgY29kZSBmbGF3ZWQ/ICBUaGUgZWxzZSBiZWhh
dmlvciBzaG91bGQgbm90IGJlIGlkZW50aWNhbCB0byAKdGhlIGlmIGNvbmRpdGlvbi4gIFNob3Vs
ZG4ndCBpdCBiZSBzb21ldGhpbmcgbW9yZSBsaWtlOgoKICAgaWYoYmlnZ2VyX2VudHJ5ID09IE5V
TEwgfHwgZW50cnktPnNpemUgPCBiaWdnZXJfZW50cnktPnNpemUpIHsKICAgICBiaWdnZXJfZW50
cnkgPSBlbnRyeTsKICAgfQoKCj4gKyAgICAgICAgICAgIH0KPiArICAgICAgICB9Cj4gKyAgICB9
Cj4gKwo+ICsgICAgLyogQW4gZXhhY3Qtc2l6ZSBlbnRyeSB3YXNuJ3QgZm91bmQsIHVzZSB0aGUg
bmV4dCBiaWdnZXN0IGVudHJ5IHRoYXQgd2FzIGZvdW5kICovCj4gKyAgICBpZiAoIWVudHJ5X3Rv
X3VzZSkgewo+ICsgICAgICAgIGVudHJ5X3RvX3VzZSA9IGJpZ2dlcl9lbnRyeTsKPiArICAgIH0K
PiArCj4gKyAgICBpZiAoZW50cnlfdG9fdXNlKSB7Cj4gKyAgICAgICAgKnNlZ21lbnQgPSAqZW50
cnlfdG9fdXNlOwo+ICsgICAgICAgIGVudHJ5X3RvX3VzZS0+c2htaWQgPSAtMTsKPiArCj4gKyAg
ICAgICAgcmV0ID0gMTsKPiArCj4gKyNpZiBkZWZpbmVkKERFQlVHX1NITV9DQUNIRSkKPiArICAg
ICAgICBjYWNoZV9oaXRzKys7Cj4gKyAgICAgICAgaWYgKChjYWNoZV9oaXRzICUgMTAwID09IDAp
KSB7Cj4gKyAgICAgICAgICAgIGdfZGVidWcoIlNITSBjYWNoZSBoaXRyYXRlOiAldS8ldSAoJS4y
ZiUlKSIsIGNhY2hlX2hpdHMsIGNhY2hlX3RvdGFsLAo+ICsgICAgICAgICAgICAgICAgICAgIChm
bG9hdCkgKChmbG9hdCkgY2FjaGVfaGl0cyAvIChmbG9hdCkgY2FjaGVfdG90YWwpICogMTAwKTsK
PiArICAgICAgICB9Cj4gKyNlbmRpZgo+ICsgICAgfSBlbHNlIHsKPiArICAgICAgICAvKiBObyB1
c2FibGUgZW50cnkgZm91bmQgaW4gdGhlIGNhY2hlICovCj4gKyAgICAgICAgcmV0ID0gMDsKPiAr
ICAgIH0KPiArCj4gKyAgICBnX211dGV4X3VubG9jaygmZC0+c2htX2NhY2hlX211dGV4KTsKPiAr
ICAgIHJldHVybiByZXQ7Cj4gK30KPiArCj4gK3N0YXRpYyBpbnQgc2htX2NhY2hlX2FkZChkaXNw
bGF5X3QgKmQsIHNobV9zZWdtZW50X3QgKnNlZ21lbnQpCj4gK3sKPiArICAgIGludCBpLCByZXQ7
Cj4gKyAgICBzaG1fc2VnbWVudF90ICpzbWFsbGVzdF9lbnRyeSA9IE5VTEw7Cj4gKyAgICBzaG1f
c2VnbWVudF90ICplbnRyeV90b191c2UgPSBOVUxMOwo+ICsKPiArICAgIGdfbXV0ZXhfbG9jaygm
ZC0+c2htX2NhY2hlX211dGV4KTsKPiArCj4gKyAgICAvKiAnc2VnbWVudCcgaXMgbm93IHVudXNl
ZCwgdHJ5IHRvIGFkZCBpdCB0byB0aGUgY2FjaGUuCj4gKyAgICAgKiBVc2UgYW4gZW1wdHkgc2xv
dCBpbiB0aGUgY2FjaGUgaWYgYXZhaWxhYmxlLgo+ICsgICAgICogSWYgbm90LCBldmljdCB0aGUg
c21hbGxlc3QgZW50cnkgKHdoaWNoIGFsc28gbXVzdCBiZSBzbWFsbGVyIHRoYW4gJ3NlZ21lbnQn
KSBmcm9tIHRoZSBjYWNoZS4KPiArICAgICAqLwo+ICsgICAgZm9yIChpID0gMDsgaSA8IEdfTl9F
TEVNRU5UUyhkLT5zaG1fY2FjaGUpOyBpKyspIHsKPiArICAgICAgICBzaG1fc2VnbWVudF90ICpl
bnRyeSA9ICZkLT5zaG1fY2FjaGVbaV07Cj4gKwo+ICsgICAgICAgIGlmIChlbnRyeS0+c2htaWQg
PT0gLTEpIHsKPiArICAgICAgICAgICAgLyogVXNlIGFuIGVtcHR5IHNsb3QgaWYgZm91bmQgKi8K
PiArICAgICAgICAgICAgZW50cnlfdG9fdXNlID0gZW50cnk7Cj4gKyAgICAgICAgICAgIGJyZWFr
Owo+ICsgICAgICAgIH0KPiArCj4gKyAgICAgICAgLyogS2VlcCB0cmFjayBvZiB0aGUgc21hbGxl
c3QgZW50cnkgdGhhdCdzIHNtYWxsZXIgdGhhbiAnc2VnbWVudCcgKi8KPiArICAgICAgICBpZiAo
ZW50cnktPnNpemUgPCBzZWdtZW50LT5zaXplKSB7Cj4gKyAgICAgICAgICAgIGlmIChzbWFsbGVz
dF9lbnRyeSAmJiBlbnRyeS0+c2l6ZSA8IHNtYWxsZXN0X2VudHJ5LT5zaXplKSB7Cj4gKyAgICAg
ICAgICAgICAgICBzbWFsbGVzdF9lbnRyeSA9IGVudHJ5Owo+ICsgICAgICAgICAgICB9IGVsc2Ug
aWYgKCFzbWFsbGVzdF9lbnRyeSkgewo+ICsgICAgICAgICAgICAgICAgc21hbGxlc3RfZW50cnkg
PSBlbnRyeTsKPiArICAgICAgICAgICAgfQo+ICsgICAgICAgIH0KPiArICAgIH0KPiArCj4gKyAg
ICAvKiBJZiBubyBlbXB0eSBlbnRyaWVzIHdlcmUgZm91bmQsIGV2aWN0ICdzbWFsbGVzdF9lbnRy
eScgYW5kIHJldXNlIGl0ICovCj4gKyAgICBpZiAoIWVudHJ5X3RvX3VzZSAmJiBzbWFsbGVzdF9l
bnRyeSkgewo+ICsgICAgICAgIHNobV9zZWdtZW50X2Rlc3Ryb3koZCwgc21hbGxlc3RfZW50cnkp
Owo+ICsgICAgICAgIGVudHJ5X3RvX3VzZSA9IHNtYWxsZXN0X2VudHJ5Owo+ICsgICAgfQo+ICsK
PiArICAgIGlmIChlbnRyeV90b191c2UpIHsKPiArICAgICAgICAqZW50cnlfdG9fdXNlID0gKnNl
Z21lbnQ7Cj4gKyAgICAgICAgcmV0ID0gMTsKPiArICAgIH0gZWxzZSB7Cj4gKyAgICAgICAgLyog
Q2FjaGUgaXMgZnVsbCwgYW5kIGNvbnRhaW5lZCBubyBlbnRyaWVzIHNtYWxsZXIgdGhhbiB0aGUg
b25lIGJlaW5nIGFkZGVkICovCj4gKyAgICAgICAgcmV0ID0gMDsKPiArICAgIH0KPiArCj4gKyAg
ICBnX211dGV4X3VubG9jaygmZC0+c2htX2NhY2hlX211dGV4KTsKPiArICAgIHJldHVybiByZXQ7
Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIHNobV9jYWNoZV9kZXN0cm95KGRpc3BsYXlfdCAqZCkK
PiArewo+ICsgICAgaW50IGk7Cj4gKwo+ICsgICAgZ19tdXRleF9sb2NrKCZkLT5zaG1fY2FjaGVf
bXV0ZXgpOwo+ICsgICAgZm9yIChpID0gMDsgaSA8IEdfTl9FTEVNRU5UUyhkLT5zaG1fY2FjaGUp
OyBpKyspIHsKPiArICAgICAgICBzaG1fc2VnbWVudF90ICplbnRyeSA9ICZkLT5zaG1fY2FjaGVb
aV07Cj4gKwo+ICsgICAgICAgIHNobV9zZWdtZW50X2Rlc3Ryb3koZCwgZW50cnkpOwo+ICsgICAg
fQo+ICsgICAgZ19tdXRleF91bmxvY2soJmQtPnNobV9jYWNoZV9tdXRleCk7Cj4gK30KPiAgIAo+
ICAgaW50IGRpc3BsYXlfb3BlbihkaXNwbGF5X3QgKmQsIHNlc3Npb25fdCAqc2Vzc2lvbikKPiAg
IHsKPiAgICAgICBpbnQgc2NyOwo+ICAgICAgIGludCByYzsKPiArICAgIGludCBpOwo+ICAgICAg
IHhjYl9kYW1hZ2VfcXVlcnlfdmVyc2lvbl9jb29raWVfdCBkY29va2llOwo+ICAgICAgIHhjYl9k
YW1hZ2VfcXVlcnlfdmVyc2lvbl9yZXBseV90ICpkYW1hZ2VfdmVyc2lvbjsKPiAgICAgICB4Y2Jf
eGtiX3VzZV9leHRlbnNpb25fY29va2llX3QgdXNlX2Nvb2tpZTsKPiBAQCAtMzE0LDYgKzQ2MCwx
MSBAQCBpbnQgZGlzcGxheV9vcGVuKGRpc3BsYXlfdCAqZCwgc2Vzc2lvbl90ICpzZXNzaW9uKQo+
ICAgICAgIGlmIChyYykKPiAgICAgICAgICAgcmV0dXJuIHJjOwo+ICAgCj4gKyAgICBnX211dGV4
X2luaXQoJmQtPnNobV9jYWNoZV9tdXRleCk7Cj4gKyAgICBmb3IgKGkgPSAwOyBpIDwgR19OX0VM
RU1FTlRTKGQtPnNobV9jYWNoZSk7IGkrKykgewo+ICsgICAgICAgIGQtPnNobV9jYWNoZVtpXS5z
aG1pZCA9IC0xOwo+ICsgICAgfQo+ICsKPiAgICAgICByYyA9IGRpc3BsYXlfY3JlYXRlX3NjcmVl
bl9pbWFnZXMoZCk7Cj4gICAKPiAgICAgICBnX21lc3NhZ2UoIkRpc3BsYXkgJXMgb3BlbmVkIiwg
c2Vzc2lvbi0+b3B0aW9ucy5kaXNwbGF5ID8gc2Vzc2lvbi0+b3B0aW9ucy5kaXNwbGF5IDogIiIp
Owo+IEBAIC0zMjEsMTcgKzQ3Miw2IEBAIGludCBkaXNwbGF5X29wZW4oZGlzcGxheV90ICpkLCBz
ZXNzaW9uX3QgKnNlc3Npb24pCj4gICAgICAgcmV0dXJuIHJjOwo+ICAgfQo+ICAgCj4gLS8qCj4g
LSAgVE9ETzogSW1wbGVtZW50IGEgY2FjaGUgZm9yIHNoYXJlZCBtZW1vcnkgaGFuZGxlcwo+IC0g
ICAgICAgIFRoYXQgaXMsIGluc3RlYWQgb2YgZG9pbmcgdGhlIHNobWdldC9zaG1hdCBmb3IgZXZl
cnkgcmVhZCwKPiAtICAgICAgICB3ZSBzaG91bGQgY2FjaGUgdGhlIHNobWlkLCBhbmQgcmV1c2Ug
aWYgd2UncmUgZG9pbmcgYSBsYXRlcgo+IC0gICAgICAgIHJlYWQgb2YgYSBzaW1pbGFyIHNpemUu
Cj4gLQo+IC0gICAgICAgIFdlIHdvdWxkIGxpa2VseSBzZWUgYSA0MCUgaW1wcm92ZW1lbnQgaW4g
cmF3IHJlYWQgdGltZS4gIE5vdGUKPiAtICAgICAgICB0aGF0IGEgY2FsbGdyaW5kIHJ1biBzdWdn
ZXN0ZWQgdGhhdCB3b3VsZCBiZSBvbiB0aGUgb3JkZXIgb2YgNSUKPiAtICAgICAgICBvdmVyYWxs
Lgo+IC0qLwo+IC0KPiAgIHNobV9pbWFnZV90ICpjcmVhdGVfc2htX2ltYWdlKGRpc3BsYXlfdCAq
ZCwgdW5zaWduZWQgaW50IHcsIHVuc2lnbmVkIGludCBoKQo+ICAgewo+ICAgICAgIHNobV9pbWFn
ZV90ICpzaG1pOwo+IEBAIC0zNDksNiArNDg5LDExIEBAIHNobV9pbWFnZV90ICpjcmVhdGVfc2ht
X2ltYWdlKGRpc3BsYXlfdCAqZCwgdW5zaWduZWQgaW50IHcsIHVuc2lnbmVkIGludCBoKQo+ICAg
ICAgIHNobWktPmJ5dGVzX3Blcl9saW5lID0gKGJpdHNfcGVyX3BpeGVsKGQpIC8gOCkgKiBzaG1p
LT53Owo+ICAgICAgIGltZ3NpemUgPSBzaG1pLT5ieXRlc19wZXJfbGluZSAqIHNobWktPmg7Cj4g
ICAKPiArICAgIGlmIChzaG1fY2FjaGVfZ2V0KGQsIGltZ3NpemUsICZzaG1pLT5zZWdtZW50KSkg
ewo+ICsgICAgICAgIHJldHVybiBzaG1pOwo+ICsgICAgfQo+ICsKPiArICAgIC8qIE5vIHVzYWJs
ZSBzaGFyZWQgbWVtb3J5IHNlZ21lbnQgZm91bmQgaW4gY2FjaGUsIGFsbG9jYXRlIGEgbmV3IG9u
ZSAqLwo+ICAgICAgIHNobWktPnNlZ21lbnQuc2htaWQgPSBzaG1nZXQoSVBDX1BSSVZBVEUsIGlt
Z3NpemUsIElQQ19DUkVBVCB8IDA3MDApOwo+ICAgICAgIGlmIChzaG1pLT5zZWdtZW50LnNobWlk
ICE9IC0xKQo+ICAgICAgICAgICBzaG1pLT5zZWdtZW50LnNobWFkZHIgPSBzaG1hdChzaG1pLT5z
ZWdtZW50LnNobWlkLCAwLCAwKTsKPiBAQCAtMzYwLDYgKzUwNSw3IEBAIHNobV9pbWFnZV90ICpj
cmVhdGVfc2htX2ltYWdlKGRpc3BsYXlfdCAqZCwgdW5zaWduZWQgaW50IHcsIHVuc2lnbmVkIGlu
dCBoKQo+ICAgICAgIC8qIFdlIHRlbGwgc2htY3RsIHRvIGRldGFjaCBub3c7IHRoYXQgcHJldmVu
dHMgdXMgZnJvbSBob2xkaW5nIHRoaXMKPiAgICAgICAgICBzaGFyZWQgbWVtb3J5IHNlZ21lbnQg
Zm9yZXZlciBpbiBjYXNlIG9mIGFibm9ybWFsIHByb2Nlc3MgZXhpdC4gKi8KPiAgICAgICBzaG1j
dGwoc2htaS0+c2VnbWVudC5zaG1pZCwgSVBDX1JNSUQsIE5VTEwpOwo+ICsgICAgc2htaS0+c2Vn
bWVudC5zaXplID0gaW1nc2l6ZTsKPiAgIAo+ICAgICAgIHNobWktPnNlZ21lbnQuc2htc2VnID0g
eGNiX2dlbmVyYXRlX2lkKGQtPmMpOwo+ICAgICAgIGNvb2tpZSA9IHhjYl9zaG1fYXR0YWNoX2No
ZWNrZWQoZC0+Yywgc2htaS0+c2VnbWVudC5zaG1zZWcsIHNobWktPnNlZ21lbnQuc2htaWQsIDAp
Owo+IEBAIC00NTEsOSArNTk3LDEwIEBAIHZvaWQgZGlzcGxheV9jb3B5X2ltYWdlX2ludG9fZnVs
bHNjcmVlbihkaXNwbGF5X3QgKmQsIHNobV9pbWFnZV90ICpzaG1pLCBpbnQgeCwKPiAgIAo+ICAg
dm9pZCBkZXN0cm95X3NobV9pbWFnZShkaXNwbGF5X3QgKmQsIHNobV9pbWFnZV90ICpzaG1pKQo+
ICAgewo+IC0gICAgeGNiX3NobV9kZXRhY2goZC0+Yywgc2htaS0+c2VnbWVudC5zaG1zZWcpOwo+
IC0gICAgc2htZHQoc2htaS0+c2VnbWVudC5zaG1hZGRyKTsKPiAtICAgIHNobWN0bChzaG1pLT5z
ZWdtZW50LnNobWlkLCBJUENfUk1JRCwgTlVMTCk7Cj4gKyAgICBpZiAoIXNobV9jYWNoZV9hZGQo
ZCwgJnNobWktPnNlZ21lbnQpKSB7Cj4gKyAgICAgICAgLyogQ291bGQgbm90IGFkZCB0byBjYWNo
ZSwgZGVzdHJveSB0aGlzIHNlZ21lbnQgKi8KPiArICAgICAgICBzaG1fc2VnbWVudF9kZXN0cm95
KGQsICZzaG1pLT5zZWdtZW50KTsKPiArICAgIH0KPiAgICAgICBpZiAoc2htaS0+ZHJhd2FibGVf
cHRyKQo+ICAgICAgICAgICBmcmVlKHNobWktPmRyYXdhYmxlX3B0cik7Cj4gICAgICAgZnJlZShz
aG1pKTsKPiBAQCAtNTAzLDYgKzY1MCw4IEBAIHZvaWQgZGlzcGxheV9zdG9wX2V2ZW50X3RocmVh
ZChkaXNwbGF5X3QgKmQpCj4gICAKPiAgIHZvaWQgZGlzcGxheV9jbG9zZShkaXNwbGF5X3QgKmQp
Cj4gICB7Cj4gKyAgICBzaG1fY2FjaGVfZGVzdHJveShkKTsKPiArICAgIGdfbXV0ZXhfY2xlYXIo
JmQtPnNobV9jYWNoZV9tdXRleCk7Cj4gICAgICAgeGNiX2RhbWFnZV9kZXN0cm95KGQtPmMsIGQt
PmRhbWFnZSk7Cj4gICAgICAgZGlzcGxheV9kZXN0cm95X3NjcmVlbl9pbWFnZXMoZCk7Cj4gICAg
ICAgeGNiX2Rpc2Nvbm5lY3QoZC0+Yyk7Cj4gZGlmZiAtLWdpdCBhL3NyYy9kaXNwbGF5LmggYi9z
cmMvZGlzcGxheS5oCj4gaW5kZXggMDgwOTQ0MS4uYmJmZjAwZiAxMDA2NDQKPiAtLS0gYS9zcmMv
ZGlzcGxheS5oCj4gKysrIGIvc3JjL2Rpc3BsYXkuaAo+IEBAIC0yMSw2ICsyMSw3IEBACj4gICAj
aWZuZGVmIERJU1BMQVlfSF8KPiAgICNkZWZpbmUgRElTUExBWV9IXwo+ICAgCj4gKyNpbmNsdWRl
IDxnbGliLmg+Cj4gICAjaW5jbHVkZSA8eGNiL3hjYi5oPgo+ICAgI2luY2x1ZGUgPHhjYi9kYW1h
Z2UuaD4KPiAgICNpbmNsdWRlIDx4Y2Ivc2htLmg+Cj4gQEAgLTMyLDcgKzMzLDggQEAgc3RydWN0
IHNlc3Npb25fc3RydWN0Owo+ICAgKiogIFN0cnVjdHVyZSBkZWZpbml0aW9ucwo+ICAgKiotLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLSovCj4gICB0eXBlZGVmIHN0cnVjdCB7Cj4gLSAgICBpbnQgc2htaWQ7Cj4g
KyAgICBpbnQgc2htaWQ7ICAgICAgLyogaWYgc2htaWQgaXMgLTE6IHRoZSBzaG1fc2VnbWVudF90
IGlzICJlbXB0eSIsIG90aGVyIG1lbWJlcnMgYXJlIHVuZGVmaW5lZCAqLwo+ICsgICAgc2l6ZV90
IHNpemU7Cj4gICAgICAgeGNiX3NobV9zZWdfdCBzaG1zZWc7Cj4gICAgICAgdm9pZCAqc2htYWRk
cjsKPiAgIH0gc2htX3NlZ21lbnRfdDsKPiBAQCAtNjIsNiArNjQsOSBAQCB0eXBlZGVmIHN0cnVj
dCB7Cj4gICAgICAgc2htX2ltYWdlX3QgKmZ1bGxzY3JlZW47Cj4gICAgICAgc2htX2ltYWdlX3Qg
KnNjYW5saW5lOwo+ICAgCj4gKyAgICBzaG1fc2VnbWVudF90IHNobV9jYWNoZVsxMF07CgpJIHRo
aW5rIHdlIHNob3VsZCBhdCB0aGUgdmVyeSBsZWFzdCBtb3RpdmF0ZSB0aGlzIG1hZ2ljIG51bWJl
ci4gIEknZCBwdXQgCmEgY29tbWVudCBlaXRoZXIgaGVyZSwgb3Igd2l0aCBhICNkZWZpbmUgZnVy
dGhlciB1cCwgZXhwbGFpbmluZyB3aHkgMTAuCgpDaGVlcnMsCgpKZXJlbXkKCj4gKyAgICBHTXV0
ZXggc2htX2NhY2hlX211dGV4Owo+ICsKPiAgICAgICBwdGhyZWFkX3QgZXZlbnRfdGhyZWFkOwo+
ICAgICAgIHN0cnVjdCBzZXNzaW9uX3N0cnVjdCAqc2Vzc2lvbjsKPiAgIH0gZGlzcGxheV90Owo+
IAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KU3BpY2Ut
ZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
