Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id CE12827823
	for <lists+spice-devel@lfdr.de>; Thu, 23 May 2019 10:37:57 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6954689D4A;
	Thu, 23 May 2019 08:37:56 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6A1FA89D46
 for <spice-devel@lists.freedesktop.org>; Thu, 23 May 2019 08:37:54 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx04.intmail.prod.int.phx2.redhat.com
 [10.5.11.14])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id D4B33302451A
 for <spice-devel@lists.freedesktop.org>; Thu, 23 May 2019 08:37:53 +0000 (UTC)
Received: from jjanku-t480s.redhat.com (unknown [10.40.205.144])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 018D15D9C3;
 Thu, 23 May 2019 08:37:52 +0000 (UTC)
From: =?UTF-8?q?Jakub=20Jank=C5=AF?= <jjanku@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Thu, 23 May 2019 10:37:23 +0200
Message-Id: <20190523083725.1554-12-jjanku@redhat.com>
In-Reply-To: <20190523083725.1554-1-jjanku@redhat.com>
References: <20190523083725.1554-1-jjanku@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.14
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.49]); Thu, 23 May 2019 08:37:53 +0000 (UTC)
Subject: [Spice-devel] [PATCH phodav 11/13] spice: move OutputQueue to file
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

T3V0cHV0UXVldWUgaXMgYSBzZWxmLWNvbnRhaW5lZCB1bml0IGFuZCBhcyBzdWNoIGNhbiBiZSBw
dXQgaW4KYSBzZXBhcmF0ZSBmaWxlIHRvIG1ha2UgdGhlIHNwaWNlLXdlYmRhdmQuYyBsZXNzIGNs
dXR0ZXJlZC4KCkFsc28sIGFzIHRoZSBjdXJyZW50IGltcGxlbWVudGF0aW9uIGRlZmluZXMgb3V0
cHV0X3F1ZXVlX3tyZWYsIHVucmVmfSwKdHVybiBPdXRwdXRRdWV1ZSBpbnRvIGEgR09iamVjdCB3
aGljaCBjYW4gaGFuZGxlIHRoZXNlIGZvciB1cy4KClNpZ25lZC1vZmYtYnk6IEpha3ViIEphbmvF
ryA8amphbmt1QHJlZGhhdC5jb20+Ci0tLQogc3BpY2UvbWVzb24uYnVpbGQgICAgIHwgICA4ICsr
LQogc3BpY2Uvb3V0cHV0LXF1ZXVlLmMgIHwgMTY0ICsrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKwogc3BpY2Uvb3V0cHV0LXF1ZXVlLmggIHwgIDM4ICsrKysrKysrKysK
IHNwaWNlL3NwaWNlLXdlYmRhdmQuYyB8IDE2MiArKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLQogNCBmaWxlcyBjaGFuZ2VkLCAyMTQgaW5zZXJ0aW9ucygrKSwgMTU4IGRl
bGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IHNwaWNlL291dHB1dC1xdWV1ZS5jCiBjcmVh
dGUgbW9kZSAxMDA2NDQgc3BpY2Uvb3V0cHV0LXF1ZXVlLmgKCmRpZmYgLS1naXQgYS9zcGljZS9t
ZXNvbi5idWlsZCBiL3NwaWNlL21lc29uLmJ1aWxkCmluZGV4IDZkYjIyY2MuLjA2ZDIwZTYgMTAw
NjQ0Ci0tLSBhL3NwaWNlL21lc29uLmJ1aWxkCisrKyBiL3NwaWNlL21lc29uLmJ1aWxkCkBAIC00
LDkgKzQsMTUgQEAgaWYgaG9zdF9tYWNoaW5lLnN5c3RlbSgpID09ICd3aW5kb3dzJwogICB3aW4z
Ml9kZXBzICs9IGNvbXBpbGVyLmZpbmRfbGlicmFyeSgnbXByJykKIGVuZGlmCiAKK3NvdXJjZXMg
PSBbCisgICdzcGljZS13ZWJkYXZkLmMnLAorICAnb3V0cHV0LXF1ZXVlLmMnLAorICAnb3V0cHV0
LXF1ZXVlLmgnCitdCisKIGV4ZWN1dGFibGUoCiAgICdzcGljZS13ZWJkYXZkJywKLSAgWyAnc3Bp
Y2Utd2ViZGF2ZC5jJyBdLAorICBzb3VyY2VzLAogICBpbnN0YWxsX2RpciA6IHNiaW5kaXIsCiAg
IGluY2x1ZGVfZGlyZWN0b3JpZXMgOiBpbmNkaXIsCiAgIGRlcGVuZGVuY2llcyA6IHdpbjMyX2Rl
cHMgKyBhdmFoaV9kZXBzICsgZGVwcywKZGlmZiAtLWdpdCBhL3NwaWNlL291dHB1dC1xdWV1ZS5j
IGIvc3BpY2Uvb3V0cHV0LXF1ZXVlLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAw
MC4uNjk5MTQ5MwotLS0gL2Rldi9udWxsCisrKyBiL3NwaWNlL291dHB1dC1xdWV1ZS5jCkBAIC0w
LDAgKzEsMTY0IEBACisvKgorICogQ29weXJpZ2h0IChDKSAyMDE5IFJlZCBIYXQsIEluYy4KKyAq
CisgKiBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUg
aXQgYW5kL29yCisgKiBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgTGVzc2Vy
IEdlbmVyYWwgUHVibGljCisgKiBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0
d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIKKyAqIHZlcnNpb24gMi4xIG9mIHRoZSBMaWNlbnNlLCBv
ciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgorICoKKyAqIFRoaXMgbGlicmFy
eSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAorICog
YnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFu
dHkgb2YKKyAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVS
UE9TRS4gIFNlZSB0aGUgR05VCisgKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3Ig
bW9yZSBkZXRhaWxzLgorICoKKyAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2Yg
dGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKKyAqIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlz
IGxpYnJhcnk7IGlmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KKyAq
LworI2luY2x1ZGUgPGNvbmZpZy5oPgorCisjaW5jbHVkZSAib3V0cHV0LXF1ZXVlLmgiCisKK3R5
cGVkZWYgc3RydWN0IF9PdXRwdXRRdWV1ZUVsZW0KK3sKKyAgT3V0cHV0UXVldWUgICpxdWV1ZTsK
KyAgY29uc3QgZ3VpbnQ4ICpidWY7CisgIGdzaXplICAgICAgICAgc2l6ZTsKKyAgUHVzaGVkQ2Ig
ICAgICBjYjsKKyAgZ3BvaW50ZXIgICAgICB1c2VyX2RhdGE7Cit9IE91dHB1dFF1ZXVlRWxlbTsK
Kworc3RydWN0IF9PdXRwdXRRdWV1ZQoreworICBHT2JqZWN0ICAgICAgICBwYXJlbnRfaW5zdGFu
Y2U7CisgIEdPdXRwdXRTdHJlYW0gKm91dHB1dDsKKyAgZ2Jvb2xlYW4gICAgICAgZmx1c2hpbmc7
CisgIGd1aW50ICAgICAgICAgIGlkbGVfaWQ7CisgIEdRdWV1ZSAgICAgICAgKnF1ZXVlOworICBH
Q2FuY2VsbGFibGUgICpjYW5jZWw7Cit9OworCitHX0RFRklORV9UWVBFKE91dHB1dFF1ZXVlLCBv
dXRwdXRfcXVldWUsIEdfVFlQRV9PQkpFQ1QpOworCitzdGF0aWMgdm9pZCBvdXRwdXRfcXVldWVf
aW5pdChPdXRwdXRRdWV1ZSAqc2VsZikKK3sKKyAgICBzZWxmLT5xdWV1ZSA9IGdfcXVldWVfbmV3
ICgpOworfQorCitzdGF0aWMgdm9pZCBvdXRwdXRfcXVldWVfZmluYWxpemUoR09iamVjdCAqb2Jq
KQoreworICAgIE91dHB1dFF1ZXVlICpzZWxmID0gT1VUUFVUX1FVRVVFKG9iaik7CisKKyAgICBn
X3dhcm5faWZfZmFpbCAoZ19xdWV1ZV9nZXRfbGVuZ3RoIChzZWxmLT5xdWV1ZSkgPT0gMCk7Cisg
ICAgZ193YXJuX2lmX2ZhaWwgKCFzZWxmLT5mbHVzaGluZyk7CisgICAgZ193YXJuX2lmX2ZhaWwg
KCFzZWxmLT5pZGxlX2lkKTsKKworICAgIGdfcXVldWVfZnJlZV9mdWxsIChzZWxmLT5xdWV1ZSwg
Z19mcmVlKTsKKyAgICBnX29iamVjdF91bnJlZiAoc2VsZi0+b3V0cHV0KTsKKyAgICBnX29iamVj
dF91bnJlZiAoc2VsZi0+Y2FuY2VsKTsKKworICAgIEdfT0JKRUNUX0NMQVNTKG91dHB1dF9xdWV1
ZV9wYXJlbnRfY2xhc3MpLT5maW5hbGl6ZShvYmopOworfQorCitzdGF0aWMgdm9pZCBvdXRwdXRf
cXVldWVfY2xhc3NfaW5pdChPdXRwdXRRdWV1ZUNsYXNzICprbGFzcykKK3sKKyAgICBHT2JqZWN0
Q2xhc3MgKmdvYmplY3RfY2xhc3MgPSBHX09CSkVDVF9DTEFTUyhrbGFzcyk7CisgICAgZ29iamVj
dF9jbGFzcy0+ZmluYWxpemUgPSBvdXRwdXRfcXVldWVfZmluYWxpemU7Cit9CisKK091dHB1dFF1
ZXVlKiBvdXRwdXRfcXVldWVfbmV3IChHT3V0cHV0U3RyZWFtICpvdXRwdXQsIEdDYW5jZWxsYWJs
ZSAqY2FuY2VsKQoreworICBPdXRwdXRRdWV1ZSAqc2VsZiA9IGdfb2JqZWN0X25ldyhPVVRQVVRf
VFlQRV9RVUVVRSwgTlVMTCk7CisgIHNlbGYtPm91dHB1dCA9IGdfb2JqZWN0X3JlZiAob3V0cHV0
KTsKKyAgc2VsZi0+Y2FuY2VsID0gZ19vYmplY3RfcmVmIChjYW5jZWwpOworICByZXR1cm4gc2Vs
ZjsKK30KKworc3RhdGljIGdib29sZWFuIG91dHB1dF9xdWV1ZV9pZGxlIChncG9pbnRlciB1c2Vy
X2RhdGEpOworCitzdGF0aWMgdm9pZAorb3V0cHV0X3F1ZXVlX2ZsdXNoX2NiIChHT2JqZWN0ICAg
ICAgKnNvdXJjZV9vYmplY3QsCisgICAgICAgICAgICAgICAgICAgICAgIEdBc3luY1Jlc3VsdCAq
cmVzLAorICAgICAgICAgICAgICAgICAgICAgICBncG9pbnRlciAgICAgIHVzZXJfZGF0YSkKK3sK
KyAgR0Vycm9yICplcnJvciA9IE5VTEw7CisgIE91dHB1dFF1ZXVlRWxlbSAqZSA9IHVzZXJfZGF0
YTsKKyAgT3V0cHV0UXVldWUgKnEgPSBlLT5xdWV1ZTsKKworICBnX2RlYnVnICgiZmx1c2hlZCIp
OworICBxLT5mbHVzaGluZyA9IEZBTFNFOworICBnX291dHB1dF9zdHJlYW1fZmx1c2hfZmluaXNo
IChHX09VVFBVVF9TVFJFQU0gKHNvdXJjZV9vYmplY3QpLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICByZXMsICZlcnJvcik7CisgIGlmIChlcnJvcikKKyAgICBnX3dhcm5pbmcgKCJl
cnJvcjogJXMiLCBlcnJvci0+bWVzc2FnZSk7CisKKyAgZ19jbGVhcl9lcnJvciAoJmVycm9yKTsK
KworICBpZiAoIXEtPmlkbGVfaWQpCisgICAgcS0+aWRsZV9pZCA9IGdfaWRsZV9hZGQgKG91dHB1
dF9xdWV1ZV9pZGxlLCBnX29iamVjdF9yZWYgKHEpKTsKKworICBnX2ZyZWUgKGUpOworICBnX29i
amVjdF91bnJlZiAocSk7Cit9CisKK3N0YXRpYyBnYm9vbGVhbgorb3V0cHV0X3F1ZXVlX2lkbGUg
KGdwb2ludGVyIHVzZXJfZGF0YSkKK3sKKyAgT3V0cHV0UXVldWUgKnEgPSB1c2VyX2RhdGE7Cisg
IE91dHB1dFF1ZXVlRWxlbSAqZSA9IE5VTEw7CisgIEdFcnJvciAqZXJyb3IgPSBOVUxMOworCisg
IGlmIChxLT5mbHVzaGluZykKKyAgICB7CisgICAgICBnX2RlYnVnICgiYWxyZWFkeSBmbHVzaGlu
ZyIpOworICAgICAgZ290byBlbmQ7CisgICAgfQorCisgIGUgPSBnX3F1ZXVlX3BvcF9oZWFkIChx
LT5xdWV1ZSk7CisgIGlmICghZSkKKyAgICB7CisgICAgICBnX2RlYnVnICgiTm8gbW9yZSBkYXRh
IHRvIGZsdXNoIik7CisgICAgICBnb3RvIGVuZDsKKyAgICB9CisKKyAgZ19kZWJ1ZyAoImZsdXNo
aW5nICUiIEdfR1NJWkVfRk9STUFULCBlLT5zaXplKTsKKyAgZ19vdXRwdXRfc3RyZWFtX3dyaXRl
X2FsbCAocS0+b3V0cHV0LCBlLT5idWYsIGUtPnNpemUsIE5VTEwsIHEtPmNhbmNlbCwgJmVycm9y
KTsKKyAgaWYgKGUtPmNiKQorICAgIGUtPmNiIChxLCBlLT51c2VyX2RhdGEsIGVycm9yKTsKKwor
ICBpZiAoZXJyb3IpCisgICAgICBnb3RvIGVuZDsKKworICBxLT5mbHVzaGluZyA9IFRSVUU7Cisg
IGdfb3V0cHV0X3N0cmVhbV9mbHVzaF9hc3luYyAocS0+b3V0cHV0LCBHX1BSSU9SSVRZX0RFRkFV
TFQsIHEtPmNhbmNlbCwgb3V0cHV0X3F1ZXVlX2ZsdXNoX2NiLCBlKTsKKworICBxLT5pZGxlX2lk
ID0gMDsKKyAgcmV0dXJuIEZBTFNFOworCitlbmQ6CisgIGdfY2xlYXJfZXJyb3IgKCZlcnJvcik7
CisgIHEtPmlkbGVfaWQgPSAwOworICBnX2ZyZWUgKGUpOworICBnX29iamVjdF91bnJlZiAocSk7
CisKKyAgcmV0dXJuIEZBTFNFOworfQorCit2b2lkCitvdXRwdXRfcXVldWVfcHVzaCAoT3V0cHV0
UXVldWUgKnEsIGNvbnN0IGd1aW50OCAqYnVmLCBnc2l6ZSBzaXplLAorICAgICAgICAgICAgICAg
ICAgIFB1c2hlZENiIHB1c2hlZF9jYiwgZ3BvaW50ZXIgdXNlcl9kYXRhKQoreworICBPdXRwdXRR
dWV1ZUVsZW0gKmU7CisKKyAgZ19yZXR1cm5faWZfZmFpbCAocSAhPSBOVUxMKTsKKworICBlID0g
Z19uZXcgKE91dHB1dFF1ZXVlRWxlbSwgMSk7CisgIGUtPmJ1ZiA9IGJ1ZjsKKyAgZS0+c2l6ZSA9
IHNpemU7CisgIGUtPmNiID0gcHVzaGVkX2NiOworICBlLT51c2VyX2RhdGEgPSB1c2VyX2RhdGE7
CisgIGUtPnF1ZXVlID0gcTsKKyAgZ19xdWV1ZV9wdXNoX3RhaWwgKHEtPnF1ZXVlLCBlKTsKKwor
ICBpZiAoIXEtPmlkbGVfaWQgJiYgIXEtPmZsdXNoaW5nKQorICAgIHEtPmlkbGVfaWQgPSBnX2lk
bGVfYWRkIChvdXRwdXRfcXVldWVfaWRsZSwgZ19vYmplY3RfcmVmIChxKSk7Cit9CmRpZmYgLS1n
aXQgYS9zcGljZS9vdXRwdXQtcXVldWUuaCBiL3NwaWNlL291dHB1dC1xdWV1ZS5oCm5ldyBmaWxl
IG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAuLmFiOGY2ZWIKLS0tIC9kZXYvbnVsbAorKysgYi9z
cGljZS9vdXRwdXQtcXVldWUuaApAQCAtMCwwICsxLDM4IEBACisvKgorICogQ29weXJpZ2h0IChD
KSAyMDE5IFJlZCBIYXQsIEluYy4KKyAqCisgKiBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2Fy
ZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCisgKiBtb2RpZnkgaXQgdW5kZXIgdGhl
IHRlcm1zIG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCisgKiBMaWNlbnNlIGFzIHB1
Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIKKyAqIHZlcnNp
b24gMi4xIG9mIHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJz
aW9uLgorICoKKyAqIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0
IGl0IHdpbGwgYmUgdXNlZnVsLAorICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0
IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKKyAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRO
RVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUgR05VCisgKiBMZXNzZXIgR2Vu
ZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgorICoKKyAqIFlvdSBzaG91bGQg
aGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKKyAq
IExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgc2VlIDxodHRwOi8vd3d3
LmdudS5vcmcvbGljZW5zZXMvPi4KKyAqLworCisjaWZuZGVmIF9fT1VUUFVUX1FVRVVFX0gKKyNk
ZWZpbmUgX19PVVRQVVRfUVVFVUVfSAorCisjaW5jbHVkZSA8Z2lvL2dpby5oPgorI2luY2x1ZGUg
PGdsaWItb2JqZWN0Lmg+CisKK0dfQkVHSU5fREVDTFMKKworI2RlZmluZSBPVVRQVVRfVFlQRV9R
VUVVRSBvdXRwdXRfcXVldWVfZ2V0X3R5cGUoKQorR19ERUNMQVJFX0ZJTkFMX1RZUEUoT3V0cHV0
UXVldWUsIG91dHB1dF9xdWV1ZSwgT1VUUFVULCBRVUVVRSwgR09iamVjdCk7CisKK091dHB1dFF1
ZXVlKiBvdXRwdXRfcXVldWVfbmV3IChHT3V0cHV0U3RyZWFtICpvdXRwdXQsIEdDYW5jZWxsYWJs
ZSAqY2FuY2VsKTsKKwordHlwZWRlZiB2b2lkICgqUHVzaGVkQ2IpIChPdXRwdXRRdWV1ZSAqcSwg
Z3BvaW50ZXIgdXNlcl9kYXRhLCBHRXJyb3IgKmVycm9yKTsKKwordm9pZCBvdXRwdXRfcXVldWVf
cHVzaCAoT3V0cHV0UXVldWUgKnEsIGNvbnN0IGd1aW50OCAqYnVmLCBnc2l6ZSBzaXplLAorICAg
ICAgICAgICAgICAgICAgICAgICAgUHVzaGVkQ2IgcHVzaGVkX2NiLCBncG9pbnRlciB1c2VyX2Rh
dGEpOworCitHX0VORF9ERUNMUworCisjZW5kaWYKZGlmZiAtLWdpdCBhL3NwaWNlL3NwaWNlLXdl
YmRhdmQuYyBiL3NwaWNlL3NwaWNlLXdlYmRhdmQuYwppbmRleCBmMmM3ZjA3Li44NGFiNzcwIDEw
MDY0NAotLS0gYS9zcGljZS9zcGljZS13ZWJkYXZkLmMKKysrIGIvc3BpY2Uvc3BpY2Utd2ViZGF2
ZC5jCkBAIC0zOSwyNSArMzksNyBAQAogI2luY2x1ZGUgPGF2YWhpLWdvYmplY3QvZ2EtZW50cnkt
Z3JvdXAuaD4KICNlbmRpZgogCi10eXBlZGVmIHN0cnVjdCBfT3V0cHV0UXVldWUKLXsKLSAgZ3Vp
bnQgICAgICAgICAgcmVmczsKLSAgR091dHB1dFN0cmVhbSAqb3V0cHV0OwotICBnYm9vbGVhbiAg
ICAgICBmbHVzaGluZzsKLSAgZ3VpbnQgICAgICAgICAgaWRsZV9pZDsKLSAgR1F1ZXVlICAgICAg
ICAqcXVldWU7Ci19IE91dHB1dFF1ZXVlOwotCi10eXBlZGVmIHZvaWQgKCpQdXNoZWRDYikgKE91
dHB1dFF1ZXVlICpxLCBncG9pbnRlciB1c2VyX2RhdGEsIEdFcnJvciAqZXJyb3IpOwotCi10eXBl
ZGVmIHN0cnVjdCBfT3V0cHV0UXVldWVFbGVtCi17Ci0gIE91dHB1dFF1ZXVlICAqcXVldWU7Ci0g
IGNvbnN0IGd1aW50OCAqYnVmOwotICBnc2l6ZSAgICAgICAgIHNpemU7Ci0gIFB1c2hlZENiICAg
ICAgY2I7Ci0gIGdwb2ludGVyICAgICAgdXNlcl9kYXRhOwotfSBPdXRwdXRRdWV1ZUVsZW07Cisj
aW5jbHVkZSAib3V0cHV0LXF1ZXVlLmgiCiAKIHR5cGVkZWYgc3RydWN0IF9TZXJ2aWNlRGF0YQog
ewpAQCAtNjksMTM5ICs1MSw2IEBAIHR5cGVkZWYgc3RydWN0IF9TZXJ2aWNlRGF0YQogCiBzdGF0
aWMgR0NhbmNlbGxhYmxlICpjYW5jZWw7CiAKLXN0YXRpYyBPdXRwdXRRdWV1ZSoKLW91dHB1dF9x
dWV1ZV9uZXcgKEdPdXRwdXRTdHJlYW0gKm91dHB1dCkKLXsKLSAgT3V0cHV0UXVldWUgKnF1ZXVl
ID0gZ19uZXcwIChPdXRwdXRRdWV1ZSwgMSk7Ci0KLSAgcXVldWUtPm91dHB1dCA9IGdfb2JqZWN0
X3JlZiAob3V0cHV0KTsKLSAgcXVldWUtPnF1ZXVlID0gZ19xdWV1ZV9uZXcgKCk7Ci0gIHF1ZXVl
LT5yZWZzID0gMTsKLQotICByZXR1cm4gcXVldWU7Ci19Ci0KLXN0YXRpYwotdm9pZAotb3V0cHV0
X3F1ZXVlX2ZyZWUgKE91dHB1dFF1ZXVlICpxdWV1ZSkKLXsKLSAgZ193YXJuX2lmX2ZhaWwgKGdf
cXVldWVfZ2V0X2xlbmd0aCAocXVldWUtPnF1ZXVlKSA9PSAwKTsKLSAgZ193YXJuX2lmX2ZhaWwg
KCFxdWV1ZS0+Zmx1c2hpbmcpOwotICBnX3dhcm5faWZfZmFpbCAoIXF1ZXVlLT5pZGxlX2lkKTsK
LQotICBnX3F1ZXVlX2ZyZWVfZnVsbCAocXVldWUtPnF1ZXVlLCBnX2ZyZWUpOwotICBnX2NsZWFy
X29iamVjdCAoJnF1ZXVlLT5vdXRwdXQpOwotICBnX2ZyZWUgKHF1ZXVlKTsKLX0KLQotc3RhdGlj
IE91dHB1dFF1ZXVlKgotb3V0cHV0X3F1ZXVlX3JlZiAoT3V0cHV0UXVldWUgKnEpCi17Ci0gIHEt
PnJlZnMrKzsKLSAgcmV0dXJuIHE7Ci19Ci0KLXN0YXRpYyB2b2lkCi1vdXRwdXRfcXVldWVfdW5y
ZWYgKE91dHB1dFF1ZXVlICpxKQotewotICBnX3JldHVybl9pZl9mYWlsIChxICE9IE5VTEwpOwot
Ci0gIHEtPnJlZnMtLTsKLSAgaWYgKHEtPnJlZnMgPT0gMCkKLSAgICBvdXRwdXRfcXVldWVfZnJl
ZSAocSk7Ci19Ci0KLXN0YXRpYyBnYm9vbGVhbiBvdXRwdXRfcXVldWVfaWRsZSAoZ3BvaW50ZXIg
dXNlcl9kYXRhKTsKLQotc3RhdGljIHZvaWQKLW91dHB1dF9xdWV1ZV9mbHVzaF9jYiAoR09iamVj
dCAgICAgICpzb3VyY2Vfb2JqZWN0LAotICAgICAgICAgICAgICAgICAgICAgICBHQXN5bmNSZXN1
bHQgKnJlcywKLSAgICAgICAgICAgICAgICAgICAgICAgZ3BvaW50ZXIgICAgICB1c2VyX2RhdGEp
Ci17Ci0gIEdFcnJvciAqZXJyb3IgPSBOVUxMOwotICBPdXRwdXRRdWV1ZUVsZW0gKmUgPSB1c2Vy
X2RhdGE7Ci0gIE91dHB1dFF1ZXVlICpxID0gZS0+cXVldWU7Ci0KLSAgZ19kZWJ1ZyAoImZsdXNo
ZWQiKTsKLSAgcS0+Zmx1c2hpbmcgPSBGQUxTRTsKLSAgZ19vdXRwdXRfc3RyZWFtX2ZsdXNoX2Zp
bmlzaCAoR19PVVRQVVRfU1RSRUFNIChzb3VyY2Vfb2JqZWN0KSwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgcmVzLCAmZXJyb3IpOwotICBpZiAoZXJyb3IpCi0gICAgZ193YXJuaW5n
ICgiZXJyb3I6ICVzIiwgZXJyb3ItPm1lc3NhZ2UpOwotCi0gIGdfY2xlYXJfZXJyb3IgKCZlcnJv
cik7Ci0KLSAgaWYgKCFxLT5pZGxlX2lkKQotICAgIHEtPmlkbGVfaWQgPSBnX2lkbGVfYWRkIChv
dXRwdXRfcXVldWVfaWRsZSwgb3V0cHV0X3F1ZXVlX3JlZiAocSkpOwotCi0gIGdfZnJlZSAoZSk7
Ci0gIG91dHB1dF9xdWV1ZV91bnJlZiAocSk7Ci19Ci0KLXN0YXRpYyBnYm9vbGVhbgotb3V0cHV0
X3F1ZXVlX2lkbGUgKGdwb2ludGVyIHVzZXJfZGF0YSkKLXsKLSAgT3V0cHV0UXVldWUgKnEgPSB1
c2VyX2RhdGE7Ci0gIE91dHB1dFF1ZXVlRWxlbSAqZSA9IE5VTEw7Ci0gIEdFcnJvciAqZXJyb3Ig
PSBOVUxMOwotCi0gIGlmIChxLT5mbHVzaGluZykKLSAgICB7Ci0gICAgICBnX2RlYnVnICgiYWxy
ZWFkeSBmbHVzaGluZyIpOwotICAgICAgZ290byBlbmQ7Ci0gICAgfQotCi0gIGUgPSBnX3F1ZXVl
X3BvcF9oZWFkIChxLT5xdWV1ZSk7Ci0gIGlmICghZSkKLSAgICB7Ci0gICAgICBnX2RlYnVnICgi
Tm8gbW9yZSBkYXRhIHRvIGZsdXNoIik7Ci0gICAgICBnb3RvIGVuZDsKLSAgICB9Ci0KLSAgZ19k
ZWJ1ZyAoImZsdXNoaW5nICUiIEdfR1NJWkVfRk9STUFULCBlLT5zaXplKTsKLSAgZ19vdXRwdXRf
c3RyZWFtX3dyaXRlX2FsbCAocS0+b3V0cHV0LCBlLT5idWYsIGUtPnNpemUsIE5VTEwsIGNhbmNl
bCwgJmVycm9yKTsKLSAgaWYgKGUtPmNiKQotICAgIGUtPmNiIChxLCBlLT51c2VyX2RhdGEsIGVy
cm9yKTsKLQotICBpZiAoZXJyb3IpCi0gICAgICBnb3RvIGVuZDsKLQotICBxLT5mbHVzaGluZyA9
IFRSVUU7Ci0gIGdfb3V0cHV0X3N0cmVhbV9mbHVzaF9hc3luYyAocS0+b3V0cHV0LCBHX1BSSU9S
SVRZX0RFRkFVTFQsIGNhbmNlbCwgb3V0cHV0X3F1ZXVlX2ZsdXNoX2NiLCBlKTsKLQotICBxLT5p
ZGxlX2lkID0gMDsKLSAgcmV0dXJuIEZBTFNFOwotCi1lbmQ6Ci0gIGdfY2xlYXJfZXJyb3IgKCZl
cnJvcik7Ci0gIHEtPmlkbGVfaWQgPSAwOwotICBnX2ZyZWUgKGUpOwotICBvdXRwdXRfcXVldWVf
dW5yZWYgKHEpOwotCi0gIHJldHVybiBGQUxTRTsKLX0KLQotc3RhdGljIHZvaWQKLW91dHB1dF9x
dWV1ZV9wdXNoIChPdXRwdXRRdWV1ZSAqcSwgY29uc3QgZ3VpbnQ4ICpidWYsIGdzaXplIHNpemUs
Ci0gICAgICAgICAgICAgICAgICAgUHVzaGVkQ2IgcHVzaGVkX2NiLCBncG9pbnRlciB1c2VyX2Rh
dGEpCi17Ci0gIE91dHB1dFF1ZXVlRWxlbSAqZTsKLQotICBnX3JldHVybl9pZl9mYWlsIChxICE9
IE5VTEwpOwotCi0gIGUgPSBnX25ldyAoT3V0cHV0UXVldWVFbGVtLCAxKTsKLSAgZS0+YnVmID0g
YnVmOwotICBlLT5zaXplID0gc2l6ZTsKLSAgZS0+Y2IgPSBwdXNoZWRfY2I7Ci0gIGUtPnVzZXJf
ZGF0YSA9IHVzZXJfZGF0YTsKLSAgZS0+cXVldWUgPSBxOwotICBnX3F1ZXVlX3B1c2hfdGFpbCAo
cS0+cXVldWUsIGUpOwotCi0gIGlmICghcS0+aWRsZV9pZCAmJiAhcS0+Zmx1c2hpbmcpCi0gICAg
cS0+aWRsZV9pZCA9IGdfaWRsZV9hZGQgKG91dHB1dF9xdWV1ZV9pZGxlLCBvdXRwdXRfcXVldWVf
cmVmIChxKSk7Ci19Ci0KLQogc3RhdGljIHN0cnVjdCBfRGVtdXhEYXRhCiB7CiAgIGdpbnQ2NCAg
Y2xpZW50OwpAQCAtMjY0LDcgKzExMyw3IEBAIGFkZF9jbGllbnQgKEdTb2NrZXRDb25uZWN0aW9u
ICpjbGllbnRfY29ubmVjdGlvbikKICAgY2xpZW50LT5jbGllbnRfY29ubmVjdGlvbiA9IGdfb2Jq
ZWN0X3JlZiAoY2xpZW50X2Nvbm5lY3Rpb24pOwogICAvLyBUT0RPOiBjaGVjayBpZiB1c2FnZSBv
ZiB0aGlzIGlkaW9tIGlzIHBvcnRhYmxlLCBvciBpZiB3ZSBuZWVkIHRvIGNoZWNrIGNvbGxpc2lv
bnMKICAgY2xpZW50LT5pZCA9IEdQT0lOVEVSX1RPX0lOVCAoY2xpZW50X2Nvbm5lY3Rpb24pOwot
ICBjbGllbnQtPnF1ZXVlID0gb3V0cHV0X3F1ZXVlX25ldyAoYm9zdHJlYW0pOworICBjbGllbnQt
PnF1ZXVlID0gb3V0cHV0X3F1ZXVlX25ldyAoYm9zdHJlYW0sIGNhbmNlbCk7CiAgIGdfb2JqZWN0
X3VucmVmIChib3N0cmVhbSk7CiAKICAgZ19oYXNoX3RhYmxlX2luc2VydCAoY2xpZW50cywgJmNs
aWVudC0+aWQsIGNsaWVudCk7CkBAIC0yODAsNyArMTI5LDcgQEAgY2xpZW50X2ZyZWUgKENsaWVu
dCAqYykKIAogICBnX2lvX3N0cmVhbV9jbG9zZSAoR19JT19TVFJFQU0gKGMtPmNsaWVudF9jb25u
ZWN0aW9uKSwgTlVMTCwgTlVMTCk7CiAgIGdfb2JqZWN0X3VucmVmIChjLT5jbGllbnRfY29ubmVj
dGlvbik7Ci0gIG91dHB1dF9xdWV1ZV91bnJlZiAoYy0+cXVldWUpOworICBnX29iamVjdF91bnJl
ZiAoYy0+cXVldWUpOwogICBnX2ZyZWUgKGMpOwogfQogCkBAIC03MzIsNyArNTgxLDcgQEAgb3Bl
bl9tdXhfcGF0aCAoY29uc3QgY2hhciAqcGF0aCkKICAgbXV4X2lzdHJlYW0gPSBHX0lOUFVUX1NU
UkVBTSAoZ193aW4zMl9pbnB1dF9zdHJlYW1fbmV3IChwb3J0X2hhbmRsZSwgVFJVRSkpOwogI2Vu
ZGlmCiAKLSAgbXV4X3F1ZXVlID0gb3V0cHV0X3F1ZXVlX25ldyAoR19PVVRQVVRfU1RSRUFNICht
dXhfb3N0cmVhbSkpOworICBtdXhfcXVldWUgPSBvdXRwdXRfcXVldWVfbmV3IChHX09VVFBVVF9T
VFJFQU0gKG11eF9vc3RyZWFtKSwgY2FuY2VsKTsKIH0KIAogI2lmZGVmIEdfT1NfV0lOMzIKQEAg
LTEwMDIsMTIgKzg1MSwxMSBAQCBydW5fc2VydmljZSAoU2VydmljZURhdGEgKnNlcnZpY2VfZGF0
YSkKICAgZ19jbGVhcl9vYmplY3QgKCZtdXhfaXN0cmVhbSk7CiAgIGdfY2xlYXJfb2JqZWN0ICgm
bXV4X29zdHJlYW0pOwogCi0gIG91dHB1dF9xdWV1ZV91bnJlZiAobXV4X3F1ZXVlKTsKKyAgZ19j
bGVhcl9vYmplY3QgKCZtdXhfcXVldWUpOwogICBnX2hhc2hfdGFibGVfdW5yZWYgKGNsaWVudHMp
OwogCiAgIGdfc29ja2V0X3NlcnZpY2Vfc3RvcCAoc29ja2V0X3NlcnZpY2UpOwogCi0gIG11eF9x
dWV1ZSA9IE5VTEw7CiAgIGdfY2xlYXJfb2JqZWN0ICgmY2FuY2VsKTsKIAogI2lmZGVmIEdfT1Nf
V0lOMzIKLS0gCjIuMjEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KU3BpY2UtZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVk
ZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L3NwaWNlLWRldmVs
