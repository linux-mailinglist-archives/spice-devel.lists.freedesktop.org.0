Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3933571B29
	for <lists+spice-devel@lfdr.de>; Tue, 23 Jul 2019 17:14:04 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7F0F489D8D;
	Tue, 23 Jul 2019 15:14:02 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail-wm1-x32a.google.com (mail-wm1-x32a.google.com
 [IPv6:2a00:1450:4864:20::32a])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CDF7F89D8D
 for <spice-devel@lists.freedesktop.org>; Tue, 23 Jul 2019 15:14:00 +0000 (UTC)
Received: by mail-wm1-x32a.google.com with SMTP id a15so38939855wmj.5
 for <spice-devel@lists.freedesktop.org>; Tue, 23 Jul 2019 08:14:00 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=miv1sFA1W4zQ17QwQyDnTE/FplCd4fmswcEhv2sXWag=;
 b=rwvlDt0dfn6ea+cqaZzJAnw0cm7Hr5K8RKKFnOTepWZ2My9hFDY78TnWrI8bBbGvnA
 kEmojV5cPf8NIDX+oStRSdGUFpdZTlyZIvRLhsJcqWu5dmICoiQvCGqDXGwMOXOawjbH
 /vPGB0S9pIsPCVImBemPcoqu/c4iI9s2g426dtH4EgDya89hZy4A5JAuc95eLMaON7DZ
 ED/SL8uf39XTyS6GrRxZix4ZbzLsjtA12snfiYyh1hrI8rtC1Dih6pW/8jsBrZ+ZmwXA
 p1vo4rqF/BvrmHcara6KoP91matuCfUV5poBnjUmpryByFDDlLus+85Xq8ihNI4knX0D
 HB0Q==
X-Gm-Message-State: APjAAAV5Sazl0Vy+DaAqVqEPolTnEanDSxpwEq9lE4EEKaEYrxJ/McZk
 v7GV143bWeGQ8kiDknV3srbk0YGe
X-Google-Smtp-Source: APXvYqz2agiyAJ3wU012CY8A2n5xvi5owWe+2kEpNaKK2jKk9q87ARqX+LqeDCudavqr7QzwpH3/og==
X-Received: by 2002:a1c:ac81:: with SMTP id
 v123mr71487652wme.145.1563894838732; 
 Tue, 23 Jul 2019 08:13:58 -0700 (PDT)
Received: from f2.redhat.com (bzq-79-182-115-245.red.bezeqint.net.
 [79.182.115.245])
 by smtp.gmail.com with ESMTPSA id t6sm46633438wmb.29.2019.07.23.08.13.57
 (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
 Tue, 23 Jul 2019 08:13:58 -0700 (PDT)
From: Yuri Benditovich <yuri.benditovich@daynix.com>
To: spice-devel@lists.freedesktop.org
Date: Tue, 23 Jul 2019 18:13:46 +0300
Message-Id: <20190723151349.6490-2-yuri.benditovich@daynix.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190723151349.6490-1-yuri.benditovich@daynix.com>
References: <20190723151349.6490-1-yuri.benditovich@daynix.com>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=daynix-com.20150623.gappssmtp.com; s=20150623;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=miv1sFA1W4zQ17QwQyDnTE/FplCd4fmswcEhv2sXWag=;
 b=MR9DqXoF8QRjvqx/Ub2cCZArkDEVuky4IrI8/E4ml5e6zYcQhLD5F5Wq6m/z+6Uwus
 ooe52FXmS2aiSwW1kjcfJ6O8ZwWxIYA0FHsDK28CfoAVHBH10bc/D5BWGeE9Cy55BI84
 HiDmuzdj6h3cITvxyVLGwm6R/DV2m1Q0o5HttIIDpduKc4OFfqTtvfojWXttTIISV2Sw
 UwKP3J/P3wWqGBhdapNKz+c2r7wsqwsM3+/W8n3JJSQaH0z6u7GazbSy0o9Xp0c60HbB
 fgZIY/rjWl0mheQUcCxn9GTGuzrx6oFXqJOMx1T1g2YJoQiM8hqxb9k+k2FK3l2wV3ue
 QcZA==
Subject: [Spice-devel] [spice-gtk v3 1/4] usb-redir: unify device
 hotplug/unplug for Windows and Linux
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: yan@daynix.com
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

UmVtb3ZlIFdpbmRvd3Mtc3BlY2lmaWMgcGFydCBvZiBob3RwbHVnIGRldGVjdGlvbiBmcm9tCnVz
Yi1kZXZpY2UtbWFuYWdlciBhbmQgd2luLXVzYi1kZXYgYW5kIHBsYWNlIGl0IGludG8KVVNCIGJh
Y2tlbmQgbW9kdWxlLiBDb25uZWN0IHRoZSBob3RwbHVnL3VucGx1ZyBkZXRlY3Rpb24KaW4gV2lu
ZG93cyB0byB0aGUgc2FtZSBjYWxsYmFja3MgYWxyZWFkeSB1c2VkIGluIExpbnV4LgpUaGlzIHJl
bW92ZXMgc2lnbmlmaWNhbnQgcGFydCBvZiBXaW5kb3dzLXNwZWNpZmljIGNvZGUKYW5kIHNpbXBp
ZmllcyB0aGluZ3MuCk5vdGUgcmVnYXJkaW5nICdyZWRpcmVjdGluZycgcHJvcGVydHkgb2YgdXNi
LWRldmljZS1tYW5hZ2VyOgotIFByZXZpb3VzbHkgdXNiLWRldmljZS1tYW5hZ2VyIHVuZGVyIFdp
bmRvd3MgbWFpbnRhaW5lZAogICdyZWRpcmVjdGlvbicgcHJvcGVydHkgaW4gd2luLXVzYi1kZXYK
LSBOb3cgaXQgbWFpbnRhaW5zIGl0cyBvd24gcHJvcGVydHkgaW4gYm90aCBXaW5kb3dzIGFuZAog
IExpbnV4IChmb3IgR1VJIGFuZCBzaW5nbGUgcmVkaXJlY3QgYXQgYSB0aW1lKQotIFRoZSBVU0Ig
YmFja2VuZCBtYWludGFpbnMgaXRzIG93biAncmVkaXJlY3RpbmcnIGZpZWxkCiAgaW4gV2luZG93
cyB0byBwcmV2ZW50IHVwZGF0ZSBvZiBkZXZpY2UgbGlzdCB3aGVuCiAgbGlidXNiIG9wZW5zIHRo
ZSBkZXZpY2UgKGRldmljZSByZWRpcmVjdGlvbiBjYXVzZXMKICB0ZW1wb3JhcnkgcmVtb3ZhbCBv
ZiB0YXJnZXQgZGV2aWNlKQoKU2lnbmVkLW9mZi1ieTogWXVyaSBCZW5kaXRvdmljaCA8eXVyaS5i
ZW5kaXRvdmljaEBkYXluaXguY29tPgotLS0KIG1lc29uLmJ1aWxkICAgICAgICAgICAgICB8ICAg
MiArLQogc3JjL21lc29uLmJ1aWxkICAgICAgICAgIHwgICA0ICstCiBzcmMvdXNiLWJhY2tlbmQu
YyAgICAgICAgfCAyNTAgKysrKysrKysrKysrKysrKy0tLS0tLQogc3JjL3VzYi1iYWNrZW5kLmgg
ICAgICAgIHwgICA4IC0KIHNyYy91c2ItZGV2aWNlLW1hbmFnZXIuYyB8ICA2MSArLS0tLS0KIHNy
Yy93aW4tdXNiLWRldi5jICAgICAgICB8IDQzNiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0KIHNyYy93aW4tdXNiLWRldi5oICAgICAgICB8ICA4NCAtLS0tLS0tLQogNyBm
aWxlcyBjaGFuZ2VkLCAyMDAgaW5zZXJ0aW9ucygrKSwgNjQ1IGRlbGV0aW9ucygtKQogZGVsZXRl
IG1vZGUgMTAwNjQ0IHNyYy93aW4tdXNiLWRldi5jCiBkZWxldGUgbW9kZSAxMDA2NDQgc3JjL3dp
bi11c2ItZGV2LmgKCmRpZmYgLS1naXQgYS9tZXNvbi5idWlsZCBiL21lc29uLmJ1aWxkCmluZGV4
IDU0MTYwZjkuLjFmNmVhNmQgMTAwNjQ0Ci0tLSBhL21lc29uLmJ1aWxkCisrKyBiL21lc29uLmJ1
aWxkCkBAIC0xMTcsNyArMTE3LDcgQEAgZW5kZm9yZWFjaAogCiBkZXBzID0gW10KIGlmIGhvc3Rf
bWFjaGluZS5zeXN0ZW0oKSA9PSAnd2luZG93cycKLSAgZGVwcyArPSBbJ2xpYndzMl8zMicsICds
aWJnZGkzMiddCisgIGRlcHMgKz0gWydsaWJ3czJfMzInLCAnbGliZ2RpMzInLCAnbGliY29tY3Rs
MzInXQogZW5kaWYKIAogZm9yZWFjaCBkZXAgOiBkZXBzCmRpZmYgLS1naXQgYS9zcmMvbWVzb24u
YnVpbGQgYi9zcmMvbWVzb24uYnVpbGQKaW5kZXggYTUxZDBhOS4uYWRjZmFlYyAxMDA2NDQKLS0t
IGEvc3JjL21lc29uLmJ1aWxkCisrKyBiL3NyYy9tZXNvbi5idWlsZApAQCAtMTU4LDkgKzE1OCw3
IEBAIGVuZGlmCiAKIGlmIHNwaWNlX2d0a19oYXNfdXNicmVkaXIgYW5kIGhvc3RfbWFjaGluZS5z
eXN0ZW0oKSA9PSAnd2luZG93cycKICAgc3BpY2VfY2xpZW50X2dsaWJfc291cmNlcyArPSBbJ3Vz
YmRrX2FwaS5jJywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VzYmRrX2FwaS5o
JywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3dpbi11c2ItZGV2LmMnLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnd2luLXVzYi1kZXYuaCddCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICd1c2Jka19hcGkuaCddCiBlbmRpZgogCiAjCmRpZmYgLS1n
aXQgYS9zcmMvdXNiLWJhY2tlbmQuYyBiL3NyYy91c2ItYmFja2VuZC5jCmluZGV4IGU4Mzc1Nzku
LjNmOTk3MzkgMTAwNjQ0Ci0tLSBhL3NyYy91c2ItYmFja2VuZC5jCisrKyBiL3NyYy91c2ItYmFj
a2VuZC5jCkBAIC0zMiw2ICszMiw5IEBACiAjaW5jbHVkZSA8bGlidXNiLmg+CiAjaW5jbHVkZSA8
c3RyaW5nLmg+CiAjaW5jbHVkZSA8ZmNudGwuaD4KKyNpZmRlZiBHX09TX1dJTjMyCisjaW5jbHVk
ZSA8Y29tbWN0cmwuaD4KKyNlbmRpZgogI2luY2x1ZGUgInVzYnJlZGlyaG9zdC5oIgogI2luY2x1
ZGUgInVzYnJlZGlycGFyc2VyLmgiCiAjaW5jbHVkZSAic3BpY2UtdXRpbC5oIgpAQCAtNTUsNiAr
NTgsMTEgQEAgc3RydWN0IF9TcGljZVVzYkJhY2tlbmQKICAgICB1c2JfaG90X3BsdWdfY2FsbGJh
Y2sgaG90cGx1Z19jYWxsYmFjazsKICAgICB2b2lkICpob3RwbHVnX3VzZXJfZGF0YTsKICAgICBs
aWJ1c2JfaG90cGx1Z19jYWxsYmFja19oYW5kbGUgaG90cGx1Z19oYW5kbGU7CisjaWZkZWYgR19P
U19XSU4zMgorICAgIEhBTkRMRSBoV25kOworICAgIGxpYnVzYl9kZXZpY2UgKipsaWJ1c2JfZGV2
aWNlX2xpc3Q7CisgICAgZ2ludCByZWRpcmVjdGluZzsKKyNlbmRpZgogfTsKIAogc3RydWN0IF9T
cGljZVVzYkJhY2tlbmRDaGFubmVsCkBAIC02Niw2ICs3NCw3IEBAIHN0cnVjdCBfU3BpY2VVc2JC
YWNrZW5kQ2hhbm5lbAogICAgIGludCBydWxlc19jb3VudDsKICAgICBTcGljZVVzYkJhY2tlbmRE
ZXZpY2UgKmF0dGFjaGVkOwogICAgIFNwaWNlVXNicmVkaXJDaGFubmVsICAqdXNlcl9kYXRhOwor
ICAgIFNwaWNlVXNiQmFja2VuZCAqYmFja2VuZDsKICAgICBHRXJyb3IgKiplcnJvcjsKIH07CiAK
QEAgLTEyOCw2ICsxMzcsMTcwIEBAIHN0YXRpYyBpbnQgTElCVVNCX0NBTEwgaG90cGx1Z19jYWxs
YmFjayhsaWJ1c2JfY29udGV4dCAqY3R4LAogICAgIHJldHVybiAwOwogfQogCisjaWZkZWYgR19P
U19XSU4zMgorLyogV2luZG93cy1zcGVjaWZpYzogZ2V0IG5vdGlmaWNhdGlvbiBvbiBkZXZpY2Ug
Y2hhbmdlICovCisKK3N0YXRpYyBnYm9vbGVhbiBpc19zYW1lX2xpYnVzYl9kZXYobGlidXNiX2Rl
dmljZSAqbGliZGV2MSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlidXNi
X2RldmljZSAqbGliZGV2MikKK3sKKyAgICBVc2JEZXZpY2VJbmZvcm1hdGlvbiBpbmZvMSwgaW5m
bzI7CisgICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwobGliZGV2MSAhPSBOVUxMICYmIGxpYmRldjIg
IT0gTlVMTCwgRkFMU0UpOworCisgICAgZ2V0X3VzYl9kZXZpY2VfaW5mb19mcm9tX2xpYnVzYl9k
ZXZpY2UoJmluZm8xLCBsaWJkZXYxKTsKKyAgICBnZXRfdXNiX2RldmljZV9pbmZvX2Zyb21fbGli
dXNiX2RldmljZSgmaW5mbzIsIGxpYmRldjIpOworCisgICAgcmV0dXJuIGluZm8xLmJ1cyA9PSBp
bmZvMi5idXMgJiYKKyAgICAgICAgICAgaW5mbzEuYWRkcmVzcyA9PSBpbmZvMi5hZGRyZXNzICYm
CisgICAgICAgICAgIGluZm8xLnZpZCA9PSBpbmZvMi52aWQgJiYKKyAgICAgICAgICAgaW5mbzEu
cGlkID09IGluZm8yLnBpZDsKK30KKworLyoKKyAgICBDb21wYXJlcyBjb250ZXh0IGFuZCBsaXN0
MSBhbmQgbGlzdDIgYW5kIGZpcmUgY2FsbGJhY2sgZm9yIGVhY2gKKyAgICBkZXZpY2UgaW4gbGlz
dDEgdGhhdCBub3QgcHJlc2VudCBpbiBsaXN0Mi4KKyAgICBSZXR1cm5zIG51bWJlciBvZiBzdWNo
IGRldmljZXMuCisqLworc3RhdGljIGludCBjb21wYXJlX2Rldl9saXN0X2ZpcmVfY2FsbGJhY2so
U3BpY2VVc2JCYWNrZW5kICpiZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGxpYnVzYl9kZXZpY2UgKiBjb25zdCAqbGlzdDEsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBsaWJ1c2JfZGV2aWNlICogY29uc3QgKmxpc3QyLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2Jvb2xlYW4gYWRkKQorewor
ICAgIGludCBudW1fY2hhbmdlZCA9IDA7CisgICAgbGlidXNiX2hvdHBsdWdfZXZlbnQgZXZlbnQg
PSBhZGQgPworICAgICAgICBMSUJVU0JfSE9UUExVR19FVkVOVF9ERVZJQ0VfQVJSSVZFRCA6IExJ
QlVTQl9IT1RQTFVHX0VWRU5UX0RFVklDRV9MRUZUOworICAgIHdoaWxlICgqbGlzdDEpIHsKKyAg
ICAgICAgZ2Jvb2xlYW4gZm91bmQgPSAwOworICAgICAgICB1aW50MzJfdCBuID0gMDsKKyAgICAg
ICAgd2hpbGUgKCFmb3VuZCAmJiBsaXN0MltuXSkgeworICAgICAgICAgICAgZm91bmQgPSBpc19z
YW1lX2xpYnVzYl9kZXYoKmxpc3QxLCBsaXN0MltuXSk7CisgICAgICAgICAgICBuKys7CisgICAg
ICAgIH0KKyAgICAgICAgaWYgKCFmb3VuZCkgeworICAgICAgICAgICAgVXNiRGV2aWNlSW5mb3Jt
YXRpb24gaW5mbzsKKyAgICAgICAgICAgIGdldF91c2JfZGV2aWNlX2luZm9fZnJvbV9saWJ1c2Jf
ZGV2aWNlKCZpbmZvLCAqbGlzdDEpOworICAgICAgICAgICAgU1BJQ0VfREVCVUcoIiVzICUwNFg6
JTA0WCBhdCAlZDolZCIsIGFkZCA/ICJhZGRpbmciIDogInJlbW92aW5nIiwKKyAgICAgICAgICAg
ICAgICAgICAgICAgIGluZm8udmlkLCBpbmZvLnBpZCwgaW5mby5idXMsIGluZm8uYWRkcmVzcyk7
CisgICAgICAgICAgICBob3RwbHVnX2NhbGxiYWNrKE5VTEwsICpsaXN0MSwgZXZlbnQsIGJlKTsK
KyAgICAgICAgICAgIG51bV9jaGFuZ2VkKys7CisgICAgICAgIH0KKyAgICAgICAgbGlzdDErKzsK
KyAgICB9CisgICAgcmV0dXJuIG51bV9jaGFuZ2VkOworfQorCitzdGF0aWMgTFJFU1VMVCBzdWJj
bGFzc19wcm9jKEhXTkQgaFduZCwgVUlOVCB1TXNnLCBXUEFSQU0gd1BhcmFtLCBMUEFSQU0gbFBh
cmFtLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVJTlRfUFRSIHVJZFN1YmNsYXNzLCBE
V09SRF9QVFIgZHdSZWZEYXRhKQoreworICAgIFNwaWNlVXNiQmFja2VuZCAqYmUgPSAoU3BpY2VV
c2JCYWNrZW5kICopZHdSZWZEYXRhOworICAgIGlmICh1TXNnID09IFdNX0RFVklDRUNIQU5HRSAm
JiAhYmUtPnJlZGlyZWN0aW5nKSB7CisgICAgICAgIGxpYnVzYl9kZXZpY2UgKipuZXdfbGlzdCA9
IE5VTEw7CisgICAgICAgIGxpYnVzYl9nZXRfZGV2aWNlX2xpc3QoYmUtPmxpYnVzYl9jb250ZXh0
LCAmbmV3X2xpc3QpOworICAgICAgICBpZiAobmV3X2xpc3QpIHsKKyAgICAgICAgICAgIGludCBu
dW1fY2hhbmdlZCA9IGNvbXBhcmVfZGV2X2xpc3RfZmlyZV9jYWxsYmFjayhiZSwgYmUtPmxpYnVz
Yl9kZXZpY2VfbGlzdCwgbmV3X2xpc3QsIEZBTFNFKTsKKyAgICAgICAgICAgIG51bV9jaGFuZ2Vk
ICs9IGNvbXBhcmVfZGV2X2xpc3RfZmlyZV9jYWxsYmFjayhiZSwgbmV3X2xpc3QsIGJlLT5saWJ1
c2JfZGV2aWNlX2xpc3QsIFRSVUUpOworICAgICAgICAgICAgaWYgKG51bV9jaGFuZ2VkID4gMCkg
eworICAgICAgICAgICAgICAgIGxpYnVzYl9mcmVlX2RldmljZV9saXN0KGJlLT5saWJ1c2JfZGV2
aWNlX2xpc3QsIFRSVUUpOworICAgICAgICAgICAgICAgIGJlLT5saWJ1c2JfZGV2aWNlX2xpc3Qg
PSBuZXdfbGlzdDsKKyAgICAgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICAgICAgbGlidXNi
X2ZyZWVfZGV2aWNlX2xpc3QobmV3X2xpc3QsIFRSVUUpOworICAgICAgICAgICAgfQorICAgICAg
ICB9IGVsc2UgeworICAgICAgICAgICAgZ193YXJuX2lmX3JlYWNoZWQoKTsKKyAgICAgICAgfQor
ICAgIH0KKyAgICByZXR1cm4gRGVmU3ViY2xhc3NQcm9jKGhXbmQsIHVNc2csIHdQYXJhbSwgbFBh
cmFtKTsKK30KKworc3RhdGljIHZvaWQgZGlzYWJsZV9ob3RwbHVnX3N1cHBvcnQoU3BpY2VVc2JC
YWNrZW5kICpiZSkKK3sKKyAgICBpZiAoYmUtPmhXbmQpIHsKKyAgICAgICAgRGVzdHJveVdpbmRv
dyhiZS0+aFduZCk7CisgICAgICAgIGJlLT5oV25kID0gTlVMTDsKKyAgICB9CisgICAgaWYgKGJl
LT5saWJ1c2JfZGV2aWNlX2xpc3QpIHsKKyAgICAgICAgbGlidXNiX2ZyZWVfZGV2aWNlX2xpc3Qo
YmUtPmxpYnVzYl9kZXZpY2VfbGlzdCwgVFJVRSk7CisgICAgICAgIGJlLT5saWJ1c2JfZGV2aWNl
X2xpc3QgPSBOVUxMOworICAgIH0KK30KKworc3RhdGljIGludCBlbmFibGVfaG90cGx1Z19zdXBw
b3J0KFNwaWNlVXNiQmFja2VuZCAqYmUsIGNvbnN0IGNoYXIgKiplcnJvcl9vbl9lbmFibGUpCit7
CisgICAgbG9uZyB3aW5fZXJyOworICAgIGxpYnVzYl9kZXZpY2UgKipsaWJkZXZfbGlzdCA9IE5V
TEw7CisgICAgbGlidXNiX2RldmljZSAqZW1wdHlfbGlzdCA9IE5VTEw7CisKKyAgICBsaWJ1c2Jf
Z2V0X2RldmljZV9saXN0KGJlLT5saWJ1c2JfY29udGV4dCwgJmxpYmRldl9saXN0KTsKKyAgICBp
ZiAoIWxpYmRldl9saXN0KSB7CisgICAgICAgICplcnJvcl9vbl9lbmFibGUgPSAiR2V0dGluZyBk
ZXZpY2UgbGlzdCI7CisgICAgICAgIGdvdG8gZXJyb3I7CisgICAgfQorICAgIC8qIHVzaW5nIHN0
YW5kYXJkIGNsYXNzIGZvciB3aW5kb3cgdG8gcmVjZWl2ZSBtZXNzYWdlcyAqLworICAgIGJlLT5o
V25kID0gQ3JlYXRlV2luZG93KCJTdGF0aWMiLCBOVUxMLCAwLCAwLCAwLCAwLCAwLCBOVUxMLCBO
VUxMLCBOVUxMLCBOVUxMKTsKKyAgICBpZiAoIWJlLT5oV25kKSB7CisgICAgICAgICplcnJvcl9v
bl9lbmFibGUgPSAiQ3JlYXRlV2luZG93IjsKKyAgICAgICAgZ290byBlcnJvcjsKKyAgICB9Cisg
ICAgaWYgKCFTZXRXaW5kb3dTdWJjbGFzcyhiZS0+aFduZCwgc3ViY2xhc3NfcHJvYywgMCwgKERX
T1JEX1BUUiliZSkpIHsKKyAgICAgICAgKmVycm9yX29uX2VuYWJsZSA9ICJTZXRXaW5kb3dTdWJj
bGFzcyI7CisgICAgICAgIGdvdG8gZXJyb3I7CisgICAgfQorICAgIGJlLT5ob3RwbHVnX2hhbmRs
ZSA9IDE7CisgICAgYmUtPmxpYnVzYl9kZXZpY2VfbGlzdCA9IGxpYmRldl9saXN0OworCisgICAg
Y29tcGFyZV9kZXZfbGlzdF9maXJlX2NhbGxiYWNrKGJlLCBiZS0+bGlidXNiX2RldmljZV9saXN0
LCAmZW1wdHlfbGlzdCwgVFJVRSk7CisKKyAgICByZXR1cm4gTElCVVNCX1NVQ0NFU1M7CitlcnJv
cjoKKyAgICB3aW5fZXJyID0gR2V0TGFzdEVycm9yKCk7CisgICAgaWYgKCF3aW5fZXJyKSB7Cisg
ICAgICAgIHdpbl9lcnIgPSAtMTsKKyAgICB9CisgICAgZ193YXJuaW5nKCIlcyBmYWlsZWQ6ICVs
ZCIsICplcnJvcl9vbl9lbmFibGUsIHdpbl9lcnIpOworICAgIGlmIChsaWJkZXZfbGlzdCkgewor
ICAgICAgICBsaWJ1c2JfZnJlZV9kZXZpY2VfbGlzdChsaWJkZXZfbGlzdCwgVFJVRSk7CisgICAg
fQorICAgIHJldHVybiB3aW5fZXJyOworfQorCitzdGF0aWMgdm9pZCBzZXRfcmVkaXJlY3Rpbmco
U3BpY2VVc2JCYWNrZW5kICpiZSwgZ2Jvb2xlYW4gb24pCit7CisgICAgaWYgKG9uKSB7CisgICAg
ICAgIGdfYXRvbWljX2ludF9pbmMoJmJlLT5yZWRpcmVjdGluZyk7CisgICAgfSBlbHNlIHsKKyAg
ICAgICAgZ2Jvb2xlYW4gbm9fcmVkaXI7CisgICAgICAgIG5vX3JlZGlyID0gZ19hdG9taWNfaW50
X2RlY19hbmRfdGVzdCgmYmUtPnJlZGlyZWN0aW5nKTsKKyAgICAgICAgaWYgKG5vX3JlZGlyICYm
IGJlLT5oV25kKSB7CisgICAgICAgICAgICBQb3N0TWVzc2FnZShiZS0+aFduZCwgV01fREVWSUNF
Q0hBTkdFLCAwLCAwKTsKKyAgICAgICAgfQorICAgIH0KK30KKworI2Vsc2UKKy8qIExpbnV4LXNw
ZWNpZmljOiB1c2UgaG90IGNhbGxiYWNrIGZyb20gbGlidXNiICovCisKK3N0YXRpYyB2b2lkIGRp
c2FibGVfaG90cGx1Z19zdXBwb3J0KFNwaWNlVXNiQmFja2VuZCAqYmUpCit7CisgICAgbGlidXNi
X2hvdHBsdWdfZGVyZWdpc3Rlcl9jYWxsYmFjayhiZS0+bGlidXNiX2NvbnRleHQsIGJlLT5ob3Rw
bHVnX2hhbmRsZSk7Cit9CisKK3N0YXRpYyBpbnQgZW5hYmxlX2hvdHBsdWdfc3VwcG9ydChTcGlj
ZVVzYkJhY2tlbmQgKmJlLCBjb25zdCBjaGFyICoqZXJyb3Jfb25fZW5hYmxlKQoreworICAgIGlu
dCByYyA9IDA7CisgICAgcmMgPSBsaWJ1c2JfaG90cGx1Z19yZWdpc3Rlcl9jYWxsYmFjayhiZS0+
bGlidXNiX2NvbnRleHQsCisgICAgICAgIExJQlVTQl9IT1RQTFVHX0VWRU5UX0RFVklDRV9BUlJJ
VkVEIHwgTElCVVNCX0hPVFBMVUdfRVZFTlRfREVWSUNFX0xFRlQsCisgICAgICAgIExJQlVTQl9I
T1RQTFVHX0VOVU1FUkFURSwgTElCVVNCX0hPVFBMVUdfTUFUQ0hfQU5ZLAorICAgICAgICBMSUJV
U0JfSE9UUExVR19NQVRDSF9BTlksIExJQlVTQl9IT1RQTFVHX01BVENIX0FOWSwKKyAgICAgICAg
aG90cGx1Z19jYWxsYmFjaywgYmUsICZiZS0+aG90cGx1Z19oYW5kbGUpOworICAgICplcnJvcl9v
bl9lbmFibGUgPSBsaWJ1c2Jfc3RyZXJyb3IocmMpOworICAgIHJldHVybiByYzsKK30KKworc3Rh
dGljIGlubGluZSB2b2lkIHNldF9yZWRpcmVjdGluZyhTcGljZVVzYkJhY2tlbmQgKmJlLCBnYm9v
bGVhbiBvbikgeworICAgIC8qIG5vdGhpbmcgb24gTGludXggKi8KK30KKworI2VuZGlmCisKIC8q
IGxvY2sgZnVuY3Rpb25zIGZvciB1c2JyZWRpcmhvc3QgYW5kIHVzYnJlZGlycGFyc2VyICovCiBz
dGF0aWMgdm9pZCAqdXNicmVkaXJfYWxsb2NfbG9jayh2b2lkKSB7CiAgICAgR011dGV4ICptdXRl
eDsKQEAgLTI2NSw3ICs0MzgsNyBAQCB2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2RlcmVnaXN0ZXJf
aG90cGx1ZyhTcGljZVVzYkJhY2tlbmQgKmJlKQogewogICAgIGdfcmV0dXJuX2lmX2ZhaWwoYmUg
IT0gTlVMTCk7CiAgICAgaWYgKGJlLT5ob3RwbHVnX2hhbmRsZSkgewotICAgICAgICBsaWJ1c2Jf
aG90cGx1Z19kZXJlZ2lzdGVyX2NhbGxiYWNrKGJlLT5saWJ1c2JfY29udGV4dCwgYmUtPmhvdHBs
dWdfaGFuZGxlKTsKKyAgICAgICAgZGlzYWJsZV9ob3RwbHVnX3N1cHBvcnQoYmUpOwogICAgICAg
ICBiZS0+aG90cGx1Z19oYW5kbGUgPSAwOwogICAgIH0KICAgICBiZS0+aG90cGx1Z19jYWxsYmFj
ayA9IE5VTEw7CkBAIC0yNzYsMTcgKzQ0OSwxNSBAQCBnYm9vbGVhbiBzcGljZV91c2JfYmFja2Vu
ZF9yZWdpc3Rlcl9ob3RwbHVnKFNwaWNlVXNiQmFja2VuZCAqYmUsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzYl9ob3RfcGx1Z19jYWxsYmFjayBwcm9jKQog
ewogICAgIGludCByYzsKKyAgICBjb25zdCBjaGFyICpkZXNjOwogICAgIGdfcmV0dXJuX3ZhbF9p
Zl9mYWlsKGJlICE9IE5VTEwsIEZBTFNFKTsKIAogICAgIGJlLT5ob3RwbHVnX2NhbGxiYWNrID0g
cHJvYzsKICAgICBiZS0+aG90cGx1Z191c2VyX2RhdGEgPSB1c2VyX2RhdGE7Ci0gICAgcmMgPSBs
aWJ1c2JfaG90cGx1Z19yZWdpc3Rlcl9jYWxsYmFjayhiZS0+bGlidXNiX2NvbnRleHQsCi0gICAg
ICAgIExJQlVTQl9IT1RQTFVHX0VWRU5UX0RFVklDRV9BUlJJVkVEIHwgTElCVVNCX0hPVFBMVUdf
RVZFTlRfREVWSUNFX0xFRlQsCi0gICAgICAgIExJQlVTQl9IT1RQTFVHX0VOVU1FUkFURSwgTElC
VVNCX0hPVFBMVUdfTUFUQ0hfQU5ZLAotICAgICAgICBMSUJVU0JfSE9UUExVR19NQVRDSF9BTlks
IExJQlVTQl9IT1RQTFVHX01BVENIX0FOWSwKLSAgICAgICAgaG90cGx1Z19jYWxsYmFjaywgYmUs
ICZiZS0+aG90cGx1Z19oYW5kbGUpOworCisgICAgcmMgPSBlbmFibGVfaG90cGx1Z19zdXBwb3J0
KGJlLCAmZGVzYyk7CisKICAgICBpZiAocmMgIT0gTElCVVNCX1NVQ0NFU1MpIHsKLSAgICAgICAg
Y29uc3QgY2hhciAqZGVzYyA9IGxpYnVzYl9zdHJlcnJvcihyYyk7CiAgICAgICAgIGdfd2Fybmlu
ZygiRXJyb3IgaW5pdGlhbGl6aW5nIFVTQiBob3RwbHVnIHN1cHBvcnQ6ICVzIFslaV0iLCBkZXNj
LCByYyk7CiAgICAgICAgIGJlLT5ob3RwbHVnX2NhbGxiYWNrID0gTlVMTDsKICAgICAgICAgcmV0
dXJuIEZBTFNFOwpAQCAtMzA1LDQ1ICs0NzYsNiBAQCB2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2Rl
bGV0ZShTcGljZVVzYkJhY2tlbmQgKmJlKQogICAgIFNQSUNFX0RFQlVHKCIlcyA8PCIsIF9fRlVO
Q1RJT05fXyk7CiB9CiAKLVNwaWNlVXNiQmFja2VuZERldmljZSAqKnNwaWNlX3VzYl9iYWNrZW5k
X2dldF9kZXZpY2VfbGlzdChTcGljZVVzYkJhY2tlbmQgKmJlKQotewotICAgIExPVURfREVCVUco
IiVzID4+IiwgX19GVU5DVElPTl9fKTsKLSAgICBsaWJ1c2JfZGV2aWNlICoqZGV2bGlzdCA9IE5V
TEwsICoqZGV2OwotICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqZCwgKipsaXN0OwotCi0gICAg
aW50IG4gPSAwLCBpbmRleDsKLQotICAgIGlmIChiZSAmJiBiZS0+bGlidXNiX2NvbnRleHQpIHsK
LSAgICAgICAgbGlidXNiX2dldF9kZXZpY2VfbGlzdChiZS0+bGlidXNiX2NvbnRleHQsICZkZXZs
aXN0KTsKLSAgICB9Ci0KLSAgICAvKiBhZGQgYWxsIHRoZSBsaWJ1c2IgZGV2aWNlIHRoYXQgbm90
IHByZXNlbnQgaW4gb3VyIGxpc3QgKi8KLSAgICBmb3IgKGRldiA9IGRldmxpc3Q7IGRldiAmJiAq
ZGV2OyBkZXYrKykgewotICAgICAgICBuKys7Ci0gICAgfQotCi0gICAgbGlzdCA9IGdfbmV3MChT
cGljZVVzYkJhY2tlbmREZXZpY2UqLCBuICsgMSk7Ci0KLSAgICBpbmRleCA9IDA7Ci0KLSAgICBm
b3IgKGRldiA9IGRldmxpc3Q7IGRldiAmJiAqZGV2OyBkZXYrKykgewotICAgICAgICBkID0gYWxs
b2NhdGVfYmFja2VuZF9kZXZpY2UoKmRldik7Ci0gICAgICAgIGlmICghZCkgewotICAgICAgICAg
ICAgbGlidXNiX3VucmVmX2RldmljZSgqZGV2KTsKLSAgICAgICAgfSBlbHNlIHsKLSAgICAgICAg
ICAgIFNQSUNFX0RFQlVHKCJjcmVhdGVkIGRldiAlcCwgdXNibGliIGRldiAlcCIsIGQsICpkZXYp
OwotICAgICAgICAgICAgbGlzdFtpbmRleCsrXSA9IGQ7Ci0gICAgICAgIH0KLSAgICB9Ci0KLSAg
ICBpZiAoZGV2bGlzdCkgewotICAgICAgICBsaWJ1c2JfZnJlZV9kZXZpY2VfbGlzdChkZXZsaXN0
LCAwKTsKLSAgICB9Ci0KLSAgICBMT1VEX0RFQlVHKCIlcyA8PCIsIF9fRlVOQ1RJT05fXyk7Ci0g
ICAgcmV0dXJuIGxpc3Q7Ci19Ci0KIGNvbnN0IFVzYkRldmljZUluZm9ybWF0aW9uKiBzcGljZV91
c2JfYmFja2VuZF9kZXZpY2VfZ2V0X2luZm8oU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYpCiB7
CiAgICAgcmV0dXJuICZkZXYtPmRldmljZV9pbmZvOwpAQCAtMzU0LDE4ICs0ODYsNiBAQCBnY29u
c3Rwb2ludGVyIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9nZXRfbGliZGV2KFNwaWNlVXNiQmFj
a2VuZERldmljZSAqZGV2KQogICAgIHJldHVybiBkZXYtPmxpYnVzYl9kZXZpY2U7CiB9CiAKLXZv
aWQgc3BpY2VfdXNiX2JhY2tlbmRfZnJlZV9kZXZpY2VfbGlzdChTcGljZVVzYkJhY2tlbmREZXZp
Y2UgKipkZXZsaXN0KQotewotICAgIExPVURfREVCVUcoIiVzID4+IiwgX19GVU5DVElPTl9fKTsK
LSAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKipkZXY7Ci0gICAgZm9yIChkZXYgPSBkZXZsaXN0
OyAqZGV2OyBkZXYrKykgewotICAgICAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmQgPSAqZGV2
OwotICAgICAgICBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfdW5yZWYoZCk7Ci0gICAgfQotICAg
IGdfZnJlZShkZXZsaXN0KTsKLSAgICBMT1VEX0RFQlVHKCIlcyA8PCIsIF9fRlVOQ1RJT05fXyk7
Ci19Ci0KIFNwaWNlVXNiQmFja2VuZERldmljZSAqc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX3Jl
ZihTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldikKIHsKICAgICBMT1VEX0RFQlVHKCIlcyA+PiAl
cCIsIF9fRlVOQ1RJT05fXywgZGV2KTsKQEAgLTUzMywxMiArNjUzLDIzIEBAIGdib29sZWFuIHNw
aWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfYXR0YWNoKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNo
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VVc2JCYWNr
ZW5kRGV2aWNlICpkZXYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBHRXJyb3IgKiplcnJvcikKIHsKKyAgICBpbnQgcmM7CiAgICAgU1BJQ0VfREVCVUcoIiVzID4+
IGNoICVwLCBkZXYgJXAgKHdhcyBhdHRhY2hlZCAlcCkiLCBfX0ZVTkNUSU9OX18sIGNoLCBkZXYs
IGNoLT5hdHRhY2hlZCk7CiAKICAgICBnX3JldHVybl92YWxfaWZfZmFpbChkZXYgIT0gTlVMTCwg
RkFMU0UpOwogCiAgICAgbGlidXNiX2RldmljZV9oYW5kbGUgKmhhbmRsZSA9IE5VTEw7Ci0gICAg
aW50IHJjID0gbGlidXNiX29wZW4oZGV2LT5saWJ1c2JfZGV2aWNlLCAmaGFuZGxlKTsKKworICAg
IC8qCisgICAgICAgVW5kZXIgV2luZG93cyB3ZSBuZWVkIHRvIGF2b2lkIHVwZGF0aW5nCisgICAg
ICAgbGlzdCBvZiBkZXZpY2VzIHdoZW4gd2UgYXJlIGFjcXVpcmluZyB0aGUgZGV2aWNlCisgICAg
Ki8KKyAgICBzZXRfcmVkaXJlY3RpbmcoY2gtPmJhY2tlbmQsIFRSVUUpOworCisgICAgcmMgPSBs
aWJ1c2Jfb3BlbihkZXYtPmxpYnVzYl9kZXZpY2UsICZoYW5kbGUpOworCisgICAgc2V0X3JlZGly
ZWN0aW5nKGNoLT5iYWNrZW5kLCBGQUxTRSk7CisKICAgICBpZiAocmMpIHsKICAgICAgICAgY29u
c3QgY2hhciAqZGVzYyA9IGxpYnVzYl9zdHJlcnJvcihyYyk7CiAgICAgICAgIGdfc2V0X2Vycm9y
KGVycm9yLCBTUElDRV9DTElFTlRfRVJST1IsIFNQSUNFX0NMSUVOVF9FUlJPUl9GQUlMRUQsCkBA
IC01ODYsNiArNzE3LDcgQEAgU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqc3BpY2VfdXNiX2JhY2tl
bmRfY2hhbm5lbF9uZXcoU3BpY2VVc2JCYWNrZW5kICpiZSwKICAgICBTUElDRV9ERUJVRygiJXMg
Pj4iLCBfX0ZVTkNUSU9OX18pOwogICAgIGNoLT51c2VyX2RhdGEgPSBTUElDRV9VU0JSRURJUl9D
SEFOTkVMKHVzZXJfZGF0YSk7CiAgICAgaWYgKGJlLT5saWJ1c2JfY29udGV4dCkgeworICAgICAg
ICBjaC0+YmFja2VuZCA9IGJlOwogICAgICAgICBjaC0+dXNicmVkaXJob3N0ID0gdXNicmVkaXJo
b3N0X29wZW5fZnVsbCgKICAgICAgICAgICAgIGJlLT5saWJ1c2JfY29udGV4dCwKICAgICAgICAg
ICAgIE5VTEwsCmRpZmYgLS1naXQgYS9zcmMvdXNiLWJhY2tlbmQuaCBiL3NyYy91c2ItYmFja2Vu
ZC5oCmluZGV4IGNiYjczYzIuLjZkYTM5ODEgMTAwNjQ0Ci0tLSBhL3NyYy91c2ItYmFja2VuZC5o
CisrKyBiL3NyYy91c2ItYmFja2VuZC5oCkBAIC01NiwxNCArNTYsNiBAQCBlbnVtIHsKIFNwaWNl
VXNiQmFja2VuZCAqc3BpY2VfdXNiX2JhY2tlbmRfbmV3KEdFcnJvciAqKmVycm9yKTsKIHZvaWQg
c3BpY2VfdXNiX2JhY2tlbmRfZGVsZXRlKFNwaWNlVXNiQmFja2VuZCAqY29udGV4dCk7CiAKLS8q
Ci1yZXR1cm5zIG5ld2x5LWFsbG9jYXRlZCBudWxsLXRlcm1pbmF0ZWQgbGlzdCBvZgotU3BpY2VV
c2JCYWNrZW5kRGV2aWNlIHBvaW50ZXJzLgotVGhlIGNhbGxlciBtdXN0IGNhbGwgc3BpY2VfdXNi
X2JhY2tlbmRfZnJlZV9kZXZpY2VfbGlzdAotYWZ0ZXIgaXQgZmluaXNoZXMgbGlzdCBwcm9jZXNz
aW5nCi0qLwotU3BpY2VVc2JCYWNrZW5kRGV2aWNlICoqc3BpY2VfdXNiX2JhY2tlbmRfZ2V0X2Rl
dmljZV9saXN0KFNwaWNlVXNiQmFja2VuZCAqYmFja2VuZCk7Ci12b2lkIHNwaWNlX3VzYl9iYWNr
ZW5kX2ZyZWVfZGV2aWNlX2xpc3QoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICoqZGV2bGlzdCk7CiBn
Ym9vbGVhbiBzcGljZV91c2JfYmFja2VuZF9oYW5kbGVfZXZlbnRzKFNwaWNlVXNiQmFja2VuZCAq
YmUpOwogdm9pZCBzcGljZV91c2JfYmFja2VuZF9pbnRlcnJ1cHRfZXZlbnRfaGFuZGxlcihTcGlj
ZVVzYkJhY2tlbmQgKmJlKTsKIGdib29sZWFuIHNwaWNlX3VzYl9iYWNrZW5kX3JlZ2lzdGVyX2hv
dHBsdWcoU3BpY2VVc2JCYWNrZW5kICpiZSwKZGlmZiAtLWdpdCBhL3NyYy91c2ItZGV2aWNlLW1h
bmFnZXIuYyBiL3NyYy91c2ItZGV2aWNlLW1hbmFnZXIuYwppbmRleCA5YWJhMjc1Li45MzAwYWQy
IDEwMDY0NAotLS0gYS9zcmMvdXNiLWRldmljZS1tYW5hZ2VyLmMKKysrIGIvc3JjL3VzYi1kZXZp
Y2UtbWFuYWdlci5jCkBAIC0yOSw3ICsyOSw2IEBACiAjaWZkZWYgR19PU19XSU4zMgogI2luY2x1
ZGUgPHdpbmRvd3MuaD4KICNpbmNsdWRlICJ1c2Jka19hcGkuaCIKLSNpbmNsdWRlICJ3aW4tdXNi
LWRldi5oIgogI2VuZGlmCiAKICNpbmNsdWRlICJjaGFubmVsLXVzYnJlZGlyLXByaXYuaCIKQEAg
LTEwMSwxMiArMTAwLDEwIEBAIHN0cnVjdCBfU3BpY2VVc2JEZXZpY2VNYW5hZ2VyUHJpdmF0ZSB7
CiAgICAgc3RydWN0IHVzYnJlZGlyZmlsdGVyX3J1bGUgKnJlZGlyZWN0X29uX2Nvbm5lY3RfcnVs
ZXM7CiAgICAgaW50IGF1dG9fY29ubl9maWx0ZXJfcnVsZXNfY291bnQ7CiAgICAgaW50IHJlZGly
ZWN0X29uX2Nvbm5lY3RfcnVsZXNfY291bnQ7CisgICAgZ2Jvb2xlYW4gcmVkaXJlY3Rpbmc7CiAj
aWZkZWYgR19PU19XSU4zMgotICAgIEdVZGV2Q2xpZW50ICp1ZGV2OwogICAgIHVzYmRrX2FwaV93
cmFwcGVyICp1c2Jka19hcGk7CiAgICAgSEFORExFIHVzYmRrX2hpZGVyX2hhbmRsZTsKLSNlbHNl
Ci0gICAgZ2Jvb2xlYW4gcmVkaXJlY3Rpbmc7IC8qIEhhbmRsZWQgYnkgR1VkZXZDbGllbnQgaW4g
dGhlIGd1ZGV2IGNhc2UgKi8KICNlbmRpZgogICAgIEdQdHJBcnJheSAqZGV2aWNlczsKICAgICBH
UHRyQXJyYXkgKmNoYW5uZWxzOwpAQCAtMTM5LDE2ICsxMzYsOSBAQCBzdGF0aWMgdm9pZCBjaGFu
bmVsX2Rlc3Ryb3koU3BpY2VTZXNzaW9uICpzZXNzaW9uLCBTcGljZUNoYW5uZWwgKmNoYW5uZWws
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3BvaW50ZXIgdXNlcl9kYXRhKTsKIHN0YXRp
YyB2b2lkIGNoYW5uZWxfZXZlbnQoU3BpY2VDaGFubmVsICpjaGFubmVsLCBTcGljZUNoYW5uZWxF
dmVudCBldmVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3BvaW50ZXIgdXNlcl9kYXRh
KTsKLSNpZmRlZiBHX09TX1dJTjMyCi1zdGF0aWMgdm9pZCBzcGljZV91c2JfZGV2aWNlX21hbmFn
ZXJfdWV2ZW50X2NiKEdVZGV2Q2xpZW50ICAgICAqY2xpZW50LAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKnVkZXZp
Y2UsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdib29s
ZWFuICAgICAgICAgYWRkLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBncG9pbnRlciAgICAgICAgIHVzZXJfZGF0YSk7Ci0jZWxzZQogc3RhdGljIHZvaWQg
c3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2hvdHBsdWdfY2Iodm9pZCAqdXNlcl9kYXRhLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VVc2JCYWNr
ZW5kRGV2aWNlICpkZXYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBnYm9vbGVhbiBhZGRlZCk7Ci0jZW5kaWYKIHN0YXRpYyB2b2lkIHNwaWNlX3VzYl9k
ZXZpY2VfbWFuYWdlcl9jaGVja19yZWRpcl9vbl9jb25uZWN0KAogICAgIFNwaWNlVXNiRGV2aWNl
TWFuYWdlciAqc2VsZiwgU3BpY2VDaGFubmVsICpjaGFubmVsKTsKIApAQCAtMTkwLDExICsxODAs
NyBAQCBHX0RFRklORV9CT1hFRF9UWVBFKFNwaWNlVXNiRGV2aWNlLCBzcGljZV91c2JfZGV2aWNl
LAogc3RhdGljIHZvaWQKIF9zZXRfcmVkaXJlY3RpbmcoU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICpz
ZWxmLCBnYm9vbGVhbiBpc19yZWRpcmVjdGluZykKIHsKLSNpZmRlZiBHX09TX1dJTjMyCi0gICAg
Z19vYmplY3Rfc2V0KHNlbGYtPnByaXYtPnVkZXYsICJyZWRpcmVjdGluZyIsIGlzX3JlZGlyZWN0
aW5nLCBOVUxMKTsKLSNlbHNlCiAgICAgc2VsZi0+cHJpdi0+cmVkaXJlY3RpbmcgPSBpc19yZWRp
cmVjdGluZzsKLSNlbmRpZgogfQogCiAjZWxzZQpAQCAtMjE1LDEwICsyMDEsNiBAQCBnYm9vbGVh
biBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfaXNfcmVkaXJlY3RpbmcoU3BpY2VVc2JEZXZpY2VN
YW5hZ2VyICpzZWxmKQogewogI2lmbmRlZiBVU0VfVVNCUkVESVIKICAgICByZXR1cm4gRkFMU0U7
Ci0jZWxpZiBkZWZpbmVkKEdfT1NfV0lOMzIpCi0gICAgZ2Jvb2xlYW4gcmVkaXJlY3Rpbmc7Ci0g
ICAgZ19vYmplY3RfZ2V0KHNlbGYtPnByaXYtPnVkZXYsICJyZWRpcmVjdGluZyIsICZyZWRpcmVj
dGluZywgTlVMTCk7Ci0gICAgcmV0dXJuIHJlZGlyZWN0aW5nOwogI2Vsc2UKICAgICByZXR1cm4g
c2VsZi0+cHJpdi0+cmVkaXJlY3Rpbmc7CiAjZW5kaWYKQEAgLTI2NywyOSArMjQ5LDE4IEBAIHN0
YXRpYyBnYm9vbGVhbiBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfaW5pdGFibGVfaW5pdChHSW5p
dGFibGUgICppbml0YWJsZSwKICAgICBHTGlzdCAqbGlzdDsKICAgICBHTGlzdCAqaXQ7CiAKLSAg
ICAvKiBTdGFydCBsaXN0ZW5pbmcgZm9yIHVzYiBkZXZpY2VzIHBsdWcgLyB1bnBsdWcgKi8KLSNp
ZmRlZiBHX09TX1dJTjMyCi0gICAgcHJpdi0+dWRldiA9IGdfdWRldl9jbGllbnRfbmV3KCk7Ci0g
ICAgaWYgKHByaXYtPnVkZXYgPT0gTlVMTCkgewotICAgICAgICBnX3dhcm5pbmcoIkVycm9yIGlu
aXRpYWxpemluZyBHVWRldkNsaWVudCIpOwotICAgICAgICByZXR1cm4gRkFMU0U7Ci0gICAgfQot
ICAgIHByaXYtPmNvbnRleHQgPSBnX3VkZXZfY2xpZW50X2dldF9jb250ZXh0KHByaXYtPnVkZXYp
OwotICAgIGdfc2lnbmFsX2Nvbm5lY3QoR19PQkpFQ1QocHJpdi0+dWRldiksICJ1ZXZlbnQiLAot
ICAgICAgICAgICAgICAgICAgICAgR19DQUxMQkFDSyhzcGljZV91c2JfZGV2aWNlX21hbmFnZXJf
dWV2ZW50X2NiKSwgc2VsZik7Ci0gICAgLyogRG8gY29sZHBsdWcgKGRldGVjdGlvbiBvZiBhbHJl
YWR5IGNvbm5lY3RlZCBkZXZpY2VzKSAqLwotICAgIGdfdWRldl9jbGllbnRfcmVwb3J0X2Rldmlj
ZXMocHJpdi0+dWRldik7Ci0jZWxzZQogICAgIC8qIEluaXRpYWxpemUgbGlidXNiICovCiAgICAg
cHJpdi0+Y29udGV4dCA9IHNwaWNlX3VzYl9iYWNrZW5kX25ldyhlcnIpOwogICAgIGlmICghcHJp
di0+Y29udGV4dCkgewogICAgICAgICByZXR1cm4gRkFMU0U7CiAgICAgfQogCisgICAgLyogU3Rh
cnQgbGlzdGVuaW5nIGZvciB1c2IgZGV2aWNlcyBwbHVnIC8gdW5wbHVnICovCiAgICAgaWYgKCFz
cGljZV91c2JfYmFja2VuZF9yZWdpc3Rlcl9ob3RwbHVnKHByaXYtPmNvbnRleHQsIHNlbGYsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwaWNlX3VzYl9kZXZp
Y2VfbWFuYWdlcl9ob3RwbHVnX2NiKSkgewogICAgICAgICByZXR1cm4gRkFMU0U7CiAgICAgfQor
I2lmbmRlZiBHX09TX1dJTjMyCiAgICAgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX3N0YXJ0X2V2
ZW50X2xpc3RlbmluZyhzZWxmLCBOVUxMKTsKICNlbmRpZgogCkBAIC0zMjQsOCArMjk1LDkgQEAg
c3RhdGljIHZvaWQgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2Rpc3Bvc2UoR09iamVjdCAqZ29i
amVjdCkKICAgICAgICAgZ193YXJuX2lmX3JlYWNoZWQoKTsKICAgICAgICAgZ19hdG9taWNfaW50
X3NldCgmcHJpdi0+ZXZlbnRfdGhyZWFkX3J1biwgRkFMU0UpOwogICAgIH0KLSAgICBzcGljZV91
c2JfYmFja2VuZF9kZXJlZ2lzdGVyX2hvdHBsdWcocHJpdi0+Y29udGV4dCk7CiAjZW5kaWYKKyAg
ICBzcGljZV91c2JfYmFja2VuZF9kZXJlZ2lzdGVyX2hvdHBsdWcocHJpdi0+Y29udGV4dCk7CisK
ICAgICBpZiAocHJpdi0+ZXZlbnRfdGhyZWFkKSB7CiAgICAgICAgIGdfd2Fybl9pZl9mYWlsKGdf
YXRvbWljX2ludF9nZXQoJnByaXYtPmV2ZW50X3RocmVhZF9ydW4pID09IEZBTFNFKTsKICAgICAg
ICAgZ19hdG9taWNfaW50X3NldCgmcHJpdi0+ZXZlbnRfdGhyZWFkX3J1biwgRkFMU0UpOwpAQCAt
MzUwLDE0ICszMjIsMTAgQEAgc3RhdGljIHZvaWQgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2Zp
bmFsaXplKEdPYmplY3QgKmdvYmplY3QpCiAgICAgaWYgKHByaXYtPmRldmljZXMpIHsKICAgICAg
ICAgZ19wdHJfYXJyYXlfdW5yZWYocHJpdi0+ZGV2aWNlcyk7CiAgICAgfQotI2lmZGVmIEdfT1Nf
V0lOMzIKLSAgICBnX2NsZWFyX29iamVjdCgmcHJpdi0+dWRldik7Ci0jZW5kaWYKICAgICBnX3Jl
dHVybl9pZl9mYWlsKHByaXYtPmV2ZW50X3RocmVhZCA9PSBOVUxMKTsKLSNpZm5kZWYgR19PU19X
SU4zMgotICAgIGlmIChwcml2LT5jb250ZXh0KQorICAgIGlmIChwcml2LT5jb250ZXh0KSB7CiAg
ICAgICAgIHNwaWNlX3VzYl9iYWNrZW5kX2RlbGV0ZShwcml2LT5jb250ZXh0KTsKLSNlbmRpZgor
ICAgIH0KICAgICBmcmVlKHByaXYtPmF1dG9fY29ubl9maWx0ZXJfcnVsZXMpOwogICAgIGZyZWUo
cHJpdi0+cmVkaXJlY3Rfb25fY29ubmVjdF9ydWxlcyk7CiAjaWZkZWYgR19PU19XSU4zMgpAQCAt
ODkxLDIwICs4NTksNiBAQCBzdGF0aWMgdm9pZCBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfcmVt
b3ZlX2RldihTcGljZVVzYkRldmljZU1hbmFnZXIgKnNlbGYsCiAgICAgc3BpY2VfdXNiX2Rldmlj
ZV91bnJlZihkZXZpY2UpOwogfQogCi0jaWZkZWYgR19PU19XSU4zMgotc3RhdGljIHZvaWQgc3Bp
Y2VfdXNiX2RldmljZV9tYW5hZ2VyX3VldmVudF9jYihHVWRldkNsaWVudCAgICAgKmNsaWVudCwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VVc2JC
YWNrZW5kRGV2aWNlICpiZGV2LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBnYm9vbGVhbiAgICAgICAgIGFkZCwKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgZ3BvaW50ZXIgICAgICAgICB1c2VyX2RhdGEpCi17Ci0g
ICAgU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICpzZWxmID0gU1BJQ0VfVVNCX0RFVklDRV9NQU5BR0VS
KHVzZXJfZGF0YSk7Ci0KLSAgICBpZiAoYWRkKQotICAgICAgICBzcGljZV91c2JfZGV2aWNlX21h
bmFnZXJfYWRkX2RldihzZWxmLCBiZGV2KTsKLSAgICBlbHNlCi0gICAgICAgIHNwaWNlX3VzYl9k
ZXZpY2VfbWFuYWdlcl9yZW1vdmVfZGV2KHNlbGYsIGJkZXYpOwotfQotI2Vsc2UKIHN0cnVjdCBo
b3RwbHVnX2lkbGVfY2JfYXJncyB7CiAgICAgU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICpzZWxmOwog
ICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2aWNlOwpAQCAtOTQwLDcgKzg5NCw2IEBAIHN0
YXRpYyB2b2lkIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9ob3RwbHVnX2NiKHZvaWQgKnVzZXJf
ZGF0YSwKICAgICBhcmdzLT5hZGRlZCA9IGFkZGVkOwogICAgIGdfaWRsZV9hZGQoc3BpY2VfdXNi
X2RldmljZV9tYW5hZ2VyX2hvdHBsdWdfaWRsZV9jYiwgYXJncyk7CiB9Ci0jZW5kaWYgLy8gVVNF
X1VTQlJFRElSCiAKIHN0YXRpYyB2b2lkIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9jaGFubmVs
X2Nvbm5lY3RfY2IoCiAgICAgR09iamVjdCAqZ29iamVjdCwgR0FzeW5jUmVzdWx0ICpjaGFubmVs
X3JlcywgZ3BvaW50ZXIgdXNlcl9kYXRhKQpkaWZmIC0tZ2l0IGEvc3JjL3dpbi11c2ItZGV2LmMg
Yi9zcmMvd2luLXVzYi1kZXYuYwpkZWxldGVkIGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggYzJhNTEx
NS4uMDAwMDAwMAotLS0gYS9zcmMvd2luLXVzYi1kZXYuYworKysgL2Rldi9udWxsCkBAIC0xLDQz
NiArMCwwIEBACi0vKiAtKi0gTW9kZTogQzsgYy1iYXNpYy1vZmZzZXQ6IDQ7IGluZGVudC10YWJz
LW1vZGU6IG5pbCAtKi0gKi8KLS8qCi0gICBDb3B5cmlnaHQgKEMpIDIwMTIgUmVkIEhhdCwgSW5j
LgotCi0gICBSZWQgSGF0IEF1dGhvcnM6Ci0gICBBcm5vbiBHaWxib2EgPGFnaWxib2FAcmVkaGF0
LmNvbT4KLSAgIFVyaSBMdWJsaW4gICA8dXJpbEByZWRoYXQuY29tPgotCi0gICBUaGlzIGxpYnJh
cnkgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCi0gICBt
b2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGlj
Ci0gICBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9u
OyBlaXRoZXIKLSAgIHZlcnNpb24gMi4xIG9mIHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRp
b24pIGFueSBsYXRlciB2ZXJzaW9uLgotCi0gICBUaGlzIGxpYnJhcnkgaXMgZGlzdHJpYnV0ZWQg
aW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKLSAgIGJ1dCBXSVRIT1VUIEFOWSBX
QVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCi0gICBNRVJDSEFO
VEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdO
VQotICAgTGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KLQot
ICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5l
cmFsIFB1YmxpYwotICAgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCBz
ZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgotKi8KLQotI2luY2x1ZGUgImNvbmZp
Zy5oIgotCi0jaW5jbHVkZSA8d2luZG93cy5oPgotI2luY2x1ZGUgIndpbi11c2ItZGV2LmgiCi0j
aW5jbHVkZSAic3BpY2UtbWFyc2hhbC5oIgotI2luY2x1ZGUgInNwaWNlLXV0aWwuaCIKLQotZW51
bSB7Ci0gICAgUFJPUF8wLAotICAgIFBST1BfUkVESVJFQ1RJTkcKLX07Ci0KLXN0cnVjdCBfR1Vk
ZXZDbGllbnRQcml2YXRlIHsKLSAgICBTcGljZVVzYkJhY2tlbmQgKmN0eDsKLSAgICBHTGlzdCAq
dWRldl9saXN0OwotICAgIEhXTkQgaHduZDsKLSAgICBnYm9vbGVhbiByZWRpcmVjdGluZzsKLX07
Ci0KLSNkZWZpbmUgR19VREVWX0NMSUVOVF9XSU5DTEFTU19OQU1FICBURVhUKCJHX1VERVZfQ0xJ
RU5UIikKLQotc3RhdGljIHZvaWQgZ191ZGV2X2NsaWVudF9pbml0YWJsZV9pZmFjZV9pbml0KEdJ
bml0YWJsZUlmYWNlICAqaWZhY2UpOwotCi1HX0RFRklORV9UWVBFX1dJVEhfQ09ERShHVWRldkNs
aWVudCwgZ191ZGV2X2NsaWVudCwgR19UWVBFX09CSkVDVCwKLSAgICAgICAgICAgICAgICAgICAg
ICAgIEdfQUREX1BSSVZBVEUoR1VkZXZDbGllbnQpCi0gICAgICAgICAgICAgICAgICAgICAgICBH
X0lNUExFTUVOVF9JTlRFUkZBQ0UoR19UWVBFX0lOSVRBQkxFLCBnX3VkZXZfY2xpZW50X2luaXRh
YmxlX2lmYWNlX2luaXQpKQotCi1lbnVtCi17Ci0gICAgVUVWRU5UX1NJR05BTCwKLSAgICBMQVNU
X1NJR05BTCwKLX07Ci0KLXN0YXRpYyBndWludCBzaWduYWxzW0xBU1RfU0lHTkFMXSA9IHsgMCwg
fTsKLXN0YXRpYyBHVWRldkNsaWVudCAqc2luZ2xldG9uID0gTlVMTDsKLQotc3RhdGljIExSRVNV
TFQgQ0FMTEJBQ0sgd25kX3Byb2MoSFdORCBod25kLCBVSU5UIG1lc3NhZ2UsIFdQQVJBTSB3cGFy
YW0sIExQQVJBTSBscGFyYW0pOwotCi0vL3VuY29tbWVudCB0byBkZWJ1ZyBndWRldiBkZXZpY2Ug
bGlzdHMuCi0vLyNkZWZpbmUgREVCVUdfR1VERVZfREVWSUNFX0xJU1RTCi0KLSNpZmRlZiBERUJV
R19HVURFVl9ERVZJQ0VfTElTVFMKLXN0YXRpYyB2b2lkIGdfdWRldl9kZXZpY2VfcHJpbnRfbGlz
dChHTGlzdCAqbCwgY29uc3QgZ2NoYXIgKm1zZyk7Ci0jZWxzZQotc3RhdGljIHZvaWQgZ191ZGV2
X2RldmljZV9wcmludF9saXN0KEdMaXN0ICpsLCBjb25zdCBnY2hhciAqbXNnKSB7fQotI2VuZGlm
Ci1zdGF0aWMgdm9pZCBnX3VkZXZfZGV2aWNlX3ByaW50KFNwaWNlVXNiQmFja2VuZERldmljZSAq
ZGV2LCBjb25zdCBnY2hhciAqbXNnKTsKLQotR1F1YXJrIGdfdWRldl9jbGllbnRfZXJyb3JfcXVh
cmsodm9pZCkKLXsKLSAgICByZXR1cm4gZ19xdWFya19mcm9tX3N0YXRpY19zdHJpbmcoIndpbi1n
dWRldi1jbGllbnQtZXJyb3ItcXVhcmsiKTsKLX0KLQotR1VkZXZDbGllbnQgKmdfdWRldl9jbGll
bnRfbmV3KHZvaWQpCi17Ci0gICAgaWYgKHNpbmdsZXRvbiAhPSBOVUxMKQotICAgICAgICByZXR1
cm4gZ19vYmplY3RfcmVmKHNpbmdsZXRvbik7Ci0KLSAgICBzaW5nbGV0b24gPSBnX2luaXRhYmxl
X25ldyhHX1VERVZfVFlQRV9DTElFTlQsIE5VTEwsIE5VTEwsIE5VTEwpOwotICAgIHJldHVybiBz
aW5nbGV0b247Ci19Ci0KLVNwaWNlVXNiQmFja2VuZCAqZ191ZGV2X2NsaWVudF9nZXRfY29udGV4
dChHVWRldkNsaWVudCAqY2xpZW50KQotewotICAgIHJldHVybiBjbGllbnQtPnByaXYtPmN0eDsK
LX0KLQotLyoKLSAqIGRldnMgW2luLG91dF0gYW4gZW1wdHkgZGV2cyBsaXN0IGluLCBmdWxsIGRl
dnMgbGlzdCBvdXQKLSAqIFJldHVybnM6IG51bWJlci1vZi1kZXZpY2VzLCBvciBhIG5lZ2F0aXZl
IHZhbHVlIG9uIGVycm9yLgotICovCi1zdGF0aWMgc3NpemVfdAotZ191ZGV2X2NsaWVudF9saXN0
X2RldmljZXMoR1VkZXZDbGllbnQgKnNlbGYsIEdMaXN0ICoqZGV2cywKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgIEdFcnJvciAqKmVyciwgY29uc3QgZ2NoYXIgKm5hbWUpCi17Ci0gICAgU3Bp
Y2VVc2JCYWNrZW5kRGV2aWNlICoqbHVzYl9saXN0LCAqKmRldjsKLSAgICBHVWRldkNsaWVudFBy
aXZhdGUgKnByaXY7Ci0gICAgc3NpemVfdCBuOwotCi0gICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwo
R19VREVWX0lTX0NMSUVOVChzZWxmKSwgLTEpOwotICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKGRl
dnMgIT0gTlVMTCwgLTIpOwotCi0gICAgcHJpdiA9IHNlbGYtPnByaXY7Ci0KLSAgICBnX3JldHVy
bl92YWxfaWZfZmFpbChzZWxmLT5wcml2LT5jdHggIT0gTlVMTCwgLTMpOwotCi0gICAgbHVzYl9s
aXN0ID0gc3BpY2VfdXNiX2JhY2tlbmRfZ2V0X2RldmljZV9saXN0KHByaXYtPmN0eCk7Ci0gICAg
aWYgKCFsdXNiX2xpc3QpIHsKLSAgICAgICAgZ19zZXRfZXJyb3IoZXJyLCBHX1VERVZfQ0xJRU5U
X0VSUk9SLCBHX1VERVZfQ0xJRU5UX0xJQlVTQl9GQUlMRUQsCi0gICAgICAgICAgICAgICAgICAg
ICIlczogRXJyb3IgZ2V0dGluZyBVU0IgZGV2aWNlIGxpc3QiLCBuYW1lKTsKLSAgICAgICAgcmV0
dXJuIC00OwotICAgIH0KLQotICAgIG4gPSAwOwotICAgIGZvciAoZGV2ID0gbHVzYl9saXN0OyAq
ZGV2OyBkZXYrKykgewotICAgICAgICAqZGV2cyA9IGdfbGlzdF9wcmVwZW5kKCpkZXZzLCBzcGlj
ZV91c2JfYmFja2VuZF9kZXZpY2VfcmVmKCpkZXYpKTsKLSAgICAgICAgbisrOwotICAgIH0KLSAg
ICBzcGljZV91c2JfYmFja2VuZF9mcmVlX2RldmljZV9saXN0KGx1c2JfbGlzdCk7Ci0KLSAgICBy
ZXR1cm4gbjsKLX0KLQotc3RhdGljIHZvaWQgdW5yZWZlcmVuY2VfYmFja2VuZF9kZXZpY2UoZ3Bv
aW50ZXIgZGF0YSkKLXsKLSAgICBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfdW5yZWYoKFNwaWNl
VXNiQmFja2VuZERldmljZSAqKWRhdGEpOwotfQotCi1zdGF0aWMgdm9pZCBnX3VkZXZfY2xpZW50
X2ZyZWVfZGV2aWNlX2xpc3QoR0xpc3QgKipkZXZzKQotewotICAgIGdfcmV0dXJuX2lmX2ZhaWwo
ZGV2cyAhPSBOVUxMKTsKLSAgICBpZiAoKmRldnMpIHsKLSAgICAgICAgZ19saXN0X2ZyZWVfZnVs
bCgqZGV2cywgdW5yZWZlcmVuY2VfYmFja2VuZF9kZXZpY2UpOwotICAgICAgICAqZGV2cyA9IE5V
TEw7Ci0gICAgfQotfQotCi0KLXN0YXRpYyBnYm9vbGVhbgotZ191ZGV2X2NsaWVudF9pbml0YWJs
ZV9pbml0KEdJbml0YWJsZSAqaW5pdGFibGUsIEdDYW5jZWxsYWJsZSAqY2FuY2VsbGFibGUsCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgR0Vycm9yICoqZXJyKQotewotICAgIEdVZGV2Q2xp
ZW50ICpzZWxmOwotICAgIEdVZGV2Q2xpZW50UHJpdmF0ZSAqcHJpdjsKLSAgICBXTkRDTEFTUyB3
Y2xzOwotCi0gICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwoR19VREVWX0lTX0NMSUVOVChpbml0YWJs
ZSksIEZBTFNFKTsKLSAgICBnX3JldHVybl92YWxfaWZfZmFpbChjYW5jZWxsYWJsZSA9PSBOVUxM
LCBGQUxTRSk7Ci0KLSAgICBzZWxmID0gR19VREVWX0NMSUVOVChpbml0YWJsZSk7Ci0gICAgcHJp
diA9IHNlbGYtPnByaXY7Ci0KLSAgICBwcml2LT5jdHggPSBzcGljZV91c2JfYmFja2VuZF9uZXco
ZXJyKTsKLSAgICBpZiAoIXByaXYtPmN0eCkgewotICAgICAgICByZXR1cm4gRkFMU0U7Ci0gICAg
fQotCi0jaWZkZWYgR19PU19XSU4zMgotI2lmIExJQlVTQl9BUElfVkVSU0lPTiA+PSAweDAxMDAw
MTA2Ci0gICAgbGlidXNiX3NldF9vcHRpb24ocHJpdi0+Y3R4LCBMSUJVU0JfT1BUSU9OX1VTRV9V
U0JESyk7Ci0jZW5kaWYKLSNlbmRpZgotCi0gICAgLyogZ2V0IGluaXRpYWwgZGV2aWNlIGxpc3Qg
Ki8KLSAgICBpZiAoZ191ZGV2X2NsaWVudF9saXN0X2RldmljZXMoc2VsZiwgJnByaXYtPnVkZXZf
bGlzdCwgZXJyLCBfX0ZVTkNUSU9OX18pIDwgMCkgewotICAgICAgICBnb3RvIGdfdWRldl9jbGll
bnRfaW5pdF9mYWlsZWQ7Ci0gICAgfQotCi0gICAgZ191ZGV2X2RldmljZV9wcmludF9saXN0KHBy
aXYtPnVkZXZfbGlzdCwgImluaXQ6IGZpcnN0IGxpc3QgaXM6ICIpOwotCi0gICAgLyogY3JlYXRl
IGEgaGlkZGVuIHdpbmRvdyAqLwotICAgIG1lbXNldCgmd2NscywgMCwgc2l6ZW9mKHdjbHMpKTsK
LSAgICB3Y2xzLmxwZm5XbmRQcm9jID0gd25kX3Byb2M7Ci0gICAgd2Nscy5scHN6Q2xhc3NOYW1l
ID0gR19VREVWX0NMSUVOVF9XSU5DTEFTU19OQU1FOwotICAgIGlmICghUmVnaXN0ZXJDbGFzcygm
d2NscykpIHsKLSAgICAgICAgRFdPUkQgZSA9IEdldExhc3RFcnJvcigpOwotICAgICAgICBnX3dh
cm5pbmcoIlJlZ2lzdGVyQ2xhc3MgZmFpbGVkICwgJWxkIiwgKGxvbmcpZSk7Ci0gICAgICAgIGdf
c2V0X2Vycm9yKGVyciwgR19VREVWX0NMSUVOVF9FUlJPUiwgR19VREVWX0NMSUVOVF9XSU5BUElf
RkFJTEVELAotICAgICAgICAgICAgICAgICAgICAiUmVnaXN0ZXJDbGFzcyBmYWlsZWQ6ICVsZCIs
IChsb25nKWUpOwotICAgICAgICBnb3RvIGdfdWRldl9jbGllbnRfaW5pdF9mYWlsZWQ7Ci0gICAg
fQotICAgIHByaXYtPmh3bmQgPSBDcmVhdGVXaW5kb3coR19VREVWX0NMSUVOVF9XSU5DTEFTU19O
QU1FLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTlVMTCwgMCwgMCwgMCwgMCwgMCwg
TlVMTCwgTlVMTCwgTlVMTCwgTlVMTCk7Ci0gICAgaWYgKCFwcml2LT5od25kKSB7Ci0gICAgICAg
IERXT1JEIGUgPSBHZXRMYXN0RXJyb3IoKTsKLSAgICAgICAgZ193YXJuaW5nKCJDcmVhdGVXaW5k
b3cgZmFpbGVkOiAlbGQiLCAobG9uZyllKTsKLSAgICAgICAgZ19zZXRfZXJyb3IoZXJyLCBHX1VE
RVZfQ0xJRU5UX0VSUk9SLCBHX1VERVZfQ0xJRU5UX0xJQlVTQl9GQUlMRUQsCi0gICAgICAgICAg
ICAgICAgICAgICJDcmVhdGVXaW5kb3cgZmFpbGVkOiAlbGQiLCAobG9uZyllKTsKLSAgICAgICAg
Z290byBnX3VkZXZfY2xpZW50X2luaXRfZmFpbGVkX3VucmVnOwotICAgIH0KLQotICAgIHJldHVy
biBUUlVFOwotCi0gZ191ZGV2X2NsaWVudF9pbml0X2ZhaWxlZF91bnJlZzoKLSAgICBVbnJlZ2lz
dGVyQ2xhc3MoR19VREVWX0NMSUVOVF9XSU5DTEFTU19OQU1FLCBOVUxMKTsKLSBnX3VkZXZfY2xp
ZW50X2luaXRfZmFpbGVkOgotICAgIHJldHVybiBGQUxTRTsKLX0KLQotc3RhdGljIHZvaWQgZ191
ZGV2X2NsaWVudF9pbml0YWJsZV9pZmFjZV9pbml0KEdJbml0YWJsZUlmYWNlICppZmFjZSkKLXsK
LSAgICBpZmFjZS0+aW5pdCA9IGdfdWRldl9jbGllbnRfaW5pdGFibGVfaW5pdDsKLX0KLQotc3Rh
dGljIHZvaWQgcmVwb3J0X29uZV9kZXZpY2UoZ3BvaW50ZXIgZGF0YSwgZ3BvaW50ZXIgc2VsZikK
LXsKLSAgICBnX3NpZ25hbF9lbWl0KHNlbGYsIHNpZ25hbHNbVUVWRU5UX1NJR05BTF0sIDAsIGRh
dGEsIFRSVUUpOwotfQotCi12b2lkIGdfdWRldl9jbGllbnRfcmVwb3J0X2RldmljZXMoR1VkZXZD
bGllbnQgKnNlbGYpCi17Ci0gICAgZ19saXN0X2ZvcmVhY2goc2VsZi0+cHJpdi0+dWRldl9saXN0
LCByZXBvcnRfb25lX2RldmljZSwgc2VsZik7Ci19Ci0KLXN0YXRpYyB2b2lkIGdfdWRldl9jbGll
bnRfaW5pdChHVWRldkNsaWVudCAqc2VsZikKLXsKLSAgICBzZWxmLT5wcml2ID0gZ191ZGV2X2Ns
aWVudF9nZXRfaW5zdGFuY2VfcHJpdmF0ZShzZWxmKTsKLX0KLQotc3RhdGljIHZvaWQgZ191ZGV2
X2NsaWVudF9maW5hbGl6ZShHT2JqZWN0ICpnb2JqZWN0KQotewotICAgIEdVZGV2Q2xpZW50ICpz
ZWxmID0gR19VREVWX0NMSUVOVChnb2JqZWN0KTsKLSAgICBHVWRldkNsaWVudFByaXZhdGUgKnBy
aXYgPSBzZWxmLT5wcml2OwotCi0gICAgc2luZ2xldG9uID0gTlVMTDsKLSAgICBEZXN0cm95V2lu
ZG93KHByaXYtPmh3bmQpOwotICAgIFVucmVnaXN0ZXJDbGFzcyhHX1VERVZfQ0xJRU5UX1dJTkNM
QVNTX05BTUUsIE5VTEwpOwotICAgIGdfdWRldl9jbGllbnRfZnJlZV9kZXZpY2VfbGlzdCgmcHJp
di0+dWRldl9saXN0KTsKLQotICAgIC8qIGZyZWUgYmFja2VuZCBjb250ZXh0ICovCi0gICAgZ193
YXJuX2lmX2ZhaWwocHJpdi0+Y3R4ICE9IE5VTEwpOwotICAgIHNwaWNlX3VzYl9iYWNrZW5kX2Rl
bGV0ZShwcml2LT5jdHgpOwotCi0gICAgLyogQ2hhaW4gdXAgdG8gdGhlIHBhcmVudCBjbGFzcyAq
LwotICAgIGlmIChHX09CSkVDVF9DTEFTUyhnX3VkZXZfY2xpZW50X3BhcmVudF9jbGFzcyktPmZp
bmFsaXplKQotICAgICAgICBHX09CSkVDVF9DTEFTUyhnX3VkZXZfY2xpZW50X3BhcmVudF9jbGFz
cyktPmZpbmFsaXplKGdvYmplY3QpOwotfQotCi1zdGF0aWMgdm9pZCBnX3VkZXZfY2xpZW50X2dl
dF9wcm9wZXJ0eShHT2JqZWN0ICAgICAqZ29iamVjdCwKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGd1aW50ICAgICAgICBwcm9wX2lkLAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgR1ZhbHVlICAgICAgKnZhbHVlLAotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgR1BhcmFtU3BlYyAgKnBzcGVjKQotewotICAgIEdVZGV2
Q2xpZW50ICpzZWxmID0gR19VREVWX0NMSUVOVChnb2JqZWN0KTsKLSAgICBHVWRldkNsaWVudFBy
aXZhdGUgKnByaXYgPSBzZWxmLT5wcml2OwotCi0gICAgc3dpdGNoIChwcm9wX2lkKSB7Ci0gICAg
Y2FzZSBQUk9QX1JFRElSRUNUSU5HOgotICAgICAgICBnX3ZhbHVlX3NldF9ib29sZWFuKHZhbHVl
LCBwcml2LT5yZWRpcmVjdGluZyk7Ci0gICAgICAgIGJyZWFrOwotICAgIGRlZmF1bHQ6Ci0gICAg
ICAgIEdfT0JKRUNUX1dBUk5fSU5WQUxJRF9QUk9QRVJUWV9JRChnb2JqZWN0LCBwcm9wX2lkLCBw
c3BlYyk7Ci0gICAgICAgIGJyZWFrOwotICAgIH0KLX0KLQotc3RhdGljIHZvaWQgaGFuZGxlX2Rl
dl9jaGFuZ2UoR1VkZXZDbGllbnQgKnNlbGYpOwotCi1zdGF0aWMgdm9pZCBnX3VkZXZfY2xpZW50
X3NldF9wcm9wZXJ0eShHT2JqZWN0ICAgICAgICpnb2JqZWN0LAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZ3VpbnQgICAgICAgICAgcHJvcF9pZCwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IEdWYWx1ZSAgKnZhbHVlLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR1BhcmFtU3BlYyAgICAqcHNwZWMpCi17
Ci0gICAgR1VkZXZDbGllbnQgKnNlbGYgPSBHX1VERVZfQ0xJRU5UKGdvYmplY3QpOwotICAgIEdV
ZGV2Q2xpZW50UHJpdmF0ZSAqcHJpdiA9IHNlbGYtPnByaXY7Ci0gICAgZ2Jvb2xlYW4gb2xkX3Zh
bDsKLQotICAgIHN3aXRjaCAocHJvcF9pZCkgewotICAgIGNhc2UgUFJPUF9SRURJUkVDVElORzoK
LSAgICAgICAgb2xkX3ZhbCA9IHByaXYtPnJlZGlyZWN0aW5nOwotICAgICAgICBwcml2LT5yZWRp
cmVjdGluZyA9IGdfdmFsdWVfZ2V0X2Jvb2xlYW4odmFsdWUpOwotICAgICAgICBpZiAob2xkX3Zh
bCAmJiAhcHJpdi0+cmVkaXJlY3RpbmcpIHsKLSAgICAgICAgICAgIC8qIFRoaXMgaXMgYSByZWRp
cmVjdGlvbiBjb21wbGV0aW9uIGNhc2UuCi0gICAgICAgICAgICAgICBJbmplY3QgaG90cGx1ZyBl
dmVudCBpbiBjYXNlIHdlIG1pc3NlZCBkZXZpY2UgY2hhbmdlcwotICAgICAgICAgICAgICAgZHVy
aW5nIHJlZGlyZWN0aW9uIHByb2Nlc3NpbmcuICovCi0gICAgICAgICAgICBoYW5kbGVfZGV2X2No
YW5nZShzZWxmKTsKLSAgICAgICAgfQotICAgICAgICBicmVhazsKLSAgICBkZWZhdWx0OgotICAg
ICAgICBHX09CSkVDVF9XQVJOX0lOVkFMSURfUFJPUEVSVFlfSUQoZ29iamVjdCwgcHJvcF9pZCwg
cHNwZWMpOwotICAgICAgICBicmVhazsKLSAgICB9Ci19Ci0KLXN0YXRpYyB2b2lkIGdfdWRldl9j
bGllbnRfY2xhc3NfaW5pdChHVWRldkNsaWVudENsYXNzICprbGFzcykKLXsKLSAgICBHT2JqZWN0
Q2xhc3MgKmdvYmplY3RfY2xhc3MgPSBHX09CSkVDVF9DTEFTUyhrbGFzcyk7Ci0gICAgR1BhcmFt
U3BlYyAqcHNwZWM7Ci0KLSAgICBnb2JqZWN0X2NsYXNzLT5maW5hbGl6ZSA9IGdfdWRldl9jbGll
bnRfZmluYWxpemU7Ci0gICAgZ29iamVjdF9jbGFzcy0+Z2V0X3Byb3BlcnR5ID0gZ191ZGV2X2Ns
aWVudF9nZXRfcHJvcGVydHk7Ci0gICAgZ29iamVjdF9jbGFzcy0+c2V0X3Byb3BlcnR5ID0gZ191
ZGV2X2NsaWVudF9zZXRfcHJvcGVydHk7Ci0KLSAgICBzaWduYWxzW1VFVkVOVF9TSUdOQUxdID0K
LSAgICAgICAgZ19zaWduYWxfbmV3KCJ1ZXZlbnQiLAotICAgICAgICAgICAgICAgICAgICAgR19P
QkpFQ1RfQ0xBU1NfVFlQRShrbGFzcyksCi0gICAgICAgICAgICAgICAgICAgICBHX1NJR05BTF9S
VU5fRklSU1QsCi0gICAgICAgICAgICAgICAgICAgICBHX1NUUlVDVF9PRkZTRVQoR1VkZXZDbGll
bnRDbGFzcywgdWV2ZW50KSwKLSAgICAgICAgICAgICAgICAgICAgIE5VTEwsIE5VTEwsCi0gICAg
ICAgICAgICAgICAgICAgICBnX2NjbG9zdXJlX3VzZXJfbWFyc2hhbF9WT0lEX19QT0lOVEVSX0JP
T0xFQU4sCi0gICAgICAgICAgICAgICAgICAgICBHX1RZUEVfTk9ORSwKLSAgICAgICAgICAgICAg
ICAgICAgIDIsCi0gICAgICAgICAgICAgICAgICAgICBHX1RZUEVfUE9JTlRFUiwKLSAgICAgICAg
ICAgICAgICAgICAgIEdfVFlQRV9CT09MRUFOKTsKLQotICAgIC8qKgotICAgICogR1VkZXZDbGll
bnQ6OnJlZGlyZWN0aW5nOgotICAgICoKLSAgICAqIFRoaXMgcHJvcGVydHkgaW5kaWNhdGVzIHdo
ZW4gYSByZWRpcmVjdGlvbiBvcGVyYXRpb24KLSAgICAqIGlzIGluIHByb2dyZXNzIG9uIGEgZGV2
aWNlLiBJdCdzIHNldCBiYWNrIHRvIEZBTFNFCi0gICAgKiBvbmNlIHRoZSBkZXZpY2UgaXMgZnVs
bHkgcmVkaXJlY3RlZCB0byB0aGUgZ3Vlc3QuCi0gICAgKi8KLSAgICBwc3BlYyA9IGdfcGFyYW1f
c3BlY19ib29sZWFuKCJyZWRpcmVjdGluZyIsICJSZWRpcmVjdGluZyIsCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAiVVNCIHJlZGlyZWN0aW9uIG9wZXJhdGlvbiBpcyBpbiBwcm9n
cmVzcyIsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGQUxTRSwKLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIEdfUEFSQU1fUkVBRFdSSVRFIHwgR19QQVJBTV9TVEFU
SUNfU1RSSU5HUyk7Ci0KLSAgICBnX29iamVjdF9jbGFzc19pbnN0YWxsX3Byb3BlcnR5KGdvYmpl
Y3RfY2xhc3MsIFBST1BfUkVESVJFQ1RJTkcsIHBzcGVjKTsKLX0KLQotLyogY29tcGFyaW5nIGJ1
czphZGRyIGFuZCB2aWQ6cGlkICovCi1zdGF0aWMgZ2ludCBjb21wYXJlX3VzYl9kZXZpY2VzKGdj
b25zdHBvaW50ZXIgYSwgZ2NvbnN0cG9pbnRlciBiKQotewotICAgIGNvbnN0IFVzYkRldmljZUlu
Zm9ybWF0aW9uICphX2luZm8sICpiX2luZm87Ci0gICAgZ2Jvb2xlYW4gc2FtZV9idXMsIHNhbWVf
YWRkciwgc2FtZV92aWQsIHNhbWVfcGlkOwotICAgIGFfaW5mbyA9IHNwaWNlX3VzYl9iYWNrZW5k
X2RldmljZV9nZXRfaW5mbygoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICopYSk7Ci0gICAgYl9pbmZv
ID0gc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX2dldF9pbmZvKChTcGljZVVzYkJhY2tlbmREZXZp
Y2UgKiliKTsKLQotCi0gICAgc2FtZV9idXMgPSAoYV9pbmZvLT5idXMgPT0gYl9pbmZvLT5idXMp
OwotICAgIHNhbWVfYWRkciA9IChhX2luZm8tPmFkZHJlc3MgPT0gYl9pbmZvLT5hZGRyZXNzKTsK
LSAgICBzYW1lX3ZpZCA9IChhX2luZm8tPnZpZCA9PSBiX2luZm8tPnZpZCk7Ci0gICAgc2FtZV9w
aWQgPSAoYV9pbmZvLT5waWQgPT0gYl9pbmZvLT5waWQpOwotCi0gICAgcmV0dXJuIChzYW1lX2J1
cyAmJiBzYW1lX2FkZHIgJiYgc2FtZV92aWQgJiYgc2FtZV9waWQpID8gMCA6IC0xOwotfQotCi1z
dGF0aWMgdm9pZCB1cGRhdGVfZGV2aWNlX2xpc3QoR1VkZXZDbGllbnQgKnNlbGYsIEdMaXN0ICpu
ZXdfZGV2aWNlX2xpc3QpCi17Ci0gICAgR0xpc3QgKmRldjsKLQotICAgIGZvciAoZGV2ID0gZ19s
aXN0X2ZpcnN0KG5ld19kZXZpY2VfbGlzdCk7IGRldiAhPSBOVUxMOyBkZXYgPSBnX2xpc3RfbmV4
dChkZXYpKSB7Ci0gICAgICAgIEdMaXN0ICpmb3VuZCA9IGdfbGlzdF9maW5kX2N1c3RvbShzZWxm
LT5wcml2LT51ZGV2X2xpc3QsIGRldi0+ZGF0YSwgY29tcGFyZV91c2JfZGV2aWNlcyk7Ci0gICAg
ICAgIGlmIChmb3VuZCAhPSBOVUxMKSB7Ci0gICAgICAgICAgICAvKiBrZWVwIG9sZCBleGlzdGlu
ZyBsaWJ1c2JfZGV2aWNlIGluIHRoZSBuZXcgbGlzdCwgd2hlbgotICAgICAgICAgICAgICAgdXNi
LWRldi1tYW5hZ2VyIHdpbGwgbWFpbnRhaW4gaXRzIG93biBsaXN0IG9mIGxpYnVzYl9kZXZpY2Us
Ci0gICAgICAgICAgICAgICB0aGVzZSBsaXN0cyB3aWxsIGJlIGNvbXBsZXRlbHkgY29uc2lzdGVu
dCAqLwotICAgICAgICAgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICp0ZW1wID0gZm91bmQtPmRh
dGE7Ci0gICAgICAgICAgICBmb3VuZC0+ZGF0YSA9IGRldi0+ZGF0YTsKLSAgICAgICAgICAgIGRl
di0+ZGF0YSA9IHRlbXA7Ci0gICAgICAgIH0KLSAgICB9Ci0KLSAgICBnX3VkZXZfY2xpZW50X2Zy
ZWVfZGV2aWNlX2xpc3QoJnNlbGYtPnByaXYtPnVkZXZfbGlzdCk7Ci0gICAgc2VsZi0+cHJpdi0+
dWRldl9saXN0ID0gbmV3X2RldmljZV9saXN0OwotfQotCi1zdGF0aWMgdm9pZCBub3RpZnlfZGV2
X3N0YXRlX2NoYW5nZShHVWRldkNsaWVudCAqc2VsZiwKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIEdMaXN0ICpvbGRfbGlzdCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIEdMaXN0ICpuZXdfbGlzdCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGdib29sZWFuIGFkZCkKLXsKLSAgICBHTGlzdCAqZGV2OwotCi0gICAgZm9yIChkZXYg
PSBnX2xpc3RfZmlyc3Qob2xkX2xpc3QpOyBkZXYgIT0gTlVMTDsgZGV2ID0gZ19saXN0X25leHQo
ZGV2KSkgewotICAgICAgICBHTGlzdCAqZm91bmQgPSBnX2xpc3RfZmluZF9jdXN0b20obmV3X2xp
c3QsIGRldi0+ZGF0YSwgY29tcGFyZV91c2JfZGV2aWNlcyk7Ci0gICAgICAgIGlmIChmb3VuZCA9
PSBOVUxMKSB7Ci0gICAgICAgICAgICBnX3VkZXZfZGV2aWNlX3ByaW50KGRldi0+ZGF0YSwgYWRk
ID8gImFkZCIgOiAicmVtb3ZlIik7Ci0gICAgICAgICAgICBnX3NpZ25hbF9lbWl0KHNlbGYsIHNp
Z25hbHNbVUVWRU5UX1NJR05BTF0sIDAsIGRldi0+ZGF0YSwgYWRkKTsKLSAgICAgICAgfQotICAg
IH0KLX0KLQotc3RhdGljIHZvaWQgaGFuZGxlX2Rldl9jaGFuZ2UoR1VkZXZDbGllbnQgKnNlbGYp
Ci17Ci0gICAgR1VkZXZDbGllbnRQcml2YXRlICpwcml2ID0gc2VsZi0+cHJpdjsKLSAgICBHRXJy
b3IgKmVyciA9IE5VTEw7Ci0gICAgR0xpc3QgKm5vd19kZXZzID0gTlVMTDsKLQotICAgIGlmIChw
cml2LT5yZWRpcmVjdGluZyA9PSBUUlVFKSB7Ci0gICAgICAgIC8qIE9uIFdpbmRvd3MsIHF1ZXJ5
aW5nIFVTQiBkZXZpY2UgbGlzdCBtYXkgcmV0dXJuIGluY29uc2lzdGVudCByZXN1bHRzCi0gICAg
ICAgICAgIGlmIHBlcmZvcm1lZCBpbiBwYXJhbGxlbCB0byByZWRpcmVjdGlvbiBmbG93LgotICAg
ICAgICAgICBBIHNpbXVsYXRlZCBob3RwbHVnIGV2ZW50IHdpbGwgYmUgaW5qZWN0ZWQgYWZ0ZXIg
cmVkaXJlY3Rpb24KLSAgICAgICAgICAgY29tcGxldGlvbiBpbiBvcmRlciB0byBwcm9jZXNzIHJl
YWwgZGV2aWNlIGxpc3QgY2hhbmdlcyB0aGF0IG1heQotICAgICAgICAgICBoYWQgdGFrZW4gcGxh
Y2UgZHVyaW5nIHJlZGlyZWN0aW9uIHByb2Nlc3MuICovCi0gICAgICAgIHJldHVybjsKLSAgICB9
Ci0KLSAgICBpZihnX3VkZXZfY2xpZW50X2xpc3RfZGV2aWNlcyhzZWxmLCAmbm93X2RldnMsICZl
cnIsIF9fRlVOQ1RJT05fXykgPCAwKSB7Ci0gICAgICAgIGdfd2FybmluZygiY291bGQgbm90IHJl
dHJpZXZlIGRldmljZSBsaXN0Iik7Ci0gICAgICAgIHJldHVybjsKLSAgICB9Ci0KLSAgICBnX3Vk
ZXZfZGV2aWNlX3ByaW50X2xpc3Qobm93X2RldnMsICJoYW5kbGVfZGV2X2NoYW5nZTogY3VycmVu
dCBsaXN0OiIpOwotICAgIGdfdWRldl9kZXZpY2VfcHJpbnRfbGlzdChwcml2LT51ZGV2X2xpc3Qs
ICJoYW5kbGVfZGV2X2NoYW5nZTogcHJldmlvdXMgbGlzdDoiKTsKLQotICAgIC8qIFVucmVnaXN0
ZXIgZGV2aWNlcyB0aGF0IGFyZSBub3QgcHJlc2VudCBhbnltb3JlICovCi0gICAgbm90aWZ5X2Rl
dl9zdGF0ZV9jaGFuZ2Uoc2VsZiwgcHJpdi0+dWRldl9saXN0LCBub3dfZGV2cywgRkFMU0UpOwot
Ci0gICAgLyogUmVnaXN0ZXIgbmV3bHkgaW5zZXJ0ZWQgZGV2aWNlcyAqLwotICAgIG5vdGlmeV9k
ZXZfc3RhdGVfY2hhbmdlKHNlbGYsIG5vd19kZXZzLCBwcml2LT51ZGV2X2xpc3QsIFRSVUUpOwot
Ci0gICAgLyoga2VlcCBtb3N0IHJlY2VudCBpbmZvOiBmcmVlIHByZXZpb3VzIGxpc3QsIGFuZCBr
ZWVwIGN1cnJlbnQgbGlzdCAqLwotICAgIHVwZGF0ZV9kZXZpY2VfbGlzdChzZWxmLCBub3dfZGV2
cyk7Ci19Ci0KLXN0YXRpYyBMUkVTVUxUIENBTExCQUNLIHduZF9wcm9jKEhXTkQgaHduZCwgVUlO
VCBtZXNzYWdlLCBXUEFSQU0gd3BhcmFtLCBMUEFSQU0gbHBhcmFtKQotewotICAgIC8qIE9ubHkg
REJUX0RFVk5PREVTX0NIQU5HRUQgcmVjaWV2ZWQgKi8KLSAgICBpZiAobWVzc2FnZSA9PSBXTV9E
RVZJQ0VDSEFOR0UpIHsKLSAgICAgICAgaGFuZGxlX2Rldl9jaGFuZ2Uoc2luZ2xldG9uKTsKLSAg
ICB9Ci0gICAgcmV0dXJuIERlZldpbmRvd1Byb2MoaHduZCwgbWVzc2FnZSwgd3BhcmFtLCBscGFy
YW0pOwotfQotCi0jaWZkZWYgREVCVUdfR1VERVZfREVWSUNFX0xJU1RTCi1zdGF0aWMgdm9pZCBn
X3VkZXZfZGV2aWNlX3ByaW50X2xpc3QoR0xpc3QgKmwsIGNvbnN0IGdjaGFyICptc2cpCi17Ci0g
ICAgR0xpc3QgKml0OwotCi0gICAgZm9yIChpdCA9IGdfbGlzdF9maXJzdChsKTsgaXQgIT0gTlVM
TDsgaXQ9Z19saXN0X25leHQoaXQpKSB7Ci0gICAgICAgIGdfdWRldl9kZXZpY2VfcHJpbnQoaXQt
PmRhdGEsIG1zZyk7Ci0gICAgfQotfQotI2VuZGlmCi0KLXN0YXRpYyB2b2lkIGdfdWRldl9kZXZp
Y2VfcHJpbnQoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYsIGNvbnN0IGdjaGFyICptc2cpCi17
Ci0gICAgY29uc3QgVXNiRGV2aWNlSW5mb3JtYXRpb24gKmluZm8gPSBzcGljZV91c2JfYmFja2Vu
ZF9kZXZpY2VfZ2V0X2luZm8oZGV2KTsKLQotICAgIFNQSUNFX0RFQlVHKCIlczogJWQuJWQgMHgl
MDR4OjB4JTA0eCBjbGFzcyAlZCIsIG1zZywKLSAgICAgICAgICAgICAgICBpbmZvLT5idXMsIGlu
Zm8tPmFkZHJlc3MsCi0gICAgICAgICAgICAgICAgaW5mby0+dmlkLCBpbmZvLT5waWQsIGluZm8t
PmNsYXNzKTsKLX0KZGlmZiAtLWdpdCBhL3NyYy93aW4tdXNiLWRldi5oIGIvc3JjL3dpbi11c2It
ZGV2LmgKZGVsZXRlZCBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IGZkZmU3M2EuLjAwMDAwMDAKLS0t
IGEvc3JjL3dpbi11c2ItZGV2LmgKKysrIC9kZXYvbnVsbApAQCAtMSw4NCArMCwwIEBACi0vKiAt
Ki0gTW9kZTogQzsgYy1iYXNpYy1vZmZzZXQ6IDQ7IGluZGVudC10YWJzLW1vZGU6IG5pbCAtKi0g
Ki8KLS8qCi0gICBDb3B5cmlnaHQgKEMpIDIwMTIgUmVkIEhhdCwgSW5jLgotCi0gICBSZWQgSGF0
IEF1dGhvcnM6Ci0gICBBcm5vbiBHaWxib2EgPGFnaWxib2FAcmVkaGF0LmNvbT4KLSAgIFVyaSBM
dWJsaW4gICA8dXJpbEByZWRoYXQuY29tPgotCi0gICBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0
d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCi0gICBtb2RpZnkgaXQgdW5kZXIg
dGhlIHRlcm1zIG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCi0gICBMaWNlbnNlIGFz
IHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIKLSAgIHZl
cnNpb24gMi4xIG9mIHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2
ZXJzaW9uLgotCi0gICBUaGlzIGxpYnJhcnkgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhh
dCBpdCB3aWxsIGJlIHVzZWZ1bCwKLSAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91
dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCi0gICBNRVJDSEFOVEFCSUxJVFkgb3IgRklU
TkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQotICAgTGVzc2VyIEdl
bmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KLQotICAgWW91IHNob3VsZCBo
YXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYwotICAg
TGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCBzZWUgPGh0dHA6Ly93d3cu
Z251Lm9yZy9saWNlbnNlcy8+LgotKi8KLSNpZm5kZWYgX19XSU5fVVNCX0RFVl9IX18KLSNkZWZp
bmUgX19XSU5fVVNCX0RFVl9IX18KLQotI2luY2x1ZGUgPGdpby9naW8uaD4KLSNpbmNsdWRlICJ1
c2ItYmFja2VuZC5oIgotCi1HX0JFR0lOX0RFQ0xTCi0KLS8qIEdVZGV2Q2xpZW50ICovCi0KLSNk
ZWZpbmUgR19VREVWX1RZUEVfQ0xJRU5UICAgICAgICAgKGdfdWRldl9jbGllbnRfZ2V0X3R5cGUo
KSkKLSNkZWZpbmUgR19VREVWX0NMSUVOVChvKSAgICAgICAgICAgKEdfVFlQRV9DSEVDS19JTlNU
QU5DRV9DQVNUKChvKSwgR19VREVWX1RZUEVfQ0xJRU5ULCBHVWRldkNsaWVudCkpCi0jZGVmaW5l
IEdfVURFVl9DTElFTlRfQ0xBU1MoaykgICAgIChHX1RZUEVfQ0hFQ0tfQ0xBU1NfQ0FTVCgoayks
IEdfVURFVl9UWVBFX0NMSUVOVCwgR1VkZXZDbGllbnRDbGFzcykpCi0jZGVmaW5lIEdfVURFVl9J
U19DTElFTlQobykgICAgICAgIChHX1RZUEVfQ0hFQ0tfSU5TVEFOQ0VfVFlQRSgobyksIEdfVURF
Vl9UWVBFX0NMSUVOVCkpCi0jZGVmaW5lIEdfVURFVl9JU19DTElFTlRfQ0xBU1MoaykgIChHX1RZ
UEVfQ0hFQ0tfQ0xBU1NfVFlQRSgoayksIEdfVURFVl9UWVBFX0NMSUVOVCkpCi0jZGVmaW5lIEdf
VURFVl9DTElFTlRfR0VUX0NMQVNTKG8pIChHX1RZUEVfSU5TVEFOQ0VfR0VUX0NMQVNTKChvKSwg
R19VREVWX1RZUEVfQ0xJRU5ULCBHVWRldkNsaWVudENsYXNzKSkKLQotdHlwZWRlZiBzdHJ1Y3Qg
X0dVZGV2Q2xpZW50IEdVZGV2Q2xpZW50OwotdHlwZWRlZiBzdHJ1Y3QgX0dVZGV2Q2xpZW50Q2xh
c3MgR1VkZXZDbGllbnRDbGFzczsKLXR5cGVkZWYgc3RydWN0IF9HVWRldkNsaWVudFByaXZhdGUg
R1VkZXZDbGllbnRQcml2YXRlOwotCi1zdHJ1Y3QgX0dVZGV2Q2xpZW50Ci17Ci0gICAgR09iamVj
dCBwYXJlbnQ7Ci0KLSAgICBHVWRldkNsaWVudFByaXZhdGUgKnByaXY7Ci19OwotCi1zdHJ1Y3Qg
X0dVZGV2Q2xpZW50Q2xhc3MKLXsKLSAgICBHT2JqZWN0Q2xhc3MgcGFyZW50X2NsYXNzOwotCi0g
ICAgLyogc2lnbmFscyAqLwotICAgIHZvaWQgKCp1ZXZlbnQpKEdVZGV2Q2xpZW50ICpjbGllbnQs
IFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2aWNlLCBnYm9vbGVhbiBhZGQpOwotfTsKLQotR1R5
cGUgZ191ZGV2X2NsaWVudF9nZXRfdHlwZSh2b2lkKSBHX0dOVUNfQ09OU1Q7Ci1HVWRldkNsaWVu
dCAqZ191ZGV2X2NsaWVudF9uZXcodm9pZCk7Ci1TcGljZVVzYkJhY2tlbmQgKmdfdWRldl9jbGll
bnRfZ2V0X2NvbnRleHQoR1VkZXZDbGllbnQgKmNsaWVudCk7Ci12b2lkIGdfdWRldl9jbGllbnRf
cmVwb3J0X2RldmljZXMoR1VkZXZDbGllbnQgKmNsaWVudCk7Ci0KLUdRdWFyayBnX3VkZXZfY2xp
ZW50X2Vycm9yX3F1YXJrKHZvaWQpOwotI2RlZmluZSBHX1VERVZfQ0xJRU5UX0VSUk9SIGdfdWRl
dl9jbGllbnRfZXJyb3JfcXVhcmsoKQotCi0vKioKLSAqIEdVZGV2Q2xpZW50RXJyb3I6Ci0gKiBA
R19VREVWX0NMSUVOVF9FUlJPUl9GQUlMRUQ6IGdlbmVyaWMgZXJyb3IgY29kZQotICogQEdfVURF
Vl9DTElFTlRfTElCVVNCX0ZBSUxFRDogYSBsaWJ1c2IgY2FsbCBmYWlsZWQKLSAqIEBHX1VERVZf
Q0xJRU5UX1dJTkFQSV9GQUlMRUQ6IGEgd2luYXBpIGNhbGwgZmFpbGVkCi0gKgotICogRXJyb3Ig
Y29kZXMgcmV0dXJuZWQgYnkgc3BpY2UtY2xpZW50IEFQSS4KLSAqLwotdHlwZWRlZiBlbnVtCi17
Ci0gICAgR19VREVWX0NMSUVOVF9FUlJPUl9GQUlMRUQgPSAxLAotICAgIEdfVURFVl9DTElFTlRf
TElCVVNCX0ZBSUxFRCwKLSAgICBHX1VERVZfQ0xJRU5UX1dJTkFQSV9GQUlMRUQKLX0gR1VkZXZD
bGllbnRFcnJvcjsKLQotCi1HX0VORF9ERUNMUwotCi0jZW5kaWYgLyogX19XSU5fVVNCX0RFVl9I
X18gKi8KLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KU3BpY2UtZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVk
ZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L3NwaWNlLWRldmVs
