Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 811B9A5215
	for <lists+spice-devel@lfdr.de>; Mon,  2 Sep 2019 10:45:49 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CCB3D898E8;
	Mon,  2 Sep 2019 08:45:47 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 53507898E8
 for <spice-devel@lists.freedesktop.org>; Mon,  2 Sep 2019 08:45:46 +0000 (UTC)
Received: from mail-wr1-f71.google.com (mail-wr1-f71.google.com
 [209.85.221.71])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 857C746217
 for <spice-devel@lists.freedesktop.org>; Mon,  2 Sep 2019 08:45:45 +0000 (UTC)
Received: by mail-wr1-f71.google.com with SMTP id o5so8442790wrg.15
 for <spice-devel@lists.freedesktop.org>; Mon, 02 Sep 2019 01:45:45 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=x/Xdq6jkzEui1l9W7k8jh5dr8hEQFuQo9Qv45KuM9ds=;
 b=gUCLZzfmw5Lu3f+H8ZzAcaixJQEldCnFoxZFwxrx5SswKqq+Sb/COVHe2uNCVeYTW6
 RxuK7wBf4zfygy3iowDXEsHxxdNKNMtuqkpJBSKIb2aCy0ituy7Z3VLi+qWvQwMvYRGb
 0eKVCtg8JsRLLs+Gg/3MWh0HmWbSHIi4sVFPaXu6cvs7gq6a6eVTddR56Ae79y7V03hh
 fFfFZTaSYIo8WFURZZuS6/+jFzNAHt3BonFPYsCWBcPsTntgz28iNGoGtriXTNcQ5AGv
 Ylkg7aXLN8gnzn9GDirNSTyHmyWhb8JKMEfAzt+bExiwjnfw4lbJcxm/nEYZ4iun9MpU
 tBzQ==
X-Gm-Message-State: APjAAAUX6wv1uep64t+fRgitGXS8FWYkgiuRopWDw1qoU8ZC/5wqSXkJ
 iAMv/eDqNCQjQZXLPkxda63rAcW+v2mHxnBk9G6MucQVbt4yhk3Ilgq97WkSNrYJ7LwINJx08Px
 uKQjtHVZAtxoUYBH9MJOGCDCYzVglWzw=
X-Received: by 2002:adf:ea8f:: with SMTP id s15mr26532032wrm.222.1567413944082; 
 Mon, 02 Sep 2019 01:45:44 -0700 (PDT)
X-Google-Smtp-Source: APXvYqxshyjcazf9TXdLuO0dldw4adjEP9WkgaYIHzC9EPoeKd3sHM22wi4j0cZRjb8Pf+Bd+eE4TA==
X-Received: by 2002:adf:ea8f:: with SMTP id s15mr26532005wrm.222.1567413943840; 
 Mon, 02 Sep 2019 01:45:43 -0700 (PDT)
Received: from pinea.redhat.com ([2001:861:3440:6a0:2cf1:592d:314d:825])
 by smtp.gmail.com with ESMTPSA id f23sm15904458wmj.37.2019.09.02.01.45.43
 for <spice-devel@lists.freedesktop.org>
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 02 Sep 2019 01:45:43 -0700 (PDT)
From: Kevin Pouget <kpouget@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Mon,  2 Sep 2019 10:45:32 +0200
Message-Id: <20190902084532.29147-1-kpouget@redhat.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <1882378788.10343741.1567411145297.JavaMail.zimbra@redhat.com>
References: <1882378788.10343741.1567411145297.JavaMail.zimbra@redhat.com>
MIME-Version: 1.0
Subject: [Spice-devel] [PATCH spice-server v2] stream-channel: Add preferred
 video codec capability
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

VGhpcyBwYXRjaCBlbmFibGVzIHRoZSBTUElDRV9ESVNQTEFZX0NBUF9QUkVGX1ZJREVPX0NPREVD
X1RZUEUKY2FwYWJpbGl0eSBmb3IgdGhlIHN0cmVhbS1jaGFubmVsLgoKdmlkZW9fc3RyZWFtX3Bh
cnNlX3ByZWZlcnJlZF9jb2RlY3M6IG5ldyBmdW5jdGlvbiBmb3IgcGFyc2luZyB0aGUKU1BJQ0Ug
cHJvdG9jb2wgbWVzc2FnZS4gVGhpcyBjb2RlIHVzZWQgdG8gaW4gaW5zaWRlCmRjY19oYW5kbGVf
cHJlZmVycmVkX3ZpZGVvX2NvZGVjX3R5cGUuCgpzdHJ1Y3QgU3RyZWFtQ2hhbm5lbENsaWVudDo6
Y2xpZW50X3ByZWZlcnJlZF92aWRlb19jb2RlY3M6IG5ldyBmaWVsZC4KClNpZ25lZC1vZmYtYnk6
IEtldmluIFBvdWdldCA8a3BvdWdldEByZWRoYXQuY29tPgotLS0KdjEtPnYyOgotIHJlbW92ZWQg
ZXh0cmEgaGVhZGVyIChyZWQtY2xpZW50LmgpCi0gcy9zY2MvY2xpZW50CgotLS0KIHNlcnZlci9k
Y2MuYyAgICAgICAgICAgIHwgMzAgKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiBzZXJ2
ZXIvc3RyZWFtLWNoYW5uZWwuYyB8IDM4ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrCiBzZXJ2ZXIvdmlkZW8tc3RyZWFtLmMgICB8IDM1ICsrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrCiBzZXJ2ZXIvdmlkZW8tc3RyZWFtLmggICB8ICAxICsKIDQgZmlsZXMg
Y2hhbmdlZCwgNzUgaW5zZXJ0aW9ucygrKSwgMjkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
c2VydmVyL2RjYy5jIGIvc2VydmVyL2RjYy5jCmluZGV4IDIxZTg1OThlLi41MzhmMWY1MSAxMDA2
NDQKLS0tIGEvc2VydmVyL2RjYy5jCisrKyBiL3NlcnZlci9kY2MuYwpAQCAtMTE1OCwzOCArMTE1
OCwxMCBAQCBzdGF0aWMgdm9pZCBvbl9kaXNwbGF5X3ZpZGVvX2NvZGVjc191cGRhdGUoR09iamVj
dCAqZ29iamVjdCwgR1BhcmFtU3BlYyAqcHNwZWMsCiBzdGF0aWMgaW50IGRjY19oYW5kbGVfcHJl
ZmVycmVkX3ZpZGVvX2NvZGVjX3R5cGUoRGlzcGxheUNoYW5uZWxDbGllbnQgKmRjYywKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZU1zZ2NEaXNw
bGF5UHJlZmVycmVkVmlkZW9Db2RlY1R5cGUgKm1zZykKIHsKLSAgICBnaW50IGksIGxlbjsKLSAg
ICBnaW50IGluZGV4ZXNbU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9FTlVNX0VORF07Ci0gICAgR0Fy
cmF5ICpjbGllbnQ7Ci0KICAgICBnX3JldHVybl92YWxfaWZfZmFpbChtc2ctPm51bV9vZl9jb2Rl
Y3MgPiAwLCBUUlVFKTsKCi0gICAgLyogc2V0IGRlZmF1bHQgdG8gYSBiaWcgYW5kIHBvc2l0aXZl
IG51bWJlciAqLwotICAgIG1lbXNldChpbmRleGVzLCAweDdmLCBzaXplb2YoaW5kZXhlcykpOwot
Ci0gICAgZm9yIChsZW4gPSAwLCBpID0gMDsgaSA8IG1zZy0+bnVtX29mX2NvZGVjczsgaSsrKSB7
Ci0gICAgICAgIGdpbnQgdmlkZW9fY29kZWMgPSBtc2ctPmNvZGVjc1tpXTsKLQotICAgICAgICBp
ZiAodmlkZW9fY29kZWMgPCBTUElDRV9WSURFT19DT0RFQ19UWVBFX01KUEVHIHx8Ci0gICAgICAg
ICAgICB2aWRlb19jb2RlYyA+PSBTUElDRV9WSURFT19DT0RFQ19UWVBFX0VOVU1fRU5EKSB7Ci0g
ICAgICAgICAgICBzcGljZV9kZWJ1ZygiQ2xpZW50IGhhcyBzZW50IHVua25vd24gdmlkZW8tY29k
ZWMgKHZhbHVlICVkIGF0IGluZGV4ICVkKS4gIgotICAgICAgICAgICAgICAgICAgICAgICAgIkln
bm9yaW5nIGFzIHNlcnZlciBjYW4ndCBoYW5kbGUgaXQiLAotICAgICAgICAgICAgICAgICAgICAg
ICAgIHZpZGVvX2NvZGVjLCBpKTsKLSAgICAgICAgICAgIGNvbnRpbnVlOwotICAgICAgICB9Ci0K
LSAgICAgICAgaWYgKGluZGV4ZXNbdmlkZW9fY29kZWNdIDwgU1BJQ0VfVklERU9fQ09ERUNfVFlQ
RV9FTlVNX0VORCkgewotICAgICAgICAgICAgY29udGludWU7Ci0gICAgICAgIH0KLQotICAgICAg
ICBsZW4rKzsKLSAgICAgICAgaW5kZXhlc1t2aWRlb19jb2RlY10gPSBsZW47Ci0gICAgfQotICAg
IGNsaWVudCA9IGdfYXJyYXlfc2l6ZWRfbmV3KEZBTFNFLCBGQUxTRSwgc2l6ZW9mKGdpbnQpLCBT
UElDRV9WSURFT19DT0RFQ19UWVBFX0VOVU1fRU5EKTsKLSAgICBnX2FycmF5X2FwcGVuZF92YWxz
KGNsaWVudCwgaW5kZXhlcywgU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9FTlVNX0VORCk7Ci0KICAg
ICBnX2NsZWFyX3BvaW50ZXIoJmRjYy0+cHJpdi0+Y2xpZW50X3ByZWZlcnJlZF92aWRlb19jb2Rl
Y3MsIGdfYXJyYXlfdW5yZWYpOwotICAgIGRjYy0+cHJpdi0+Y2xpZW50X3ByZWZlcnJlZF92aWRl
b19jb2RlY3MgPSBjbGllbnQ7CisgICAgZGNjLT5wcml2LT5jbGllbnRfcHJlZmVycmVkX3ZpZGVv
X2NvZGVjcyA9IHZpZGVvX3N0cmVhbV9wYXJzZV9wcmVmZXJyZWRfY29kZWNzKG1zZyk7CgogICAg
IC8qIE5ldyBjbGllbnQgcHJlZmVyZW5jZSAqLwogICAgIGRjY191cGRhdGVfcHJlZmVycmVkX3Zp
ZGVvX2NvZGVjcyhkY2MpOwpkaWZmIC0tZ2l0IGEvc2VydmVyL3N0cmVhbS1jaGFubmVsLmMgYi9z
ZXJ2ZXIvc3RyZWFtLWNoYW5uZWwuYwppbmRleCA3OTUzMDE4ZS4uY2MwZWFlNWQgMTAwNjQ0Ci0t
LSBhL3NlcnZlci9zdHJlYW0tY2hhbm5lbC5jCisrKyBiL3NlcnZlci9zdHJlYW0tY2hhbm5lbC5j
CkBAIC01Miw2ICs1Miw5IEBAIHN0cnVjdCBTdHJlYW1DaGFubmVsQ2xpZW50IHsKICAgICAvKiBj
dXJyZW50IHZpZGVvIHN0cmVhbSBpZCwgPDAgaWYgbm90IGluaXRpYWxpemVkIG9yCiAgICAgICog
d2UgYXJlIG5vdCBzZW5kaW5nIGEgc3RyZWFtICovCiAgICAgaW50IHN0cmVhbV9pZDsKKyAgICAv
KiBBcnJheSB3aXRoIFNQSUNFX1ZJREVPX0NPREVDX1RZUEVfRU5VTV9FTkQgZWxlbWVudHMsIHdp
dGggdGhlIGNsaWVudAorICAgICAqIHByZWZlcmVuY2Ugb3JkZXIgKGluZGV4KSBhcyB2YWx1ZSAq
LworICAgIEdBcnJheSAqY2xpZW50X3ByZWZlcnJlZF92aWRlb19jb2RlY3M7CiB9OwoKIHN0cnVj
dCBTdHJlYW1DaGFubmVsQ2xpZW50Q2xhc3MgewpAQCAtMTE0LDE1ICsxMTcsMzAgQEAgdHlwZWRl
ZiBzdHJ1Y3QgU3RyZWFtRGF0YUl0ZW0gewogI2RlZmluZSBQUklNQVJZX1NVUkZBQ0VfSUQgMAoK
IHN0YXRpYyB2b2lkIHN0cmVhbV9jaGFubmVsX2NsaWVudF9vbl9kaXNjb25uZWN0KFJlZENoYW5u
ZWxDbGllbnQgKnJjYyk7CitzdGF0aWMgYm9vbAorc3RyZWFtX2NoYW5uZWxfaGFuZGxlX3ByZWZl
cnJlZF92aWRlb19jb2RlY190eXBlKFJlZENoYW5uZWxDbGllbnQgKnJjYywKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZU1zZ2NEaXNwbGF5UHJl
ZmVycmVkVmlkZW9Db2RlY1R5cGUgKm1zZyk7CgogUkVDT1JERVIoc3RyZWFtX2NoYW5uZWxfZGF0
YSwgMzIsICJTdHJlYW0gY2hhbm5lbCBkYXRhIHBhY2tldCIpOwoKK3N0YXRpYyB2b2lkCitzdHJl
YW1fY2hhbm5lbF9jbGllbnRfZmluYWxpemUoR09iamVjdCAqb2JqZWN0KQoreworICAgIFN0cmVh
bUNoYW5uZWxDbGllbnQgKnNlbGYgPSBTVFJFQU1fQ0hBTk5FTF9DTElFTlQob2JqZWN0KTsKKyAg
ICBnX2NsZWFyX3BvaW50ZXIoJnNlbGYtPmNsaWVudF9wcmVmZXJyZWRfdmlkZW9fY29kZWNzLCBn
X2FycmF5X3VucmVmKTsKKworICAgIEdfT0JKRUNUX0NMQVNTKHN0cmVhbV9jaGFubmVsX2NsaWVu
dF9wYXJlbnRfY2xhc3MpLT5maW5hbGl6ZShvYmplY3QpOworfQorCiBzdGF0aWMgdm9pZAogc3Ry
ZWFtX2NoYW5uZWxfY2xpZW50X2NsYXNzX2luaXQoU3RyZWFtQ2hhbm5lbENsaWVudENsYXNzICpr
bGFzcykKIHsKKyAgICBHT2JqZWN0Q2xhc3MgKm9iamVjdF9jbGFzcyA9IEdfT0JKRUNUX0NMQVNT
KGtsYXNzKTsKKwogICAgIFJlZENoYW5uZWxDbGllbnRDbGFzcyAqY2hhbm5lbF9jbGFzcyA9IFJF
RF9DSEFOTkVMX0NMSUVOVF9DTEFTUyhrbGFzcyk7CgogICAgIGNoYW5uZWxfY2xhc3MtPm9uX2Rp
c2Nvbm5lY3QgPSBzdHJlYW1fY2hhbm5lbF9jbGllbnRfb25fZGlzY29ubmVjdDsKKyAgICBvYmpl
Y3RfY2xhc3MtPmZpbmFsaXplID0gc3RyZWFtX2NoYW5uZWxfY2xpZW50X2ZpbmFsaXplOwogfQoK
IHN0YXRpYyB2b2lkCkBAIC0zMjQsNiArMzQyLDkgQEAgaGFuZGxlX21lc3NhZ2UoUmVkQ2hhbm5l
bENsaWVudCAqcmNjLCB1aW50MTZfdCB0eXBlLCB1aW50MzJfdCBzaXplLCB2b2lkICptc2cpCiAg
ICAgY2FzZSBTUElDRV9NU0dDX0RJU1BMQVlfR0xfRFJBV19ET05FOgogICAgICAgICAvKiBjbGll
bnQgc2hvdWxkIG5vdCBzZW5kIHRoaXMgbWVzc2FnZSAqLwogICAgICAgICByZXR1cm4gZmFsc2U7
CisgICAgY2FzZSBTUElDRV9NU0dDX0RJU1BMQVlfUFJFRkVSUkVEX1ZJREVPX0NPREVDX1RZUEU6
CisgICAgICAgIHJldHVybiBzdHJlYW1fY2hhbm5lbF9oYW5kbGVfcHJlZmVycmVkX3ZpZGVvX2Nv
ZGVjX3R5cGUocmNjLAorICAgICAgICAgICAgKFNwaWNlTXNnY0Rpc3BsYXlQcmVmZXJyZWRWaWRl
b0NvZGVjVHlwZSAqKW1zZyk7CiAgICAgZGVmYXVsdDoKICAgICAgICAgcmV0dXJuIHJlZF9jaGFu
bmVsX2NsaWVudF9oYW5kbGVfbWVzc2FnZShyY2MsIHR5cGUsIHNpemUsIG1zZyk7CiAgICAgfQpA
QCAtMzkwLDYgKzQxMSwyMiBAQCBzdHJlYW1fY2hhbm5lbF9nZXRfc3VwcG9ydGVkX2NvZGVjcyhT
dHJlYW1DaGFubmVsICpjaGFubmVsLCB1aW50OF90ICpvdXRfY29kZWNzKQogICAgIHJldHVybiBu
dW07CiB9Cgorc3RhdGljIGJvb2wKK3N0cmVhbV9jaGFubmVsX2hhbmRsZV9wcmVmZXJyZWRfdmlk
ZW9fY29kZWNfdHlwZShSZWRDaGFubmVsQ2xpZW50ICpyY2MsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VNc2djRGlzcGxheVByZWZlcnJlZFZp
ZGVvQ29kZWNUeXBlICptc2cpCit7CisgICAgU3RyZWFtQ2hhbm5lbENsaWVudCAqY2xpZW50ID0g
U1RSRUFNX0NIQU5ORUxfQ0xJRU5UKHJjYyk7CisKKyAgICBpZiAobXNnLT5udW1fb2ZfY29kZWNz
ID09IDApIHsKKyAgICAgICAgcmV0dXJuIHRydWU7CisgICAgfQorCisgICAgZ19jbGVhcl9wb2lu
dGVyKCZjbGllbnQtPmNsaWVudF9wcmVmZXJyZWRfdmlkZW9fY29kZWNzLCBnX2FycmF5X3VucmVm
KTsKKyAgICBjbGllbnQtPmNsaWVudF9wcmVmZXJyZWRfdmlkZW9fY29kZWNzID0gdmlkZW9fc3Ry
ZWFtX3BhcnNlX3ByZWZlcnJlZF9jb2RlY3MobXNnKTsKKworICAgIHJldHVybiB0cnVlOworfQor
CiBzdGF0aWMgdm9pZAogc3RyZWFtX2NoYW5uZWxfY29ubmVjdChSZWRDaGFubmVsICpyZWRfY2hh
bm5lbCwgUmVkQ2xpZW50ICpyZWRfY2xpZW50LCBSZWRTdHJlYW0gKnN0cmVhbSwKICAgICAgICAg
ICAgICAgICAgICAgICAgaW50IG1pZ3JhdGlvbiwgUmVkQ2hhbm5lbENhcGFiaWxpdGllcyAqY2Fw
cykKQEAgLTQ0OCw2ICs0ODUsNyBAQCBzdHJlYW1fY2hhbm5lbF9jb25zdHJ1Y3RlZChHT2JqZWN0
ICpvYmplY3QpCgogICAgIHJlZF9jaGFubmVsX3NldF9jYXAocmVkX2NoYW5uZWwsIFNQSUNFX0RJ
U1BMQVlfQ0FQX01PTklUT1JTX0NPTkZJRyk7CiAgICAgcmVkX2NoYW5uZWxfc2V0X2NhcChyZWRf
Y2hhbm5lbCwgU1BJQ0VfRElTUExBWV9DQVBfU1RSRUFNX1JFUE9SVCk7CisgICAgcmVkX2NoYW5u
ZWxfc2V0X2NhcChyZWRfY2hhbm5lbCwgU1BJQ0VfRElTUExBWV9DQVBfUFJFRl9WSURFT19DT0RF
Q19UWVBFKTsKCiAgICAgcmVkc19yZWdpc3Rlcl9jaGFubmVsKHJlZHMsIHJlZF9jaGFubmVsKTsK
IH0KZGlmZiAtLWdpdCBhL3NlcnZlci92aWRlby1zdHJlYW0uYyBiL3NlcnZlci92aWRlby1zdHJl
YW0uYwppbmRleCA2YWE4NTlhMC4uNjcxNGQ3ODAgMTAwNjQ0Ci0tLSBhL3NlcnZlci92aWRlby1z
dHJlYW0uYworKysgYi9zZXJ2ZXIvdmlkZW8tc3RyZWFtLmMKQEAgLTQ2OCw2ICs0NjgsNDEgQEAg
c3RhdGljIGJvb2wgdmlkZW9fc3RyZWFtX2FkZF9mcmFtZShEaXNwbGF5Q2hhbm5lbCAqZGlzcGxh
eSwKICAgICByZXR1cm4gRkFMU0U7CiB9CgorLyogUmV0dXJucyBhbiBhcnJheSB3aXRoIFNQSUNF
X1ZJREVPX0NPREVDX1RZUEVfRU5VTV9FTkQgZWxlbWVudHMsCisgKiB3aXRoIHRoZSBjbGllbnQg
cHJlZmVyZW5jZSBvcmRlciAoaW5kZXgpIGFzIHZhbHVlICovCitHQXJyYXkgKnZpZGVvX3N0cmVh
bV9wYXJzZV9wcmVmZXJyZWRfY29kZWNzKFNwaWNlTXNnY0Rpc3BsYXlQcmVmZXJyZWRWaWRlb0Nv
ZGVjVHlwZSAqbXNnKQoreworICAgIGludCBpLCBsZW47CisgICAgaW50IGluZGV4ZXNbU1BJQ0Vf
VklERU9fQ09ERUNfVFlQRV9FTlVNX0VORF07CisgICAgR0FycmF5ICpjbGllbnQ7CisKKyAgICAv
KiBzZXQgZGVmYXVsdCB0byBhIGJpZyBhbmQgcG9zaXRpdmUgbnVtYmVyICovCisgICAgbWVtc2V0
KGluZGV4ZXMsIDB4N2YsIHNpemVvZihpbmRleGVzKSk7CisKKyAgICBmb3IgKGxlbiA9IDAsIGkg
PSAwOyBpIDwgbXNnLT5udW1fb2ZfY29kZWNzOyBpKyspIHsKKyAgICAgICAgU3BpY2VWaWRlb0Nv
ZGVjVHlwZSB2aWRlb19jb2RlYyA9IG1zZy0+Y29kZWNzW2ldOworCisgICAgICAgIGlmICh2aWRl
b19jb2RlYyA8IFNQSUNFX1ZJREVPX0NPREVDX1RZUEVfTUpQRUcgfHwKKyAgICAgICAgICAgIHZp
ZGVvX2NvZGVjID49IFNQSUNFX1ZJREVPX0NPREVDX1RZUEVfRU5VTV9FTkQpIHsKKyAgICAgICAg
ICAgIHNwaWNlX2RlYnVnKCJDbGllbnQgaGFzIHNlbnQgdW5rbm93biB2aWRlby1jb2RlYyAodmFs
dWUgJWQgYXQgaW5kZXggJWQpLiAiCisgICAgICAgICAgICAgICAgICAgICAgICAiSWdub3Jpbmcg
YXMgc2VydmVyIGNhbid0IGhhbmRsZSBpdCIsCisgICAgICAgICAgICAgICAgICAgICAgICAgdmlk
ZW9fY29kZWMsIGkpOworICAgICAgICAgICAgY29udGludWU7CisgICAgICAgIH0KKworICAgICAg
ICBpZiAoaW5kZXhlc1t2aWRlb19jb2RlY10gPCBTUElDRV9WSURFT19DT0RFQ19UWVBFX0VOVU1f
RU5EKSB7CisgICAgICAgICAgICBjb250aW51ZTsKKyAgICAgICAgfQorCisgICAgICAgIGxlbisr
OworICAgICAgICBpbmRleGVzW3ZpZGVvX2NvZGVjXSA9IGxlbjsKKyAgICB9CisgICAgY2xpZW50
ID0gZ19hcnJheV9zaXplZF9uZXcoRkFMU0UsIEZBTFNFLCBzaXplb2YoaW50KSwgU1BJQ0VfVklE
RU9fQ09ERUNfVFlQRV9FTlVNX0VORCk7CisgICAgZ19hcnJheV9hcHBlbmRfdmFscyhjbGllbnQs
IGluZGV4ZXMsIFNQSUNFX1ZJREVPX0NPREVDX1RZUEVfRU5VTV9FTkQpOworCisgICAgcmV0dXJu
IGNsaWVudDsKK30KKwogLyogVE9ETzogZG9jdW1lbnQgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiB0
aGUgMiBmdW5jdGlvbnMgYmVsb3cgKi8KIHZvaWQgdmlkZW9fc3RyZWFtX3RyYWNlX3VwZGF0ZShE
aXNwbGF5Q2hhbm5lbCAqZGlzcGxheSwgRHJhd2FibGUgKmRyYXdhYmxlKQogewpkaWZmIC0tZ2l0
IGEvc2VydmVyL3ZpZGVvLXN0cmVhbS5oIGIvc2VydmVyL3ZpZGVvLXN0cmVhbS5oCmluZGV4IDQ2
YjA3NmZkLi43MzQzNTUxNSAxMDA2NDQKLS0tIGEvc2VydmVyL3ZpZGVvLXN0cmVhbS5oCisrKyBi
L3NlcnZlci92aWRlby1zdHJlYW0uaApAQCAtMTQ3LDYgKzE0Nyw3IEBAIHZvaWQgdmlkZW9fc3Ry
ZWFtX2RldGFjaF9hbmRfc3RvcChEaXNwbGF5Q2hhbm5lbCAqZGlzcGxheSk7CiB2b2lkIHZpZGVv
X3N0cmVhbV90cmFjZV9hZGRfZHJhd2FibGUoRGlzcGxheUNoYW5uZWwgKmRpc3BsYXksIERyYXdh
YmxlICppdGVtKTsKIHZvaWQgdmlkZW9fc3RyZWFtX2RldGFjaF9iZWhpbmQoRGlzcGxheUNoYW5u
ZWwgKmRpc3BsYXksIFFSZWdpb24gKnJlZ2lvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgRHJhd2FibGUgKmRyYXdhYmxlKTsKK0dBcnJheSAqdmlkZW9fc3RyZWFtX3BhcnNlX3By
ZWZlcnJlZF9jb2RlY3MoU3BpY2VNc2djRGlzcGxheVByZWZlcnJlZFZpZGVvQ29kZWNUeXBlICpt
c2cpOwoKIHZvaWQgdmlkZW9fc3RyZWFtX2FnZW50X3VucmVmKERpc3BsYXlDaGFubmVsICpkaXNw
bGF5LCBWaWRlb1N0cmVhbUFnZW50ICphZ2VudCk7CiB2b2lkIHZpZGVvX3N0cmVhbV9hZ2VudF9z
dG9wKFZpZGVvU3RyZWFtQWdlbnQgKmFnZW50KTsKLS0KMi4yMS4wCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApT
cGljZS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9zcGljZS1kZXZlbA==
