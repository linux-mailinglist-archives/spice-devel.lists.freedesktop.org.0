Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 9811112476
	for <lists+spice-devel@lfdr.de>; Fri,  3 May 2019 00:12:17 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 975EB898A3;
	Thu,  2 May 2019 22:12:15 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail.codeweavers.com (mail.codeweavers.com [50.203.203.244])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 759D8898A4
 for <spice-devel@lists.freedesktop.org>; Thu,  2 May 2019 22:12:14 +0000 (UTC)
Received: from jwhite.mn.codeweavers.com ([10.69.137.101])
 by mail.codeweavers.com with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_GCM_SHA256:128)
 (Exim 4.89) (envelope-from <jwhite@codeweavers.com>)
 id 1hMJwv-00084k-9R
 for spice-devel@lists.freedesktop.org; Thu, 02 May 2019 17:13:05 -0500
From: Jeremy White <jwhite@codeweavers.com>
To: spice-devel@lists.freedesktop.org
Date: Thu,  2 May 2019 17:12:08 -0500
Message-Id: <20190502221211.25575-2-jwhite@codeweavers.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20190502221211.25575-1-jwhite@codeweavers.com>
References: <20190502221211.25575-1-jwhite@codeweavers.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; 
 d=codeweavers.com; s=6377696661; h=Content-Transfer-Encoding:Content-Type:
 MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:To:From:Sender:
 Reply-To:Cc:Content-ID:Content-Description:Resent-Date:Resent-From:
 Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:
 List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=6sNrV+dERurdsu8r2sSHR8XUkI1X8WBSTJVbI289npo=; b=KAlShrmzRSs/Kjh9TwFemiS03z
 rxRELd2FU7TtDAemhIyIvanxkH8EPtuGqqZsnQBieoaVkgBDWvoBS8nGcaT/WjJWBQs+qasSWhi2x
 1vmPsY+9m+f9qoAj7kqnqYRcH/f8bFAy7AFNj09LftIOqn4eLqL2ppCJqdyqj7AJbtiM=;
Subject: [Spice-devel] [PATCH v3 x11spice 2/5] Apply Spice style to the
 spice-video-dummy
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RG8gdGhpcyB1c2luZyB0aGUgc3BpY2VfaW5kZW50IHNjcmlwdCB3aGljaCB1c2VzIGluZGVudCB0
byBhcHBseQpjdXJyZW50IFNwaWNlIHN0eWxlcyAoYXMgcGVyIEZyZWRpYW5vIFppZ2xpbyBvbiAy
MDE5LTA1LTAxLgoKU2lnbmVkLW9mZi1ieTogSmVyZW15IFdoaXRlIDxqd2hpdGVAY29kZXdlYXZl
cnMuY29tPgotLS0KdjI6IE9yaWdpbmFsIHZlcnNpb24KdjM6IFJldmlzZWQgdG8gaGF2ZSBjYXNl
IGluZGVudCBhdCAwLCBjdWRkbGUgZWxzZSwgZml4IGZ1bmN0aW9ucwogICAgcmV0dXJuaW5nIEJv
b2wsIGFuZCBwcmVzZXJ2ZSBYb3JnIGZ1bmN0aW9uIGRlY2xhcmF0aW9uIHN0eWxlCi0tLQogZG9j
L3NwaWNlX2luZGVudCAgICAgICAgICAgICAgICAgICAgIHwgIDI2ICstCiBzcGljZS12aWRlby1k
dW1teS9zcmMvZHVtbXkuaCAgICAgICAgfCAgIDkgKy0KIHNwaWNlLXZpZGVvLWR1bW15L3NyYy9k
dW1teV9jdXJzb3IuYyB8ICAyMCArLQogc3BpY2UtdmlkZW8tZHVtbXkvc3JjL2R1bW15X2RyaXZl
ci5jIHwgNDkwICsrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tCiA0IGZpbGVzIGNo
YW5nZWQsIDI3MCBpbnNlcnRpb25zKCspLCAyNzUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
ZG9jL3NwaWNlX2luZGVudCBiL2RvYy9zcGljZV9pbmRlbnQKaW5kZXggMDg1OTVkNS4uNWQ3ZTI5
YSAxMDA3NTUKLS0tIGEvZG9jL3NwaWNlX2luZGVudAorKysgYi9kb2Mvc3BpY2VfaW5kZW50CkBA
IC01LDIxICs1LDM4IEBACiAjICAgeDExc3BpY2UgY29kZSBsYXJnZWx5IGNvbmZvcm0gdG8gdGhl
IFNwaWNlIFByb2plY3QgQ29kaW5nIFN0eWxlLgogIyAgIEl0J3MgcHJlc2VydmVkIGhlcmUgYXMg
YSBmb3JtIG9mIGRvY3VtZW50YXRpb24uCiAKKyMgTm90ZTogU3BpY2UgaXMgbm93IHJlbGF4ZWQg
YWJvdXQgZnVuY3Rpb24gZGVjbGFyYXRpb25zLAorIyAgICAgICBhbmQgYWxsb3cgZWl0aGVyIHN0
eWxlLCBlLmcuCisjICBjaGFyICpmdW5jKCl7ICBvcgorIworIyAgY2hhciAqCisjICBmdW5kKCl7
CisjICAgVGhhdCByZXF1aXJlcyBjYWxsaW5nIGluZGVudCB3aXRoIHNvbWUgdGhvdWdodGZ1bG5l
c3MKKyMgQnkgZGVmYXVsdCwgaXQgd2lsbCBicmVhayBwcm9jZWR1cmUgdHlwZXMgb250byBuZXds
aW5lcworIyAgIGlmIHlvdSBoYXZlIGEgZmlsZSB0aGF0IGRvZXMgbm90IGRvIHRoYXQsIHlvdSBt
YXkgd2FudAorIyAgIHRvIGFkZAorIyAtLWRvbnQtYnJlYWstcHJvY2VkdXJlLXR5cGUKKyMgdG8g
eW91ciBpbnZvY2F0aW9uLgorCisKIGlmIFsgISAtZiAiJDEiIF0gOyB0aGVuCiAgICAgZWNobyBF
cnJvcjogc3BlY2lmeSBhIGZpbGVuYW1lIHRvIHByb2Nlc3Mgd2l0aCBpbmRlbnQKKyAgICBlY2hv
IFVzYWdlOgorICAgIGVjaG8gICAnc3BpY2VfaW5kZW50IDxmaWxlbmFtZT4gWyBleHRyYS1vcHRp
b25zIF0nCiAgICAgZXhpdCAxCiBmaQorZm5hbWU9IiQxIgorc2hpZnQKIAotaW5kZW50ICIkMSIg
XAoraW5kZW50ICIkZm5hbWUiIFwKICAgLS1uby1zcGFjZS1hZnRlci1mdW5jdGlvbi1jYWxsLW5h
bWVzIFwKLSAgLS1kb250LWJyZWFrLXByb2NlZHVyZS10eXBlIFwKICAgLS1icmFjZXMtYWZ0ZXIt
ZnVuYy1kZWYtbGluZSBcCiAgIC0tYnJhY2VzLW9uLWlmLWxpbmUgXAogICAtLWJyYWNlcy1vbi1z
dHJ1Y3QtZGVjbC1saW5lIFwKICAgLS1saW5lLWxlbmd0aCAxMDAgXAogICAtLW5vLXNwYWNlLWFm
dGVyLXBhcmVudGhlc2VzIFwKICAgLS1uby10YWJzIFwKLSAgLS1jYXNlLWluZGVudGF0aW9uIDQg
XAorICAtLWNhc2UtaW5kZW50YXRpb24gMCBcCiAgIC0tdGFiLXNpemUgNFwKICAgLS1pbmRlbnQt
bGFiZWwgMFwKICAgLS1pbmRlbnQtbGV2ZWwgNFwKQEAgLTI4LDYgKzQ1LDcgQEAgaW5kZW50ICIk
MSIgXAogICAtLXNwYWNlLWFmdGVyLXdoaWxlIFwKICAgLS1zcGFjZS1hZnRlci1jYXN0cyBcCiAg
IC0tc3BhY2UtYWZ0ZXItaWYgXAorICAtLWN1ZGRsZS1lbHNlIFwKICAgLVQgYWdlbnRfdCBcCiAg
IC1UIFNwaWNlQ2hhckRldmljZUluc3RhbmNlIFwKICAgLVQgU3BpY2VDaGFubmVsRXZlbnRJbmZv
IFwKQEAgLTY0LDMgKzgyLDUgQEAgaW5kZW50ICIkMSIgXAogICAtVCB4ZHVtbXlfdCBcCiAgIC1U
IHgxMXNwaWNlX3NlcnZlcl90IFwKICAgLVQgdGVzdF90IFwKKyAgLVQgQm9vbCBcCisgICRACmRp
ZmYgLS1naXQgYS9zcGljZS12aWRlby1kdW1teS9zcmMvZHVtbXkuaCBiL3NwaWNlLXZpZGVvLWR1
bW15L3NyYy9kdW1teS5oCmluZGV4IDhlN2M0M2IuLjY1NzEwZWYgMTAwNjQ0Ci0tLSBhL3NwaWNl
LXZpZGVvLWR1bW15L3NyYy9kdW1teS5oCisrKyBiL3NwaWNlLXZpZGVvLWR1bW15L3NyYy9kdW1t
eS5oCkBAIC0yOSwxNSArMjksMTMgQEAgZXh0ZXJuIHZvaWQgRFVNTVlTaG93Q3Vyc29yKFNjcm5J
bmZvUHRyIHBTY3JuKTsKIGV4dGVybiB2b2lkIERVTU1ZSGlkZUN1cnNvcihTY3JuSW5mb1B0ciBw
U2Nybik7CiAKIC8qIGdsb2JhbHMgKi8KLXR5cGVkZWYgc3RydWN0IF9jb2xvcgotewordHlwZWRl
ZiBzdHJ1Y3QgX2NvbG9yIHsKICAgICBpbnQgcmVkOwogICAgIGludCBncmVlbjsKICAgICBpbnQg
Ymx1ZTsKIH0gZHVtbXlfY29sb3JzOwogCi10eXBlZGVmIHN0cnVjdCBkdW1teVJlYyAKLXsKK3R5
cGVkZWYgc3RydWN0IGR1bW15UmVjIHsKICAgICAvKiBvcHRpb25zICovCiAgICAgT3B0aW9uSW5m
b1B0ciBPcHRpb25zOwogICAgIEJvb2wgc3dDdXJzb3I7CkBAIC01MCwxMCArNDgsOSBAQCB0eXBl
ZGVmIHN0cnVjdCBkdW1teVJlYwogICAgIGludCBjdXJzb3JGRywgY3Vyc29yQkc7CiAKICAgICBk
dW1teV9jb2xvcnMgY29sb3JzWzEwMjRdOwotICAgIEJvb2wgICAgICAgICgqQ3JlYXRlV2luZG93
KSgpIDsgICAgIC8qIHdyYXBwZWQgQ3JlYXRlV2luZG93ICovCisgICAgQm9vbCAoKkNyZWF0ZVdp
bmRvdykgKCk7ICAgIC8qIHdyYXBwZWQgQ3JlYXRlV2luZG93ICovCiAgICAgQm9vbCBwcm9wOwog
fSBEVU1NWVJlYywgKkRVTU1ZUHRyOwogCiAvKiBUaGUgcHJpdmF0ZXMgb2YgdGhlIERVTU1ZIGRy
aXZlciAqLwogI2RlZmluZSBEVU1NWVBUUihwKQkoKERVTU1ZUHRyKSgocCktPmRyaXZlclByaXZh
dGUpKQotCmRpZmYgLS1naXQgYS9zcGljZS12aWRlby1kdW1teS9zcmMvZHVtbXlfY3Vyc29yLmMg
Yi9zcGljZS12aWRlby1kdW1teS9zcmMvZHVtbXlfY3Vyc29yLmMKaW5kZXggZDdjNjdjNi4uZjM4
YWM1MyAxMDA2NDQKLS0tIGEvc3BpY2UtdmlkZW8tZHVtbXkvc3JjL2R1bW15X2N1cnNvci5jCisr
KyBiL3NwaWNlLXZpZGVvLWR1bW15L3NyYy9kdW1teV9jdXJzb3IuYwpAQCAtMTcsNyArMTcsNyBA
QCBkdW1teVNob3dDdXJzb3IoU2NybkluZm9QdHIgcFNjcm4pCiAgICAgRFVNTVlQdHIgZFB0ciA9
IERVTU1ZUFRSKHBTY3JuKTsKIAogICAgIC8qIHR1cm4gY3Vyc29yIG9uICovCi0gICAgZFB0ci0+
RHVtbXlIV0N1cnNvclNob3duID0gVFJVRTsgICAgCisgICAgZFB0ci0+RHVtbXlIV0N1cnNvclNo
b3duID0gVFJVRTsKIH0KIAogc3RhdGljIHZvaWQKQEAgLTI2LDcgKzI2LDcgQEAgZHVtbXlIaWRl
Q3Vyc29yKFNjcm5JbmZvUHRyIHBTY3JuKQogICAgIERVTU1ZUHRyIGRQdHIgPSBEVU1NWVBUUihw
U2Nybik7CiAKICAgICAvKgotICAgICAqIHR1cm4gY3Vyc29yIG9mZiAKKyAgICAgKiB0dXJuIGN1
cnNvciBvZmYKICAgICAgKgogICAgICAqLwogICAgIGRQdHItPkR1bW15SFdDdXJzb3JTaG93biA9
IEZBTFNFOwpAQCAtNDcsNyArNDcsNyBAQCBzdGF0aWMgdm9pZAogZHVtbXlTZXRDdXJzb3JDb2xv
cnMoU2NybkluZm9QdHIgcFNjcm4sIGludCBiZywgaW50IGZnKQogewogICAgIERVTU1ZUHRyIGRQ
dHIgPSBEVU1NWVBUUihwU2Nybik7Ci0gICAgCisKICAgICBkUHRyLT5jdXJzb3JGRyA9IGZnOwog
ICAgIGRQdHItPmN1cnNvckJHID0gYmc7CiB9CkBAIC02MSwxMSArNjEsMTEgQEAgc3RhdGljIEJv
b2wKIGR1bW15VXNlSFdDdXJzb3IoU2NyZWVuUHRyIHBTY3IsIEN1cnNvclB0ciBwQ3VycykKIHsK
ICAgICBEVU1NWVB0ciBkUHRyID0gRFVNTVlQVFIoeGY4NlNjcmVlblRvU2NybihwU2NyKSk7Ci0g
ICAgcmV0dXJuKCFkUHRyLT5zd0N1cnNvcik7CisgICAgcmV0dXJuICghZFB0ci0+c3dDdXJzb3Ip
OwogfQogCiAjaWYgMAotc3RhdGljIHVuc2lnbmVkIGNoYXIqCitzdGF0aWMgdW5zaWduZWQgY2hh
ciAqCiBkdW1teVJlYWxpemVDdXJzb3IoeGY4NkN1cnNvckluZm9QdHIgaW5mb1B0ciwgQ3Vyc29y
UHRyIHBDdXJzKQogewogICAgIHJldHVybiBOVUxMOwpAQCAtNzksNyArNzksOCBAQCBEVU1NWUN1
cnNvckluaXQoU2NyZWVuUHRyIHBTY3JlZW4pCiAKICAgICB4Zjg2Q3Vyc29ySW5mb1B0ciBpbmZv
UHRyOwogICAgIGluZm9QdHIgPSB4Zjg2Q3JlYXRlQ3Vyc29ySW5mb1JlYygpOwotICAgIGlmKCFp
bmZvUHRyKSByZXR1cm4gRkFMU0U7CisgICAgaWYgKCFpbmZvUHRyKQorICAgICAgICByZXR1cm4g
RkFMU0U7CiAKICAgICBkUHRyLT5DdXJzb3JJbmZvID0gaW5mb1B0cjsKIApAQCAtOTQsOSArOTUs
NiBAQCBEVU1NWUN1cnNvckluaXQoU2NyZWVuUHRyIHBTY3JlZW4pCiAgICAgaW5mb1B0ci0+U2hv
d0N1cnNvciA9IGR1bW15U2hvd0N1cnNvcjsKICAgICBpbmZvUHRyLT5Vc2VIV0N1cnNvciA9IGR1
bW15VXNlSFdDdXJzb3I7CiAvKiAgICAgaW5mb1B0ci0+UmVhbGl6ZUN1cnNvciA9IGR1bW15UmVh
bGl6ZUN1cnNvcjsgKi8KLSAgICAKLSAgICByZXR1cm4oeGY4NkluaXRDdXJzb3IocFNjcmVlbiwg
aW5mb1B0cikpOwotfQotCi0KIAorICAgIHJldHVybiAoeGY4NkluaXRDdXJzb3IocFNjcmVlbiwg
aW5mb1B0cikpOworfQpkaWZmIC0tZ2l0IGEvc3BpY2UtdmlkZW8tZHVtbXkvc3JjL2R1bW15X2Ry
aXZlci5jIGIvc3BpY2UtdmlkZW8tZHVtbXkvc3JjL2R1bW15X2RyaXZlci5jCmluZGV4IGI0YjQy
ZjcuLjQ2Y2RlOTAgMTAwNjQ0Ci0tLSBhL3NwaWNlLXZpZGVvLWR1bW15L3NyYy9kdW1teV9kcml2
ZXIuYworKysgYi9zcGljZS12aWRlby1kdW1teS9zcmMvZHVtbXlfZHJpdmVyLmMKQEAgLTQxLDIz
ICs0MSwyMSBAQAogI2luY2x1ZGUgInNlcnZlcm1kLmgiCiAKIC8qIE1hbmRhdG9yeSBmdW5jdGlv
bnMgKi8KLXN0YXRpYyBjb25zdCBPcHRpb25JbmZvUmVjICoJRFVNTVlBdmFpbGFibGVPcHRpb25z
KGludCBjaGlwaWQsIGludCBidXNpZCk7Ci1zdGF0aWMgdm9pZCAgICAgRFVNTVlJZGVudGlmeShp
bnQgZmxhZ3MpOwotc3RhdGljIEJvb2wgICAgIERVTU1ZUHJvYmUoRHJpdmVyUHRyIGRydiwgaW50
IGZsYWdzKTsKLXN0YXRpYyBCb29sICAgICBEVU1NWVByZUluaXQoU2NybkluZm9QdHIgcFNjcm4s
IGludCBmbGFncyk7Ci1zdGF0aWMgQm9vbCAgICAgRFVNTVlTY3JlZW5Jbml0KFNDUkVFTl9JTklU
X0FSR1NfREVDTCk7Ci1zdGF0aWMgQm9vbCAgICAgRFVNTVlFbnRlclZUKFZUX0ZVTkNfQVJHU19E
RUNMKTsKLXN0YXRpYyB2b2lkICAgICBEVU1NWUxlYXZlVlQoVlRfRlVOQ19BUkdTX0RFQ0wpOwot
c3RhdGljIEJvb2wgICAgIERVTU1ZQ2xvc2VTY3JlZW4oQ0xPU0VfU0NSRUVOX0FSR1NfREVDTCk7
Ci1zdGF0aWMgQm9vbCAgICAgRFVNTVlDcmVhdGVXaW5kb3coV2luZG93UHRyIHBXaW4pOwotc3Rh
dGljIHZvaWQgICAgIERVTU1ZRnJlZVNjcmVlbihGUkVFX1NDUkVFTl9BUkdTX0RFQ0wpOwotc3Rh
dGljIE1vZGVTdGF0dXMgRFVNTVlWYWxpZE1vZGUoU0NSTl9BUkdfVFlQRSBhcmcsIERpc3BsYXlN
b2RlUHRyIG1vZGUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb29sIHZlcmJv
c2UsIGludCBmbGFncyk7Ci1zdGF0aWMgQm9vbAlEVU1NWVNhdmVTY3JlZW4oU2NyZWVuUHRyIHBT
Y3JlZW4sIGludCBtb2RlKTsKK3N0YXRpYyBjb25zdCBPcHRpb25JbmZvUmVjICpEVU1NWUF2YWls
YWJsZU9wdGlvbnMoaW50IGNoaXBpZCwgaW50IGJ1c2lkKTsKK3N0YXRpYyB2b2lkIERVTU1ZSWRl
bnRpZnkoaW50IGZsYWdzKTsKK3N0YXRpYyBCb29sIERVTU1ZUHJvYmUoRHJpdmVyUHRyIGRydiwg
aW50IGZsYWdzKTsKK3N0YXRpYyBCb29sIERVTU1ZUHJlSW5pdChTY3JuSW5mb1B0ciBwU2Nybiwg
aW50IGZsYWdzKTsKK3N0YXRpYyBCb29sIERVTU1ZU2NyZWVuSW5pdChTQ1JFRU5fSU5JVF9BUkdT
X0RFQ0wpOworc3RhdGljIEJvb2wgRFVNTVlFbnRlclZUKFZUX0ZVTkNfQVJHU19ERUNMKTsKK3N0
YXRpYyB2b2lkIERVTU1ZTGVhdmVWVChWVF9GVU5DX0FSR1NfREVDTCk7CitzdGF0aWMgQm9vbCBE
VU1NWUNsb3NlU2NyZWVuKENMT1NFX1NDUkVFTl9BUkdTX0RFQ0wpOworc3RhdGljIEJvb2wgRFVN
TVlDcmVhdGVXaW5kb3coV2luZG93UHRyIHBXaW4pOworc3RhdGljIHZvaWQgRFVNTVlGcmVlU2Ny
ZWVuKEZSRUVfU0NSRUVOX0FSR1NfREVDTCk7CitzdGF0aWMgTW9kZVN0YXR1cyBEVU1NWVZhbGlk
TW9kZShTQ1JOX0FSR19UWVBFIGFyZywgRGlzcGxheU1vZGVQdHIgbW9kZSwgQm9vbCB2ZXJib3Nl
LCBpbnQgZmxhZ3MpOworc3RhdGljIEJvb2wgRFVNTVlTYXZlU2NyZWVuKFNjcmVlblB0ciBwU2Ny
ZWVuLCBpbnQgbW9kZSk7CiAKIC8qIEludGVybmFsbHkgdXNlZCBmdW5jdGlvbnMgKi8KLXN0YXRp
YyBCb29sCWR1bW15RHJpdmVyRnVuYyhTY3JuSW5mb1B0ciBwU2NybiwgeG9yZ0RyaXZlckZ1bmNP
cCBvcCwKLQkJCQlwb2ludGVyIHB0cik7CitzdGF0aWMgQm9vbCBkdW1teURyaXZlckZ1bmMoU2Ny
bkluZm9QdHIgcFNjcm4sIHhvcmdEcml2ZXJGdW5jT3Agb3AsIHBvaW50ZXIgcHRyKTsKIAogCiAv
KiBzdGF0aWMgdm9pZCAgICAgRFVNTVlEaXNwbGF5UG93ZXJNYW5hZ2VtZW50U2V0KFNjcm5JbmZv
UHRyIHBTY3JuLCAqLwpAQCAtMTAxLDggKzk5LDggQEAgX1hfRVhQT1JUIERyaXZlclJlYyBEVU1N
WSA9IHsKIH07CiAKIHN0YXRpYyBTeW1UYWJSZWMgRFVNTVlDaGlwc2V0c1tdID0gewotICAgIHsg
RFVNTVlfQ0hJUCwgICAiZHVtbXkiIH0sCi0gICAgeyAtMSwJCSBOVUxMIH0KKyAgICB7RFVNTVlf
Q0hJUCwgImR1bW15In0sCisgICAgey0xLCBOVUxMfQogfTsKIAogdHlwZWRlZiBlbnVtIHsKQEAg
LTExMCwyNiArMTA4LDI1IEBAIHR5cGVkZWYgZW51bSB7CiB9IERVTU1ZT3B0czsKIAogc3RhdGlj
IGNvbnN0IE9wdGlvbkluZm9SZWMgRFVNTVlPcHRpb25zW10gPSB7Ci0gICAgeyBPUFRJT05fU1df
Q1VSU09SLAkiU1djdXJzb3IiLAlPUFRWX0JPT0xFQU4sCXswfSwgRkFMU0UgfSwKLSAgICB7IC0x
LCAgICAgICAgICAgICAgICAgIE5VTEwsICAgICAgICAgICBPUFRWX05PTkUsCXswfSwgRkFMU0Ug
fQorICAgIHtPUFRJT05fU1dfQ1VSU09SLCAiU1djdXJzb3IiLCBPUFRWX0JPT0xFQU4sIHswfSwg
RkFMU0V9LAorICAgIHstMSwgTlVMTCwgT1BUVl9OT05FLCB7MH0sIEZBTFNFfQogfTsKIAogI2lm
ZGVmIFhGcmVlODZMT0FERVIKIAogc3RhdGljIE1PRFVMRVNFVFVQUFJPVE8oZHVtbXlTZXR1cCk7
CiAKLXN0YXRpYyBYRjg2TW9kdWxlVmVyc2lvbkluZm8gZHVtbXlWZXJzUmVjID0KLXsKLQkiZHVt
bXkiLAotCU1PRFVMRVZFTkRPUlNUUklORywKLQlNT0RJTkZPU1RSSU5HMSwKLQlNT0RJTkZPU1RS
SU5HMiwKLQlYT1JHX1ZFUlNJT05fQ1VSUkVOVCwKLQlEVU1NWV9NQUpPUl9WRVJTSU9OLCBEVU1N
WV9NSU5PUl9WRVJTSU9OLCBEVU1NWV9QQVRDSExFVkVMLAotCUFCSV9DTEFTU19WSURFT0RSViwK
LQlBQklfVklERU9EUlZfVkVSU0lPTiwKLQlNT0RfQ0xBU1NfVklERU9EUlYsCi0JezAsMCwwLDB9
CitzdGF0aWMgWEY4Nk1vZHVsZVZlcnNpb25JbmZvIGR1bW15VmVyc1JlYyA9IHsKKyAgICAiZHVt
bXkiLAorICAgIE1PRFVMRVZFTkRPUlNUUklORywKKyAgICBNT0RJTkZPU1RSSU5HMSwKKyAgICBN
T0RJTkZPU1RSSU5HMiwKKyAgICBYT1JHX1ZFUlNJT05fQ1VSUkVOVCwKKyAgICBEVU1NWV9NQUpP
Ul9WRVJTSU9OLCBEVU1NWV9NSU5PUl9WRVJTSU9OLCBEVU1NWV9QQVRDSExFVkVMLAorICAgIEFC
SV9DTEFTU19WSURFT0RSViwKKyAgICBBQklfVklERU9EUlZfVkVSU0lPTiwKKyAgICBNT0RfQ0xB
U1NfVklERU9EUlYsCisgICAgezAsIDAsIDAsIDB9CiB9OwogCiAvKgpAQCAtMTQ0LDIyICsxNDEs
MjMgQEAgZHVtbXlTZXR1cChwb2ludGVyIG1vZHVsZSwgcG9pbnRlciBvcHRzLCBpbnQgKmVycm1h
aiwgaW50ICplcnJtaW4pCiAgICAgc3RhdGljIEJvb2wgc2V0dXBEb25lID0gRkFMU0U7CiAKICAg
ICBpZiAoIXNldHVwRG9uZSkgewotCXNldHVwRG9uZSA9IFRSVUU7CisgICAgICAgIHNldHVwRG9u
ZSA9IFRSVUU7CiAgICAgICAgIHhmODZBZGREcml2ZXIoJkRVTU1ZLCBtb2R1bGUsIEhhdmVEcml2
ZXJGdW5jcyk7CiAKLQkvKgotCSAqIE1vZHVsZXMgdGhhdCB0aGlzIGRyaXZlciBhbHdheXMgcmVx
dWlyZXMgY2FuIGJlIGxvYWRlZCBoZXJlCi0JICogYnkgY2FsbGluZyBMb2FkU3ViTW9kdWxlKCku
Ci0JICovCisgICAgICAgIC8qCisgICAgICAgICAqIE1vZHVsZXMgdGhhdCB0aGlzIGRyaXZlciBh
bHdheXMgcmVxdWlyZXMgY2FuIGJlIGxvYWRlZCBoZXJlCisgICAgICAgICAqIGJ5IGNhbGxpbmcg
TG9hZFN1Yk1vZHVsZSgpLgorICAgICAgICAgKi8KIAotCS8qCi0JICogVGhlIHJldHVybiB2YWx1
ZSBtdXN0IGJlIG5vbi1OVUxMIG9uIHN1Y2Nlc3MgZXZlbiB0aG91Z2ggdGhlcmUKLQkgKiBpcyBu
byBUZWFyRG93blByb2MuCi0JICovCi0JcmV0dXJuIChwb2ludGVyKTE7CisgICAgICAgIC8qCisg
ICAgICAgICAqIFRoZSByZXR1cm4gdmFsdWUgbXVzdCBiZSBub24tTlVMTCBvbiBzdWNjZXNzIGV2
ZW4gdGhvdWdoIHRoZXJlCisgICAgICAgICAqIGlzIG5vIFRlYXJEb3duUHJvYy4KKyAgICAgICAg
ICovCisgICAgICAgIHJldHVybiAocG9pbnRlcikgMTsKICAgICB9IGVsc2UgewotCWlmIChlcnJt
YWopICplcnJtYWogPSBMRFJfT05DRU9OTFk7Ci0JcmV0dXJuIE5VTEw7CisgICAgICAgIGlmIChl
cnJtYWopCisgICAgICAgICAgICAqZXJybWFqID0gTERSX09OQ0VPTkxZOworICAgICAgICByZXR1
cm4gTlVMTDsKICAgICB9CiB9CiAKQEAgLTE3NCwxMiArMTcyLDEyIEBAIERVTU1ZR2V0UmVjKFNj
cm5JbmZvUHRyIHBTY3JuKQogICAgICAqIHRoZSBhbGxvY2F0aW9uIGhhcyBhbHJlYWR5IGJlZW4g
ZG9uZS4KICAgICAgKi8KICAgICBpZiAocFNjcm4tPmRyaXZlclByaXZhdGUgIT0gTlVMTCkKLQly
ZXR1cm4gVFJVRTsKKyAgICAgICAgcmV0dXJuIFRSVUU7CiAKICAgICBwU2Nybi0+ZHJpdmVyUHJp
dmF0ZSA9IHhuZmNhbGxvYyhzaXplb2YoRFVNTVlSZWMpLCAxKTsKIAogICAgIGlmIChwU2Nybi0+
ZHJpdmVyUHJpdmF0ZSA9PSBOVUxMKQotCXJldHVybiBGQUxTRTsKKyAgICAgICAgcmV0dXJuIEZB
TFNFOwogICAgIHJldHVybiBUUlVFOwogfQogCkBAIC0xODcsNyArMTg1LDcgQEAgc3RhdGljIHZv
aWQKIERVTU1ZRnJlZVJlYyhTY3JuSW5mb1B0ciBwU2NybikKIHsKICAgICBpZiAocFNjcm4tPmRy
aXZlclByaXZhdGUgPT0gTlVMTCkKLQlyZXR1cm47CisgICAgICAgIHJldHVybjsKICAgICBmcmVl
KHBTY3JuLT5kcml2ZXJQcml2YXRlKTsKICAgICBwU2Nybi0+ZHJpdmVyUHJpdmF0ZSA9IE5VTEw7
CiB9CkBAIC0yMDIsOCArMjAwLDcgQEAgRFVNTVlBdmFpbGFibGVPcHRpb25zKGludCBjaGlwaWQs
IGludCBidXNpZCkKIHN0YXRpYyB2b2lkCiBEVU1NWUlkZW50aWZ5KGludCBmbGFncykKIHsKLSAg
ICB4Zjg2UHJpbnRDaGlwc2V0cyhEVU1NWV9OQU1FLCAiRHJpdmVyIGZvciBEdW1teSBjaGlwc2V0
cyIsCi0JCQlEVU1NWUNoaXBzZXRzKTsKKyAgICB4Zjg2UHJpbnRDaGlwc2V0cyhEVU1NWV9OQU1F
LCAiRHJpdmVyIGZvciBEdW1teSBjaGlwc2V0cyIsIERVTU1ZQ2hpcHNldHMpOwogfQogCiAvKiBN
YW5kYXRvcnkgKi8KQEAgLTIxNiw1MSArMjEzLDQ5IEBAIERVTU1ZUHJvYmUoRHJpdmVyUHRyIGRy
diwgaW50IGZsYWdzKQogICAgIGludCBpOwogCiAgICAgaWYgKGZsYWdzICYgUFJPQkVfREVURUNU
KQotCXJldHVybiBGQUxTRTsKKyAgICAgICAgcmV0dXJuIEZBTFNFOwogICAgIC8qCiAgICAgICog
RmluZCB0aGUgY29uZmlnIGZpbGUgRGV2aWNlIHNlY3Rpb25zIHRoYXQgbWF0Y2ggdGhpcwogICAg
ICAqIGRyaXZlciwgYW5kIHJldHVybiBpZiB0aGVyZSBhcmUgbm9uZS4KICAgICAgKi8KLSAgICBp
ZiAoKG51bURldlNlY3Rpb25zID0geGY4Nk1hdGNoRGV2aWNlKERVTU1ZX0RSSVZFUl9OQU1FLAot
CQkJCQkgICZkZXZTZWN0aW9ucykpIDw9IDApIHsKLQlyZXR1cm4gRkFMU0U7CisgICAgaWYgKChu
dW1EZXZTZWN0aW9ucyA9IHhmODZNYXRjaERldmljZShEVU1NWV9EUklWRVJfTkFNRSwgJmRldlNl
Y3Rpb25zKSkgPD0gMCkgeworICAgICAgICByZXR1cm4gRkFMU0U7CiAgICAgfQogCiAgICAgbnVt
VXNlZCA9IG51bURldlNlY3Rpb25zOwogCiAgICAgaWYgKG51bVVzZWQgPiAwKSB7CiAKLQlmb3Ig
KGkgPSAwOyBpIDwgbnVtVXNlZDsgaSsrKSB7Ci0JICAgIFNjcm5JbmZvUHRyIHBTY3JuID0gTlVM
TDsKLQkgICAgaW50IGVudGl0eUluZGV4ID0gCi0JCXhmODZDbGFpbU5vU2xvdChkcnYsRFVNTVlf
Q0hJUCxkZXZTZWN0aW9uc1tpXSxUUlVFKTsKLQkgICAgLyogQWxsb2NhdGUgYSBTY3JuSW5mb1Jl
YyBhbmQgY2xhaW0gdGhlIHNsb3QgKi8KLQkgICAgaWYgKChwU2NybiA9IHhmODZBbGxvY2F0ZVNj
cmVlbihkcnYsMCApKSkgewotCQkgICB4Zjg2QWRkRW50aXR5VG9TY3JlZW4ocFNjcm4sZW50aXR5
SW5kZXgpOwotCQkgICAgcFNjcm4tPmRyaXZlclZlcnNpb24gPSBEVU1NWV9WRVJTSU9OOwotCQkg
ICAgcFNjcm4tPmRyaXZlck5hbWUgICAgPSBEVU1NWV9EUklWRVJfTkFNRTsKLQkJICAgIHBTY3Ju
LT5uYW1lICAgICAgICAgID0gRFVNTVlfTkFNRTsKLQkJICAgIHBTY3JuLT5Qcm9iZSAgICAgICAg
ID0gRFVNTVlQcm9iZTsKLQkJICAgIHBTY3JuLT5QcmVJbml0ICAgICAgID0gRFVNTVlQcmVJbml0
OwotCQkgICAgcFNjcm4tPlNjcmVlbkluaXQgICAgPSBEVU1NWVNjcmVlbkluaXQ7Ci0JCSAgICBw
U2Nybi0+U3dpdGNoTW9kZSAgICA9IERVTU1ZU3dpdGNoTW9kZTsKLQkJICAgIHBTY3JuLT5BZGp1
c3RGcmFtZSAgID0gRFVNTVlBZGp1c3RGcmFtZTsKLQkJICAgIHBTY3JuLT5FbnRlclZUICAgICAg
ID0gRFVNTVlFbnRlclZUOwotCQkgICAgcFNjcm4tPkxlYXZlVlQgICAgICAgPSBEVU1NWUxlYXZl
VlQ7Ci0JCSAgICBwU2Nybi0+RnJlZVNjcmVlbiAgICA9IERVTU1ZRnJlZVNjcmVlbjsKLQkJICAg
IHBTY3JuLT5WYWxpZE1vZGUgICAgID0gRFVNTVlWYWxpZE1vZGU7Ci0KLQkJICAgIGZvdW5kU2Ny
ZWVuID0gVFJVRTsKLQkgICAgfQotCX0KLSAgICB9ICAgIAorICAgICAgICBmb3IgKGkgPSAwOyBp
IDwgbnVtVXNlZDsgaSsrKSB7CisgICAgICAgICAgICBTY3JuSW5mb1B0ciBwU2NybiA9IE5VTEw7
CisgICAgICAgICAgICBpbnQgZW50aXR5SW5kZXggPSB4Zjg2Q2xhaW1Ob1Nsb3QoZHJ2LCBEVU1N
WV9DSElQLCBkZXZTZWN0aW9uc1tpXSwgVFJVRSk7CisgICAgICAgICAgICAvKiBBbGxvY2F0ZSBh
IFNjcm5JbmZvUmVjIGFuZCBjbGFpbSB0aGUgc2xvdCAqLworICAgICAgICAgICAgaWYgKChwU2Ny
biA9IHhmODZBbGxvY2F0ZVNjcmVlbihkcnYsIDApKSkgeworICAgICAgICAgICAgICAgIHhmODZB
ZGRFbnRpdHlUb1NjcmVlbihwU2NybiwgZW50aXR5SW5kZXgpOworICAgICAgICAgICAgICAgIHBT
Y3JuLT5kcml2ZXJWZXJzaW9uID0gRFVNTVlfVkVSU0lPTjsKKyAgICAgICAgICAgICAgICBwU2Ny
bi0+ZHJpdmVyTmFtZSA9IERVTU1ZX0RSSVZFUl9OQU1FOworICAgICAgICAgICAgICAgIHBTY3Ju
LT5uYW1lID0gRFVNTVlfTkFNRTsKKyAgICAgICAgICAgICAgICBwU2Nybi0+UHJvYmUgPSBEVU1N
WVByb2JlOworICAgICAgICAgICAgICAgIHBTY3JuLT5QcmVJbml0ID0gRFVNTVlQcmVJbml0Owor
ICAgICAgICAgICAgICAgIHBTY3JuLT5TY3JlZW5Jbml0ID0gRFVNTVlTY3JlZW5Jbml0OworICAg
ICAgICAgICAgICAgIHBTY3JuLT5Td2l0Y2hNb2RlID0gRFVNTVlTd2l0Y2hNb2RlOworICAgICAg
ICAgICAgICAgIHBTY3JuLT5BZGp1c3RGcmFtZSA9IERVTU1ZQWRqdXN0RnJhbWU7CisgICAgICAg
ICAgICAgICAgcFNjcm4tPkVudGVyVlQgPSBEVU1NWUVudGVyVlQ7CisgICAgICAgICAgICAgICAg
cFNjcm4tPkxlYXZlVlQgPSBEVU1NWUxlYXZlVlQ7CisgICAgICAgICAgICAgICAgcFNjcm4tPkZy
ZWVTY3JlZW4gPSBEVU1NWUZyZWVTY3JlZW47CisgICAgICAgICAgICAgICAgcFNjcm4tPlZhbGlk
TW9kZSA9IERVTU1ZVmFsaWRNb2RlOworCisgICAgICAgICAgICAgICAgZm91bmRTY3JlZW4gPSBU
UlVFOworICAgICAgICAgICAgfQorICAgICAgICB9CisgICAgfQogCiAgICAgZnJlZShkZXZTZWN0
aW9ucyk7CiAKICAgICByZXR1cm4gZm91bmRTY3JlZW47CiB9CiAKLSMgZGVmaW5lIFJFVFVSTiBc
CisjZGVmaW5lIFJFVFVSTiBcCiAgICAgeyBEVU1NWUZyZWVSZWMocFNjcm4pO1wKIAkJCSAgICBy
ZXR1cm4gRkFMU0U7XAogCQkJCQkgICAgIH0KQEAgLTI3NSwxMDMgKzI3MCw5NyBAQCBEVU1NWVBy
ZUluaXQoU2NybkluZm9QdHIgcFNjcm4sIGludCBmbGFncykKICAgICBpbnQgbWF4Q2xvY2sgPSAz
MDAwMDA7CiAgICAgR0RldlB0ciBkZXZpY2UgPSB4Zjg2R2V0RW50aXR5SW5mbyhwU2Nybi0+ZW50
aXR5TGlzdFswXSktPmRldmljZTsKIAotICAgIGlmIChmbGFncyAmIFBST0JFX0RFVEVDVCkgCi0J
cmV0dXJuIFRSVUU7Ci0gICAgCisgICAgaWYgKGZsYWdzICYgUFJPQkVfREVURUNUKQorICAgICAg
ICByZXR1cm4gVFJVRTsKKwogICAgIC8qIEFsbG9jYXRlIHRoZSBEdW1teVJlYyBkcml2ZXJQcml2
YXRlICovCiAgICAgaWYgKCFEVU1NWUdldFJlYyhwU2NybikpIHsKLQlyZXR1cm4gRkFMU0U7Cisg
ICAgICAgIHJldHVybiBGQUxTRTsKICAgICB9Ci0gICAgCisKICAgICBkUHRyID0gRFVNTVlQVFIo
cFNjcm4pOwogCi0gICAgcFNjcm4tPmNoaXBzZXQgPSAoY2hhciAqKXhmODZUb2tlblRvU3RyaW5n
KERVTU1ZQ2hpcHNldHMsCi0JCQkJCSAgICAgICBEVU1NWV9DSElQKTsKKyAgICBwU2Nybi0+Y2hp
cHNldCA9IChjaGFyICopIHhmODZUb2tlblRvU3RyaW5nKERVTU1ZQ2hpcHNldHMsIERVTU1ZX0NI
SVApOwogCiAgICAgeGY4NkRydk1zZyhwU2Nybi0+c2NybkluZGV4LCBYX0lORk8sICJDaGlwc2V0
IGlzIGEgRFVNTVlcbiIpOwotICAgIAorCiAgICAgcFNjcm4tPm1vbml0b3IgPSBwU2Nybi0+Y29u
ZlNjcmVlbi0+bW9uaXRvcjsKIAotICAgIGlmICgheGY4NlNldERlcHRoQnBwKHBTY3JuLCAwLCAw
LCAwLCAgU3VwcG9ydDI0YnBwRmIgfCBTdXBwb3J0MzJicHBGYikpCi0JcmV0dXJuIEZBTFNFOwor
ICAgIGlmICgheGY4NlNldERlcHRoQnBwKHBTY3JuLCAwLCAwLCAwLCBTdXBwb3J0MjRicHBGYiB8
IFN1cHBvcnQzMmJwcEZiKSkKKyAgICAgICAgcmV0dXJuIEZBTFNFOwogICAgIGVsc2UgewotCS8q
IENoZWNrIHRoYXQgdGhlIHJldHVybmVkIGRlcHRoIGlzIG9uZSB3ZSBzdXBwb3J0ICovCi0Jc3dp
dGNoIChwU2Nybi0+ZGVwdGgpIHsKLQljYXNlIDg6Ci0JY2FzZSAxNToKLQljYXNlIDE2OgotCWNh
c2UgMjQ6Ci0JY2FzZSAzMDoKLQkgICAgYnJlYWs7Ci0JZGVmYXVsdDoKLQkgICAgeGY4NkRydk1z
ZyhwU2Nybi0+c2NybkluZGV4LCBYX0VSUk9SLAotCQkgICAgICAgIkdpdmVuIGRlcHRoICglZCkg
aXMgbm90IHN1cHBvcnRlZCBieSB0aGlzIGRyaXZlclxuIiwKLQkJICAgICAgIHBTY3JuLT5kZXB0
aCk7Ci0JICAgIHJldHVybiBGQUxTRTsKLQl9CisgICAgICAgIC8qIENoZWNrIHRoYXQgdGhlIHJl
dHVybmVkIGRlcHRoIGlzIG9uZSB3ZSBzdXBwb3J0ICovCisgICAgICAgIHN3aXRjaCAocFNjcm4t
PmRlcHRoKSB7CisgICAgICAgIGNhc2UgODoKKyAgICAgICAgY2FzZSAxNToKKyAgICAgICAgY2Fz
ZSAxNjoKKyAgICAgICAgY2FzZSAyNDoKKyAgICAgICAgY2FzZSAzMDoKKyAgICAgICAgICAgIGJy
ZWFrOworICAgICAgICBkZWZhdWx0OgorICAgICAgICAgICAgeGY4NkRydk1zZyhwU2Nybi0+c2Ny
bkluZGV4LCBYX0VSUk9SLAorICAgICAgICAgICAgICAgICAgICAgICAiR2l2ZW4gZGVwdGggKCVk
KSBpcyBub3Qgc3VwcG9ydGVkIGJ5IHRoaXMgZHJpdmVyXG4iLCBwU2Nybi0+ZGVwdGgpOworICAg
ICAgICAgICAgcmV0dXJuIEZBTFNFOworICAgICAgICB9CiAgICAgfQogCiAgICAgeGY4NlByaW50
RGVwdGhCcHAocFNjcm4pOwogICAgIGlmIChwU2Nybi0+ZGVwdGggPT0gOCkKLQlwU2Nybi0+cmdi
Qml0cyA9IDg7CisgICAgICAgIHBTY3JuLT5yZ2JCaXRzID0gODsKIAogICAgIC8qIEdldCB0aGUg
ZGVwdGgyNCBwaXhtYXAgZm9ybWF0ICovCiAgICAgaWYgKHBTY3JuLT5kZXB0aCA9PSAyNCAmJiBw
aXgyNGJwcCA9PSAwKQotCXBpeDI0YnBwID0geGY4NkdldEJwcEZyb21EZXB0aChwU2NybiwgMjQp
OworICAgICAgICBwaXgyNGJwcCA9IHhmODZHZXRCcHBGcm9tRGVwdGgocFNjcm4sIDI0KTsKIAog
ICAgIC8qCiAgICAgICogVGhpcyBtdXN0IGhhcHBlbiBhZnRlciBwU2Nybi0+ZGlzcGxheSBoYXMg
YmVlbiBzZXQgYmVjYXVzZQogICAgICAqIHhmODZTZXRXZWlnaHQgcmVmZXJlbmNlcyBpdC4KICAg
ICAgKi8KICAgICBpZiAocFNjcm4tPmRlcHRoID4gOCkgewotCS8qIFRoZSBkZWZhdWx0cyBhcmUg
T0sgZm9yIHVzICovCi0JcmdiIHplcm9zID0gezAsIDAsIDB9OwotCi0JaWYgKCF4Zjg2U2V0V2Vp
Z2h0KHBTY3JuLCB6ZXJvcywgemVyb3MpKSB7Ci0JICAgIHJldHVybiBGQUxTRTsKLQl9IGVsc2Ug
ewotCSAgICAvKiBYWFggY2hlY2sgdGhhdCB3ZWlnaHQgcmV0dXJuZWQgaXMgc3VwcG9ydGVkICov
Ci0JICAgIDsKLQl9CisgICAgICAgIC8qIFRoZSBkZWZhdWx0cyBhcmUgT0sgZm9yIHVzICovCisg
ICAgICAgIHJnYiB6ZXJvcyA9IHsgMCwgMCwgMCB9OworCisgICAgICAgIGlmICgheGY4NlNldFdl
aWdodChwU2NybiwgemVyb3MsIHplcm9zKSkgeworICAgICAgICAgICAgcmV0dXJuIEZBTFNFOwor
ICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgLyogWFhYIGNoZWNrIHRoYXQgd2VpZ2h0IHJl
dHVybmVkIGlzIHN1cHBvcnRlZCAqLworICAgICAgICAgICAgOworICAgICAgICB9CiAgICAgfQog
Ci0gICAgaWYgKCF4Zjg2U2V0RGVmYXVsdFZpc3VhbChwU2NybiwgLTEpKSAKLQlyZXR1cm4gRkFM
U0U7CisgICAgaWYgKCF4Zjg2U2V0RGVmYXVsdFZpc3VhbChwU2NybiwgLTEpKQorICAgICAgICBy
ZXR1cm4gRkFMU0U7CiAKICAgICBpZiAocFNjcm4tPmRlcHRoID4gMSkgewotCUdhbW1hIHplcm9z
ID0gezAuMCwgMC4wLCAwLjB9OworICAgICAgICBHYW1tYSB6ZXJvcyA9IHsgMC4wLCAwLjAsIDAu
MCB9OwogCi0JaWYgKCF4Zjg2U2V0R2FtbWEocFNjcm4sIHplcm9zKSkKLQkgICAgcmV0dXJuIEZB
TFNFOworICAgICAgICBpZiAoIXhmODZTZXRHYW1tYShwU2NybiwgemVyb3MpKQorICAgICAgICAg
ICAgcmV0dXJuIEZBTFNFOwogICAgIH0KIAogICAgIHhmODZDb2xsZWN0T3B0aW9ucyhwU2Nybiwg
ZGV2aWNlLT5vcHRpb25zKTsKICAgICAvKiBQcm9jZXNzIHRoZSBvcHRpb25zICovCiAgICAgaWYg
KCEoZFB0ci0+T3B0aW9ucyA9IG1hbGxvYyhzaXplb2YoRFVNTVlPcHRpb25zKSkpKQotCXJldHVy
biBGQUxTRTsKKyAgICAgICAgcmV0dXJuIEZBTFNFOwogICAgIG1lbWNweShkUHRyLT5PcHRpb25z
LCBEVU1NWU9wdGlvbnMsIHNpemVvZihEVU1NWU9wdGlvbnMpKTsKIAogICAgIHhmODZQcm9jZXNz
T3B0aW9ucyhwU2Nybi0+c2NybkluZGV4LCBwU2Nybi0+b3B0aW9ucywgZFB0ci0+T3B0aW9ucyk7
CiAKLSAgICB4Zjg2R2V0T3B0VmFsQm9vbChkUHRyLT5PcHRpb25zLCBPUFRJT05fU1dfQ1VSU09S
LCZkUHRyLT5zd0N1cnNvcik7CisgICAgeGY4NkdldE9wdFZhbEJvb2woZFB0ci0+T3B0aW9ucywg
T1BUSU9OX1NXX0NVUlNPUiwgJmRQdHItPnN3Q3Vyc29yKTsKIAogICAgIGlmIChkZXZpY2UtPnZp
ZGVvUmFtICE9IDApIHsKLQlwU2Nybi0+dmlkZW9SYW0gPSBkZXZpY2UtPnZpZGVvUmFtOwotCXhm
ODZEcnZNc2cocFNjcm4tPnNjcm5JbmRleCwgWF9DT05GSUcsICJWaWRlb1JBTTogJWQga0J5dGVc
biIsCi0JCSAgIHBTY3JuLT52aWRlb1JhbSk7CisgICAgICAgIHBTY3JuLT52aWRlb1JhbSA9IGRl
dmljZS0+dmlkZW9SYW07CisgICAgICAgIHhmODZEcnZNc2cocFNjcm4tPnNjcm5JbmRleCwgWF9D
T05GSUcsICJWaWRlb1JBTTogJWQga0J5dGVcbiIsIHBTY3JuLT52aWRlb1JhbSk7CiAgICAgfSBl
bHNlIHsKLQlwU2Nybi0+dmlkZW9SYW0gPSA0MDk2OwotCXhmODZEcnZNc2cocFNjcm4tPnNjcm5J
bmRleCwgWF9QUk9CRUQsICJWaWRlb1JBTTogJWQga0J5dGVcbiIsCi0JCSAgIHBTY3JuLT52aWRl
b1JhbSk7CisgICAgICAgIHBTY3JuLT52aWRlb1JhbSA9IDQwOTY7CisgICAgICAgIHhmODZEcnZN
c2cocFNjcm4tPnNjcm5JbmRleCwgWF9QUk9CRUQsICJWaWRlb1JBTTogJWQga0J5dGVcbiIsIHBT
Y3JuLT52aWRlb1JhbSk7CiAgICAgfQotICAgIAorCiAgICAgaWYgKGRldmljZS0+ZGFjU3BlZWRz
WzBdICE9IDApIHsKLQltYXhDbG9jayA9IGRldmljZS0+ZGFjU3BlZWRzWzBdOwotCXhmODZEcnZN
c2cocFNjcm4tPnNjcm5JbmRleCwgWF9DT05GSUcsICJNYXggQ2xvY2s6ICVkIGtIelxuIiwKLQkJ
ICAgbWF4Q2xvY2spOworICAgICAgICBtYXhDbG9jayA9IGRldmljZS0+ZGFjU3BlZWRzWzBdOwor
ICAgICAgICB4Zjg2RHJ2TXNnKHBTY3JuLT5zY3JuSW5kZXgsIFhfQ09ORklHLCAiTWF4IENsb2Nr
OiAlZCBrSHpcbiIsIG1heENsb2NrKTsKICAgICB9IGVsc2UgewotCXhmODZEcnZNc2cocFNjcm4t
PnNjcm5JbmRleCwgWF9QUk9CRUQsICJNYXggQ2xvY2s6ICVkIGtIelxuIiwKLQkJICAgbWF4Q2xv
Y2spOworICAgICAgICB4Zjg2RHJ2TXNnKHBTY3JuLT5zY3JuSW5kZXgsIFhfUFJPQkVELCAiTWF4
IENsb2NrOiAlZCBrSHpcbiIsIG1heENsb2NrKTsKICAgICB9CiAKICAgICBwU2Nybi0+cHJvZ0Ns
b2NrID0gVFJVRTsKQEAgLTM3OSwzOCArMzY4LDM3IEBAIERVTU1ZUHJlSW5pdChTY3JuSW5mb1B0
ciBwU2NybiwgaW50IGZsYWdzKQogICAgICAqIFNldHVwIHRoZSBDbG9ja1Jhbmdlcywgd2hpY2gg
ZGVzY3JpYmUgd2hhdCBjbG9jayByYW5nZXMgYXJlIGF2YWlsYWJsZSwKICAgICAgKiBhbmQgd2hh
dCBzb3J0IG9mIG1vZGVzIHRoZXkgY2FuIGJlIHVzZWQgZm9yLgogICAgICAqLwotICAgIGNsb2Nr
UmFuZ2VzID0gKENsb2NrUmFuZ2VQdHIpeG5mY2FsbG9jKHNpemVvZihDbG9ja1JhbmdlKSwgMSk7
CisgICAgY2xvY2tSYW5nZXMgPSAoQ2xvY2tSYW5nZVB0cikgeG5mY2FsbG9jKHNpemVvZihDbG9j
a1JhbmdlKSwgMSk7CiAgICAgY2xvY2tSYW5nZXMtPm5leHQgPSBOVUxMOwogICAgIGNsb2NrUmFu
Z2VzLT5DbG9ja011bEZhY3RvciA9IDE7Ci0gICAgY2xvY2tSYW5nZXMtPm1pbkNsb2NrID0gMTEw
MDA7ICAgLyogZ3Vlc3NlZCDCp8KnwqcgKi8KKyAgICBjbG9ja1Jhbmdlcy0+bWluQ2xvY2sgPSAx
MTAwMDsgIC8qIGd1ZXNzZWQgwqfCp8KnICovCiAgICAgY2xvY2tSYW5nZXMtPm1heENsb2NrID0g
bWF4Q2xvY2s7Ci0gICAgY2xvY2tSYW5nZXMtPmNsb2NrSW5kZXggPSAtMTsJCS8qIHByb2dyYW1t
YWJsZSAqLwotICAgIGNsb2NrUmFuZ2VzLT5pbnRlcmxhY2VBbGxvd2VkID0gVFJVRTsgCisgICAg
Y2xvY2tSYW5nZXMtPmNsb2NrSW5kZXggPSAtMTsgICAvKiBwcm9ncmFtbWFibGUgKi8KKyAgICBj
bG9ja1Jhbmdlcy0+aW50ZXJsYWNlQWxsb3dlZCA9IFRSVUU7CiAgICAgY2xvY2tSYW5nZXMtPmRv
dWJsZVNjYW5BbGxvd2VkID0gVFJVRTsKIAogICAgIC8qIFN1YnRyYWN0IG1lbW9yeSBmb3IgSFcg
Y3Vyc29yICovCiAKIAogICAgIHsKLQlpbnQgYXBlcnR1cmVTaXplID0gKHBTY3JuLT52aWRlb1Jh
bSAqIDEwMjQpOwotCWkgPSB4Zjg2VmFsaWRhdGVNb2RlcyhwU2NybiwgcFNjcm4tPm1vbml0b3It
Pk1vZGVzLAotCQkJICAgICAgcFNjcm4tPmRpc3BsYXktPm1vZGVzLCBjbG9ja1JhbmdlcywKLQkJ
CSAgICAgIE5VTEwsIDI1NiwgRFVNTVlfTUFYX1dJRFRILAotCQkJICAgICAgKDggKiBwU2Nybi0+
Yml0c1BlclBpeGVsKSwKLQkJCSAgICAgIDEyOCwgRFVNTVlfTUFYX0hFSUdIVCwgcFNjcm4tPmRp
c3BsYXktPnZpcnR1YWxYLAotCQkJICAgICAgcFNjcm4tPmRpc3BsYXktPnZpcnR1YWxZLCBhcGVy
dHVyZVNpemUsCi0JCQkgICAgICBMT09LVVBfQkVTVF9SRUZSRVNIKTsKLQotICAgICAgIGlmIChp
ID09IC0xKQotICAgICAgICAgICBSRVRVUk47CisgICAgICAgIGludCBhcGVydHVyZVNpemUgPSAo
cFNjcm4tPnZpZGVvUmFtICogMTAyNCk7CisgICAgICAgIGkgPSB4Zjg2VmFsaWRhdGVNb2Rlcyhw
U2NybiwgcFNjcm4tPm1vbml0b3ItPk1vZGVzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgcFNjcm4tPmRpc3BsYXktPm1vZGVzLCBjbG9ja1JhbmdlcywKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIE5VTEwsIDI1NiwgRFVNTVlfTUFYX1dJRFRILAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgKDggKiBwU2Nybi0+Yml0c1BlclBpeGVsKSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIDEyOCwgRFVNTVlfTUFYX0hFSUdIVCwgcFNjcm4tPmRpc3BsYXktPnZp
cnR1YWxYLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcFNjcm4tPmRpc3BsYXktPnZp
cnR1YWxZLCBhcGVydHVyZVNpemUsIExPT0tVUF9CRVNUX1JFRlJFU0gpOworCisgICAgICAgIGlm
IChpID09IC0xKQorICAgICAgICAgICAgUkVUVVJOOwogICAgIH0KIAogICAgIC8qIFBydW5lIHRo
ZSBtb2RlcyBtYXJrZWQgYXMgaW52YWxpZCAqLwogICAgIHhmODZQcnVuZURyaXZlck1vZGVzKHBT
Y3JuKTsKIAogICAgIGlmIChpID09IDAgfHwgcFNjcm4tPm1vZGVzID09IE5VTEwpIHsKLQl4Zjg2
RHJ2TXNnKHBTY3JuLT5zY3JuSW5kZXgsIFhfRVJST1IsICJObyB2YWxpZCBtb2RlcyBmb3VuZFxu
Iik7Ci0JUkVUVVJOOworICAgICAgICB4Zjg2RHJ2TXNnKHBTY3JuLT5zY3JuSW5kZXgsIFhfRVJS
T1IsICJObyB2YWxpZCBtb2RlcyBmb3VuZFxuIik7CisgICAgICAgIFJFVFVSTjsKICAgICB9CiAK
ICAgICAvKgpAQCAtNDIxLDggKzQwOSw4IEBAIERVTU1ZUHJlSW5pdChTY3JuSW5mb1B0ciBwU2Ny
biwgaW50IGZsYWdzKQogICAgICAqIGRyaXZlciBhbmQgaWYgdGhlIGRyaXZlciBkb2Vzbid0IHBy
b3ZpZGUgY29kZSB0byBzZXQgdGhlbS4gIFRoZXkKICAgICAgKiBhcmUgbm90IHByZS1pbml0aWFs
aXNlZCBhdCBhbGwuCiAgICAgICovCi0gICAgeGY4NlNldENydGNGb3JNb2RlcyhwU2NybiwgMCk7
IAotIAorICAgIHhmODZTZXRDcnRjRm9yTW9kZXMocFNjcm4sIDApOworCiAgICAgLyogU2V0IHRo
ZSBjdXJyZW50IG1vZGUgdG8gdGhlIGZpcnN0IGluIHRoZSBsaXN0ICovCiAgICAgcFNjcm4tPmN1
cnJlbnRNb2RlID0gcFNjcm4tPm1vZGVzOwogCkBAIC00MzMsMjAgKzQyMSwyMSBAQCBEVU1NWVBy
ZUluaXQoU2NybkluZm9QdHIgcFNjcm4sIGludCBmbGFncykKICAgICB4Zjg2U2V0RHBpKHBTY3Ju
LCAwLCAwKTsKIAogICAgIGlmICh4Zjg2TG9hZFN1Yk1vZHVsZShwU2NybiwgImZiIikgPT0gTlVM
TCkgewotCVJFVFVSTjsKKyAgICAgICAgUkVUVVJOOwogICAgIH0KIAogICAgIGlmICghZFB0ci0+
c3dDdXJzb3IpIHsKLQlpZiAoIXhmODZMb2FkU3ViTW9kdWxlKHBTY3JuLCAicmFtZGFjIikpCi0J
ICAgIFJFVFVSTjsKKyAgICAgICAgaWYgKCF4Zjg2TG9hZFN1Yk1vZHVsZShwU2NybiwgInJhbWRh
YyIpKQorICAgICAgICAgICAgUkVUVVJOOwogICAgIH0KLSAgICAKKwogICAgIC8qIFdlIGhhdmUg
bm8gY29udGlndW91cyBwaHlzaWNhbCBmYiBpbiBwaHlzaWNhbCBtZW1vcnkgKi8KICAgICBwU2Ny
bi0+bWVtUGh5c0Jhc2UgPSAwOwogICAgIHBTY3JuLT5mYk9mZnNldCA9IDA7CiAKICAgICByZXR1
cm4gVFJVRTsKIH0KKwogI3VuZGVmIFJFVFVSTgogCiAvKiBNYW5kYXRvcnkgKi8KQEAgLTQ2Mywz
OSArNDUyLDM0IEBAIERVTU1ZTGVhdmVWVChWVF9GVU5DX0FSR1NfREVDTCkKIH0KIAogc3RhdGlj
IHZvaWQKLURVTU1ZTG9hZFBhbGV0dGUoCi0gICBTY3JuSW5mb1B0ciBwU2NybiwKLSAgIGludCBu
dW1Db2xvcnMsCi0gICBpbnQgKmluZGljZXMsCi0gICBMT0NPICpjb2xvcnMsCi0gICBWaXN1YWxQ
dHIgcFZpc3VhbAotKXsKLSAgIGludCBpLCBpbmRleCwgc2hpZnQsIEdzaGlmdDsKLSAgIERVTU1Z
UHRyIGRQdHIgPSBEVU1NWVBUUihwU2Nybik7Ci0KLSAgIHN3aXRjaChwU2Nybi0+ZGVwdGgpIHsK
LSAgIGNhc2UgMTU6CQotCXNoaWZ0ID0gR3NoaWZ0ID0gMTsKLQlicmVhazsKLSAgIGNhc2UgMTY6
Ci0Jc2hpZnQgPSAwOyAKK0RVTU1ZTG9hZFBhbGV0dGUoU2NybkluZm9QdHIgcFNjcm4sIGludCBu
dW1Db2xvcnMsIGludCAqaW5kaWNlcywgTE9DTyAqIGNvbG9ycywgVmlzdWFsUHRyIHBWaXN1YWwp
Cit7CisgICAgaW50IGksIGluZGV4LCBzaGlmdCwgR3NoaWZ0OworICAgIERVTU1ZUHRyIGRQdHIg
PSBEVU1NWVBUUihwU2Nybik7CisKKyAgICBzd2l0Y2ggKHBTY3JuLT5kZXB0aCkgeworICAgIGNh
c2UgMTU6CisgICAgICAgIHNoaWZ0ID0gR3NoaWZ0ID0gMTsKKyAgICAgICAgYnJlYWs7CisgICAg
Y2FzZSAxNjoKKyAgICAgICAgc2hpZnQgPSAwOwogICAgICAgICBHc2hpZnQgPSAwOwotCWJyZWFr
OwotICAgZGVmYXVsdDoKLQlzaGlmdCA9IEdzaGlmdCA9IDA7Ci0JYnJlYWs7Ci0gICB9Ci0KLSAg
IGZvcihpID0gMDsgaSA8IG51bUNvbG9yczsgaSsrKSB7Ci0gICAgICAgaW5kZXggPSBpbmRpY2Vz
W2ldOwotICAgICAgIGRQdHItPmNvbG9yc1tpbmRleF0ucmVkID0gY29sb3JzW2luZGV4XS5yZWQg
PDwgc2hpZnQ7Ci0gICAgICAgZFB0ci0+Y29sb3JzW2luZGV4XS5ncmVlbiA9IGNvbG9yc1tpbmRl
eF0uZ3JlZW4gPDwgR3NoaWZ0OwotICAgICAgIGRQdHItPmNvbG9yc1tpbmRleF0uYmx1ZSA9IGNv
bG9yc1tpbmRleF0uYmx1ZSA8PCBzaGlmdDsKLSAgIH0gCisgICAgICAgIGJyZWFrOworICAgIGRl
ZmF1bHQ6CisgICAgICAgIHNoaWZ0ID0gR3NoaWZ0ID0gMDsKKyAgICAgICAgYnJlYWs7CisgICAg
fQorCisgICAgZm9yIChpID0gMDsgaSA8IG51bUNvbG9yczsgaSsrKSB7CisgICAgICAgIGluZGV4
ID0gaW5kaWNlc1tpXTsKKyAgICAgICAgZFB0ci0+Y29sb3JzW2luZGV4XS5yZWQgPSBjb2xvcnNb
aW5kZXhdLnJlZCA8PCBzaGlmdDsKKyAgICAgICAgZFB0ci0+Y29sb3JzW2luZGV4XS5ncmVlbiA9
IGNvbG9yc1tpbmRleF0uZ3JlZW4gPDwgR3NoaWZ0OworICAgICAgICBkUHRyLT5jb2xvcnNbaW5k
ZXhdLmJsdWUgPSBjb2xvcnNbaW5kZXhdLmJsdWUgPDwgc2hpZnQ7CisgICAgfQogCiB9CiAKLXN0
YXRpYyBTY3JuSW5mb1B0ciBEVU1NWVNjcm47IC8qIHN0YXRpYy1nbG9iYWxpemUgaXQgKi8KK3N0
YXRpYyBTY3JuSW5mb1B0ciBEVU1NWVNjcm47ICAgLyogc3RhdGljLWdsb2JhbGl6ZSBpdCAqLwog
CiAvKiBNYW5kYXRvcnkgKi8KIHN0YXRpYyBCb29sCkBAIC01MTcsMTAyICs1MDEsOTggQEAgRFVN
TVlTY3JlZW5Jbml0KFNDUkVFTl9JTklUX0FSR1NfREVDTCkKIAogCiAgICAgaWYgKCEocGl4ZWxz
ID0gbWFsbG9jKHBTY3JuLT52aWRlb1JhbSAqIDEwMjQpKSkKLQlyZXR1cm4gRkFMU0U7CisgICAg
ICAgIHJldHVybiBGQUxTRTsKIAogICAgIC8qCiAgICAgICogUmVzZXQgdmlzdWFsIGxpc3QuCiAg
ICAgICovCiAgICAgbWlDbGVhclZpc3VhbFR5cGVzKCk7Ci0gICAgCisKICAgICAvKiBTZXR1cCB0
aGUgdmlzdWFscyB3ZSBzdXBwb3J0LiAqLwotICAgIAorCiAgICAgaWYgKCFtaVNldFZpc3VhbFR5
cGVzKHBTY3JuLT5kZXB0aCwKLSAgICAgIAkJICAgICAgbWlHZXREZWZhdWx0VmlzdWFsTWFzayhw
U2Nybi0+ZGVwdGgpLAotCQkgICAgICBwU2Nybi0+cmdiQml0cywgcFNjcm4tPmRlZmF1bHRWaXN1
YWwpKQotICAgICAgICAgcmV0dXJuIEZBTFNFOworICAgICAgICAgICAgICAgICAgICAgICAgICBt
aUdldERlZmF1bHRWaXN1YWxNYXNrKHBTY3JuLT5kZXB0aCksCisgICAgICAgICAgICAgICAgICAg
ICAgICAgIHBTY3JuLT5yZ2JCaXRzLCBwU2Nybi0+ZGVmYXVsdFZpc3VhbCkpCisgICAgICAgIHJl
dHVybiBGQUxTRTsKIAotICAgIGlmICghbWlTZXRQaXhtYXBEZXB0aHMgKCkpIHJldHVybiBGQUxT
RTsKKyAgICBpZiAoIW1pU2V0UGl4bWFwRGVwdGhzKCkpCisgICAgICAgIHJldHVybiBGQUxTRTsK
IAogICAgIC8qCiAgICAgICogQ2FsbCB0aGUgZnJhbWVidWZmZXIgbGF5ZXIncyBTY3JlZW5Jbml0
IGZ1bmN0aW9uLCBhbmQgZmlsbCBpbiBvdGhlcgogICAgICAqIHBTY3JlZW4gZmllbGRzLgogICAg
ICAqLwogICAgIHJldCA9IGZiU2NyZWVuSW5pdChwU2NyZWVuLCBwaXhlbHMsCi0JCQkgICAgcFNj
cm4tPnZpcnR1YWxYLCBwU2Nybi0+dmlydHVhbFksCi0JCQkgICAgcFNjcm4tPnhEcGksIHBTY3Ju
LT55RHBpLAotCQkJICAgIHBTY3JuLT5kaXNwbGF5V2lkdGgsIHBTY3JuLT5iaXRzUGVyUGl4ZWwp
OworICAgICAgICAgICAgICAgICAgICAgICBwU2Nybi0+dmlydHVhbFgsIHBTY3JuLT52aXJ0dWFs
WSwKKyAgICAgICAgICAgICAgICAgICAgICAgcFNjcm4tPnhEcGksIHBTY3JuLT55RHBpLCBwU2Ny
bi0+ZGlzcGxheVdpZHRoLCBwU2Nybi0+Yml0c1BlclBpeGVsKTsKICAgICBpZiAoIXJldCkKLQly
ZXR1cm4gRkFMU0U7CisgICAgICAgIHJldHVybiBGQUxTRTsKIAogICAgIGlmIChwU2Nybi0+ZGVw
dGggPiA4KSB7CiAgICAgICAgIC8qIEZpeHVwIFJHQiBvcmRlcmluZyAqLwogICAgICAgICB2aXN1
YWwgPSBwU2NyZWVuLT52aXN1YWxzICsgcFNjcmVlbi0+bnVtVmlzdWFsczsKICAgICAgICAgd2hp
bGUgKC0tdmlzdWFsID49IHBTY3JlZW4tPnZpc3VhbHMpIHsKLQkgICAgaWYgKCh2aXN1YWwtPmNs
YXNzIHwgRHluYW1pY0NsYXNzKSA9PSBEaXJlY3RDb2xvcikgewotCQl2aXN1YWwtPm9mZnNldFJl
ZCA9IHBTY3JuLT5vZmZzZXQucmVkOwotCQl2aXN1YWwtPm9mZnNldEdyZWVuID0gcFNjcm4tPm9m
ZnNldC5ncmVlbjsKLQkJdmlzdWFsLT5vZmZzZXRCbHVlID0gcFNjcm4tPm9mZnNldC5ibHVlOwot
CQl2aXN1YWwtPnJlZE1hc2sgPSBwU2Nybi0+bWFzay5yZWQ7Ci0JCXZpc3VhbC0+Z3JlZW5NYXNr
ID0gcFNjcm4tPm1hc2suZ3JlZW47Ci0JCXZpc3VhbC0+Ymx1ZU1hc2sgPSBwU2Nybi0+bWFzay5i
bHVlOwotCSAgICB9Ci0JfQorICAgICAgICAgICAgaWYgKCh2aXN1YWwtPmNsYXNzIHwgRHluYW1p
Y0NsYXNzKSA9PSBEaXJlY3RDb2xvcikgeworICAgICAgICAgICAgICAgIHZpc3VhbC0+b2Zmc2V0
UmVkID0gcFNjcm4tPm9mZnNldC5yZWQ7CisgICAgICAgICAgICAgICAgdmlzdWFsLT5vZmZzZXRH
cmVlbiA9IHBTY3JuLT5vZmZzZXQuZ3JlZW47CisgICAgICAgICAgICAgICAgdmlzdWFsLT5vZmZz
ZXRCbHVlID0gcFNjcm4tPm9mZnNldC5ibHVlOworICAgICAgICAgICAgICAgIHZpc3VhbC0+cmVk
TWFzayA9IHBTY3JuLT5tYXNrLnJlZDsKKyAgICAgICAgICAgICAgICB2aXN1YWwtPmdyZWVuTWFz
ayA9IHBTY3JuLT5tYXNrLmdyZWVuOworICAgICAgICAgICAgICAgIHZpc3VhbC0+Ymx1ZU1hc2sg
PSBwU2Nybi0+bWFzay5ibHVlOworICAgICAgICAgICAgfQorICAgICAgICB9CiAgICAgfQotICAg
IAorCiAgICAgLyogbXVzdCBiZSBhZnRlciBSR0Igb3JkZXJpbmcgZml4ZWQgKi8KICAgICBmYlBp
Y3R1cmVJbml0KHBTY3JlZW4sIDAsIDApOwogCiAgICAgeGY4NlNldEJsYWNrV2hpdGVQaXhlbHMo
cFNjcmVlbik7CiAKICAgICBpZiAoZFB0ci0+c3dDdXJzb3IpCi0JeGY4NkRydk1zZyhwU2Nybi0+
c2NybkluZGV4LCBYX0NPTkZJRywgIlVzaW5nIFNvZnR3YXJlIEN1cnNvci5cbiIpOworICAgICAg
ICB4Zjg2RHJ2TXNnKHBTY3JuLT5zY3JuSW5kZXgsIFhfQ09ORklHLCAiVXNpbmcgU29mdHdhcmUg
Q3Vyc29yLlxuIik7CiAKICAgICB7CiAKLQkgCi0JQm94UmVjIEF2YWlsRkJBcmVhOwotCWludCBs
aW5lcyA9IHBTY3JuLT52aWRlb1JhbSAqIDEwMjQgLwotCSAgICAocFNjcm4tPmRpc3BsYXlXaWR0
aCAqIChwU2Nybi0+Yml0c1BlclBpeGVsID4+IDMpKTsKLQlBdmFpbEZCQXJlYS54MSA9IDA7Ci0J
QXZhaWxGQkFyZWEueTEgPSAwOwotCUF2YWlsRkJBcmVhLngyID0gcFNjcm4tPmRpc3BsYXlXaWR0
aDsKLQlBdmFpbEZCQXJlYS55MiA9IGxpbmVzOwotCXhmODZJbml0RkJNYW5hZ2VyKHBTY3JlZW4s
ICZBdmFpbEZCQXJlYSk7IAotCQotCXhmODZEcnZNc2cocFNjcm4tPnNjcm5JbmRleCwgWF9JTkZP
LCAKLQkJICAgIlVzaW5nICVpIHNjYW5saW5lcyBvZiBvZmZzY3JlZW4gbWVtb3J5IFxuIgotCQkg
ICAsIGxpbmVzIC0gcFNjcm4tPnZpcnR1YWxZKTsKKworICAgICAgICBCb3hSZWMgQXZhaWxGQkFy
ZWE7CisgICAgICAgIGludCBsaW5lcyA9IHBTY3JuLT52aWRlb1JhbSAqIDEwMjQgLyAocFNjcm4t
PmRpc3BsYXlXaWR0aCAqIChwU2Nybi0+Yml0c1BlclBpeGVsID4+IDMpKTsKKyAgICAgICAgQXZh
aWxGQkFyZWEueDEgPSAwOworICAgICAgICBBdmFpbEZCQXJlYS55MSA9IDA7CisgICAgICAgIEF2
YWlsRkJBcmVhLngyID0gcFNjcm4tPmRpc3BsYXlXaWR0aDsKKyAgICAgICAgQXZhaWxGQkFyZWEu
eTIgPSBsaW5lczsKKyAgICAgICAgeGY4NkluaXRGQk1hbmFnZXIocFNjcmVlbiwgJkF2YWlsRkJB
cmVhKTsKKworICAgICAgICB4Zjg2RHJ2TXNnKHBTY3JuLT5zY3JuSW5kZXgsIFhfSU5GTywKKyAg
ICAgICAgICAgICAgICAgICAiVXNpbmcgJWkgc2NhbmxpbmVzIG9mIG9mZnNjcmVlbiBtZW1vcnkg
XG4iLCBsaW5lcyAtIHBTY3JuLT52aXJ0dWFsWSk7CiAgICAgfQogCiAgICAgeGY4NlNldEJhY2tp
bmdTdG9yZShwU2NyZWVuKTsKICAgICB4Zjg2U2V0U2lsa2VuTW91c2UocFNjcmVlbik7Ci0JCisK
ICAgICAvKiBJbml0aWFsaXNlIGN1cnNvciBmdW5jdGlvbnMgKi8KLSAgICBtaURDSW5pdGlhbGl6
ZSAocFNjcmVlbiwgeGY4NkdldFBvaW50ZXJTY3JlZW5GdW5jcygpKTsKKyAgICBtaURDSW5pdGlh
bGl6ZShwU2NyZWVuLCB4Zjg2R2V0UG9pbnRlclNjcmVlbkZ1bmNzKCkpOwogCiAKICAgICBpZiAo
IWRQdHItPnN3Q3Vyc29yKSB7Ci0gICAgICAvKiBIVyBjdXJzb3IgZnVuY3Rpb25zICovCi0gICAg
ICBpZiAoIURVTU1ZQ3Vyc29ySW5pdChwU2NyZWVuKSkgewotCSAgeGY4NkRydk1zZyhwU2Nybi0+
c2NybkluZGV4LCBYX0VSUk9SLAotCQkgICAgICJIYXJkd2FyZSBjdXJzb3IgaW5pdGlhbGl6YXRp
b24gZmFpbGVkXG4iKTsKLQkgIHJldHVybiBGQUxTRTsKLSAgICAgIH0KKyAgICAgICAgLyogSFcg
Y3Vyc29yIGZ1bmN0aW9ucyAqLworICAgICAgICBpZiAoIURVTU1ZQ3Vyc29ySW5pdChwU2NyZWVu
KSkgeworICAgICAgICAgICAgeGY4NkRydk1zZyhwU2Nybi0+c2NybkluZGV4LCBYX0VSUk9SLCAi
SGFyZHdhcmUgY3Vyc29yIGluaXRpYWxpemF0aW9uIGZhaWxlZFxuIik7CisgICAgICAgICAgICBy
ZXR1cm4gRkFMU0U7CisgICAgICAgIH0KICAgICB9Ci0gICAgCisKICAgICAvKiBJbml0aWFsaXNl
IGRlZmF1bHQgY29sb3VybWFwICovCi0gICAgaWYoIW1pQ3JlYXRlRGVmQ29sb3JtYXAocFNjcmVl
bikpCi0JcmV0dXJuIEZBTFNFOworICAgIGlmICghbWlDcmVhdGVEZWZDb2xvcm1hcChwU2NyZWVu
KSkKKyAgICAgICAgcmV0dXJuIEZBTFNFOwogCiAgICAgaWYgKCF4Zjg2SGFuZGxlQ29sb3JtYXBz
KHBTY3JlZW4sIDEwMjQsIHBTY3JuLT5yZ2JCaXRzLAotICAgICAgICAgICAgICAgICAgICAgICAg
IERVTU1ZTG9hZFBhbGV0dGUsIE5VTEwsIAotICAgICAgICAgICAgICAgICAgICAgICAgIENNQVBf
UEFMRVRURURfVFJVRUNPTE9SIAotCQkJICAgICB8IENNQVBfUkVMT0FEX09OX01PREVfU1dJVENI
KSkKLQlyZXR1cm4gRkFMU0U7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERVTU1ZTG9h
ZFBhbGV0dGUsIE5VTEwsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENNQVBfUEFMRVRU
RURfVFJVRUNPTE9SIHwgQ01BUF9SRUxPQURfT05fTU9ERV9TV0lUQ0gpKQorICAgICAgICByZXR1
cm4gRkFMU0U7CiAKICAgICBwU2NyZWVuLT5TYXZlU2NyZWVuID0gRFVNTVlTYXZlU2NyZWVuOwog
Ci0gICAgCisKICAgICAvKiBXcmFwIHRoZSBjdXJyZW50IENsb3NlU2NyZWVuIGZ1bmN0aW9uICov
CiAgICAgZFB0ci0+Q2xvc2VTY3JlZW4gPSBwU2NyZWVuLT5DbG9zZVNjcmVlbjsKICAgICBwU2Ny
ZWVuLT5DbG9zZVNjcmVlbiA9IERVTU1ZQ2xvc2VTY3JlZW47CkBAIC02MjMsNyArNjAzLDcgQEAg
RFVNTVlTY3JlZW5Jbml0KFNDUkVFTl9JTklUX0FSR1NfREVDTCkKIAogICAgIC8qIFJlcG9ydCBh
bnkgdW51c2VkIG9wdGlvbnMgKG9ubHkgZm9yIHRoZSBmaXJzdCBnZW5lcmF0aW9uKSAqLwogICAg
IGlmIChzZXJ2ZXJHZW5lcmF0aW9uID09IDEpIHsKLQl4Zjg2U2hvd1VudXNlZE9wdGlvbnMocFNj
cm4tPnNjcm5JbmRleCwgcFNjcm4tPm9wdGlvbnMpOworICAgICAgICB4Zjg2U2hvd1VudXNlZE9w
dGlvbnMocFNjcm4tPnNjcm5JbmRleCwgcFNjcm4tPm9wdGlvbnMpOwogICAgIH0KIAogICAgIHJl
dHVybiBUUlVFOwpAQCAtNjUyLDExICs2MzIsMTEgQEAgRFVNTVlDbG9zZVNjcmVlbihDTE9TRV9T
Q1JFRU5fQVJHU19ERUNMKQogICAgIGZyZWUocFNjcmVlbi0+R2V0U2NyZWVuUGl4bWFwKHBTY3Jl
ZW4pLT5kZXZQcml2YXRlLnB0cik7CiAKICAgICBpZiAoZFB0ci0+Q3Vyc29ySW5mbykKLQl4Zjg2
RGVzdHJveUN1cnNvckluZm9SZWMoZFB0ci0+Q3Vyc29ySW5mbyk7CisgICAgICAgIHhmODZEZXN0
cm95Q3Vyc29ySW5mb1JlYyhkUHRyLT5DdXJzb3JJbmZvKTsKIAogICAgIHBTY3JuLT52dFNlbWEg
PSBGQUxTRTsKICAgICBwU2NyZWVuLT5DbG9zZVNjcmVlbiA9IGRQdHItPkNsb3NlU2NyZWVuOwot
ICAgIHJldHVybiAoKnBTY3JlZW4tPkNsb3NlU2NyZWVuKShDTE9TRV9TQ1JFRU5fQVJHUyk7Cisg
ICAgcmV0dXJuICgqcFNjcmVlbi0+Q2xvc2VTY3JlZW4pIChDTE9TRV9TQ1JFRU5fQVJHUyk7CiB9
CiAKIC8qIE9wdGlvbmFsICovCkBAIC02NzcsMTAgKzY1NywxMCBAQCBEVU1NWVNhdmVTY3JlZW4o
U2NyZWVuUHRyIHBTY3JlZW4sIGludCBtb2RlKQogc3RhdGljIE1vZGVTdGF0dXMKIERVTU1ZVmFs
aWRNb2RlKFNDUk5fQVJHX1RZUEUgYXJnLCBEaXNwbGF5TW9kZVB0ciBtb2RlLCBCb29sIHZlcmJv
c2UsIGludCBmbGFncykKIHsKLSAgICByZXR1cm4oTU9ERV9PSyk7CisgICAgcmV0dXJuIChNT0RF
X09LKTsKIH0KIAotQXRvbSBWRkJfUFJPUCAgPSAwOworQXRvbSBWRkJfUFJPUCA9IDA7CiAjZGVm
aW5lICBWRkJfUFJPUF9OQU1FICAiVkZCX0lERU5UIgogCiBzdGF0aWMgQm9vbApAQCAtNjk2LDI2
ICs2NzYsMjYgQEAgRFVNTVlDcmVhdGVXaW5kb3coV2luZG93UHRyIHBXaW4pCiAgICAgZFB0ci0+
Q3JlYXRlV2luZG93ID0gcFNjcmVlbi0+Q3JlYXRlV2luZG93OwogICAgIHBTY3JlZW4tPkNyZWF0
ZVdpbmRvdyA9IERVTU1ZQ3JlYXRlV2luZG93OwogCi0gICAgaWYocmV0ICE9IFRSVUUpCi0JcmV0
dXJuKHJldCk7Ci0JCi0gICAgaWYoZFB0ci0+cHJvcCA9PSBGQUxTRSkgeworICAgIGlmIChyZXQg
IT0gVFJVRSkKKyAgICAgICAgcmV0dXJuIChyZXQpOworCisgICAgaWYgKGRQdHItPnByb3AgPT0g
RkFMU0UpIHsKICNpZiBHRVRfQUJJX01BSk9SKEFCSV9WSURFT0RSVl9WRVJTSU9OKSA8IDgKICAg
ICAgICAgcFdpblJvb3QgPSBXaW5kb3dUYWJsZVtEVU1NWVNjcm4tPnBTY3JlZW4tPm15TnVtXTsK
ICNlbHNlCiAgICAgICAgIHBXaW5Sb290ID0gRFVNTVlTY3JuLT5wU2NyZWVuLT5yb290OwogI2Vu
ZGlmCi0gICAgICAgIGlmICghIFZhbGlkQXRvbShWRkJfUFJPUCkpCisgICAgICAgIGlmICghVmFs
aWRBdG9tKFZGQl9QUk9QKSkKICAgICAgICAgICAgIFZGQl9QUk9QID0gTWFrZUF0b20oVkZCX1BS
T1BfTkFNRSwgc3RybGVuKFZGQl9QUk9QX05BTUUpLCAxKTsKIAogICAgICAgICByZXQgPSBkaXhD
aGFuZ2VXaW5kb3dQcm9wZXJ0eShzZXJ2ZXJDbGllbnQsIHBXaW5Sb290LCBWRkJfUFJPUCwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWEFfU1RSSU5HLCA4LCBQcm9wTW9k
ZVJlcGxhY2UsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpbnQpNCwg
KHBvaW50ZXIpIlRSVUUiLCBGQUxTRSk7Ci0JaWYoIHJldCAhPSBTdWNjZXNzKQotCQlFcnJvckYo
IkNvdWxkIG5vdCBzZXQgVkZCIHJvb3Qgd2luZG93IHByb3BlcnR5Iik7CisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIChpbnQpIDQsIChwb2ludGVyKSAiVFJVRSIsIEZBTFNF
KTsKKyAgICAgICAgaWYgKHJldCAhPSBTdWNjZXNzKQorICAgICAgICAgICAgRXJyb3JGKCJDb3Vs
ZCBub3Qgc2V0IFZGQiByb290IHdpbmRvdyBwcm9wZXJ0eSIpOwogICAgICAgICBkUHRyLT5wcm9w
ID0gVFJVRTsKIAotCXJldHVybiBUUlVFOworICAgICAgICByZXR1cm4gVFJVRTsKICAgICB9CiAg
ICAgcmV0dXJuIFRSVUU7CiB9CkBAIC03MjgsMTMgKzcwOCwxMyBAQCBzdGF0aWMgQm9vbAogZHVt
bXlEcml2ZXJGdW5jKFNjcm5JbmZvUHRyIHBTY3JuLCB4b3JnRHJpdmVyRnVuY09wIG9wLCBwb2lu
dGVyIHB0cikKIHsKICAgICBDQVJEMzIgKmZsYWc7Ci0gICAgCisKICAgICBzd2l0Y2ggKG9wKSB7
Ci0JY2FzZSBHRVRfUkVRVUlSRURfSFdfSU5URVJGQUNFUzoKLQkgICAgZmxhZyA9IChDQVJEMzIq
KXB0cjsKLQkgICAgKCpmbGFnKSA9IEhXX1NLSVBfQ09OU09MRTsKLQkgICAgcmV0dXJuIFRSVUU7
Ci0JZGVmYXVsdDoKLQkgICAgcmV0dXJuIEZBTFNFOworICAgIGNhc2UgR0VUX1JFUVVJUkVEX0hX
X0lOVEVSRkFDRVM6CisgICAgICAgIGZsYWcgPSAoQ0FSRDMyICopIHB0cjsKKyAgICAgICAgKCpm
bGFnKSA9IEhXX1NLSVBfQ09OU09MRTsKKyAgICAgICAgcmV0dXJuIFRSVUU7CisgICAgZGVmYXVs
dDoKKyAgICAgICAgcmV0dXJuIEZBTFNFOwogICAgIH0KIH0KLS0gCjIuMTEuMAoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KU3BpY2UtZGV2ZWwgbWFpbGlu
ZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZy
ZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
