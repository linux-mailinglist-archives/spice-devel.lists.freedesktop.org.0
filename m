Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5B99087CA8
	for <lists+spice-devel@lfdr.de>; Fri,  9 Aug 2019 16:27:46 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DCFAE6EE27;
	Fri,  9 Aug 2019 14:27:44 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 338F46EE29
 for <spice-devel@lists.freedesktop.org>; Fri,  9 Aug 2019 14:27:41 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx07.intmail.prod.int.phx2.redhat.com
 [10.5.11.22])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id CF5F330084AD
 for <spice-devel@lists.freedesktop.org>; Fri,  9 Aug 2019 14:27:40 +0000 (UTC)
Received: from fziglio.remote.csb (ovpn-204-160.brq.redhat.com [10.40.204.160])
 by smtp.corp.redhat.com (Postfix) with ESMTP id EBAD91001B02;
 Fri,  9 Aug 2019 14:27:37 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Fri,  9 Aug 2019 15:26:30 +0100
Message-Id: <20190809142651.2967-13-fziglio@redhat.com>
In-Reply-To: <20190809142651.2967-1-fziglio@redhat.com>
References: <20190809142651.2967-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.22
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.40]); Fri, 09 Aug 2019 14:27:40 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-gtk v2 12/33] fixup! usb-redir: add
 files for SCSI and USB MSC implementation
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

QXZvaWQgR19HVUlOVDMyX0ZPUk1BVC4KV2UgZG9uJ3Qgc3VwcG9ydCBhcmNoaXRlY3R1cmVzIGxl
c3MgdGhhbiAzMiBiaXQuCkR1ZSB0byBDIHR5cGUgcHJvbW90aW9uICV1IGlzIHN1cmVseSBmaW5l
LgotLS0KIHNyYy9jZC1zY3NpLmMgfCAyNDQgKysrKysrKysrKysrKysrKysrKysrKysrLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAxMTYgaW5zZXJ0aW9ucygrKSwg
MTI4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3NyYy9jZC1zY3NpLmMgYi9zcmMvY2Qtc2Nz
aS5jCmluZGV4IDJhMzU5NWJiLi45YzU2MTZiMCAxMDA2NDQKLS0tIGEvc3JjL2NkLXNjc2kuYwor
KysgYi9zcmMvY2Qtc2NzaS5jCkBAIC0zNTIsNyArMzUyLDcgQEAgc3RhdGljIHZvaWQgY2Rfc2Nz
aV9jbWRfY29tcGxldGVfY2hlY2tfY29uZChDZFNjc2lMVSAqZGV2LCBDZFNjc2lSZXF1ZXN0ICpy
ZXEsCiAKICAgICBjZF9zY3NpX2Rldl9zZW5zZV9zZXQoZGV2LCBzaG9ydF9zZW5zZSk7CiAKLSAg
ICBTUElDRV9ERUJVRygiQ0hFQ0tfQ09ORCwgcmVxdWVzdCBsdW46JSIgR19HVUlOVDMyX0ZPUk1B
VAorICAgIFNQSUNFX0RFQlVHKCJDSEVDS19DT05ELCByZXF1ZXN0IGx1bjoldSIKICAgICAgICAg
ICAgICAgICAiIG9wOiAweCUwMngsIHBlbmRpbmcgc2Vuc2U6IDB4JTAyeCAlMDJ4ICUwMnggLSAl
cywgJXMiLAogICAgICAgICAgICAgICAgIGRldi0+bHVuLCAodWludDMyX3QpcmVxLT5jZGJbMF0s
CiAgICAgICAgICAgICAgICAgKHVpbnQzMl90KWRldi0+c2hvcnRfc2Vuc2Uua2V5LApAQCAtNDA5
LDcgKzQwOSw3IEBAIENkU2NzaVRhcmdldCAqY2Rfc2NzaV90YXJnZXRfYWxsb2Modm9pZCAqdGFy
Z2V0X3VzZXJfZGF0YSwgdWludDMyX3QgbWF4X2x1bnMpCiAgICAgQ2RTY3NpVGFyZ2V0ICpzdDsK
IAogICAgIGlmIChtYXhfbHVucyA9PSAwIHx8IG1heF9sdW5zID4gTUFYX0xVTlMpIHsKLSAgICAg
ICAgU1BJQ0VfRVJST1IoIkFsbG9jLCBpbGxlZ2FsIG1heF9sdW5zOiUiIEdfR1VJTlQzMl9GT1JN
QVQsIG1heF9sdW5zKTsKKyAgICAgICAgU1BJQ0VfRVJST1IoIkFsbG9jLCBpbGxlZ2FsIG1heF9s
dW5zOiV1IiwgbWF4X2x1bnMpOwogICAgICAgICByZXR1cm4gTlVMTDsKICAgICB9CiAKQEAgLTQ0
OCwxMSArNDQ4LDExIEBAIGludCBjZF9zY3NpX2Rldl9yZWFsaXplKENkU2NzaVRhcmdldCAqc3Qs
IHVpbnQzMl90IGx1biwKICAgICBDZFNjc2lMVSAqZGV2OwogCiAgICAgaWYgKCFjZF9zY3NpX3Rh
cmdldF9sdW5fbGVnYWwoc3QsIGx1bikpIHsKLSAgICAgICAgU1BJQ0VfRVJST1IoIlJlYWxpemUs
IGlsbGVnYWwgbHVuOiUiIEdfR1VJTlQzMl9GT1JNQVQsIGx1bik7CisgICAgICAgIFNQSUNFX0VS
Uk9SKCJSZWFsaXplLCBpbGxlZ2FsIGx1bjoldSIsIGx1bik7CiAgICAgICAgIHJldHVybiAtMTsK
ICAgICB9CiAgICAgaWYgKGNkX3Njc2lfdGFyZ2V0X2x1bl9yZWFsaXplZChzdCwgbHVuKSkgewot
ICAgICAgICBTUElDRV9FUlJPUigiUmVhbGl6ZSwgYWxyZWFkeSByZWFsaXplZCBsdW46JSIgR19H
VUlOVDMyX0ZPUk1BVCwgbHVuKTsKKyAgICAgICAgU1BJQ0VfRVJST1IoIlJlYWxpemUsIGFscmVh
ZHkgcmVhbGl6ZWQgbHVuOiV1IiwgbHVuKTsKICAgICAgICAgcmV0dXJuIC0xOwogICAgIH0KICAg
ICBkZXYgPSAmc3QtPnVuaXRzW2x1bl07CkBAIC00ODIsOCArNDgyLDcgQEAgaW50IGNkX3Njc2lf
ZGV2X3JlYWxpemUoQ2RTY3NpVGFyZ2V0ICpzdCwgdWludDMyX3QgbHVuLAogCiAgICAgc3QtPm51
bV9sdW5zICsrOwogCi0gICAgU1BJQ0VfREVCVUcoIlJlYWxpemUgbHVuOiUiIEdfR1VJTlQzMl9G
T1JNQVQgIiBiczolIiBHX0dVSU5UMzJfRk9STUFUCi0gICAgICAgICAgICAgICAgIiBWUjpbJXNd
IFBUOlslc10gdmVyOlslc10gU05bJXNdIiwKKyAgICBTUElDRV9ERUJVRygiUmVhbGl6ZSBsdW46
JXUgYnM6JXUgVlI6WyVzXSBQVDpbJXNdIHZlcjpbJXNdIFNOWyVzXSIsCiAgICAgICAgICAgICAg
ICAgbHVuLCBkZXYtPmJsb2NrX3NpemUsIGRldi0+dmVuZG9yLAogICAgICAgICAgICAgICAgIGRl
di0+cHJvZHVjdCwgZGV2LT52ZXJzaW9uLCBkZXYtPnNlcmlhbCk7CiAgICAgcmV0dXJuIDA7CkBA
IC01MDMsMTYgKzUwMiwxNiBAQCBpbnQgY2Rfc2NzaV9kZXZfbG9jayhDZFNjc2lUYXJnZXQgKnN0
LCB1aW50MzJfdCBsdW4sIGdib29sZWFuIGxvY2spCiAgICAgQ2RTY3NpTFUgKmRldjsKIAogICAg
IGlmICghY2Rfc2NzaV90YXJnZXRfbHVuX2xlZ2FsKHN0LCBsdW4pKSB7Ci0gICAgICAgIFNQSUNF
X0VSUk9SKCJMb2NrLCBpbGxlZ2FsIGx1bjolIiBHX0dVSU5UMzJfRk9STUFULCBsdW4pOworICAg
ICAgICBTUElDRV9FUlJPUigiTG9jaywgaWxsZWdhbCBsdW46JXUiLCBsdW4pOwogICAgICAgICBy
ZXR1cm4gLTE7CiAgICAgfQogICAgIGlmICghY2Rfc2NzaV90YXJnZXRfbHVuX3JlYWxpemVkKHN0
LCBsdW4pKSB7Ci0gICAgICAgIFNQSUNFX0VSUk9SKCJMb2NrLCB1bnJlYWxpemVkIGx1bjolIiBH
X0dVSU5UMzJfRk9STUFULCBsdW4pOworICAgICAgICBTUElDRV9FUlJPUigiTG9jaywgdW5yZWFs
aXplZCBsdW46JXUiLCBsdW4pOwogICAgICAgICByZXR1cm4gLTE7CiAgICAgfQogICAgIGRldiA9
ICZzdC0+dW5pdHNbbHVuXTsKICAgICBkZXYtPnByZXZlbnRfbWVkaWFfcmVtb3ZhbCA9IGxvY2s7
Ci0gICAgU1BJQ0VfREVCVUcoImx1bjolIiBHX0dVSU5UMzJfRk9STUFUICIlc2xvY2siLCBsdW4s
IGxvY2sgPyAidW4iIDoiIik7CisgICAgU1BJQ0VfREVCVUcoImx1bjoldSAlc2xvY2siLCBsdW4s
IGxvY2sgPyAidW4iIDoiIik7CiAgICAgcmV0dXJuIDA7CiB9CiAKQEAgLTU0NSwxMSArNTQ0LDEx
IEBAIGludCBjZF9zY3NpX2Rldl9sb2FkKENkU2NzaVRhcmdldCAqc3QsIHVpbnQzMl90IGx1biwK
ICAgICBDZFNjc2lMVSAqZGV2OwogCiAgICAgaWYgKCFjZF9zY3NpX3RhcmdldF9sdW5fbGVnYWwo
c3QsIGx1bikpIHsKLSAgICAgICAgU1BJQ0VfRVJST1IoIkxvYWQsIGlsbGVnYWwgbHVuOiUiIEdf
R1VJTlQzMl9GT1JNQVQsIGx1bik7CisgICAgICAgIFNQSUNFX0VSUk9SKCJMb2FkLCBpbGxlZ2Fs
IGx1bjoldSIsIGx1bik7CiAgICAgICAgIHJldHVybiAtMTsKICAgICB9CiAgICAgaWYgKCFjZF9z
Y3NpX3RhcmdldF9sdW5fcmVhbGl6ZWQoc3QsIGx1bikpIHsKLSAgICAgICAgU1BJQ0VfRVJST1Io
IkxvYWQsIHVucmVhbGl6ZWQgbHVuOiUiIEdfR1VJTlQzMl9GT1JNQVQsIGx1bik7CisgICAgICAg
IFNQSUNFX0VSUk9SKCJMb2FkLCB1bnJlYWxpemVkIGx1bjoldSIsIGx1bik7CiAgICAgICAgIHJl
dHVybiAtMTsKICAgICB9CiAgICAgZGV2ID0gJnN0LT51bml0c1tsdW5dOwpAQCAtNTYwLDggKzU1
OSw4IEBAIGludCBjZF9zY3NpX2Rldl9sb2FkKENkU2NzaVRhcmdldCAqc3QsIHVpbnQzMl90IGx1
biwKIAogICAgIGNkX3Njc2lfZGV2X3NlbnNlX3NldChkZXYsICZzZW5zZV9jb2RlX01FRElVTV9D
SEFOR0VEKTsKIAotICAgIFNQSUNFX0RFQlVHKCJMb2FkIGx1bjolIiBHX0dVSU5UMzJfRk9STUFU
ICIgc2l6ZTolIiBHX0dVSU5UNjRfRk9STUFUCi0gICAgICAgICAgICAgICAgIiBibGtfc3o6JSIg
R19HVUlOVDMyX0ZPUk1BVCAiIG51bV9ibG9ja3M6JSIgR19HVUlOVDMyX0ZPUk1BVCwKKyAgICBT
UElDRV9ERUJVRygiTG9hZCBsdW46JXUgc2l6ZTolIiBHX0dVSU5UNjRfRk9STUFUCisgICAgICAg
ICAgICAgICAgIiBibGtfc3o6JXUgbnVtX2Jsb2NrczoldSIsCiAgICAgICAgICAgICAgICAgbHVu
LCBkZXYtPnNpemUsIGRldi0+YmxvY2tfc2l6ZSwgZGV2LT5udW1fYmxvY2tzKTsKICAgICByZXR1
cm4gMDsKIH0KQEAgLTU3MSwxMSArNTcwLDExIEBAIGludCBjZF9zY3NpX2Rldl9nZXRfaW5mbyhD
ZFNjc2lUYXJnZXQgKnN0LCB1aW50MzJfdCBsdW4sIENkU2NzaURldmljZUluZm8gKmx1bl9pCiAg
ICAgQ2RTY3NpTFUgKmRldjsKIAogICAgIGlmICghY2Rfc2NzaV90YXJnZXRfbHVuX2xlZ2FsKHN0
LCBsdW4pKSB7Ci0gICAgICAgIFNQSUNFX0VSUk9SKCJMb2FkLCBpbGxlZ2FsIGx1bjolIiBHX0dV
SU5UMzJfRk9STUFULCBsdW4pOworICAgICAgICBTUElDRV9FUlJPUigiTG9hZCwgaWxsZWdhbCBs
dW46JXUiLCBsdW4pOwogICAgICAgICByZXR1cm4gLTE7CiAgICAgfQogICAgIGlmICghY2Rfc2Nz
aV90YXJnZXRfbHVuX3JlYWxpemVkKHN0LCBsdW4pKSB7Ci0gICAgICAgIFNQSUNFX0VSUk9SKCJM
b2FkLCB1bnJlYWxpemVkIGx1bjolIiBHX0dVSU5UMzJfRk9STUFULCBsdW4pOworICAgICAgICBT
UElDRV9FUlJPUigiTG9hZCwgdW5yZWFsaXplZCBsdW46JXUiLCBsdW4pOwogICAgICAgICByZXR1
cm4gLTE7CiAgICAgfQogICAgIGRldiA9ICZzdC0+dW5pdHNbbHVuXTsKQEAgLTU5NywyMCArNTk2
LDIwIEBAIGludCBjZF9zY3NpX2Rldl91bmxvYWQoQ2RTY3NpVGFyZ2V0ICpzdCwgdWludDMyX3Qg
bHVuKQogICAgIENkU2NzaUxVICpkZXY7CiAKICAgICBpZiAoIWNkX3Njc2lfdGFyZ2V0X2x1bl9s
ZWdhbChzdCwgbHVuKSkgewotICAgICAgICBTUElDRV9FUlJPUigiVW5sb2FkLCBpbGxlZ2FsIGx1
bjolIiBHX0dVSU5UMzJfRk9STUFULCBsdW4pOworICAgICAgICBTUElDRV9FUlJPUigiVW5sb2Fk
LCBpbGxlZ2FsIGx1bjoldSIsIGx1bik7CiAgICAgICAgIHJldHVybiAtMTsKICAgICB9CiAgICAg
aWYgKCFjZF9zY3NpX3RhcmdldF9sdW5fcmVhbGl6ZWQoc3QsIGx1bikpIHsKLSAgICAgICAgU1BJ
Q0VfRVJST1IoIlVubG9hZCwgdW5yZWFsaXplZCBsdW46JSIgR19HVUlOVDMyX0ZPUk1BVCwgbHVu
KTsKKyAgICAgICAgU1BJQ0VfRVJST1IoIlVubG9hZCwgdW5yZWFsaXplZCBsdW46JXUiLCBsdW4p
OwogICAgICAgICByZXR1cm4gLTE7CiAgICAgfQogICAgIGRldiA9ICZzdC0+dW5pdHNbbHVuXTsK
ICAgICBpZiAoIWRldi0+bG9hZGVkKSB7Ci0gICAgICAgIFNQSUNFX0VSUk9SKCJVbmxvYWQsIGx1
bjolIiBHX0dVSU5UMzJfRk9STUFUICIgbm90IGxvYWRlZCB5ZXQiLCBsdW4pOworICAgICAgICBT
UElDRV9FUlJPUigiVW5sb2FkLCBsdW46JXUgbm90IGxvYWRlZCB5ZXQiLCBsdW4pOwogICAgICAg
ICByZXR1cm4gMDsKICAgICB9CiAgICAgaWYgKGRldi0+cHJldmVudF9tZWRpYV9yZW1vdmFsKSB7
Ci0gICAgICAgIFNQSUNFX0VSUk9SKCJVbmxvYWQsIGx1bjolIiBHX0dVSU5UMzJfRk9STUFUICIg
cHJldmVudF9tZWRpYV9yZW1vdmFsIHNldCIsIGx1bik7CisgICAgICAgIFNQSUNFX0VSUk9SKCJV
bmxvYWQsIGx1bjoldSBwcmV2ZW50X21lZGlhX3JlbW92YWwgc2V0IiwgbHVuKTsKICAgICAgICAg
cmV0dXJuIC0xOwogICAgIH0KIApAQCAtNjIwLDcgKzYxOSw3IEBAIGludCBjZF9zY3NpX2Rldl91
bmxvYWQoQ2RTY3NpVGFyZ2V0ICpzdCwgdWludDMyX3QgbHVuKQogCiAgICAgY2Rfc2NzaV9kZXZf
c2Vuc2Vfc2V0KGRldiwgJnNlbnNlX2NvZGVfVUFfTk9fTUVESVVNKTsKIAotICAgIFNQSUNFX0RF
QlVHKCJVbmxvYWQgbHVuOiUiIEdfR1VJTlQzMl9GT1JNQVQsIGx1bik7CisgICAgU1BJQ0VfREVC
VUcoIlVubG9hZCBsdW46JXUiLCBsdW4pOwogICAgIHJldHVybiAwOwogfQogCkBAIC02MjksMTEg
KzYyOCwxMSBAQCBpbnQgY2Rfc2NzaV9kZXZfdW5yZWFsaXplKENkU2NzaVRhcmdldCAqc3QsIHVp
bnQzMl90IGx1bikKICAgICBDZFNjc2lMVSAqZGV2OwogCiAgICAgaWYgKCFjZF9zY3NpX3Rhcmdl
dF9sdW5fbGVnYWwoc3QsIGx1bikpIHsKLSAgICAgICAgU1BJQ0VfRVJST1IoIlVucmVhbGl6ZSwg
aWxsZWdhbCBsdW46JSIgR19HVUlOVDMyX0ZPUk1BVCwgbHVuKTsKKyAgICAgICAgU1BJQ0VfRVJS
T1IoIlVucmVhbGl6ZSwgaWxsZWdhbCBsdW46JXUiLCBsdW4pOwogICAgICAgICByZXR1cm4gLTE7
CiAgICAgfQogICAgIGlmICghY2Rfc2NzaV90YXJnZXRfbHVuX3JlYWxpemVkKHN0LCBsdW4pKSB7
Ci0gICAgICAgIFNQSUNFX0VSUk9SKCJVbnJlYWxpemUsIGFic2VudCBsdW46JSIgR19HVUlOVDMy
X0ZPUk1BVCwgbHVuKTsKKyAgICAgICAgU1BJQ0VfRVJST1IoIlVucmVhbGl6ZSwgYWJzZW50IGx1
bjoldSIsIGx1bik7CiAgICAgICAgIHJldHVybiAtMTsKICAgICB9CiAgICAgZGV2ID0gJnN0LT51
bml0c1tsdW5dOwpAQCAtNjYxLDcgKzY2MCw3IEBAIGludCBjZF9zY3NpX2Rldl91bnJlYWxpemUo
Q2RTY3NpVGFyZ2V0ICpzdCwgdWludDMyX3QgbHVuKQogCiAgICAgc3QtPm51bV9sdW5zIC0tOwog
Ci0gICAgU1BJQ0VfREVCVUcoIlVucmVhbGl6ZSBsdW46JSIgR19HVUlOVDMyX0ZPUk1BVCwgbHVu
KTsKKyAgICBTUElDRV9ERUJVRygiVW5yZWFsaXplIGx1bjoldSIsIGx1bik7CiAgICAgcmV0dXJu
IDA7CiB9CiAKQEAgLTY3MCwxMSArNjY5LDExIEBAIGludCBjZF9zY3NpX2Rldl9yZXNldChDZFNj
c2lUYXJnZXQgKnN0LCB1aW50MzJfdCBsdW4pCiAgICAgQ2RTY3NpTFUgKmRldjsKIAogICAgIGlm
ICghY2Rfc2NzaV90YXJnZXRfbHVuX2xlZ2FsKHN0LCBsdW4pKSB7Ci0gICAgICAgIFNQSUNFX0VS
Uk9SKCJEZXZpY2UgcmVzZXQsIGlsbGVnYWwgbHVuOiUiIEdfR1VJTlQzMl9GT1JNQVQsIGx1bik7
CisgICAgICAgIFNQSUNFX0VSUk9SKCJEZXZpY2UgcmVzZXQsIGlsbGVnYWwgbHVuOiV1IiwgbHVu
KTsKICAgICAgICAgcmV0dXJuIC0xOwogICAgIH0KICAgICBpZiAoIWNkX3Njc2lfdGFyZ2V0X2x1
bl9yZWFsaXplZChzdCwgbHVuKSkgewotICAgICAgICBTUElDRV9FUlJPUigiRGV2aWNlIHJlc2V0
LCBhYnNlbnQgbHVuOiUiIEdfR1VJTlQzMl9GT1JNQVQsIGx1bik7CisgICAgICAgIFNQSUNFX0VS
Uk9SKCJEZXZpY2UgcmVzZXQsIGFic2VudCBsdW46JXUiLCBsdW4pOwogICAgICAgICByZXR1cm4g
LTE7CiAgICAgfQogICAgIGRldiA9ICZzdC0+dW5pdHNbbHVuXTsKQEAgLTY4OCw3ICs2ODcsNyBA
QCBpbnQgY2Rfc2NzaV9kZXZfcmVzZXQoQ2RTY3NpVGFyZ2V0ICpzdCwgdWludDMyX3QgbHVuKQog
ICAgIGRldi0+cG93ZXJfZXZlbnQgPSBDRF9QT1dFUl9FVkVOVF9DSEFOR0VfU1VDQ0VTUzsKICAg
ICBjZF9zY3NpX2Rldl9zZW5zZV9zZXRfcG93ZXJfb24oZGV2KTsKIAotICAgIFNQSUNFX0RFQlVH
KCJEZXZpY2UgcmVzZXQgbHVuOiUiIEdfR1VJTlQzMl9GT1JNQVQsIGx1bik7CisgICAgU1BJQ0Vf
REVCVUcoIkRldmljZSByZXNldCBsdW46JXUiLCBsdW4pOwogICAgIHJldHVybiAwOwogfQogCkBA
IC04NTksNyArODU4LDcgQEAgc3RhdGljIHZvaWQgY2Rfc2NzaV9jbWRfcmVxdWVzdF9zZW5zZShD
ZFNjc2lMVSAqZGV2LCBDZFNjc2lSZXF1ZXN0ICpyZXEpCiAgICAgICAgICAgICAgICAgICAgcmVx
LT5yZXFfbGVuIDogc2l6ZW9mKGRldi0+Zml4ZWRfc2Vuc2UpOwogCiAgICAgaWYgKGRldi0+c2hv
cnRfc2Vuc2Uua2V5ICE9IE5PX1NFTlNFKSB7Ci0gICAgICAgIFNQSUNFX0RFQlVHKCIlcywgbHVu
OiUiIEdfR1VJTlQzMl9GT1JNQVQgIiByZXBvcnRlZCBzZW5zZTogMHglMDJ4ICUwMnggJTAyeCAt
ICVzLCAlcyIsCisgICAgICAgIFNQSUNFX0RFQlVHKCIlcywgbHVuOiV1IHJlcG9ydGVkIHNlbnNl
OiAweCUwMnggJTAyeCAlMDJ4IC0gJXMsICVzIiwKICAgICAgICAgICAgICAgICAgICAgX19GVU5D
VElPTl9fLCByZXEtPmx1biwKICAgICAgICAgICAgICAgICAgICAgZGV2LT5zaG9ydF9zZW5zZS5r
ZXksIGRldi0+c2hvcnRfc2Vuc2UuYXNjLCBkZXYtPnNob3J0X3NlbnNlLmFzY3EsCiAgICAgICAg
ICAgICAgICAgICAgIGNkX3Njc2lfc2Vuc2Vfa2V5X2Rlc2NyKGRldi0+c2hvcnRfc2Vuc2Uua2V5
KSwKQEAgLTkyNyw3ICs5MjYsNyBAQCBzdGF0aWMgdm9pZCBjZF9zY3NpX2NtZF9pbnF1aXJ5X3Zw
ZF9ub19sdW4oQ2RTY3NpTFUgKmRldiwgQ2RTY3NpUmVxdWVzdCAqcmVxLAogCiAgICAgcmVxLT5p
bl9sZW4gPSAocmVxLT5yZXFfbGVuIDwgcmVzcF9sZW4pID8gcmVxLT5yZXFfbGVuIDogcmVzcF9s
ZW47CiAKLSAgICBTUElDRV9ERUJVRygiaW5xdWlyeV92cGQsIHVuc3VwcG9ydGVkIGx1bjolIiBH
X0dVSU5UMzJfRk9STUFUCisgICAgU1BJQ0VfREVCVUcoImlucXVpcnlfdnBkLCB1bnN1cHBvcnRl
ZCBsdW46JXUiCiAgICAgICAgICAgICAgICAgIiBwZXJpZl9xdWFsOjB4JXggcmVzcF9sZW46ICUi
IEdfR1VJTlQ2NF9GT1JNQVQsCiAgICAgICAgICAgICAgICAgcmVxLT5sdW4sIHBlcmlmX3F1YWws
IHJlcS0+aW5fbGVuKTsKIApAQCAtOTU1LDcgKzk1NCw3IEBAIHN0YXRpYyB2b2lkIGNkX3Njc2lf
Y21kX2lucXVpcnlfdnBkKENkU2NzaUxVICpkZXYsIENkU2NzaVJlcXVlc3QgKnJlcSkKICAgICAg
ICAgfQogICAgICAgICBvdXRidWZbYnVmbGVuKytdID0gMHg4MzsgLy8gZGV2aWNlIGlkZW50aWZp
Y2F0aW9uCiAKLSAgICAgICAgU1BJQ0VfREVCVUcoIklucXVpcnkgRVZQRFtTdXBwb3J0ZWQgcGFn
ZXNdIGx1bjolIiBHX0dVSU5UMzJfRk9STUFUCisgICAgICAgIFNQSUNFX0RFQlVHKCJJbnF1aXJ5
IEVWUERbU3VwcG9ydGVkIHBhZ2VzXSBsdW46JXUiCiAgICAgICAgICAgICAgICAgICAgICIgcmVx
X2xlbjogJSIgR19HVUlOVDY0X0ZPUk1BVCAiIHJlc3BfbGVuOiAlZCIsCiAgICAgICAgICAgICAg
ICAgICAgIHJlcS0+bHVuLCByZXEtPnJlcV9sZW4sIGJ1Zmxlbik7CiAgICAgICAgIGJyZWFrOwpA
QCAtOTcxLDcgKzk3MCw3IEBAIHN0YXRpYyB2b2lkIGNkX3Njc2lfY21kX2lucXVpcnlfdnBkKENk
U2NzaUxVICpkZXYsIENkU2NzaVJlcXVlc3QgKnJlcSkKICAgICAgICAgbWVtY3B5KG91dGJ1Ziti
dWZsZW4sIGRldi0+c2VyaWFsLCBzZXJpYWxfbGVuKTsKICAgICAgICAgYnVmbGVuICs9IHNlcmlh
bF9sZW47CiAKLSAgICAgICAgU1BJQ0VfREVCVUcoIklucXVpcnkgRVZQRFtTZXJpYWwgbnVtXSBs
dW46JSIgR19HVUlOVDMyX0ZPUk1BVAorICAgICAgICBTUElDRV9ERUJVRygiSW5xdWlyeSBFVlBE
W1NlcmlhbCBudW1dIGx1bjoldSIKICAgICAgICAgICAgICAgICAgICAgIiByZXFfbGVuOiAlIiBH
X0dVSU5UNjRfRk9STUFUICIgcmVzcF9sZW46ICVkIiwKICAgICAgICAgICAgICAgICAgICAgcmVx
LT5sdW4sIHJlcS0+cmVxX2xlbiwgYnVmbGVuKTsKICAgICAgICAgYnJlYWs7CkBAIC05OTMsNyAr
OTkyLDcgQEAgc3RhdGljIHZvaWQgY2Rfc2NzaV9jbWRfaW5xdWlyeV92cGQoQ2RTY3NpTFUgKmRl
diwgQ2RTY3NpUmVxdWVzdCAqcmVxKQogICAgICAgICBtZW1jcHkob3V0YnVmK2J1ZmxlbiwgZGV2
LT5zZXJpYWwsIHNlcmlhbF9sZW4pOwogICAgICAgICBidWZsZW4gKz0gc2VyaWFsX2xlbjsKIAot
ICAgICAgICBTUElDRV9ERUJVRygiSW5xdWlyeSBFVlBEW0RldmljZSBpZF0gbHVuOiUiIEdfR1VJ
TlQzMl9GT1JNQVQKKyAgICAgICAgU1BJQ0VfREVCVUcoIklucXVpcnkgRVZQRFtEZXZpY2UgaWRd
IGx1bjoldSIKICAgICAgICAgICAgICAgICAgICAgIiByZXFfbGVuOiAlIiBHX0dVSU5UNjRfRk9S
TUFUICIgcmVzcF9sZW46ICVkIiwKICAgICAgICAgICAgICAgICAgICAgcmVxLT5sdW4sIHJlcS0+
cmVxX2xlbiwgYnVmbGVuKTsKICAgICAgICAgYnJlYWs7CkBAIC0xMDAxLDcgKzEwMDAsNyBAQCBz
dGF0aWMgdm9pZCBjZF9zY3NpX2NtZF9pbnF1aXJ5X3ZwZChDZFNjc2lMVSAqZGV2LCBDZFNjc2lS
ZXF1ZXN0ICpyZXEpCiAKICAgICBkZWZhdWx0OgogICAgICAgICBjZF9zY3NpX2NtZF9jb21wbGV0
ZV9jaGVja19jb25kKGRldiwgcmVxLCAmc2Vuc2VfY29kZV9JTlZBTElEX0NEQl9GSUVMRCk7Ci0g
ICAgICAgIFNQSUNFX0RFQlVHKCJpbnF1aXJ5X3N0YW5kYXJkLCBsdW46JSIgR19HVUlOVDMyX0ZP
Uk1BVCAiIGludmFsaWQgcGFnZV9jb2RlOiAlMDJ4IiwKKyAgICAgICAgU1BJQ0VfREVCVUcoImlu
cXVpcnlfc3RhbmRhcmQsIGx1bjoldSBpbnZhbGlkIHBhZ2VfY29kZTogJTAyeCIsCiAgICAgICAg
ICAgICAgICAgICAgIHJlcS0+bHVuLCAoaW50KXBhZ2VfY29kZSk7CiAgICAgICAgIHJldHVybjsK
ICAgICB9CkBAIC0xMDUzLDggKzEwNTIsOCBAQCBzdGF0aWMgdm9pZCBjZF9zY3NpX2NtZF9pbnF1
aXJ5X3N0YW5kYXJkX25vX2x1bihDZFNjc2lMVSAqZGV2LCBDZFNjc2lSZXF1ZXN0ICpyZQogCiAg
ICAgcmVxLT5pbl9sZW4gPSAocmVxLT5yZXFfbGVuIDwgcmVzcF9sZW4pID8gcmVxLT5yZXFfbGVu
IDogcmVzcF9sZW47CiAKLSAgICBTUElDRV9ERUJVRygiaW5xdWlyeV9zdGFuZGFyZCwgdW5zdXBw
b3J0ZWQgbHVuOiUiIEdfR1VJTlQzMl9GT1JNQVQgIiBwZXJpZl9xdWFsOjB4JXggIgotICAgICAg
ICAgICAgICAgICJpbnF1aXJ5X2xlbjogJSIgR19HVUlOVDMyX0ZPUk1BVCAiIHJlc3BfbGVuOiAl
IiBHX0dVSU5UNjRfRk9STUFULAorICAgIFNQSUNFX0RFQlVHKCJpbnF1aXJ5X3N0YW5kYXJkLCB1
bnN1cHBvcnRlZCBsdW46JXUgcGVyaWZfcXVhbDoweCV4ICIKKyAgICAgICAgICAgICAgICAiaW5x
dWlyeV9sZW46ICV1IHJlc3BfbGVuOiAlIiBHX0dVSU5UNjRfRk9STUFULAogICAgICAgICAgICAg
ICAgIHJlcS0+bHVuLCBwZXJpZl9xdWFsLCByZXNwX2xlbiwgcmVxLT5pbl9sZW4pOwogCiAgICAg
Y2Rfc2NzaV9jbWRfY29tcGxldGVfZ29vZChkZXYsIHJlcSk7CkBAIC0xMDk2LDggKzEwOTUsOCBA
QCBzdGF0aWMgdm9pZCBjZF9zY3NpX2NtZF9pbnF1aXJ5X3N0YW5kYXJkKENkU2NzaUxVICpkZXYs
IENkU2NzaVJlcXVlc3QgKnJlcSkKIAogICAgIHJlcS0+aW5fbGVuID0gKHJlcS0+cmVxX2xlbiA8
IHJlc3BfbGVuKSA/IHJlcS0+cmVxX2xlbiA6IHJlc3BfbGVuOwogCi0gICAgU1BJQ0VfREVCVUco
ImlucXVpcnlfc3RhbmRhcmQsIGx1bjolIiBHX0dVSU5UMzJfRk9STUFUCi0gICAgICAgICAgICAg
ICAgIiBpbnF1aXJ5X2xlbjogJSIgR19HVUlOVDMyX0ZPUk1BVCAiIHJlc3BfbGVuOiAlIiBHX0dV
SU5UNjRfRk9STUFULAorICAgIFNQSUNFX0RFQlVHKCJpbnF1aXJ5X3N0YW5kYXJkLCBsdW46JXUi
CisgICAgICAgICAgICAgICAgIiBpbnF1aXJ5X2xlbjogJXUgcmVzcF9sZW46ICUiIEdfR1VJTlQ2
NF9GT1JNQVQsCiAgICAgICAgICAgICAgICAgcmVxLT5sdW4sIHJlc3BfbGVuLCByZXEtPmluX2xl
bik7CiAKICAgICBjZF9zY3NpX2NtZF9jb21wbGV0ZV9nb29kKGRldiwgcmVxKTsKQEAgLTExMTYs
NyArMTExNSw3IEBAIHN0YXRpYyB2b2lkIGNkX3Njc2lfY21kX2lucXVpcnkoQ2RTY3NpTFUgKmRl
diwgQ2RTY3NpUmVxdWVzdCAqcmVxKQogICAgIGNtZF9kYXRhID0gKHJlcS0+Y2RiWzFdICYgQ0Rf
SU5RVUlSWV9GTEFHX0NNRF9EVCkgPyBUUlVFIDogRkFMU0U7CiAKICAgICBpZiAoY21kX2RhdGEp
IHsKLSAgICAgICAgU1BJQ0VfREVCVUcoImlucXVpcnksIGx1bjolIiBHX0dVSU5UMzJfRk9STUFU
ICIgQ21kRFQgYml0IHNldCAtIHVuc3VwcG9ydGVkLCAiCisgICAgICAgIFNQSUNFX0RFQlVHKCJp
bnF1aXJ5LCBsdW46JXUgQ21kRFQgYml0IHNldCAtIHVuc3VwcG9ydGVkLCAiCiAgICAgICAgICAg
ICAgICAgICAgICJjZGJbMV06MHglMDJ4IGNkYlsxXToweCUwMngiLAogICAgICAgICAgICAgICAg
ICAgICByZXEtPmx1biwgKGludClyZXEtPmNkYlsxXSwgKGludClyZXEtPmNkYlsyXSk7CiAgICAg
ICAgIGNkX3Njc2lfY21kX2NvbXBsZXRlX2NoZWNrX2NvbmQoZGV2LCByZXEsICZzZW5zZV9jb2Rl
X0lOVkFMSURfQ0RCX0ZJRUxEKTsKQEAgLTExMzAsNyArMTEyOSw3IEBAIHN0YXRpYyB2b2lkIGNk
X3Njc2lfY21kX2lucXVpcnkoQ2RTY3NpTFUgKmRldiwgQ2RTY3NpUmVxdWVzdCAqcmVxKQogICAg
ICAgICBjZF9zY3NpX2NtZF9pbnF1aXJ5X3ZwZChkZXYsIHJlcSk7CiAgICAgfSBlbHNlIHsgLyog
c3RhbmRhcmQgaW5xdWlyeSBkYXRhICovCiAgICAgICAgIGlmIChyZXEtPmNkYlsyXSAhPSAwKSB7
Ci0gICAgICAgICAgICBTUElDRV9ERUJVRygiaW5xdWlyeV9zdGFuZGFyZCwgbHVuOiUiIEdfR1VJ
TlQzMl9GT1JNQVQgIiBub24temVybyBwYWdlIGNvZGU6ICUwMngiLAorICAgICAgICAgICAgU1BJ
Q0VfREVCVUcoImlucXVpcnlfc3RhbmRhcmQsIGx1bjoldSBub24temVybyBwYWdlIGNvZGU6ICUw
MngiLAogICAgICAgICAgICAgICAgICAgICAgICAgcmVxLT5sdW4sIChpbnQpcmVxLT5jZGJbMl0p
OwogICAgICAgICAgICAgY2Rfc2NzaV9jbWRfY29tcGxldGVfY2hlY2tfY29uZChkZXYsIHJlcSwg
JnNlbnNlX2NvZGVfSU5WQUxJRF9DREJfRklFTEQpOwogICAgICAgICAgICAgcmV0dXJuOwpAQCAt
MTE1Miw4ICsxMTUxLDcgQEAgc3RhdGljIHZvaWQgY2Rfc2NzaV9jbWRfcmVhZF9jYXBhY2l0eShD
ZFNjc2lMVSAqZGV2LCBDZFNjc2lSZXF1ZXN0ICpyZXEpCiAgICAgKmxhc3RfYmxrX291dCA9IGh0
b2JlMzIobGFzdF9ibGspOwogICAgICpibGtfc2l6ZV9vdXQgPSBodG9iZTMyKGJsa19zaXplKTsK
IAotICAgIFNQSUNFX0RFQlVHKCJSZWFkIGNhcGFjaXR5LCBsdW46JSIgR19HVUlOVDMyX0ZPUk1B
VAotICAgICAgICAgICAgICAgICIgbGFzdF9ibGs6ICUiIEdfR1VJTlQzMl9GT1JNQVQgIiBibGtf
c3o6ICUiIEdfR1VJTlQzMl9GT1JNQVQsCisgICAgU1BJQ0VfREVCVUcoIlJlYWQgY2FwYWNpdHks
IGx1bjoldSBsYXN0X2JsazogJXUgYmxrX3N6OiAldSIsCiAgICAgICAgICAgICAgICAgcmVxLT5s
dW4sIGxhc3RfYmxrLCBibGtfc2l6ZSk7CiAKICAgICByZXEtPmluX2xlbiA9IDg7CkBAIC0xMTk2
LDcgKzExOTQsNyBAQCBzdGF0aWMgdm9pZCBjZF9zY3NpX2NtZF9nZXRfcmVhZF9kaXNjX2luZm9y
bWF0aW9uKENkU2NzaUxVICpkZXYsIENkU2NzaVJlcXVlc3QgKgogCiAgICAgZGF0YV90eXBlID0g
cmVxLT5jZGJbMV0gJiAweDc7CiAgICAgaWYgKGRhdGFfdHlwZSAhPSBSRElfVFlQRV9TVEFOREFS
RCkgewotICAgICAgICBTUElDRV9ERUJVRygicmVhZF9kaXNjX2luZm9ybWF0aW9uLCBsdW46JSIg
R19HVUlOVDMyX0ZPUk1BVAorICAgICAgICBTUElDRV9ERUJVRygicmVhZF9kaXNjX2luZm9ybWF0
aW9uLCBsdW46JXUiCiAgICAgICAgICAgICAgICAgICAgICIgdW5zdXBwb3J0ZWQgZGF0YSB0eXBl
OiAlMDJ4IiwKICAgICAgICAgICAgICAgICAgICAgcmVxLT5sdW4sIGRhdGFfdHlwZSk7CiAgICAg
ICAgIGNkX3Njc2lfY21kX2NvbXBsZXRlX2NoZWNrX2NvbmQoZGV2LCByZXEsICZzZW5zZV9jb2Rl
X0lOVkFMSURfQ0RCX0ZJRUxEKTsKQEAgLTEyMTgsNyArMTIxNiw3IEBAIHN0YXRpYyB2b2lkIGNk
X3Njc2lfY21kX2dldF9yZWFkX2Rpc2NfaW5mb3JtYXRpb24oQ2RTY3NpTFUgKmRldiwgQ2RTY3Np
UmVxdWVzdCAqCiAgICAgb3V0YnVmWzEwXSA9IChmaXJzdF90cmFjayA+PiA4KSAmIDB4ZmY7IC8q
IGluIGxhc3Qgc2Vzc29uLCBsc2IgKi8KICAgICBvdXRidWZbMTFdID0gKGxhc3RfdHJhY2sgPj4g
OCkgJiAweGZmOyAvKiBpbiBsYXN0IHNlc3NvbiwgbHNiICovCiAKLSAgICBTUElDRV9ERUJVRygi
cmVhZF9kaXNjX2luZm9ybWF0aW9uLCBsdW46JSIgR19HVUlOVDMyX0ZPUk1BVCAiIGxlbjogJSIg
R19HVUlOVDY0X0ZPUk1BVCwKKyAgICBTUElDRV9ERUJVRygicmVhZF9kaXNjX2luZm9ybWF0aW9u
LCBsdW46JXUgbGVuOiAlIiBHX0dVSU5UNjRfRk9STUFULAogICAgICAgICAgICAgICAgIHJlcS0+
bHVuLCByZXEtPmluX2xlbik7CiAKICAgICBjZF9zY3NpX2NtZF9jb21wbGV0ZV9nb29kKGRldiwg
cmVxKTsKQEAgLTEyNTcsOSArMTI1NSw5IEBAIHN0YXRpYyB2b2lkIGNkX3Njc2lfY21kX2dldF9y
ZWFkX3RyYWNrX2luZm9ybWF0aW9uKENkU2NzaUxVICpkZXYsIENkU2NzaVJlcXVlc3QKICAgICBz
d2l0Y2ggKGFkZHJfdHlwZSkgewogICAgIGNhc2UgUlRJX0FERFJfVFlQRV9MQkE6CiAgICAgICAg
IGlmIChhZGRyX251bSA+IGxhc3RfYWRkcikgewotICAgICAgICAgICAgU1BJQ0VfREVCVUcoInJl
YWRfdHJhY2tfaW5mb3JtYXRpb24sIGx1bjolIiBHX0dVSU5UMzJfRk9STUFUCi0gICAgICAgICAg
ICAgICAgICAgICAgICAiIGFkZHJfdHlwZSBMQkE6ICUiIEdfR1VJTlQzMl9GT1JNQVQKLSAgICAg
ICAgICAgICAgICAgICAgICAgICIgaW52YWxpZCBMQkE6ICUiIEdfR1VJTlQzMl9GT1JNQVQsCisg
ICAgICAgICAgICBTUElDRV9ERUJVRygicmVhZF90cmFja19pbmZvcm1hdGlvbiwgbHVuOiV1Igor
ICAgICAgICAgICAgICAgICAgICAgICAgIiBhZGRyX3R5cGUgTEJBOiAldSIKKyAgICAgICAgICAg
ICAgICAgICAgICAgICIgaW52YWxpZCBMQkE6ICV1IiwKICAgICAgICAgICAgICAgICAgICAgICAg
IHJlcS0+bHVuLCBhZGRyX3R5cGUsIGFkZHJfbnVtKTsKICAgICAgICAgICAgIGNkX3Njc2lfY21k
X2NvbXBsZXRlX2NoZWNrX2NvbmQoZGV2LCByZXEsICZzZW5zZV9jb2RlX0lOVkFMSURfQ0RCX0ZJ
RUxEKTsKICAgICAgICAgICAgIHJldHVybjsKQEAgLTEyNjcsOSArMTI2NSw5IEBAIHN0YXRpYyB2
b2lkIGNkX3Njc2lfY21kX2dldF9yZWFkX3RyYWNrX2luZm9ybWF0aW9uKENkU2NzaUxVICpkZXYs
IENkU2NzaVJlcXVlc3QKICAgICAgICAgYnJlYWs7CiAgICAgY2FzZSBSVElfQUREUl9UWVBFX1RS
QUNLX05VTToKICAgICAgICAgaWYgKGFkZHJfbnVtICE9IHRyYWNrX251bSkgewotICAgICAgICAg
ICAgU1BJQ0VfREVCVUcoInJlYWRfdHJhY2tfaW5mb3JtYXRpb24sIGx1bjolIiBHX0dVSU5UMzJf
Rk9STUFUCi0gICAgICAgICAgICAgICAgICAgICAgICAiIGFkZHJfdHlwZSB0cmFjazogJSIgR19H
VUlOVDMyX0ZPUk1BVAotICAgICAgICAgICAgICAgICAgICAgICAgIiBpbnZhbGlkIHRyYWNrOiAl
IiBHX0dVSU5UMzJfRk9STUFULAorICAgICAgICAgICAgU1BJQ0VfREVCVUcoInJlYWRfdHJhY2tf
aW5mb3JtYXRpb24sIGx1bjoldSIKKyAgICAgICAgICAgICAgICAgICAgICAgICIgYWRkcl90eXBl
IHRyYWNrOiAldSIKKyAgICAgICAgICAgICAgICAgICAgICAgICIgaW52YWxpZCB0cmFjazogJXUi
LAogICAgICAgICAgICAgICAgICAgICAgICAgcmVxLT5sdW4sIGFkZHJfdHlwZSwgYWRkcl9udW0p
OwogICAgICAgICAgICAgY2Rfc2NzaV9jbWRfY29tcGxldGVfY2hlY2tfY29uZChkZXYsIHJlcSwg
JnNlbnNlX2NvZGVfSU5WQUxJRF9DREJfRklFTEQpOwogICAgICAgICAgICAgcmV0dXJuOwpAQCAt
MTI3NywxOCArMTI3NSwxOCBAQCBzdGF0aWMgdm9pZCBjZF9zY3NpX2NtZF9nZXRfcmVhZF90cmFj
a19pbmZvcm1hdGlvbihDZFNjc2lMVSAqZGV2LCBDZFNjc2lSZXF1ZXN0CiAgICAgICAgIGJyZWFr
OwogICAgIGNhc2UgUlRJX0FERFJfVFlQRV9TRVNTSU9OX05VTToKICAgICAgICAgaWYgKGFkZHJf
bnVtICE9IHNlc3Npb25fbnVtKSB7Ci0gICAgICAgICAgICBTUElDRV9ERUJVRygicmVhZF90cmFj
a19pbmZvcm1hdGlvbiwgbHVuOiUiIEdfR1VJTlQzMl9GT1JNQVQKLSAgICAgICAgICAgICAgICAg
ICAgICAgICIgYWRkcl90eXBlIHNlc3Npb246ICUiIEdfR1VJTlQzMl9GT1JNQVQKLSAgICAgICAg
ICAgICAgICAgICAgICAgICIgaW52YWxpZCBzZXNzaW9uOiAlIiBHX0dVSU5UMzJfRk9STUFULAor
ICAgICAgICAgICAgU1BJQ0VfREVCVUcoInJlYWRfdHJhY2tfaW5mb3JtYXRpb24sIGx1bjoldSIK
KyAgICAgICAgICAgICAgICAgICAgICAgICIgYWRkcl90eXBlIHNlc3Npb246ICV1IgorICAgICAg
ICAgICAgICAgICAgICAgICAgIiBpbnZhbGlkIHNlc3Npb246ICV1IiwKICAgICAgICAgICAgICAg
ICAgICAgICAgIHJlcS0+bHVuLCBhZGRyX3R5cGUsIGFkZHJfbnVtKTsKICAgICAgICAgICAgIGNk
X3Njc2lfY21kX2NvbXBsZXRlX2NoZWNrX2NvbmQoZGV2LCByZXEsICZzZW5zZV9jb2RlX0lOVkFM
SURfQ0RCX0ZJRUxEKTsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogICAgICAgICBi
cmVhazsKICAgICBkZWZhdWx0OgotICAgICAgICBTUElDRV9ERUJVRygicmVhZF90cmFja19pbmZv
cm1hdGlvbiwgbHVuOiUiIEdfR1VJTlQzMl9GT1JNQVQKLSAgICAgICAgICAgICAgICAgICAgImlu
dmFsaWQgYWRkcl90eXBlOiAlIiBHX0dVSU5UMzJfRk9STUFUCi0gICAgICAgICAgICAgICAgICAg
ICIgYWRkcl9udW06ICUiIEdfR1VJTlQzMl9GT1JNQVQsCisgICAgICAgIFNQSUNFX0RFQlVHKCJy
ZWFkX3RyYWNrX2luZm9ybWF0aW9uLCBsdW46JXUiCisgICAgICAgICAgICAgICAgICAgICIgaW52
YWxpZCBhZGRyX3R5cGU6ICV1IgorICAgICAgICAgICAgICAgICAgICAiIGFkZHJfbnVtOiAldSIs
CiAgICAgICAgICAgICAgICAgICAgIHJlcS0+bHVuLCBhZGRyX3R5cGUsIGFkZHJfbnVtKTsKICAg
ICAgICAgY2Rfc2NzaV9jbWRfY29tcGxldGVfY2hlY2tfY29uZChkZXYsIHJlcSwgJnNlbnNlX2Nv
ZGVfSU5WQUxJRF9DREJfRklFTEQpOwogICAgICAgICByZXR1cm47CkBAIC0xMzE3LDggKzEzMTUs
OCBAQCBzdGF0aWMgdm9pZCBjZF9zY3NpX2NtZF9nZXRfcmVhZF90cmFja19pbmZvcm1hdGlvbihD
ZFNjc2lMVSAqZGV2LCBDZFNjc2lSZXF1ZXN0CiAgICAgb3V0YnVmWzMwXSA9IChsYXN0X2FkZHIg
Pj4gOCkgJiAweGZmOwogICAgIG91dGJ1ZlszMV0gPSAobGFzdF9hZGRyKSAmIDB4ZmY7CiAKLSAg
ICBTUElDRV9ERUJVRygicmVhZF90cmFja19pbmZvcm1hdGlvbiwgbHVuOiUiIEdfR1VJTlQzMl9G
T1JNQVQKLSAgICAgICAgICAgICAgICAiYWRkcl90eXBlOiAlIiBHX0dVSU5UMzJfRk9STUFUICIg
YWRkcl9udW06ICUiIEdfR1VJTlQzMl9GT1JNQVQsCisgICAgU1BJQ0VfREVCVUcoInJlYWRfdHJh
Y2tfaW5mb3JtYXRpb24sIGx1bjoldSIKKyAgICAgICAgICAgICAgICAiYWRkcl90eXBlOiAldSBh
ZGRyX251bTogJXUiLAogICAgICAgICAgICAgICAgIHJlcS0+bHVuLCBhZGRyX3R5cGUsIGFkZHJf
bnVtKTsKIAogICAgIGNkX3Njc2lfY21kX2NvbXBsZXRlX2dvb2QoZGV2LCByZXEpOwpAQCAtMTM2
MSw3ICsxMzU5LDcgQEAgc3RhdGljIHZvaWQgY2Rfc2NzaV9jbWRfcmVhZF90b2MoQ2RTY3NpTFUg
KmRldiwgQ2RTY3NpUmVxdWVzdCAqcmVxKQogICAgIG91dGJ1ZlsxOF0gPSBsYXN0X2JsayA+PiA4
OwogICAgIG91dGJ1ZlsxOV0gPSBsYXN0X2JsazsKIAotICAgIFNQSUNFX0RFQlVHKCJyZWFkX3Rv
YywgbHVuOiUiIEdfR1VJTlQzMl9GT1JNQVQgIiBsZW46ICUiIEdfR1VJTlQ2NF9GT1JNQVQKKyAg
ICBTUElDRV9ERUJVRygicmVhZF90b2MsIGx1bjoldSBsZW46ICUiIEdfR1VJTlQ2NF9GT1JNQVQK
ICAgICAgICAgICAgICAgICAiIG1zZjogJXggZm9ybWF0OiAweCUwMnggdHJhY2svc2Vzc2lvbjog
MHglMDJ4IiwKICAgICAgICAgICAgICAgICByZXEtPmx1biwgcmVxLT5pbl9sZW4sIG1zZiwgZm9y
bWF0LCB0cmFja19udW0pOwogCkBAIC0xNDg1LDcgKzE0ODMsNyBAQCBzdGF0aWMgdm9pZCBjZF9z
Y3NpX2NtZF9tb2RlX3NlbnNlXzEwKENkU2NzaUxVICpkZXYsIENkU2NzaVJlcXVlc3QgKnJlcSkK
ICAgICBjYXNlIE1PREVfUEFHRV9DRF9ERVZJQ0U6IC8qIENEIERldmljZSBwYXJhbWV0ZXJzICov
CiAgICAgY2FzZSBNT0RFX1BBR0VfVE9fUFJPVEVDVDogLyogVGltZS1vdXQgYW5kIFByb3RlY3Qg
Ki8KICAgICBkZWZhdWx0OgotICAgICAgICBTUElDRV9ERUJVRygibW9kZV9zZW5zZV8xMCwgbHVu
OiUiIEdfR1VJTlQzMl9GT1JNQVQKKyAgICAgICAgU1BJQ0VfREVCVUcoIm1vZGVfc2Vuc2VfMTAs
IGx1bjoldSIKICAgICAgICAgICAgICAgICAgICAgIiBwYWdlIDB4JXggbm90IGltcGxlbWVudGVk
IiwKICAgICAgICAgICAgICAgICAgICAgcmVxLT5sdW4sICh1bnNpZ25lZClwYWdlKTsKICAgICAg
ICAgY2Rfc2NzaV9jbWRfY29tcGxldGVfY2hlY2tfY29uZChkZXYsIHJlcSwgJnNlbnNlX2NvZGVf
SU5WQUxJRF9DREJfRklFTEQpOwpAQCAtMTQ5Nyw5ICsxNDk1LDkgQEAgc3RhdGljIHZvaWQgY2Rf
c2NzaV9jbWRfbW9kZV9zZW5zZV8xMChDZFNjc2lMVSAqZGV2LCBDZFNjc2lSZXF1ZXN0ICpyZXEp
CiAKICAgICByZXEtPmluX2xlbiA9IChyZXEtPnJlcV9sZW4gPCByZXNwX2xlbikgPyByZXEtPnJl
cV9sZW4gOiByZXNwX2xlbjsKIAotICAgIFNQSUNFX0RFQlVHKCJtb2RlX3NlbnNlXzEwLCBsdW46
JSIgR19HVUlOVDMyX0ZPUk1BVAorICAgIFNQSUNFX0RFQlVHKCJtb2RlX3NlbnNlXzEwLCBsdW46
JXUiCiAgICAgICAgICAgICAgICAgIiBsb25nX2xiYSAlZCwgZGJkICVkLCBwYWdlICVkLCBzdWJf
cGFnZSAlZCwgcGMgJWQ7ICIKLSAgICAgICAgICAgICAgICAicmVzcF9sZW4gJSIgR19HVUlOVDMy
X0ZPUk1BVCwKKyAgICAgICAgICAgICAgICAicmVzcF9sZW4gJXUiLAogICAgICAgICAgICAgICAg
IHJlcS0+bHVuLCBsb25nX2xiYSwgZGJkLCBwYWdlLCBzdWJfcGFnZSwgcGMsIHJlc3BfbGVuKTsK
IAogICAgIGNkX3Njc2lfY21kX2NvbXBsZXRlX2dvb2QoZGV2LCByZXEpOwpAQCAtMTUxOCw5ICsx
NTE2LDkgQEAgc3RhdGljIHZvaWQgY2Rfc2NzaV9jbWRfbW9kZV9zZWxlY3RfNihDZFNjc2lMVSAq
ZGV2LCBDZFNjc2lSZXF1ZXN0ICpyZXEpCiAgICAgbGlzdF9sZW4gPSByZXEtPmNkYls0XTsKIAog
ICAgIGlmIChsaXN0X2xlbiA+IHJlcS0+YnVmX2xlbikgewotICAgICAgICBTUElDRV9ERUJVRygi
bW9kZV9zZWxlY3RfNiwgbHVuOiUiIEdfR1VJTlQzMl9GT1JNQVQKLSAgICAgICAgICAgICAgICAg
ICAgIiBwZjolIiBHX0dVSU5UMzJfRk9STUFUICIgc3A6JSIgR19HVUlOVDMyX0ZPUk1BVAotICAg
ICAgICAgICAgICAgICAgICAiIGxpc3RfbGVuOiUiIEdfR1VJTlQzMl9GT1JNQVQgIiBleGNlZWRz
IGRhdGFfbGVuOiUiIEdfR1VJTlQzMl9GT1JNQVQsCisgICAgICAgIFNQSUNFX0RFQlVHKCJtb2Rl
X3NlbGVjdF82LCBsdW46JXUiCisgICAgICAgICAgICAgICAgICAgICIgcGY6JXUgc3A6JXUiCisg
ICAgICAgICAgICAgICAgICAgICIgbGlzdF9sZW46JXUgZXhjZWVkcyBkYXRhX2xlbjoldSIsCiAg
ICAgICAgICAgICAgICAgICAgIHJlcS0+bHVuLCBwYWdlX2Zvcm1hdCwgc2F2ZV9wYWdlcywgbGlz
dF9sZW4sIHJlcS0+YnVmX2xlbik7CiAgICAgICAgIGNkX3Njc2lfY21kX2NvbXBsZXRlX2NoZWNr
X2NvbmQoZGV2LCByZXEsICZzZW5zZV9jb2RlX0lOVkFMSURfUEFSQU1fTEVOKTsKICAgICAgICAg
cmV0dXJuOwpAQCAtMTU0NiwxMyArMTU0NCwxMSBAQCBzdGF0aWMgdm9pZCBjZF9zY3NpX2NtZF9t
b2RlX3NlbGVjdF82KENkU2NzaUxVICpkZXYsIENkU2NzaVJlcXVlc3QgKnJlcSkKICAgICAgICAg
cGFnZV9sZW4gPSBtb2RlX2RhdGFbMV07CiAgICAgfQogCi0gICAgU1BJQ0VfREVCVUcoIm1vZGVf
c2VsZWN0XzYsIGx1bjolIiBHX0dVSU5UMzJfRk9STUFUCi0gICAgICAgICAgICAgICAgIiBwZjol
IiBHX0dVSU5UMzJfRk9STUFUICIgc3A6JSIgR19HVUlOVDMyX0ZPUk1BVAotICAgICAgICAgICAg
ICAgICIgbGlzdF9sZW46JSIgR19HVUlOVDMyX0ZPUk1BVCAiIGRhdGFfbGVuOiUiIEdfR1VJTlQz
Ml9GT1JNQVQKLSAgICAgICAgICAgICAgICAiIG1vZGVfbGVuOiUiIEdfR1VJTlQzMl9GT1JNQVQg
IiBtZWRpdW06JSIgR19HVUlOVDMyX0ZPUk1BVAotICAgICAgICAgICAgICAgICIgZGV2X3BhcmFt
OiUiIEdfR1VJTlQzMl9GT1JNQVQgIiBibGtfZGVzY19sZW46JSIgR19HVUlOVDMyX0ZPUk1BVAot
ICAgICAgICAgICAgICAgICIgbnVtX2Jsb2NrczolIiBHX0dVSU5UMzJfRk9STUFUICIgYmxvY2tf
bGVuOiUiIEdfR1VJTlQzMl9GT1JNQVQKLSAgICAgICAgICAgICAgICAiIHBhZ2VfbnVtOiUiIEdf
R1VJTlQzMl9GT1JNQVQgIiBwYWdlX2xlbjolIiBHX0dVSU5UMzJfRk9STUFULAorICAgIFNQSUNF
X0RFQlVHKCJtb2RlX3NlbGVjdF82LCBsdW46JXUiCisgICAgICAgICAgICAgICAgIiBwZjoldSBz
cDoldSBsaXN0X2xlbjoldSBkYXRhX2xlbjoldSIKKyAgICAgICAgICAgICAgICAiIG1vZGVfbGVu
OiV1IG1lZGl1bToldSBkZXZfcGFyYW06JXUgYmxrX2Rlc2NfbGVuOiV1IgorICAgICAgICAgICAg
ICAgICIgbnVtX2Jsb2NrczoldSBibG9ja19sZW46JXUiCisgICAgICAgICAgICAgICAgIiBwYWdl
X251bToldSBwYWdlX2xlbjoldSIsCiAgICAgICAgICAgICAgICAgcmVxLT5sdW4sIHBhZ2VfZm9y
bWF0LCBzYXZlX3BhZ2VzLCBsaXN0X2xlbiwgcmVxLT5idWZfbGVuLAogICAgICAgICAgICAgICAg
IG1vZGVfbGVuLCBtZWRpdW1fdHlwZSwgZGV2X3BhcmFtLCBibG9ja19kZXNjX2xlbiwKICAgICAg
ICAgICAgICAgICBudW1fYmxvY2tzLCBibG9ja19sZW4sCkBAIC0xNTcwLDE3ICsxNTY2LDE1IEBA
IHN0YXRpYyB2b2lkIGNkX3Njc2lfY21kX21vZGVfc2VsZWN0XzEwKENkU2NzaUxVICpkZXYsIENk
U2NzaVJlcXVlc3QgKnJlcSkKICAgICBsaXN0X2xlbiA9IChyZXEtPmNkYls3XSA8PCA4KSB8IHJl
cS0+Y2RiWzhdOwogCiAgICAgaWYgKGxpc3RfbGVuID4gcmVxLT5idWZfbGVuKSB7Ci0gICAgICAg
IFNQSUNFX0RFQlVHKCJtb2RlX3NlbGVjdF8xMCwgbHVuOiUiIEdfR1VJTlQzMl9GT1JNQVQKLSAg
ICAgICAgICAgICAgICAgICAgIiBwZjolIiBHX0dVSU5UMzJfRk9STUFUICIgc3A6JSIgR19HVUlO
VDMyX0ZPUk1BVAotICAgICAgICAgICAgICAgICAgICAiIGxpc3RfbGVuOiUiIEdfR1VJTlQzMl9G
T1JNQVQgIiBleGNlZWRzIGRhdGFfbGVuOiUiIEdfR1VJTlQzMl9GT1JNQVQsCisgICAgICAgIFNQ
SUNFX0RFQlVHKCJtb2RlX3NlbGVjdF8xMCwgbHVuOiV1IHBmOiV1IHNwOiV1IgorICAgICAgICAg
ICAgICAgICAgICAiIGxpc3RfbGVuOiV1IGV4Y2VlZHMgZGF0YV9sZW46JXUiLAogICAgICAgICAg
ICAgICAgICAgICByZXEtPmx1biwgcGFnZV9mb3JtYXQsIHNhdmVfcGFnZXMsIGxpc3RfbGVuLCBy
ZXEtPmJ1Zl9sZW4pOwogICAgICAgICBjZF9zY3NpX2NtZF9jb21wbGV0ZV9jaGVja19jb25kKGRl
diwgcmVxLCAmc2Vuc2VfY29kZV9JTlZBTElEX1BBUkFNX0xFTik7CiAgICAgICAgIHJldHVybjsK
ICAgICB9CiAKLSAgICBTUElDRV9ERUJVRygibW9kZV9zZWxlY3RfMTAsIGx1bjolIiBHX0dVSU5U
MzJfRk9STUFUCi0gICAgICAgICAgICAgICAgIiBwZjolIiBHX0dVSU5UMzJfRk9STUFUICIgc3A6
JSIgR19HVUlOVDMyX0ZPUk1BVAotICAgICAgICAgICAgICAgICIgbGlzdF9sZW46JSIgR19HVUlO
VDMyX0ZPUk1BVCAiIGRhdGFfbGVuOiUiIEdfR1VJTlQzMl9GT1JNQVQsCisgICAgU1BJQ0VfREVC
VUcoIm1vZGVfc2VsZWN0XzEwLCBsdW46JXUgcGY6JXUgc3A6JXUiCisgICAgICAgICAgICAgICAg
IiBsaXN0X2xlbjoldSBkYXRhX2xlbjoldSIsCiAgICAgICAgICAgICAgICAgcmVxLT5sdW4sIHBh
Z2VfZm9ybWF0LCBzYXZlX3BhZ2VzLCBsaXN0X2xlbiwgcmVxLT5idWZfbGVuKTsKIAogICAgIGNk
X3Njc2lfY21kX2NvbXBsZXRlX2dvb2QoZGV2LCByZXEpOwpAQCAtMTkwOCw4ICsxOTAyLDcgQEAg
c3RhdGljIHZvaWQgY2Rfc2NzaV9jbWRfZ2V0X2NvbmZpZ3VyYXRpb24oQ2RTY3NpTFUgKmRldiwg
Q2RTY3NpUmVxdWVzdCAqcmVxKQogICAgICAgICBicmVhazsKIAogICAgIGRlZmF1bHQ6Ci0gICAg
ICAgIFNQSUNFX0RFQlVHKCJnZXRfY29uZmlndXJhdGlvbiwgbHVuOiUiIEdfR1VJTlQzMl9GT1JN
QVQKLSAgICAgICAgICAgICAgICAgICAgIiBpbnZhbGlkIHJ0OiUiIEdfR1VJTlQzMl9GT1JNQVQg
IiBzdGFydF9mOiUiIEdfR1VJTlQzMl9GT1JNQVQsCisgICAgICAgIFNQSUNFX0RFQlVHKCJnZXRf
Y29uZmlndXJhdGlvbiwgbHVuOiV1IGludmFsaWQgcnQ6JXUgc3RhcnRfZjoldSIsCiAgICAgICAg
ICAgICAgICAgICAgIHJlcS0+bHVuLCByZXFfdHlwZSwgc3RhcnRfZmVhdHVyZSk7CiAgICAgICAg
IGNkX3Njc2lfY21kX2NvbXBsZXRlX2NoZWNrX2NvbmQoZGV2LCByZXEsICZzZW5zZV9jb2RlX0lO
VkFMSURfQ0RCX0ZJRUxEKTsKICAgICAgICAgcmV0dXJuOwpAQCAtMTkyNyw5ICsxOTIwLDcgQEAg
c3RhdGljIHZvaWQgY2Rfc2NzaV9jbWRfZ2V0X2NvbmZpZ3VyYXRpb24oQ2RTY3NpTFUgKmRldiwg
Q2RTY3NpUmVxdWVzdCAqcmVxKQogCiAgICAgcmVxLT5pbl9sZW4gPSAocmVxLT5yZXFfbGVuIDwg
cmVzcF9sZW4pID8gcmVxLT5yZXFfbGVuIDogcmVzcF9sZW47CiAKLSAgICBTUElDRV9ERUJVRygi
Z2V0X2NvbmZpZ3VyYXRpb24sIGx1bjolIiBHX0dVSU5UMzJfRk9STUFUCi0gICAgICAgICAgICAg
ICAgIiBydDolIiBHX0dVSU5UMzJfRk9STUFUICIgc3RhcnRfZjolIiBHX0dVSU5UMzJfRk9STUFU
Ci0gICAgICAgICAgICAgICAgIiByZXNwX2xlbjolIiBHX0dVSU5UMzJfRk9STUFULAorICAgIFNQ
SUNFX0RFQlVHKCJnZXRfY29uZmlndXJhdGlvbiwgbHVuOiV1IHJ0OiV1IHN0YXJ0X2Y6JXUgcmVz
cF9sZW46JXUiLAogICAgICAgICAgICAgICAgIHJlcS0+bHVuLCByZXFfdHlwZSwgc3RhcnRfZmVh
dHVyZSwgcmVzcF9sZW4pOwogCiAgICAgY2Rfc2NzaV9jbWRfY29tcGxldGVfZ29vZChkZXYsIHJl
cSk7CkBAIC0xOTk0LDcgKzE5ODUsNyBAQCBzdGF0aWMgdm9pZCBjZF9zY3NpX2NtZF9nZXRfZXZl
bnRfc3RhdHVzX25vdGlmaWNhdGlvbihDZFNjc2lMVSAqZGV2LCBDZFNjc2lSZXF1ZQogICAgIHJl
cS0+cmVxX2xlbiA9IChyZXEtPmNkYls3XSA8PCA4KSB8IHJlcS0+Y2RiWzhdOwogCiAgICAgaWYg
KCFpbW1lZCkgewotICAgICAgICBTUElDRV9ERUJVRygiZ2V0X2V2ZW50X3N0YXR1c19ub3RpZmlj
YXRpb24sIGx1bjolIiBHX0dVSU5UMzJfRk9STUFUCisgICAgICAgIFNQSUNFX0RFQlVHKCJnZXRf
ZXZlbnRfc3RhdHVzX25vdGlmaWNhdGlvbiwgbHVuOiV1IgogICAgICAgICAgICAgICAgICIgaW1t
OjAgY2xhc3NfcmVxOiUwMngsIE5vbi1pbW1lZGlhdGUgKGFzeW5jKSBtb2RlIHVuc3VwcG9ydGVk
IiwKICAgICAgICAgICAgICAgICByZXEtPmx1biwgY2xhc3Nlc19yZXF1ZXN0ZWQpOwogICAgICAg
ICBjZF9zY3NpX2NtZF9jb21wbGV0ZV9jaGVja19jb25kKGRldiwgcmVxLCAmc2Vuc2VfY29kZV9J
TlZBTElEX0NEQl9GSUVMRCk7CkBAIC0yMDA3LDggKzE5OTgsOCBAQCBzdGF0aWMgdm9pZCBjZF9z
Y3NpX2NtZF9nZXRfZXZlbnRfc3RhdHVzX25vdGlmaWNhdGlvbihDZFNjc2lMVSAqZGV2LCBDZFNj
c2lSZXF1ZQogICAgICAgICAgICAgb3V0YnVmWzJdID0gQ0RfR0VUX0VWRU5UX0NMQVNTX1BPV0VS
X01HTVQ7CiAgICAgICAgICAgICBvdXRidWZbM10gPSAodWludDhfdClwb3dlcl9jbGFzc19tYXNr
OwogCi0gICAgICAgICAgICBTUElDRV9ERUJVRygiZ2V0X2V2ZW50X3N0YXR1c19ub3RpZmljYXRp
b24sIGx1bjolIiBHX0dVSU5UMzJfRk9STUFUCi0gICAgICAgICAgICAgICAgICAgICAgICAiIGlt
bTolIiBHX0dVSU5UMzJfRk9STUFUICIgY2xhc3NfcmVxOjB4JTAyeCBjbGFzc19zdXA6MHglMDJ4
IgorICAgICAgICAgICAgU1BJQ0VfREVCVUcoImdldF9ldmVudF9zdGF0dXNfbm90aWZpY2F0aW9u
LCBsdW46JXUiCisgICAgICAgICAgICAgICAgICAgICAgICAiIGltbToldSBjbGFzc19yZXE6MHgl
MDJ4IGNsYXNzX3N1cDoweCUwMngiCiAgICAgICAgICAgICAgICAgICAgICAgICAiIHBvd2VyX2V2
ZW50OjB4JTAyeCBwb3dlcl9jb25kOjB4JTAyeCIsCiAgICAgICAgICAgICAgICAgICAgICAgICBy
ZXEtPmx1biwgaW1tZWQsIGNsYXNzZXNfcmVxdWVzdGVkLCBjbGFzc2VzX3N1cHBvcnRlZCwKICAg
ICAgICAgICAgICAgICAgICAgICAgIGRldi0+cG93ZXJfZXZlbnQsIGRldi0+cG93ZXJfY29uZCk7
CkBAIC0yMDE4LDggKzIwMDksOCBAQCBzdGF0aWMgdm9pZCBjZF9zY3NpX2NtZF9nZXRfZXZlbnRf
c3RhdHVzX25vdGlmaWNhdGlvbihDZFNjc2lMVSAqZGV2LCBDZFNjc2lSZXF1ZQogICAgICAgICAg
ICAgb3V0YnVmWzJdID0gQ0RfR0VUX0VWRU5UX0NMQVNTX01FRElBOwogICAgICAgICAgICAgb3V0
YnVmWzNdID0gKHVpbnQ4X3QpbWVkaWFfY2xhc3NfbWFzazsKIAotICAgICAgICAgICAgU1BJQ0Vf
REVCVUcoImdldF9ldmVudF9zdGF0dXNfbm90aWZpY2F0aW9uLCBsdW46JSIgR19HVUlOVDMyX0ZP
Uk1BVAotICAgICAgICAgICAgICAgICAgICAgICAgIiBpbW06JSIgR19HVUlOVDMyX0ZPUk1BVCAi
IGNsYXNzX3JlcToweCUwMnggY2xhc3Nfc3VwOjB4JTAyeCIKKyAgICAgICAgICAgIFNQSUNFX0RF
QlVHKCJnZXRfZXZlbnRfc3RhdHVzX25vdGlmaWNhdGlvbiwgbHVuOiV1IgorICAgICAgICAgICAg
ICAgICAgICAgICAgIiBpbW06JXUgY2xhc3NfcmVxOjB4JTAyeCBjbGFzc19zdXA6MHglMDJ4Igog
ICAgICAgICAgICAgICAgICAgICAgICAgIiBtZWRpYV9ldmVudDoweCUwMnggbG9hZGVkOiAlZCIs
CiAgICAgICAgICAgICAgICAgICAgICAgICByZXEtPmx1biwgaW1tZWQsIGNsYXNzZXNfcmVxdWVz
dGVkLCBjbGFzc2VzX3N1cHBvcnRlZCwKICAgICAgICAgICAgICAgICAgICAgICAgIGRldi0+bWVk
aWFfZXZlbnQsIGRldi0+bG9hZGVkKTsKQEAgLTIwMjksMTAgKzIwMjAsMTAgQEAgc3RhdGljIHZv
aWQgY2Rfc2NzaV9jbWRfZ2V0X2V2ZW50X3N0YXR1c19ub3RpZmljYXRpb24oQ2RTY3NpTFUgKmRl
diwgQ2RTY3NpUmVxdWUKICAgICB9IGVsc2UgewogICAgICAgICBvdXRidWZbMl0gPSBDRF9HRVRf
RVZFTlRfSEVBREVSX05PX0VWRU5UX0FWQUlMIHwgQ0RfR0VUX0VWRU5UX0NMQVNTX05PTkU7CiAK
LSAgICAgICAgU1BJQ0VfREVCVUcoImdldF9ldmVudF9zdGF0dXNfbm90aWZpY2F0aW9uLCBsdW46
JSIgR19HVUlOVDMyX0ZPUk1BVAotICAgICAgICAgICAgICAgICAgICAgICAgIiBpbW06JSIgR19H
VUlOVDMyX0ZPUk1BVCAiIGNsYXNzX3JlcToweCUwMnggY2xhc3Nfc3VwOjB4JTAyeCIKLSAgICAg
ICAgICAgICAgICAgICAgICAgICIgbm9uZSBvZiByZXF1ZXN0ZWQgZXZlbnRzIHN1cHBvcnRlZCIs
Ci0gICAgICAgICAgICAgICAgICAgICAgICByZXEtPmx1biwgaW1tZWQsIGNsYXNzZXNfcmVxdWVz
dGVkLCBjbGFzc2VzX3N1cHBvcnRlZCk7CisgICAgICAgIFNQSUNFX0RFQlVHKCJnZXRfZXZlbnRf
c3RhdHVzX25vdGlmaWNhdGlvbiwgbHVuOiV1IgorICAgICAgICAgICAgICAgICAgICAiIGltbTol
dSBjbGFzc19yZXE6MHglMDJ4IGNsYXNzX3N1cDoweCUwMngiCisgICAgICAgICAgICAgICAgICAg
ICIgbm9uZSBvZiByZXF1ZXN0ZWQgZXZlbnRzIHN1cHBvcnRlZCIsCisgICAgICAgICAgICAgICAg
ICAgIHJlcS0+bHVuLCBpbW1lZCwgY2xhc3Nlc19yZXF1ZXN0ZWQsIGNsYXNzZXNfc3VwcG9ydGVk
KTsKICAgICB9CiAgICAgb3V0YnVmWzFdID0gKHVpbnQ4X3QpKHJlc3BfbGVuIC0gMik7IC8qIEV2
ZW50IERhdGEgTGVuZ3RoIExTQiwgbGVuZ3RoIGV4Y2x1ZGluZyB0aGUKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICogZmllbGQgaXRzZWxmICovCkBAIC0yMDcyLDgg
KzIwNjMsNyBAQCBzdGF0aWMgdm9pZCBjZF9zY3NpX2NtZF9zZW5kX2V2ZW50KENkU2NzaUxVICpk
ZXYsIENkU2NzaVJlcXVlc3QgKnJlcSkKICAgICBwYXJhbV9saXN0X2xlbiA9IChyZXEtPmNkYls4
XSA8PCA4KSB8IHJlcS0+Y2RiWzldOwogCiAgICAgaWYgKHJlcS0+YnVmX2xlbiA8IHBhcmFtX2xp
c3RfbGVuKSB7Ci0gICAgICAgIFNQSUNFX0RFQlVHKCJzZW5kX2V2ZW50LCBsdW46JSIgR19HVUlO
VDMyX0ZPUk1BVAotICAgICAgICAgICAgICAgICAgICAiIGludmFsaWQgcGFyYW0gbGlzdCBsZW46
MHgleCwgYnVmX2xlbjoweCV4IiwKKyAgICAgICAgU1BJQ0VfREVCVUcoInNlbmRfZXZlbnQsIGx1
bjoldSBpbnZhbGlkIHBhcmFtIGxpc3QgbGVuOjB4JXgsIGJ1Zl9sZW46MHgleCIsCiAgICAgICAg
ICAgICAgICAgICAgIHJlcS0+bHVuLCBwYXJhbV9saXN0X2xlbiwgcmVxLT5idWZfbGVuKTsKICAg
ICAgICAgY2Rfc2NzaV9jbWRfY29tcGxldGVfY2hlY2tfY29uZChkZXYsIHJlcSwgJnNlbnNlX2Nv
ZGVfSU5WQUxJRF9QQVJBTV9MRU4pOwogICAgICAgICByZXR1cm47CkBAIC0yMDgzLDggKzIwNzMs
NyBAQCBzdGF0aWMgdm9pZCBjZF9zY3NpX2NtZF9zZW5kX2V2ZW50KENkU2NzaUxVICpkZXYsIENk
U2NzaVJlcXVlc3QgKnJlcSkKIAogICAgIG5vdGlmaWNhdGlvbl9jbGFzcyA9IHBhcmFtWzJdICYg
MHgwNzsKICAgICBpZiAobm90aWZpY2F0aW9uX2NsYXNzICE9IENEX0dFVF9FVkVOVF9DTEFTU19F
WFRFUk5BTF9SRVEpIHsKLSAgICAgICAgU1BJQ0VfREVCVUcoInNlbmRfZXZlbnQsIGx1bjolIiBH
X0dVSU5UMzJfRk9STUFUCi0gICAgICAgICAgICAgICAgICAgICIgaW52YWxpZCBub3RpZmljYXRp
b24gY2xhc3M6MHgleCIsCisgICAgICAgIFNQSUNFX0RFQlVHKCJzZW5kX2V2ZW50LCBsdW46JXUg
aW52YWxpZCBub3RpZmljYXRpb24gY2xhc3M6MHgleCIsCiAgICAgICAgICAgICAgICAgICAgIHJl
cS0+bHVuLCBub3RpZmljYXRpb25fY2xhc3MpOwogICAgICAgICBjZF9zY3NpX2NtZF9jb21wbGV0
ZV9jaGVja19jb25kKGRldiwgcmVxLCAmc2Vuc2VfY29kZV9JTlZBTElEX0NEQl9GSUVMRCk7CiAg
ICAgICAgIHJldHVybjsKQEAgLTIwOTYsOCArMjA4NSw3IEBAIHN0YXRpYyB2b2lkIGNkX3Njc2lf
Y21kX3NlbmRfZXZlbnQoQ2RTY3NpTFUgKmRldiwgQ2RTY3NpUmVxdWVzdCAqcmVxKQogICAgIHBl
cnNfcHJldmVudCA9IGV2ZW50WzFdICYgMHg4MDsKICAgICBleHRfcmVxX2NvZGUgPSAoZXZlbnRb
Ml0gPDwgOCkgfCBldmVudFszXTsKIAotICAgIFNQSUNFX0RFQlVHKCJzZW5kX2V2ZW50LCBsdW46
MHglIiBHX0dVSU5UMzJfRk9STUFUCi0gICAgICAgICAgICAgICAgIiBpbW1lZDolIiBHX0dVSU5U
MzJfRk9STUFUICIgcGFyYW1fbGVuOiUiIEdfR1VJTlQzMl9GT1JNQVQKKyAgICBTUElDRV9ERUJV
Rygic2VuZF9ldmVudCwgbHVuOjB4JXUgaW1tZWQ6JXUgcGFyYW1fbGVuOiV1IgogICAgICAgICAg
ICAgICAgICIgZXh0X3JlcV9ldmVudDoweCV4IGV4dF9yZXFfc3RhdHVzOjB4JXgiCiAgICAgICAg
ICAgICAgICAgIiBwZXJzX3ByZXZlbnQ6MHgleCBleHRfcmVxX2NvZGU6MHgleCIsCiAgICAgICAg
ICAgICAgICAgcmVxLT5sdW4sIGltbWVkLCBldmVudF9wYXJhbV9sZW4sIGV4dF9yZXFfZXZlbnQs
CkBAIC0yMTI0LDcgKzIxMTIsNyBAQCBzdGF0aWMgdm9pZCBjZF9zY3NpX2NtZF9hbGxvd19tZWRp
dW1fcmVtb3ZhbChDZFNjc2lMVSAqZGV2LCBDZFNjc2lSZXF1ZXN0ICpyZXEpCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgcHJldmVudCA9PSBDRF9NRURJVU1fUkVNT1ZBTF9SRVFf
UFJFVkVOVF9DSEFOR0VSKTsKICAgICByZXEtPmluX2xlbiA9IDA7CiAKLSAgICBTUElDRV9ERUJV
RygiYWxsb3dfbWVkaXVtX3JlbW92YWwsIGx1bjolIiBHX0dVSU5UMzJfRk9STUFUICIgcHJldmVu
dCBmaWVsZDo6MHglMDJ4IGZsYWc6JWQiLAorICAgIFNQSUNFX0RFQlVHKCJhbGxvd19tZWRpdW1f
cmVtb3ZhbCwgbHVuOiV1IHByZXZlbnQgZmllbGQ6OjB4JTAyeCBmbGFnOiVkIiwKICAgICAgICAg
ICAgICAgICByZXEtPmx1biwgcHJldmVudCwgZGV2LT5wcmV2ZW50X21lZGlhX3JlbW92YWwpOwog
CiAgICAgY2Rfc2NzaV9jbWRfY29tcGxldGVfZ29vZChkZXYsIHJlcSk7CkBAIC0yMTMyLDE0ICsy
MTIwLDE0IEBAIHN0YXRpYyB2b2lkIGNkX3Njc2lfY21kX2FsbG93X21lZGl1bV9yZW1vdmFsKENk
U2NzaUxVICpkZXYsIENkU2NzaVJlcXVlc3QgKnJlcSkKIAogc3RhdGljIHZvaWQgY2Rfc2NzaV9j
bWRfcmVwb3J0X2tleShDZFNjc2lMVSAqZGV2LCBDZFNjc2lSZXF1ZXN0ICpyZXEpCiB7Ci0gICAg
U1BJQ0VfREVCVUcoInJlcG9ydF9rZXkgLSBjb250ZW50IHByb3RlY3Rpb24gdW5zdXBwb3J0ZWQs
IGx1bjolIiBHX0dVSU5UMzJfRk9STUFULCByZXEtPmx1bik7CisgICAgU1BJQ0VfREVCVUcoInJl
cG9ydF9rZXkgLSBjb250ZW50IHByb3RlY3Rpb24gdW5zdXBwb3J0ZWQsIGx1bjoldSIsIHJlcS0+
bHVuKTsKICAgICByZXEtPnhmZXJfZGlyID0gU0NTSV9YRkVSX05PTkU7CiAgICAgY2Rfc2NzaV9j
bWRfY29tcGxldGVfY2hlY2tfY29uZChkZXYsIHJlcSwgJnNlbnNlX2NvZGVfSU5WQUxJRF9PUENP
REUpOwogfQogCiBzdGF0aWMgdm9pZCBjZF9zY3NpX2NtZF9zZW5kX2tleShDZFNjc2lMVSAqZGV2
LCBDZFNjc2lSZXF1ZXN0ICpyZXEpCiB7Ci0gICAgU1BJQ0VfREVCVUcoInNlbmRfa2V5IC0gY29u
dGVudCBwcm90ZWN0aW9uIHVuc3VwcG9ydGVkLCBsdW46JSIgR19HVUlOVDMyX0ZPUk1BVCwgcmVx
LT5sdW4pOworICAgIFNQSUNFX0RFQlVHKCJzZW5kX2tleSAtIGNvbnRlbnQgcHJvdGVjdGlvbiB1
bnN1cHBvcnRlZCwgbHVuOiV1IiwgcmVxLT5sdW4pOwogICAgIHJlcS0+eGZlcl9kaXIgPSBTQ1NJ
X1hGRVJfTk9ORTsKICAgICBjZF9zY3NpX2NtZF9jb21wbGV0ZV9jaGVja19jb25kKGRldiwgcmVx
LCAmc2Vuc2VfY29kZV9JTlZBTElEX09QQ09ERSk7CiB9CkBAIC0yMTk1LDcgKzIxODMsNyBAQCBz
dGF0aWMgdm9pZCBjZF9zY3NpX2NtZF9zdGFydF9zdG9wX3VuaXQoQ2RTY3NpTFUgKmRldiwgQ2RT
Y3NpUmVxdWVzdCAqcmVxKQogICAgIGxvYWRfZWplY3QgPSAocmVxLT5jZGJbNF0gJiBDRF9TVEFS
VF9TVE9QX0ZMQUdfTE9FSikgPyBUUlVFIDogRkFMU0U7CiAgICAgcG93ZXJfY29uZCA9IHJlcS0+
Y2RiWzRdID4+IDQ7CiAKLSAgICBTUElDRV9ERUJVRygic3RhcnRfc3RvcF91bml0LCBsdW46MHgl
IiBHX0dVSU5UMzJfRk9STUFUCisgICAgU1BJQ0VfREVCVUcoInN0YXJ0X3N0b3BfdW5pdCwgbHVu
OjB4JXUiCiAgICAgICAgICAgICAgICAgIiBpbW1lZDolZCBzdGFydDolZCBsb2FkX2VqZWN0OiVk
IHBvd2VyX2NvbmQ6MHgleCglcykiLAogICAgICAgICAgICAgICAgIHJlcS0+bHVuLCBpbW1lZCwg
c3RhcnQsIGxvYWRfZWplY3QsIHBvd2VyX2NvbmQsCiAgICAgICAgICAgICAgICAgY2Rfc2NzaV9z
dGFydF9zdG9wX3Bvd2VyX2NvbmRfbmFtZShwb3dlcl9jb25kKSk7CkBAIC0yMjA1LDIzICsyMTkz
LDIzIEBAIHN0YXRpYyB2b2lkIGNkX3Njc2lfY21kX3N0YXJ0X3N0b3BfdW5pdChDZFNjc2lMVSAq
ZGV2LCBDZFNjc2lSZXF1ZXN0ICpyZXEpCiAgICAgICAgIGlmICghc3RhcnQpIHsgLyogc3RvcCB0
aGUgdW5pdCAqLwogICAgICAgICAgICAgaWYgKGxvYWRfZWplY3QpIHsgLyogZWplY3QgbWVkaXVt
ICovCiAgICAgICAgICAgICAgICAgaWYgKGRldi0+cHJldmVudF9tZWRpYV9yZW1vdmFsKSB7Ci0g
ICAgICAgICAgICAgICAgICAgIFNQSUNFX0RFQlVHKCJzdGFydF9zdG9wX3VuaXQsIGx1bjoweCUi
IEdfR1VJTlQzMl9GT1JNQVQKKyAgICAgICAgICAgICAgICAgICAgU1BJQ0VfREVCVUcoInN0YXJ0
X3N0b3BfdW5pdCwgbHVuOjB4JXUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIg
cHJldmVudF9tZWRpYV9yZW1vdmFsIHNldCwgZWplY3QgZmFpbGVkIiwgcmVxLT5sdW4pOwogICAg
ICAgICAgICAgICAgICAgICBjZF9zY3NpX2NtZF9jb21wbGV0ZV9jaGVja19jb25kKGRldiwgcmVx
LCAmc2Vuc2VfY29kZV9NRURJVU1fUkVNT1ZBTF9QUkVWRU5URUQpOwogICAgICAgICAgICAgICAg
ICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgfQotICAgICAgICAgICAgICAgIFNQSUNFX0RF
QlVHKCJzdGFydF9zdG9wX3VuaXQsIGx1bjoweCUiIEdfR1VJTlQzMl9GT1JNQVQgIiBlamVjdCIs
IHJlcS0+bHVuKTsKKyAgICAgICAgICAgICAgICBTUElDRV9ERUJVRygic3RhcnRfc3RvcF91bml0
LCBsdW46MHgldSBlamVjdCIsIHJlcS0+bHVuKTsKICAgICAgICAgICAgICAgICBjZF9zY3NpX2x1
X3VubG9hZChkZXYpOwogICAgICAgICAgICAgICAgIGNkX3Njc2lfZGV2X2NoYW5nZWQoZGV2LT50
Z3QtPnVzZXJfZGF0YSwgcmVxLT5sdW4pOwogICAgICAgICAgICAgfQogICAgICAgICAgICAgZGV2
LT5wb3dlcl9jb25kID0gQ0RfU0NTSV9QT1dFUl9TVE9QUEVEOwotICAgICAgICAgICAgU1BJQ0Vf
REVCVUcoInN0YXJ0X3N0b3BfdW5pdCwgbHVuOjB4JSIgR19HVUlOVDMyX0ZPUk1BVCAiIHN0b3Bw
ZWQiLCByZXEtPmx1bik7CisgICAgICAgICAgICBTUElDRV9ERUJVRygic3RhcnRfc3RvcF91bml0
LCBsdW46MHgldSBzdG9wcGVkIiwgcmVxLT5sdW4pOwogICAgICAgICB9IGVsc2UgeyAvKiBzdGFy
dCB0aGUgdW5pdCAqLwogICAgICAgICAgICAgZGV2LT5wb3dlcl9jb25kID0gQ0RfU0NTSV9QT1dF
Ul9BQ1RJVkU7Ci0gICAgICAgICAgICBTUElDRV9ERUJVRygic3RhcnRfc3RvcF91bml0LCBsdW46
MHglIiBHX0dVSU5UMzJfRk9STUFUICIgc3RhcnRlZCIsIHJlcS0+bHVuKTsKKyAgICAgICAgICAg
IFNQSUNFX0RFQlVHKCJzdGFydF9zdG9wX3VuaXQsIGx1bjoweCV1IHN0YXJ0ZWQiLCByZXEtPmx1
bik7CiAKICAgICAgICAgICAgIGlmIChsb2FkX2VqZWN0KSB7IC8qIGxvYWQgbWVkaXVtICovCi0g
ICAgICAgICAgICAgICAgU1BJQ0VfREVCVUcoInN0YXJ0X3N0b3BfdW5pdCwgbHVuOjB4JSIgR19H
VUlOVDMyX0ZPUk1BVCAiIGxvYWQgd2l0aCBubyBtZWRpYSIsCisgICAgICAgICAgICAgICAgU1BJ
Q0VfREVCVUcoInN0YXJ0X3N0b3BfdW5pdCwgbHVuOjB4JXUgbG9hZCB3aXRoIG5vIG1lZGlhIiwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEtPmx1bik7CiAgICAgICAgICAgICAgICAg
Y2Rfc2NzaV9sdV9sb2FkKGRldiwgTlVMTCk7CiAgICAgICAgICAgICAgICAgY2Rfc2NzaV9kZXZf
Y2hhbmdlZChkZXYtPnRndC0+dXNlcl9kYXRhLCByZXEtPmx1bik7CkBAIC0yMjMxLDE3ICsyMjE5
LDE3IEBAIHN0YXRpYyB2b2lkIGNkX3Njc2lfY21kX3N0YXJ0X3N0b3BfdW5pdChDZFNjc2lMVSAq
ZGV2LCBDZFNjc2lSZXF1ZXN0ICpyZXEpCiAgICAgY2FzZSBDRF9TVEFSVF9TVE9QX1BPV0VSX0NP
TkRfQUNUSVZFOgogICAgICAgICAvKiBub3QgZXJyb3IgdG8gc3BlY2lmeSB0cmFuc2l0aW9uIHRv
IHRoZSBjdXJyZW50IHBvd2VyIGNvbmRpdGlvbiAqLwogICAgICAgICBkZXYtPnBvd2VyX2NvbmQg
PSBDRF9TQ1NJX1BPV0VSX0FDVElWRTsKLSAgICAgICAgU1BJQ0VfREVCVUcoInN0YXJ0X3N0b3Bf
dW5pdCwgbHVuOjB4JSIgR19HVUlOVDMyX0ZPUk1BVCAiIGFjdGl2ZSIsIHJlcS0+bHVuKTsKKyAg
ICAgICAgU1BJQ0VfREVCVUcoInN0YXJ0X3N0b3BfdW5pdCwgbHVuOjB4JXUgYWN0aXZlIiwgcmVx
LT5sdW4pOwogICAgICAgICBicmVhazsKICAgICBjYXNlIENEX1NUQVJUX1NUT1BfUE9XRVJfQ09O
RF9JRExFOgogICAgIGNhc2UgQ0RfU1RBUlRfU1RPUF9QT1dFUl9DT05EX0ZPUkNFX0lETEVfMDoK
ICAgICAgICAgZGV2LT5wb3dlcl9jb25kID0gQ0RfU0NTSV9QT1dFUl9JRExFOwotICAgICAgICBT
UElDRV9ERUJVRygic3RhcnRfc3RvcF91bml0LCBsdW46MHglIiBHX0dVSU5UMzJfRk9STUFUICIg
aWRsZSIsIHJlcS0+bHVuKTsKKyAgICAgICAgU1BJQ0VfREVCVUcoInN0YXJ0X3N0b3BfdW5pdCwg
bHVuOjB4JXUgaWRsZSIsIHJlcS0+bHVuKTsKICAgICAgICAgYnJlYWs7CiAgICAgY2FzZSBDRF9T
VEFSVF9TVE9QX1BPV0VSX0NPTkRfU1RBTkRCWToKICAgICBjYXNlIENEX1NUQVJUX1NUT1BfUE9X
RVJfQ09ORF9GT1JDRV9TVEFOREJZXzA6CiAgICAgICAgIGRldi0+cG93ZXJfY29uZCA9IENEX1ND
U0lfUE9XRVJfU1RBTkRCWTsKLSAgICAgICAgU1BJQ0VfREVCVUcoInN0YXJ0X3N0b3BfdW5pdCwg
bHVuOjB4JSIgR19HVUlOVDMyX0ZPUk1BVCAiIHN0YW5kYnkiLCByZXEtPmx1bik7CisgICAgICAg
IFNQSUNFX0RFQlVHKCJzdGFydF9zdG9wX3VuaXQsIGx1bjoweCV1IHN0YW5kYnkiLCByZXEtPmx1
bik7CiAgICAgICAgIGJyZWFrOwogICAgIGNhc2UgQ0RfU1RBUlRfU1RPUF9QT1dFUl9DT05EX0xV
X0NPTlRST0w6CiAgICAgICAgIGJyZWFrOwpAQCAtMjI3OSw3ICsyMjY3LDcgQEAgc3RhdGljIHZv
aWQgY2Rfc2NzaV9nZXRfcGVyZm9ybWFuY2VfcmVzcF9lbXB0eShDZFNjc2lMVSAqZGV2LCBDZFNj
c2lSZXF1ZXN0ICpyZXEKICAgICB9CiAgICAgcmVxLT5pbl9sZW4gPSBDRF9QRVJGX0hFQURFUl9M
RU47CiAKLSAgICBTUElDRV9ERUJVRygiZ2V0X3BlcmZvcm1hbmNlLCBsdW46JSIgR19HVUlOVDMy
X0ZPUk1BVAorICAgIFNQSUNFX0RFQlVHKCJnZXRfcGVyZm9ybWFuY2UsIGx1bjoldSIKICAgICAg
ICAgICAgICAgICAiIHR5cGU6MHgleCBkYXRhX3R5cGU6MHgleCAtIHNlbmRpbmcgZW1wdHkgcmVz
cG9uc2UiLAogICAgICAgICAgICAgICAgIHJlcS0+bHVuLCB0eXBlLCBkYXRhX3R5cGUpOwogCkBA
IC0yMzA2LDE3ICsyMjk0LDE3IEBAIHN0YXRpYyB2b2lkIGNkX3Njc2lfZ2V0X3BlcmZvcm1hbmNl
X3Jlc3BfcGVyZm9ybWFuY2UoQ2RTY3NpTFUgKmRldiwgQ2RTY3NpUmVxdWVzCiAgICAgd3JpdGUg
PSAoZGF0YV90eXBlID4+IDIpICYgMHgwMTsKICAgICB0b2xlcmFuY2UgPSAoZGF0YV90eXBlID4+
IDMpICYgMHgwMzsKIAotICAgIFNQSUNFX0RFQlVHKCJnZXRfcGVyZm9ybWFuY2UsIGx1bjolIiBH
X0dVSU5UMzJfRk9STUFUCisgICAgU1BJQ0VfREVCVUcoImdldF9wZXJmb3JtYW5jZSwgbHVuOiV1
IgogICAgICAgICAgICAgICAgICIgcGVyZm9ybWFuY2UgdHlwZToweDAwIGRhdGFfdHlwZToweCV4
IgogICAgICAgICAgICAgICAgICIgZXhjZXB0OjB4JXggd3JpdGU6MHgleCB0b2xlcmFuY2U6MHgl
eCIKLSAgICAgICAgICAgICAgICAiIG1heF9udW06JSIgR19HVUlOVDMyX0ZPUk1BVCwKKyAgICAg
ICAgICAgICAgICAiIG1heF9udW06JXUiLAogICAgICAgICAgICAgICAgIHJlcS0+bHVuLCBkYXRh
X3R5cGUsIGV4Y2VwdCwgd3JpdGUsCiAgICAgICAgICAgICAgICAgdG9sZXJhbmNlLCBtYXhfbnVt
X2Rlc2NyKTsKIAogICAgIGlmICh3cml0ZSkgewotICAgICAgICBTUElDRV9ERUJVRygiZ2V0X3Bl
cmZvcm1hbmNlLCBsdW46JSIgR19HVUlOVDMyX0ZPUk1BVAotICAgICAgICAgICAgICAgICIgcGVy
Zm9ybWFuY2UgdHlwZToweDAwIGRhdGFfdHlwZToweCV4IC0gd3JpdGUgdW5zdXBwb3J0ZWQiLAot
ICAgICAgICAgICAgICAgIHJlcS0+bHVuLCBkYXRhX3R5cGUpOworICAgICAgICBTUElDRV9ERUJV
RygiZ2V0X3BlcmZvcm1hbmNlLCBsdW46JXUiCisgICAgICAgICAgICAgICAgICAgICIgcGVyZm9y
bWFuY2UgdHlwZToweDAwIGRhdGFfdHlwZToweCV4IC0gd3JpdGUgdW5zdXBwb3J0ZWQiLAorICAg
ICAgICAgICAgICAgICAgICByZXEtPmx1biwgZGF0YV90eXBlKTsKICAgICAgICAgY2Rfc2NzaV9n
ZXRfcGVyZm9ybWFuY2VfcmVzcF9lbXB0eShkZXYsIHJlcSwgQ0RfUEVSRl9UWVBFX1BFUkZPUk1B
TkNFLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFfdHlw
ZSwgbWF4X251bV9kZXNjcik7CiAgICAgICAgIHJldHVybjsKQEAgLTIzODIsOSArMjM3MCw5IEBA
IHN0YXRpYyB2b2lkIGNkX3Njc2lfY21kX2dldF9wZXJmb3JtYW5jZShDZFNjc2lMVSAqZGV2LCBD
ZFNjc2lSZXF1ZXN0ICpyZXEpCiAgICAgY2FzZSBDRF9QRVJGX1RZUEVfREVGRUNUX1NUQVRVUzog
Lyogbm90IHJlc3RyaWN0ZWQgb3ZlcndyaXRlIG1lZGlhICovCiAgICAgY2FzZSBDRF9QRVJGX1RZ
UEVfV1JJVEVfU1BFRUQ6IC8qIHVuc3VwcG9ydGVkLCBpcnJlbGV2YW50ICovCiAgICAgZGVmYXVs
dDoKLSAgICAgICAgU1BJQ0VfREVCVUcoImdldF9wZXJmb3JtYW5jZSwgbHVuOiUiIEdfR1VJTlQz
Ml9GT1JNQVQKKyAgICAgICAgU1BJQ0VfREVCVUcoImdldF9wZXJmb3JtYW5jZSwgbHVuOiV1Igog
ICAgICAgICAgICAgICAgICAgICAiIHVuc3VwcG9ydGVkIHR5cGU6MHgleCIKLSAgICAgICAgICAg
ICAgICAgICAgIiBkYXRhX3R5cGU6MHgleCBtYXhfbnVtOiUiIEdfR1VJTlQzMl9GT1JNQVQsCisg
ICAgICAgICAgICAgICAgICAgICIgZGF0YV90eXBlOjB4JXggbWF4X251bToldSIsCiAgICAgICAg
ICAgICAgICAgICAgIHJlcS0+bHVuLCB0eXBlLCBkYXRhX3R5cGUsIG1heF9udW1fZGVzY3IpOwog
ICAgICAgICBjZF9zY3NpX2NtZF9jb21wbGV0ZV9jaGVja19jb25kKGRldiwgcmVxLCAmc2Vuc2Vf
Y29kZV9JTlZBTElEX0NEQl9GSUVMRCk7CiAgICAgICAgIHJldHVybjsKQEAgLTI0NDIsNyArMjQz
MCw3IEBAIHN0YXRpYyB2b2lkIGNkX3Njc2lfY21kX21lY2hhbmlzbV9zdGF0dXMoQ2RTY3NpTFUg
KmRldiwgQ2RTY3NpUmVxdWVzdCAqcmVxKQogCiAgICAgcmVxLT5pbl9sZW4gPSAocmVxLT5yZXFf
bGVuIDwgcmVzcF9sZW4pID8gcmVxLT5yZXFfbGVuIDogcmVzcF9sZW47CiAKLSAgICBTUElDRV9E
RUJVRygibWVjaGFuaXNtX3N0YXR1cywgbHVuOiUiIEdfR1VJTlQzMl9GT1JNQVQsIHJlcS0+bHVu
KTsKKyAgICBTUElDRV9ERUJVRygibWVjaGFuaXNtX3N0YXR1cywgbHVuOiV1IiwgcmVxLT5sdW4p
OwogCiAgICAgY2Rfc2NzaV9jbWRfY29tcGxldGVfZ29vZChkZXYsIHJlcSk7CiB9CkBAIC0yNDY1
LDcgKzI0NTMsNyBAQCBzdGF0aWMgdm9pZCBjZF9zY3NpX3JlYWRfYXN5bmNfY29tcGxldGUoR09i
amVjdCAqc3JjX29iamVjdCwKIC8vICAgIGdfYXNzZXJ0KHN0cmVhbSA9PSBkZXYtPnN0cmVhbSk7
CiAgICAgaWYgKHN0cmVhbSAhPSBkZXYtPnN0cmVhbSkgewogICAgICAgICB1aW50MzJfdCBvcGNv
ZGUgPSAodWludDMyX3QpcmVxLT5jZGJbMF07Ci0gICAgICAgIFNQSUNFX0RFQlVHKCJyZWFkX2Fz
eW5jX2NvbXBsZXRlIEJBRCBTVFJFQU0sIGx1bjogJSIgR19HVUlOVDMyX0ZPUk1BVAorICAgICAg
ICBTUElDRV9ERUJVRygicmVhZF9hc3luY19jb21wbGV0ZSBCQUQgU1RSRUFNLCBsdW46ICV1Igog
ICAgICAgICAgICAgICAgICAgICAiIHJlcTogJSIgR19HVUlOVDY0X0ZPUk1BVCAiIG9wOiAweCUw
MngiLAogICAgICAgICAgICAgICAgICAgICByZXEtPmx1biwgcmVxLT5yZXFfbGVuLCBvcGNvZGUp
OwogICAgICAgICBjZF9zY3NpX2NtZF9jb21wbGV0ZV9jaGVja19jb25kKGRldiwgcmVxLCAmc2Vu
c2VfY29kZV9UQVJHRVRfRkFJTFVSRSk7CkBAIC0yNDc2LDcgKzI0NjQsNyBAQCBzdGF0aWMgdm9p
ZCBjZF9zY3NpX3JlYWRfYXN5bmNfY29tcGxldGUoR09iamVjdCAqc3JjX29iamVjdCwKICAgICBi
eXRlc19yZWFkID0gZ19pbnB1dF9zdHJlYW1fcmVhZF9maW5pc2goR19JTlBVVF9TVFJFQU0oc3Ry
ZWFtKSwgcmVzdWx0LCAmZXJyb3IpOwogICAgIGZpbmlzaGVkID0gYnl0ZXNfcmVhZCA+IDA7CiAg
ICAgaWYgKGZpbmlzaGVkKSB7Ci0gICAgICAgIFNQSUNFX0RFQlVHKCJyZWFkX2FzeW5jX2NvbXBs
ZXRlLCBsdW46ICUiIEdfR1VJTlQzMl9GT1JNQVQKKyAgICAgICAgU1BJQ0VfREVCVUcoInJlYWRf
YXN5bmNfY29tcGxldGUsIGx1bjogJXUiCiAgICAgICAgICAgICAgICAgICAgICIgZmluaXNoZWQ6
ICVkIGJ5dGVzX3JlYWQ6ICUiIEdfR1VJTlQ2NF9GT1JNQVQKICAgICAgICAgICAgICAgICAgICAg
IiByZXE6ICUiICBHX0dVSU5UNjRfRk9STUFULAogICAgICAgICAgICAgICAgICAgICByZXEtPmx1
biwgZmluaXNoZWQsICh1aW50NjRfdClieXRlc19yZWFkLCByZXEtPnJlcV9sZW4pOwpAQCAtMjUx
OCw3ICsyNTA2LDcgQEAgc3RhdGljIGludCBjZF9zY3NpX3JlYWRfYXN5bmNfc3RhcnQoQ2RTY3Np
TFUgKmRldiwgQ2RTY3NpUmVxdWVzdCAqcmVxKQogICAgIENkU2NzaVRhcmdldCAqc3QgPSBkZXYt
PnRndDsKICAgICBHRmlsZUlucHV0U3RyZWFtICpzdHJlYW0gPSBkZXYtPnN0cmVhbTsKIAotICAg
IFNQSUNFX0RFQlVHKCJyZWFkX2FzeW5jX3N0YXJ0LCBsdW46JSIgR19HVUlOVDMyX0ZPUk1BVAor
ICAgIFNQSUNFX0RFQlVHKCJyZWFkX2FzeW5jX3N0YXJ0LCBsdW46JXUiCiAgICAgICAgICAgICAg
ICAgIiBsYmE6ICUiIEdfR1VJTlQ2NF9GT1JNQVQgIiBvZmZzZXQ6ICUiIEdfR1VJTlQ2NF9GT1JN
QVQKICAgICAgICAgICAgICAgICAiIGNudDogJSIgR19HVUlOVDY0X0ZPUk1BVCAiIGxlbjogJSIg
R19HVUlOVDY0X0ZPUk1BVCwKICAgICAgICAgICAgICAgICByZXEtPmx1biwgcmVxLT5sYmEsIHJl
cS0+b2Zmc2V0LCByZXEtPmNvdW50LCByZXEtPnJlcV9sZW4pOwpAQCAtMjU1MSwxMSArMjUzOSwx
MSBAQCBzdGF0aWMgaW50IGNkX3Njc2lfcmVhZF9hc3luY19zdGFydChDZFNjc2lMVSAqZGV2LCBD
ZFNjc2lSZXF1ZXN0ICpyZXEpCiBzdGF0aWMgdm9pZCBjZF9zY3NpX2NtZF9yZWFkKENkU2NzaUxV
ICpkZXYsIENkU2NzaVJlcXVlc3QgKnJlcSkKIHsKICAgICBpZiAoZGV2LT5wb3dlcl9jb25kID09
IENEX1NDU0lfUE9XRVJfU1RPUFBFRCkgewotICAgICAgICBTUElDRV9ERUJVRygicmVhZCwgbHVu
OiAlIiBHX0dVSU5UMzJfRk9STUFUICIgaXMgc3RvcHBlZCIsIHJlcS0+bHVuKTsKKyAgICAgICAg
U1BJQ0VfREVCVUcoInJlYWQsIGx1bjogJXUgaXMgc3RvcHBlZCIsIHJlcS0+bHVuKTsKICAgICAg
ICAgY2Rfc2NzaV9jbWRfY29tcGxldGVfY2hlY2tfY29uZChkZXYsIHJlcSwgJnNlbnNlX2NvZGVf
SU5JVF9DTURfUkVRVUlSRUQpOwogICAgICAgICByZXR1cm47CiAgICAgfSBlbHNlIGlmICghZGV2
LT5sb2FkZWQgfHwgZGV2LT5zdHJlYW0gPT0gTlVMTCkgewotICAgICAgICBTUElDRV9ERUJVRygi
cmVhZCwgbHVuOiAlIiBHX0dVSU5UMzJfRk9STUFUICIgaXMgbm90IGxvYWRlZCIsIHJlcS0+bHVu
KTsKKyAgICAgICAgU1BJQ0VfREVCVUcoInJlYWQsIGx1bjogJXUgaXMgbm90IGxvYWRlZCIsIHJl
cS0+bHVuKTsKICAgICAgICAgY2Rfc2NzaV9jbWRfY29tcGxldGVfY2hlY2tfY29uZChkZXYsIHJl
cSwgJnNlbnNlX2NvZGVfTk9UX1JFQURZX05PX01FRElVTSk7CiAgICAgICAgIHJldHVybjsKICAg
ICB9CkBAIC0yNTc4LDcgKzI1NjYsNyBAQCB2b2lkIGNkX3Njc2lfZGV2X3JlcXVlc3Rfc3VibWl0
KENkU2NzaVRhcmdldCAqc3QsIENkU2NzaVJlcXVlc3QgKnJlcSkKICAgICBjb25zdCBjaGFyICpj
bWRfbmFtZSA9IHNjc2lfY21kX25hbWVbb3Bjb2RlXTsKICAgICBDZFNjc2lMVSAqZGV2ID0gJnN0
LT51bml0c1tsdW5dOwogCi0gICAgU1BJQ0VfREVCVUcoInJlcXVlc3Rfc3VibWl0LCBsdW46ICUi
IEdfR1VJTlQzMl9GT1JNQVQgIiBvcDogMHglMDJ4ICVzIiwgbHVuLCBvcGNvZGUsIGNtZF9uYW1l
KTsKKyAgICBTUElDRV9ERUJVRygicmVxdWVzdF9zdWJtaXQsIGx1bjogJXUgb3A6IDB4JTAyeCAl
cyIsIGx1biwgb3Bjb2RlLCBjbWRfbmFtZSk7CiAKICAgICBpZiAoc3QtPmN1cl9yZXEgIT0gTlVM
TCkgewogICAgICAgICBTUElDRV9FUlJPUigicmVxdWVzdF9zdWJtaXQsIHJlcXVlc3Qgbm90IGlk
bGUiKTsKQEAgLTI1OTUsNyArMjU4Myw3IEBAIHZvaWQgY2Rfc2NzaV9kZXZfcmVxdWVzdF9zdWJt
aXQoQ2RTY3NpVGFyZ2V0ICpzdCwgQ2RTY3NpUmVxdWVzdCAqcmVxKQogCiAgICAgLyogSU5RVUlS
WSBzaG91bGQgc2VuZCByZXNwb25zZSBldmVuIGZvciBub24tZXhpc3RpbmcgTFVOcyAqLwogICAg
IGlmICghY2Rfc2NzaV90YXJnZXRfbHVuX2xlZ2FsKHN0LCBsdW4pKSB7Ci0gICAgICAgIFNQSUNF
X0VSUk9SKCJyZXF1ZXN0X3N1Ym1pdCwgaWxsZWdhbCBsdW46JSIgR19HVUlOVDMyX0ZPUk1BVCwg
bHVuKTsKKyAgICAgICAgU1BJQ0VfRVJST1IoInJlcXVlc3Rfc3VibWl0LCBpbGxlZ2FsIGx1bjol
dSIsIGx1bik7CiAgICAgICAgIGlmIChvcGNvZGUgPT0gSU5RVUlSWSkgewogICAgICAgICAgICAg
aWYgKHJlcS0+Y2RiWzFdICYgMHgxKSB7CiAgICAgICAgICAgICAgICAgY2Rfc2NzaV9jbWRfaW5x
dWlyeV92cGRfbm9fbHVuKGRldiwgcmVxLCBQRVJJRl9RVUFMSUZJRVJfVU5TVVBQT1JURUQpOwpA
QCAtMjYwOCw3ICsyNTk2LDcgQEAgdm9pZCBjZF9zY3NpX2Rldl9yZXF1ZXN0X3N1Ym1pdChDZFNj
c2lUYXJnZXQgKnN0LCBDZFNjc2lSZXF1ZXN0ICpyZXEpCiAgICAgICAgIGdvdG8gZG9uZTsKICAg
ICB9CiAgICAgaWYgKCFjZF9zY3NpX3RhcmdldF9sdW5fcmVhbGl6ZWQoc3QsIGx1bikpIHsKLSAg
ICAgICAgU1BJQ0VfRVJST1IoInJlcXVlc3Rfc3VibWl0LCBhYnNlbnQgbHVuOiUiIEdfR1VJTlQz
Ml9GT1JNQVQsIGx1bik7CisgICAgICAgIFNQSUNFX0VSUk9SKCJyZXF1ZXN0X3N1Ym1pdCwgYWJz
ZW50IGx1bjoldSIsIGx1bik7CiAgICAgICAgIGlmIChvcGNvZGUgPT0gSU5RVUlSWSkgewogICAg
ICAgICAgICAgaWYgKHJlcS0+Y2RiWzFdICYgMHgxKSB7CiAgICAgICAgICAgICAgICAgY2Rfc2Nz
aV9jbWRfaW5xdWlyeV92cGRfbm9fbHVuKGRldiwgcmVxLCBQRVJJRl9RVUFMSUZJRVJfTk9UX0NP
Tk5FQ1RFRCk7CkBAIC0yNzE5LDggKzI3MDcsOCBAQCB2b2lkIGNkX3Njc2lfZGV2X3JlcXVlc3Rf
c3VibWl0KENkU2NzaVRhcmdldCAqc3QsIENkU2NzaVJlcXVlc3QgKnJlcSkKICAgICB9CiAKIGRv
bmU6Ci0gICAgU1BJQ0VfREVCVUcoInJlcXVlc3Rfc3VibWl0IGRvbmUsIGx1bjogJSIgR19HVUlO
VDMyX0ZPUk1BVAotICAgICAgICAgICAgICAgICIgb3A6IDB4JTAyeCAlcywgc3RhdGU6ICVzIHN0
YXR1czogJSIgR19HVUlOVDMyX0ZPUk1BVCAiIGxlbjogJSIgR19HVUlOVDY0X0ZPUk1BVCwKKyAg
ICBTUElDRV9ERUJVRygicmVxdWVzdF9zdWJtaXQgZG9uZSwgbHVuOiAldSIKKyAgICAgICAgICAg
ICAgICAiIG9wOiAweCUwMnggJXMsIHN0YXRlOiAlcyBzdGF0dXM6ICV1IGxlbjogJSIgR19HVUlO
VDY0X0ZPUk1BVCwKICAgICAgICAgICAgICAgICBsdW4sIG9wY29kZSwgY21kX25hbWUsIENkU2Nz
aVJlcVN0YXRlX3N0cihyZXEtPnJlcV9zdGF0ZSksIHJlcS0+c3RhdHVzLAogICAgICAgICAgICAg
ICAgIHJlcS0+aW5fbGVuKTsKIApAQCAtMjczMyw3ICsyNzIxLDcgQEAgdm9pZCBjZF9zY3NpX2Rl
dl9yZXF1ZXN0X2NhbmNlbChDZFNjc2lUYXJnZXQgKnN0LCBDZFNjc2lSZXF1ZXN0ICpyZXEpCiB7
CiAgICAgaWYgKHN0LT5jdXJfcmVxID09IHJlcSkgewogICAgICAgICBpZiAocmVxLT5yZXFfc3Rh
dGUgPT0gU0NTSV9SRVFfUlVOTklORykgewotICAgICAgICAgICAgU1BJQ0VfREVCVUcoInJlcXVl
c3RfY2FuY2VsOiBsdW46ICUiIEdfR1VJTlQzMl9GT1JNQVQKKyAgICAgICAgICAgIFNQSUNFX0RF
QlVHKCJyZXF1ZXN0X2NhbmNlbDogbHVuOiAldSIKICAgICAgICAgICAgICAgICAgICAgICAgICAi
IG9wOiAweCUwMnggbGVuOiAlIiBHX0dVSU5UNjRfRk9STUFULAogICAgICAgICAgICAgICAgICAg
ICAgICAgcmVxLT5sdW4sICh1bnNpZ25lZCBpbnQpcmVxLT5jZGJbMF0sIHJlcS0+cmVxX2xlbik7
CiAgICAgICAgICAgICBnX2NhbmNlbGxhYmxlX2NhbmNlbChzdC0+Y2FuY2VsbGFibGUpOwotLSAK
Mi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpT
cGljZS1kZXZlbCBtYWlsaW5nIGxpc3QKU3BpY2UtZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vc3BpY2UtZGV2
ZWw=
