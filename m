Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2847F9E3FC
	for <lists+spice-devel@lfdr.de>; Tue, 27 Aug 2019 11:23:37 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 90695898CC;
	Tue, 27 Aug 2019 09:23:35 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 89B10898C2
 for <spice-devel@lists.freedesktop.org>; Tue, 27 Aug 2019 09:23:33 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx04.intmail.prod.int.phx2.redhat.com
 [10.5.11.14])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 33EBA46;
 Tue, 27 Aug 2019 09:23:33 +0000 (UTC)
Received: from fziglio.remote.csb (ovpn-204-114.brq.redhat.com [10.40.204.114])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 5DF955D9CC;
 Tue, 27 Aug 2019 09:23:30 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Tue, 27 Aug 2019 10:22:30 +0100
Message-Id: <20190827092246.10276-14-fziglio@redhat.com>
In-Reply-To: <20190827092246.10276-1-fziglio@redhat.com>
References: <20190827092246.10276-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.14
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.6.2
 (mx1.redhat.com [10.5.110.71]); Tue, 27 Aug 2019 09:23:33 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-gtk v4 13/29] usb-redir: add
 implementation of emulated CD device
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogWXVyaSBCZW5kaXRvdmljaCA8eXVyaS5iZW5kaXRvdmljaEBkYXluaXguY29tPgoKVGhp
cyBtb2R1bGUgY29udGFpbnMgaW1wbGVtZW50YXRpb24gb2YgZW11bGF0ZWQgZGV2aWNlCmludGVy
ZmFjZSBmb3Igc2hhcmVkIENELgoKU2lnbmVkLW9mZi1ieTogWXVyaSBCZW5kaXRvdmljaCA8eXVy
aS5iZW5kaXRvdmljaEBkYXluaXguY29tPgotLS0KIHNyYy91c2ItZGV2aWNlLWNkLmMgfCA3ODMg
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIHNyYy91c2ItZGV2
aWNlLWNkLmggfCAgMzQgKysKIDIgZmlsZXMgY2hhbmdlZCwgODE3IGluc2VydGlvbnMoKykKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCBzcmMvdXNiLWRldmljZS1jZC5jCiBjcmVhdGUgbW9kZSAxMDA2NDQg
c3JjL3VzYi1kZXZpY2UtY2QuaAoKZGlmZiAtLWdpdCBhL3NyYy91c2ItZGV2aWNlLWNkLmMgYi9z
cmMvdXNiLWRldmljZS1jZC5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwLi5j
MzNiYjI5MAotLS0gL2Rldi9udWxsCisrKyBiL3NyYy91c2ItZGV2aWNlLWNkLmMKQEAgLTAsMCAr
MSw3ODMgQEAKKy8qIC0qLSBNb2RlOiBDOyBjLWJhc2ljLW9mZnNldDogNDsgaW5kZW50LXRhYnMt
bW9kZTogbmlsIC0qLSAqLworLyoKKyAgICBDb3B5cmlnaHQgKEMpIDIwMTkgUmVkIEhhdCwgSW5j
LgorCisgICAgUmVkIEhhdCBBdXRob3JzOgorICAgIFl1cmkgQmVuZGl0b3ZpY2g8eWJlbmRpdG9A
cmVkaGF0LmNvbT4KKworICAgIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2Fu
IHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IKKyAgICBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9m
IHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCisgICAgTGljZW5zZSBhcyBwdWJsaXNoZWQg
YnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyCisgICAgdmVyc2lvbiAyLjEg
b2YgdGhlIExpY2Vuc2UsIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCisK
KyAgICBUaGlzIGxpYnJhcnkgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxs
IGJlIHVzZWZ1bCwKKyAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0
aGUgaW1wbGllZCB3YXJyYW50eSBvZgorICAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZP
UiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUgR05VCisgICAgTGVzc2VyIEdlbmVyYWwg
UHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKworICAgIFlvdSBzaG91bGQgaGF2ZSBy
ZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKKyAgICBMaWNl
bnNlIGFsb25nIHdpdGggdGhpcyBsaWJyYXJ5OyBpZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUu
b3JnL2xpY2Vuc2VzLz4uCisqLworCisjaW5jbHVkZSAiY29uZmlnLmgiCisKKyNpZmRlZiBVU0Vf
VVNCUkVESVIKKworI2luY2x1ZGUgPGdsaWItb2JqZWN0Lmg+CisjaW5jbHVkZSA8aW50dHlwZXMu
aD4KKyNpbmNsdWRlIDxnaW8vZ2lvLmg+CisjaW5jbHVkZSA8Z2xpYi9naTE4bi1saWIuaD4KKyNp
bmNsdWRlIDxlcnJuby5oPgorI2luY2x1ZGUgPGxpYnVzYi5oPgorI2luY2x1ZGUgPGZjbnRsLmg+
CisKKyNpZmRlZiBHX09TX1dJTjMyCisjaW5jbHVkZSA8d2luZG93cy5oPgorI2luY2x1ZGUgPG50
ZGRjZHJtLmg+CisjaW5jbHVkZSA8bnRkZG1tYy5oPgorI2Vsc2UKKyNpbmNsdWRlIDxzeXMvc3Rh
dC5oPgorI2luY2x1ZGUgPHN5cy9pb2N0bC5oPgorI2luY2x1ZGUgPGxpbnV4L2ZzLmg+CisjaW5j
bHVkZSA8bGludXgvY2Ryb20uaD4KKyNlbmRpZgorCisjaW5jbHVkZSAidXNiLWVtdWxhdGlvbi5o
IgorI2luY2x1ZGUgInVzYi1kZXZpY2UtY2QuaCIKKyNpbmNsdWRlICJjZC11c2ItYnVsay1tc2Qu
aCIKKwordHlwZWRlZiBzdHJ1Y3QgU3BpY2VDZExVIHsKKyAgICBjaGFyICpmaWxlbmFtZTsKKyAg
ICBHRmlsZUlucHV0U3RyZWFtICpzdHJlYW07CisgICAgdWludDY0X3Qgc2l6ZTsKKyAgICB1aW50
MzJfdCBibG9ja1NpemU7CisgICAgdWludDMyX3QgbG9hZGVkIDogMTsKKyAgICB1aW50MzJfdCBk
ZXZpY2UgOiAxOworfSBTcGljZUNkTFU7CisKKyNkZWZpbmUgTUFYX0xVTl9QRVJfREVWSUNFICAg
ICAgICAgICAgICAxCisjZGVmaW5lIFVTQjJfQkNEICAgICAgICAgICAgICAgICAgICAgICAgMHgy
MDAKKyNkZWZpbmUgQ0RfREVWX1ZJRCAgICAgICAgICAgICAgICAgICAgICAweDJiMjMKKyNkZWZp
bmUgQ0RfREVWX1BJRCAgICAgICAgICAgICAgICAgICAgICAweENEQ0QKKyNkZWZpbmUgQ0RfREVW
X0NMQVNTICAgICAgICAgICAgICAgICAgICA4CisjZGVmaW5lIENEX0RFVl9TVUJDTEFTUyAgICAg
ICAgICAgICAgICAgNgorI2RlZmluZSBDRF9ERVZfUFJPVE9DT0wgICAgICAgICAgICAgICAgIDB4
NTAKKyNkZWZpbmUgQ0RfREVWX0JMT0NLX1NJWkUgICAgICAgICAgICAgICAweDIwMAorI2RlZmlu
ZSBEVkRfREVWX0JMT0NLX1NJWkUgICAgICAgICAgICAgIDB4ODAwCisjZGVmaW5lIE1BWF9CVUxL
X0lOX1JFUVVFU1RTICAgICAgICAgICAgNjQKKworc3RydWN0IEJ1ZmZlcmVkQnVsa1JlYWQgewor
ICAgIHN0cnVjdCB1c2JfcmVkaXJfYnVsa19wYWNrZXRfaGVhZGVyIGhvdXQ7CisgICAgdWludDY0
X3QgaWQ7Cit9OworCitzdHJ1Y3QgU3BpY2VVc2JFbXVsYXRlZERldmljZSB7CisgICAgVXNiRGV2
aWNlT3BzIGRldl9vcHM7CisgICAgU3BpY2VVc2JCYWNrZW5kICpiYWNrZW5kOworICAgIFNwaWNl
VXNiQmFja2VuZERldmljZSAqcGFyZW50OworICAgIHN0cnVjdCB1c2JyZWRpcnBhcnNlciAqcGFy
c2VyOworICAgIFVzYkNkQnVsa01zZERldmljZSogbXNjOworICAgIFNwaWNlQ2RMVSB1bml0c1tN
QVhfTFVOX1BFUl9ERVZJQ0VdOworICAgIGdib29sZWFuIGxvY2tlZDsKKyAgICBnYm9vbGVhbiBk
ZWxldGVfb25fZWplY3Q7CisgICAgZ2Jvb2xlYW4gZGVsZXRpbmc7CisgICAgdWludDMyX3QgbnVt
X3JlYWRzOworICAgIHN0cnVjdCBCdWZmZXJlZEJ1bGtSZWFkIHJlYWRfYnVsa1tNQVhfQlVMS19J
Tl9SRVFVRVNUU107CisgICAgLyogYWNjb3JkaW5nIHRvIFVTQiBNU0Mgc3BlYyAqLworICAgIHVp
bnQxNl90IHNlcmlhbFsxMl07CisgICAgdWludDhfdCAgbWF4X2x1bl9pbmRleDsKK307CisKK3R5
cGVkZWYgc3RydWN0IFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgVXNiQ2Q7CisKKyNpZm5kZWYgR19P
U19XSU4zMgorCitzdGF0aWMgaW50IGNkX2RldmljZV9vcGVuX3N0cmVhbShTcGljZUNkTFUgKnVu
aXQsIGNvbnN0IGNoYXIgKmZpbGVuYW1lKQoreworICAgIHVuaXQtPmRldmljZSA9IDA7CisKKyAg
ICBpZiAoIXVuaXQtPmZpbGVuYW1lICYmICFmaWxlbmFtZSkgeworICAgICAgICBTUElDRV9ERUJV
RygiJXM6IGZpbGUgbmFtZSBub3QgcHJvdmlkZWQiLCBfX0ZVTkNUSU9OX18pOworICAgICAgICBy
ZXR1cm4gLTE7CisgICAgfQorICAgIGlmICh1bml0LT5maWxlbmFtZSAmJiBmaWxlbmFtZSkgewor
ICAgICAgICBnX2ZyZWUodW5pdC0+ZmlsZW5hbWUpOworICAgICAgICB1bml0LT5maWxlbmFtZSA9
IE5VTEw7CisgICAgfQorICAgIGlmIChmaWxlbmFtZSkgeworICAgICAgICB1bml0LT5maWxlbmFt
ZSA9IGdfc3RyZHVwKGZpbGVuYW1lKTsKKyAgICB9CisKKyAgICBpbnQgZmQgPSBvcGVuKHVuaXQt
PmZpbGVuYW1lLCBPX1JET05MWSB8IE9fTk9OQkxPQ0spOworICAgIGlmIChmZCA8IDApIHsKKyAg
ICAgICAgU1BJQ0VfREVCVUcoIiVzOiBjYW4ndCBvcGVuIGZpbGUgJXMiLCBfX0ZVTkNUSU9OX18s
IHVuaXQtPmZpbGVuYW1lKTsKKyAgICAgICAgcmV0dXJuIC0xOworICAgIH0KKworICAgIHN0cnVj
dCBzdGF0IGZpbGVfc3RhdCA9IHsgMCB9OworICAgIGlmIChmc3RhdChmZCwgJmZpbGVfc3RhdCkg
fHwgZmlsZV9zdGF0LnN0X3NpemUgPT0gMCkgeworICAgICAgICBmaWxlX3N0YXQuc3Rfc2l6ZSA9
IDA7CisgICAgICAgIHVuaXQtPmRldmljZSA9IDE7CisgICAgICAgIGlmICghaW9jdGwoZmQsIEJM
S0dFVFNJWkU2NCwgJmZpbGVfc3RhdC5zdF9zaXplKSAmJgorICAgICAgICAgICAgIWlvY3RsKGZk
LCBCTEtTU1pHRVQsICZ1bml0LT5ibG9ja1NpemUpKSB7CisgICAgICAgIH0KKyAgICB9CisgICAg
dW5pdC0+c2l6ZSA9IGZpbGVfc3RhdC5zdF9zaXplOworICAgIGNsb3NlKGZkKTsKKyAgICBpZiAo
dW5pdC0+c2l6ZSkgeworICAgICAgICBHRmlsZSAqZmlsZV9vYmplY3QgPSBnX2ZpbGVfbmV3X2Zv
cl9wYXRoKHVuaXQtPmZpbGVuYW1lKTsKKyAgICAgICAgdW5pdC0+c3RyZWFtID0gZ19maWxlX3Jl
YWQoZmlsZV9vYmplY3QsIE5VTEwsIE5VTEwpOworICAgICAgICBnX2NsZWFyX29iamVjdCgmZmls
ZV9vYmplY3QpOworICAgIH0KKyAgICBpZiAoIXVuaXQtPnN0cmVhbSkgeworICAgICAgICBTUElD
RV9ERUJVRygiJXM6IGNhbid0IG9wZW4gc3RyZWFtIG9uICVzIiwgX19GVU5DVElPTl9fLCB1bml0
LT5maWxlbmFtZSk7CisgICAgICAgIHJldHVybiAtMTsKKyAgICB9CisKKyAgICByZXR1cm4gMDsK
K30KKworc3RhdGljIGludCBjZF9kZXZpY2VfbG9hZChTcGljZUNkTFUgKnVuaXQsIGdib29sZWFu
IGxvYWQpCit7CisgICAgaW50IGVycm9yOworICAgIGlmICghdW5pdC0+ZGV2aWNlIHx8ICF1bml0
LT5maWxlbmFtZSkgeworICAgICAgICByZXR1cm4gLTE7CisgICAgfQorICAgIGludCBmZCA9IG9w
ZW4odW5pdC0+ZmlsZW5hbWUsIE9fUkRPTkxZIHwgT19OT05CTE9DSyk7CisgICAgaWYgKGZkIDwg
MCkgeworICAgICAgICByZXR1cm4gLTE7CisgICAgfQorICAgIGlmIChsb2FkKSB7CisgICAgICAg
IGVycm9yID0gaW9jdGwoZmQsIENEUk9NQ0xPU0VUUkFZLCAwKTsKKyAgICB9IGVsc2UgeworICAg
ICAgICBlcnJvciA9IGlvY3RsKGZkLCBDRFJPTV9MT0NLRE9PUiwgMCk7CisgICAgICAgIGVycm9y
ID0gaW9jdGwoZmQsIENEUk9NRUpFQ1QsIDApOworICAgIH0KKyAgICBpZiAoZXJyb3IpIHsKKyAg
ICAgICAgLy8gbm90ZSB0aGF0IGVqZWN0aW5nIG1pZ2h0IGJlIGF2YWlsYWJsZSBvbmx5IGZvciBy
b290CisgICAgICAgIC8vIGxvYWRpbmcgbWlnaHQgYmUgYXZhaWxhYmxlIGFsc28gZm9yIHJlZ3Vs
YXIgdXNlcgorICAgICAgICBTUElDRV9ERUJVRygiJXM6IGNhbid0ICVzbG9hZCAlcywgcmVzICVk
LCBlcnJubyAlZCIsCisgICAgICAgICAgICBfX0ZVTkNUSU9OX18sIGxvYWQgPyAiIiA6ICJ1biIs
IHVuaXQtPmZpbGVuYW1lLCBlcnJvciwgZXJybm8pOworICAgIH0KKyAgICBjbG9zZShmZCk7Cisg
ICAgcmV0dXJuIGVycm9yOworfQorCitzdGF0aWMgaW50IGNkX2RldmljZV9jaGVjayhTcGljZUNk
TFUgKnVuaXQpCit7CisgICAgaW50IGVycm9yOworICAgIGlmICghdW5pdC0+ZGV2aWNlIHx8ICF1
bml0LT5maWxlbmFtZSkgeworICAgICAgICByZXR1cm4gLTE7CisgICAgfQorICAgIGludCBmZCA9
IG9wZW4odW5pdC0+ZmlsZW5hbWUsIE9fUkRPTkxZIHwgT19OT05CTE9DSyk7CisgICAgaWYgKGZk
IDwgMCkgeworICAgICAgICByZXR1cm4gLTE7CisgICAgfQorICAgIGVycm9yID0gaW9jdGwoZmQs
IENEUk9NX0RSSVZFX1NUQVRVUywgMCk7CisgICAgZXJyb3IgPSAoZXJyb3IgPT0gQ0RTX0RJU0Nf
T0spID8gMCA6IC0xOworICAgIGlmICghZXJyb3IpIHsKKyAgICAgICAgZXJyb3IgPSBpb2N0bChm
ZCwgQ0RST01fRElTQ19TVEFUVVMsIDApOworICAgICAgICBlcnJvciA9IChlcnJvciA9PSBDRFNf
REFUQV8xKSA/IDAgOiAtMTsKKyAgICB9CisgICAgY2xvc2UoZmQpOworICAgIHJldHVybiBlcnJv
cjsKK30KKworI2Vsc2UKKworc3RhdGljIGdib29sZWFuIGlzX2RldmljZV9uYW1lKGNvbnN0IGNo
YXIgKmZpbGVuYW1lKQoreworICAgIHJldHVybiBnX2FzY2lpX2lzYWxwaGEoZmlsZW5hbWVbMF0p
ICYmIGZpbGVuYW1lWzFdID09ICc6JyAmJgorICAgICAgICBmaWxlbmFtZVsyXSA9PSAwOworfQor
CitzdGF0aWMgSEFORExFIG9wZW5fZmlsZShjb25zdCBjaGFyICpmaWxlbmFtZSkKK3sKKyAgICBI
QU5ETEUgaCA9IENyZWF0ZUZpbGVBKGZpbGVuYW1lLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgR0VORVJJQ19SRUFELAorICAgICAgICAgICAgICAgICAgICAgICAgICAgRklMRV9TSEFSRV9S
RUFELAorICAgICAgICAgICAgICAgICAgICAgICAgICAgTlVMTCwgT1BFTl9FWElTVElORywKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgIDAsCisgICAgICAgICAgICAgICAgICAgICAgICAgICBO
VUxMKTsKKyAgICBpZiAoaCA9PSBJTlZBTElEX0hBTkRMRV9WQUxVRSkgeworICAgICAgICBoID0g
TlVMTDsKKyAgICB9CisgICAgcmV0dXJuIGg7Cit9CisKK3N0YXRpYyB1aW50MzJfdCBpb2N0bF9v
dXQoSEFORExFIGgsIHVpbnQzMl90IGNvZGUsIHZvaWQgKm91dF9idWZmZXIsIHVpbnQzMl90IG91
dF9zaXplKQoreworICAgIHVpbnQzMl90IGVycm9yOworICAgIERXT1JEIHJldDsKKyAgICBCT09M
IGIgPSBEZXZpY2VJb0NvbnRyb2woaCwgY29kZSwgTlVMTCwgMCwgb3V0X2J1ZmZlciwgb3V0X3Np
emUsICZyZXQsIE5VTEwpOworICAgIGVycm9yID0gYiA/IDAgOiBHZXRMYXN0RXJyb3IoKTsKKyAg
ICByZXR1cm4gZXJyb3I7Cit9CisKK3N0YXRpYyB1aW50MzJfdCBpb2N0bF9ub25lKEhBTkRMRSBo
LCB1aW50MzJfdCBjb2RlKQoreworICAgIHJldHVybiBpb2N0bF9vdXQoaCwgY29kZSwgTlVMTCwg
MCk7Cit9CisKK3N0YXRpYyBnYm9vbGVhbiBjaGVja19kZXZpY2UoSEFORExFIGgpCit7CisgICAg
R0VUX0NPTkZJR1VSQVRJT05fSU9DVExfSU5QVVQgY2ZnSW4gPQorICAgICAgICB7IEZlYXR1cmVD
ZFJlYWQsIFNDU0lfR0VUX0NPTkZJR1VSQVRJT05fUkVRVUVTVF9UWVBFX0FMTCwge30gfTsKKyAg
ICBEV09SRCByZXQ7CisgICAgR0VUX0NPTkZJR1VSQVRJT05fSEVBREVSIGNmZ091dDsKKyAgICBy
ZXR1cm4gRGV2aWNlSW9Db250cm9sKGgsIElPQ1RMX0NEUk9NX0dFVF9DT05GSUdVUkFUSU9OLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgJmNmZ0luLCBzaXplb2YoY2ZnSW4pLCAmY2ZnT3V0
LCBzaXplb2YoY2ZnT3V0KSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICZyZXQsIE5VTEwp
OworfQorCitzdGF0aWMgaW50IGNkX2RldmljZV9vcGVuX3N0cmVhbShTcGljZUNkTFUgKnVuaXQs
IGNvbnN0IGNoYXIgKmZpbGVuYW1lKQoreworICAgIEhBTkRMRSBoOworICAgIHVuaXQtPmRldmlj
ZSA9IDA7CisgICAgaWYgKCF1bml0LT5maWxlbmFtZSAmJiAhZmlsZW5hbWUpIHsKKyAgICAgICAg
U1BJQ0VfREVCVUcoIiVzOiB1bm5hbWVkIGZpbGUiLCBfX0ZVTkNUSU9OX18pOworICAgICAgICBy
ZXR1cm4gLTE7CisgICAgfQorICAgIGlmICh1bml0LT5maWxlbmFtZSAmJiBmaWxlbmFtZSkgewor
ICAgICAgICBnX2ZyZWUodW5pdC0+ZmlsZW5hbWUpOworICAgICAgICB1bml0LT5maWxlbmFtZSA9
IE5VTEw7CisgICAgfQorICAgIGlmICghZmlsZW5hbWUpIHsKKyAgICAgICAgLy8gcmVvcGVuaW5n
IHRoZSBzdHJlYW0gb24gZXhpc3RpbmcgZmlsZSBuYW1lCisgICAgfSBlbHNlIGlmIChpc19kZXZp
Y2VfbmFtZShmaWxlbmFtZSkpIHsKKyAgICAgICAgdW5pdC0+ZmlsZW5hbWUgPSBnX3N0cmR1cF9w
cmludGYoIlxcXFwuXFwlcyIsIGZpbGVuYW1lKTsKKyAgICB9IGVsc2UgeworICAgICAgICB1bml0
LT5maWxlbmFtZSA9IGdfc3RyZHVwKGZpbGVuYW1lKTsKKyAgICB9CisgICAgaCA9IG9wZW5fZmls
ZSh1bml0LT5maWxlbmFtZSk7CisgICAgaWYgKCFoKSB7CisgICAgICAgIFNQSUNFX0RFQlVHKCIl
czogY2FuJ3Qgb3BlbiBmaWxlICVzIiwgX19GVU5DVElPTl9fLCB1bml0LT5maWxlbmFtZSk7Cisg
ICAgICAgIHJldHVybiAtMTsKKyAgICB9CisKKyAgICBMQVJHRV9JTlRFR0VSIHNpemUgPSB7IDAg
fTsKKyAgICBpZiAoIUdldEZpbGVTaXplRXgoaCwgJnNpemUpKSB7CisgICAgICAgIHVpbnQ2NF90
IGJ1ZmZlclsyNTZdOworICAgICAgICB1aW50MzJfdCByZXM7CisgICAgICAgIHVuaXQtPmRldmlj
ZSA9IGNoZWNrX2RldmljZShoKTsKKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiBDRCBkZXZpY2Ug
JXNyZWNvZ25pemVkIG9uICVzIiwKKyAgICAgICAgICAgIF9fRlVOQ1RJT05fXywgdW5pdC0+ZGV2
aWNlID8gIiIgOiAiTk9UICIsIHVuaXQtPmZpbGVuYW1lKTsKKyAgICAgICAgcmVzID0gaW9jdGxf
b3V0KGgsIElPQ1RMX0RJU0tfR0VUX0RSSVZFX0dFT01FVFJZX0VYLAorICAgICAgICAgICAgICAg
ICAgICAgICAgYnVmZmVyLCBzaXplb2YoYnVmZmVyKSk7CisgICAgICAgIGlmICghcmVzKSB7Cisg
ICAgICAgICAgICBESVNLX0dFT01FVFJZX0VYICpwZyA9IChESVNLX0dFT01FVFJZX0VYICopYnVm
ZmVyOworICAgICAgICAgICAgdW5pdC0+YmxvY2tTaXplID0gcGctPkdlb21ldHJ5LkJ5dGVzUGVy
U2VjdG9yOworICAgICAgICAgICAgc2l6ZSA9IHBnLT5EaXNrU2l6ZTsKKyAgICAgICAgfSBlbHNl
IHsKKyAgICAgICAgICAgIFNQSUNFX0RFQlVHKCIlczogY2FuJ3Qgb2J0YWluIHNpemUgb2YgJXMg
KGVycm9yICV1KSIsCisgICAgICAgICAgICAgICAgX19GVU5DVElPTl9fLCB1bml0LT5maWxlbmFt
ZSwgcmVzKTsKKyAgICAgICAgfQorICAgIH0KKyAgICB1bml0LT5zaXplID0gc2l6ZS5RdWFkUGFy
dDsKKyAgICBDbG9zZUhhbmRsZShoKTsKKyAgICBpZiAodW5pdC0+c2l6ZSkgeworICAgICAgICBH
RmlsZSAqZmlsZV9vYmplY3QgPSBnX2ZpbGVfbmV3X2Zvcl9wYXRoKHVuaXQtPmZpbGVuYW1lKTsK
KyAgICAgICAgdW5pdC0+c3RyZWFtID0gZ19maWxlX3JlYWQoZmlsZV9vYmplY3QsIE5VTEwsIE5V
TEwpOworICAgICAgICBnX2NsZWFyX29iamVjdCgmZmlsZV9vYmplY3QpOworICAgIH0KKyAgICBp
ZiAoIXVuaXQtPnN0cmVhbSkgeworICAgICAgICBTUElDRV9ERUJVRygiJXM6IGNhbid0IG9wZW4g
c3RyZWFtIG9uICVzIiwgX19GVU5DVElPTl9fLCB1bml0LT5maWxlbmFtZSk7CisgICAgICAgIHJl
dHVybiAtMTsKKyAgICB9CisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgY2RfZGV2aWNl
X2xvYWQoU3BpY2VDZExVICp1bml0LCBnYm9vbGVhbiBsb2FkKQoreworICAgIGludCBlcnJvciA9
IDA7CisgICAgSEFORExFIGg7CisgICAgaWYgKCF1bml0LT5kZXZpY2UgfHwgIXVuaXQtPmZpbGVu
YW1lKSB7CisgICAgICAgIHJldHVybiAtMTsKKyAgICB9CisgICAgaCA9IG9wZW5fZmlsZSh1bml0
LT5maWxlbmFtZSk7CisgICAgaWYgKGgpIHsKKyAgICAgICAgdWludDMyX3QgcmVzID0gaW9jdGxf
bm9uZShoLCBsb2FkID8gSU9DVExfU1RPUkFHRV9MT0FEX01FRElBIDogSU9DVExfU1RPUkFHRV9F
SkVDVF9NRURJQSk7CisgICAgICAgIGlmIChyZXMpIHsKKyAgICAgICAgICAgIFNQSUNFX0RFQlVH
KCIlczogY2FuJ3QgJXNsb2FkICVzLCB3aW4gZXJyb3IgJXUiLAorICAgICAgICAgICAgICAgICAg
ICAgICAgX19GVU5DVElPTl9fLCBsb2FkID8gIiIgOiAidW4iLCB1bml0LT5maWxlbmFtZSwgcmVz
KTsKKyAgICAgICAgICAgIGVycm9yID0gLTE7CisgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAg
ICBTUElDRV9ERUJVRygiJXM6IGRldmljZSAlcyBbJXNdIiwKKyAgICAgICAgICAgICAgICAgICAg
ICAgIF9fRlVOQ1RJT05fXywgbG9hZCA/ICJsb2FkZWQiIDogImVqZWN0ZWQiLCB1bml0LT5maWxl
bmFtZSk7CisgICAgICAgIH0KKyAgICAgICAgQ2xvc2VIYW5kbGUoaCk7CisgICAgfQorICAgIHJl
dHVybiBlcnJvcjsKK30KKworc3RhdGljIGludCBjZF9kZXZpY2VfY2hlY2soU3BpY2VDZExVICp1
bml0KQoreworICAgIGludCBlcnJvciA9IDA7CisgICAgQ0RST01fRElTS19EQVRBIGRhdGE7Cisg
ICAgSEFORExFIGg7CisgICAgaWYgKCF1bml0LT5kZXZpY2UgfHwgIXVuaXQtPmZpbGVuYW1lKSB7
CisgICAgICAgIHJldHVybiAtMTsKKyAgICB9CisgICAgaCA9IG9wZW5fZmlsZSh1bml0LT5maWxl
bmFtZSk7CisgICAgaWYgKGgpIHsKKyAgICAgICAgdWludDMyX3QgcmVzID0gaW9jdGxfbm9uZSho
LCBJT0NUTF9TVE9SQUdFX0NIRUNLX1ZFUklGWSk7CisgICAgICAgIGlmICghcmVzKSB7CisgICAg
ICAgICAgICByZXMgPSBpb2N0bF9vdXQoaCwgSU9DVExfQ0RST01fRElTS19UWVBFLCAmZGF0YSwg
c2l6ZW9mKGRhdGEpKTsKKyAgICAgICAgfQorICAgICAgICBpZiAocmVzICE9IDAgfHwgZGF0YS5E
aXNrRGF0YSAhPSBDRFJPTV9ESVNLX0RBVEFfVFJBQ0spIHsKKyAgICAgICAgICAgIGVycm9yID0g
LTE7CisgICAgICAgIH0KKyAgICAgICAgQ2xvc2VIYW5kbGUoaCk7CisgICAgfQorICAgIHJldHVy
biBlcnJvcjsKK30KKworI2VuZGlmCisKK3N0YXRpYyBnYm9vbGVhbiBvcGVuX3N0cmVhbShTcGlj
ZUNkTFUgKnVuaXQsIGNvbnN0IGNoYXIgKmZpbGVuYW1lKQoreworICAgIGdib29sZWFuIGI7Cisg
ICAgYiA9IGNkX2RldmljZV9vcGVuX3N0cmVhbSh1bml0LCBmaWxlbmFtZSkgPT0gMDsKKyAgICBy
ZXR1cm4gYjsKK30KKworc3RhdGljIHZvaWQgY2xvc2Vfc3RyZWFtKFNwaWNlQ2RMVSAqdW5pdCkK
K3sKKyAgICBnX2NsZWFyX29iamVjdCgmdW5pdC0+c3RyZWFtKTsKK30KKworc3RhdGljIGdib29s
ZWFuIGxvYWRfbHVuKFVzYkNkICpkLCBpbnQgdW5pdCwgZ2Jvb2xlYW4gbG9hZCkKK3sKKyAgICBn
Ym9vbGVhbiBiID0gVFJVRTsKKyAgICBpZiAobG9hZCAmJiBkLT51bml0c1t1bml0XS5kZXZpY2Up
IHsKKyAgICAgICAgLy8gdGhlcmUgaXMgb25lIHBvc3NpYmxlIHByb2JsZW0gaW4gY2FzZSBvdXIg
YmFja2VuZCBpcyB0aGUKKyAgICAgICAgLy8gbG9jYWwgQ0QgZGV2aWNlIGFuZCBpdCBpcyBlamVj
dGVkCisgICAgICAgIGNkX2RldmljZV9sb2FkKCZkLT51bml0c1t1bml0XSwgVFJVRSk7CisgICAg
ICAgIGNsb3NlX3N0cmVhbSgmZC0+dW5pdHNbdW5pdF0pOworICAgICAgICBpZiAoY2RfZGV2aWNl
X2NoZWNrKCZkLT51bml0c1t1bml0XSkgfHwgIW9wZW5fc3RyZWFtKCZkLT51bml0c1t1bml0XSwg
TlVMTCkpIHsKKyAgICAgICAgICAgIHJldHVybiBGQUxTRTsKKyAgICAgICAgfQorICAgIH0KKwor
ICAgIGlmIChsb2FkKSB7CisgICAgICAgIENkU2NzaU1lZGlhUGFyYW1ldGVycyBtZWRpYV9wYXJh
bXMgPSB7IDAgfTsKKworICAgICAgICBtZWRpYV9wYXJhbXMuc3RyZWFtID0gZC0+dW5pdHNbdW5p
dF0uc3RyZWFtOworICAgICAgICBtZWRpYV9wYXJhbXMuc2l6ZSA9IGQtPnVuaXRzW3VuaXRdLnNp
emU7CisgICAgICAgIG1lZGlhX3BhcmFtcy5ibG9ja19zaXplID0gZC0+dW5pdHNbdW5pdF0uYmxv
Y2tTaXplOworICAgICAgICBpZiAobWVkaWFfcGFyYW1zLmJsb2NrX3NpemUgPT0gQ0RfREVWX0JM
T0NLX1NJWkUgJiYKKyAgICAgICAgICAgIG1lZGlhX3BhcmFtcy5zaXplICUgRFZEX0RFVl9CTE9D
S19TSVpFID09IDApIHsKKyAgICAgICAgICAgIG1lZGlhX3BhcmFtcy5ibG9ja19zaXplID0gRFZE
X0RFVl9CTE9DS19TSVpFOworICAgICAgICB9CisgICAgICAgIFNQSUNFX0RFQlVHKCIlczogbG9h
ZGluZyAlcywgc2l6ZSAlIiBHX0dVSU5UNjRfRk9STUFUICIsIGJsb2NrICV1IiwKKyAgICAgICAg
ICAgICAgICAgICAgX19GVU5DVElPTl9fLCBkLT51bml0c1t1bml0XS5maWxlbmFtZSwgbWVkaWFf
cGFyYW1zLnNpemUsIG1lZGlhX3BhcmFtcy5ibG9ja19zaXplKTsKKworICAgICAgICBiID0gIWNk
X3VzYl9idWxrX21zZF9sb2FkKGQtPm1zYywgdW5pdCwgJm1lZGlhX3BhcmFtcyk7CisKKyAgICAg
ICAgZC0+dW5pdHNbdW5pdF0ubG9hZGVkID0gISFiOworCisgICAgfSBlbHNlIHsKKyAgICAgICAg
U1BJQ0VfREVCVUcoIiVzOiB1bmxvYWRpbmcgJXMiLCBfX0ZVTkNUSU9OX18sIGQtPnVuaXRzW3Vu
aXRdLmZpbGVuYW1lKTsKKyAgICAgICAgY2RfdXNiX2J1bGtfbXNkX3VubG9hZChkLT5tc2MsIHVu
aXQpOworICAgICAgICBkLT51bml0c1t1bml0XS5sb2FkZWQgPSBGQUxTRTsKKyAgICB9CisgICAg
cmV0dXJuIGI7Cit9CisKK3N0YXRpYyB2b2lkIHVzYl9jZF91bnJlYWxpemUoVXNiQ2QgKmQpCit7
CisgICAgdWludDMyX3QgdW5pdCA9IDA7CisgICAgY2RfdXNiX2J1bGtfbXNkX3VucmVhbGl6ZShk
LT5tc2MsIHVuaXQpOworICAgIGdfY2xlYXJfcG9pbnRlcigmZC0+dW5pdHNbdW5pdF0uZmlsZW5h
bWUsIGdfZnJlZSk7CisgICAgY2xvc2Vfc3RyZWFtKCZkLT51bml0c1t1bml0XSk7CisgICAgZ19j
bGVhcl9wb2ludGVyKCZkLT5tc2MsIGNkX3VzYl9idWxrX21zZF9mcmVlKTsKKyAgICBnX2ZyZWUo
ZCk7Cit9CisKK3N0YXRpYyBnYm9vbGVhbiB1c2JfY2RfZ2V0X2Rlc2NyaXB0b3IoVXNiQ2QgKmQs
IHVpbnQ4X3QgdHlwZSwgdWludDhfdCBpbmRleCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdm9pZCAqKmJ1ZmZlciwgdWludDE2X3QgKnNpemUpCit7CisgICAgc3RhdGlj
IHN0cnVjdCBsaWJ1c2JfZGV2aWNlX2Rlc2NyaXB0b3IgZGVzYyA9IHsKKyAgICAgICAgLmJMZW5n
dGggPSAxOCwKKyAgICAgICAgLmJEZXNjcmlwdG9yVHlwZSA9IExJQlVTQl9EVF9ERVZJQ0UsCisg
ICAgICAgIC5iY2RVU0IgPSBVU0IyX0JDRCwKKyAgICAgICAgLmJEZXZpY2VDbGFzcyA9IDAsCisg
ICAgICAgIC5iRGV2aWNlU3ViQ2xhc3MgPSAwLAorICAgICAgICAuYkRldmljZVByb3RvY29sID0g
MCwKKyAgICAgICAgLmJNYXhQYWNrZXRTaXplMCA9IDY0LAorICAgICAgICAuaWRWZW5kb3IgPSBD
RF9ERVZfVklELAorICAgICAgICAuaWRQcm9kdWN0ID0gQ0RfREVWX1BJRCwKKyAgICAgICAgLmJj
ZERldmljZSA9IDB4MTAwLAorICAgICAgICAuaU1hbnVmYWN0dXJlciA9IDEsCisgICAgICAgIC5p
UHJvZHVjdCA9IDIsCisgICAgICAgIC5pU2VyaWFsTnVtYmVyID0gMywKKyAgICAgICAgLmJOdW1D
b25maWd1cmF0aW9ucyA9IDEKKyAgICB9OworICAgIHN0YXRpYyB1aW50OF90IGNmZ1tdID0KKyAg
ICB7CisgICAgICAgIDksIC8vbGVuIG9mIGNmZyBkZXNjCisgICAgICAgIExJQlVTQl9EVF9DT05G
SUcsIC8vIGRlc2MgdHlwZQorICAgICAgICAweDIwLCAvLyB3bGVuCisgICAgICAgIDAsCisgICAg
ICAgIDEsIC8vIG51bSBpZgorICAgICAgICAxLCAvLyBjZmcgdmFsCisgICAgICAgIDAsIC8vIGNm
ZyBuYW1lCisgICAgICAgIDB4ODAsIC8vIGJ1cyBwb3dlcmVkCisgICAgICAgIDB4MzIsIC8vIDEw
MCBtYQorICAgICAgICA5LCAvLyBsZW4gb2YgSUYgZGVzYworICAgICAgICBMSUJVU0JfRFRfSU5U
RVJGQUNFLAorICAgICAgICAwLCAvLyBudW0gaWYKKyAgICAgICAgMCwgLy8gYWx0IHNldHRpbmcK
KyAgICAgICAgMiwgLy8gbnVtIG9mIGVuZHBvaW50cworICAgICAgICBDRF9ERVZfQ0xBU1MsCisg
ICAgICAgIENEX0RFVl9TVUJDTEFTUywKKyAgICAgICAgQ0RfREVWX1BST1RPQ09MLAorICAgICAg
ICAwLCAvLyBpZiBuYW1lCisgICAgICAgIDcsCisgICAgICAgIExJQlVTQl9EVF9FTkRQT0lOVCwK
KyAgICAgICAgMHg4MSwgLy8tPkRpcmVjdGlvbiA6IElOIC0gRW5kcG9pbnRJRCA6IDEKKyAgICAg
ICAgMHgwMiwgLy8tPkJ1bGsgVHJhbnNmZXIgVHlwZQorICAgICAgICAwLCAgICAvL3dNYXhQYWNr
ZXRTaXplIDogMHgwMjAwID0gMHgyMDAgbWF4IGJ5dGVzCisgICAgICAgIDIsCisgICAgICAgIDAs
ICAgIC8vYkludGVydmFsCisgICAgICAgIDcsCisgICAgICAgIExJQlVTQl9EVF9FTkRQT0lOVCwK
KyAgICAgICAgMHgwMiwgLy8tPkRpcmVjdGlvbiA6IE9VVCAtIEVuZHBvaW50SUQgOiAyCisgICAg
ICAgIDB4MDIsIC8vLT5CdWxrIFRyYW5zZmVyIFR5cGUKKyAgICAgICAgMCwgICAgLy93TWF4UGFj
a2V0U2l6ZSA6IDB4MDIwMCA9IDB4MjAwIG1heCBieXRlcworICAgICAgICAyLAorICAgICAgICAw
LCAgICAvL2JJbnRlcnZhbAorICAgIH07CisgICAgc3RhdGljIHVpbnQxNl90IHMwWzJdID0geyAw
eDMwNCwgMHg0MDkgfTsKKyAgICBzdGF0aWMgdWludDE2X3QgczFbOF0gPSB7IDB4MzEwLCAnUics
ICdlJywgJ2QnLCAnICcsICdIJywgJ2EnLCAndCcgfTsKKyAgICBzdGF0aWMgdWludDE2X3QgczJb
OV0gPSB7IDB4MzEyLCAnUycsICdwJywgJ2knLCAnYycsICdlJywgJyAnLCAnQycsICdEJyB9Owor
CisgICAgdm9pZCAqcCA9IE5VTEw7CisgICAgdWludDE2X3QgbGVuID0gMDsKKworICAgIHN3aXRj
aCAodHlwZSkgeworICAgIGNhc2UgTElCVVNCX0RUX0RFVklDRToKKyAgICAgICAgcCA9ICZkZXNj
OworICAgICAgICBsZW4gPSBzaXplb2YoZGVzYyk7CisgICAgICAgIGJyZWFrOworICAgIGNhc2Ug
TElCVVNCX0RUX0NPTkZJRzoKKyAgICAgICAgcCA9IGNmZzsKKyAgICAgICAgbGVuID0gc2l6ZW9m
KGNmZyk7CisgICAgICAgIGJyZWFrOworICAgIGNhc2UgTElCVVNCX0RUX1NUUklORzoKKyAgICAg
ICAgaWYgKGluZGV4ID09IDApIHsKKyAgICAgICAgICAgIHAgPSBzMDsgbGVuID0gc2l6ZW9mKHMw
KTsKKyAgICAgICAgfSBlbHNlIGlmIChpbmRleCA9PSAxKSB7CisgICAgICAgICAgICBwID0gczE7
IGxlbiA9IHNpemVvZihzMSk7CisgICAgICAgIH0gZWxzZSBpZiAoaW5kZXggPT0gMikgeworICAg
ICAgICAgICAgcCA9IHMyOyBsZW4gPSBzaXplb2YoczIpOworICAgICAgICB9IGVsc2UgaWYgKGlu
ZGV4ID09IDMpIHsKKyAgICAgICAgICAgIHAgPSBkLT5zZXJpYWw7IGxlbiA9IHNpemVvZihkLT5z
ZXJpYWwpOworICAgICAgICB9CisgICAgICAgIGJyZWFrOworICAgIH0KKworICAgIGlmIChwKSB7
CisgICAgICAgICpidWZmZXIgPSBwOworICAgICAgICAqc2l6ZSA9IGxlbjsKKyAgICB9CisKKyAg
ICByZXR1cm4gcCAhPSBOVUxMOworfQorCitzdGF0aWMgdm9pZCB1c2JfY2RfYXR0YWNoKFVzYkNk
ICpkZXZpY2UsIHN0cnVjdCB1c2JyZWRpcnBhcnNlciAqcGFyc2VyKQoreworICAgIGRldmljZS0+
cGFyc2VyID0gcGFyc2VyOworfQorCitzdGF0aWMgdm9pZCB1c2JfY2RfZGV0YWNoKFVzYkNkICpk
ZXZpY2UpCit7CisgICAgZGV2aWNlLT5wYXJzZXIgPSBOVUxMOworfQorCitzdGF0aWMgdm9pZCB1
c2JfY2RfcmVzZXQoVXNiQ2QgKmRldmljZSkKK3sKKyAgICBjZF91c2JfYnVsa19tc2RfcmVzZXQo
ZGV2aWNlLT5tc2MpOworfQorCitzdGF0aWMgdm9pZCB1c2JfY2RfY29udHJvbF9yZXF1ZXN0KFVz
YkNkICpkZXZpY2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ4X3Qg
KmRhdGEsIGludCBkYXRhX2xlbiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
c3RydWN0IHVzYl9yZWRpcl9jb250cm9sX3BhY2tldF9oZWFkZXIgKmgsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKipidWZmZXIpCit7CisgICAgdWludDhfdCByZXF0
eXBlID0gaC0+cmVxdWVzdHR5cGUgJiAweDdmOworICAgIGlmICghZGV2aWNlLT5tc2MpIHsKKyAg
ICAgICAgcmV0dXJuOworICAgIH0KKyAgICBpZiAocmVxdHlwZSA9PSAoTElCVVNCX1JFUVVFU1Rf
VFlQRV9TVEFOREFSRCB8IExJQlVTQl9SRUNJUElFTlRfRU5EUE9JTlQpKSB7CisgICAgICAgIC8v
IG1pZ2h0IGJlIGNsZWFyIHN0YWxsIHJlcXVlc3QKKyAgICAgICAgaC0+bGVuZ3RoID0gMDsKKyAg
ICAgICAgaC0+c3RhdHVzID0gdXNiX3JlZGlyX3N1Y2Nlc3M7OworICAgICAgICByZXR1cm47Cisg
ICAgfQorCisgICAgaWYgKHJlcXR5cGUgPT0gKExJQlVTQl9SRVFVRVNUX1RZUEVfQ0xBU1MgfCBM
SUJVU0JfUkVDSVBJRU5UX0lOVEVSRkFDRSkpIHsKKyAgICAgICAgc3dpdGNoIChoLT5yZXF1ZXN0
KSB7CisgICAgICAgIGNhc2UgMHhGRjoKKyAgICAgICAgICAgIC8vIG1hc3Mtc3RvcmFnZSBjbGFz
cyByZXF1ZXN0ICdyZXNldCcKKyAgICAgICAgICAgIHVzYl9jZF9yZXNldChkZXZpY2UpOworICAg
ICAgICAgICAgaC0+bGVuZ3RoID0gMDsKKyAgICAgICAgICAgIGgtPnN0YXR1cyA9IHVzYl9yZWRp
cl9zdWNjZXNzOworICAgICAgICAgICAgYnJlYWs7CisgICAgICAgIGNhc2UgMHhGRToKKyAgICAg
ICAgICAgIC8vIG1hc3Mtc3RvcmFnZSBjbGFzcyByZXF1ZXN0ICdnZXQgbWF4IGx1bicKKyAgICAg
ICAgICAgIC8vIHJldHVybmluZyBvbmUgYnl0ZQorICAgICAgICAgICAgaWYgKGgtPmxlbmd0aCkg
eworICAgICAgICAgICAgICAgIGgtPmxlbmd0aCA9IDE7CisgICAgICAgICAgICAgICAgaC0+c3Rh
dHVzID0gdXNiX3JlZGlyX3N1Y2Nlc3M7OworICAgICAgICAgICAgICAgICpidWZmZXIgPSAmZGV2
aWNlLT5tYXhfbHVuX2luZGV4OworICAgICAgICAgICAgfQorICAgICAgICAgICAgYnJlYWs7Cisg
ICAgICAgIH0KKyAgICB9Cit9CisKK3N0YXRpYyB2b2lkIHVzYl9jZF9idWxrX291dF9yZXF1ZXN0
KFVzYkNkICpkZXZpY2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50
OF90IGVwLCB1aW50OF90ICpkYXRhLCBpbnQgZGF0YV9sZW4sCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB1aW50OF90ICpzdGF0dXMpCit7CisgICAgaWYgKCFjZF91c2JfYnVs
a19tc2Rfd3JpdGUoZGV2aWNlLT5tc2MsIGRhdGEsIGRhdGFfbGVuKSkgeworICAgICAgICAqc3Rh
dHVzID0gdXNiX3JlZGlyX3N1Y2Nlc3M7CisgICAgfQorfQorCit2b2lkIGNkX3VzYl9idWxrX21z
ZF9yZWFkX2NvbXBsZXRlKHZvaWQgKnVzZXJfZGF0YSwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdWludDhfdCAqZGF0YSwgdWludDMyX3QgbGVuZ3RoLCBDZFVzYkJ1bGtTdGF0
dXMgc3RhdHVzKQoreworICAgIFVzYkNkICpkID0gKFVzYkNkICopdXNlcl9kYXRhOworCisgICAg
aWYgKGQtPmRlbGV0aW5nKSB7CisgICAgICAgIGQtPmRlbGV0aW5nID0gRkFMU0U7CisgICAgICAg
IHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9lamVjdChkLT5iYWNrZW5kLCBkLT5wYXJlbnQpOwor
ICAgIH0KKworICAgIGlmIChkLT5wYXJzZXIpIHsKKyAgICAgICAgaW50IG5yZWFkOworICAgICAg
ICB1aW50MzJfdCBvZmZzZXQgPSAwOworCisgICAgICAgIGZvciAobnJlYWQgPSAwOyBucmVhZCA8
IGQtPm51bV9yZWFkczsgbnJlYWQrKykgeworICAgICAgICAgICAgdWludDMyX3QgbWF4X2xlbjsK
KyAgICAgICAgICAgIG1heF9sZW4gPSAoZC0+cmVhZF9idWxrW25yZWFkXS5ob3V0Lmxlbmd0aF9o
aWdoIDw8IDE2KSB8CisgICAgICAgICAgICAgICAgICAgICAgICBkLT5yZWFkX2J1bGtbbnJlYWRd
LmhvdXQubGVuZ3RoOworICAgICAgICAgICAgaWYgKG1heF9sZW4gPiBsZW5ndGgpIHsKKyAgICAg
ICAgICAgICAgICBtYXhfbGVuID0gbGVuZ3RoOworICAgICAgICAgICAgICAgIGQtPnJlYWRfYnVs
a1tucmVhZF0uaG91dC5sZW5ndGggPSBsZW5ndGg7CisgICAgICAgICAgICAgICAgZC0+cmVhZF9i
dWxrW25yZWFkXS5ob3V0Lmxlbmd0aF9oaWdoID0gbGVuZ3RoID4+IDE2OworICAgICAgICAgICAg
fQorCisgICAgICAgICAgICBzd2l0Y2ggKHN0YXR1cykgeworICAgICAgICAgICAgY2FzZSBCVUxL
X1NUQVRVU19HT09EOgorICAgICAgICAgICAgICAgIGQtPnJlYWRfYnVsa1tucmVhZF0uaG91dC5z
dGF0dXMgPSB1c2JfcmVkaXJfc3VjY2VzczsKKyAgICAgICAgICAgICAgICBicmVhazsKKyAgICAg
ICAgICAgIGNhc2UgQlVMS19TVEFUVVNfQ0FOQ0VMRUQ6CisgICAgICAgICAgICAgICAgZC0+cmVh
ZF9idWxrW25yZWFkXS5ob3V0LnN0YXR1cyA9IHVzYl9yZWRpcl9jYW5jZWxsZWQ7CisgICAgICAg
ICAgICAgICAgYnJlYWs7CisgICAgICAgICAgICBjYXNlIEJVTEtfU1RBVFVTX0VSUk9SOgorICAg
ICAgICAgICAgICAgIGQtPnJlYWRfYnVsa1tucmVhZF0uaG91dC5zdGF0dXMgPSB1c2JfcmVkaXJf
aW9lcnJvcjsKKyAgICAgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICAgIGNhc2UgQlVMS19T
VEFUVVNfU1RBTEw6CisgICAgICAgICAgICBkZWZhdWx0OgorICAgICAgICAgICAgICAgIGQtPnJl
YWRfYnVsa1tucmVhZF0uaG91dC5zdGF0dXMgPSB1c2JfcmVkaXJfc3RhbGw7CisgICAgICAgICAg
ICAgICAgYnJlYWs7CisgICAgICAgICAgICB9CisKKyAgICAgICAgICAgIFNQSUNFX0RFQlVHKCIl
czogcmVzcG9uZGluZyAlIiBHX0dVSU5UNjRfRk9STUFUICIgd2l0aCBsZW4gJXUgb3V0IG9mICV1
LCBzdGF0dXMgJWQiLAorICAgICAgICAgICAgICAgICAgICAgICAgX19GVU5DVElPTl9fLCBkLT5y
ZWFkX2J1bGtbbnJlYWRdLmlkLCBtYXhfbGVuLAorICAgICAgICAgICAgICAgICAgICAgICAgbGVu
Z3RoLCBkLT5yZWFkX2J1bGtbbnJlYWRdLmhvdXQuc3RhdHVzKTsKKyAgICAgICAgICAgIHVzYnJl
ZGlycGFyc2VyX3NlbmRfYnVsa19wYWNrZXQoZC0+cGFyc2VyLCBkLT5yZWFkX2J1bGtbbnJlYWRd
LmlkLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmZC0+cmVh
ZF9idWxrW25yZWFkXS5ob3V0LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBtYXhfbGVuID8gKGRhdGEgKyBvZmZzZXQpIDogTlVMTCwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4X2xlbik7CisgICAgICAgICAgICBvZmZz
ZXQgKz0gbWF4X2xlbjsKKyAgICAgICAgICAgIGxlbmd0aCAtPSBtYXhfbGVuOworICAgICAgICB9
CisgICAgICAgIGQtPm51bV9yZWFkcyA9IDA7CisgICAgICAgIHVzYnJlZGlycGFyc2VyX2RvX3dy
aXRlKGQtPnBhcnNlcik7CisKKyAgICAgICAgaWYgKGxlbmd0aCkgeworICAgICAgICAgICAgU1BJ
Q0VfREVCVUcoIiVzOiBFUlJPUjogJXUgYnl0ZXMgd2VyZSBub3QgcmVwb3J0ZWQhIiwgX19GVU5D
VElPTl9fLCBsZW5ndGgpOworICAgICAgICB9CisKKyAgICB9IGVsc2UgeworICAgICAgICBTUElD
RV9ERUJVRygiJXM6IGJyb2tlbiBkZXZpY2U8LT5jaGFubmVsIHJlbGF0aW9uc2hpcCEiLCBfX0ZV
TkNUSU9OX18pOworICAgIH0KK30KKworLyogZGV2aWNlIHJlc2V0IGNvbXBsZXRpb24gY2FsbGJh
Y2sgKi8KK3ZvaWQgY2RfdXNiX2J1bGtfbXNkX3Jlc2V0X2NvbXBsZXRlKHZvaWQgKnVzZXJfZGF0
YSwgaW50IHN0YXR1cykKK3sKKyAgICAvLyBVc2JDZCAqZCA9IChVc2JDZCAqKXVzZXJfZGF0YTsK
K30KKworc3RhdGljIGdib29sZWFuIHVzYl9jZF9idWxrX2luX3JlcXVlc3QoVXNiQ2QgKmQsIHVp
bnQ2NF90IGlkLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0
IHVzYl9yZWRpcl9idWxrX3BhY2tldF9oZWFkZXIgKmgpCit7CisgICAgaW50IHJlczsKKyAgICB1
aW50MzJfdCBsZW4gPSAoaC0+bGVuZ3RoX2hpZ2ggPDwgMTYpIHwgaC0+bGVuZ3RoOworICAgIGlm
IChkLT5udW1fcmVhZHMgPj0gTUFYX0JVTEtfSU5fUkVRVUVTVFMpIHsKKyAgICAgICAgaC0+bGVu
Z3RoID0gaC0+bGVuZ3RoX2hpZ2ggPSAwOworICAgICAgICBTUElDRV9ERUJVRygiJXM6IHRvbyBt
YW55IHBlbmRpbmcgcmVhZHMiLCBfX0ZVTkNUSU9OX18pOworICAgICAgICBoLT5zdGF0dXMgPSB1
c2JfcmVkaXJfYmFiYmxlOworICAgICAgICByZXR1cm4gRkFMU0U7CisgICAgfQorCisgICAgaWYg
KGQtPm51bV9yZWFkcykgeworICAgICAgICBTUElDRV9ERUJVRygiJXM6IGFscmVhZHkgaGFzICV1
IHBlbmRpbmcgcmVhZHMiLCBfX0ZVTkNUSU9OX18sIGQtPm51bV9yZWFkcyk7CisgICAgfQorCisg
ICAgZC0+cmVhZF9idWxrW2QtPm51bV9yZWFkc10uaG91dCA9ICpoOworICAgIGQtPnJlYWRfYnVs
a1tkLT5udW1fcmVhZHNdLmlkID0gaWQ7CisgICAgZC0+bnVtX3JlYWRzKys7CisgICAgcmVzID0g
Y2RfdXNiX2J1bGtfbXNkX3JlYWQoZC0+bXNjLCBsZW4pOworICAgIGlmICghcmVzKSB7CisgICAg
ICAgIHJldHVybiBUUlVFOworICAgIH0KKworICAgIFNQSUNFX0RFQlVHKCIlczogZXJyb3Igb24g
YnVsayByZWFkIiwgX19GVU5DVElPTl9fKTsKKyAgICBkLT5udW1fcmVhZHMtLTsKKyAgICBoLT5s
ZW5ndGggPSBoLT5sZW5ndGhfaGlnaCA9IDA7CisgICAgaC0+c3RhdHVzID0gdXNiX3JlZGlyX2lv
ZXJyb3I7CisKKyAgICByZXR1cm4gRkFMU0U7Cit9CisKK3N0YXRpYyB2b2lkIHVzYl9jZF9jYW5j
ZWxfcmVxdWVzdChVc2JDZCAqZCwgdWludDY0X3QgaWQpCit7CisgICAgdWludDMyX3QgbnJlYWQ7
CisKKyAgICBmb3IgKG5yZWFkID0gMDsgbnJlYWQgPCBkLT5udW1fcmVhZHM7IG5yZWFkKyspIHsK
KyAgICAgICAgaWYgKGQtPnJlYWRfYnVsa1tucmVhZF0uaWQgPT0gaWQpIHsKKyAgICAgICAgICAg
IGlmIChjZF91c2JfYnVsa19tc2RfY2FuY2VsX3JlYWQoZC0+bXNjKSkgeworICAgICAgICAgICAg
ICAgIGNkX3VzYl9idWxrX21zZF9yZWFkX2NvbXBsZXRlKGQsIE5VTEwsIDAsIEJVTEtfU1RBVFVT
X0NBTkNFTEVEKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgICAgIHJldHVybjsKKyAgICAgICAg
fQorICAgIH0KKyAgICBTUElDRV9ERUJVRygiJXM6IEVSUk9SOiBubyBzdWNoIGlkIHRvIGNhbmNl
bCEiLCBfX0ZVTkNUSU9OX18pOworfQorCisvLyBjYWxsZWQgd2hlbiBhIGNoYW5nZSBoYXBwZW5z
IG9uIFNDU0kgbGF5ZXIKK3ZvaWQgY2RfdXNiX2J1bGtfbXNkX2x1bl9jaGFuZ2VkKHZvaWQgKnVz
ZXJfZGF0YSwgdWludDMyX3QgbHVuKQoreworICAgIFVzYkNkICpkID0gKFVzYkNkICopdXNlcl9k
YXRhOworICAgIENkU2NzaURldmljZUluZm8gY2RfaW5mbzsKKworICAgIGlmICghY2RfdXNiX2J1
bGtfbXNkX2dldF9pbmZvKGQtPm1zYywgbHVuLCAmY2RfaW5mbykpIHsKKyAgICAgICAgLy8gbG9h
ZCBvciB1bmxvYWQgY29tbWFuZCByZWNlaXZlZCBmcm9tIFNDU0kKKyAgICAgICAgaWYgKGQtPnVu
aXRzW2x1bl0ubG9hZGVkICE9IGNkX2luZm8ubG9hZGVkKSB7CisgICAgICAgICAgICBpZiAoIWxv
YWRfbHVuKGQsIGx1biwgY2RfaW5mby5sb2FkZWQpKSB7CisgICAgICAgICAgICAgICAgU1BJQ0Vf
REVCVUcoIiVzOiBsb2FkIGZhaWxlZCwgdW5sb2FkaW5nIHVuaXQiLCBfX0ZVTkNUSU9OX18pOwor
ICAgICAgICAgICAgICAgIGNkX3VzYl9idWxrX21zZF91bmxvYWQoZC0+bXNjLCBsdW4pOworICAg
ICAgICAgICAgfQorICAgICAgICB9CisgICAgfQorCisgICAgaWYgKGQtPmRlbGV0ZV9vbl9lamVj
dCkgeworICAgICAgICBkLT5kZWxldGVfb25fZWplY3QgPSBGQUxTRTsKKyAgICAgICAgZC0+ZGVs
ZXRpbmcgPSBUUlVFOworICAgIH0gZWxzZSB7CisgICAgICAgIHNwaWNlX3VzYl9iYWNrZW5kX2Rl
dmljZV9yZXBvcnRfY2hhbmdlKGQtPmJhY2tlbmQsIGQtPnBhcmVudCk7CisgICAgfQorfQorCitz
dGF0aWMgZ2NoYXIgKnVzYl9jZF9nZXRfcHJvZHVjdF9kZXNjcmlwdGlvbihVc2JDZCAqZGV2aWNl
KQoreworICAgIGdjaGFyICpiYXNlX25hbWUgPSBnX3BhdGhfZ2V0X2Jhc2VuYW1lKGRldmljZS0+
dW5pdHNbMF0uZmlsZW5hbWUpOworICAgIGdjaGFyICpyZXMgPSBnX3N0cmR1cF9wcmludGYoIlNQ
SUNFIENEICglcykiLCBiYXNlX25hbWUpOworICAgIGdfZnJlZShiYXNlX25hbWUpOworICAgIHJl
dHVybiByZXM7Cit9CisKK3N0YXRpYyBjb25zdCBVc2JEZXZpY2VPcHMgZGV2b3BzID0KK3sKKyAg
ICAuZ2V0X2Rlc2NyaXB0b3IgPSB1c2JfY2RfZ2V0X2Rlc2NyaXB0b3IsCisgICAgLmdldF9wcm9k
dWN0X2Rlc2NyaXB0aW9uID0gdXNiX2NkX2dldF9wcm9kdWN0X2Rlc2NyaXB0aW9uLAorICAgIC5h
dHRhY2ggPSB1c2JfY2RfYXR0YWNoLAorICAgIC5yZXNldCA9IHVzYl9jZF9yZXNldCwKKyAgICAu
ZGV0YWNoID0gdXNiX2NkX2RldGFjaCwKKyAgICAuY29udHJvbF9yZXF1ZXN0ID0gdXNiX2NkX2Nv
bnRyb2xfcmVxdWVzdCwKKyAgICAuYnVsa19vdXRfcmVxdWVzdCA9IHVzYl9jZF9idWxrX291dF9y
ZXF1ZXN0LAorICAgIC5idWxrX2luX3JlcXVlc3QgPSB1c2JfY2RfYnVsa19pbl9yZXF1ZXN0LAor
ICAgIC5jYW5jZWxfcmVxdWVzdCA9IHVzYl9jZF9jYW5jZWxfcmVxdWVzdCwKKyAgICAudW5yZWFs
aXplID0gdXNiX2NkX3VucmVhbGl6ZSwKK307CisKK3N0YXRpYyBVc2JDZCogdXNiX2NkX2NyZWF0
ZShTcGljZVVzYkJhY2tlbmQgKmJlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNl
VXNiQmFja2VuZERldmljZSAqcGFyZW50LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZv
aWQgKm9wYXF1ZV9wYXJhbSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBHRXJyb3IgKipl
cnIpCit7CisgICAgQ2RFbXVsYXRpb25QYXJhbXMgKnBhcmFtID0gb3BhcXVlX3BhcmFtOworICAg
IGludCBlcnJvciA9IDAsIGk7CisgICAgdWludDMyX3QgdW5pdCA9IDA7CisgICAgVXNiQ2QgKmQg
PSBnX25ldzAoVXNiQ2QsIDEpOworICAgIENkU2NzaURldmljZVBhcmFtZXRlcnMgZGV2X3BhcmFt
cyA9IHsgMCB9OworICAgIHVpbnQxNl90IGFkZHJlc3MgPSBzcGljZV91c2JfYmFja2VuZF9kZXZp
Y2VfZ2V0X2luZm8ocGFyZW50KS0+YWRkcmVzczsKKworICAgIGQtPmRldl9vcHMgPSBkZXZvcHM7
CisgICAgZC0+YmFja2VuZCA9IGJlOworICAgIGQtPnBhcmVudCAgPSBwYXJlbnQ7CisgICAgZC0+
ZGVsZXRlX29uX2VqZWN0ID0gISFwYXJhbS0+ZGVsZXRlX29uX2VqZWN0OworICAgIGQtPmxvY2tl
ZCA9ICFkLT5kZWxldGVfb25fZWplY3Q7CisgICAgZC0+c2VyaWFsWzBdID0gMHgwMzAwICsgc2l6
ZW9mKGQtPnNlcmlhbCk7CisgICAgZC0+c2VyaWFsWzFdID0gJzAnICsgYWRkcmVzcyAvIDEwOwor
ICAgIGQtPnNlcmlhbFsyXSA9ICcwJyArIGFkZHJlc3MgJSAxMDsKKyAgICBmb3IgKGkgPSAzOyBp
IDwgR19OX0VMRU1FTlRTKGQtPnNlcmlhbCk7ICsraSkgeworICAgICAgICBkLT5zZXJpYWxbaV0g
PSAnMCc7CisgICAgfQorICAgIGQtPm1heF9sdW5faW5kZXggPSBNQVhfTFVOX1BFUl9ERVZJQ0Ug
LSAxOworCisgICAgZGV2X3BhcmFtcy52ZW5kb3IgPSAiUmVkIEhhdCI7CisgICAgZGV2X3BhcmFt
cy5wcm9kdWN0ID0gIlNQSUNFIENEIjsKKyAgICBkZXZfcGFyYW1zLnZlcnNpb24gPSAiMCI7CisK
KyAgICBkLT5tc2MgPSBjZF91c2JfYnVsa19tc2RfYWxsb2MoZCwgTUFYX0xVTl9QRVJfREVWSUNF
KTsKKyAgICBpZiAoIWQtPm1zYykgeworICAgICAgICBnX2NsZWFyX3BvaW50ZXIoJmQsIGdfZnJl
ZSk7CisgICAgICAgIGdfc2V0X2Vycm9yKGVyciwgU1BJQ0VfQ0xJRU5UX0VSUk9SLCBTUElDRV9D
TElFTlRfRVJST1JfRkFJTEVELAorICAgICAgICAgICAgICAgICAgICBfKCJjYW4ndCBhbGxvY2F0
ZSBkZXZpY2UiKSk7CisgICAgICAgIHJldHVybiBOVUxMOworICAgIH0KKyAgICBkLT51bml0c1t1
bml0XS5ibG9ja1NpemUgPSBDRF9ERVZfQkxPQ0tfU0laRTsKKyAgICBpZiAoIWNkX3VzYl9idWxr
X21zZF9yZWFsaXplKGQtPm1zYywgdW5pdCwgJmRldl9wYXJhbXMpKSB7CisgICAgICAgIGlmIChv
cGVuX3N0cmVhbSgmZC0+dW5pdHNbdW5pdF0sIHBhcmFtLT5maWxlbmFtZSkgJiYKKyAgICAgICAg
ICAgIGxvYWRfbHVuKGQsIHVuaXQsIFRSVUUpKSB7CisgICAgICAgICAgICBpZiAoZC0+bG9ja2Vk
KSB7CisgICAgICAgICAgICAgICAgY2RfdXNiX2J1bGtfbXNkX2xvY2soZC0+bXNjLCB1bml0LCBU
UlVFKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgIGNsb3Nl
X3N0cmVhbSgmZC0+dW5pdHNbdW5pdF0pOworICAgICAgICAgICAgY2RfdXNiX2J1bGtfbXNkX3Vu
cmVhbGl6ZShkLT5tc2MsIHVuaXQpOworICAgICAgICAgICAgZ19zZXRfZXJyb3IoZXJyLCBTUElD
RV9DTElFTlRfRVJST1IsIFNQSUNFX0NMSUVOVF9FUlJPUl9GQUlMRUQsCisgICAgICAgICAgICAg
ICAgICAgICAgICBfKCJjYW4ndCBjcmVhdGUgZGV2aWNlIHdpdGggJXMiKSwKKyAgICAgICAgICAg
ICAgICAgICAgICAgIHBhcmFtLT5maWxlbmFtZSk7CisgICAgICAgICAgICBlcnJvciA9IDE7Cisg
ICAgICAgIH0KKyAgICB9IGVsc2UgeworICAgICAgICBnX3NldF9lcnJvcihlcnIsIFNQSUNFX0NM
SUVOVF9FUlJPUiwgU1BJQ0VfQ0xJRU5UX0VSUk9SX0ZBSUxFRCwKKyAgICAgICAgICAgICAgICAg
ICAgXygiY2FuJ3QgYWxsb2NhdGUgZGV2aWNlIikpOworICAgICAgICBlcnJvciA9IDE7CisgICAg
fQorICAgIGlmIChlcnJvcikgeworICAgICAgICBnX2NsZWFyX3BvaW50ZXIoJmQtPm1zYywgY2Rf
dXNiX2J1bGtfbXNkX2ZyZWUpOworICAgICAgICBnX2NsZWFyX3BvaW50ZXIoJmQsIGdfZnJlZSk7
CisgICAgICAgIHJldHVybiBOVUxMOworICAgIH0KKworICAgIHJldHVybiBkOworfQorCitnYm9v
bGVhbgorY3JlYXRlX2VtdWxhdGVkX2NkKFNwaWNlVXNiQmFja2VuZCAqYmUsCisgICAgICAgICAg
ICAgICAgICAgQ2RFbXVsYXRpb25QYXJhbXMgKnBhcmFtLAorICAgICAgICAgICAgICAgICAgIEdF
cnJvciAqKmVycikKK3sKKyAgICByZXR1cm4gc3BpY2VfdXNiX2JhY2tlbmRfY3JlYXRlX2VtdWxh
dGVkX2RldmljZShiZSwgdXNiX2NkX2NyZWF0ZSwgcGFyYW0sIGVycik7Cit9CisKKyNlbmRpZiAv
KiBVU0VfVVNCUkVESVIgKi8KZGlmZiAtLWdpdCBhL3NyYy91c2ItZGV2aWNlLWNkLmggYi9zcmMv
dXNiLWRldmljZS1jZC5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwLi5lOTg1
MjQyMgotLS0gL2Rldi9udWxsCisrKyBiL3NyYy91c2ItZGV2aWNlLWNkLmgKQEAgLTAsMCArMSwz
NCBAQAorLyogLSotIE1vZGU6IEM7IGMtYmFzaWMtb2Zmc2V0OiA0OyBpbmRlbnQtdGFicy1tb2Rl
OiBuaWwgLSotICovCisvKgorICAgIENvcHlyaWdodCAoQykgMjAxOSBSZWQgSGF0LCBJbmMuCisK
KyAgICBSZWQgSGF0IEF1dGhvcnM6CisgICAgWXVyaSBCZW5kaXRvdmljaDx5YmVuZGl0b0ByZWRo
YXQuY29tPgorCisgICAgVGhpcyBsaWJyYXJ5IGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVk
aXN0cmlidXRlIGl0IGFuZC9vcgorICAgIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhl
IEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKKyAgICBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0
aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIKKyAgICB2ZXJzaW9uIDIuMSBvZiB0
aGUgTGljZW5zZSwgb3IgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KKworICAg
IFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUg
dXNlZnVsLAorICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBp
bXBsaWVkIHdhcnJhbnR5IG9mCisgICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEg
UEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUKKyAgICBMZXNzZXIgR2VuZXJhbCBQdWJs
aWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgorCisgICAgWW91IHNob3VsZCBoYXZlIHJlY2Vp
dmVkIGEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYworICAgIExpY2Vuc2Ug
YWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcv
bGljZW5zZXMvPi4KKyovCisKKyNwcmFnbWEgb25jZQorCisjaW5jbHVkZSAidXNiLWJhY2tlbmQu
aCIKKwordHlwZWRlZiBzdHJ1Y3QgQ2RFbXVsYXRpb25QYXJhbXMgeworICAgIGNvbnN0IGNoYXIg
KmZpbGVuYW1lOworICAgIHVpbnQzMl90IGRlbGV0ZV9vbl9lamVjdCA6IDE7Cit9IENkRW11bGF0
aW9uUGFyYW1zOworCitnYm9vbGVhbgorY3JlYXRlX2VtdWxhdGVkX2NkKFNwaWNlVXNiQmFja2Vu
ZCAqYmUsCisgICAgICAgICAgICAgICAgICAgQ2RFbXVsYXRpb25QYXJhbXMgKnBhcmFtLAorICAg
ICAgICAgICAgICAgICAgIEdFcnJvciAqKmVycik7Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClNwaWNlLWRldmVsIG1haWxpbmcgbGlz
dApTcGljZS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9zcGljZS1kZXZlbA==
