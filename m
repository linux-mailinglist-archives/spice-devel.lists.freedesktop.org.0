Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C26C583560
	for <lists+spice-devel@lfdr.de>; Tue,  6 Aug 2019 17:35:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BBB596E3D2;
	Tue,  6 Aug 2019 15:35:03 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail-wm1-f50.google.com (mail-wm1-f50.google.com
 [209.85.128.50])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 34A9489D79
 for <spice-devel@lists.freedesktop.org>; Tue,  6 Aug 2019 15:35:02 +0000 (UTC)
Received: by mail-wm1-f50.google.com with SMTP id a15so78656149wmj.5
 for <spice-devel@lists.freedesktop.org>; Tue, 06 Aug 2019 08:35:02 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=Sdm1InZ6WJIV9wGO37W2Q1ePpEzFjik2hPNOGCxshOE=;
 b=oqwUVxHsEr7G/25gjK8u6Lj6iYv9iq48AXf0XbU2t+j6BJaI57S5Sq7AiKCrtDKPdS
 tHwL6nA012HFPicnpTW4+ZVo3SQL/X71sbaaNaY+CdccmBv7rdvlUtkOlOA1oEApNl0f
 0YYOeMo5Rj/C/5cPWj2Ys+guy0zhea/EyJ3chWSYY7jzb7ReFWqPo57YMtOG01FHBa5q
 eU9HnNAuFobqyj8qI1lsJEW9QOfyv/nX2m9eWZcheCOCMVu2x+lg+Sn6qiN8roKFVdRA
 EdoIFNPd9oHzL2A8oc2VmXGCbz1mPctxF14xONU3TH4e9eYoN+a7TY/hDmhwGwY8UrhS
 uLoA==
X-Gm-Message-State: APjAAAWDr4dKIERlr/b5/xkRZBt3OsU4542oQW51WmJgOvZYxTqObY4F
 TRacePxbjKwU5SLP3W26K3SSqQvP2VvsJg==
X-Google-Smtp-Source: APXvYqznwPZNPgihM4fktEJvPTpGBUPlZP9+doAD0xvFUdtCMAoqI/W6Swb2wQdL36CmtHssnkSwEw==
X-Received: by 2002:a1c:e457:: with SMTP id b84mr215082wmh.78.1565105700386;
 Tue, 06 Aug 2019 08:35:00 -0700 (PDT)
Received: from pinea.redhat.com (25.119.19.109.rev.sfr.net. [109.19.119.25])
 by smtp.gmail.com with ESMTPSA id y18sm84860282wmi.23.2019.08.06.08.34.59
 for <spice-devel@lists.freedesktop.org>
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Tue, 06 Aug 2019 08:34:59 -0700 (PDT)
From: Kevin Pouget <kpouget@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Tue,  6 Aug 2019 17:34:48 +0200
Message-Id: <20190806153453.20616-5-kpouget@redhat.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190806153453.20616-1-kpouget@redhat.com>
References: <20190806153453.20616-1-kpouget@redhat.com>
MIME-Version: 1.0
Subject: [Spice-devel] [RFC spice-streaming-agent 1/4] gst-plugin: allow the
 instantiation of multiple GST encoder plugins
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

V2l0aCB0aGlzIHBhdGNoLCBzcGljZS1zdHJlYW1pbmctYWdlbnQgY2FuIGJlIGxhdW5jaGVkIHdp
dGggbXVsdGlwbGUKR3N0cmVhbWVyIHZpZGVvIGNvZGVjcyBlbmFibGVkOgoKPiBzcGljZS1zdHJl
YW1pbmctYWdlbnQgLWMgZ3N0LmNvZGVjPXZwOCAtYyBnc3QuY29kZWM9dnA5IC4uLgoKU2lnbmVk
LW9mZi1ieTogS2V2aW4gUG91Z2V0IDxrcG91Z2V0QHJlZGhhdC5jb20+Ci0tLQogc3JjL2dzdC1w
bHVnaW4uY3BwIHwgNTAgKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0t
LS0tLQogMSBmaWxlIGNoYW5nZWQsIDMxIGluc2VydGlvbnMoKyksIDE5IGRlbGV0aW9ucygtKQoK
ZGlmZiAtLWdpdCBhL3NyYy9nc3QtcGx1Z2luLmNwcCBiL3NyYy9nc3QtcGx1Z2luLmNwcAppbmRl
eCA2NDE1YWMwLi41NDY5NjQ3IDEwMDY0NAotLS0gYS9zcmMvZ3N0LXBsdWdpbi5jcHAKKysrIGIv
c3JjL2dzdC1wbHVnaW4uY3BwCkBAIC0xMDIsNyArMTAyLDcgQEAgY2xhc3MgR3N0cmVhbWVyUGx1
Z2luIGZpbmFsOiBwdWJsaWMgUGx1Z2luCiBwdWJsaWM6CiAgICAgRnJhbWVDYXB0dXJlICpDcmVh
dGVDYXB0dXJlKCkgb3ZlcnJpZGU7CiAgICAgdW5zaWduZWQgUmFuaygpIG92ZXJyaWRlOwotICAg
IHZvaWQgUGFyc2VPcHRpb25zKGNvbnN0IENvbmZpZ3VyZU9wdGlvbiAqb3B0aW9ucyk7CisgICAg
dm9pZCBQYXJzZU9wdGlvbnMoY29uc3QgQ29uZmlndXJlT3B0aW9uICpvcHRpb25zLCBTcGljZVZp
ZGVvQ29kZWNUeXBlIGNvZGVjKTsKICAgICBTcGljZVZpZGVvQ29kZWNUeXBlIFZpZGVvQ29kZWNU
eXBlKCkgY29uc3Qgb3ZlcnJpZGUgewogICAgICAgICByZXR1cm4gc2V0dGluZ3MuY29kZWM7CiAg
ICAgfQpAQCAtNDMxLDggKzQzMSwxMCBAQCB1bnNpZ25lZCBHc3RyZWFtZXJQbHVnaW46OlJhbmso
KQogICAgIHJldHVybiBTb2Z0d2FyZU1pbjsKIH0KIAotdm9pZCBHc3RyZWFtZXJQbHVnaW46OlBh
cnNlT3B0aW9ucyhjb25zdCBDb25maWd1cmVPcHRpb24gKm9wdGlvbnMpCit2b2lkIEdzdHJlYW1l
clBsdWdpbjo6UGFyc2VPcHRpb25zKGNvbnN0IENvbmZpZ3VyZU9wdGlvbiAqb3B0aW9ucywgIFNw
aWNlVmlkZW9Db2RlY1R5cGUgY29kZWMpCiB7CisgICAgc2V0dGluZ3MuY29kZWMgPSBjb2RlYzsK
KwogICAgIGZvciAoOyBvcHRpb25zLT5uYW1lOyArK29wdGlvbnMpIHsKICAgICAgICAgY29uc3Qg
c3RkOjpzdHJpbmcgbmFtZSA9IG9wdGlvbnMtPm5hbWU7CiAgICAgICAgIGNvbnN0IHN0ZDo6c3Ry
aW5nIHZhbHVlID0gb3B0aW9ucy0+dmFsdWU7CkBAIC00NDMsMjAgKzQ0NSw2IEBAIHZvaWQgR3N0
cmVhbWVyUGx1Z2luOjpQYXJzZU9wdGlvbnMoY29uc3QgQ29uZmlndXJlT3B0aW9uICpvcHRpb25z
KQogICAgICAgICAgICAgfSBjYXRjaCAoY29uc3Qgc3RkOjpleGNlcHRpb24gJmUpIHsKICAgICAg
ICAgICAgICAgICB0aHJvdyBzdGQ6OnJ1bnRpbWVfZXJyb3IoIkludmFsaWQgdmFsdWUgJyIgKyB2
YWx1ZSArICInIGZvciBvcHRpb24gJ2ZyYW1lcmF0ZScuIik7CiAgICAgICAgICAgICB9Ci0gICAg
ICAgIH0gZWxzZSBpZiAobmFtZSA9PSAiZ3N0LmNvZGVjIikgewotICAgICAgICAgICAgaWYgKHZh
bHVlID09ICJoMjY0IikgewotICAgICAgICAgICAgICAgIHNldHRpbmdzLmNvZGVjID0gU1BJQ0Vf
VklERU9fQ09ERUNfVFlQRV9IMjY0OwotICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PSAi
dnA5IikgewotICAgICAgICAgICAgICAgIHNldHRpbmdzLmNvZGVjID0gU1BJQ0VfVklERU9fQ09E
RUNfVFlQRV9WUDk7Ci0gICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09ICJ2cDgiKSB7Ci0g
ICAgICAgICAgICAgICAgc2V0dGluZ3MuY29kZWMgPSBTUElDRV9WSURFT19DT0RFQ19UWVBFX1ZQ
ODsKLSAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT0gIm1qcGVnIikgewotICAgICAgICAg
ICAgICAgIHNldHRpbmdzLmNvZGVjID0gU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9NSlBFRzsKLSAg
ICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT0gImgyNjUiKSB7Ci0gICAgICAgICAgICAgICAg
c2V0dGluZ3MuY29kZWMgPSBTUElDRV9WSURFT19DT0RFQ19UWVBFX0gyNjU7Ci0gICAgICAgICAg
ICB9IGVsc2UgewotICAgICAgICAgICAgICAgIHRocm93IHN0ZDo6cnVudGltZV9lcnJvcigiSW52
YWxpZCB2YWx1ZSAnIiArIHZhbHVlICsgIicgZm9yIG9wdGlvbiAnZ3N0LmNvZGVjJy4iKTsKLSAg
ICAgICAgICAgIH0KICAgICAgICAgfSBlbHNlIGlmIChuYW1lID09ICJnc3QuZW5jb2RlciIpIHsK
ICAgICAgICAgICAgIHNldHRpbmdzLmVuY29kZXIgPSB2YWx1ZTsKICAgICAgICAgfSBlbHNlIGlm
IChuYW1lID09ICJnc3QucHJvcCIpIHsKQEAgLTQ3OCwxMSArNDY2LDM1IEBAIFNQSUNFX1NUUkVB
TUlOR19BR0VOVF9QTFVHSU4oYWdlbnQpCiB7CiAgICAgZ3N0X2luaXQobnVsbHB0ciwgbnVsbHB0
cik7CiAKLSAgICBhdXRvIHBsdWdpbiA9IHN0ZDo6bWFrZV9zaGFyZWQ8R3N0cmVhbWVyUGx1Z2lu
PigpOworICAgIGF1dG8gb3B0aW9ucyA9IGFnZW50LT5PcHRpb25zKCk7CisgICAgZm9yICg7IG9w
dGlvbnMtPm5hbWU7ICsrb3B0aW9ucykgeworICAgICAgICBjb25zdCBzdGQ6OnN0cmluZyBuYW1l
ID0gb3B0aW9ucy0+bmFtZTsKKyAgICAgICAgY29uc3Qgc3RkOjpzdHJpbmcgdmFsdWUgPSBvcHRp
b25zLT52YWx1ZTsKIAotICAgIHBsdWdpbi0+UGFyc2VPcHRpb25zKGFnZW50LT5PcHRpb25zKCkp
OworICAgICAgICBpZiAobmFtZSA9PSAiZ3N0LmNvZGVjIikgeworICAgICAgICAgICAgU3BpY2VW
aWRlb0NvZGVjVHlwZSBjb2RlY190eXBlOworICAgICAgICAgICAgaWYgKHZhbHVlID09ICJtanBl
ZyIpIHsKKyAgICAgICAgICAgICAgICBjb2RlY190eXBlID0gU1BJQ0VfVklERU9fQ09ERUNfVFlQ
RV9NSlBFRzsKKyAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT0gImgyNjQiKSB7CisgICAg
ICAgICAgICAgICAgY29kZWNfdHlwZSA9IFNQSUNFX1ZJREVPX0NPREVDX1RZUEVfSDI2NDsKKyAg
ICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT0gImgyNjUiKSB7CisgICAgICAgICAgICAgICAg
Y29kZWNfdHlwZSA9IFNQSUNFX1ZJREVPX0NPREVDX1RZUEVfSDI2NTsKKyAgICAgICAgICAgIH0g
ZWxzZSBpZiAodmFsdWUgPT0gInZwOCIpIHsKKyAgICAgICAgICAgICAgICBjb2RlY190eXBlID0g
U1BJQ0VfVklERU9fQ09ERUNfVFlQRV9WUDg7CisgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVl
ID09ICJ2cDkiKSB7CisgICAgICAgICAgICAgICAgY29kZWNfdHlwZSA9IFNQSUNFX1ZJREVPX0NP
REVDX1RZUEVfVlA5OworICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICB0aHJv
dyBzdGQ6OnJ1bnRpbWVfZXJyb3IoIkludmFsaWQgdmFsdWUgJyIgKyB2YWx1ZSArICInIGZvciBv
cHRpb24gJ2dzdC5jb2RlYycuIik7CisgICAgICAgICAgICB9CisKKyAgICAgICAgICAgIGF1dG8g
cGx1Z2luID0gc3RkOjptYWtlX3NoYXJlZDxHc3RyZWFtZXJQbHVnaW4+KCk7CisgICAgICAgICAg
ICBwbHVnaW4tPlBhcnNlT3B0aW9ucyhhZ2VudC0+T3B0aW9ucygpLCBjb2RlY190eXBlKTsKKyAg
ICAgICAgICAgIGFnZW50LT5SZWdpc3RlcihwbHVnaW4pOworICAgICAgICB9CisgICAgfQogCi0g
ICAgYWdlbnQtPlJlZ2lzdGVyKHBsdWdpbik7CisgICAgLy8gbm8gZGVmYXVsdCB2YWx1ZSBhdCB0
aGUgbW9tZW50CisgICAgLy8gKHVzZWQgdG8gYmUgaDI2NCwgc2VlIEdzdHJlYW1lckVuY29kZXJT
ZXR0aW5nczo6Y29kZWMpCiAKICAgICByZXR1cm4gdHJ1ZTsKIH0KLS0gCjIuMjEuMAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KU3BpY2UtZGV2ZWwgbWFp
bGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3Rz
LmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
