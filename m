Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4529432E86
	for <lists+spice-devel@lfdr.de>; Mon,  3 Jun 2019 13:22:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3DEB089226;
	Mon,  3 Jun 2019 11:22:21 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E7B9289226
 for <spice-devel@lists.freedesktop.org>; Mon,  3 Jun 2019 11:22:19 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx02.intmail.prod.int.phx2.redhat.com
 [10.5.11.12])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 64C133082B69
 for <spice-devel@lists.freedesktop.org>; Mon,  3 Jun 2019 11:22:19 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.4])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 29F9C60BFB;
 Mon,  3 Jun 2019 11:22:17 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Mon,  3 Jun 2019 12:22:12 +0100
Message-Id: <20190603112214.15093-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.12
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.45]); Mon, 03 Jun 2019 11:22:19 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-server 1/3] Use SPICE_CONTAINEROF to
 avoid some possible alignment warnings on MIPS
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

VGhpcyBwYXRjaCBjYW1lIGZyb20gc29tZSBleHBlcmltZW50cyB1c2luZyBhbiBlbXVsYXRlZCBN
SVBTIG1hY2hpbmUuCk9uIHN1Y2ggYXJjaGl0ZWN0dXJlIGR1ZSB0byBub3Qgc3VwcG9ydGluZyBh
bGlnbm1lbnQgYWNjZXNzIHRoZQpjb21waWxlciBpcyBtb3JlIHN0cmljdCBhYm91dCBjb252ZXJz
aW9uIGNvbXBsYWluaW5nIHdpdGggc29tZQpwb2ludGVyIGNhc3RzLiBVc2UgZGlmZmVyZW50IGNv
bnZlcnNpb24gdG8gYXZvaWQgdGhlc2Ugd2FybmluZ3MuCgpTaWduZWQtb2ZmLWJ5OiBGcmVkaWFu
byBaaWdsaW8gPGZ6aWdsaW9AcmVkaGF0LmNvbT4KLS0tCiBzZXJ2ZXIvY2FjaGUtaXRlbS50bXBs
LmMgfCAgMyArKy0KIHNlcnZlci9kY2MuYyAgICAgICAgICAgICB8ICA0ICsrLS0KIHNlcnZlci9p
bWFnZS1jYWNoZS5jICAgICB8ICA1ICsrKy0tCiBzZXJ2ZXIvaW1hZ2UtZW5jb2RlcnMuYyAgfCAy
NiArKysrKysrKysrKysrLS0tLS0tLS0tLS0tLQogc2VydmVyL21qcGVnLWVuY29kZXIuYyAgIHwg
MTIgKysrKysrLS0tLS0tCiBzZXJ2ZXIvcGl4bWFwLWNhY2hlLmMgICAgfCAgMiArLQogNiBmaWxl
cyBjaGFuZ2VkLCAyNyBpbnNlcnRpb25zKCspLCAyNSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQg
YS9zZXJ2ZXIvY2FjaGUtaXRlbS50bXBsLmMgYi9zZXJ2ZXIvY2FjaGUtaXRlbS50bXBsLmMKaW5k
ZXggZjExOWE5ZWU0Li44ZTE4ZjliMWIgMTAwNjQ0Ci0tLSBhL3NlcnZlci9jYWNoZS1pdGVtLnRt
cGwuYworKysgYi9zZXJ2ZXIvY2FjaGUtaXRlbS50bXBsLmMKQEAgLTg5LDcgKzg5LDggQEAgc3Rh
dGljIGludCBGVU5DX05BTUUoYWRkKShDSEFOTkVMQ0xJRU5UICpjaGFubmVsX2NsaWVudCwgdWlu
dDY0X3QgaWQsIHNpemVfdCBzaXoKICAgICBjaGFubmVsX2NsaWVudC0+cHJpdi0+VkFSX05BTUUo
YXZhaWxhYmxlKSAtPSBzaXplOwogICAgIFNQSUNFX1ZFUklGWShTUElDRV9PRkZTRVRPRihSZWRD
YWNoZUl0ZW0sIHUuY2FjaGVfZGF0YS5scnVfbGluaykgPT0gMCk7CiAgICAgd2hpbGUgKGNoYW5u
ZWxfY2xpZW50LT5wcml2LT5WQVJfTkFNRShhdmFpbGFibGUpIDwgMCkgewotICAgICAgICBSZWRD
YWNoZUl0ZW0gKnRhaWwgPSAoUmVkQ2FjaGVJdGVtICopcmluZ19nZXRfdGFpbCgmY2hhbm5lbF9j
bGllbnQtPnByaXYtPlZBUl9OQU1FKGxydSkpOworICAgICAgICBSZWRDYWNoZUl0ZW0gKnRhaWwg
PSBTUElDRV9DT05UQUlORVJPRihyaW5nX2dldF90YWlsKCZjaGFubmVsX2NsaWVudC0+cHJpdi0+
VkFSX05BTUUobHJ1KSksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgUmVkQ2FjaGVJdGVtLCB1LmNhY2hlX2RhdGEubHJ1X2xpbmsp
OwogICAgICAgICBpZiAoIXRhaWwpIHsKICAgICAgICAgICAgIGNoYW5uZWxfY2xpZW50LT5wcml2
LT5WQVJfTkFNRShhdmFpbGFibGUpICs9IHNpemU7CiAgICAgICAgICAgICBnX2ZyZWUoaXRlbSk7
CmRpZmYgLS1naXQgYS9zZXJ2ZXIvZGNjLmMgYi9zZXJ2ZXIvZGNjLmMKaW5kZXggYWNjMWNhMzhj
Li43MWQwOWI3N2YgMTAwNjQ0Ci0tLSBhL3NlcnZlci9kY2MuYworKysgYi9zZXJ2ZXIvZGNjLmMK
QEAgLTk2OCw4ICs5NjgsOCBAQCBib29sIGRjY19waXhtYXBfY2FjaGVfdW5sb2NrZWRfYWRkKERp
c3BsYXlDaGFubmVsQ2xpZW50ICpkY2MsIHVpbnQ2NF90IGlkLAogICAgICAgICBOZXdDYWNoZUl0
ZW0gKipub3c7CiAKICAgICAgICAgU1BJQ0VfVkVSSUZZKFNQSUNFX09GRlNFVE9GKE5ld0NhY2hl
SXRlbSwgbHJ1X2xpbmspID09IDApOwotICAgICAgICBpZiAoISh0YWlsID0gKE5ld0NhY2hlSXRl
bSAqKXJpbmdfZ2V0X3RhaWwoJmNhY2hlLT5scnUpKSB8fAotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFpbC0+c3luY1tkY2MtPnByaXYtPmlkXSA9
PSBzZXJpYWwpIHsKKyAgICAgICAgaWYgKCEodGFpbCA9IFNQSUNFX0NPTlRBSU5FUk9GKHJpbmdf
Z2V0X3RhaWwoJmNhY2hlLT5scnUpLCBOZXdDYWNoZUl0ZW0sIGxydV9saW5rKSkgfHwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFpbC0+c3lu
Y1tkY2MtPnByaXYtPmlkXSA9PSBzZXJpYWwpIHsKICAgICAgICAgICAgIGNhY2hlLT5hdmFpbGFi
bGUgKz0gc2l6ZTsKICAgICAgICAgICAgIGdfZnJlZShpdGVtKTsKICAgICAgICAgICAgIHJldHVy
biBGQUxTRTsKZGlmZiAtLWdpdCBhL3NlcnZlci9pbWFnZS1jYWNoZS5jIGIvc2VydmVyL2ltYWdl
LWNhY2hlLmMKaW5kZXggMmNhNGQ0YjY3Li40ODgxZjRkOTIgMTAwNjQ0Ci0tLSBhL3NlcnZlci9p
bWFnZS1jYWNoZS5jCisrKyBiL3NlcnZlci9pbWFnZS1jYWNoZS5jCkBAIC03OCw3ICs3OCw4IEBA
IHN0YXRpYyB2b2lkIGltYWdlX2NhY2hlX3B1dChTcGljZUltYWdlQ2FjaGUgKnNwaWNlX2NhY2hl
LCB1aW50NjRfdCBpZCwgcGl4bWFuX2ltCiAjaWZuZGVmIElNQUdFX0NBQ0hFX0FHRQogICAgIGlm
IChjYWNoZS0+bnVtX2l0ZW1zID09IElNQUdFX0NBQ0hFX01BWF9JVEVNUykgewogICAgICAgICBT
UElDRV9WRVJJRlkoU1BJQ0VfT0ZGU0VUT0YoSW1hZ2VDYWNoZUl0ZW0sIGxydV9saW5rKSA9PSAw
KTsKLSAgICAgICAgSW1hZ2VDYWNoZUl0ZW0gKnRhaWwgPSAoSW1hZ2VDYWNoZUl0ZW0gKilyaW5n
X2dldF90YWlsKCZjYWNoZS0+bHJ1KTsKKyAgICAgICAgSW1hZ2VDYWNoZUl0ZW0gKnRhaWwgPQor
ICAgICAgICAgICAgU1BJQ0VfQ09OVEFJTkVST0YocmluZ19nZXRfdGFpbCgmY2FjaGUtPmxydSks
IEltYWdlQ2FjaGVJdGVtLCBscnVfbGluayk7CiAgICAgICAgIHNwaWNlX2Fzc2VydCh0YWlsKTsK
ICAgICAgICAgaW1hZ2VfY2FjaGVfcmVtb3ZlKGNhY2hlLCB0YWlsKTsKICAgICB9CkBAIC0xMzMs
NyArMTM0LDcgQEAgdm9pZCBpbWFnZV9jYWNoZV9yZXNldChJbWFnZUNhY2hlICpjYWNoZSkKICAg
ICBJbWFnZUNhY2hlSXRlbSAqaXRlbTsKIAogICAgIFNQSUNFX1ZFUklGWShTUElDRV9PRkZTRVRP
RihJbWFnZUNhY2hlSXRlbSwgbHJ1X2xpbmspID09IDApOwotICAgIHdoaWxlICgoaXRlbSA9IChJ
bWFnZUNhY2hlSXRlbSAqKXJpbmdfZ2V0X2hlYWQoJmNhY2hlLT5scnUpKSkgeworICAgIHdoaWxl
ICgoaXRlbSA9IFNQSUNFX0NPTlRBSU5FUk9GKHJpbmdfZ2V0X2hlYWQoJmNhY2hlLT5scnUpLCBJ
bWFnZUNhY2hlSXRlbSwgbHJ1X2xpbmspKSkgewogICAgICAgICBpbWFnZV9jYWNoZV9yZW1vdmUo
Y2FjaGUsIGl0ZW0pOwogICAgIH0KICNpZmRlZiBJTUFHRV9DQUNIRV9BR0UKZGlmZiAtLWdpdCBh
L3NlcnZlci9pbWFnZS1lbmNvZGVycy5jIGIvc2VydmVyL2ltYWdlLWVuY29kZXJzLmMKaW5kZXgg
MzA2YzZkY2E2Li5kNGQ0ODZjMzYgMTAwNjQ0Ci0tLSBhL3NlcnZlci9pbWFnZS1lbmNvZGVycy5j
CisrKyBiL3NlcnZlci9pbWFnZS1lbmNvZGVycy5jCkBAIC04OSw3ICs4OSw3IEBAIHN0YXRpYyB2
b2lkIGltYWdlX2VuY29kZXJzX3JlbGVhc2VfZ2x6KEltYWdlRW5jb2RlcnMgKmVuYyk7CiBzdGF0
aWMgU1BJQ0VfR05VQ19OT1JFVFVSTiBTUElDRV9HTlVDX1BSSU5URigyLCAzKSB2b2lkCiBxdWlj
X3Vzcl9lcnJvcihRdWljVXNyQ29udGV4dCAqdXNyLCBjb25zdCBjaGFyICpmbXQsIC4uLikKIHsK
LSAgICBFbmNvZGVyRGF0YSAqdXNyX2RhdGEgPSAmKCgoUXVpY0RhdGEgKil1c3IpLT5kYXRhKTsK
KyAgICBFbmNvZGVyRGF0YSAqdXNyX2RhdGEgPSAmKFNQSUNFX0NPTlRBSU5FUk9GKHVzciwgUXVp
Y0RhdGEsIHVzciktPmRhdGEpOwogICAgIHZhX2xpc3QgYXA7CiAgICAgY2hhciBtZXNzYWdlX2J1
ZltFTkNPREVSX01FU1NBR0VfU0laRV07CiAKQEAgLTEwNCw3ICsxMDQsNyBAQCBxdWljX3Vzcl9l
cnJvcihRdWljVXNyQ29udGV4dCAqdXNyLCBjb25zdCBjaGFyICpmbXQsIC4uLikKIHN0YXRpYyBT
UElDRV9HTlVDX05PUkVUVVJOIFNQSUNFX0dOVUNfUFJJTlRGKDIsIDMpIHZvaWQKIGx6X3Vzcl9l
cnJvcihMelVzckNvbnRleHQgKnVzciwgY29uc3QgY2hhciAqZm10LCAuLi4pCiB7Ci0gICAgRW5j
b2RlckRhdGEgKnVzcl9kYXRhID0gJigoKEx6RGF0YSAqKXVzciktPmRhdGEpOworICAgIEVuY29k
ZXJEYXRhICp1c3JfZGF0YSA9ICYoU1BJQ0VfQ09OVEFJTkVST0YodXNyLCBMekRhdGEsIHVzcikt
PmRhdGEpOwogICAgIHZhX2xpc3QgYXA7CiAgICAgY2hhciBtZXNzYWdlX2J1ZltFTkNPREVSX01F
U1NBR0VfU0laRV07CiAKQEAgLTIzMywyNSArMjMzLDI1IEBAIHN0YXRpYyBpbnQgZW5jb2Rlcl91
c3JfbW9yZV9zcGFjZShFbmNvZGVyRGF0YSAqZW5jX2RhdGEsIHVpbnQ4X3QgKippb19wdHIpCiAK
IHN0YXRpYyBpbnQgcXVpY191c3JfbW9yZV9zcGFjZShRdWljVXNyQ29udGV4dCAqdXNyLCB1aW50
MzJfdCAqKmlvX3B0ciwgaW50IHJvd3NfY29tcGxldGVkKQogewotICAgIEVuY29kZXJEYXRhICp1
c3JfZGF0YSA9ICYoKChRdWljRGF0YSAqKXVzciktPmRhdGEpOworICAgIEVuY29kZXJEYXRhICp1
c3JfZGF0YSA9ICYoU1BJQ0VfQ09OVEFJTkVST0YodXNyLCBRdWljRGF0YSwgdXNyKS0+ZGF0YSk7
CiAgICAgcmV0dXJuIGVuY29kZXJfdXNyX21vcmVfc3BhY2UodXNyX2RhdGEsICh1aW50OF90ICoq
KWlvX3B0cikgLyBzaXplb2YodWludDMyX3QpOwogfQogCiBzdGF0aWMgaW50IGx6X3Vzcl9tb3Jl
X3NwYWNlKEx6VXNyQ29udGV4dCAqdXNyLCB1aW50OF90ICoqaW9fcHRyKQogewotICAgIEVuY29k
ZXJEYXRhICp1c3JfZGF0YSA9ICYoKChMekRhdGEgKil1c3IpLT5kYXRhKTsKKyAgICBFbmNvZGVy
RGF0YSAqdXNyX2RhdGEgPSAmKFNQSUNFX0NPTlRBSU5FUk9GKHVzciwgTHpEYXRhLCB1c3IpLT5k
YXRhKTsKICAgICByZXR1cm4gZW5jb2Rlcl91c3JfbW9yZV9zcGFjZSh1c3JfZGF0YSwgaW9fcHRy
KTsKIH0KIAogc3RhdGljIGludCBnbHpfdXNyX21vcmVfc3BhY2UoR2x6RW5jb2RlclVzckNvbnRl
eHQgKnVzciwgdWludDhfdCAqKmlvX3B0cikKIHsKLSAgICBFbmNvZGVyRGF0YSAqdXNyX2RhdGEg
PSAmKCgoR2x6RGF0YSAqKXVzciktPmRhdGEpOworICAgIEVuY29kZXJEYXRhICp1c3JfZGF0YSA9
ICYoU1BJQ0VfQ09OVEFJTkVST0YodXNyLCBHbHpEYXRhLCB1c3IpLT5kYXRhKTsKICAgICByZXR1
cm4gZW5jb2Rlcl91c3JfbW9yZV9zcGFjZSh1c3JfZGF0YSwgaW9fcHRyKTsKIH0KIAogc3RhdGlj
IGludCBqcGVnX3Vzcl9tb3JlX3NwYWNlKEpwZWdFbmNvZGVyVXNyQ29udGV4dCAqdXNyLCB1aW50
OF90ICoqaW9fcHRyKQogewotICAgIEVuY29kZXJEYXRhICp1c3JfZGF0YSA9ICYoKChKcGVnRGF0
YSAqKXVzciktPmRhdGEpOworICAgIEVuY29kZXJEYXRhICp1c3JfZGF0YSA9ICYoU1BJQ0VfQ09O
VEFJTkVST0YodXNyLCBKcGVnRGF0YSwgdXNyKS0+ZGF0YSk7CiAgICAgcmV0dXJuIGVuY29kZXJf
dXNyX21vcmVfc3BhY2UodXNyX2RhdGEsIGlvX3B0cik7CiB9CiAKQEAgLTI2NSw3ICsyNjUsNyBA
QCBzdGF0aWMgaW50IGx6NF91c3JfbW9yZV9zcGFjZShMejRFbmNvZGVyVXNyQ29udGV4dCAqdXNy
LCB1aW50OF90ICoqaW9fcHRyKQogCiBzdGF0aWMgaW50IHpsaWJfdXNyX21vcmVfc3BhY2UoWmxp
YkVuY29kZXJVc3JDb250ZXh0ICp1c3IsIHVpbnQ4X3QgKippb19wdHIpCiB7Ci0gICAgRW5jb2Rl
ckRhdGEgKnVzcl9kYXRhID0gJigoKFpsaWJEYXRhICopdXNyKS0+ZGF0YSk7CisgICAgRW5jb2Rl
ckRhdGEgKnVzcl9kYXRhID0gJihTUElDRV9DT05UQUlORVJPRih1c3IsIFpsaWJEYXRhLCB1c3Ip
LT5kYXRhKTsKICAgICByZXR1cm4gZW5jb2Rlcl91c3JfbW9yZV9zcGFjZSh1c3JfZGF0YSwgaW9f
cHRyKTsKIH0KIApAQCAtMzAxLDI1ICszMDEsMjUgQEAgc3RhdGljIGlubGluZSBpbnQgZW5jb2Rl
cl91c3JfbW9yZV9saW5lcyhFbmNvZGVyRGF0YSAqZW5jX2RhdGEsIHVpbnQ4X3QgKipsaW5lcykK
IAogc3RhdGljIGludCBxdWljX3Vzcl9tb3JlX2xpbmVzKFF1aWNVc3JDb250ZXh0ICp1c3IsIHVp
bnQ4X3QgKipsaW5lcykKIHsKLSAgICBFbmNvZGVyRGF0YSAqdXNyX2RhdGEgPSAmKCgoUXVpY0Rh
dGEgKil1c3IpLT5kYXRhKTsKKyAgICBFbmNvZGVyRGF0YSAqdXNyX2RhdGEgPSAmKFNQSUNFX0NP
TlRBSU5FUk9GKHVzciwgUXVpY0RhdGEsIHVzciktPmRhdGEpOwogICAgIHJldHVybiBlbmNvZGVy
X3Vzcl9tb3JlX2xpbmVzKHVzcl9kYXRhLCBsaW5lcyk7CiB9CiAKIHN0YXRpYyBpbnQgbHpfdXNy
X21vcmVfbGluZXMoTHpVc3JDb250ZXh0ICp1c3IsIHVpbnQ4X3QgKipsaW5lcykKIHsKLSAgICBF
bmNvZGVyRGF0YSAqdXNyX2RhdGEgPSAmKCgoTHpEYXRhICopdXNyKS0+ZGF0YSk7CisgICAgRW5j
b2RlckRhdGEgKnVzcl9kYXRhID0gJihTUElDRV9DT05UQUlORVJPRih1c3IsIEx6RGF0YSwgdXNy
KS0+ZGF0YSk7CiAgICAgcmV0dXJuIGVuY29kZXJfdXNyX21vcmVfbGluZXModXNyX2RhdGEsIGxp
bmVzKTsKIH0KIAogc3RhdGljIGludCBnbHpfdXNyX21vcmVfbGluZXMoR2x6RW5jb2RlclVzckNv
bnRleHQgKnVzciwgdWludDhfdCAqKmxpbmVzKQogewotICAgIEVuY29kZXJEYXRhICp1c3JfZGF0
YSA9ICYoKChHbHpEYXRhICopdXNyKS0+ZGF0YSk7CisgICAgRW5jb2RlckRhdGEgKnVzcl9kYXRh
ID0gJihTUElDRV9DT05UQUlORVJPRih1c3IsIEdsekRhdGEsIHVzciktPmRhdGEpOwogICAgIHJl
dHVybiBlbmNvZGVyX3Vzcl9tb3JlX2xpbmVzKHVzcl9kYXRhLCBsaW5lcyk7CiB9CiAKIHN0YXRp
YyBpbnQganBlZ191c3JfbW9yZV9saW5lcyhKcGVnRW5jb2RlclVzckNvbnRleHQgKnVzciwgdWlu
dDhfdCAqKmxpbmVzKQogewotICAgIEVuY29kZXJEYXRhICp1c3JfZGF0YSA9ICYoKChKcGVnRGF0
YSAqKXVzciktPmRhdGEpOworICAgIEVuY29kZXJEYXRhICp1c3JfZGF0YSA9ICYoU1BJQ0VfQ09O
VEFJTkVST0YodXNyLCBKcGVnRGF0YSwgdXNyKS0+ZGF0YSk7CiAgICAgcmV0dXJuIGVuY29kZXJf
dXNyX21vcmVfbGluZXModXNyX2RhdGEsIGxpbmVzKTsKIH0KIApAQCAtMzMzLDcgKzMzMyw3IEBA
IHN0YXRpYyBpbnQgbHo0X3Vzcl9tb3JlX2xpbmVzKEx6NEVuY29kZXJVc3JDb250ZXh0ICp1c3Is
IHVpbnQ4X3QgKipsaW5lcykKIAogc3RhdGljIGludCB6bGliX3Vzcl9tb3JlX2lucHV0KFpsaWJF
bmNvZGVyVXNyQ29udGV4dCAqdXNyLCB1aW50OF90KiogaW5wdXQpCiB7Ci0gICAgRW5jb2RlckRh
dGEgKnVzcl9kYXRhID0gJigoKFpsaWJEYXRhICopdXNyKS0+ZGF0YSk7CisgICAgRW5jb2RlckRh
dGEgKnVzcl9kYXRhID0gJihTUElDRV9DT05UQUlORVJPRih1c3IsIFpsaWJEYXRhLCB1c3IpLT5k
YXRhKTsKICAgICBpbnQgYnVmX3NpemU7CiAKICAgICBpZiAoIXVzcl9kYXRhLT51LmNvbXByZXNz
ZWRfZGF0YS5uZXh0KSB7CkBAIC0zODYsNyArMzg2LDcgQEAgc3RhdGljIHZvaWQgaW1hZ2VfZW5j
b2RlcnNfaW5pdF9seihJbWFnZUVuY29kZXJzICplbmMpCiAKIHN0YXRpYyB2b2lkIGdsel91c3Jf
ZnJlZV9pbWFnZShHbHpFbmNvZGVyVXNyQ29udGV4dCAqdXNyLCBHbHpVc3JJbWFnZUNvbnRleHQg
KmltYWdlKQogewotICAgIEdsekRhdGEgKmx6X2RhdGEgPSAoR2x6RGF0YSAqKXVzcjsKKyAgICBH
bHpEYXRhICpsel9kYXRhID0gU1BJQ0VfQ09OVEFJTkVST0YodXNyLCBHbHpEYXRhLCB1c3IpOwog
ICAgIEdsekRyYXdhYmxlSW5zdGFuY2VJdGVtICpnbHpfZHJhd2FibGVfaW5zdGFuY2UgPSAoR2x6
RHJhd2FibGVJbnN0YW5jZUl0ZW0gKilpbWFnZTsKICAgICBJbWFnZUVuY29kZXJzICpkcmF3YWJs
ZV9lbmMgPSBnbHpfZHJhd2FibGVfaW5zdGFuY2UtPmdsel9kcmF3YWJsZS0+ZW5jb2RlcnM7CiAg
ICAgSW1hZ2VFbmNvZGVycyAqdGhpc19lbmMgPSBTUElDRV9DT05UQUlORVJPRihsel9kYXRhLCBJ
bWFnZUVuY29kZXJzLCBnbHpfZGF0YSk7CmRpZmYgLS1naXQgYS9zZXJ2ZXIvbWpwZWctZW5jb2Rl
ci5jIGIvc2VydmVyL21qcGVnLWVuY29kZXIuYwppbmRleCA0YTAyZTdjOGIuLmU2MjlhZGFlNCAx
MDA2NDQKLS0tIGEvc2VydmVyL21qcGVnLWVuY29kZXIuYworKysgYi9zZXJ2ZXIvbWpwZWctZW5j
b2Rlci5jCkBAIC0yMDYsNyArMjA2LDcgQEAgc3RhdGljIE1KcGVnVmlkZW9CdWZmZXIqIGNyZWF0
ZV9tanBlZ192aWRlb19idWZmZXIodm9pZCkKIAogc3RhdGljIHZvaWQgbWpwZWdfZW5jb2Rlcl9k
ZXN0cm95KFZpZGVvRW5jb2RlciAqdmlkZW9fZW5jb2RlcikKIHsKLSAgICBNSnBlZ0VuY29kZXIg
KmVuY29kZXIgPSAoTUpwZWdFbmNvZGVyKil2aWRlb19lbmNvZGVyOworICAgIE1KcGVnRW5jb2Rl
ciAqZW5jb2RlciA9IFNQSUNFX0NPTlRBSU5FUk9GKHZpZGVvX2VuY29kZXIsIE1KcGVnRW5jb2Rl
ciwgYmFzZSk7CiAgICAgZ19mcmVlKGVuY29kZXItPmNpbmZvLmRlc3QpOwogICAgIGpwZWdfZGVz
dHJveV9jb21wcmVzcygmZW5jb2Rlci0+Y2luZm8pOwogICAgIGdfZnJlZShlbmNvZGVyLT5yb3cp
OwpAQCAtOTMxLDcgKzkzMSw3IEBAIHN0YXRpYyBpbnQgbWpwZWdfZW5jb2Rlcl9lbmNvZGVfZnJh
bWUoVmlkZW9FbmNvZGVyICp2aWRlb19lbmNvZGVyLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBncG9pbnRlciBiaXRtYXBfb3BhcXVlLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBWaWRlb0J1ZmZlciAqKm91dGJ1ZikKIHsKLSAgICBNSnBlZ0Vu
Y29kZXIgKmVuY29kZXIgPSAoTUpwZWdFbmNvZGVyKil2aWRlb19lbmNvZGVyOworICAgIE1KcGVn
RW5jb2RlciAqZW5jb2RlciA9IFNQSUNFX0NPTlRBSU5FUk9GKHZpZGVvX2VuY29kZXIsIE1KcGVn
RW5jb2RlciwgYmFzZSk7CiAgICAgTUpwZWdWaWRlb0J1ZmZlciAqYnVmZmVyID0gY3JlYXRlX21q
cGVnX3ZpZGVvX2J1ZmZlcigpOwogICAgIGlmICghYnVmZmVyKSB7CiAgICAgICAgIHJldHVybiBW
SURFT19FTkNPREVSX0ZSQU1FX1VOU1VQUE9SVEVEOwpAQCAtMTE5MSw3ICsxMTkxLDcgQEAgc3Rh
dGljIHZvaWQgbWpwZWdfZW5jb2Rlcl9jbGllbnRfc3RyZWFtX3JlcG9ydChWaWRlb0VuY29kZXIg
KnZpZGVvX2VuY29kZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGludDMyX3QgZW5kX2ZyYW1lX2RlbGF5LAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBhdWRpb19kZWxheSkKIHsKLSAgICBNSnBl
Z0VuY29kZXIgKmVuY29kZXIgPSAoTUpwZWdFbmNvZGVyKil2aWRlb19lbmNvZGVyOworICAgIE1K
cGVnRW5jb2RlciAqZW5jb2RlciA9IFNQSUNFX0NPTlRBSU5FUk9GKHZpZGVvX2VuY29kZXIsIE1K
cGVnRW5jb2RlciwgYmFzZSk7CiAgICAgTUpwZWdFbmNvZGVyUmF0ZUNvbnRyb2wgKnJhdGVfY29u
dHJvbCA9ICZlbmNvZGVyLT5yYXRlX2NvbnRyb2w7CiAgICAgTUpwZWdFbmNvZGVyQ2xpZW50U3Rh
dGUgKmNsaWVudF9zdGF0ZSA9ICZyYXRlX2NvbnRyb2wtPmNsaWVudF9zdGF0ZTsKICAgICB1aW50
NjRfdCBhdmdfZW5jX3NpemUgPSAwOwpAQCAtMTI4OSw3ICsxMjg5LDcgQEAgc3RhdGljIHZvaWQg
bWpwZWdfZW5jb2Rlcl9jbGllbnRfc3RyZWFtX3JlcG9ydChWaWRlb0VuY29kZXIgKnZpZGVvX2Vu
Y29kZXIsCiAKIHN0YXRpYyB2b2lkIG1qcGVnX2VuY29kZXJfbm90aWZ5X3NlcnZlcl9mcmFtZV9k
cm9wKFZpZGVvRW5jb2RlciAqdmlkZW9fZW5jb2RlcikKIHsKLSAgICBNSnBlZ0VuY29kZXIgKmVu
Y29kZXIgPSAoTUpwZWdFbmNvZGVyKil2aWRlb19lbmNvZGVyOworICAgIE1KcGVnRW5jb2RlciAq
ZW5jb2RlciA9IFNQSUNFX0NPTlRBSU5FUk9GKHZpZGVvX2VuY29kZXIsIE1KcGVnRW5jb2Rlciwg
YmFzZSk7CiAgICAgZW5jb2Rlci0+cmF0ZV9jb250cm9sLnNlcnZlcl9zdGF0ZS5udW1fZnJhbWVz
X2Ryb3BwZWQrKzsKICAgICBtanBlZ19lbmNvZGVyX3Byb2Nlc3Nfc2VydmVyX2Ryb3BzKGVuY29k
ZXIpOwogfQpAQCAtMTMyOCwxNCArMTMyOCwxNCBAQCBzdGF0aWMgdm9pZCBtanBlZ19lbmNvZGVy
X3Byb2Nlc3Nfc2VydmVyX2Ryb3BzKE1KcGVnRW5jb2RlciAqZW5jb2RlcikKIAogc3RhdGljIHVp
bnQ2NF90IG1qcGVnX2VuY29kZXJfZ2V0X2JpdF9yYXRlKFZpZGVvRW5jb2RlciAqdmlkZW9fZW5j
b2RlcikKIHsKLSAgICBNSnBlZ0VuY29kZXIgKmVuY29kZXIgPSAoTUpwZWdFbmNvZGVyKil2aWRl
b19lbmNvZGVyOworICAgIE1KcGVnRW5jb2RlciAqZW5jb2RlciA9IFNQSUNFX0NPTlRBSU5FUk9G
KHZpZGVvX2VuY29kZXIsIE1KcGVnRW5jb2RlciwgYmFzZSk7CiAgICAgcmV0dXJuIGVuY29kZXIt
PnJhdGVfY29udHJvbC5ieXRlX3JhdGUgKiA4OwogfQogCiBzdGF0aWMgdm9pZCBtanBlZ19lbmNv
ZGVyX2dldF9zdGF0cyhWaWRlb0VuY29kZXIgKnZpZGVvX2VuY29kZXIsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBWaWRlb0VuY29kZXJTdGF0cyAqc3RhdHMpCiB7Ci0gICAg
TUpwZWdFbmNvZGVyICplbmNvZGVyID0gKE1KcGVnRW5jb2RlciopdmlkZW9fZW5jb2RlcjsKKyAg
ICBNSnBlZ0VuY29kZXIgKmVuY29kZXIgPSBTUElDRV9DT05UQUlORVJPRih2aWRlb19lbmNvZGVy
LCBNSnBlZ0VuY29kZXIsIGJhc2UpOwogICAgIHNwaWNlX2Fzc2VydChlbmNvZGVyICE9IE5VTEwg
JiYgc3RhdHMgIT0gTlVMTCk7CiAgICAgc3RhdHMtPnN0YXJ0aW5nX2JpdF9yYXRlID0gZW5jb2Rl
ci0+c3RhcnRpbmdfYml0X3JhdGU7CiAgICAgc3RhdHMtPmN1cl9iaXRfcmF0ZSA9IG1qcGVnX2Vu
Y29kZXJfZ2V0X2JpdF9yYXRlKHZpZGVvX2VuY29kZXIpOwpkaWZmIC0tZ2l0IGEvc2VydmVyL3Bp
eG1hcC1jYWNoZS5jIGIvc2VydmVyL3BpeG1hcC1jYWNoZS5jCmluZGV4IDQ4OWZlMGJmNi4uNDk2
NTllYTQxIDEwMDY0NAotLS0gYS9zZXJ2ZXIvcGl4bWFwLWNhY2hlLmMKKysrIGIvc2VydmVyL3Bp
eG1hcC1jYWNoZS5jCkBAIC00NSw3ICs0NSw3IEBAIHZvaWQgcGl4bWFwX2NhY2hlX2NsZWFyKFBp
eG1hcENhY2hlICpjYWNoZSkKICAgICB9CiAKICAgICBTUElDRV9WRVJJRlkoU1BJQ0VfT0ZGU0VU
T0YoTmV3Q2FjaGVJdGVtLCBscnVfbGluaykgPT0gMCk7Ci0gICAgd2hpbGUgKChpdGVtID0gKE5l
d0NhY2hlSXRlbSAqKXJpbmdfZ2V0X2hlYWQoJmNhY2hlLT5scnUpKSkgeworICAgIHdoaWxlICgo
aXRlbSA9IFNQSUNFX0NPTlRBSU5FUk9GKHJpbmdfZ2V0X2hlYWQoJmNhY2hlLT5scnUpLCBOZXdD
YWNoZUl0ZW0sIGxydV9saW5rKSkpIHsKICAgICAgICAgcmluZ19yZW1vdmUoJml0ZW0tPmxydV9s
aW5rKTsKICAgICAgICAgZ19mcmVlKGl0ZW0pOwogICAgIH0KLS0gCjIuMjAuMQoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KU3BpY2UtZGV2ZWwgbWFpbGlu
ZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZy
ZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
