Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B5F2F6069B
	for <lists+spice-devel@lfdr.de>; Fri,  5 Jul 2019 15:31:50 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 41F526E4B7;
	Fri,  5 Jul 2019 13:31:49 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 562D16E4B7
 for <spice-devel@lists.freedesktop.org>; Fri,  5 Jul 2019 13:31:47 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx04.intmail.prod.int.phx2.redhat.com
 [10.5.11.14])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 03D64308FEC6
 for <spice-devel@lists.freedesktop.org>; Fri,  5 Jul 2019 13:31:47 +0000 (UTC)
Received: from colo-mx.corp.redhat.com
 (colo-mx02.intmail.prod.int.phx2.redhat.com [10.5.11.21])
 by smtp.corp.redhat.com (Postfix) with ESMTPS id EDE4517D18
 for <spice-devel@lists.freedesktop.org>; Fri,  5 Jul 2019 13:31:46 +0000 (UTC)
Received: from zmail25.collab.prod.int.phx2.redhat.com
 (zmail25.collab.prod.int.phx2.redhat.com [10.5.83.31])
 by colo-mx.corp.redhat.com (Postfix) with ESMTP id E665141F40
 for <spice-devel@lists.freedesktop.org>; Fri,  5 Jul 2019 13:31:46 +0000 (UTC)
Date: Fri, 5 Jul 2019 09:31:46 -0400 (EDT)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Message-ID: <818229891.26515613.1562333506894.JavaMail.zimbra@redhat.com>
In-Reply-To: <20190619155641.30143-1-fziglio@redhat.com>
References: <20190619155641.30143-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Originating-IP: [10.33.32.13, 10.4.195.2]
Thread-Topic: event loop: improve implementation of watches
Thread-Index: VuTY/R69Ce71Blu4stshOMHuU6Nx8g==
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.14
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.49]); Fri, 05 Jul 2019 13:31:47 +0000 (UTC)
Subject: Re: [Spice-devel] [PATCH spice-server] event loop: improve
 implementation of watches
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

cGluZwoKPiAKPiBBdm9pZCBoYXZpbmcgdG8gZGVzdHJveSBhbmQgY3JlYXRlIGEgbmV3IEdTb3Vy
Y2UgZXZlcnkgdGltZQo+IHdlIGNoYW5nZSBldmVudCBtYXNrLgo+IEludGVyZmFjZXMgcmVxdWly
ZWQgZm9yIHRoaXMgcGF0Y2ggYXJlIGF2YWlsYWJsZSBzaW5jZSBHTGliIDIuMzYuCj4gb24gV2lu
ZG93cyBHUG9sbEZEOjpmZCBjYW4gYmUgYW4gSEFORExFIGJ1dCBub3QgYSBzb2NrZXQuCj4gCj4g
U2lnbmVkLW9mZi1ieTogRnJlZGlhbm8gWmlnbGlvIDxmemlnbGlvQHJlZGhhdC5jb20+Cj4gLS0t
Cj4gIHNlcnZlci9ldmVudC1sb29wLmMgfCA5NyArKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKystLS0tLS0KPiAgMSBmaWxlIGNoYW5nZWQsIDg1IGluc2VydGlvbnMoKyksIDEy
IGRlbGV0aW9ucygtKQo+IAo+IGRpZmYgLS1naXQgYS9zZXJ2ZXIvZXZlbnQtbG9vcC5jIGIvc2Vy
dmVyL2V2ZW50LWxvb3AuYwo+IGluZGV4IDgwYWYyOTU0Zi4uMzNkYjRmZmIwIDEwMDY0NAo+IC0t
LSBhL3NlcnZlci9ldmVudC1sb29wLmMKPiArKysgYi9zZXJ2ZXIvZXZlbnQtbG9vcC5jCj4gQEAg
LTg1LDE0ICs4NSw2IEBAIHN0YXRpYyB2b2lkIHRpbWVyX3JlbW92ZShjb25zdCBTcGljZUNvcmVJ
bnRlcmZhY2VJbnRlcm5hbAo+ICppZmFjZSwKPiAgICAgIGdfZnJlZSh0aW1lcik7Cj4gIH0KPiAg
Cj4gLXN0cnVjdCBTcGljZVdhdGNoIHsKPiAtICAgIEdNYWluQ29udGV4dCAqY29udGV4dDsKPiAt
ICAgIHZvaWQgKm9wYXF1ZTsKPiAtICAgIEdTb3VyY2UgKnNvdXJjZTsKPiAtICAgIEdJT0NoYW5u
ZWwgKmNoYW5uZWw7Cj4gLSAgICBTcGljZVdhdGNoRnVuYyBmdW5jOwo+IC19Owo+IC0KPiAgc3Rh
dGljIEdJT0NvbmRpdGlvbiBzcGljZV9ldmVudF90b19naW9jb25kaXRpb24oaW50IGV2ZW50X21h
c2spCj4gIHsKPiAgICAgIEdJT0NvbmRpdGlvbiBjb25kaXRpb24gPSAwOwo+IEBAIC0xMTcsNiAr
MTA5LDE1IEBAIHN0YXRpYyBpbnQgZ2lvY29uZGl0aW9uX3RvX3NwaWNlX2V2ZW50KEdJT0NvbmRp
dGlvbgo+IGNvbmRpdGlvbikKPiAgICAgIHJldHVybiBldmVudDsKPiAgfQo+ICAKPiArI2lmZGVm
IF9XSU4zMgo+ICtzdHJ1Y3QgU3BpY2VXYXRjaCB7Cj4gKyAgICBHTWFpbkNvbnRleHQgKmNvbnRl
eHQ7Cj4gKyAgICB2b2lkICpvcGFxdWU7Cj4gKyAgICBHU291cmNlICpzb3VyY2U7Cj4gKyAgICBH
SU9DaGFubmVsICpjaGFubmVsOwo+ICsgICAgU3BpY2VXYXRjaEZ1bmMgZnVuYzsKPiArfTsKPiAr
Cj4gIHN0YXRpYyBnYm9vbGVhbiB3YXRjaF9mdW5jKEdJT0NoYW5uZWwgKnNvdXJjZSwgR0lPQ29u
ZGl0aW9uIGNvbmRpdGlvbiwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3BvaW50ZXIg
ZGF0YSkKPiAgewo+IEBAIC0xNjEsMTEgKzE2Miw3IEBAIHN0YXRpYyBTcGljZVdhdGNoICp3YXRj
aF9hZGQoY29uc3QKPiBTcGljZUNvcmVJbnRlcmZhY2VJbnRlcm5hbCAqaWZhY2UsCj4gIAo+ICAg
ICAgd2F0Y2ggPSBnX25ldzAoU3BpY2VXYXRjaCwgMSk7Cj4gICAgICB3YXRjaC0+Y29udGV4dCA9
IGlmYWNlLT5tYWluX2NvbnRleHQ7Cj4gLSNpZm5kZWYgX1dJTjMyCj4gLSAgICB3YXRjaC0+Y2hh
bm5lbCA9IGdfaW9fY2hhbm5lbF91bml4X25ldyhmZCk7Cj4gLSNlbHNlCj4gICAgICB3YXRjaC0+
Y2hhbm5lbCA9IGdfaW9fY2hhbm5lbF93aW4zMl9uZXdfc29ja2V0KGZkKTsKPiAtI2VuZGlmCj4g
ICAgICB3YXRjaC0+ZnVuYyA9IGZ1bmM7Cj4gICAgICB3YXRjaC0+b3BhcXVlID0gb3BhcXVlOwo+
ICAKPiBAQCAtMTg0LDYgKzE4MSw4MiBAQCBzdGF0aWMgdm9pZCB3YXRjaF9yZW1vdmUoY29uc3QK
PiBTcGljZUNvcmVJbnRlcmZhY2VJbnRlcm5hbCAqaWZhY2UsCj4gICAgICBnX2ZyZWUod2F0Y2gp
Owo+ICB9Cj4gIAo+ICsjZWxzZQo+ICsKPiArc3RydWN0IFNwaWNlV2F0Y2ggewo+ICsgICAgR1Nv
dXJjZSBzb3VyY2U7Cj4gKyAgICBHUG9sbEZEIHBvbGxmZDsKPiArfTsKPiArCj4gK3N0YXRpYyBn
Ym9vbGVhbgo+ICtzcGljZV93YXRjaF9jaGVjayhHU291cmNlICpzb3VyY2UpCj4gK3sKPiArICAg
IFNwaWNlV2F0Y2ggKndhdGNoID0gU1BJQ0VfQ09OVEFJTkVST0Yoc291cmNlLCBTcGljZVdhdGNo
LCBzb3VyY2UpOwo+ICsKPiArICAgIHJldHVybiB3YXRjaC0+cG9sbGZkLmV2ZW50cyAmIHdhdGNo
LT5wb2xsZmQucmV2ZW50czsKPiArfQo+ICsKPiArc3RhdGljIGdib29sZWFuCj4gK3NwaWNlX3dh
dGNoX2Rpc3BhdGNoKEdTb3VyY2UgICAgICpzb3VyY2UsCj4gKyAgICAgICAgICAgICAgICAgICAg
IEdTb3VyY2VGdW5jICBjYWxsYmFjaywKPiArICAgICAgICAgICAgICAgICAgICAgZ3BvaW50ZXIg
ICAgIHVzZXJfZGF0YSkKPiArewo+ICsgICAgU3BpY2VXYXRjaCAqd2F0Y2ggPSBTUElDRV9DT05U
QUlORVJPRihzb3VyY2UsIFNwaWNlV2F0Y2gsIHNvdXJjZSk7Cj4gKyAgICBTcGljZVdhdGNoRnVu
YyBmdW5jID0gKFNwaWNlV2F0Y2hGdW5jKSh2b2lkKikgY2FsbGJhY2s7Cj4gKwo+ICsgICAgZnVu
Yyh3YXRjaC0+cG9sbGZkLmZkLAo+IGdpb2NvbmRpdGlvbl90b19zcGljZV9ldmVudCh3YXRjaC0+
cG9sbGZkLnJldmVudHMpLCB1c2VyX2RhdGEpOwo+ICsgICAgLyogdGltZXIgbWlnaHQgYmUgZnJl
ZSBhZnRlciBmdW5jKCksIGRvbid0IHRvdWNoICovCj4gKwo+ICsgICAgcmV0dXJuIEdfU09VUkNF
X0NPTlRJTlVFOwo+ICt9Cj4gKwo+ICtzdGF0aWMgR1NvdXJjZUZ1bmNzIHNwaWNlX3dhdGNoX2Z1
bmNzID0gewo+ICsgICAgLmNoZWNrID0gc3BpY2Vfd2F0Y2hfY2hlY2ssCj4gKyAgICAuZGlzcGF0
Y2ggPSBzcGljZV93YXRjaF9kaXNwYXRjaCwKPiArfTsKPiArCj4gK3N0YXRpYyB2b2lkIHdhdGNo
X3VwZGF0ZV9tYXNrKGNvbnN0IFNwaWNlQ29yZUludGVyZmFjZUludGVybmFsICppZmFjZSwKPiAr
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VXYXRjaCAqd2F0Y2gsIGludCBldmVu
dF9tYXNrKQo+ICt7Cj4gKyAgICBHSU9Db25kaXRpb24gb2xkX2NvbmRpdGlvbiA9IHdhdGNoLT5w
b2xsZmQuZXZlbnRzOwo+ICsgICAgR0lPQ29uZGl0aW9uIG5ld19jb25kaXRpb24gPSBzcGljZV9l
dmVudF90b19naW9jb25kaXRpb24oZXZlbnRfbWFzayk7Cj4gKwo+ICsgICAgd2F0Y2gtPnBvbGxm
ZC5ldmVudHMgPSBuZXdfY29uZGl0aW9uOwo+ICsgICAgaWYgKG9sZF9jb25kaXRpb24gJiYgIW5l
d19jb25kaXRpb24pIHsKPiArICAgICAgICBnX3NvdXJjZV9yZW1vdmVfcG9sbCgmd2F0Y2gtPnNv
dXJjZSwgJndhdGNoLT5wb2xsZmQpOwo+ICsgICAgfSBlbHNlIGlmICghb2xkX2NvbmRpdGlvbiAm
JiBuZXdfY29uZGl0aW9uKSB7Cj4gKyAgICAgICAgZ19zb3VyY2VfYWRkX3BvbGwoJndhdGNoLT5z
b3VyY2UsICZ3YXRjaC0+cG9sbGZkKTsKPiArICAgIH0KPiArfQo+ICsKPiArc3RhdGljIFNwaWNl
V2F0Y2ggKndhdGNoX2FkZChjb25zdCBTcGljZUNvcmVJbnRlcmZhY2VJbnRlcm5hbCAqaWZhY2Us
Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGZkLCBpbnQgZXZlbnRfbWFzaywg
U3BpY2VXYXRjaEZ1bmMgZnVuYywKPiB2b2lkICpvcGFxdWUpCj4gK3sKPiArICAgIFNwaWNlV2F0
Y2ggKndhdGNoID0gKFNwaWNlV2F0Y2ggKikgZ19zb3VyY2VfbmV3KCZzcGljZV93YXRjaF9mdW5j
cywKPiBzaXplb2YoU3BpY2VXYXRjaCkpOwo+ICsKPiArICAgIHNwaWNlX3JldHVybl92YWxfaWZf
ZmFpbChmZCAhPSAtMSwgTlVMTCk7Cj4gKyAgICBzcGljZV9yZXR1cm5fdmFsX2lmX2ZhaWwoZnVu
YyAhPSBOVUxMLCBOVUxMKTsKPiArCj4gKyAgICB3YXRjaC0+cG9sbGZkLmZkID0gZmQ7Cj4gKyAg
ICB3YXRjaC0+cG9sbGZkLmV2ZW50cyA9IDA7Cj4gKwo+ICsgICAgZ19zb3VyY2Vfc2V0X2NhbGxi
YWNrKCZ3YXRjaC0+c291cmNlLAo+IChHU291cmNlRnVuYykodm9pZCopKFNwaWNlV2F0Y2hGdW5j
KSBmdW5jLCBvcGFxdWUsIE5VTEwpOwo+ICsKPiArICAgIGdfc291cmNlX2F0dGFjaCgmd2F0Y2gt
PnNvdXJjZSwgaWZhY2UtPm1haW5fY29udGV4dCk7Cj4gKwo+ICsgICAgd2F0Y2hfdXBkYXRlX21h
c2soaWZhY2UsIHdhdGNoLCBldmVudF9tYXNrKTsKPiArCj4gKyAgICByZXR1cm4gd2F0Y2g7Cj4g
K30KPiArCj4gK3N0YXRpYyB2b2lkIHdhdGNoX3JlbW92ZShjb25zdCBTcGljZUNvcmVJbnRlcmZh
Y2VJbnRlcm5hbCAqaWZhY2UsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZVdhdGNo
ICp3YXRjaCkKPiArewo+ICsgICAgZ19zb3VyY2VfZGVzdHJveSgmd2F0Y2gtPnNvdXJjZSk7Cj4g
KyAgICBnX3NvdXJjZV91bnJlZigmd2F0Y2gtPnNvdXJjZSk7Cj4gK30KPiArI2VuZGlmCj4gKwo+
ICBjb25zdCBTcGljZUNvcmVJbnRlcmZhY2VJbnRlcm5hbCBldmVudF9sb29wX2NvcmUgPSB7Cj4g
ICAgICAudGltZXJfYWRkID0gdGltZXJfYWRkLAo+ICAgICAgLnRpbWVyX3N0YXJ0ID0gdGltZXJf
c3RhcnQsCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClNw
aWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9zcGljZS1kZXZl
bA==
