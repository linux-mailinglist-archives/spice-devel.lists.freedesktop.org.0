Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 59AD1644A9
	for <lists+spice-devel@lfdr.de>; Wed, 10 Jul 2019 11:49:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CF4B8898FA;
	Wed, 10 Jul 2019 09:49:34 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 79885898FA
 for <spice-devel@lists.freedesktop.org>; Wed, 10 Jul 2019 09:49:32 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx03.intmail.prod.int.phx2.redhat.com
 [10.5.11.13])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 21E237F7AB;
 Wed, 10 Jul 2019 09:49:32 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.10])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 6321592D3B;
 Wed, 10 Jul 2019 09:49:30 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Wed, 10 Jul 2019 10:49:22 +0100
Message-Id: <20190710094924.17350-2-fziglio@redhat.com>
In-Reply-To: <20190710094924.17350-1-fziglio@redhat.com>
References: <20190710094924.17350-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.13
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.28]); Wed, 10 Jul 2019 09:49:32 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-gtk v3 1/3] usb-redir: isolate usage of
 libusb and usbredirhost
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogWXVyaSBCZW5kaXRvdmljaCA8eXVyaS5iZW5kaXRvdmljaEBkYXluaXguY29tPgoKQXMg
YSBzdGVwIHRvd2FyZCBwb3NzaWJpbGl0eSB0byBwcmVzZW50IGVtdWxhdGVkIFVTQiBkZXZpY2Vz
CnRvIHRoZSBndWVzdCwgd2UgcmVtb3ZlIHRoZSBrbm93bGVkZ2UgYWJvdXQgbGlidXNiIGFuZAp1
c2JyZWRpcmhvc3QgKHdoaWNoIGRlcGVuZHMgb24gbGlidXNiKSBmcm9tIGFsbCB0aGUgbW9kdWxl
cwphbmQgY29uY2VudHJhdGUgaXQgaW4gb25lICh1c2IgYmFja2VuZCkgd2hpY2ggcHJlc2VudHMK
YWJzdHJhY3QgVVNCIG9iamVjdHMgYW5kIGludGVybmFsIEFQSSB0byBhbGwgb3RoZXIgbW9kdWxl
cy4KSW50ZXJuYWwgQVBJIHByZXNlbnRzIGZvbGxvd2luZyB0eXBlcyBvZiBvYmplY3RzOgoqIFNw
aWNlVXNiQmFja2VuZDogc3VwcG9ydHMgZW51bWVyYXRpb24gb2YgbG9jYWwgVVNCIGRldmljZXMK
ICAoV2luZG93cyksIGhvdCBwbHVnL3VucGx1ZyBjYWxsYmFja3MgKExpbnV4KSBhbmQgZXZlbnRz
CiAgaGFuZGxpbmcuIEl0IHdyYXBzIGxpYnVzYl9jb250ZXh0CiogU3BpY2VVc2JCYWNrZW5kRGV2
aWNlOiByZXByZXNlbnQgbG9jYWwgVVNCIGRldmljZSwgcHJvdmlkZXMKICBhY2Nlc3MgdG8gY2Fj
aGVkIHByb3BlcnRpZXMgb2YgdGhlIGRldmljZSwgd3JhcHMgbGlidXNiX2RldmljZQoqIFNwaWNl
VXNiQmFja2VuZENoYW5uZWw6IGFjY3VtdWxhdGVzIHJlZGlyZWN0aW9uIGZ1bmN0aW9uYWxpdHks
CiAgd3JhcHMgdXNicmVkaXJob3N0CgpTaWduZWQtb2ZmLWJ5OiBZdXJpIEJlbmRpdG92aWNoIDx5
dXJpLmJlbmRpdG92aWNoQGRheW5peC5jb20+Ci0tLQogc3JjL2NoYW5uZWwtdXNicmVkaXItcHJp
di5oICAgfCAgMTIgKy0KIHNyYy9jaGFubmVsLXVzYnJlZGlyLmMgICAgICAgIHwgMjM2ICsrLS0t
LS0tLS0tLQogc3JjL21lc29uLmJ1aWxkICAgICAgICAgICAgICAgfCAgIDIgKwogc3JjL3VzYi1i
YWNrZW5kLmMgICAgICAgICAgICAgfCA2NTcgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKwogc3JjL3VzYi1iYWNrZW5kLmggICAgICAgICAgICAgfCAxMDIgKysrKysrCiBzcmMvdXNi
LWRldmljZS1tYW5hZ2VyLXByaXYuaCB8ICAgMSAtCiBzcmMvdXNiLWRldmljZS1tYW5hZ2VyLmMg
ICAgICB8IDMzNiArKysrKystLS0tLS0tLS0tLQogc3JjL3dpbi11c2ItZGV2LmMgICAgICAgICAg
ICAgfCAxMDMgKystLS0tCiBzcmMvd2luLXVzYi1kZXYuaCAgICAgICAgICAgICB8ICAgNSArLQog
OSBmaWxlcyBjaGFuZ2VkLCA5NDYgaW5zZXJ0aW9ucygrKSwgNTA4IGRlbGV0aW9ucygtKQogY3Jl
YXRlIG1vZGUgMTAwNjQ0IHNyYy91c2ItYmFja2VuZC5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgc3Jj
L3VzYi1iYWNrZW5kLmgKCmRpZmYgLS1naXQgYS9zcmMvY2hhbm5lbC11c2JyZWRpci1wcml2Lmgg
Yi9zcmMvY2hhbm5lbC11c2JyZWRpci1wcml2LmgKaW5kZXggMWVhOGExOTYuLjgwY2QzMWY2IDEw
MDY0NAotLS0gYS9zcmMvY2hhbm5lbC11c2JyZWRpci1wcml2LmgKKysrIGIvc3JjL2NoYW5uZWwt
dXNicmVkaXItcHJpdi5oCkBAIC0yMyw5ICsyMyw4IEBACiAKICNpZmRlZiBVU0VfVVNCUkVESVIK
IAotI2luY2x1ZGUgPGxpYnVzYi5oPgotI2luY2x1ZGUgPHVzYnJlZGlyZmlsdGVyLmg+CiAjaW5j
bHVkZSAic3BpY2UtY2xpZW50LmgiCisjaW5jbHVkZSAidXNiLWJhY2tlbmQuaCIKIAogR19CRUdJ
Tl9ERUNMUwogCkBAIC0zMyw3ICszMiw3IEBAIEdfQkVHSU5fREVDTFMKICAgIGNvbnRleHQgc2hv
dWxkIG5vdCBiZSBkZXN0cm95ZWQgYmVmb3JlIHRoZSBsYXN0IGRldmljZSBoYXMgYmVlbgogICAg
ZGlzY29ubmVjdGVkICovCiB2b2lkIHNwaWNlX3VzYnJlZGlyX2NoYW5uZWxfc2V0X2NvbnRleHQo
U3BpY2VVc2JyZWRpckNoYW5uZWwgKmNoYW5uZWwsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgbGlidXNiX2NvbnRleHQgICAgICAgKmNvbnRleHQpOworICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNlVXNiQmFja2VuZCAgICAgICpjb250
ZXh0KTsKIAogdm9pZCBzcGljZV91c2JyZWRpcl9jaGFubmVsX2Rpc2Nvbm5lY3RfZGV2aWNlX2Fz
eW5jKFNwaWNlVXNicmVkaXJDaGFubmVsICpjaGFubmVsLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdDYW5jZWxsYWJsZSAqY2FuY2VsbGFibGUs
CkBAIC00OCw3ICs0Nyw3IEBAIGdib29sZWFuIHNwaWNlX3VzYnJlZGlyX2NoYW5uZWxfZGlzY29u
bmVjdF9kZXZpY2VfZmluaXNoKFNwaWNlVXNicmVkaXJDaGFubmVsICpjCiAgICAodGhyb3VnaCBz
cGljZV9jaGFubmVsX2Nvbm5lY3QoKSksIGJlZm9yZSBjYWxsaW5nIHRoaXMuICovCiB2b2lkIHNw
aWNlX3VzYnJlZGlyX2NoYW5uZWxfY29ubmVjdF9kZXZpY2VfYXN5bmMoCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VVc2JyZWRpckNoYW5uZWwgKmNoYW5uZWws
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlidXNiX2RldmljZSAg
ICAgICAgKmRldmljZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBT
cGljZVVzYkJhY2tlbmREZXZpY2UgKmRldmljZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBTcGljZVVzYkRldmljZSAgICAgICAqc3BpY2VfZGV2aWNlLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdDYW5jZWxsYWJsZSAgICAgICAgICpj
YW5jZWxsYWJsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHQXN5
bmNSZWFkeUNhbGxiYWNrICAgY2FsbGJhY2ssCkBAIC02MCw3ICs1OSw3IEBAIGdib29sZWFuIHNw
aWNlX3VzYnJlZGlyX2NoYW5uZWxfY29ubmVjdF9kZXZpY2VfZmluaXNoKAogCiB2b2lkIHNwaWNl
X3VzYnJlZGlyX2NoYW5uZWxfZGlzY29ubmVjdF9kZXZpY2UoU3BpY2VVc2JyZWRpckNoYW5uZWwg
KmNoYW5uZWwpOwogCi1saWJ1c2JfZGV2aWNlICpzcGljZV91c2JyZWRpcl9jaGFubmVsX2dldF9k
ZXZpY2UoU3BpY2VVc2JyZWRpckNoYW5uZWwgKmNoYW5uZWwpOworU3BpY2VVc2JCYWNrZW5kRGV2
aWNlICpzcGljZV91c2JyZWRpcl9jaGFubmVsX2dldF9kZXZpY2UoU3BpY2VVc2JyZWRpckNoYW5u
ZWwgKmNoYW5uZWwpOwogCiB2b2lkIHNwaWNlX3VzYnJlZGlyX2NoYW5uZWxfbG9jayhTcGljZVVz
YnJlZGlyQ2hhbm5lbCAqY2hhbm5lbCk7CiAKQEAgLTcxLDYgKzcwLDkgQEAgdm9pZCBzcGljZV91
c2JyZWRpcl9jaGFubmVsX2dldF9ndWVzdF9maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGNvbnN0IHN0cnVjdCB1c2JyZWRpcmZpbHRlcl9ydWxlICAqKnJ1bGVzX3JldCwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgaW50ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAq
cnVsZXNfY291bnRfcmV0KTsKIAorLyogQ2FsbGJhY2sgZm9yIFVTQiBiYWNrZW5kICovCitpbnQg
c3BpY2VfdXNicmVkaXJfd3JpdGVfY2FsbGJhY2soU3BpY2VVc2JyZWRpckNoYW5uZWwgKmNoYW5u
ZWwsIHVpbnQ4X3QgKmRhdGEsIGludCBjb3VudCk7CisKIEdfRU5EX0RFQ0xTCiAKICNlbmRpZiAv
KiBVU0VfVVNCUkVESVIgKi8KZGlmZiAtLWdpdCBhL3NyYy9jaGFubmVsLXVzYnJlZGlyLmMgYi9z
cmMvY2hhbm5lbC11c2JyZWRpci5jCmluZGV4IGE1NGY2N2I3Li43NjUzNDE4MCAxMDA2NDQKLS0t
IGEvc3JjL2NoYW5uZWwtdXNicmVkaXIuYworKysgYi9zcmMvY2hhbm5lbC11c2JyZWRpci5jCkBA
IC0yMyw3ICsyMyw2IEBACiAKICNpZmRlZiBVU0VfVVNCUkVESVIKICNpbmNsdWRlIDxnbGliL2dp
MThuLWxpYi5oPgotI2luY2x1ZGUgPHVzYnJlZGlyaG9zdC5oPgogI2lmZGVmIFVTRV9MWjQKICNp
bmNsdWRlIDxsejQuaD4KICNlbmRpZgpAQCAtNjMsMTUgKzYyLDEwIEBAIGVudW0gU3BpY2VVc2Jy
ZWRpckNoYW5uZWxTdGF0ZSB7CiB9OwogCiBzdHJ1Y3QgX1NwaWNlVXNicmVkaXJDaGFubmVsUHJp
dmF0ZSB7Ci0gICAgbGlidXNiX2RldmljZSAqZGV2aWNlOworICAgIFNwaWNlVXNiQmFja2VuZERl
dmljZSAqZGV2aWNlOwogICAgIFNwaWNlVXNiRGV2aWNlICpzcGljZV9kZXZpY2U7Ci0gICAgbGli
dXNiX2NvbnRleHQgKmNvbnRleHQ7Ci0gICAgc3RydWN0IHVzYnJlZGlyaG9zdCAqaG9zdDsKLSAg
ICAvKiBUbyBjYXRjaCB1c2JyZWRpcmhvc3QgZXJyb3IgbWVzc2FnZXMgYW5kIHJlcG9ydCB0aGVt
IGFzIGEgR0Vycm9yICovCi0gICAgR0Vycm9yICoqY2F0Y2hfZXJyb3I7Ci0gICAgLyogRGF0YSBw
YXNzZWQgZnJvbSBjaGFubmVsIGhhbmRsZSBtc2cgdG8gdGhlIHVzYnJlZGlyaG9zdCByZWFkIGNi
ICovCi0gICAgY29uc3QgdWludDhfdCAqcmVhZF9idWY7Ci0gICAgaW50IHJlYWRfYnVmX3NpemU7
CisgICAgU3BpY2VVc2JCYWNrZW5kICpjb250ZXh0OworICAgIFNwaWNlVXNiQmFja2VuZENoYW5u
ZWwgKmhvc3Q7CiAgICAgZW51bSBTcGljZVVzYnJlZGlyQ2hhbm5lbFN0YXRlIHN0YXRlOwogI2lm
ZGVmIFVTRV9QT0xLSVQKICAgICBHVGFzayAqdGFzazsKQEAgLTg3LDE2ICs4MSw2IEBAIHN0YXRp
YyB2b2lkIHNwaWNlX3VzYnJlZGlyX2NoYW5uZWxfZGlzcG9zZShHT2JqZWN0ICpvYmopOwogc3Rh
dGljIHZvaWQgc3BpY2VfdXNicmVkaXJfY2hhbm5lbF9maW5hbGl6ZShHT2JqZWN0ICpvYmopOwog
c3RhdGljIHZvaWQgdXNicmVkaXJfaGFuZGxlX21zZyhTcGljZUNoYW5uZWwgKmNoYW5uZWwsIFNw
aWNlTXNnSW4gKmluKTsKIAotc3RhdGljIHZvaWQgdXNicmVkaXJfbG9nKHZvaWQgKnVzZXJfZGF0
YSwgaW50IGxldmVsLCBjb25zdCBjaGFyICptc2cpOwotc3RhdGljIGludCB1c2JyZWRpcl9yZWFk
X2NhbGxiYWNrKHZvaWQgKnVzZXJfZGF0YSwgdWludDhfdCAqZGF0YSwgaW50IGNvdW50KTsKLXN0
YXRpYyBpbnQgdXNicmVkaXJfd3JpdGVfY2FsbGJhY2sodm9pZCAqdXNlcl9kYXRhLCB1aW50OF90
ICpkYXRhLCBpbnQgY291bnQpOwotc3RhdGljIHZvaWQgdXNicmVkaXJfd3JpdGVfZmx1c2hfY2Fs
bGJhY2sodm9pZCAqdXNlcl9kYXRhKTsKLXN0YXRpYyB1aW50NjRfdCB1c2JyZWRpcl9idWZmZXJl
ZF9vdXRwdXRfc2l6ZV9jYWxsYmFjayh2b2lkICp1c2VyX2RhdGEpOwotCi1zdGF0aWMgdm9pZCAq
dXNicmVkaXJfYWxsb2NfbG9jayh2b2lkKTsKLXN0YXRpYyB2b2lkIHVzYnJlZGlyX2xvY2tfbG9j
ayh2b2lkICp1c2VyX2RhdGEpOwotc3RhdGljIHZvaWQgdXNicmVkaXJfdW5sb2NrX2xvY2sodm9p
ZCAqdXNlcl9kYXRhKTsKLXN0YXRpYyB2b2lkIHVzYnJlZGlyX2ZyZWVfbG9jayh2b2lkICp1c2Vy
X2RhdGEpOwogCiBHX0RFRklORV9UWVBFX1dJVEhfUFJJVkFURShTcGljZVVzYnJlZGlyQ2hhbm5l
bCwgc3BpY2VfdXNicmVkaXJfY2hhbm5lbCwgU1BJQ0VfVFlQRV9DSEFOTkVMKQogCkBAIC0xMTUs
NyArOTksNyBAQCBzdGF0aWMgdm9pZCBfY2hhbm5lbF9yZXNldF9maW5pc2goU3BpY2VVc2JyZWRp
ckNoYW5uZWwgKmNoYW5uZWwsIGdib29sZWFuIG1pZ3JhdAogCiAgICAgc3BpY2VfdXNicmVkaXJf
Y2hhbm5lbF9sb2NrKGNoYW5uZWwpOwogCi0gICAgdXNicmVkaXJob3N0X2Nsb3NlKHByaXYtPmhv
c3QpOworICAgIHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfZGVsZXRlKHByaXYtPmhvc3QpOwog
ICAgIHByaXYtPmhvc3QgPSBOVUxMOwogCiAgICAgLyogQ2FsbCBzZXRfY29udGV4dCB0byByZS1j
cmVhdGUgdGhlIGhvc3QgKi8KQEAgLTIyMSw3ICsyMDUsNyBAQCBzdGF0aWMgdm9pZCBzcGljZV91
c2JyZWRpcl9jaGFubmVsX2ZpbmFsaXplKEdPYmplY3QgKm9iaikKICAgICBTcGljZVVzYnJlZGly
Q2hhbm5lbCAqY2hhbm5lbCA9IFNQSUNFX1VTQlJFRElSX0NIQU5ORUwob2JqKTsKIAogICAgIGlm
IChjaGFubmVsLT5wcml2LT5ob3N0KQotICAgICAgICB1c2JyZWRpcmhvc3RfY2xvc2UoY2hhbm5l
bC0+cHJpdi0+aG9zdCk7CisgICAgICAgIHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfZGVsZXRl
KGNoYW5uZWwtPnByaXYtPmhvc3QpOwogICAgIGdfbXV0ZXhfY2xlYXIoJmNoYW5uZWwtPnByaXYt
PmRldmljZV9jb25uZWN0X211dGV4KTsKIAogICAgIC8qIENoYWluIHVwIHRvIHRoZSBwYXJlbnQg
Y2xhc3MgKi8KQEAgLTI0NCwzMCArMjI4LDE3IEBAIHN0YXRpYyB2b2lkIGNoYW5uZWxfc2V0X2hh
bmRsZXJzKFNwaWNlQ2hhbm5lbENsYXNzICprbGFzcykKIAogR19HTlVDX0lOVEVSTkFMCiB2b2lk
IHNwaWNlX3VzYnJlZGlyX2NoYW5uZWxfc2V0X2NvbnRleHQoU3BpY2VVc2JyZWRpckNoYW5uZWwg
KmNoYW5uZWwsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlidXNi
X2NvbnRleHQgICAgICAgKmNvbnRleHQpCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgU3BpY2VVc2JCYWNrZW5kICAgICAgKmNvbnRleHQpCiB7CiAgICAgU3BpY2VVc2Jy
ZWRpckNoYW5uZWxQcml2YXRlICpwcml2ID0gY2hhbm5lbC0+cHJpdjsKIAogICAgIGdfcmV0dXJu
X2lmX2ZhaWwocHJpdi0+aG9zdCA9PSBOVUxMKTsKIAogICAgIHByaXYtPmNvbnRleHQgPSBjb250
ZXh0OwotICAgIHByaXYtPmhvc3QgPSB1c2JyZWRpcmhvc3Rfb3Blbl9mdWxsKAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LCBOVUxMLAotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB1c2JyZWRpcl9sb2csCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHVzYnJlZGlyX3JlYWRfY2FsbGJhY2ssCi0gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHVzYnJlZGlyX3dyaXRlX2NhbGxiYWNrLAotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB1c2JyZWRpcl93cml0ZV9mbHVzaF9jYWxsYmFjaywKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNicmVkaXJfYWxsb2NfbG9jaywKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNicmVkaXJfbG9ja19sb2NrLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2JyZWRpcl91bmxvY2tfbG9jaywKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNicmVkaXJfZnJlZV9sb2NrLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVsLCBQQUNLQUdFX1NUUklORywKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BpY2VfdXRpbF9nZXRfZGVidWcoKSA/
IHVzYnJlZGlycGFyc2VyX2RlYnVnIDogdXNicmVkaXJwYXJzZXJfd2FybmluZywKLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNicmVkaXJob3N0X2ZsX3dyaXRlX2NiX293bnNf
YnVmZmVyKTsKKyAgICBwcml2LT5ob3N0ID0gc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9uZXco
Y29udGV4dCwgY2hhbm5lbCk7CiAgICAgaWYgKCFwcml2LT5ob3N0KQotICAgICAgICBnX2Vycm9y
KCJPdXQgb2YgbWVtb3J5IGFsbG9jYXRpbmcgdXNicmVkaXJob3N0Iik7CisgICAgICAgIGdfZXJy
b3IoIk91dCBvZiBtZW1vcnkgaW5pdGlhbGl6aW5nIHJlZGlyZWN0aW9uIHN1cHBvcnQiKTsKIAot
ICAgIHVzYnJlZGlyaG9zdF9zZXRfYnVmZmVyZWRfb3V0cHV0X3NpemVfY2IocHJpdi0+aG9zdCwg
dXNicmVkaXJfYnVmZmVyZWRfb3V0cHV0X3NpemVfY2FsbGJhY2spOwogI2lmZGVmIFVTRV9MWjQK
ICAgICBzcGljZV9jaGFubmVsX3NldF9jYXBhYmlsaXR5KGNoYW5uZWwsIFNQSUNFX1NQSUNFVk1D
X0NBUF9EQVRBX0NPTVBSRVNTX0xaNCk7CiAjZW5kaWYKQEAgLTI3OCw4ICsyNDksNiBAQCBzdGF0
aWMgZ2Jvb2xlYW4gc3BpY2VfdXNicmVkaXJfY2hhbm5lbF9vcGVuX2RldmljZSgKIHsKICAgICBT
cGljZVVzYnJlZGlyQ2hhbm5lbFByaXZhdGUgKnByaXYgPSBjaGFubmVsLT5wcml2OwogICAgIFNw
aWNlU2Vzc2lvbiAqc2Vzc2lvbjsKLSAgICBsaWJ1c2JfZGV2aWNlX2hhbmRsZSAqaGFuZGxlID0g
TlVMTDsKLSAgICBpbnQgcmMsIHN0YXR1czsKICAgICBTcGljZVVzYkRldmljZU1hbmFnZXIgKm1h
bmFnZXI7CiAKICAgICBnX3JldHVybl92YWxfaWZfZmFpbChwcml2LT5zdGF0ZSA9PSBTVEFURV9E
SVNDT05ORUNURUQKQEAgLTI4OCwxOSArMjU3LDExIEBAIHN0YXRpYyBnYm9vbGVhbiBzcGljZV91
c2JyZWRpcl9jaGFubmVsX29wZW5fZGV2aWNlKAogI2VuZGlmCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgLCBGQUxTRSk7CiAKLSAgICByYyA9IGxpYnVzYl9vcGVuKHByaXYtPmRldmljZSwgJmhh
bmRsZSk7Ci0gICAgaWYgKHJjICE9IDApIHsKLSAgICAgICAgZ19zZXRfZXJyb3IoZXJyLCBTUElD
RV9DTElFTlRfRVJST1IsIFNQSUNFX0NMSUVOVF9FUlJPUl9GQUlMRUQsCi0gICAgICAgICAgICAg
ICAgICAgICJDb3VsZCBub3Qgb3BlbiB1c2IgZGV2aWNlOiAlcyBbJWldIiwKLSAgICAgICAgICAg
ICAgICAgICAgbGlidXNiX3N0cmVycm9yKHJjKSwgcmMpOwotICAgICAgICByZXR1cm4gRkFMU0U7
Ci0gICAgfQotCi0gICAgcHJpdi0+Y2F0Y2hfZXJyb3IgPSBlcnI7Ci0gICAgc3RhdHVzID0gdXNi
cmVkaXJob3N0X3NldF9kZXZpY2UocHJpdi0+aG9zdCwgaGFuZGxlKTsKLSAgICBwcml2LT5jYXRj
aF9lcnJvciA9IE5VTEw7Ci0gICAgaWYgKHN0YXR1cyAhPSB1c2JfcmVkaXJfc3VjY2Vzcykgewot
ICAgICAgICBnX3JldHVybl92YWxfaWZfZmFpbChlcnIgPT0gTlVMTCB8fCAqZXJyICE9IE5VTEws
IEZBTFNFKTsKKyAgICBpZiAoIXNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfYXR0YWNoKHByaXYt
Pmhvc3QsIHByaXYtPmRldmljZSwgZXJyKSkgeworICAgICAgICBpZiAoKmVyciA9PSBOVUxMKSB7
CisgICAgICAgICAgICBnX3NldF9lcnJvcihlcnIsIFNQSUNFX0NMSUVOVF9FUlJPUiwgU1BJQ0Vf
Q0xJRU5UX0VSUk9SX0ZBSUxFRCwKKyAgICAgICAgICAgICAgICAiRXJyb3IgYXR0YWNoaW5nIGRl
dmljZTogKG5vIGVycm9yIGluZm9ybWF0aW9uKSIpOworICAgICAgICB9CiAgICAgICAgIHJldHVy
biBGQUxTRTsKICAgICB9CiAKQEAgLTMxMCw3ICsyNzEsNyBAQCBzdGF0aWMgZ2Jvb2xlYW4gc3Bp
Y2VfdXNicmVkaXJfY2hhbm5lbF9vcGVuX2RldmljZSgKIAogICAgIHByaXYtPnVzYl9kZXZpY2Vf
bWFuYWdlciA9IGdfb2JqZWN0X3JlZihtYW5hZ2VyKTsKICAgICBpZiAoIXNwaWNlX3VzYl9kZXZp
Y2VfbWFuYWdlcl9zdGFydF9ldmVudF9saXN0ZW5pbmcocHJpdi0+dXNiX2RldmljZV9tYW5hZ2Vy
LCBlcnIpKSB7Ci0gICAgICAgIHVzYnJlZGlyaG9zdF9zZXRfZGV2aWNlKHByaXYtPmhvc3QsIE5V
TEwpOworICAgICAgICBzcGljZV91c2JfYmFja2VuZF9jaGFubmVsX2RldGFjaChwcml2LT5ob3N0
KTsKICAgICAgICAgcmV0dXJuIEZBTFNFOwogICAgIH0KIApAQCAtMzQxLDggKzMwMiw3IEBAIHN0
YXRpYyB2b2lkIHNwaWNlX3VzYnJlZGlyX2NoYW5uZWxfb3Blbl9hY2xfY2IoCiAgICAgICAgIHNw
aWNlX3VzYnJlZGlyX2NoYW5uZWxfb3Blbl9kZXZpY2UoY2hhbm5lbCwgJmVycik7CiAgICAgfQog
ICAgIGlmIChlcnIpIHsKLSAgICAgICAgbGlidXNiX3VucmVmX2RldmljZShwcml2LT5kZXZpY2Up
OwotICAgICAgICBwcml2LT5kZXZpY2UgPSBOVUxMOworICAgICAgICBnX2NsZWFyX3BvaW50ZXIo
JnByaXYtPmRldmljZSwgc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX3VucmVmKTsKICAgICAgICAg
Z19ib3hlZF9mcmVlKHNwaWNlX3VzYl9kZXZpY2VfZ2V0X3R5cGUoKSwgcHJpdi0+c3BpY2VfZGV2
aWNlKTsKICAgICAgICAgcHJpdi0+c3BpY2VfZGV2aWNlID0gTlVMTDsKICAgICAgICAgcHJpdi0+
c3RhdGUgID0gU1RBVEVfRElTQ09OTkVDVEVEOwpAQCAtMzczLDggKzMzMyw3IEBAIF9vcGVuX2Rl
dmljZV9hc3luY19jYihHVGFzayAqdGFzaywKICAgICBzcGljZV91c2JyZWRpcl9jaGFubmVsX2xv
Y2soY2hhbm5lbCk7CiAKICAgICBpZiAoIXNwaWNlX3VzYnJlZGlyX2NoYW5uZWxfb3Blbl9kZXZp
Y2UoY2hhbm5lbCwgJmVycikpIHsKLSAgICAgICAgbGlidXNiX3VucmVmX2RldmljZShwcml2LT5k
ZXZpY2UpOwotICAgICAgICBwcml2LT5kZXZpY2UgPSBOVUxMOworICAgICAgICBnX2NsZWFyX3Bv
aW50ZXIoJnByaXYtPmRldmljZSwgc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX3VucmVmKTsKICAg
ICAgICAgZ19ib3hlZF9mcmVlKHNwaWNlX3VzYl9kZXZpY2VfZ2V0X3R5cGUoKSwgcHJpdi0+c3Bp
Y2VfZGV2aWNlKTsKICAgICAgICAgcHJpdi0+c3BpY2VfZGV2aWNlID0gTlVMTDsKICAgICB9CkBA
IC0zOTIsMTMgKzM1MSwxNiBAQCBfb3Blbl9kZXZpY2VfYXN5bmNfY2IoR1Rhc2sgKnRhc2ssCiBH
X0dOVUNfSU5URVJOQUwKIHZvaWQgc3BpY2VfdXNicmVkaXJfY2hhbm5lbF9jb25uZWN0X2Rldmlj
ZV9hc3luYygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNl
VXNicmVkaXJDaGFubmVsICpjaGFubmVsLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgbGlidXNiX2RldmljZSAgICAgICAgKmRldmljZSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2aWNl
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VVc2JEZXZp
Y2UgICAgICAgKnNwaWNlX2RldmljZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIEdDYW5jZWxsYWJsZSAgICAgICAgICpjYW5jZWxsYWJsZSwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdBc3luY1JlYWR5Q2FsbGJhY2sgICBjYWxs
YmFjaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdwb2ludGVy
ICAgICAgICAgICAgICB1c2VyX2RhdGEpCiB7CiAgICAgU3BpY2VVc2JyZWRpckNoYW5uZWxQcml2
YXRlICpwcml2ID0gY2hhbm5lbC0+cHJpdjsKKyNpZmRlZiBVU0VfUE9MS0lUCisgICAgY29uc3Qg
VXNiRGV2aWNlSW5mb3JtYXRpb24gKmluZm8gPSBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfZ2V0
X2luZm8oZGV2aWNlKTsKKyNlbmRpZgogICAgIEdUYXNrICp0YXNrOwogCiAgICAgZ19yZXR1cm5f
aWZfZmFpbChTUElDRV9JU19VU0JSRURJUl9DSEFOTkVMKGNoYW5uZWwpKTsKQEAgLTQyNSw3ICsz
ODcsNyBAQCB2b2lkIHNwaWNlX3VzYnJlZGlyX2NoYW5uZWxfY29ubmVjdF9kZXZpY2VfYXN5bmMo
CiAgICAgICAgIGdvdG8gZG9uZTsKICAgICB9CiAKLSAgICBwcml2LT5kZXZpY2UgPSBsaWJ1c2Jf
cmVmX2RldmljZShkZXZpY2UpOworICAgIHByaXYtPmRldmljZSA9IHNwaWNlX3VzYl9iYWNrZW5k
X2RldmljZV9yZWYoZGV2aWNlKTsKICAgICBwcml2LT5zcGljZV9kZXZpY2UgPSBnX2JveGVkX2Nv
cHkoc3BpY2VfdXNiX2RldmljZV9nZXRfdHlwZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBzcGljZV9kZXZpY2UpOwogI2lmZGVmIFVTRV9QT0xLSVQKQEAgLTQzNSw4
ICszOTcsOCBAQCB2b2lkIHNwaWNlX3VzYnJlZGlyX2NoYW5uZWxfY29ubmVjdF9kZXZpY2VfYXN5
bmMoCiAgICAgZ19vYmplY3Rfc2V0KHNwaWNlX2NoYW5uZWxfZ2V0X3Nlc3Npb24oU1BJQ0VfQ0hB
Tk5FTChjaGFubmVsKSksCiAgICAgICAgICAgICAgICAgICJpbmhpYml0LWtleWJvYXJkLWdyYWIi
LCBUUlVFLCBOVUxMKTsKICAgICBzcGljZV91c2JfYWNsX2hlbHBlcl9vcGVuX2FjbF9hc3luYyhw
cml2LT5hY2xfaGVscGVyLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGxpYnVzYl9nZXRfYnVzX251bWJlcihkZXZpY2UpLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGxpYnVzYl9nZXRfZGV2aWNlX2FkZHJlc3MoZGV2aWNlKSwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvLT5idXMsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mby0+YWRkcmVzcywKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxsYWJsZSwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBzcGljZV91c2JyZWRpcl9jaGFubmVsX29wZW5fYWNs
X2NiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5uZWwpOwpA
QCAtNDk0LDkgKzQ1Niw4IEBAIHZvaWQgc3BpY2VfdXNicmVkaXJfY2hhbm5lbF9kaXNjb25uZWN0
X2RldmljZShTcGljZVVzYnJlZGlyQ2hhbm5lbCAqY2hhbm5lbCkKICAgICAgICAgZ19jbGVhcl9v
YmplY3QoJnByaXYtPnVzYl9kZXZpY2VfbWFuYWdlcik7CiAKICAgICAgICAgLyogVGhpcyBhbHNv
IGNsb3NlcyB0aGUgbGlidXNiIGhhbmRsZSB3ZSBwYXNzZWQgZnJvbSBvcGVuX2RldmljZSAqLwot
ICAgICAgICB1c2JyZWRpcmhvc3Rfc2V0X2RldmljZShwcml2LT5ob3N0LCBOVUxMKTsKLSAgICAg
ICAgbGlidXNiX3VucmVmX2RldmljZShwcml2LT5kZXZpY2UpOwotICAgICAgICBwcml2LT5kZXZp
Y2UgPSBOVUxMOworICAgICAgICBzcGljZV91c2JfYmFja2VuZF9jaGFubmVsX2RldGFjaChwcml2
LT5ob3N0KTsKKyAgICAgICAgZ19jbGVhcl9wb2ludGVyKCZwcml2LT5kZXZpY2UsIHNwaWNlX3Vz
Yl9iYWNrZW5kX2RldmljZV91bnJlZik7CiAgICAgICAgIGdfYm94ZWRfZnJlZShzcGljZV91c2Jf
ZGV2aWNlX2dldF90eXBlKCksIHByaXYtPnNwaWNlX2RldmljZSk7CiAgICAgICAgIHByaXYtPnNw
aWNlX2RldmljZSA9IE5VTEw7CiAgICAgICAgIHByaXYtPnN0YXRlICA9IFNUQVRFX0RJU0NPTk5F
Q1RFRDsKQEAgLTU0Nyw3ICs1MDgsNyBAQCBzcGljZV91c2JyZWRpcl9jaGFubmVsX2dldF9zcGlj
ZV91c2JfZGV2aWNlKFNwaWNlVXNicmVkaXJDaGFubmVsICpjaGFubmVsKQogI2VuZGlmCiAKIEdf
R05VQ19JTlRFUk5BTAotbGlidXNiX2RldmljZSAqc3BpY2VfdXNicmVkaXJfY2hhbm5lbF9nZXRf
ZGV2aWNlKFNwaWNlVXNicmVkaXJDaGFubmVsICpjaGFubmVsKQorU3BpY2VVc2JCYWNrZW5kRGV2
aWNlICpzcGljZV91c2JyZWRpcl9jaGFubmVsX2dldF9kZXZpY2UoU3BpY2VVc2JyZWRpckNoYW5u
ZWwgKmNoYW5uZWwpCiB7CiAgICAgcmV0dXJuIGNoYW5uZWwtPnByaXYtPmRldmljZTsKIH0KQEAg
LTU2Miw5MSArNTIzLDE4IEBAIHZvaWQgc3BpY2VfdXNicmVkaXJfY2hhbm5lbF9nZXRfZ3Vlc3Rf
ZmlsdGVyKAogCiAgICAgZ19yZXR1cm5faWZfZmFpbChwcml2LT5ob3N0ICE9IE5VTEwpOwogCi0g
ICAgdXNicmVkaXJob3N0X2dldF9ndWVzdF9maWx0ZXIocHJpdi0+aG9zdCwgcnVsZXNfcmV0LCBy
dWxlc19jb3VudF9yZXQpOworICAgIHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfZ2V0X2d1ZXN0
X2ZpbHRlcihwcml2LT5ob3N0LCBydWxlc19yZXQsIHJ1bGVzX2NvdW50X3JldCk7CiB9CiAKIC8q
IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLSAqLwogLyogY2FsbGJhY2tzIChhbnkgY29udGV4dCkgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICovCiAKLXN0YXRpYyB1aW50NjRfdCB1c2JyZWRp
cl9idWZmZXJlZF9vdXRwdXRfc2l6ZV9jYWxsYmFjayh2b2lkICp1c2VyX2RhdGEpCi17Ci0gICAg
Z19yZXR1cm5fdmFsX2lmX2ZhaWwoU1BJQ0VfSVNfVVNCUkVESVJfQ0hBTk5FTCh1c2VyX2RhdGEp
LCAwKTsKLSAgICByZXR1cm4gc3BpY2VfY2hhbm5lbF9nZXRfcXVldWVfc2l6ZShTUElDRV9DSEFO
TkVMKHVzZXJfZGF0YSkpOwotfQotCi0vKiBOb3RlIHRoYXQgdGhpcyBmdW5jdGlvbiBtdXN0IGJl
IHJlLWVudHJhbnQgc2FmZSwgYXMgaXQgY2FuIGdldCBjYWxsZWQKLSAgIGZyb20gYm90aCB0aGUg
bWFpbiB0aHJlYWQgYXMgd2VsbCBhcyBmcm9tIHRoZSB1c2IgZXZlbnQgaGFuZGxpbmcgdGhyZWFk
ICovCi1zdGF0aWMgdm9pZCB1c2JyZWRpcl93cml0ZV9mbHVzaF9jYWxsYmFjayh2b2lkICp1c2Vy
X2RhdGEpCi17Ci0gICAgU3BpY2VVc2JyZWRpckNoYW5uZWwgKmNoYW5uZWwgPSBTUElDRV9VU0JS
RURJUl9DSEFOTkVMKHVzZXJfZGF0YSk7Ci0gICAgU3BpY2VVc2JyZWRpckNoYW5uZWxQcml2YXRl
ICpwcml2ID0gY2hhbm5lbC0+cHJpdjsKLQotICAgIGlmIChzcGljZV9jaGFubmVsX2dldF9zdGF0
ZShTUElDRV9DSEFOTkVMKGNoYW5uZWwpKSAhPQotICAgICAgICAgICAgU1BJQ0VfQ0hBTk5FTF9T
VEFURV9SRUFEWSkKLSAgICAgICAgcmV0dXJuOwotCi0gICAgaWYgKCFwcml2LT5ob3N0KQotICAg
ICAgICByZXR1cm47Ci0KLSAgICB1c2JyZWRpcmhvc3Rfd3JpdGVfZ3Vlc3RfZGF0YShwcml2LT5o
b3N0KTsKLX0KLQotc3RhdGljIHZvaWQgdXNicmVkaXJfbG9nKHZvaWQgKnVzZXJfZGF0YSwgaW50
IGxldmVsLCBjb25zdCBjaGFyICptc2cpCi17Ci0gICAgU3BpY2VVc2JyZWRpckNoYW5uZWwgKmNo
YW5uZWwgPSB1c2VyX2RhdGE7Ci0gICAgU3BpY2VVc2JyZWRpckNoYW5uZWxQcml2YXRlICpwcml2
ID0gY2hhbm5lbC0+cHJpdjsKLQotICAgIGlmIChwcml2LT5jYXRjaF9lcnJvciAmJiBsZXZlbCA9
PSB1c2JyZWRpcnBhcnNlcl9lcnJvcikgewotICAgICAgICBDSEFOTkVMX0RFQlVHKGNoYW5uZWws
ICIlcyIsIG1zZyk7Ci0gICAgICAgIC8qIFJlbW92ZSAidXNicmVkaXJob3N0OiAiIHByZWZpeCBm
cm9tIHVzYnJlZGlyaG9zdCBtZXNzYWdlcyAqLwotICAgICAgICBpZiAoc3RybmNtcChtc2csICJ1
c2JyZWRpcmhvc3Q6ICIsIDE0KSA9PSAwKQotICAgICAgICAgICAgZ19zZXRfZXJyb3JfbGl0ZXJh
bChwcml2LT5jYXRjaF9lcnJvciwgU1BJQ0VfQ0xJRU5UX0VSUk9SLAotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBTUElDRV9DTElFTlRfRVJST1JfRkFJTEVELCBtc2cgKyAxNCk7Ci0g
ICAgICAgIGVsc2UKLSAgICAgICAgICAgIGdfc2V0X2Vycm9yX2xpdGVyYWwocHJpdi0+Y2F0Y2hf
ZXJyb3IsIFNQSUNFX0NMSUVOVF9FUlJPUiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgU1BJQ0VfQ0xJRU5UX0VSUk9SX0ZBSUxFRCwgbXNnKTsKLSAgICAgICAgcmV0dXJuOwotICAg
IH0KLQotICAgIHN3aXRjaCAobGV2ZWwpIHsKLSAgICAgICAgY2FzZSB1c2JyZWRpcnBhcnNlcl9l
cnJvcjoKLSAgICAgICAgICAgIGdfY3JpdGljYWwoIiVzIiwgbXNnKTsKLSAgICAgICAgICAgIGJy
ZWFrOwotICAgICAgICBjYXNlIHVzYnJlZGlycGFyc2VyX3dhcm5pbmc6Ci0gICAgICAgICAgICBn
X3dhcm5pbmcoIiVzIiwgbXNnKTsKLSAgICAgICAgICAgIGJyZWFrOwotICAgICAgICBkZWZhdWx0
OgotICAgICAgICAgICAgQ0hBTk5FTF9ERUJVRyhjaGFubmVsLCAiJXMiLCBtc2cpOwotICAgIH0K
LX0KLQotc3RhdGljIGludCB1c2JyZWRpcl9yZWFkX2NhbGxiYWNrKHZvaWQgKnVzZXJfZGF0YSwg
dWludDhfdCAqZGF0YSwgaW50IGNvdW50KQotewotICAgIFNwaWNlVXNicmVkaXJDaGFubmVsICpj
aGFubmVsID0gdXNlcl9kYXRhOwotICAgIFNwaWNlVXNicmVkaXJDaGFubmVsUHJpdmF0ZSAqcHJp
diA9IGNoYW5uZWwtPnByaXY7Ci0KLSAgICBjb3VudCA9IE1JTihwcml2LT5yZWFkX2J1Zl9zaXpl
LCBjb3VudCk7Ci0KLSAgICBpZiAoY291bnQgIT0gMCkgewotICAgICAgICBtZW1jcHkoZGF0YSwg
cHJpdi0+cmVhZF9idWYsIGNvdW50KTsKLSAgICB9Ci0KLSAgICBwcml2LT5yZWFkX2J1Zl9zaXpl
IC09IGNvdW50OwotICAgIGlmIChwcml2LT5yZWFkX2J1Zl9zaXplKSB7Ci0gICAgICAgIHByaXYt
PnJlYWRfYnVmICs9IGNvdW50OwotICAgIH0gZWxzZSB7Ci0gICAgICAgIHByaXYtPnJlYWRfYnVm
ID0gTlVMTDsKLSAgICB9Ci0KLSAgICByZXR1cm4gY291bnQ7Ci19Ci0KIHN0YXRpYyB2b2lkIHVz
YnJlZGlyX2ZyZWVfd3JpdGVfY2JfZGF0YSh1aW50OF90ICpkYXRhLCB2b2lkICp1c2VyX2RhdGEp
CiB7CiAgICAgU3BpY2VVc2JyZWRpckNoYW5uZWwgKmNoYW5uZWwgPSB1c2VyX2RhdGE7CiAgICAg
U3BpY2VVc2JyZWRpckNoYW5uZWxQcml2YXRlICpwcml2ID0gY2hhbm5lbC0+cHJpdjsKIAotICAg
IHVzYnJlZGlyaG9zdF9mcmVlX3dyaXRlX2J1ZmZlcihwcml2LT5ob3N0LCBkYXRhKTsKKyAgICBz
cGljZV91c2JfYmFja2VuZF9yZXR1cm5fd3JpdGVfZGF0YShwcml2LT5ob3N0LCBkYXRhKTsKIH0K
IAogI2lmZGVmIFVTRV9MWjQKQEAgLTcxMSwxNCArNTk5LDE0IEBAIHN0YXRpYyBpbnQgdHJ5X3dy
aXRlX2NvbXByZXNzX0xaNChTcGljZVVzYnJlZGlyQ2hhbm5lbCAqY2hhbm5lbCwgdWludDhfdCAq
ZGF0YSwKIH0KICNlbmRpZgogCi1zdGF0aWMgaW50IHVzYnJlZGlyX3dyaXRlX2NhbGxiYWNrKHZv
aWQgKnVzZXJfZGF0YSwgdWludDhfdCAqZGF0YSwgaW50IGNvdW50KQorR19HTlVDX0lOVEVSTkFM
CitpbnQgc3BpY2VfdXNicmVkaXJfd3JpdGVfY2FsbGJhY2soU3BpY2VVc2JyZWRpckNoYW5uZWwg
KmNoYW5uZWwsIHVpbnQ4X3QgKmRhdGEsIGludCBjb3VudCkKIHsKLSAgICBTcGljZVVzYnJlZGly
Q2hhbm5lbCAqY2hhbm5lbCA9IHVzZXJfZGF0YTsKICAgICBTcGljZU1zZ091dCAqbXNnX291dDsK
IAogI2lmZGVmIFVTRV9MWjQKICAgICBpZiAodHJ5X3dyaXRlX2NvbXByZXNzX0xaNChjaGFubmVs
LCBkYXRhLCBjb3VudCkpIHsKLSAgICAgICAgdXNicmVkaXJob3N0X2ZyZWVfd3JpdGVfYnVmZmVy
KGNoYW5uZWwtPnByaXYtPmhvc3QsIGRhdGEpOworICAgICAgICBzcGljZV91c2JfYmFja2VuZF9y
ZXR1cm5fd3JpdGVfZGF0YShjaGFubmVsLT5wcml2LT5ob3N0LCBkYXRhKTsKICAgICAgICAgcmV0
dXJuIGNvdW50OwogICAgIH0KICNlbmRpZgpAQCAtNzMxLDE1ICs2MTksNiBAQCBzdGF0aWMgaW50
IHVzYnJlZGlyX3dyaXRlX2NhbGxiYWNrKHZvaWQgKnVzZXJfZGF0YSwgdWludDhfdCAqZGF0YSwg
aW50IGNvdW50KQogICAgIHJldHVybiBjb3VudDsKIH0KIAotc3RhdGljIHZvaWQgKnVzYnJlZGly
X2FsbG9jX2xvY2sodm9pZCkgewotICAgIEdNdXRleCAqbXV0ZXg7Ci0KLSAgICBtdXRleCA9IGdf
bmV3MChHTXV0ZXgsIDEpOwotICAgIGdfbXV0ZXhfaW5pdChtdXRleCk7Ci0KLSAgICByZXR1cm4g
bXV0ZXg7Ci19Ci0KIEdfR05VQ19JTlRFUk5BTAogdm9pZCBzcGljZV91c2JyZWRpcl9jaGFubmVs
X2xvY2soU3BpY2VVc2JyZWRpckNoYW5uZWwgKmNoYW5uZWwpCiB7CkBAIC03NTIsMjUgKzYzMSw2
IEBAIHZvaWQgc3BpY2VfdXNicmVkaXJfY2hhbm5lbF91bmxvY2soU3BpY2VVc2JyZWRpckNoYW5u
ZWwgKmNoYW5uZWwpCiAgICAgZ19tdXRleF91bmxvY2soJmNoYW5uZWwtPnByaXYtPmRldmljZV9j
b25uZWN0X211dGV4KTsKIH0KIAotc3RhdGljIHZvaWQgdXNicmVkaXJfbG9ja19sb2NrKHZvaWQg
KnVzZXJfZGF0YSkgewotICAgIEdNdXRleCAqbXV0ZXggPSB1c2VyX2RhdGE7Ci0KLSAgICBnX211
dGV4X2xvY2sobXV0ZXgpOwotfQotCi1zdGF0aWMgdm9pZCB1c2JyZWRpcl91bmxvY2tfbG9jayh2
b2lkICp1c2VyX2RhdGEpIHsKLSAgICBHTXV0ZXggKm11dGV4ID0gdXNlcl9kYXRhOwotCi0gICAg
Z19tdXRleF91bmxvY2sobXV0ZXgpOwotfQotCi1zdGF0aWMgdm9pZCB1c2JyZWRpcl9mcmVlX2xv
Y2sodm9pZCAqdXNlcl9kYXRhKSB7Ci0gICAgR011dGV4ICptdXRleCA9IHVzZXJfZGF0YTsKLQot
ICAgIGdfbXV0ZXhfY2xlYXIobXV0ZXgpOwotICAgIGdfZnJlZShtdXRleCk7Ci19Ci0KIC8qIC0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLSAqLwogCiB0eXBlZGVmIHN0cnVjdCBkZXZpY2VfZXJyb3JfZGF0YSB7CkBAIC04
MDksNyArNjY5LDcgQEAgc3RhdGljIHZvaWQgc3BpY2VfdXNicmVkaXJfY2hhbm5lbF91cChTcGlj
ZUNoYW5uZWwgKmMpCiAKICAgICBnX3JldHVybl9pZl9mYWlsKHByaXYtPmhvc3QgIT0gTlVMTCk7
CiAgICAgLyogRmx1c2ggYW55IHBlbmRpbmcgd3JpdGVzICovCi0gICAgdXNicmVkaXJob3N0X3dy
aXRlX2d1ZXN0X2RhdGEocHJpdi0+aG9zdCk7CisgICAgc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5l
bF9mbHVzaF93cml0ZXMocHJpdi0+aG9zdCk7CiB9CiAKIHN0YXRpYyBpbnQgdHJ5X2hhbmRsZV9j
b21wcmVzc2VkX21zZyhTcGljZU1zZ0NvbXByZXNzZWREYXRhICpjb21wcmVzc2VkX2RhdGFfbXNn
LApAQCAtODU5LDI2ICs3MTksMjAgQEAgc3RhdGljIHZvaWQgdXNicmVkaXJfaGFuZGxlX21zZyhT
cGljZUNoYW5uZWwgKmMsIFNwaWNlTXNnSW4gKmluKQogCiAgICAgZ19yZXR1cm5faWZfZmFpbChw
cml2LT5ob3N0ICE9IE5VTEwpOwogCi0gICAgLyogTm8gcmVjdXJzaW9uIGFsbG93ZWQhICovCi0g
ICAgZ19yZXR1cm5faWZfZmFpbChwcml2LT5yZWFkX2J1ZiA9PSBOVUxMKTsKLQogICAgIGlmIChz
cGljZV9tc2dfaW5fdHlwZShpbikgPT0gU1BJQ0VfTVNHX1NQSUNFVk1DX0NPTVBSRVNTRURfREFU
QSkgewogICAgICAgICBTcGljZU1zZ0NvbXByZXNzZWREYXRhICpjb21wcmVzc2VkX2RhdGFfbXNn
ID0gc3BpY2VfbXNnX2luX3BhcnNlZChpbik7CiAgICAgICAgIGlmICh0cnlfaGFuZGxlX2NvbXBy
ZXNzZWRfbXNnKGNvbXByZXNzZWRfZGF0YV9tc2csICZidWYsICZzaXplKSkgewotICAgICAgICAg
ICAgcHJpdi0+cmVhZF9idWZfc2l6ZSA9IHNpemU7Ci0gICAgICAgICAgICBwcml2LT5yZWFkX2J1
ZiA9IGJ1ZjsKKyAgICAgICAgICAgIC8qIHVuY29tcHJlc3NlZCBvayovCiAgICAgICAgIH0gZWxz
ZSB7Ci0gICAgICAgICAgICByID0gdXNicmVkaXJob3N0X3JlYWRfcGFyc2VfZXJyb3I7CisgICAg
ICAgICAgICByID0gVVNCX1JFRElSX0VSUk9SX1JFQURfUEFSU0U7CiAgICAgICAgIH0KICAgICB9
IGVsc2UgeyAvKiBSZWd1bGFyIFNQSUNFX01TR19TUElDRVZNQ19EQVRBIG1zZyAqLwogICAgICAg
ICBidWYgPSBzcGljZV9tc2dfaW5fcmF3KGluLCAmc2l6ZSk7Ci0gICAgICAgIHByaXYtPnJlYWRf
YnVmX3NpemUgPSBzaXplOwotICAgICAgICBwcml2LT5yZWFkX2J1ZiA9IGJ1ZjsKICAgICB9CiAK
ICAgICBzcGljZV91c2JyZWRpcl9jaGFubmVsX2xvY2soY2hhbm5lbCk7CiAgICAgaWYgKHIgPT0g
MCkKLSAgICAgICAgciA9IHVzYnJlZGlyaG9zdF9yZWFkX2d1ZXN0X2RhdGEocHJpdi0+aG9zdCk7
CisgICAgICAgIHIgPSBzcGljZV91c2JfYmFja2VuZF9yZWFkX2d1ZXN0X2RhdGEocHJpdi0+aG9z
dCwgYnVmLCBzaXplKTsKICAgICBpZiAociAhPSAwKSB7CiAgICAgICAgIFNwaWNlVXNiRGV2aWNl
ICpzcGljZV9kZXZpY2UgPSBwcml2LT5zcGljZV9kZXZpY2U7CiAgICAgICAgIGRldmljZV9lcnJv
cl9kYXRhIGVycl9kYXRhOwpAQCAtODkxLDI1ICs3NDUsNyBAQCBzdGF0aWMgdm9pZCB1c2JyZWRp
cl9oYW5kbGVfbXNnKFNwaWNlQ2hhbm5lbCAqYywgU3BpY2VNc2dJbiAqaW4pCiAgICAgICAgIH0K
IAogICAgICAgICBkZXNjID0gc3BpY2VfdXNiX2RldmljZV9nZXRfZGVzY3JpcHRpb24oc3BpY2Vf
ZGV2aWNlLCBOVUxMKTsKLSAgICAgICAgc3dpdGNoIChyKSB7Ci0gICAgICAgIGNhc2UgdXNicmVk
aXJob3N0X3JlYWRfcGFyc2VfZXJyb3I6Ci0gICAgICAgICAgICBlcnIgPSBnX2Vycm9yX25ldyhT
UElDRV9DTElFTlRfRVJST1IsIFNQSUNFX0NMSUVOVF9FUlJPUl9GQUlMRUQsCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBfKCJ1c2JyZWRpciBwcm90b2NvbCBwYXJzZSBlcnJvciBmb3Ig
JXMiKSwgZGVzYyk7Ci0gICAgICAgICAgICBicmVhazsKLSAgICAgICAgY2FzZSB1c2JyZWRpcmhv
c3RfcmVhZF9kZXZpY2VfcmVqZWN0ZWQ6Ci0gICAgICAgICAgICBlcnIgPSBnX2Vycm9yX25ldyhT
UElDRV9DTElFTlRfRVJST1IsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTUElDRV9D
TElFTlRfRVJST1JfVVNCX0RFVklDRV9SRUpFQ1RFRCwKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIF8oIiVzIHJlamVjdGVkIGJ5IGhvc3QiKSwgZGVzYyk7Ci0gICAgICAgICAgICBicmVh
azsKLSAgICAgICAgY2FzZSB1c2JyZWRpcmhvc3RfcmVhZF9kZXZpY2VfbG9zdDoKLSAgICAgICAg
ICAgIGVyciA9IGdfZXJyb3JfbmV3KFNQSUNFX0NMSUVOVF9FUlJPUiwKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIFNQSUNFX0NMSUVOVF9FUlJPUl9VU0JfREVWSUNFX0xPU1QsCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBfKCIlcyBkaXNjb25uZWN0ZWQgKGZhdGFsIElPIGVy
cm9yKSIpLCBkZXNjKTsKLSAgICAgICAgICAgIGJyZWFrOwotICAgICAgICBkZWZhdWx0OgotICAg
ICAgICAgICAgZXJyID0gZ19lcnJvcl9uZXcoU1BJQ0VfQ0xJRU5UX0VSUk9SLCBTUElDRV9DTElF
TlRfRVJST1JfRkFJTEVELAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXygiVW5rbm93
biBlcnJvciAoJWQpIGZvciAlcyIpLCByLCBkZXNjKTsKLSAgICAgICAgfQorICAgICAgICBlcnIg
PSBzcGljZV91c2JfYmFja2VuZF9nZXRfZXJyb3JfZGV0YWlscyhyLCBkZXNjKTsKICAgICAgICAg
Z19mcmVlKGRlc2MpOwogCiAgICAgICAgIENIQU5ORUxfREVCVUcoYywgIiVzIiwgZXJyLT5tZXNz
YWdlKTsKZGlmZiAtLWdpdCBhL3NyYy9tZXNvbi5idWlsZCBiL3NyYy9tZXNvbi5idWlsZAppbmRl
eCA1MzY1ZjA1NC4uYTUxZDBhOTYgMTAwNjQ0Ci0tLSBhL3NyYy9tZXNvbi5idWlsZAorKysgYi9z
cmMvbWVzb24uYnVpbGQKQEAgLTEyMSw2ICsxMjEsOCBAQCBzcGljZV9jbGllbnRfZ2xpYl9zb3Vy
Y2VzID0gWwogICAndXNiLWRldmljZS1tYW5hZ2VyLXByaXYuaCcsCiAgICd1c2J1dGlsLmMnLAog
ICAndXNidXRpbC5oJywKKyAgJ3VzYi1iYWNrZW5kLmMnLAorICAndXNiLWJhY2tlbmQuaCcsCiAg
ICd2bWNzdHJlYW0uYycsCiAgICd2bWNzdHJlYW0uaCcsCiBdCmRpZmYgLS1naXQgYS9zcmMvdXNi
LWJhY2tlbmQuYyBiL3NyYy91c2ItYmFja2VuZC5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4
IDAwMDAwMDAwLi40OGE2MmNkMQotLS0gL2Rldi9udWxsCisrKyBiL3NyYy91c2ItYmFja2VuZC5j
CkBAIC0wLDAgKzEsNjU3IEBACisvKiAtKi0gTW9kZTogQzsgYy1iYXNpYy1vZmZzZXQ6IDQ7IGlu
ZGVudC10YWJzLW1vZGU6IG5pbCAtKi0gKi8KKy8qCisgICAgQ29weXJpZ2h0IChDKSAyMDEyLTIw
MTggUmVkIEhhdCwgSW5jLgorCisgICAgUmVkIEhhdCBBdXRob3JzOgorICAgIFl1cmkgQmVuZGl0
b3ZpY2g8eWJlbmRpdG9AcmVkaGF0LmNvbT4KKyAgICBIYW5zIGRlIEdvZWRlIDxoZGVnb2VkZUBy
ZWRoYXQuY29tPgorCisgICAgVGhpcyBsaWJyYXJ5IGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4g
cmVkaXN0cmlidXRlIGl0IGFuZC9vcgorICAgIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2Yg
dGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKKyAgICBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBi
eSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIKKyAgICB2ZXJzaW9uIDIuMSBv
ZiB0aGUgTGljZW5zZSwgb3IgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KKwor
ICAgIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwg
YmUgdXNlZnVsLAorICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRo
ZSBpbXBsaWVkIHdhcnJhbnR5IG9mCisgICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9S
IEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUKKyAgICBMZXNzZXIgR2VuZXJhbCBQ
dWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgorCisgICAgWW91IHNob3VsZCBoYXZlIHJl
Y2VpdmVkIGEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYworICAgIExpY2Vu
c2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5v
cmcvbGljZW5zZXMvPi4KKyovCisKKyNpbmNsdWRlICJjb25maWcuaCIKKworI2lmZGVmIFVTRV9V
U0JSRURJUgorCisjaW5jbHVkZSA8Z2xpYi1vYmplY3QuaD4KKyNpbmNsdWRlIDxpbnR0eXBlcy5o
PgorI2luY2x1ZGUgPGdpby9naW8uaD4KKyNpbmNsdWRlIDxnbGliL2dpMThuLWxpYi5oPgorI2lu
Y2x1ZGUgPGVycm5vLmg+CisjaW5jbHVkZSA8bGlidXNiLmg+CisjaW5jbHVkZSA8c3RyaW5nLmg+
CisjaW5jbHVkZSA8ZmNudGwuaD4KKyNpbmNsdWRlICJ1c2JyZWRpcmhvc3QuaCIKKyNpbmNsdWRl
ICJ1c2JyZWRpcnBhcnNlci5oIgorI2luY2x1ZGUgInNwaWNlLXV0aWwuaCIKKyNpbmNsdWRlICJ1
c2ItYmFja2VuZC5oIgorI2luY2x1ZGUgImNoYW5uZWwtdXNicmVkaXItcHJpdi5oIgorI2luY2x1
ZGUgInNwaWNlLWNoYW5uZWwtcHJpdi5oIgorCisjZGVmaW5lIExPVURfREVCVUcoeCwgLi4uKQor
CitzdHJ1Y3QgX1NwaWNlVXNiQmFja2VuZERldmljZQoreworICAgIGxpYnVzYl9kZXZpY2UgKmxp
YnVzYl9kZXZpY2U7CisgICAgZ2ludCByZWZfY291bnQ7CisgICAgU3BpY2VVc2JCYWNrZW5kQ2hh
bm5lbCAqYXR0YWNoZWRfdG87CisgICAgVXNiRGV2aWNlSW5mb3JtYXRpb24gZGV2aWNlX2luZm87
Cit9OworCitzdHJ1Y3QgX1NwaWNlVXNiQmFja2VuZAoreworICAgIGxpYnVzYl9jb250ZXh0ICps
aWJ1c2JfY29udGV4dDsKKyAgICB1c2JfaG90X3BsdWdfY2FsbGJhY2sgaG90cGx1Z19jYWxsYmFj
azsKKyAgICB2b2lkICpob3RwbHVnX3VzZXJfZGF0YTsKKyAgICBsaWJ1c2JfaG90cGx1Z19jYWxs
YmFja19oYW5kbGUgaG90cGx1Z19oYW5kbGU7Cit9OworCitzdHJ1Y3QgX1NwaWNlVXNiQmFja2Vu
ZENoYW5uZWwKK3sKKyAgICBzdHJ1Y3QgdXNicmVkaXJob3N0ICp1c2JyZWRpcmhvc3Q7CisgICAg
dWludDhfdCAqcmVhZF9idWY7CisgICAgaW50IHJlYWRfYnVmX3NpemU7CisgICAgc3RydWN0IHVz
YnJlZGlyZmlsdGVyX3J1bGUgKnJ1bGVzOworICAgIGludCBydWxlc19jb3VudDsKKyAgICBTcGlj
ZVVzYkJhY2tlbmREZXZpY2UgKmF0dGFjaGVkOworICAgIFNwaWNlVXNicmVkaXJDaGFubmVsICAq
dXNlcl9kYXRhOworICAgIEdFcnJvciAqKmVycm9yOworfTsKKworLyogbG9jayBmdW5jdGlvbnMg
Zm9yIHVzYnJlZGlyaG9zdCBhbmQgdXNicmVkaXJwYXJzZXIgKi8KK3N0YXRpYyB2b2lkICp1c2Jy
ZWRpcl9hbGxvY19sb2NrKHZvaWQpIHsKKyAgICBHTXV0ZXggKm11dGV4OworCisgICAgbXV0ZXgg
PSBnX25ldzAoR011dGV4LCAxKTsKKyAgICBnX211dGV4X2luaXQobXV0ZXgpOworCisgICAgcmV0
dXJuIG11dGV4OworfQorCitzdGF0aWMgdm9pZCB1c2JyZWRpcl9mcmVlX2xvY2sodm9pZCAqdXNl
cl9kYXRhKSB7CisgICAgR011dGV4ICptdXRleCA9IHVzZXJfZGF0YTsKKworICAgIGdfbXV0ZXhf
Y2xlYXIobXV0ZXgpOworICAgIGdfZnJlZShtdXRleCk7Cit9CisKK3N0YXRpYyB2b2lkIHVzYnJl
ZGlyX2xvY2tfbG9jayh2b2lkICp1c2VyX2RhdGEpIHsKKyAgICBHTXV0ZXggKm11dGV4ID0gdXNl
cl9kYXRhOworCisgICAgZ19tdXRleF9sb2NrKG11dGV4KTsKK30KKworc3RhdGljIHZvaWQgdXNi
cmVkaXJfdW5sb2NrX2xvY2sodm9pZCAqdXNlcl9kYXRhKSB7CisgICAgR011dGV4ICptdXRleCA9
IHVzZXJfZGF0YTsKKworICAgIGdfbXV0ZXhfdW5sb2NrKG11dGV4KTsKK30KKworZ2Jvb2xlYW4g
c3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX2lzb2NoKFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2
KQoreworICAgIGxpYnVzYl9kZXZpY2UgKmxpYmRldiA9IGRldi0+bGlidXNiX2RldmljZTsKKyAg
ICBzdHJ1Y3QgbGlidXNiX2NvbmZpZ19kZXNjcmlwdG9yICpjb25mX2Rlc2M7CisgICAgZ2Jvb2xl
YW4gaXNvY19mb3VuZCA9IEZBTFNFOworICAgIGdpbnQgaSwgaiwgazsKKyAgICBpbnQgcmM7CisK
KyAgICBnX3JldHVybl92YWxfaWZfZmFpbChsaWJkZXYgIT0gTlVMTCwgMCk7CisKKyAgICByYyA9
IGxpYnVzYl9nZXRfYWN0aXZlX2NvbmZpZ19kZXNjcmlwdG9yKGxpYmRldiwgJmNvbmZfZGVzYyk7
CisgICAgaWYgKHJjKSB7CisgICAgICAgIGNvbnN0IGNoYXIgKmRlc2MgPSBsaWJ1c2Jfc3RyZXJy
b3IocmMpOworICAgICAgICBnX3dhcm5pbmcoImNhbid0IGdldCBjb25maWd1cmF0aW9uIGRlc2Ny
aXB0b3IsICVzIFslaV0iLCBkZXNjLCByYyk7CisgICAgICAgIHJldHVybiBGQUxTRTsKKyAgICB9
CisKKyAgICBmb3IgKGkgPSAwOyAhaXNvY19mb3VuZCAmJiBpIDwgY29uZl9kZXNjLT5iTnVtSW50
ZXJmYWNlczsgaSsrKSB7CisgICAgICAgIGZvciAoaiA9IDA7ICFpc29jX2ZvdW5kICYmIGogPCBj
b25mX2Rlc2MtPmludGVyZmFjZVtpXS5udW1fYWx0c2V0dGluZzsgaisrKSB7CisgICAgICAgICAg
ICBmb3IgKGsgPSAwOyAhaXNvY19mb3VuZCAmJiBrIDwgY29uZl9kZXNjLT5pbnRlcmZhY2VbaV0u
YWx0c2V0dGluZ1tqXS5iTnVtRW5kcG9pbnRzO2srKykgeworICAgICAgICAgICAgICAgIGdpbnQg
YXR0cmlidXRlcyA9IGNvbmZfZGVzYy0+aW50ZXJmYWNlW2ldLmFsdHNldHRpbmdbal0uZW5kcG9p
bnRba10uYm1BdHRyaWJ1dGVzOworICAgICAgICAgICAgICAgIGdpbnQgdHlwZSA9IGF0dHJpYnV0
ZXMgJiBMSUJVU0JfVFJBTlNGRVJfVFlQRV9NQVNLOworICAgICAgICAgICAgICAgIGlmICh0eXBl
ID09IExJQlVTQl9UUkFOU0ZFUl9UWVBFX0lTT0NIUk9OT1VTKSB7CisgICAgICAgICAgICAgICAg
ICAgIGlzb2NfZm91bmQgPSBUUlVFOworICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAgIH0K
KyAgICAgICAgfQorICAgIH0KKworICAgIGxpYnVzYl9mcmVlX2NvbmZpZ19kZXNjcmlwdG9yKGNv
bmZfZGVzYyk7CisgICAgcmV0dXJuIGlzb2NfZm91bmQ7Cit9CisKK3N0YXRpYyBnYm9vbGVhbiBm
aWxsX3VzYl9pbmZvKFNwaWNlVXNiQmFja2VuZERldmljZSAqYmRldikKK3sKKyAgICBVc2JEZXZp
Y2VJbmZvcm1hdGlvbiAqaW5mbyA9ICZiZGV2LT5kZXZpY2VfaW5mbzsKKworICAgIHN0cnVjdCBs
aWJ1c2JfZGV2aWNlX2Rlc2NyaXB0b3IgZGVzYzsKKyAgICBsaWJ1c2JfZGV2aWNlICpsaWJkZXYg
PSBiZGV2LT5saWJ1c2JfZGV2aWNlOworICAgIGxpYnVzYl9nZXRfZGV2aWNlX2Rlc2NyaXB0b3Io
bGliZGV2LCAmZGVzYyk7CisgICAgaW5mby0+YnVzID0gbGlidXNiX2dldF9idXNfbnVtYmVyKGxp
YmRldik7CisgICAgaW5mby0+YWRkcmVzcyA9IGxpYnVzYl9nZXRfZGV2aWNlX2FkZHJlc3MobGli
ZGV2KTsKKyAgICBpZiAoaW5mby0+YWRkcmVzcyA9PSAweGZmIHx8IC8qIHJvb3QgaHViIChIQ0Qp
ICovCisgICAgICAgIGluZm8tPmFkZHJlc3MgPD0gMSB8fCAvKiByb290IGh1YiBvciBiYWQgYWRk
cmVzcyAqLworICAgICAgICAoZGVzYy5iRGV2aWNlQ2xhc3MgPT0gTElCVVNCX0NMQVNTX0hVQikg
LypodWIqLykgeworICAgICAgICByZXR1cm4gRkFMU0U7CisgICAgfQorCisgICAgaW5mby0+dmlk
ID0gZGVzYy5pZFZlbmRvcjsKKyAgICBpbmZvLT5waWQgPSBkZXNjLmlkUHJvZHVjdDsKKyAgICBp
bmZvLT5jbGFzcyA9IGRlc2MuYkRldmljZUNsYXNzOworICAgIGluZm8tPnN1YmNsYXNzID0gZGVz
Yy5iRGV2aWNlU3ViQ2xhc3M7CisgICAgaW5mby0+cHJvdG9jb2wgPSBkZXNjLmJEZXZpY2VQcm90
b2NvbDsKKworICAgIHJldHVybiBUUlVFOworfQorCitzdGF0aWMgU3BpY2VVc2JCYWNrZW5kRGV2
aWNlICphbGxvY2F0ZV9iYWNrZW5kX2RldmljZShsaWJ1c2JfZGV2aWNlICpsaWJkZXYpCit7Cisg
ICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYgPSBnX25ldzAoU3BpY2VVc2JCYWNrZW5kRGV2
aWNlLCAxKTsKKyAgICBkZXYtPnJlZl9jb3VudCA9IDE7CisgICAgZGV2LT5saWJ1c2JfZGV2aWNl
ID0gbGliZGV2OworICAgIGlmICghZmlsbF91c2JfaW5mbyhkZXYpKSB7CisgICAgICAgIGdfY2xl
YXJfcG9pbnRlcigmZGV2LCBnX2ZyZWUpOworICAgIH0KKyAgICByZXR1cm4gZGV2OworfQorCitz
dGF0aWMgZ2Jvb2xlYW4gaXNfY2hhbm5lbF9yZWFkeShTcGljZVVzYnJlZGlyQ2hhbm5lbCAqY2hh
bm5lbCkKK3sKKyAgICByZXR1cm4gc3BpY2VfY2hhbm5lbF9nZXRfc3RhdGUoU1BJQ0VfQ0hBTk5F
TChjaGFubmVsKSkgPT0gU1BJQ0VfQ0hBTk5FTF9TVEFURV9SRUFEWTsKK30KKworLyogTm90ZSB0
aGF0IHRoaXMgZnVuY3Rpb24gbXVzdCBiZSByZS1lbnRyYW50IHNhZmUsIGFzIGl0IGNhbiBnZXQg
Y2FsbGVkCitmcm9tIGJvdGggdGhlIG1haW4gdGhyZWFkIGFzIHdlbGwgYXMgZnJvbSB0aGUgdXNi
IGV2ZW50IGhhbmRsaW5nIHRocmVhZCAqLworc3RhdGljIHZvaWQgdXNicmVkaXJfd3JpdGVfZmx1
c2hfY2FsbGJhY2sodm9pZCAqdXNlcl9kYXRhKQoreworICAgIFNwaWNlVXNiQmFja2VuZENoYW5u
ZWwgKmNoID0gdXNlcl9kYXRhOworICAgIGlmICghY2gtPnVzYnJlZGlyaG9zdCkgeworICAgICAg
ICAvKiBqdXN0IHRvIGJlIG9uIHRoZSBzYWZlIHNpZGUgKi8KKyAgICAgICAgcmV0dXJuOworICAg
IH0KKyAgICBpZiAoaXNfY2hhbm5lbF9yZWFkeShjaC0+dXNlcl9kYXRhKSkgeworICAgICAgICBT
UElDRV9ERUJVRygiJXMgY2ggJXAgLT4gdXNicmVkaXJob3N0IiwgX19GVU5DVElPTl9fLCBjaCk7
CisgICAgICAgIHVzYnJlZGlyaG9zdF93cml0ZV9ndWVzdF9kYXRhKGNoLT51c2JyZWRpcmhvc3Qp
OworICAgIH0gZWxzZSB7CisgICAgICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCAobm90IHJlYWR5
KSIsIF9fRlVOQ1RJT05fXywgY2gpOworICAgIH0KK30KKworU3BpY2VVc2JCYWNrZW5kICpzcGlj
ZV91c2JfYmFja2VuZF9uZXcoR0Vycm9yICoqZXJyb3IpCit7CisgICAgaW50IHJjOworICAgIFNw
aWNlVXNiQmFja2VuZCAqYmU7CisgICAgU1BJQ0VfREVCVUcoIiVzID4+IiwgX19GVU5DVElPTl9f
KTsKKyAgICBiZSA9IGdfbmV3MChTcGljZVVzYkJhY2tlbmQsIDEpOworICAgIHJjID0gbGlidXNi
X2luaXQoJmJlLT5saWJ1c2JfY29udGV4dCk7CisgICAgaWYgKHJjIDwgMCkgeworICAgICAgICBj
b25zdCBjaGFyICpkZXNjID0gbGlidXNiX3N0cmVycm9yKHJjKTsKKyAgICAgICAgZ193YXJuaW5n
KCJFcnJvciBpbml0aWFsaXppbmcgTElCVVNCIHN1cHBvcnQ6ICVzIFslaV0iLCBkZXNjLCByYyk7
CisgICAgICAgIGdfc2V0X2Vycm9yKGVycm9yLCBTUElDRV9DTElFTlRfRVJST1IsIFNQSUNFX0NM
SUVOVF9FUlJPUl9GQUlMRUQsCisgICAgICAgICAgICAiRXJyb3IgaW5pdGlhbGl6aW5nIExJQlVT
QiBzdXBwb3J0OiAlcyBbJWldIiwgZGVzYywgcmMpOworICAgICAgICBnX2ZyZWUoYmUpOworICAg
ICAgICBiZSA9IE5VTEw7CisgICAgfSBlbHNlIHsKKyNpZmRlZiBHX09TX1dJTjMyCisjaWYgTElC
VVNCX0FQSV9WRVJTSU9OID49IDB4MDEwMDAxMDYKKyAgICAgICAgbGlidXNiX3NldF9vcHRpb24o
YmUtPmxpYnVzYl9jb250ZXh0LCBMSUJVU0JfT1BUSU9OX1VTRV9VU0JESyk7CisjZW5kaWYKKyNl
bmRpZgorICAgIH0KKyAgICBTUElDRV9ERUJVRygiJXMgPDwiLCBfX0ZVTkNUSU9OX18pOworICAg
IHJldHVybiBiZTsKK30KKworZ2Jvb2xlYW4gc3BpY2VfdXNiX2JhY2tlbmRfaGFuZGxlX2V2ZW50
cyhTcGljZVVzYkJhY2tlbmQgKmJlKQoreworICAgIFNQSUNFX0RFQlVHKCIlcyA+PiIsIF9fRlVO
Q1RJT05fXyk7CisgICAgZ2Jvb2xlYW4gb2sgPSBGQUxTRTsKKyAgICBpZiAoYmUtPmxpYnVzYl9j
b250ZXh0KSB7CisgICAgICAgIGludCByZXMgPSBsaWJ1c2JfaGFuZGxlX2V2ZW50cyhiZS0+bGli
dXNiX2NvbnRleHQpOworICAgICAgICBvayA9IHJlcyA9PSAwOworICAgICAgICBpZiAocmVzICYm
IHJlcyAhPSBMSUJVU0JfRVJST1JfSU5URVJSVVBURUQpIHsKKyAgICAgICAgICAgIGNvbnN0IGNo
YXIgKmRlc2MgPSBsaWJ1c2Jfc3RyZXJyb3IocmVzKTsKKyAgICAgICAgICAgIGdfd2FybmluZygi
RXJyb3IgaGFuZGxpbmcgVVNCIGV2ZW50czogJXMgWyVpXSIsIGRlc2MsIHJlcyk7CisgICAgICAg
ICAgICBvayA9IEZBTFNFOworICAgICAgICB9CisgICAgfQorICAgIFNQSUNFX0RFQlVHKCIlcyA8
PCAlZCIsIF9fRlVOQ1RJT05fXywgb2spOworICAgIHJldHVybiBvazsKK30KKworc3RhdGljIGlu
dCBMSUJVU0JfQ0FMTCBob3RwbHVnX2NhbGxiYWNrKGxpYnVzYl9jb250ZXh0ICpjdHgsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlidXNiX2RldmljZSAqZGV2aWNl
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnVzYl9ob3RwbHVn
X2V2ZW50IGV2ZW50LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZv
aWQgKnVzZXJfZGF0YSkKK3sKKyAgICBTcGljZVVzYkJhY2tlbmQgKmJlID0gKFNwaWNlVXNiQmFj
a2VuZCAqKXVzZXJfZGF0YTsKKyAgICBpZiAoYmUtPmhvdHBsdWdfY2FsbGJhY2spIHsKKyAgICAg
ICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXY7CisgICAgICAgIGdib29sZWFuIHZhbCA9IGV2
ZW50ID09IExJQlVTQl9IT1RQTFVHX0VWRU5UX0RFVklDRV9BUlJJVkVEOworICAgICAgICBkZXYg
PSBhbGxvY2F0ZV9iYWNrZW5kX2RldmljZShkZXZpY2UpOworICAgICAgICBpZiAoZGV2KSB7Cisg
ICAgICAgICAgICBTUElDRV9ERUJVRygiY3JlYXRlZCBkZXYgJXAsIHVzYmxpYiBkZXYgJXAiLCBk
ZXYsIGRldmljZSk7CisgICAgICAgICAgICBsaWJ1c2JfcmVmX2RldmljZShkZXZpY2UpOworICAg
ICAgICAgICAgYmUtPmhvdHBsdWdfY2FsbGJhY2soYmUtPmhvdHBsdWdfdXNlcl9kYXRhLCBkZXYs
IHZhbCk7CisgICAgICAgICAgICBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfdW5yZWYoZGV2KTsK
KyAgICAgICAgfQorICAgIH0KKyAgICByZXR1cm4gMDsKK30KKwordm9pZCBzcGljZV91c2JfYmFj
a2VuZF9kZXJlZ2lzdGVyX2hvdHBsdWcoU3BpY2VVc2JCYWNrZW5kICpiZSkKK3sKKyAgICBnX3Jl
dHVybl9pZl9mYWlsKGJlICE9IE5VTEwpOworICAgIGlmIChiZS0+aG90cGx1Z19oYW5kbGUpIHsK
KyAgICAgICAgbGlidXNiX2hvdHBsdWdfZGVyZWdpc3Rlcl9jYWxsYmFjayhiZS0+bGlidXNiX2Nv
bnRleHQsIGJlLT5ob3RwbHVnX2hhbmRsZSk7CisgICAgICAgIGJlLT5ob3RwbHVnX2hhbmRsZSA9
IDA7CisgICAgfQorICAgIGJlLT5ob3RwbHVnX2NhbGxiYWNrID0gTlVMTDsKK30KKworZ2Jvb2xl
YW4gc3BpY2VfdXNiX2JhY2tlbmRfcmVnaXN0ZXJfaG90cGx1ZyhTcGljZVVzYkJhY2tlbmQgKmJl
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICp1c2Vy
X2RhdGEsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzYl9o
b3RfcGx1Z19jYWxsYmFjayBwcm9jKQoreworICAgIGludCByYzsKKyAgICBnX3JldHVybl92YWxf
aWZfZmFpbChiZSAhPSBOVUxMLCBGQUxTRSk7CisKKyAgICBiZS0+aG90cGx1Z19jYWxsYmFjayA9
IHByb2M7CisgICAgYmUtPmhvdHBsdWdfdXNlcl9kYXRhID0gdXNlcl9kYXRhOworICAgIHJjID0g
bGlidXNiX2hvdHBsdWdfcmVnaXN0ZXJfY2FsbGJhY2soYmUtPmxpYnVzYl9jb250ZXh0LAorICAg
ICAgICBMSUJVU0JfSE9UUExVR19FVkVOVF9ERVZJQ0VfQVJSSVZFRCB8IExJQlVTQl9IT1RQTFVH
X0VWRU5UX0RFVklDRV9MRUZULAorICAgICAgICBMSUJVU0JfSE9UUExVR19FTlVNRVJBVEUsIExJ
QlVTQl9IT1RQTFVHX01BVENIX0FOWSwKKyAgICAgICAgTElCVVNCX0hPVFBMVUdfTUFUQ0hfQU5Z
LCBMSUJVU0JfSE9UUExVR19NQVRDSF9BTlksCisgICAgICAgIGhvdHBsdWdfY2FsbGJhY2ssIGJl
LCAmYmUtPmhvdHBsdWdfaGFuZGxlKTsKKyAgICBpZiAocmMgIT0gTElCVVNCX1NVQ0NFU1MpIHsK
KyAgICAgICAgY29uc3QgY2hhciAqZGVzYyA9IGxpYnVzYl9zdHJlcnJvcihyYyk7CisgICAgICAg
IGdfd2FybmluZygiRXJyb3IgaW5pdGlhbGl6aW5nIFVTQiBob3RwbHVnIHN1cHBvcnQ6ICVzIFsl
aV0iLCBkZXNjLCByYyk7CisgICAgICAgIGJlLT5ob3RwbHVnX2NhbGxiYWNrID0gTlVMTDsKKyAg
ICAgICAgcmV0dXJuIEZBTFNFOworICAgIH0KKyAgICByZXR1cm4gVFJVRTsKK30KKwordm9pZCBz
cGljZV91c2JfYmFja2VuZF9kZWxldGUoU3BpY2VVc2JCYWNrZW5kICpiZSkKK3sKKyAgICBnX3Jl
dHVybl9pZl9mYWlsKGJlICE9IE5VTEwpOworICAgIFNQSUNFX0RFQlVHKCIlcyA+PiIsIF9fRlVO
Q1RJT05fXyk7CisgICAgaWYgKGJlLT5saWJ1c2JfY29udGV4dCkgeworICAgICAgICBsaWJ1c2Jf
ZXhpdChiZS0+bGlidXNiX2NvbnRleHQpOworICAgIH0KKyAgICBnX2ZyZWUoYmUpOworICAgIFNQ
SUNFX0RFQlVHKCIlcyA8PCIsIF9fRlVOQ1RJT05fXyk7Cit9CisKK1NwaWNlVXNiQmFja2VuZERl
dmljZSAqKnNwaWNlX3VzYl9iYWNrZW5kX2dldF9kZXZpY2VfbGlzdChTcGljZVVzYkJhY2tlbmQg
KmJlKQoreworICAgIExPVURfREVCVUcoIiVzID4+IiwgX19GVU5DVElPTl9fKTsKKyAgICBsaWJ1
c2JfZGV2aWNlICoqZGV2bGlzdCA9IE5VTEwsICoqZGV2OworICAgIFNwaWNlVXNiQmFja2VuZERl
dmljZSAqZCwgKipsaXN0OworCisgICAgaW50IG4gPSAwLCBpbmRleDsKKworICAgIGlmIChiZSAm
JiBiZS0+bGlidXNiX2NvbnRleHQpIHsKKyAgICAgICAgbGlidXNiX2dldF9kZXZpY2VfbGlzdChi
ZS0+bGlidXNiX2NvbnRleHQsICZkZXZsaXN0KTsKKyAgICB9CisKKyAgICAvKiBhZGQgYWxsIHRo
ZSBsaWJ1c2IgZGV2aWNlIHRoYXQgbm90IHByZXNlbnQgaW4gb3VyIGxpc3QgKi8KKyAgICBmb3Ig
KGRldiA9IGRldmxpc3Q7IGRldiAmJiAqZGV2OyBkZXYrKykgeworICAgICAgICBuKys7CisgICAg
fQorCisgICAgbGlzdCA9IGdfbmV3MChTcGljZVVzYkJhY2tlbmREZXZpY2UqLCBuICsgMSk7CisK
KyAgICBpbmRleCA9IDA7CisKKyAgICBmb3IgKGRldiA9IGRldmxpc3Q7IGRldiAmJiAqZGV2OyBk
ZXYrKykgeworICAgICAgICBkID0gYWxsb2NhdGVfYmFja2VuZF9kZXZpY2UoKmRldik7CisgICAg
ICAgIGlmICghZCkgeworICAgICAgICAgICAgbGlidXNiX3VucmVmX2RldmljZSgqZGV2KTsKKyAg
ICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgIFNQSUNFX0RFQlVHKCJjcmVhdGVkIGRldiAlcCwg
dXNibGliIGRldiAlcCIsIGQsICpkZXYpOworICAgICAgICAgICAgbGlzdFtpbmRleCsrXSA9IGQ7
CisgICAgICAgIH0KKyAgICB9CisKKyAgICBpZiAoZGV2bGlzdCkgeworICAgICAgICBsaWJ1c2Jf
ZnJlZV9kZXZpY2VfbGlzdChkZXZsaXN0LCAwKTsKKyAgICB9CisKKyAgICBMT1VEX0RFQlVHKCIl
cyA8PCIsIF9fRlVOQ1RJT05fXyk7CisgICAgcmV0dXJuIGxpc3Q7Cit9CisKK2NvbnN0IFVzYkRl
dmljZUluZm9ybWF0aW9uKiBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfZ2V0X2luZm8oU3BpY2VV
c2JCYWNrZW5kRGV2aWNlICpkZXYpCit7CisgICAgcmV0dXJuICZkZXYtPmRldmljZV9pbmZvOwor
fQorCitnY29uc3Rwb2ludGVyIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9nZXRfbGliZGV2KFNw
aWNlVXNiQmFja2VuZERldmljZSAqZGV2KQoreworICAgIHJldHVybiBkZXYtPmxpYnVzYl9kZXZp
Y2U7Cit9CisKK3ZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfZnJlZV9kZXZpY2VfbGlzdChTcGljZVVz
YkJhY2tlbmREZXZpY2UgKipkZXZsaXN0KQoreworICAgIExPVURfREVCVUcoIiVzID4+IiwgX19G
VU5DVElPTl9fKTsKKyAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKipkZXY7CisgICAgZm9yIChk
ZXYgPSBkZXZsaXN0OyAqZGV2OyBkZXYrKykgeworICAgICAgICBTcGljZVVzYkJhY2tlbmREZXZp
Y2UgKmQgPSAqZGV2OworICAgICAgICBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfdW5yZWYoZCk7
CisgICAgfQorICAgIGdfZnJlZShkZXZsaXN0KTsKKyAgICBMT1VEX0RFQlVHKCIlcyA8PCIsIF9f
RlVOQ1RJT05fXyk7Cit9CisKK1NwaWNlVXNiQmFja2VuZERldmljZSAqc3BpY2VfdXNiX2JhY2tl
bmRfZGV2aWNlX3JlZihTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldikKK3sKKyAgICBMT1VEX0RF
QlVHKCIlcyA+PiAlcCIsIF9fRlVOQ1RJT05fXywgZGV2KTsKKyAgICBnX2F0b21pY19pbnRfaW5j
KCZkZXYtPnJlZl9jb3VudCk7CisgICAgcmV0dXJuIGRldjsKK30KKwordm9pZCBzcGljZV91c2Jf
YmFja2VuZF9kZXZpY2VfdW5yZWYoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYpCit7CisgICAg
TE9VRF9ERUJVRygiJXMgPj4gJXAoJWQpIiwgX19GVU5DVElPTl9fLCBkZXYsIGRldi0+cmVmX2Nv
dW50KTsKKyAgICBpZiAoZ19hdG9taWNfaW50X2RlY19hbmRfdGVzdCgmZGV2LT5yZWZfY291bnQp
KSB7CisgICAgICAgIGxpYnVzYl91bnJlZl9kZXZpY2UoZGV2LT5saWJ1c2JfZGV2aWNlKTsKKyAg
ICAgICAgTE9VRF9ERUJVRygiJXMgZnJlZWluZyAlcCAobGlidXNiICVwKSIsIF9fRlVOQ1RJT05f
XywgZGV2LCBkZXYtPmxpYnVzYl9kZXZpY2UpOworICAgICAgICBnX2ZyZWUoZGV2KTsKKyAgICB9
Cit9CisKK2ludCBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfY2hlY2tfZmlsdGVyKAorICAgIFNw
aWNlVXNiQmFja2VuZERldmljZSAqZGV2LAorICAgIGNvbnN0IHN0cnVjdCB1c2JyZWRpcmZpbHRl
cl9ydWxlICpydWxlcywKKyAgICBpbnQgY291bnQpCit7CisgICAgcmV0dXJuIHVzYnJlZGlyaG9z
dF9jaGVja19kZXZpY2VfZmlsdGVyKAorICAgICAgICBydWxlcywgY291bnQsIGRldi0+bGlidXNi
X2RldmljZSwgMCk7Cit9CisKK3N0YXRpYyBpbnQgdXNicmVkaXJfcmVhZF9jYWxsYmFjayh2b2lk
ICp1c2VyX2RhdGEsIHVpbnQ4X3QgKmRhdGEsIGludCBjb3VudCkKK3sKKyAgICBTcGljZVVzYkJh
Y2tlbmRDaGFubmVsICpjaCA9IHVzZXJfZGF0YTsKKworICAgIGNvdW50ID0gTUlOKGNoLT5yZWFk
X2J1Zl9zaXplLCBjb3VudCk7CisKKyAgICBpZiAoY291bnQgIT0gMCkgeworICAgICAgICBtZW1j
cHkoZGF0YSwgY2gtPnJlYWRfYnVmLCBjb3VudCk7CisgICAgfQorCisgICAgY2gtPnJlYWRfYnVm
X3NpemUgLT0gY291bnQ7CisgICAgaWYgKGNoLT5yZWFkX2J1Zl9zaXplKSB7CisgICAgICAgIGNo
LT5yZWFkX2J1ZiArPSBjb3VudDsKKyAgICB9CisgICAgZWxzZSB7CisgICAgICAgIGNoLT5yZWFk
X2J1ZiA9IE5VTEw7CisgICAgfQorICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCwgJWQgYnl0ZXMi
LCBfX0ZVTkNUSU9OX18sIGNoLCBjb3VudCk7CisKKyAgICByZXR1cm4gY291bnQ7Cit9CisKK3N0
YXRpYyBjb25zdCBjaGFyICpzdHJpcF91c2JyZWRpcl9wcmVmaXgoY29uc3QgY2hhciAqbXNnKQor
eworICAgIGlmIChzdHJuY21wKG1zZywgInVzYnJlZGlyaG9zdDogIiwgMTQpID09IDApIHsKKyAg
ICAgICAgbXNnICs9IDE0OworICAgIH0KKyAgICByZXR1cm4gbXNnOworfQorCitzdGF0aWMgdm9p
ZCBjaGFubmVsX2Vycm9yKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLCBjb25zdCBjaGFyICpt
c2cpCit7CisgICAgaWYgKCFjaC0+ZXJyb3IpCisgICAgICAgIHJldHVybjsKKyAgICBnX3NldF9l
cnJvcl9saXRlcmFsKGNoLT5lcnJvciwgU1BJQ0VfQ0xJRU5UX0VSUk9SLCBTUElDRV9DTElFTlRf
RVJST1JfRkFJTEVELCBtc2cpOworICAgIGNoLT5lcnJvciA9IE5VTEw7Cit9CisKK3N0YXRpYyB2
b2lkIHVzYnJlZGlyX2xvZyh2b2lkICp1c2VyX2RhdGEsIGludCBsZXZlbCwgY29uc3QgY2hhciAq
bXNnKQoreworICAgIFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoID0gKFNwaWNlVXNiQmFja2Vu
ZENoYW5uZWwgKil1c2VyX2RhdGE7CisgICAgY29uc3QgY2hhciAqc3RyaXBwZWRfbXNnID0gc3Ry
aXBfdXNicmVkaXJfcHJlZml4KG1zZyk7CisgICAgc3dpdGNoIChsZXZlbCkgeworICAgIGNhc2Ug
dXNicmVkaXJwYXJzZXJfZXJyb3I6CisgICAgICAgIGdfY3JpdGljYWwoIiVzIiwgbXNnKTsKKyAg
ICAgICAgY2hhbm5lbF9lcnJvcihjaCwgc3RyaXBwZWRfbXNnKTsKKyAgICAgICAgYnJlYWs7Cisg
ICAgY2FzZSB1c2JyZWRpcnBhcnNlcl93YXJuaW5nOgorICAgICAgICBnX3dhcm5pbmcoIiVzIiwg
bXNnKTsKKyAgICAgICAgY2hhbm5lbF9lcnJvcihjaCwgc3RyaXBwZWRfbXNnKTsKKyAgICAgICAg
YnJlYWs7CisgICAgZGVmYXVsdDoKKyAgICAgICAgYnJlYWs7CisgICAgfQorfQorCitzdGF0aWMg
aW50IHVzYnJlZGlyX3dyaXRlX2NhbGxiYWNrKHZvaWQgKnVzZXJfZGF0YSwgdWludDhfdCAqZGF0
YSwgaW50IGNvdW50KQoreworICAgIFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoID0gdXNlcl9k
YXRhOworICAgIGludCByZXM7CisgICAgU1BJQ0VfREVCVUcoIiVzIGNoICVwLCAlZCBieXRlcyIs
IF9fRlVOQ1RJT05fXywgY2gsIGNvdW50KTsKKyAgICByZXMgPSBzcGljZV91c2JyZWRpcl93cml0
ZV9jYWxsYmFjayhjaC0+dXNlcl9kYXRhLCBkYXRhLCBjb3VudCk7CisgICAgcmV0dXJuIHJlczsK
K30KKworc3RhdGljIHVpbnQ2NF90IHVzYnJlZGlyX2J1ZmZlcmVkX291dHB1dF9zaXplX2NhbGxi
YWNrKHZvaWQgKnVzZXJfZGF0YSkKK3sKKyAgICBTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCA9
IHVzZXJfZGF0YTsKKyAgICByZXR1cm4gc3BpY2VfY2hhbm5lbF9nZXRfcXVldWVfc2l6ZShTUElD
RV9DSEFOTkVMKGNoLT51c2VyX2RhdGEpKTsKK30KKworaW50IHNwaWNlX3VzYl9iYWNrZW5kX3Jl
YWRfZ3Vlc3RfZGF0YShTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCwgdWludDhfdCAqZGF0YSwg
aW50IGNvdW50KQoreworICAgIGludCByZXMgPSAwOworCisgICAgZ19yZXR1cm5fdmFsX2lmX2Zh
aWwoY2gtPnJlYWRfYnVmID09IE5VTEwsIFVTQl9SRURJUl9FUlJPUl9SRUFEX1BBUlNFKTsKKwor
ICAgIGNoLT5yZWFkX2J1ZiA9IGRhdGE7CisgICAgY2gtPnJlYWRfYnVmX3NpemUgPSBjb3VudDsK
KyAgICBpZiAoY2gtPnVzYnJlZGlyaG9zdCkgeworICAgICAgICByZXMgPSB1c2JyZWRpcmhvc3Rf
cmVhZF9ndWVzdF9kYXRhKGNoLT51c2JyZWRpcmhvc3QpOworICAgIH0gZWxzZSB7CisgICAgICAg
IHJlcyA9IFVTQl9SRURJUl9FUlJPUl9JTzsKKyAgICB9CisgICAgc3dpdGNoIChyZXMpCisgICAg
eworICAgIGNhc2UgdXNicmVkaXJob3N0X3JlYWRfaW9fZXJyb3I6CisgICAgICAgIHJlcyA9IFVT
Ql9SRURJUl9FUlJPUl9JTzsKKyAgICAgICAgYnJlYWs7CisgICAgY2FzZSB1c2JyZWRpcmhvc3Rf
cmVhZF9wYXJzZV9lcnJvcjoKKyAgICAgICAgcmVzID0gVVNCX1JFRElSX0VSUk9SX1JFQURfUEFS
U0U7CisgICAgICAgIGJyZWFrOworICAgIGNhc2UgdXNicmVkaXJob3N0X3JlYWRfZGV2aWNlX3Jl
amVjdGVkOgorICAgICAgICByZXMgPSBVU0JfUkVESVJfRVJST1JfREVWX1JFSkVDVEVEOworICAg
ICAgICBicmVhazsKKyAgICBjYXNlIHVzYnJlZGlyaG9zdF9yZWFkX2RldmljZV9sb3N0OgorICAg
ICAgICByZXMgPSBVU0JfUkVESVJfRVJST1JfREVWX0xPU1Q7CisgICAgICAgIGJyZWFrOworICAg
IH0KKyAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAsICVkIGJ5dGVzLCByZXMgJWQiLCBfX0ZVTkNU
SU9OX18sIGNoLCBjb3VudCwgcmVzKTsKKworICAgIHJldHVybiByZXM7Cit9CisKK0dFcnJvciAq
c3BpY2VfdXNiX2JhY2tlbmRfZ2V0X2Vycm9yX2RldGFpbHMoaW50IGVycm9yX2NvZGUsIGdjaGFy
ICpkZXNjKQoreworICAgIEdFcnJvciAqZXJyOworICAgIHN3aXRjaCAoZXJyb3JfY29kZSkgewor
ICAgICAgICBjYXNlIFVTQl9SRURJUl9FUlJPUl9SRUFEX1BBUlNFOgorICAgICAgICAgICAgZXJy
ID0gZ19lcnJvcl9uZXcoU1BJQ0VfQ0xJRU5UX0VSUk9SLCBTUElDRV9DTElFTlRfRVJST1JfRkFJ
TEVELAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXygidXNicmVkaXIgcHJvdG9jb2wg
cGFyc2UgZXJyb3IgZm9yICVzIiksIGRlc2MpOworICAgICAgICAgICAgYnJlYWs7CisgICAgICAg
IGNhc2UgVVNCX1JFRElSX0VSUk9SX0RFVl9SRUpFQ1RFRDoKKyAgICAgICAgICAgIGVyciA9IGdf
ZXJyb3JfbmV3KFNQSUNFX0NMSUVOVF9FUlJPUiwgU1BJQ0VfQ0xJRU5UX0VSUk9SX1VTQl9ERVZJ
Q0VfUkVKRUNURUQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfKCIlcyByZWplY3Rl
ZCBieSBob3N0IiksIGRlc2MpOworICAgICAgICAgICAgYnJlYWs7CisgICAgICAgIGNhc2UgVVNC
X1JFRElSX0VSUk9SX0RFVl9MT1NUOgorICAgICAgICAgICAgZXJyID0gZ19lcnJvcl9uZXcoU1BJ
Q0VfQ0xJRU5UX0VSUk9SLCBTUElDRV9DTElFTlRfRVJST1JfVVNCX0RFVklDRV9MT1NULAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgXygiJXMgZGlzY29ubmVjdGVkIChmYXRhbCBJTyBl
cnJvcikiKSwgZGVzYyk7CisgICAgICAgICAgICBicmVhazsKKyAgICAgICAgZGVmYXVsdDoKKyAg
ICAgICAgICAgIGVyciA9IGdfZXJyb3JfbmV3KFNQSUNFX0NMSUVOVF9FUlJPUiwgU1BJQ0VfQ0xJ
RU5UX0VSUk9SX0ZBSUxFRCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8oIlVua25v
d24gZXJyb3IgKCVkKSBmb3IgJXMiKSwgZXJyb3JfY29kZSwgZGVzYyk7CisgICAgICAgICAgICB9
CisgICAgcmV0dXJuIGVycjsKK30KKwordm9pZCBzcGljZV91c2JfYmFja2VuZF9yZXR1cm5fd3Jp
dGVfZGF0YShTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCwgdm9pZCAqZGF0YSkKK3sKKyAgICBp
ZiAoY2gtPnVzYnJlZGlyaG9zdCkgeworICAgICAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAiLCBf
X0ZVTkNUSU9OX18sIGNoKTsKKyAgICAgICAgdXNicmVkaXJob3N0X2ZyZWVfd3JpdGVfYnVmZmVy
KGNoLT51c2JyZWRpcmhvc3QsIGRhdGEpOworICAgIH0gZWxzZSB7CisgICAgICAgIFNQSUNFX0RF
QlVHKCIlcyBjaCAlcCAtIE5PQk9EWSBUTyBDQUxMIiwgX19GVU5DVElPTl9fLCBjaCk7CisgICAg
fQorfQorCitnYm9vbGVhbiBzcGljZV91c2JfYmFja2VuZF9jaGFubmVsX2F0dGFjaChTcGljZVVz
YkJhY2tlbmRDaGFubmVsICpjaCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2LAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgR0Vycm9yICoqZXJyb3IpCit7CisgICAgU1BJQ0VfREVCVUco
IiVzID4+IGNoICVwLCBkZXYgJXAgKHdhcyBhdHRhY2hlZCAlcCkiLCBfX0ZVTkNUSU9OX18sIGNo
LCBkZXYsIGNoLT5hdHRhY2hlZCk7CisKKyAgICBnX3JldHVybl92YWxfaWZfZmFpbChkZXYgIT0g
TlVMTCwgRkFMU0UpOworCisgICAgbGlidXNiX2RldmljZV9oYW5kbGUgKmhhbmRsZSA9IE5VTEw7
CisgICAgaW50IHJjID0gbGlidXNiX29wZW4oZGV2LT5saWJ1c2JfZGV2aWNlLCAmaGFuZGxlKTsK
KyAgICBpZiAocmMpIHsKKyAgICAgICAgY29uc3QgY2hhciAqZGVzYyA9IGxpYnVzYl9zdHJlcnJv
cihyYyk7CisgICAgICAgIGdfc2V0X2Vycm9yKGVycm9yLCBTUElDRV9DTElFTlRfRVJST1IsIFNQ
SUNFX0NMSUVOVF9FUlJPUl9GQUlMRUQsCisgICAgICAgICAgICJFcnJvciBsaWJ1c2Jfb3Blbjog
JXMgWyVpXSIsIGRlc2MsIHJjKTsKKyAgICAgICAgcmV0dXJuIEZBTFNFOworICAgIH0KKyAgICBj
aC0+ZXJyb3IgPSBlcnJvcjsKKyAgICByYyA9IHVzYnJlZGlyaG9zdF9zZXRfZGV2aWNlKGNoLT51
c2JyZWRpcmhvc3QsIGhhbmRsZSk7CisgICAgaWYgKHJjKSB7CisgICAgICAgIFNQSUNFX0RFQlVH
KCIlcyBjaCAlcCwgZGV2ICVwIHVzYnJlZGlyaG9zdCBlcnJvciAlZCIsIF9fRlVOQ1RJT05fXywg
Y2gsIGRldiwgcmMpOworICAgICAgICBjaC0+ZXJyb3IgPSBOVUxMOworICAgICAgICByZXR1cm4g
RkFMU0U7CisgICAgfSBlbHNlIHsKKyAgICAgICAgY2gtPmF0dGFjaGVkID0gZGV2OworICAgICAg
ICBkZXYtPmF0dGFjaGVkX3RvID0gY2g7CisgICAgfQorICAgIGNoLT5lcnJvciA9IE5VTEw7Cisg
ICAgcmV0dXJuIFRSVUU7Cit9CisKK3ZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9kZXRh
Y2goU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gpCit7CisgICAgU1BJQ0VfREVCVUcoIiVzID4+
IGNoICVwLCB3YXMgYXR0YWNoZWQgJXAiLCBfX0ZVTkNUSU9OX18sIGNoLCBjaC0+YXR0YWNoZWQp
OworICAgIGlmICghY2gtPmF0dGFjaGVkKSB7CisgICAgICAgIFNQSUNFX0RFQlVHKCIlczogbm90
aGluZyB0byBkZXRhY2giLCBfX0ZVTkNUSU9OX18pOworICAgICAgICByZXR1cm47CisgICAgfQor
ICAgIGlmIChjaC0+dXNicmVkaXJob3N0KSB7CisgICAgICAgIC8qIGl0IHdpbGwgY2FsbCBsaWJ1
c2JfY2xvc2UgaW50ZXJuYWxseSAqLworICAgICAgICB1c2JyZWRpcmhvc3Rfc2V0X2RldmljZShj
aC0+dXNicmVkaXJob3N0LCBOVUxMKTsKKyAgICB9CisgICAgU1BJQ0VfREVCVUcoIiVzIGNoICVw
LCBkZXRhY2ggZG9uZSIsIF9fRlVOQ1RJT05fXywgY2gpOworICAgIGNoLT5hdHRhY2hlZC0+YXR0
YWNoZWRfdG8gPSBOVUxMOworICAgIGNoLT5hdHRhY2hlZCA9IE5VTEw7Cit9CisKK1NwaWNlVXNi
QmFja2VuZENoYW5uZWwgKnNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfbmV3KFNwaWNlVXNiQmFj
a2VuZCAqYmUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB2b2lkICp1c2VyX2RhdGEpCit7CisgICAgU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAq
Y2g7CisKKyAgICBnX3JldHVybl92YWxfaWZfZmFpbChTUElDRV9JU19VU0JSRURJUl9DSEFOTkVM
KHVzZXJfZGF0YSksIE5VTEwpOworCisgICAgY2ggPSBnX25ldzAoU3BpY2VVc2JCYWNrZW5kQ2hh
bm5lbCwgMSk7CisgICAgU1BJQ0VfREVCVUcoIiVzID4+IiwgX19GVU5DVElPTl9fKTsKKyAgICBj
aC0+dXNlcl9kYXRhID0gU1BJQ0VfVVNCUkVESVJfQ0hBTk5FTCh1c2VyX2RhdGEpOworICAgIGlm
IChiZS0+bGlidXNiX2NvbnRleHQpIHsKKyAgICAgICAgY2gtPnVzYnJlZGlyaG9zdCA9IHVzYnJl
ZGlyaG9zdF9vcGVuX2Z1bGwoCisgICAgICAgICAgICBiZS0+bGlidXNiX2NvbnRleHQsCisgICAg
ICAgICAgICBOVUxMLAorICAgICAgICAgICAgdXNicmVkaXJfbG9nLAorICAgICAgICAgICAgdXNi
cmVkaXJfcmVhZF9jYWxsYmFjaywKKyAgICAgICAgICAgIHVzYnJlZGlyX3dyaXRlX2NhbGxiYWNr
LAorICAgICAgICAgICAgdXNicmVkaXJfd3JpdGVfZmx1c2hfY2FsbGJhY2ssCisgICAgICAgICAg
ICB1c2JyZWRpcl9hbGxvY19sb2NrLAorICAgICAgICAgICAgdXNicmVkaXJfbG9ja19sb2NrLAor
ICAgICAgICAgICAgdXNicmVkaXJfdW5sb2NrX2xvY2ssCisgICAgICAgICAgICB1c2JyZWRpcl9m
cmVlX2xvY2ssCisgICAgICAgICAgICBjaCwgUEFDS0FHRV9TVFJJTkcsCisgICAgICAgICAgICBz
cGljZV91dGlsX2dldF9kZWJ1ZygpID8gdXNicmVkaXJwYXJzZXJfZGVidWcgOiB1c2JyZWRpcnBh
cnNlcl93YXJuaW5nLAorICAgICAgICAgICAgdXNicmVkaXJob3N0X2ZsX3dyaXRlX2NiX293bnNf
YnVmZmVyKTsKKyAgICAgICAgZ193YXJuX2lmX2ZhaWwoY2gtPnVzYnJlZGlyaG9zdCAhPSBOVUxM
KTsKKyAgICB9CisgICAgaWYgKGNoLT51c2JyZWRpcmhvc3QpIHsKKyAgICAgICAgdXNicmVkaXJo
b3N0X3NldF9idWZmZXJlZF9vdXRwdXRfc2l6ZV9jYihjaC0+dXNicmVkaXJob3N0LCB1c2JyZWRp
cl9idWZmZXJlZF9vdXRwdXRfc2l6ZV9jYWxsYmFjayk7CisgICAgfSBlbHNlIHsKKyAgICAgICAg
Z19mcmVlKGNoKTsKKyAgICAgICAgY2ggPSBOVUxMOworICAgIH0KKworICAgIFNQSUNFX0RFQlVH
KCIlcyA8PCAlcCIsIF9fRlVOQ1RJT05fXywgY2gpOworICAgIHJldHVybiBjaDsKK30KKwordm9p
ZCBzcGljZV91c2JfYmFja2VuZF9jaGFubmVsX2ZsdXNoX3dyaXRlcyhTcGljZVVzYkJhY2tlbmRD
aGFubmVsICpjaCkKK3sKKyAgICBTUElDRV9ERUJVRygiJXMgJXAsIGhvc3QgJXAiLCBfX0ZVTkNU
SU9OX18sIGNoLCBjaC0+dXNicmVkaXJob3N0KTsKKyAgICBpZiAoY2gtPnVzYnJlZGlyaG9zdCkg
eworICAgICAgICB1c2JyZWRpcmhvc3Rfd3JpdGVfZ3Vlc3RfZGF0YShjaC0+dXNicmVkaXJob3N0
KTsKKyAgICB9Cit9CisKK3ZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9kZWxldGUoU3Bp
Y2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gpCit7CisgICAgU1BJQ0VfREVCVUcoIiVzID4+ICVwIiwg
X19GVU5DVElPTl9fLCBjaCk7CisgICAgaWYgKCFjaCkgeworICAgICAgICByZXR1cm47CisgICAg
fQorICAgIGlmIChjaC0+dXNicmVkaXJob3N0KSB7CisgICAgICAgIHVzYnJlZGlyaG9zdF9jbG9z
ZShjaC0+dXNicmVkaXJob3N0KTsKKyAgICB9CisKKyAgICBpZiAoY2gtPnJ1bGVzKSB7CisgICAg
ICAgIGdfZnJlZShjaC0+cnVsZXMpOworICAgIH0KKworICAgIGdfZnJlZShjaCk7CisgICAgU1BJ
Q0VfREVCVUcoIiVzIDw8ICVwIiwgX19GVU5DVElPTl9fLCBjaCk7Cit9CisKK3ZvaWQKK3NwaWNl
X3VzYl9iYWNrZW5kX2NoYW5uZWxfZ2V0X2d1ZXN0X2ZpbHRlcihTcGljZVVzYkJhY2tlbmRDaGFu
bmVsICpjaCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25z
dCBzdHJ1Y3QgdXNicmVkaXJmaWx0ZXJfcnVsZSAqKnIsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgaW50ICpjb3VudCkKK3sKKyAgICBpbnQgaTsKKyAgICAqciA9
IE5VTEw7CisgICAgKmNvdW50ID0gMDsKKyAgICBpZiAoY2gtPnVzYnJlZGlyaG9zdCkgeworICAg
ICAgICB1c2JyZWRpcmhvc3RfZ2V0X2d1ZXN0X2ZpbHRlcihjaC0+dXNicmVkaXJob3N0LCByLCBj
b3VudCk7CisgICAgfQorICAgIGlmICgqciA9PSBOVUxMKSB7CisgICAgICAgICpyID0gY2gtPnJ1
bGVzOworICAgICAgICAqY291bnQgPSBjaC0+cnVsZXNfY291bnQ7CisgICAgfQorCisgICAgU1BJ
Q0VfREVCVUcoIiVzIGNoICVwOiAlZCBmaWx0ZXJzIiwgX19GVU5DVElPTl9fLCBjaCwgKmNvdW50
KTsKKworICAgIGZvciAoaSA9IDA7IGkgPCAqY291bnQ7IGkrKykgeworICAgICAgICBjb25zdCBz
dHJ1Y3QgdXNicmVkaXJmaWx0ZXJfcnVsZSAqcmEgPSAqcjsKKyAgICAgICAgU1BJQ0VfREVCVUco
IiVzIGNsYXNzICVkLCAlWDolWCIsCisgICAgICAgICAgICByYVtpXS5hbGxvdyA/ICJhbGxvd2Vk
IiA6ICJkZW5pZWQiLCByYVtpXS5kZXZpY2VfY2xhc3MsCisgICAgICAgICAgICAodWludDMyX3Qp
cmFbaV0udmVuZG9yX2lkLCAodWludDMyX3QpcmFbaV0ucHJvZHVjdF9pZCk7CisgICAgfQorfQor
CisjZW5kaWYgLyogVVNCX1JFRElSICovCmRpZmYgLS1naXQgYS9zcmMvdXNiLWJhY2tlbmQuaCBi
L3NyYy91c2ItYmFja2VuZC5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwLi45
ZjJhOTdhNgotLS0gL2Rldi9udWxsCisrKyBiL3NyYy91c2ItYmFja2VuZC5oCkBAIC0wLDAgKzEs
MTAyIEBACisvKiAtKi0gTW9kZTogQzsgYy1iYXNpYy1vZmZzZXQ6IDQ7IGluZGVudC10YWJzLW1v
ZGU6IG5pbCAtKi0gKi8KKy8qCisgICAgQ29weXJpZ2h0IChDKSAyMDE4IFJlZCBIYXQsIEluYy4K
KworICAgIFJlZCBIYXQgQXV0aG9yczoKKyAgICBZdXJpIEJlbmRpdG92aWNoPHliZW5kaXRvQHJl
ZGhhdC5jb20+CisKKyAgICBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiBy
ZWRpc3RyaWJ1dGUgaXQgYW5kL29yCisgICAgbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0
aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYworICAgIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5
IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlcgorICAgIHZlcnNpb24gMi4xIG9m
IHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgorCisg
ICAgVGhpcyBsaWJyYXJ5IGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBi
ZSB1c2VmdWwsCisgICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhl
IGltcGxpZWQgd2FycmFudHkgb2YKKyAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1Ig
QSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQorICAgIExlc3NlciBHZW5lcmFsIFB1
YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCisKKyAgICBZb3Ugc2hvdWxkIGhhdmUgcmVj
ZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCisgICAgTGljZW5z
ZSBhbG9uZyB3aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9y
Zy9saWNlbnNlcy8+LgorKi8KKworI2lmbmRlZiBfX1NQSUNFX1VTQl9CQUNLRU5EX0hfXworI2Rl
ZmluZSBfX1NQSUNFX1VTQl9CQUNLRU5EX0hfXworCisjaW5jbHVkZSA8dXNicmVkaXJmaWx0ZXIu
aD4KKyNpbmNsdWRlICJ1c2ItZGV2aWNlLW1hbmFnZXIuaCIKKworR19CRUdJTl9ERUNMUworCit0
eXBlZGVmIHN0cnVjdCBfU3BpY2VVc2JCYWNrZW5kIFNwaWNlVXNiQmFja2VuZDsKK3R5cGVkZWYg
c3RydWN0IF9TcGljZVVzYkJhY2tlbmREZXZpY2UgU3BpY2VVc2JCYWNrZW5kRGV2aWNlOwordHlw
ZWRlZiBzdHJ1Y3QgX1NwaWNlVXNiQmFja2VuZENoYW5uZWwgU3BpY2VVc2JCYWNrZW5kQ2hhbm5l
bDsKKwordHlwZWRlZiBzdHJ1Y3QgVXNiRGV2aWNlSW5mb3JtYXRpb24KK3sKKyAgICB1aW50MTZf
dCBidXM7CisgICAgdWludDE2X3QgYWRkcmVzczsKKyAgICB1aW50MTZfdCB2aWQ7CisgICAgdWlu
dDE2X3QgcGlkOworICAgIHVpbnQ4X3QgY2xhc3M7CisgICAgdWludDhfdCBzdWJjbGFzczsKKyAg
ICB1aW50OF90IHByb3RvY29sOworfSBVc2JEZXZpY2VJbmZvcm1hdGlvbjsKKwordHlwZWRlZiB2
b2lkKCp1c2JfaG90X3BsdWdfY2FsbGJhY2spKHZvaWQgKnVzZXJfZGF0YSwgU3BpY2VVc2JCYWNr
ZW5kRGV2aWNlICpkZXYsIGdib29sZWFuIGFkZGVkKTsKKworZW51bSB7CisgICAgVVNCX1JFRElS
X0VSUk9SX0lPID0gLTEsCisgICAgVVNCX1JFRElSX0VSUk9SX1JFQURfUEFSU0UgPSAtMiwKKyAg
ICBVU0JfUkVESVJfRVJST1JfREVWX1JFSkVDVEVEID0gLTMsCisgICAgVVNCX1JFRElSX0VSUk9S
X0RFVl9MT1NUID0gLTQsCit9OworCisvKiBTcGljZSBVU0IgYmFja2VuZCBBUEkgKi8KKy8qIHNl
dHMgZXJyb3Igb24gZmFpbHVyZSAqLworU3BpY2VVc2JCYWNrZW5kICpzcGljZV91c2JfYmFja2Vu
ZF9uZXcoR0Vycm9yICoqZXJyb3IpOwordm9pZCBzcGljZV91c2JfYmFja2VuZF9kZWxldGUoU3Bp
Y2VVc2JCYWNrZW5kICpjb250ZXh0KTsKKworLyoKK3JldHVybnMgbmV3bHktYWxsb2NhdGVkIG51
bGwtdGVybWluYXRlZCBsaXN0IG9mCitTcGljZVVzYkJhY2tlbmREZXZpY2UgcG9pbnRlcnMuCitU
aGUgY2FsbGVyIG11c3QgY2FsbCBzcGljZV91c2JfYmFja2VuZF9mcmVlX2RldmljZV9saXN0Cith
ZnRlciBpdCBmaW5pc2hlcyBsaXN0IHByb2Nlc3NpbmcKKyovCitTcGljZVVzYkJhY2tlbmREZXZp
Y2UgKipzcGljZV91c2JfYmFja2VuZF9nZXRfZGV2aWNlX2xpc3QoU3BpY2VVc2JCYWNrZW5kICpi
YWNrZW5kKTsKK3ZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfZnJlZV9kZXZpY2VfbGlzdChTcGljZVVz
YkJhY2tlbmREZXZpY2UgKipkZXZsaXN0KTsKK2dib29sZWFuIHNwaWNlX3VzYl9iYWNrZW5kX2hh
bmRsZV9ldmVudHMoU3BpY2VVc2JCYWNrZW5kICpiZSk7CitnYm9vbGVhbiBzcGljZV91c2JfYmFj
a2VuZF9yZWdpc3Rlcl9ob3RwbHVnKFNwaWNlVXNiQmFja2VuZCAqYmUsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKnVzZXJfZGF0YSwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNiX2hvdF9wbHVnX2NhbGxiYWNr
IHByb2MpOwordm9pZCBzcGljZV91c2JfYmFja2VuZF9kZXJlZ2lzdGVyX2hvdHBsdWcoU3BpY2VV
c2JCYWNrZW5kICpiZSk7CisKKy8qIFNwaWNlIFVTQiBiYWNrZW5kIGRldmljZSBBUEkgKi8KK1Nw
aWNlVXNiQmFja2VuZERldmljZSAqc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX3JlZihTcGljZVVz
YkJhY2tlbmREZXZpY2UgKmRldik7Cit2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV91bnJl
ZihTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldik7CitnY29uc3Rwb2ludGVyIHNwaWNlX3VzYl9i
YWNrZW5kX2RldmljZV9nZXRfbGliZGV2KFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2KTsKK2Nv
bnN0IFVzYkRldmljZUluZm9ybWF0aW9uKiBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfZ2V0X2lu
Zm8oU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYpOworZ2Jvb2xlYW4gc3BpY2VfdXNiX2JhY2tl
bmRfZGV2aWNlX2lzb2NoKFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2KTsKKy8qIHJldHVybnMg
MCBpZiB0aGUgZGV2aWNlIHBhc3NlcyB0aGUgZmlsdGVyICovCitpbnQgc3BpY2VfdXNiX2JhY2tl
bmRfZGV2aWNlX2NoZWNrX2ZpbHRlcihTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldiwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCB1c2JyZWRp
cmZpbHRlcl9ydWxlICpydWxlcywgaW50IGNvdW50KTsKKworLyogU3BpY2UgVVNCIGJhY2tlbmQg
Y2hhbm5lbCBBUEkgKi8KK1NwaWNlVXNiQmFja2VuZENoYW5uZWwgKnNwaWNlX3VzYl9iYWNrZW5k
X2NoYW5uZWxfbmV3KFNwaWNlVXNiQmFja2VuZCAqY29udGV4dCwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgICAgICAgICAgICAqdXNl
cl9kYXRhKTsKK3ZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9kZWxldGUoU3BpY2VVc2JC
YWNrZW5kQ2hhbm5lbCAqY2gpOworLyogcmV0dXJucyAwIGZvciBzdWNjZXNzIG9yIGVycm9yIGNv
ZGUgKi8KK2ludCBzcGljZV91c2JfYmFja2VuZF9yZWFkX2d1ZXN0X2RhdGEoU3BpY2VVc2JCYWNr
ZW5kQ2hhbm5lbCAqY2gsIHVpbnQ4X3QgKmRhdGEsIGludCBjb3VudCk7CitHRXJyb3IgKnNwaWNl
X3VzYl9iYWNrZW5kX2dldF9lcnJvcl9kZXRhaWxzKGludCBlcnJvcl9jb2RlLCBnY2hhciAqZGV2
aWNlX2Rlc2MpOworZ2Jvb2xlYW4gc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9hdHRhY2goU3Bp
Y2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldiwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIEdFcnJvciAqKmVycm9yKTsKK3ZvaWQgc3BpY2VfdXNi
X2JhY2tlbmRfY2hhbm5lbF9kZXRhY2goU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gpOwordm9p
ZCBzcGljZV91c2JfYmFja2VuZF9jaGFubmVsX2ZsdXNoX3dyaXRlcyhTcGljZVVzYkJhY2tlbmRD
aGFubmVsICpjaCk7Cit2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfZ2V0X2d1ZXN0X2Zp
bHRlcihTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCB1c2JyZWRpcmZpbHRlcl9ydWxl
ICAqKnJ1bGVzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgaW50ICpjb3VudCk7Cit2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX3JldHVybl93cml0ZV9kYXRh
KFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLCB2b2lkICpkYXRhKTsKKworR19FTkRfREVDTFMK
KworI2VuZGlmCmRpZmYgLS1naXQgYS9zcmMvdXNiLWRldmljZS1tYW5hZ2VyLXByaXYuaCBiL3Ny
Yy91c2ItZGV2aWNlLW1hbmFnZXItcHJpdi5oCmluZGV4IDgzODg0ZDdjLi4zOWFhZjJmMyAxMDA2
NDQKLS0tIGEvc3JjL3VzYi1kZXZpY2UtbWFuYWdlci1wcml2LmgKKysrIGIvc3JjL3VzYi1kZXZp
Y2UtbWFuYWdlci1wcml2LmgKQEAgLTMyLDcgKzMyLDYgQEAgdm9pZCBzcGljZV91c2JfZGV2aWNl
X21hbmFnZXJfc3RvcF9ldmVudF9saXN0ZW5pbmcoCiAgICAgU3BpY2VVc2JEZXZpY2VNYW5hZ2Vy
ICptYW5hZ2VyKTsKIAogI2lmZGVmIFVTRV9VU0JSRURJUgotI2luY2x1ZGUgPGxpYnVzYi5oPgog
dm9pZCBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfZGV2aWNlX2Vycm9yKAogICAgIFNwaWNlVXNi
RGV2aWNlTWFuYWdlciAqbWFuYWdlciwgU3BpY2VVc2JEZXZpY2UgKmRldmljZSwgR0Vycm9yICpl
cnIpOwogCmRpZmYgLS1naXQgYS9zcmMvdXNiLWRldmljZS1tYW5hZ2VyLmMgYi9zcmMvdXNiLWRl
dmljZS1tYW5hZ2VyLmMKaW5kZXggOTM5MWQ2YWMuLjJiZWU1NWQxIDEwMDY0NAotLS0gYS9zcmMv
dXNiLWRldmljZS1tYW5hZ2VyLmMKKysrIGIvc3JjL3VzYi1kZXZpY2UtbWFuYWdlci5jCkBAIC0y
NSwxNSArMjUsMTQgQEAKIAogI2lmZGVmIFVTRV9VU0JSRURJUgogI2luY2x1ZGUgPGVycm5vLmg+
Ci0jaW5jbHVkZSA8bGlidXNiLmg+CiAKICNpZmRlZiBHX09TX1dJTjMyCisjaW5jbHVkZSA8d2lu
ZG93cy5oPgogI2luY2x1ZGUgInVzYmRrX2FwaS5oIgogI2luY2x1ZGUgIndpbi11c2ItZGV2Lmgi
CiAjZW5kaWYKIAogI2luY2x1ZGUgImNoYW5uZWwtdXNicmVkaXItcHJpdi5oIgotI2luY2x1ZGUg
InVzYnJlZGlyaG9zdC5oIgogI2luY2x1ZGUgInVzYnV0aWwuaCIKICNlbmRpZgogCkBAIC05NCw3
ICs5Myw3IEBAIHN0cnVjdCBfU3BpY2VVc2JEZXZpY2VNYW5hZ2VyUHJpdmF0ZSB7CiAgICAgZ2No
YXIgKmF1dG9fY29ubmVjdF9maWx0ZXI7CiAgICAgZ2NoYXIgKnJlZGlyZWN0X29uX2Nvbm5lY3Q7
CiAjaWZkZWYgVVNFX1VTQlJFRElSCi0gICAgbGlidXNiX2NvbnRleHQgKmNvbnRleHQ7CisgICAg
U3BpY2VVc2JCYWNrZW5kICpjb250ZXh0OwogICAgIGludCBldmVudF9saXN0ZW5lcnM7CiAgICAg
R1RocmVhZCAqZXZlbnRfdGhyZWFkOwogICAgIGdpbnQgZXZlbnRfdGhyZWFkX3J1bjsKQEAgLTEw
Niw3ICsxMDUsNiBAQCBzdHJ1Y3QgX1NwaWNlVXNiRGV2aWNlTWFuYWdlclByaXZhdGUgewogICAg
IEdVZGV2Q2xpZW50ICp1ZGV2OwogI2Vsc2UKICAgICBnYm9vbGVhbiByZWRpcmVjdGluZzsgLyog
SGFuZGxlZCBieSBHVWRldkNsaWVudCBpbiB0aGUgZ3VkZXYgY2FzZSAqLwotICAgIGxpYnVzYl9o
b3RwbHVnX2NhbGxiYWNrX2hhbmRsZSBocF9oYW5kbGU7CiAjZW5kaWYKICNpZmRlZiBHX09TX1dJ
TjMyCiAgICAgdXNiZGtfYXBpX3dyYXBwZXIgICAgICp1c2Jka19hcGk7CkBAIC0xMzYsNyArMTM0
LDcgQEAgdHlwZWRlZiBzdHJ1Y3QgX1NwaWNlVXNiRGV2aWNlSW5mbyB7CiAgICAgZ3VpbnQxNiB2
aWQ7CiAgICAgZ3VpbnQxNiBwaWQ7CiAgICAgZ2Jvb2xlYW4gaXNvY2hyb25vdXM7Ci0gICAgbGli
dXNiX2RldmljZSAqbGliZGV2OworICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqYmRldjsKICAg
ICBnaW50ICAgIHJlZjsKIH0gU3BpY2VVc2JEZXZpY2VJbmZvOwogCkBAIC0xNDksMTkgKzE0Nywx
OCBAQCBzdGF0aWMgdm9pZCBjaGFubmVsX2V2ZW50KFNwaWNlQ2hhbm5lbCAqY2hhbm5lbCwgU3Bp
Y2VDaGFubmVsRXZlbnQgZXZlbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGdwb2ludGVy
IHVzZXJfZGF0YSk7CiAjaWZkZWYgR19PU19XSU4zMgogc3RhdGljIHZvaWQgc3BpY2VfdXNiX2Rl
dmljZV9tYW5hZ2VyX3VldmVudF9jYihHVWRldkNsaWVudCAgICAgKmNsaWVudCwKLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlidXNiX2RldmljZSAgICp1
ZGV2aWNlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBT
cGljZVVzYkJhY2tlbmREZXZpY2UgKnVkZXZpY2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGdib29sZWFuICAgICAgICAgYWRkLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncG9pbnRlciAgICAgICAgIHVzZXJf
ZGF0YSk7CiAjZWxzZQotc3RhdGljIGludCBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfaG90cGx1
Z19jYihsaWJ1c2JfY29udGV4dCAgICAgICAqY3R4LAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBsaWJ1c2JfZGV2aWNlICAgICAgICAqZGV2aWNlLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ1c2JfaG90cGx1
Z19ldmVudCAgZXZlbnQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHZvaWQgICAgICAgICAgICAgICAgICpkYXRhKTsKK3N0YXRpYyB2b2lkIHNwaWNlX3Vz
Yl9kZXZpY2VfbWFuYWdlcl9ob3RwbHVnX2NiKHZvaWQgKnVzZXJfZGF0YSwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNlVXNiQmFja2VuZERldmlj
ZSAqZGV2LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Z2Jvb2xlYW4gYWRkZWQpOwogI2VuZGlmCiBzdGF0aWMgdm9pZCBzcGljZV91c2JfZGV2aWNlX21h
bmFnZXJfY2hlY2tfcmVkaXJfb25fY29ubmVjdCgKICAgICBTcGljZVVzYkRldmljZU1hbmFnZXIg
KnNlbGYsIFNwaWNlQ2hhbm5lbCAqY2hhbm5lbCk7CiAKLXN0YXRpYyBTcGljZVVzYkRldmljZUlu
Zm8gKnNwaWNlX3VzYl9kZXZpY2VfbmV3KGxpYnVzYl9kZXZpY2UgKmxpYmRldik7CitzdGF0aWMg
U3BpY2VVc2JEZXZpY2VJbmZvICpzcGljZV91c2JfZGV2aWNlX25ldyhTcGljZVVzYkJhY2tlbmRE
ZXZpY2UgKmJkZXYpOwogc3RhdGljIFNwaWNlVXNiRGV2aWNlICpzcGljZV91c2JfZGV2aWNlX3Jl
ZihTcGljZVVzYkRldmljZSAqZGV2aWNlKTsKIHN0YXRpYyB2b2lkIHNwaWNlX3VzYl9kZXZpY2Vf
dW5yZWYoU3BpY2VVc2JEZXZpY2UgKmRldmljZSk7CiAKQEAgLTE3MCwxMiArMTY3LDEyIEBAIHN0
YXRpYyB2b2lkIF91c2Jka19oaWRlcl91cGRhdGUoU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICptYW5h
Z2VyKTsKIHN0YXRpYyB2b2lkIF91c2Jka19oaWRlcl9jbGVhcihTcGljZVVzYkRldmljZU1hbmFn
ZXIgKm1hbmFnZXIpOwogI2VuZGlmCiAKLXN0YXRpYyBnYm9vbGVhbiBzcGljZV91c2JfbWFuYWdl
cl9kZXZpY2VfZXF1YWxfbGliZGV2KFNwaWNlVXNiRGV2aWNlTWFuYWdlciAqbWFuYWdlciwKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNl
VXNiRGV2aWNlICpkZXZpY2UsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBsaWJ1c2JfZGV2aWNlICpsaWJkZXYpOwotc3RhdGljIGxpYnVzYl9k
ZXZpY2UgKgotc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2RldmljZV90b19saWJkZXYoU3BpY2VV
c2JEZXZpY2VNYW5hZ2VyICpzZWxmLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgU3BpY2VVc2JEZXZpY2UgKmRldmljZSk7CitzdGF0aWMgZ2Jvb2xlYW4gc3BpY2Vf
dXNiX21hbmFnZXJfZGV2aWNlX2VxdWFsX2JkZXYoU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICptYW5h
Z2VyLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFNwaWNlVXNiRGV2aWNlICpkZXZpY2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpiZGV2KTsKK3N0YXRp
YyBTcGljZVVzYkJhY2tlbmREZXZpY2UgKgorc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2Rldmlj
ZV90b19iZGV2KFNwaWNlVXNiRGV2aWNlTWFuYWdlciAqc2VsZiwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBTcGljZVVzYkRldmljZSAqZGV2aWNlKTsKIAogc3RhdGlj
IHZvaWQKIF9zcGljZV91c2JfZGV2aWNlX21hbmFnZXJfY29ubmVjdF9kZXZpY2VfYXN5bmMoU3Bp
Y2VVc2JEZXZpY2VNYW5hZ2VyICpzZWxmLApAQCAtMjc3LDE0ICsyNzQsOSBAQCBzdGF0aWMgZ2Jv
b2xlYW4gc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2luaXRhYmxlX2luaXQoR0luaXRhYmxlICAq
aW5pdGFibGUsCiAgICAgR0xpc3QgKml0OwogCiAjaWZuZGVmIEdfT1NfV0lOMzIKLSAgICBpbnQg
cmM7CiAgICAgLyogSW5pdGlhbGl6ZSBsaWJ1c2IgKi8KLSAgICByYyA9IGxpYnVzYl9pbml0KCZw
cml2LT5jb250ZXh0KTsKLSAgICBpZiAocmMgPCAwKSB7Ci0gICAgICAgIGNvbnN0IGNoYXIgKmRl
c2MgPSBsaWJ1c2Jfc3RyZXJyb3IocmMpOwotICAgICAgICBnX3dhcm5pbmcoIkVycm9yIGluaXRp
YWxpemluZyBVU0Igc3VwcG9ydDogJXMgWyVpXSIsIGRlc2MsIHJjKTsKLSAgICAgICAgZ19zZXRf
ZXJyb3IoZXJyLCBTUElDRV9DTElFTlRfRVJST1IsIFNQSUNFX0NMSUVOVF9FUlJPUl9GQUlMRUQs
Ci0gICAgICAgICAgICAgICAgICAgICJFcnJvciBpbml0aWFsaXppbmcgVVNCIHN1cHBvcnQ6ICVz
IFslaV0iLCBkZXNjLCByYyk7CisgICAgcHJpdi0+Y29udGV4dCA9IHNwaWNlX3VzYl9iYWNrZW5k
X25ldyhlcnIpOworICAgIGlmICghcHJpdi0+Y29udGV4dCkgewogICAgICAgICByZXR1cm4gRkFM
U0U7CiAgICAgfQogI2VuZGlmCkBAIC0zMDIsMTYgKzI5NCw4IEBAIHN0YXRpYyBnYm9vbGVhbiBz
cGljZV91c2JfZGV2aWNlX21hbmFnZXJfaW5pdGFibGVfaW5pdChHSW5pdGFibGUgICppbml0YWJs
ZSwKICAgICAvKiBEbyBjb2xkcGx1ZyAoZGV0ZWN0aW9uIG9mIGFscmVhZHkgY29ubmVjdGVkIGRl
dmljZXMpICovCiAgICAgZ191ZGV2X2NsaWVudF9yZXBvcnRfZGV2aWNlcyhwcml2LT51ZGV2KTsK
ICNlbHNlCi0gICAgcmMgPSBsaWJ1c2JfaG90cGx1Z19yZWdpc3Rlcl9jYWxsYmFjayhwcml2LT5j
b250ZXh0LAotICAgICAgICBMSUJVU0JfSE9UUExVR19FVkVOVF9ERVZJQ0VfQVJSSVZFRCB8IExJ
QlVTQl9IT1RQTFVHX0VWRU5UX0RFVklDRV9MRUZULAotICAgICAgICBMSUJVU0JfSE9UUExVR19F
TlVNRVJBVEUsIExJQlVTQl9IT1RQTFVHX01BVENIX0FOWSwKLSAgICAgICAgTElCVVNCX0hPVFBM
VUdfTUFUQ0hfQU5ZLCBMSUJVU0JfSE9UUExVR19NQVRDSF9BTlksCi0gICAgICAgIHNwaWNlX3Vz
Yl9kZXZpY2VfbWFuYWdlcl9ob3RwbHVnX2NiLCBzZWxmLCAmcHJpdi0+aHBfaGFuZGxlKTsKLSAg
ICBpZiAocmMgPCAwKSB7Ci0gICAgICAgIGNvbnN0IGNoYXIgKmRlc2MgPSBsaWJ1c2Jfc3RyZXJy
b3IocmMpOwotICAgICAgICBnX3dhcm5pbmcoIkVycm9yIGluaXRpYWxpemluZyBVU0IgaG90cGx1
ZyBzdXBwb3J0OiAlcyBbJWldIiwgZGVzYywgcmMpOwotICAgICAgICBnX3NldF9lcnJvcihlcnIs
IFNQSUNFX0NMSUVOVF9FUlJPUiwgU1BJQ0VfQ0xJRU5UX0VSUk9SX0ZBSUxFRCwKLSAgICAgICAg
ICAgICAgICAgICJFcnJvciBpbml0aWFsaXppbmcgVVNCIGhvdHBsdWcgc3VwcG9ydDogJXMgWyVp
XSIsIGRlc2MsIHJjKTsKKyAgICBpZiAoIXNwaWNlX3VzYl9iYWNrZW5kX3JlZ2lzdGVyX2hvdHBs
dWcocHJpdi0+Y29udGV4dCwgc2VsZiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2hvdHBsdWdfY2IpKSB7CiAgICAg
ICAgIHJldHVybiBGQUxTRTsKICAgICB9CiAgICAgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX3N0
YXJ0X2V2ZW50X2xpc3RlbmluZyhzZWxmLCBOVUxMKTsKQEAgLTM0MiwyMSArMzI2LDE3IEBAIHN0
YXRpYyB2b2lkIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9kaXNwb3NlKEdPYmplY3QgKmdvYmpl
Y3QpCiAgICAgU3BpY2VVc2JEZXZpY2VNYW5hZ2VyUHJpdmF0ZSAqcHJpdiA9IHNlbGYtPnByaXY7
CiAKICNpZm5kZWYgR19PU19XSU4zMgotICAgIGlmIChwcml2LT5ocF9oYW5kbGUpIHsKLSAgICAg
ICAgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX3N0b3BfZXZlbnRfbGlzdGVuaW5nKHNlbGYpOwot
ICAgICAgICBpZiAoZ19hdG9taWNfaW50X2dldCgmcHJpdi0+ZXZlbnRfdGhyZWFkX3J1bikpIHsK
LSAgICAgICAgICAgIC8qIEZvcmNlIHRlcm1pbmF0aW9uIG9mIHRoZSBldmVudCB0aHJlYWQgZXZl
biBpZiB0aGVyZSB3ZXJlIHNvbWUKLSAgICAgICAgICAgICAqIG1pc21hdGNoZWQgc3BpY2VfdXNi
X2RldmljZV9tYW5hZ2VyX3tzdGFydCxzdG9wfV9ldmVudF9saXN0ZW5pbmcKLSAgICAgICAgICAg
ICAqIGNhbGxzLiBPdGhlcndpc2UsIHRoZSB1c2IgZXZlbnQgdGhyZWFkIHdpbGwgYmUgbGVha2Vk
LCBhbmQgd2lsbAotICAgICAgICAgICAgICogdHJ5IHRvIHVzZSB0aGUgbGlidXNiIGNvbnRleHQg
d2UgZGVzdHJveSBpbiBmaW5hbGl6ZSgpLCB3aGljaCB3b3VsZAotICAgICAgICAgICAgICogY2F1
c2UgYSBjcmFzaCAqLwotICAgICAgICAgICAgIGdfd2Fybl9pZl9yZWFjaGVkKCk7Ci0gICAgICAg
ICAgICAgZ19hdG9taWNfaW50X3NldCgmcHJpdi0+ZXZlbnRfdGhyZWFkX3J1biwgRkFMU0UpOwot
ICAgICAgICB9Ci0gICAgICAgIC8qIFRoaXMgYWxzbyB3YWtlcyB1cCB0aGUgbGlidXNiX2hhbmRs
ZV9ldmVudHMoKSBpbiB0aGUgZXZlbnRfdGhyZWFkICovCi0gICAgICAgIGxpYnVzYl9ob3RwbHVn
X2RlcmVnaXN0ZXJfY2FsbGJhY2socHJpdi0+Y29udGV4dCwgcHJpdi0+aHBfaGFuZGxlKTsKLSAg
ICAgICAgcHJpdi0+aHBfaGFuZGxlID0gMDsKKyAgICBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJf
c3RvcF9ldmVudF9saXN0ZW5pbmcoc2VsZik7CisgICAgaWYgKGdfYXRvbWljX2ludF9nZXQoJnBy
aXYtPmV2ZW50X3RocmVhZF9ydW4pKSB7CisgICAgICAgIC8qIEZvcmNlIHRlcm1pbmF0aW9uIG9m
IHRoZSBldmVudCB0aHJlYWQgZXZlbiBpZiB0aGVyZSB3ZXJlIHNvbWUKKyAgICAgICAgICogbWlz
bWF0Y2hlZCBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfe3N0YXJ0LHN0b3B9X2V2ZW50X2xpc3Rl
bmluZworICAgICAgICAgKiBjYWxscy4gT3RoZXJ3aXNlLCB0aGUgdXNiIGV2ZW50IHRocmVhZCB3
aWxsIGJlIGxlYWtlZCwgYW5kIHdpbGwKKyAgICAgICAgICogdHJ5IHRvIHVzZSB0aGUgbGlidXNi
IGNvbnRleHQgd2UgZGVzdHJveSBpbiBmaW5hbGl6ZSgpLCB3aGljaCB3b3VsZAorICAgICAgICAg
KiBjYXVzZSBhIGNyYXNoICovCisgICAgICAgIGdfd2Fybl9pZl9yZWFjaGVkKCk7CisgICAgICAg
IGdfYXRvbWljX2ludF9zZXQoJnByaXYtPmV2ZW50X3RocmVhZF9ydW4sIEZBTFNFKTsKICAgICB9
CisgICAgc3BpY2VfdXNiX2JhY2tlbmRfZGVyZWdpc3Rlcl9ob3RwbHVnKHByaXYtPmNvbnRleHQp
OwogI2VuZGlmCiAgICAgaWYgKHByaXYtPmV2ZW50X3RocmVhZCkgewogICAgICAgICBnX3dhcm5f
aWZfZmFpbChnX2F0b21pY19pbnRfZ2V0KCZwcml2LT5ldmVudF90aHJlYWRfcnVuKSA9PSBGQUxT
RSk7CkBAIC0zODYsNyArMzY2LDcgQEAgc3RhdGljIHZvaWQgc3BpY2VfdXNiX2RldmljZV9tYW5h
Z2VyX2ZpbmFsaXplKEdPYmplY3QgKmdvYmplY3QpCiAgICAgZ19yZXR1cm5faWZfZmFpbChwcml2
LT5ldmVudF90aHJlYWQgPT0gTlVMTCk7CiAjaWZuZGVmIEdfT1NfV0lOMzIKICAgICBpZiAocHJp
di0+Y29udGV4dCkKLSAgICAgICAgbGlidXNiX2V4aXQocHJpdi0+Y29udGV4dCk7CisgICAgICAg
IHNwaWNlX3VzYl9iYWNrZW5kX2RlbGV0ZShwcml2LT5jb250ZXh0KTsKICNlbmRpZgogICAgIGZy
ZWUocHJpdi0+YXV0b19jb25uX2ZpbHRlcl9ydWxlcyk7CiAgICAgZnJlZShwcml2LT5yZWRpcmVj
dF9vbl9jb25uZWN0X3J1bGVzKTsKQEAgLTcwOSwzNyArNjg5LDYgQEAgc3RhdGljIHZvaWQgc3Bp
Y2VfdXNiX2RldmljZV9tYW5hZ2VyX2NsYXNzX2luaXQoU3BpY2VVc2JEZXZpY2VNYW5hZ2VyQ2xh
c3MgKmtsYXMKICAgICAgICAgICAgICAgICAgICAgIEdfVFlQRV9FUlJPUik7CiB9CiAKLSNpZmRl
ZiBVU0VfVVNCUkVESVIKLQotLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovCi0vKiBndWRldiAvIGxpYnVzYiBIZWxw
ZXIgZnVuY3Rpb25zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi8KLQotc3Rh
dGljIGdib29sZWFuIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9nZXRfZGV2aWNlX2Rlc2NyaXB0
b3IoCi0gICAgbGlidXNiX2RldmljZSAqbGliZGV2LAotICAgIHN0cnVjdCBsaWJ1c2JfZGV2aWNl
X2Rlc2NyaXB0b3IgKmRlc2MpCi17Ci0gICAgaW50IGVycmNvZGU7Ci0gICAgY29uc3QgZ2NoYXIg
KmVycnN0cjsKLQotICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKGxpYmRldiAhPSBOVUxMLCBGQUxT
RSk7Ci0gICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwoZGVzYyAgICE9IE5VTEwsIEZBTFNFKTsKLQot
ICAgIGVycmNvZGUgPSBsaWJ1c2JfZ2V0X2RldmljZV9kZXNjcmlwdG9yKGxpYmRldiwgZGVzYyk7
Ci0gICAgaWYgKGVycmNvZGUgPCAwKSB7Ci0gICAgICAgIGludCBidXMsIGFkZHI7Ci0KLSAgICAg
ICAgYnVzID0gbGlidXNiX2dldF9idXNfbnVtYmVyKGxpYmRldik7Ci0gICAgICAgIGFkZHIgPSBs
aWJ1c2JfZ2V0X2RldmljZV9hZGRyZXNzKGxpYmRldik7Ci0gICAgICAgIGVycnN0ciA9IGxpYnVz
Yl9zdHJlcnJvcihlcnJjb2RlKTsKLSAgICAgICAgZ193YXJuaW5nKCJjYW5ub3QgZ2V0IGRldmlj
ZSBkZXNjcmlwdG9yIGZvciAoJXApICVkLiVkIC0tICVzKCVkKSIsCi0gICAgICAgICAgICAgICAg
ICBsaWJkZXYsIGJ1cywgYWRkciwgZXJyc3RyLCBlcnJjb2RlKTsKLSAgICAgICAgcmV0dXJuIEZB
TFNFOwotICAgIH0KLSAgICByZXR1cm4gVFJVRTsKLX0KLQotI2VuZGlmIC8vIFVTRV9VU0JSRURJ
UgotCiAvKioKICAqIHNwaWNlX3VzYl9kZXZpY2VfZ2V0X2xpYnVzYl9kZXZpY2U6CiAgKiBAZGV2
aWNlOiAjU3BpY2VVc2JEZXZpY2UgdG8gZ2V0IHRoZSBkZXNjcmlwdG9yIGluZm9ybWF0aW9uIG9m
CkBAIC03NTgsMzIgKzcwNywxMiBAQCBzcGljZV91c2JfZGV2aWNlX2dldF9saWJ1c2JfZGV2aWNl
KGNvbnN0IFNwaWNlVXNiRGV2aWNlICpkZXZpY2UgR19HTlVDX1VOVVNFRCkKIAogICAgIGdfcmV0
dXJuX3ZhbF9pZl9mYWlsKGluZm8gIT0gTlVMTCwgRkFMU0UpOwogCi0gICAgcmV0dXJuIGluZm8t
PmxpYmRldjsKKyAgICByZXR1cm4gc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX2dldF9saWJkZXYo
aW5mby0+YmRldik7CiAjZW5kaWYKICAgICByZXR1cm4gTlVMTDsKIH0KIAogI2lmZGVmIFVTRV9V
U0JSRURJUgotc3RhdGljIGdib29sZWFuIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9nZXRfbGli
ZGV2X3ZpZF9waWQoCi0gICAgbGlidXNiX2RldmljZSAqbGliZGV2LCBpbnQgKnZpZCwgaW50ICpw
aWQpCi17Ci0gICAgc3RydWN0IGxpYnVzYl9kZXZpY2VfZGVzY3JpcHRvciBkZXNjOwotCi0gICAg
Z19yZXR1cm5fdmFsX2lmX2ZhaWwobGliZGV2ICE9IE5VTEwsIEZBTFNFKTsKLSAgICBnX3JldHVy
bl92YWxfaWZfZmFpbCh2aWQgIT0gTlVMTCwgRkFMU0UpOwotICAgIGdfcmV0dXJuX3ZhbF9pZl9m
YWlsKHBpZCAhPSBOVUxMLCBGQUxTRSk7Ci0KLSAgICAqdmlkID0gKnBpZCA9IDA7Ci0KLSAgICBp
ZiAoIXNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9nZXRfZGV2aWNlX2Rlc2NyaXB0b3IobGliZGV2
LCAmZGVzYykpIHsKLSAgICAgICAgcmV0dXJuIEZBTFNFOwotICAgIH0KLSAgICAqdmlkID0gZGVz
Yy5pZFZlbmRvcjsKLSAgICAqcGlkID0gZGVzYy5pZFByb2R1Y3Q7Ci0KLSAgICByZXR1cm4gVFJV
RTsKLX0KLQogLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tICovCiAvKiBjYWxsYmFja3MgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi8KIApAQCAtODk5LDMxICs4
MjgsMjQgQEAgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2ZpbmRfZGV2aWNlKFNwaWNlVXNiRGV2
aWNlTWFuYWdlciAqc2VsZiwKIH0KIAogc3RhdGljIHZvaWQgc3BpY2VfdXNiX2RldmljZV9tYW5h
Z2VyX2FkZF9kZXYoU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICAqc2VsZiwKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnVzYl9kZXZpY2UgICAgICAgICAgKmxp
YmRldikKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNl
VXNiQmFja2VuZERldmljZSAgKmJkZXYpCiB7CiAgICAgU3BpY2VVc2JEZXZpY2VNYW5hZ2VyUHJp
dmF0ZSAqcHJpdiA9IHNlbGYtPnByaXY7Ci0gICAgc3RydWN0IGxpYnVzYl9kZXZpY2VfZGVzY3Jp
cHRvciBkZXNjOworICAgIGNvbnN0IFVzYkRldmljZUluZm9ybWF0aW9uICpiX2luZm8gPSBzcGlj
ZV91c2JfYmFja2VuZF9kZXZpY2VfZ2V0X2luZm8oYmRldik7CiAgICAgU3BpY2VVc2JEZXZpY2Ug
KmRldmljZTsKIAotICAgIGlmICghc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2dldF9kZXZpY2Vf
ZGVzY3JpcHRvcihsaWJkZXYsICZkZXNjKSkKLSAgICAgICAgcmV0dXJuOwotCi0gICAgLyogU2tp
cCBodWJzICovCi0gICAgaWYgKGRlc2MuYkRldmljZUNsYXNzID09IExJQlVTQl9DTEFTU19IVUIp
Ci0gICAgICAgIHJldHVybjsKLQogICAgIGlmIChzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfZmlu
ZF9kZXZpY2Uoc2VsZiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGxpYnVzYl9nZXRfYnVzX251bWJlcihsaWJkZXYpLAotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgbGlidXNiX2dldF9kZXZpY2VfYWRkcmVzcyhsaWJkZXYp
KSkgeworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYl9pbmZv
LT5idXMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiX2lu
Zm8tPmFkZHJlc3MpKSB7CiAgICAgICAgIFNQSUNFX0RFQlVHKCJkZXZpY2Ugbm90IGFkZGVkICVk
OiVkICUwNHg6JTA0eCIsCi0gICAgICAgICAgICAgICAgICAgIGxpYnVzYl9nZXRfYnVzX251bWJl
cihsaWJkZXYpLAotICAgICAgICAgICAgICAgICAgICBsaWJ1c2JfZ2V0X2RldmljZV9hZGRyZXNz
KGxpYmRldiksCi0gICAgICAgICAgICAgICAgICAgIGRlc2MuaWRWZW5kb3IsCi0gICAgICAgICAg
ICAgICAgICAgIGRlc2MuaWRQcm9kdWN0KTsKKyAgICAgICAgICAgICAgICAgICAgYl9pbmZvLT5i
dXMsCisgICAgICAgICAgICAgICAgICAgIGJfaW5mby0+YWRkcmVzcywKKyAgICAgICAgICAgICAg
ICAgICAgYl9pbmZvLT52aWQsCisgICAgICAgICAgICAgICAgICAgIGJfaW5mby0+cGlkKTsKICAg
ICAgICAgcmV0dXJuOwogICAgIH0KIAotICAgIGRldmljZSA9IChTcGljZVVzYkRldmljZSopc3Bp
Y2VfdXNiX2RldmljZV9uZXcobGliZGV2KTsKKyAgICBkZXZpY2UgPSAoU3BpY2VVc2JEZXZpY2Uq
KXNwaWNlX3VzYl9kZXZpY2VfbmV3KGJkZXYpOwogICAgIGlmICghZGV2aWNlKQogICAgICAgICBy
ZXR1cm47CiAKQEAgLTkzNSwxMCArODU3LDEwIEBAIHN0YXRpYyB2b2lkIHNwaWNlX3VzYl9kZXZp
Y2VfbWFuYWdlcl9hZGRfZGV2KFNwaWNlVXNiRGV2aWNlTWFuYWdlciAgKnNlbGYsCiAgICAgICAg
IGNhbl9yZWRpcmVjdCA9IHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9jYW5fcmVkaXJlY3RfZGV2
aWNlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYsIGRldmlj
ZSwgTlVMTCk7CiAKLSAgICAgICAgYXV0b19vayA9IHVzYnJlZGlyaG9zdF9jaGVja19kZXZpY2Vf
ZmlsdGVyKAorICAgICAgICBhdXRvX29rID0gc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX2NoZWNr
X2ZpbHRlcigKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZGV2LAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHByaXYtPmF1dG9fY29ubl9maWx0ZXJfcnVsZXMsCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgcHJpdi0+YXV0b19jb25uX2ZpbHRlcl9ydWxlc19jb3VudCwKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJkZXYsIDApID09IDA7CisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgcHJpdi0+YXV0b19jb25uX2ZpbHRlcl9ydWxlc19jb3VudCkgPT0gMDsK
IAogICAgICAgICBpZiAoY2FuX3JlZGlyZWN0ICYmIGF1dG9fb2spCiAgICAgICAgICAgICBzcGlj
ZV91c2JfZGV2aWNlX21hbmFnZXJfY29ubmVjdF9kZXZpY2VfYXN5bmMoc2VsZiwKQEAgLTk1NSwx
NSArODc3LDE2IEBAIHN0YXRpYyB2b2lkIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9hZGRfZGV2
KFNwaWNlVXNiRGV2aWNlTWFuYWdlciAgKnNlbGYsCiB9CiAKIHN0YXRpYyB2b2lkIHNwaWNlX3Vz
Yl9kZXZpY2VfbWFuYWdlcl9yZW1vdmVfZGV2KFNwaWNlVXNiRGV2aWNlTWFuYWdlciAqc2VsZiwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGd1aW50IGJ1
cywgZ3VpbnQgYWRkcmVzcykKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqYmRldikKIHsKICAgICBTcGljZVVzYkRl
dmljZU1hbmFnZXJQcml2YXRlICpwcml2ID0gc2VsZi0+cHJpdjsKICAgICBTcGljZVVzYkRldmlj
ZSAqZGV2aWNlOworICAgIGNvbnN0IFVzYkRldmljZUluZm9ybWF0aW9uICpiX2luZm8gPSBzcGlj
ZV91c2JfYmFja2VuZF9kZXZpY2VfZ2V0X2luZm8oYmRldik7CiAKLSAgICBkZXZpY2UgPSBzcGlj
ZV91c2JfZGV2aWNlX21hbmFnZXJfZmluZF9kZXZpY2Uoc2VsZiwgYnVzLCBhZGRyZXNzKTsKKyAg
ICBkZXZpY2UgPSBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfZmluZF9kZXZpY2Uoc2VsZiwgYl9p
bmZvLT5idXMsIGJfaW5mby0+YWRkcmVzcyk7CiAgICAgaWYgKCFkZXZpY2UpIHsKICAgICAgICAg
Z193YXJuaW5nKCJDb3VsZCBub3QgZmluZCBVU0IgZGV2aWNlIHRvIHJlbW92ZSAiIERFVl9JRF9G
TVQsCi0gICAgICAgICAgICAgICAgICBidXMsIGFkZHJlc3MpOworICAgICAgICAgICAgICAgICAg
Yl9pbmZvLT5idXMsIGJfaW5mby0+YWRkcmVzcyk7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAK
QEAgLTk4MiwyNCArOTA1LDIyIEBAIHN0YXRpYyB2b2lkIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdl
cl9yZW1vdmVfZGV2KFNwaWNlVXNiRGV2aWNlTWFuYWdlciAqc2VsZiwKIAogI2lmZGVmIEdfT1Nf
V0lOMzIKIHN0YXRpYyB2b2lkIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl91ZXZlbnRfY2IoR1Vk
ZXZDbGllbnQgICAgICpjbGllbnQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGxpYnVzYl9kZXZpY2UgICAqZGV2LAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmJkZXYsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdib29sZWFuICAg
ICAgICAgYWRkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBncG9pbnRlciAgICAgICAgIHVzZXJfZGF0YSkKIHsKICAgICBTcGljZVVzYkRldmljZU1hbmFn
ZXIgKnNlbGYgPSBTUElDRV9VU0JfREVWSUNFX01BTkFHRVIodXNlcl9kYXRhKTsKIAogICAgIGlm
IChhZGQpCi0gICAgICAgIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9hZGRfZGV2KHNlbGYsIGRl
dik7CisgICAgICAgIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9hZGRfZGV2KHNlbGYsIGJkZXYp
OwogICAgIGVsc2UKLSAgICAgICAgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX3JlbW92ZV9kZXYo
c2VsZiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlidXNi
X2dldF9idXNfbnVtYmVyKGRldiksCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGxpYnVzYl9nZXRfZGV2aWNlX2FkZHJlc3MoZGV2KSk7CisgICAgICAgIHNwaWNl
X3VzYl9kZXZpY2VfbWFuYWdlcl9yZW1vdmVfZGV2KHNlbGYsIGJkZXYpOwogfQogI2Vsc2UKIHN0
cnVjdCBob3RwbHVnX2lkbGVfY2JfYXJncyB7CiAgICAgU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICpz
ZWxmOwotICAgIGxpYnVzYl9kZXZpY2UgKmRldmljZTsKLSAgICBsaWJ1c2JfaG90cGx1Z19ldmVu
dCBldmVudDsKKyAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldmljZTsKKyAgICBnYm9vbGVh
biAgICAgICAgICAgICAgIGFkZGVkOwogfTsKIAogc3RhdGljIGdib29sZWFuIHNwaWNlX3VzYl9k
ZXZpY2VfbWFuYWdlcl9ob3RwbHVnX2lkbGVfY2IoZ3BvaW50ZXIgdXNlcl9kYXRhKQpAQCAtMTAw
NywzNiArOTI4LDI5IEBAIHN0YXRpYyBnYm9vbGVhbiBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJf
aG90cGx1Z19pZGxlX2NiKGdwb2ludGVyIHVzZXJfZGF0YSkKICAgICBzdHJ1Y3QgaG90cGx1Z19p
ZGxlX2NiX2FyZ3MgKmFyZ3MgPSB1c2VyX2RhdGE7CiAgICAgU3BpY2VVc2JEZXZpY2VNYW5hZ2Vy
ICpzZWxmID0gU1BJQ0VfVVNCX0RFVklDRV9NQU5BR0VSKGFyZ3MtPnNlbGYpOwogCi0gICAgc3dp
dGNoIChhcmdzLT5ldmVudCkgewotICAgIGNhc2UgTElCVVNCX0hPVFBMVUdfRVZFTlRfREVWSUNF
X0FSUklWRUQ6CisgICAgaWYgKGFyZ3MtPmFkZGVkKQogICAgICAgICBzcGljZV91c2JfZGV2aWNl
X21hbmFnZXJfYWRkX2RldihzZWxmLCBhcmdzLT5kZXZpY2UpOwotICAgICAgICBicmVhazsKLSAg
ICBjYXNlIExJQlVTQl9IT1RQTFVHX0VWRU5UX0RFVklDRV9MRUZUOgotICAgICAgICBzcGljZV91
c2JfZGV2aWNlX21hbmFnZXJfcmVtb3ZlX2RldihzZWxmLAotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgbGlidXNiX2dldF9idXNfbnVtYmVyKGFyZ3MtPmRldmljZSksCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ1c2JfZ2V0X2RldmljZV9hZGRyZXNz
KGFyZ3MtPmRldmljZSkpOwotICAgICAgICBicmVhazsKLSAgICB9Ci0gICAgbGlidXNiX3VucmVm
X2RldmljZShhcmdzLT5kZXZpY2UpOworICAgIGVsc2UKKyAgICAgICAgc3BpY2VfdXNiX2Rldmlj
ZV9tYW5hZ2VyX3JlbW92ZV9kZXYoc2VsZiwgYXJncy0+ZGV2aWNlKTsKKworICAgIHNwaWNlX3Vz
Yl9iYWNrZW5kX2RldmljZV91bnJlZihhcmdzLT5kZXZpY2UpOwogICAgIGdfb2JqZWN0X3VucmVm
KHNlbGYpOwogICAgIGdfZnJlZShhcmdzKTsKICAgICByZXR1cm4gRkFMU0U7CiB9CiAKIC8qIENh
biBiZSBjYWxsZWQgZnJvbSBib3RoIHRoZSBtYWluLXRocmVhZCBhcyB3ZWxsIGFzIHRoZSBldmVu
dF90aHJlYWQgKi8KLXN0YXRpYyBpbnQgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2hvdHBsdWdf
Y2IobGlidXNiX2NvbnRleHQgICAgICAgKmN0eCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgbGlidXNiX2RldmljZSAgICAgICAgKmRldmljZSwKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlidXNiX2hvdHBsdWdf
ZXZlbnQgIGV2ZW50LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB2b2lkICAgICAgICAgICAgICAgICAqdXNlcl9kYXRhKQorc3RhdGljIHZvaWQgc3BpY2Vf
dXNiX2RldmljZV9tYW5hZ2VyX2hvdHBsdWdfY2Iodm9pZCAqdXNlcl9kYXRhLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VVc2JCYWNrZW5kRGV2
aWNlICpkZXYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBnYm9vbGVhbiBhZGRlZCkKIHsKICAgICBTcGljZVVzYkRldmljZU1hbmFnZXIgKnNlbGYgPSBT
UElDRV9VU0JfREVWSUNFX01BTkFHRVIodXNlcl9kYXRhKTsKICAgICBzdHJ1Y3QgaG90cGx1Z19p
ZGxlX2NiX2FyZ3MgKmFyZ3MgPSBnX21hbGxvYzAoc2l6ZW9mKCphcmdzKSk7CiAKICAgICBhcmdz
LT5zZWxmID0gZ19vYmplY3RfcmVmKHNlbGYpOwotICAgIGFyZ3MtPmRldmljZSA9IGxpYnVzYl9y
ZWZfZGV2aWNlKGRldmljZSk7Ci0gICAgYXJncy0+ZXZlbnQgPSBldmVudDsKKyAgICBhcmdzLT5k
ZXZpY2UgPSBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfcmVmKGRldik7CisgICAgYXJncy0+YWRk
ZWQgPSBhZGRlZDsKICAgICBnX2lkbGVfYWRkKHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9ob3Rw
bHVnX2lkbGVfY2IsIGFyZ3MpOwotICAgIHJldHVybiAwOwogfQogI2VuZGlmIC8vIFVTRV9VU0JS
RURJUgogCkBAIC0xMDYzLDEzICs5NzcsOSBAQCBzdGF0aWMgZ3BvaW50ZXIgc3BpY2VfdXNiX2Rl
dmljZV9tYW5hZ2VyX3VzYl9ldl90aHJlYWQoZ3BvaW50ZXIgdXNlcl9kYXRhKQogewogICAgIFNw
aWNlVXNiRGV2aWNlTWFuYWdlciAqc2VsZiA9IFNQSUNFX1VTQl9ERVZJQ0VfTUFOQUdFUih1c2Vy
X2RhdGEpOwogICAgIFNwaWNlVXNiRGV2aWNlTWFuYWdlclByaXZhdGUgKnByaXYgPSBzZWxmLT5w
cml2OwotICAgIGludCByYzsKIAogICAgIHdoaWxlIChnX2F0b21pY19pbnRfZ2V0KCZwcml2LT5l
dmVudF90aHJlYWRfcnVuKSkgewotICAgICAgICByYyA9IGxpYnVzYl9oYW5kbGVfZXZlbnRzKHBy
aXYtPmNvbnRleHQpOwotICAgICAgICBpZiAocmMgJiYgcmMgIT0gTElCVVNCX0VSUk9SX0lOVEVS
UlVQVEVEKSB7Ci0gICAgICAgICAgICBjb25zdCBjaGFyICpkZXNjID0gbGlidXNiX3N0cmVycm9y
KHJjKTsKLSAgICAgICAgICAgIGdfd2FybmluZygiRXJyb3IgaGFuZGxpbmcgVVNCIGV2ZW50czog
JXMgWyVpXSIsIGRlc2MsIHJjKTsKKyAgICAgICAgaWYgKCFzcGljZV91c2JfYmFja2VuZF9oYW5k
bGVfZXZlbnRzKHByaXYtPmNvbnRleHQpKSB7CiAgICAgICAgICAgICBicmVhazsKICAgICAgICAg
fQogICAgIH0KQEAgLTExMjAsNyArMTAzMCw3IEBAIHN0YXRpYyB2b2lkIHNwaWNlX3VzYl9kZXZp
Y2VfbWFuYWdlcl9jaGVja19yZWRpcl9vbl9jb25uZWN0KAogICAgIFNwaWNlVXNiRGV2aWNlTWFu
YWdlclByaXZhdGUgKnByaXYgPSBzZWxmLT5wcml2OwogICAgIEdUYXNrICp0YXNrOwogICAgIFNw
aWNlVXNiRGV2aWNlICpkZXZpY2U7Ci0gICAgbGlidXNiX2RldmljZSAqbGliZGV2OworICAgIFNw
aWNlVXNiQmFja2VuZERldmljZSAqYmRldjsKICAgICBndWludCBpOwogCiAgICAgaWYgKHByaXYt
PnJlZGlyZWN0X29uX2Nvbm5lY3QgPT0gTlVMTCkKQEAgLTExMzIsMTEgKzEwNDIsMTEgQEAgc3Rh
dGljIHZvaWQgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2NoZWNrX3JlZGlyX29uX2Nvbm5lY3Qo
CiAgICAgICAgIGlmIChzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfaXNfZGV2aWNlX2Nvbm5lY3Rl
ZChzZWxmLCBkZXZpY2UpKQogICAgICAgICAgICAgY29udGludWU7CiAKLSAgICAgICAgbGliZGV2
ID0gc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2RldmljZV90b19saWJkZXYoc2VsZiwgZGV2aWNl
KTsKLSAgICAgICAgaWYgKHVzYnJlZGlyaG9zdF9jaGVja19kZXZpY2VfZmlsdGVyKAorICAgICAg
ICBiZGV2ID0gc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2RldmljZV90b19iZGV2KHNlbGYsIGRl
dmljZSk7CisgICAgICAgIGlmIChzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfY2hlY2tfZmlsdGVy
KAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJkZXYsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgcHJpdi0+cmVkaXJlY3Rfb25fY29ubmVjdF9ydWxlcywKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBwcml2LT5yZWRpcmVjdF9vbl9jb25uZWN0X3J1bGVzX2NvdW50LAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGxpYmRldiwgMCkgPT0gMCkgeworICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHByaXYtPnJlZGlyZWN0X29uX2Nvbm5lY3RfcnVsZXNfY291bnQpID09
IDApIHsKICAgICAgICAgICAgIC8qIE5vdGU6IHJlLXVzZXMgc3BpY2VfdXNiX2RldmljZV9tYW5h
Z2VyX2Nvbm5lY3RfZGV2aWNlX2FzeW5jJ3MKICAgICAgICAgICAgICAgIGNvbXBsZXRpb24gaGFu
ZGxpbmcgY29kZSEgKi8KICAgICAgICAgICAgIHRhc2sgPSBnX3Rhc2tfbmV3KHNlbGYsCkBAIC0x
MTQ2LDE0ICsxMDU2LDE0IEBAIHN0YXRpYyB2b2lkIHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9j
aGVja19yZWRpcl9vbl9jb25uZWN0KAogCiAgICAgICAgICAgICBzcGljZV91c2JyZWRpcl9jaGFu
bmVsX2Nvbm5lY3RfZGV2aWNlX2FzeW5jKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFNQSUNFX1VTQlJFRElSX0NIQU5ORUwoY2hhbm5lbCksCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbGliZGV2LCBkZXZpY2UsIE5VTEwsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgYmRldiwgZGV2aWNlLCBOVUxMLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9jaGFubmVsX2Nvbm5lY3RfY2IsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgdGFzayk7Ci0gICAgICAgICAgICBsaWJ1c2JfdW5yZWZfZGV2
aWNlKGxpYmRldik7CisgICAgICAgICAgICBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfdW5yZWYo
YmRldik7CiAgICAgICAgICAgICByZXR1cm47IC8qIFdlJ3ZlIHRha2VuIHRoZSBjaGFubmVsISAq
LwogICAgICAgICB9CiAKLSAgICAgICAgbGlidXNiX3VucmVmX2RldmljZShsaWJkZXYpOworICAg
ICAgICBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfdW5yZWYoYmRldik7CiAgICAgfQogfQogCkBA
IC0xMTc3LDggKzEwODcsOCBAQCBzdGF0aWMgU3BpY2VVc2JyZWRpckNoYW5uZWwgKnNwaWNlX3Vz
Yl9kZXZpY2VfbWFuYWdlcl9nZXRfY2hhbm5lbF9mb3JfZGV2KAogICAgIGZvciAoaSA9IDA7IGkg
PCBwcml2LT5jaGFubmVscy0+bGVuOyBpKyspIHsKICAgICAgICAgU3BpY2VVc2JyZWRpckNoYW5u
ZWwgKmNoYW5uZWwgPSBnX3B0cl9hcnJheV9pbmRleChwcml2LT5jaGFubmVscywgaSk7CiAgICAg
ICAgIHNwaWNlX3VzYnJlZGlyX2NoYW5uZWxfbG9jayhjaGFubmVsKTsKLSAgICAgICAgbGlidXNi
X2RldmljZSAqbGliZGV2ID0gc3BpY2VfdXNicmVkaXJfY2hhbm5lbF9nZXRfZGV2aWNlKGNoYW5u
ZWwpOwotICAgICAgICBpZiAoc3BpY2VfdXNiX21hbmFnZXJfZGV2aWNlX2VxdWFsX2xpYmRldiht
YW5hZ2VyLCBkZXZpY2UsIGxpYmRldikpIHsKKyAgICAgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNl
ICpiZGV2ID0gc3BpY2VfdXNicmVkaXJfY2hhbm5lbF9nZXRfZGV2aWNlKGNoYW5uZWwpOworICAg
ICAgICBpZiAoc3BpY2VfdXNiX21hbmFnZXJfZGV2aWNlX2VxdWFsX2JkZXYobWFuYWdlciwgZGV2
aWNlLCBiZGV2KSkgewogICAgICAgICAgICAgc3BpY2VfdXNicmVkaXJfY2hhbm5lbF91bmxvY2so
Y2hhbm5lbCk7CiAgICAgICAgICAgICByZXR1cm4gY2hhbm5lbDsKICAgICAgICAgfQpAQCAtMTIz
NSw5ICsxMTQ1LDkgQEAgR1B0ckFycmF5KiBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfZ2V0X2Rl
dmljZXNfd2l0aF9maWx0ZXIoCiAgICAgICAgIFNwaWNlVXNiRGV2aWNlICpkZXZpY2UgPSBnX3B0
cl9hcnJheV9pbmRleChwcml2LT5kZXZpY2VzLCBpKTsKIAogICAgICAgICBpZiAocnVsZXMpIHsK
LSAgICAgICAgICAgIGxpYnVzYl9kZXZpY2UgKmxpYmRldiA9Ci0gICAgICAgICAgICAgICAgc3Bp
Y2VfdXNiX2RldmljZV9tYW5hZ2VyX2RldmljZV90b19saWJkZXYoc2VsZiwgZGV2aWNlKTsKLSAg
ICAgICAgICAgIGlmICh1c2JyZWRpcmhvc3RfY2hlY2tfZGV2aWNlX2ZpbHRlcihydWxlcywgY291
bnQsIGxpYmRldiwgMCkgIT0gMCkKKyAgICAgICAgICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAq
YmRldiA9CisgICAgICAgICAgICAgICAgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2RldmljZV90
b19iZGV2KHNlbGYsIGRldmljZSk7CisgICAgICAgICAgICBpZiAoc3BpY2VfdXNiX2JhY2tlbmRf
ZGV2aWNlX2NoZWNrX2ZpbHRlcihiZGV2LCBydWxlcywgY291bnQpICE9IDApCiAgICAgICAgICAg
ICAgICAgY29udGludWU7CiAgICAgICAgIH0KICAgICAgICAgZ19wdHJfYXJyYXlfYWRkKGRldmlj
ZXNfY29weSwgc3BpY2VfdXNiX2RldmljZV9yZWYoZGV2aWNlKSk7CkBAIC0xMzExLDcgKzEyMjEs
NyBAQCBfc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2Nvbm5lY3RfZGV2aWNlX2FzeW5jKFNwaWNl
VXNiRGV2aWNlTWFuYWdlciAqc2VsZiwKICAgICB0YXNrID0gZ190YXNrX25ldyhzZWxmLCBjYW5j
ZWxsYWJsZSwgY2FsbGJhY2ssIHVzZXJfZGF0YSk7CiAKICAgICBTcGljZVVzYkRldmljZU1hbmFn
ZXJQcml2YXRlICpwcml2ID0gc2VsZi0+cHJpdjsKLSAgICBsaWJ1c2JfZGV2aWNlICpsaWJkZXY7
CisgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpiZGV2OwogICAgIGd1aW50IGk7CiAKICAgICBp
ZiAoc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2lzX2RldmljZV9jb25uZWN0ZWQoc2VsZiwgZGV2
aWNlKSkgewpAQCAtMTMyNywxNCArMTIzNywxNCBAQCBfc3BpY2VfdXNiX2RldmljZV9tYW5hZ2Vy
X2Nvbm5lY3RfZGV2aWNlX2FzeW5jKFNwaWNlVXNiRGV2aWNlTWFuYWdlciAqc2VsZiwKICAgICAg
ICAgaWYgKHNwaWNlX3VzYnJlZGlyX2NoYW5uZWxfZ2V0X2RldmljZShjaGFubmVsKSkKICAgICAg
ICAgICAgIGNvbnRpbnVlOyAvKiBTa2lwIGFscmVhZHkgdXNlZCBjaGFubmVscyAqLwogCi0gICAg
ICAgIGxpYmRldiA9IHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9kZXZpY2VfdG9fbGliZGV2KHNl
bGYsIGRldmljZSk7CisgICAgICAgIGJkZXYgPSBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfZGV2
aWNlX3RvX2JkZXYoc2VsZiwgZGV2aWNlKTsKICAgICAgICAgc3BpY2VfdXNicmVkaXJfY2hhbm5l
bF9jb25uZWN0X2RldmljZV9hc3luYyhjaGFubmVsLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbGliZGV2LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmRldiwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZSwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGNhbmNlbGxhYmxlLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2NoYW5uZWxfY29ubmVjdF9jYiwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2spOwotICAgICAgICBsaWJ1c2JfdW5y
ZWZfZGV2aWNlKGxpYmRldik7CisgICAgICAgIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV91bnJl
ZihiZGV2KTsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtMTU5NiwxMyArMTUwNiwxNCBA
QCBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfY2FuX3JlZGlyZWN0X2RldmljZShTcGljZVVzYkRl
dmljZU1hbmFnZXIgICpzZWxmLAogCiAgICAgaWYgKGd1ZXN0X2ZpbHRlcl9ydWxlcykgewogICAg
ICAgICBnYm9vbGVhbiBmaWx0ZXJfb2s7Ci0gICAgICAgIGxpYnVzYl9kZXZpY2UgKmxpYmRldjsK
LQotICAgICAgICBsaWJkZXYgPSBzcGljZV91c2JfZGV2aWNlX21hbmFnZXJfZGV2aWNlX3RvX2xp
YmRldihzZWxmLCBkZXZpY2UpOwotICAgICAgICBmaWx0ZXJfb2sgPSAodXNicmVkaXJob3N0X2No
ZWNrX2RldmljZV9maWx0ZXIoCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3Vlc3RfZmls
dGVyX3J1bGVzLCBndWVzdF9maWx0ZXJfcnVsZXNfY291bnQsCi0gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbGliZGV2LCAwKSA9PSAwKTsKLSAgICAgICAgbGlidXNiX3VucmVmX2RldmljZShs
aWJkZXYpOworICAgICAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmJkZXY7CisKKyAgICAgICAg
YmRldiA9IHNwaWNlX3VzYl9kZXZpY2VfbWFuYWdlcl9kZXZpY2VfdG9fYmRldihzZWxmLCBkZXZp
Y2UpOworICAgICAgICBmaWx0ZXJfb2sgPSAoc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX2NoZWNr
X2ZpbHRlcigKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZGV2LAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGd1ZXN0X2ZpbHRlcl9ydWxlcywKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBndWVzdF9maWx0ZXJfcnVsZXNfY291bnQpID09IDApOworICAgICAgICBzcGljZV91
c2JfYmFja2VuZF9kZXZpY2VfdW5yZWYoYmRldik7CiAgICAgICAgIGlmICghZmlsdGVyX29rKSB7
CiAgICAgICAgICAgICBnX3NldF9lcnJvcl9saXRlcmFsKGVyciwgU1BJQ0VfQ0xJRU5UX0VSUk9S
LCBTUElDRV9DTElFTlRfRVJST1JfRkFJTEVELAogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBfKCJTb21lIFVTQiBkZXZpY2VzIGFyZSBibG9ja2VkIGJ5IGhvc3QgcG9saWN5IikpOwpA
QCAtMTY5Niw2MCArMTYwNywyNyBAQCBnY2hhciAqc3BpY2VfdXNiX2RldmljZV9nZXRfZGVzY3Jp
cHRpb24oU3BpY2VVc2JEZXZpY2UgKmRldmljZSwgY29uc3QgZ2NoYXIgKmZvcgogCiAKICNpZmRl
ZiBVU0VfVVNCUkVESVIKLXN0YXRpYyBnYm9vbGVhbiBwcm9iZV9pc29jaHJvbm91c19lbmRwb2lu
dChsaWJ1c2JfZGV2aWNlICpsaWJkZXYpCi17Ci0gICAgc3RydWN0IGxpYnVzYl9jb25maWdfZGVz
Y3JpcHRvciAqY29uZl9kZXNjOwotICAgIGdib29sZWFuIGlzb2NfZm91bmQgPSBGQUxTRTsKLSAg
ICBnaW50IGksIGosIGs7Ci0KLSAgICBnX3JldHVybl92YWxfaWZfZmFpbChsaWJkZXYgIT0gTlVM
TCwgRkFMU0UpOwotCi0gICAgaWYgKGxpYnVzYl9nZXRfYWN0aXZlX2NvbmZpZ19kZXNjcmlwdG9y
KGxpYmRldiwgJmNvbmZfZGVzYykgIT0gMCkgewotICAgICAgICBnX3JldHVybl92YWxfaWZfcmVh
Y2hlZChGQUxTRSk7Ci0gICAgfQotCi0gICAgZm9yIChpID0gMDsgIWlzb2NfZm91bmQgJiYgaSA8
IGNvbmZfZGVzYy0+Yk51bUludGVyZmFjZXM7IGkrKykgewotICAgICAgICBmb3IgKGogPSAwOyAh
aXNvY19mb3VuZCAmJiBqIDwgY29uZl9kZXNjLT5pbnRlcmZhY2VbaV0ubnVtX2FsdHNldHRpbmc7
IGorKykgewotICAgICAgICAgICAgZm9yIChrID0gMDsgIWlzb2NfZm91bmQgJiYgayA8IGNvbmZf
ZGVzYy0+aW50ZXJmYWNlW2ldLmFsdHNldHRpbmdbal0uYk51bUVuZHBvaW50cztrKyspIHsKLSAg
ICAgICAgICAgICAgICBnaW50IGF0dHJpYnV0ZXMgPSBjb25mX2Rlc2MtPmludGVyZmFjZVtpXS5h
bHRzZXR0aW5nW2pdLmVuZHBvaW50W2tdLmJtQXR0cmlidXRlczsKLSAgICAgICAgICAgICAgICBn
aW50IHR5cGUgPSBhdHRyaWJ1dGVzICYgTElCVVNCX1RSQU5TRkVSX1RZUEVfTUFTSzsKLSAgICAg
ICAgICAgICAgICBpZiAodHlwZSA9PSBMSUJVU0JfVFJBTlNGRVJfVFlQRV9JU09DSFJPTk9VUykK
LSAgICAgICAgICAgICAgICAgICAgaXNvY19mb3VuZCA9IFRSVUU7Ci0gICAgICAgICAgICB9Ci0g
ICAgICAgIH0KLSAgICB9Ci0KLSAgICBsaWJ1c2JfZnJlZV9jb25maWdfZGVzY3JpcHRvcihjb25m
X2Rlc2MpOwotICAgIHJldHVybiBpc29jX2ZvdW5kOwotfQotCiAvKgogICogU3BpY2VVc2JEZXZp
Y2VJbmZvCiAgKi8KLXN0YXRpYyBTcGljZVVzYkRldmljZUluZm8gKnNwaWNlX3VzYl9kZXZpY2Vf
bmV3KGxpYnVzYl9kZXZpY2UgKmxpYmRldikKK3N0YXRpYyBTcGljZVVzYkRldmljZUluZm8gKnNw
aWNlX3VzYl9kZXZpY2VfbmV3KFNwaWNlVXNiQmFja2VuZERldmljZSAqYmRldikKIHsKICAgICBT
cGljZVVzYkRldmljZUluZm8gKmluZm87Ci0gICAgaW50IHZpZCwgcGlkOwotICAgIGd1aW50OCBi
dXMsIGFkZHI7Ci0KLSAgICBnX3JldHVybl92YWxfaWZfZmFpbChsaWJkZXYgIT0gTlVMTCwgTlVM
TCk7CisgICAgY29uc3QgVXNiRGV2aWNlSW5mb3JtYXRpb24gKmJkZXZfaW5mbzsKIAotICAgIGJ1
cyA9IGxpYnVzYl9nZXRfYnVzX251bWJlcihsaWJkZXYpOwotICAgIGFkZHIgPSBsaWJ1c2JfZ2V0
X2RldmljZV9hZGRyZXNzKGxpYmRldik7CisgICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwoYmRldiAh
PSBOVUxMLCBOVUxMKTsKIAotICAgIGlmICghc3BpY2VfdXNiX2RldmljZV9tYW5hZ2VyX2dldF9s
aWJkZXZfdmlkX3BpZChsaWJkZXYsICZ2aWQsICZwaWQpKSB7Ci0gICAgICAgIHJldHVybiBOVUxM
OwotICAgIH0KKyAgICBiZGV2X2luZm8gPSBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfZ2V0X2lu
Zm8oYmRldik7CiAKICAgICBpbmZvID0gZ19uZXcwKFNwaWNlVXNiRGV2aWNlSW5mbywgMSk7CiAK
LSAgICBpbmZvLT5idXNudW0gID0gYnVzOwotICAgIGluZm8tPmRldmFkZHIgPSBhZGRyOwotICAg
IGluZm8tPnZpZCA9IHZpZDsKLSAgICBpbmZvLT5waWQgPSBwaWQ7CisgICAgaW5mby0+YnVzbnVt
ICA9IGJkZXZfaW5mby0+YnVzOworICAgIGluZm8tPmRldmFkZHIgPSBiZGV2X2luZm8tPmFkZHJl
c3M7CisgICAgaW5mby0+dmlkID0gYmRldl9pbmZvLT52aWQ7CisgICAgaW5mby0+cGlkID0gYmRl
dl9pbmZvLT5waWQ7CiAgICAgaW5mby0+cmVmID0gMTsKLSAgICBpbmZvLT5pc29jaHJvbm91cyA9
IHByb2JlX2lzb2Nocm9ub3VzX2VuZHBvaW50KGxpYmRldik7Ci0gICAgaW5mby0+bGliZGV2ID0g
bGlidXNiX3JlZl9kZXZpY2UobGliZGV2KTsKKyAgICBpbmZvLT5iZGV2ID0gc3BpY2VfdXNiX2Jh
Y2tlbmRfZGV2aWNlX3JlZihiZGV2KTsKKyAgICBpbmZvLT5pc29jaHJvbm91cyA9IHNwaWNlX3Vz
Yl9iYWNrZW5kX2RldmljZV9pc29jaChiZGV2KTsKIAogICAgIHJldHVybiBpbmZvOwogfQpAQCAt
MTg4NSwzNSArMTc2MywzNSBAQCBzdGF0aWMgdm9pZCBzcGljZV91c2JfZGV2aWNlX3VucmVmKFNw
aWNlVXNiRGV2aWNlICpkZXZpY2UpCiAKICAgICByZWZfY291bnRfaXNfMCA9IGdfYXRvbWljX2lu
dF9kZWNfYW5kX3Rlc3QoJmluZm8tPnJlZik7CiAgICAgaWYgKHJlZl9jb3VudF9pc18wKSB7Ci0g
ICAgICAgIGxpYnVzYl91bnJlZl9kZXZpY2UoaW5mby0+bGliZGV2KTsKKyAgICAgICAgc3BpY2Vf
dXNiX2JhY2tlbmRfZGV2aWNlX3VucmVmKGluZm8tPmJkZXYpOwogICAgICAgICBnX2ZyZWUoaW5m
byk7CiAgICAgfQogfQogCiBzdGF0aWMgZ2Jvb2xlYW4KLXNwaWNlX3VzYl9tYW5hZ2VyX2Rldmlj
ZV9lcXVhbF9saWJkZXYoU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICptYW5hZ2VyLAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZVVzYkRldmljZSAqZGV2aWNlLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ1c2JfZGV2aWNlICAqbGliZGV2
KQorc3BpY2VfdXNiX21hbmFnZXJfZGV2aWNlX2VxdWFsX2JkZXYoU3BpY2VVc2JEZXZpY2VNYW5h
Z2VyICptYW5hZ2VyLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VV
c2JEZXZpY2UgKmRldmljZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNw
aWNlVXNiQmFja2VuZERldmljZSAqYmRldikKIHsKICAgICBTcGljZVVzYkRldmljZUluZm8gKmlu
Zm8gPSAoU3BpY2VVc2JEZXZpY2VJbmZvICopZGV2aWNlOwogCi0gICAgaWYgKChkZXZpY2UgPT0g
TlVMTCkgfHwgKGxpYmRldiA9PSBOVUxMKSkKKyAgICBpZiAoKGRldmljZSA9PSBOVUxMKSB8fCAo
YmRldiA9PSBOVUxMKSkKICAgICAgICAgcmV0dXJuIEZBTFNFOwogCi0gICAgcmV0dXJuIGluZm8t
PmxpYmRldiA9PSBsaWJkZXY7CisgICAgcmV0dXJuIGluZm8tPmJkZXYgPT0gYmRldjsKIH0KIAog
LyoKICAqIENhbGxlciBtdXN0IGxpYnVzYl91bnJlZl9kZXZpY2UgdGhlIGxpYnVzYl9kZXZpY2Ug
cmV0dXJuZWQgYnkgdGhpcyBmdW5jdGlvbi4KICAqIFJldHVybnMgYSBsaWJ1c2JfZGV2aWNlLCBv
ciBOVUxMIHVwb24gZmFpbHVyZQogICovCi1zdGF0aWMgbGlidXNiX2RldmljZSAqCi1zcGljZV91
c2JfZGV2aWNlX21hbmFnZXJfZGV2aWNlX3RvX2xpYmRldihTcGljZVVzYkRldmljZU1hbmFnZXIg
KnNlbGYsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZVVz
YkRldmljZSAqZGV2aWNlKQorc3RhdGljIFNwaWNlVXNiQmFja2VuZERldmljZSAqCitzcGljZV91
c2JfZGV2aWNlX21hbmFnZXJfZGV2aWNlX3RvX2JkZXYoU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICpz
ZWxmLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNlVXNiRGV2
aWNlICpkZXZpY2UpCiB7CiAgICAgLyogU2ltcGx5IHJldHVybiBhIHJlZiB0byB0aGUgY2FjaGVk
IGxpYmRldiAqLwogICAgIFNwaWNlVXNiRGV2aWNlSW5mbyAqaW5mbyA9IChTcGljZVVzYkRldmlj
ZUluZm8gKilkZXZpY2U7CiAKLSAgICByZXR1cm4gbGlidXNiX3JlZl9kZXZpY2UoaW5mby0+bGli
ZGV2KTsKKyAgICByZXR1cm4gc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX3JlZihpbmZvLT5iZGV2
KTsKIH0KICNlbmRpZiAvKiBVU0VfVVNCUkVESVIgKi8KZGlmZiAtLWdpdCBhL3NyYy93aW4tdXNi
LWRldi5jIGIvc3JjL3dpbi11c2ItZGV2LmMKaW5kZXggYjAyNzRkZGMuLmMyYTUxMTU5IDEwMDY0
NAotLS0gYS9zcmMvd2luLXVzYi1kZXYuYworKysgYi9zcmMvd2luLXVzYi1kZXYuYwpAQCAtMjMs
MTEgKzIzLDkgQEAKICNpbmNsdWRlICJjb25maWcuaCIKIAogI2luY2x1ZGUgPHdpbmRvd3MuaD4K
LSNpbmNsdWRlIDxsaWJ1c2IuaD4KICNpbmNsdWRlICJ3aW4tdXNiLWRldi5oIgogI2luY2x1ZGUg
InNwaWNlLW1hcnNoYWwuaCIKICNpbmNsdWRlICJzcGljZS11dGlsLmgiCi0jaW5jbHVkZSAidXNi
dXRpbC5oIgogCiBlbnVtIHsKICAgICBQUk9QXzAsCkBAIC0zNSw3ICszMyw3IEBAIGVudW0gewog
fTsKIAogc3RydWN0IF9HVWRldkNsaWVudFByaXZhdGUgewotICAgIGxpYnVzYl9jb250ZXh0ICpj
dHg7CisgICAgU3BpY2VVc2JCYWNrZW5kICpjdHg7CiAgICAgR0xpc3QgKnVkZXZfbGlzdDsKICAg
ICBIV05EIGh3bmQ7CiAgICAgZ2Jvb2xlYW4gcmVkaXJlY3Rpbmc7CkBAIC02OCw5ICs2Niw3IEBA
IHN0YXRpYyB2b2lkIGdfdWRldl9kZXZpY2VfcHJpbnRfbGlzdChHTGlzdCAqbCwgY29uc3QgZ2No
YXIgKm1zZyk7CiAjZWxzZQogc3RhdGljIHZvaWQgZ191ZGV2X2RldmljZV9wcmludF9saXN0KEdM
aXN0ICpsLCBjb25zdCBnY2hhciAqbXNnKSB7fQogI2VuZGlmCi1zdGF0aWMgdm9pZCBnX3VkZXZf
ZGV2aWNlX3ByaW50KGxpYnVzYl9kZXZpY2UgKmRldiwgY29uc3QgZ2NoYXIgKm1zZyk7Ci0KLXN0
YXRpYyBnYm9vbGVhbiBnX3VkZXZfc2tpcF9zZWFyY2gobGlidXNiX2RldmljZSAqZGV2KTsKK3N0
YXRpYyB2b2lkIGdfdWRldl9kZXZpY2VfcHJpbnQoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYs
IGNvbnN0IGdjaGFyICptc2cpOwogCiBHUXVhcmsgZ191ZGV2X2NsaWVudF9lcnJvcl9xdWFyayh2
b2lkKQogewpAQCAtODYsNyArODIsNyBAQCBHVWRldkNsaWVudCAqZ191ZGV2X2NsaWVudF9uZXco
dm9pZCkKICAgICByZXR1cm4gc2luZ2xldG9uOwogfQogCi1saWJ1c2JfY29udGV4dCAqZ191ZGV2
X2NsaWVudF9nZXRfY29udGV4dChHVWRldkNsaWVudCAqY2xpZW50KQorU3BpY2VVc2JCYWNrZW5k
ICpnX3VkZXZfY2xpZW50X2dldF9jb250ZXh0KEdVZGV2Q2xpZW50ICpjbGllbnQpCiB7CiAgICAg
cmV0dXJuIGNsaWVudC0+cHJpdi0+Y3R4OwogfQpAQCAtOTksOCArOTUsNyBAQCBzdGF0aWMgc3Np
emVfdAogZ191ZGV2X2NsaWVudF9saXN0X2RldmljZXMoR1VkZXZDbGllbnQgKnNlbGYsIEdMaXN0
ICoqZGV2cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdFcnJvciAqKmVyciwgY29uc3Qg
Z2NoYXIgKm5hbWUpCiB7Ci0gICAgZ3NzaXplIHJjOwotICAgIGxpYnVzYl9kZXZpY2UgKipsdXNi
X2xpc3QsICoqZGV2OworICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqKmx1c2JfbGlzdCwgKipk
ZXY7CiAgICAgR1VkZXZDbGllbnRQcml2YXRlICpwcml2OwogICAgIHNzaXplX3QgbjsKIApAQCAt
MTExLDQzICsxMDYsMzMgQEAgZ191ZGV2X2NsaWVudF9saXN0X2RldmljZXMoR1VkZXZDbGllbnQg
KnNlbGYsIEdMaXN0ICoqZGV2cywKIAogICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKHNlbGYtPnBy
aXYtPmN0eCAhPSBOVUxMLCAtMyk7CiAKLSAgICByYyA9IGxpYnVzYl9nZXRfZGV2aWNlX2xpc3Qo
cHJpdi0+Y3R4LCAmbHVzYl9saXN0KTsKLSAgICBpZiAocmMgPCAwKSB7Ci0gICAgICAgIGNvbnN0
IGNoYXIgKmVycnN0ciA9IGxpYnVzYl9zdHJlcnJvcihyYyk7Ci0gICAgICAgIGdfd2FybmluZygi
JXM6IGxpYnVzYl9nZXRfZGV2aWNlX2xpc3QgZmFpbGVkIC0gJXMiLCBuYW1lLCBlcnJzdHIpOwor
ICAgIGx1c2JfbGlzdCA9IHNwaWNlX3VzYl9iYWNrZW5kX2dldF9kZXZpY2VfbGlzdChwcml2LT5j
dHgpOworICAgIGlmICghbHVzYl9saXN0KSB7CiAgICAgICAgIGdfc2V0X2Vycm9yKGVyciwgR19V
REVWX0NMSUVOVF9FUlJPUiwgR19VREVWX0NMSUVOVF9MSUJVU0JfRkFJTEVELAotICAgICAgICAg
ICAgICAgICAgICAiJXM6IEVycm9yIGdldHRpbmcgZGV2aWNlIGxpc3QgZnJvbSBsaWJ1c2I6ICVz
IFslIkdfR1NTSVpFX0ZPUk1BVCJdIiwKLSAgICAgICAgICAgICAgICAgICAgbmFtZSwgZXJyc3Ry
LCByYyk7CisgICAgICAgICAgICAgICAgICAgICIlczogRXJyb3IgZ2V0dGluZyBVU0IgZGV2aWNl
IGxpc3QiLCBuYW1lKTsKICAgICAgICAgcmV0dXJuIC00OwogICAgIH0KIAogICAgIG4gPSAwOwog
ICAgIGZvciAoZGV2ID0gbHVzYl9saXN0OyAqZGV2OyBkZXYrKykgewotICAgICAgICBpZiAoZ191
ZGV2X3NraXBfc2VhcmNoKCpkZXYpKSB7Ci0gICAgICAgICAgICBjb250aW51ZTsKLSAgICAgICAg
fQotICAgICAgICAqZGV2cyA9IGdfbGlzdF9wcmVwZW5kKCpkZXZzLCBsaWJ1c2JfcmVmX2Rldmlj
ZSgqZGV2KSk7CisgICAgICAgICpkZXZzID0gZ19saXN0X3ByZXBlbmQoKmRldnMsIHNwaWNlX3Vz
Yl9iYWNrZW5kX2RldmljZV9yZWYoKmRldikpOwogICAgICAgICBuKys7CiAgICAgfQotICAgIGxp
YnVzYl9mcmVlX2RldmljZV9saXN0KGx1c2JfbGlzdCwgMSk7CisgICAgc3BpY2VfdXNiX2JhY2tl
bmRfZnJlZV9kZXZpY2VfbGlzdChsdXNiX2xpc3QpOwogCiAgICAgcmV0dXJuIG47CiB9CiAKLXN0
YXRpYyB2b2lkIHVucmVmZXJlbmNlX2xpYnVzYl9kZXZpY2UoZ3BvaW50ZXIgZGF0YSkKK3N0YXRp
YyB2b2lkIHVucmVmZXJlbmNlX2JhY2tlbmRfZGV2aWNlKGdwb2ludGVyIGRhdGEpCiB7Ci0gICAg
bGlidXNiX3VucmVmX2RldmljZSgobGlidXNiX2RldmljZSAqKWRhdGEpOworICAgIHNwaWNlX3Vz
Yl9iYWNrZW5kX2RldmljZV91bnJlZigoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICopZGF0YSk7CiB9
CiAKIHN0YXRpYyB2b2lkIGdfdWRldl9jbGllbnRfZnJlZV9kZXZpY2VfbGlzdChHTGlzdCAqKmRl
dnMpCiB7CiAgICAgZ19yZXR1cm5faWZfZmFpbChkZXZzICE9IE5VTEwpOwogICAgIGlmICgqZGV2
cykgewotICAgICAgICAvKiB0aGUgdW5yZWZlcmVuY2VfbGlidXNiX2RldmljZSBtZXRob2QgaXMg
cmVxdWlyZWQgYXMKLSAgICAgICAgICogbGlidXNiX3VucmVmX2RldmljZSBjYWxsaW5nIGNvbnZl
bnRpb24gZGlmZmVycyBmcm9tIGdsaWIncwotICAgICAgICAgKiBzZWUgNTU4Yzk2N2VjCi0gICAg
ICAgICAqLwotICAgICAgICBnX2xpc3RfZnJlZV9mdWxsKCpkZXZzLCB1bnJlZmVyZW5jZV9saWJ1
c2JfZGV2aWNlKTsKKyAgICAgICAgZ19saXN0X2ZyZWVfZnVsbCgqZGV2cywgdW5yZWZlcmVuY2Vf
YmFja2VuZF9kZXZpY2UpOwogICAgICAgICAqZGV2cyA9IE5VTEw7CiAgICAgfQogfQpAQCAtMTYw
LDcgKzE0NSw2IEBAIGdfdWRldl9jbGllbnRfaW5pdGFibGVfaW5pdChHSW5pdGFibGUgKmluaXRh
YmxlLCBHQ2FuY2VsbGFibGUgKmNhbmNlbGxhYmxlLAogICAgIEdVZGV2Q2xpZW50ICpzZWxmOwog
ICAgIEdVZGV2Q2xpZW50UHJpdmF0ZSAqcHJpdjsKICAgICBXTkRDTEFTUyB3Y2xzOwotICAgIGlu
dCByYzsKIAogICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKEdfVURFVl9JU19DTElFTlQoaW5pdGFi
bGUpLCBGQUxTRSk7CiAgICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwoY2FuY2VsbGFibGUgPT0gTlVM
TCwgRkFMU0UpOwpAQCAtMTY4LDE0ICsxNTIsMTEgQEAgZ191ZGV2X2NsaWVudF9pbml0YWJsZV9p
bml0KEdJbml0YWJsZSAqaW5pdGFibGUsIEdDYW5jZWxsYWJsZSAqY2FuY2VsbGFibGUsCiAgICAg
c2VsZiA9IEdfVURFVl9DTElFTlQoaW5pdGFibGUpOwogICAgIHByaXYgPSBzZWxmLT5wcml2Owog
Ci0gICAgcmMgPSBsaWJ1c2JfaW5pdCgmcHJpdi0+Y3R4KTsKLSAgICBpZiAocmMgPCAwKSB7Ci0g
ICAgICAgIGNvbnN0IGNoYXIgKmVycnN0ciA9IGxpYnVzYl9zdHJlcnJvcihyYyk7Ci0gICAgICAg
IGdfd2FybmluZygiRXJyb3IgaW5pdGlhbGl6aW5nIFVTQiBzdXBwb3J0OiAlcyBbJWldIiwgZXJy
c3RyLCByYyk7Ci0gICAgICAgIGdfc2V0X2Vycm9yKGVyciwgR19VREVWX0NMSUVOVF9FUlJPUiwg
R19VREVWX0NMSUVOVF9MSUJVU0JfRkFJTEVELAotICAgICAgICAgICAgICAgICAgICAiRXJyb3Ig
aW5pdGlhbGl6aW5nIFVTQiBzdXBwb3J0OiAlcyBbJWldIiwgZXJyc3RyLCByYyk7CisgICAgcHJp
di0+Y3R4ID0gc3BpY2VfdXNiX2JhY2tlbmRfbmV3KGVycik7CisgICAgaWYgKCFwcml2LT5jdHgp
IHsKICAgICAgICAgcmV0dXJuIEZBTFNFOwogICAgIH0KKwogI2lmZGVmIEdfT1NfV0lOMzIKICNp
ZiBMSUJVU0JfQVBJX1ZFUlNJT04gPj0gMHgwMTAwMDEwNgogICAgIGxpYnVzYl9zZXRfb3B0aW9u
KHByaXYtPmN0eCwgTElCVVNCX09QVElPTl9VU0VfVVNCREspOwpAQCAtMjQ4LDkgKzIyOSw5IEBA
IHN0YXRpYyB2b2lkIGdfdWRldl9jbGllbnRfZmluYWxpemUoR09iamVjdCAqZ29iamVjdCkKICAg
ICBVbnJlZ2lzdGVyQ2xhc3MoR19VREVWX0NMSUVOVF9XSU5DTEFTU19OQU1FLCBOVUxMKTsKICAg
ICBnX3VkZXZfY2xpZW50X2ZyZWVfZGV2aWNlX2xpc3QoJnByaXYtPnVkZXZfbGlzdCk7CiAKLSAg
ICAvKiBmcmVlIGxpYnVzYiBjb250ZXh0IGluaXRpYWxpemluZyBieSBsaWJ1c2JfaW5pdCgpICov
CisgICAgLyogZnJlZSBiYWNrZW5kIGNvbnRleHQgKi8KICAgICBnX3dhcm5faWZfZmFpbChwcml2
LT5jdHggIT0gTlVMTCk7Ci0gICAgbGlidXNiX2V4aXQocHJpdi0+Y3R4KTsKKyAgICBzcGljZV91
c2JfYmFja2VuZF9kZWxldGUocHJpdi0+Y3R4KTsKIAogICAgIC8qIENoYWluIHVwIHRvIHRoZSBw
YXJlbnQgY2xhc3MgKi8KICAgICBpZiAoR19PQkpFQ1RfQ0xBU1MoZ191ZGV2X2NsaWVudF9wYXJl
bnRfY2xhc3MpLT5maW5hbGl6ZSkKQEAgLTM0MCwyMCArMzIxLDE4IEBAIHN0YXRpYyB2b2lkIGdf
dWRldl9jbGllbnRfY2xhc3NfaW5pdChHVWRldkNsaWVudENsYXNzICprbGFzcykKIH0KIAogLyog
Y29tcGFyaW5nIGJ1czphZGRyIGFuZCB2aWQ6cGlkICovCi1zdGF0aWMgZ2ludCBjb21wYXJlX2xp
YnVzYl9kZXZpY2VzKGdjb25zdHBvaW50ZXIgYSwgZ2NvbnN0cG9pbnRlciBiKQorc3RhdGljIGdp
bnQgY29tcGFyZV91c2JfZGV2aWNlcyhnY29uc3Rwb2ludGVyIGEsIGdjb25zdHBvaW50ZXIgYikK
IHsKLSAgICBsaWJ1c2JfZGV2aWNlICphX2RldiA9IChsaWJ1c2JfZGV2aWNlICopYTsKLSAgICBs
aWJ1c2JfZGV2aWNlICpiX2RldiA9IChsaWJ1c2JfZGV2aWNlICopYjsKLSAgICBzdHJ1Y3QgbGli
dXNiX2RldmljZV9kZXNjcmlwdG9yIGFfZGVzYywgYl9kZXNjOworICAgIGNvbnN0IFVzYkRldmlj
ZUluZm9ybWF0aW9uICphX2luZm8sICpiX2luZm87CiAgICAgZ2Jvb2xlYW4gc2FtZV9idXMsIHNh
bWVfYWRkciwgc2FtZV92aWQsIHNhbWVfcGlkOworICAgIGFfaW5mbyA9IHNwaWNlX3VzYl9iYWNr
ZW5kX2RldmljZV9nZXRfaW5mbygoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICopYSk7CisgICAgYl9p
bmZvID0gc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX2dldF9pbmZvKChTcGljZVVzYkJhY2tlbmRE
ZXZpY2UgKiliKTsKIAotICAgIGxpYnVzYl9nZXRfZGV2aWNlX2Rlc2NyaXB0b3IoYV9kZXYsICZh
X2Rlc2MpOwotICAgIGxpYnVzYl9nZXRfZGV2aWNlX2Rlc2NyaXB0b3IoYl9kZXYsICZiX2Rlc2Mp
OwogCi0gICAgc2FtZV9idXMgPSAobGlidXNiX2dldF9idXNfbnVtYmVyKGFfZGV2KSA9PSBsaWJ1
c2JfZ2V0X2J1c19udW1iZXIoYl9kZXYpKTsKLSAgICBzYW1lX2FkZHIgPSAobGlidXNiX2dldF9k
ZXZpY2VfYWRkcmVzcyhhX2RldikgPT0gbGlidXNiX2dldF9kZXZpY2VfYWRkcmVzcyhiX2Rldikp
OwotICAgIHNhbWVfdmlkID0gKGFfZGVzYy5pZFZlbmRvciA9PSBiX2Rlc2MuaWRWZW5kb3IpOwot
ICAgIHNhbWVfcGlkID0gKGFfZGVzYy5pZFByb2R1Y3QgPT0gYl9kZXNjLmlkUHJvZHVjdCk7Cisg
ICAgc2FtZV9idXMgPSAoYV9pbmZvLT5idXMgPT0gYl9pbmZvLT5idXMpOworICAgIHNhbWVfYWRk
ciA9IChhX2luZm8tPmFkZHJlc3MgPT0gYl9pbmZvLT5hZGRyZXNzKTsKKyAgICBzYW1lX3ZpZCA9
IChhX2luZm8tPnZpZCA9PSBiX2luZm8tPnZpZCk7CisgICAgc2FtZV9waWQgPSAoYV9pbmZvLT5w
aWQgPT0gYl9pbmZvLT5waWQpOwogCiAgICAgcmV0dXJuIChzYW1lX2J1cyAmJiBzYW1lX2FkZHIg
JiYgc2FtZV92aWQgJiYgc2FtZV9waWQpID8gMCA6IC0xOwogfQpAQCAtMzYzLDEyICszNDIsMTIg
QEAgc3RhdGljIHZvaWQgdXBkYXRlX2RldmljZV9saXN0KEdVZGV2Q2xpZW50ICpzZWxmLCBHTGlz
dCAqbmV3X2RldmljZV9saXN0KQogICAgIEdMaXN0ICpkZXY7CiAKICAgICBmb3IgKGRldiA9IGdf
bGlzdF9maXJzdChuZXdfZGV2aWNlX2xpc3QpOyBkZXYgIT0gTlVMTDsgZGV2ID0gZ19saXN0X25l
eHQoZGV2KSkgewotICAgICAgICBHTGlzdCAqZm91bmQgPSBnX2xpc3RfZmluZF9jdXN0b20oc2Vs
Zi0+cHJpdi0+dWRldl9saXN0LCBkZXYtPmRhdGEsIGNvbXBhcmVfbGlidXNiX2RldmljZXMpOwor
ICAgICAgICBHTGlzdCAqZm91bmQgPSBnX2xpc3RfZmluZF9jdXN0b20oc2VsZi0+cHJpdi0+dWRl
dl9saXN0LCBkZXYtPmRhdGEsIGNvbXBhcmVfdXNiX2RldmljZXMpOwogICAgICAgICBpZiAoZm91
bmQgIT0gTlVMTCkgewogICAgICAgICAgICAgLyoga2VlcCBvbGQgZXhpc3RpbmcgbGlidXNiX2Rl
dmljZSBpbiB0aGUgbmV3IGxpc3QsIHdoZW4KICAgICAgICAgICAgICAgIHVzYi1kZXYtbWFuYWdl
ciB3aWxsIG1haW50YWluIGl0cyBvd24gbGlzdCBvZiBsaWJ1c2JfZGV2aWNlLAogICAgICAgICAg
ICAgICAgdGhlc2UgbGlzdHMgd2lsbCBiZSBjb21wbGV0ZWx5IGNvbnNpc3RlbnQgKi8KLSAgICAg
ICAgICAgIGxpYnVzYl9kZXZpY2UgKnRlbXAgPSBmb3VuZC0+ZGF0YTsKKyAgICAgICAgICAgIFNw
aWNlVXNiQmFja2VuZERldmljZSAqdGVtcCA9IGZvdW5kLT5kYXRhOwogICAgICAgICAgICAgZm91
bmQtPmRhdGEgPSBkZXYtPmRhdGE7CiAgICAgICAgICAgICBkZXYtPmRhdGEgPSB0ZW1wOwogICAg
ICAgICB9CkBAIC0zODYsNyArMzY1LDcgQEAgc3RhdGljIHZvaWQgbm90aWZ5X2Rldl9zdGF0ZV9j
aGFuZ2UoR1VkZXZDbGllbnQgKnNlbGYsCiAgICAgR0xpc3QgKmRldjsKIAogICAgIGZvciAoZGV2
ID0gZ19saXN0X2ZpcnN0KG9sZF9saXN0KTsgZGV2ICE9IE5VTEw7IGRldiA9IGdfbGlzdF9uZXh0
KGRldikpIHsKLSAgICAgICAgR0xpc3QgKmZvdW5kID0gZ19saXN0X2ZpbmRfY3VzdG9tKG5ld19s
aXN0LCBkZXYtPmRhdGEsIGNvbXBhcmVfbGlidXNiX2RldmljZXMpOworICAgICAgICBHTGlzdCAq
Zm91bmQgPSBnX2xpc3RfZmluZF9jdXN0b20obmV3X2xpc3QsIGRldi0+ZGF0YSwgY29tcGFyZV91
c2JfZGV2aWNlcyk7CiAgICAgICAgIGlmIChmb3VuZCA9PSBOVUxMKSB7CiAgICAgICAgICAgICBn
X3VkZXZfZGV2aWNlX3ByaW50KGRldi0+ZGF0YSwgYWRkID8gImFkZCIgOiAicmVtb3ZlIik7CiAg
ICAgICAgICAgICBnX3NpZ25hbF9lbWl0KHNlbGYsIHNpZ25hbHNbVUVWRU5UX1NJR05BTF0sIDAs
IGRldi0+ZGF0YSwgYWRkKTsKQEAgLTQ0NywyOSArNDI2LDExIEBAIHN0YXRpYyB2b2lkIGdfdWRl
dl9kZXZpY2VfcHJpbnRfbGlzdChHTGlzdCAqbCwgY29uc3QgZ2NoYXIgKm1zZykKIH0KICNlbmRp
ZgogCi1zdGF0aWMgdm9pZCBnX3VkZXZfZGV2aWNlX3ByaW50KGxpYnVzYl9kZXZpY2UgKmRldiwg
Y29uc3QgZ2NoYXIgKm1zZykKK3N0YXRpYyB2b2lkIGdfdWRldl9kZXZpY2VfcHJpbnQoU3BpY2VV
c2JCYWNrZW5kRGV2aWNlICpkZXYsIGNvbnN0IGdjaGFyICptc2cpCiB7Ci0gICAgc3RydWN0IGxp
YnVzYl9kZXZpY2VfZGVzY3JpcHRvciBkZXNjOwotCi0gICAgbGlidXNiX2dldF9kZXZpY2VfZGVz
Y3JpcHRvcihkZXYsICZkZXNjKTsKKyAgICBjb25zdCBVc2JEZXZpY2VJbmZvcm1hdGlvbiAqaW5m
byA9IHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9nZXRfaW5mbyhkZXYpOwogCiAgICAgU1BJQ0Vf
REVCVUcoIiVzOiAlZC4lZCAweCUwNHg6MHglMDR4IGNsYXNzICVkIiwgbXNnLAotICAgICAgICAg
ICAgICAgIGxpYnVzYl9nZXRfYnVzX251bWJlcihkZXYpLAotICAgICAgICAgICAgICAgIGxpYnVz
Yl9nZXRfZGV2aWNlX2FkZHJlc3MoZGV2KSwKLSAgICAgICAgICAgICAgICBkZXNjLmlkVmVuZG9y
LCBkZXNjLmlkUHJvZHVjdCwgZGVzYy5iRGV2aWNlQ2xhc3MpOwotfQotCi1zdGF0aWMgZ2Jvb2xl
YW4gZ191ZGV2X3NraXBfc2VhcmNoKGxpYnVzYl9kZXZpY2UgKmRldikKLXsKLSAgICBnYm9vbGVh
biBza2lwOwotICAgIHVpbnQ4X3QgYWRkciA9IGxpYnVzYl9nZXRfZGV2aWNlX2FkZHJlc3MoZGV2
KTsKLSAgICBzdHJ1Y3QgbGlidXNiX2RldmljZV9kZXNjcmlwdG9yIGRlc2M7Ci0KLSAgICBsaWJ1
c2JfZ2V0X2RldmljZV9kZXNjcmlwdG9yKGRldiwgJmRlc2MpOwotCi0gICAgc2tpcCA9ICgoYWRk
ciA9PSAweGZmKSB8fCAgLyogcm9vdCBodWIgKEhDRCkgKi8KLSAgICAgICAgICAgIChhZGRyID09
IDEpIHx8IC8qIHJvb3QgaHViIGFkZHIgKi8KLSAgICAgICAgICAgIChkZXNjLmJEZXZpY2VDbGFz
cyA9PSBMSUJVU0JfQ0xBU1NfSFVCKSB8fCAvKiBodWIqLwotICAgICAgICAgICAgKGFkZHIgPT0g
MCkpOyAvKiBiYWQgYWRkcmVzcyAqLwotICAgIHJldHVybiBza2lwOworICAgICAgICAgICAgICAg
IGluZm8tPmJ1cywgaW5mby0+YWRkcmVzcywKKyAgICAgICAgICAgICAgICBpbmZvLT52aWQsIGlu
Zm8tPnBpZCwgaW5mby0+Y2xhc3MpOwogfQpkaWZmIC0tZ2l0IGEvc3JjL3dpbi11c2ItZGV2Lmgg
Yi9zcmMvd2luLXVzYi1kZXYuaAppbmRleCBiMWMwZTI3Zi4uZmRmZTczYTMgMTAwNjQ0Ci0tLSBh
L3NyYy93aW4tdXNiLWRldi5oCisrKyBiL3NyYy93aW4tdXNiLWRldi5oCkBAIC0yMyw2ICsyMyw3
IEBACiAjZGVmaW5lIF9fV0lOX1VTQl9ERVZfSF9fCiAKICNpbmNsdWRlIDxnaW8vZ2lvLmg+Cisj
aW5jbHVkZSAidXNiLWJhY2tlbmQuaCIKIAogR19CRUdJTl9ERUNMUwogCkBAIC01MSwxMiArNTIs
MTIgQEAgc3RydWN0IF9HVWRldkNsaWVudENsYXNzCiAgICAgR09iamVjdENsYXNzIHBhcmVudF9j
bGFzczsKIAogICAgIC8qIHNpZ25hbHMgKi8KLSAgICB2b2lkICgqdWV2ZW50KShHVWRldkNsaWVu
dCAqY2xpZW50LCBsaWJ1c2JfZGV2aWNlICpkZXZpY2UsIGdib29sZWFuIGFkZCk7CisgICAgdm9p
ZCAoKnVldmVudCkoR1VkZXZDbGllbnQgKmNsaWVudCwgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpk
ZXZpY2UsIGdib29sZWFuIGFkZCk7CiB9OwogCiBHVHlwZSBnX3VkZXZfY2xpZW50X2dldF90eXBl
KHZvaWQpIEdfR05VQ19DT05TVDsKIEdVZGV2Q2xpZW50ICpnX3VkZXZfY2xpZW50X25ldyh2b2lk
KTsKLWxpYnVzYl9jb250ZXh0ICpnX3VkZXZfY2xpZW50X2dldF9jb250ZXh0KEdVZGV2Q2xpZW50
ICpjbGllbnQpOworU3BpY2VVc2JCYWNrZW5kICpnX3VkZXZfY2xpZW50X2dldF9jb250ZXh0KEdV
ZGV2Q2xpZW50ICpjbGllbnQpOwogdm9pZCBnX3VkZXZfY2xpZW50X3JlcG9ydF9kZXZpY2VzKEdV
ZGV2Q2xpZW50ICpjbGllbnQpOwogCiBHUXVhcmsgZ191ZGV2X2NsaWVudF9lcnJvcl9xdWFyayh2
b2lkKTsKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KU3BpY2UtZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVk
ZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L3NwaWNlLWRldmVs
