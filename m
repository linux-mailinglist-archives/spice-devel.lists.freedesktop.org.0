Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A75754D3BF
	for <lists+spice-devel@lfdr.de>; Thu, 20 Jun 2019 18:29:15 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 38C476E5DA;
	Thu, 20 Jun 2019 16:29:14 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AEFC96E5D3
 for <spice-devel@lists.freedesktop.org>; Thu, 20 Jun 2019 16:29:13 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx04.intmail.prod.int.phx2.redhat.com
 [10.5.11.14])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 46FEA81DF9;
 Thu, 20 Jun 2019 16:29:13 +0000 (UTC)
Received: from colo-mx.corp.redhat.com
 (colo-mx01.intmail.prod.int.phx2.redhat.com [10.5.11.20])
 by smtp.corp.redhat.com (Postfix) with ESMTPS id D3DAF5D9E5;
 Thu, 20 Jun 2019 16:29:10 +0000 (UTC)
Received: from zmail25.collab.prod.int.phx2.redhat.com
 (zmail25.collab.prod.int.phx2.redhat.com [10.5.83.31])
 by colo-mx.corp.redhat.com (Postfix) with ESMTP id B7DE81806B0E;
 Thu, 20 Jun 2019 16:29:10 +0000 (UTC)
Date: Thu, 20 Jun 2019 12:29:09 -0400 (EDT)
From: Frediano Ziglio <fziglio@redhat.com>
To: Francois Gouget <fgouget@codeweavers.com>
Message-ID: <1554844250.23824965.1561048149158.JavaMail.zimbra@redhat.com>
In-Reply-To: <954d1aa1c8862a72dce84790fa9e1212a72256fd.1560790607.git.fgouget@free.fr>
References: <cover.1560790607.git.fgouget@free.fr>
 <954d1aa1c8862a72dce84790fa9e1212a72256fd.1560790607.git.fgouget@free.fr>
MIME-Version: 1.0
X-Originating-IP: [10.33.32.19, 10.4.195.22]
Thread-Topic: channel-display: Minimize the stream lag by ignoring the server
 one
Thread-Index: AZGQOZZf8KZBtCsalJYT4jGkpUVtnw==
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.14
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.25]); Thu, 20 Jun 2019 16:29:13 +0000 (UTC)
Subject: Re: [Spice-devel] [client v2 07/12] channel-display: Minimize the
 stream lag by ignoring the server one
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Spice devel <spice-devel@lists.freedesktop.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

PiAKPiBUaGUgY2xpZW50IGlzIGluIGEgYmV0dGVyIHBvc2l0aW9uIHRoYW4gdGhlIHNlcnZlciB0
byBwaWNrIHRoZSBtaW5pbXVtCj4gbGFnIG5lZWRlZCB0byBjb21wZW5zYXRlIGZvciBmcmFtZSBh
cnJpdmFsIHRpbWUgaml0dGVyIGFuZCBlbnN1cmUKPiBzbW9vdGggdmlkZW8gcGxheWJhY2suCj4g
VG8gZG8gc286Cj4gLSBJdCBpZ25vcmVzIHRoZSBsYWcgc3BlY2lmaWVkIGJ5IHRoZSBzZXJ2ZXIg
dGhyb3VnaCB0aGUgbW10aW1lIGNsb2NrCj4gICBhZGp1c3RtZW50cyAoYnV0IHRoaXMgbGFnIGlz
IHN0aWxsIHRyYWNrZWQgZm9yIHRoZSBzdHJlYW0gcmVwb3J0cykuCj4gLSBJdCBwZXJmb3JtcyBp
dHMgb3duIGZyYW1lIG1tdGltZSBjb252ZXJzaW9uIHRvIHRoZSBsb2NhbCBtb25vdG9uaWMKPiAg
IGNsb2NrIHNwaWNlX3Nlc3Npb25fZ2V0X2NsaWVudF90aW1lKCkgc2luY2UgdGhlIHNlcnZlci1j
b250cm9sbGVkCj4gICBtbXRpbWUgY2xvY2sgY2Fubm90IGJlIHJlbGllZCBvbi4gVGhpcyBjb252
ZXJzaW9uIHVzZXMgZGF0YSBmcm9tIGFsbAoKVGhlICJzaW5jZSB0aGUgc2VydmVyLWNvbnRyb2xs
ZWQgbW10aW1lIGNsb2NrIGNhbm5vdCBiZSByZWxpZWQgb24iIGNvdWxkCmJlIGNvbmZ1c2luZy4g
SW4gYSByZWxhdGl2ZSwgbm90IGFic29sdXRlIHdheSBpcyByZWxpYWJsZS4gQnV0IEkgc3VwcG9z
ZQp3aGF0IHlvdSBhcmUgbWVhbmluZyBoZXJlIGlzIHRoYXQgeW91IHJlbHkgb24gdGhlIG1tdGlt
ZXMgZnJvbSB0aGUgZnJhbWVzLApub3QgdGhlICJzZXJ2ZXJfdGltZSIuCgo+ICAgc3RyZWFtcyBi
dXQgaXMgZ2xvYmFsIHNvIGFsbCBzdHJlYW1zIGloYXZlIGEgY29tbW9uIHRpbWUgcmVmZXJlbmNl
LgoKdHlwbzogImloYXZlIgoKPiAtIFRoaXMgaXMgYWxzbyB3aGVyZSBtbXRpbWUgY2xvY2sgY2hh
bmdlcyBjYXVzZWQgYnkgc2VydmVyIG1pZ3JhdGlvbgo+ICAgYXJlIGhhbmRsZWQuCgoiVG8gZG8g
c28gdGhpcyBpcyBhbHNvIHdoZXJlIG1tdGltZSBjbG9jayBjaGFuZ2VzIGNhdXNlZCBieSBzZXJ2
ZXIgbWlncmF0aW9uCmFyZSBoYW5kbGVkLiIgPwoKPiAtIEl0IHRyYWNrcyB0aGUgbWFyZ2luIGJl
dHdlZW4gdGhlIGNvbnZlcnRlZCB0aW1lLXRvLWRpc3BsYXkgZnJhbWUKPiAgIHRpbWVzdGFtcCBh
bmQgdGhlIGN1cnJlbiB0aW1lIGFuZCBhZGRzIGEgZGVsYXkgdG8gZW5zdXJlIHRoaXMgbWFyZ2lu
Cgp0eXBvOiAiY3VycmVuIgoKPiAgIHJlbWFpbnMgcG9zaXRpdmUuCj4gLSBUaGlzIGRlbGF5IGlu
dHJvZHVjZXMgdGhlIHZpZGVvIHN0cmVhbSBsYWcuIEl0IGlzIGNvbnRpbnVvdXNseQo+ICAgYWRq
dXN0ZWQgdG8gZWl0aGVyIGJlIGFzIGxvdyBhcyBwb3NzaWJsZSwgb3IgbWF0Y2ggdGhlIGF1ZGlv
Cj4gICBwbGF5YmFjayBkZWxheSBmb3IgcHJvcGVyIGxpcCBzeW5jLgo+IC0gRGVsYXkgYWRqdXN0
bWVudHMgYXJlIGdyYWR1YWwsIHNwZWVkaW5nIHVwIG9yIHNsb3dpbmcgZG93biB2aWRlbwo+ICAg
cGxheWJhY2sgdW50aWwgdGhlIGF2ZXJhZ2UgbWFyZ2luIG1hdGNoZXMgdGhlIHRhcmdldCBsYWcu
Cj4gLSBDaGFuZ2VzIGluIHRoZSBhdmVyYWdlIG1hcmdpbiBhcmUgdHJhY2tlZCAoc2VlIG1hcmdp
bl9zcHJlYWQpIHRvCj4gICBhdm9pZCBudWRnaW5nIHRoZSBkZWxheSBpbiByZXNwb25zZSB0byBt
aW5vciByYW5kb20gdmFyaWF0aW9ucy4KPiAKPiBTaWduZWQtb2ZmLWJ5OiBGcmFuY29pcyBHb3Vn
ZXQgPGZnb3VnZXRAY29kZXdlYXZlcnMuY29tPgo+IC0tLQo+ICBzcmMvY2hhbm5lbC1kaXNwbGF5
LWdzdC5jICAgfCAgMjIgKystLS0KPiAgc3JjL2NoYW5uZWwtZGlzcGxheS1tanBlZy5jIHwgIDE0
ICstLQo+ICBzcmMvY2hhbm5lbC1kaXNwbGF5LXByaXYuaCAgfCAgMTggKysrLQo+ICBzcmMvY2hh
bm5lbC1kaXNwbGF5LmMgICAgICAgfCAxNzggKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KystLS0tCj4gIHNyYy9zcGljZS1zZXNzaW9uLXByaXYuaCAgICB8ICAgMSArCj4gIHNyYy9zcGlj
ZS1zZXNzaW9uLmMgICAgICAgICB8ICA0NiArKysrKysrKysrCj4gIDYgZmlsZXMgY2hhbmdlZCwg
MjQwIGluc2VydGlvbnMoKyksIDM5IGRlbGV0aW9ucygtKQo+IAo+IGRpZmYgLS1naXQgYS9zcmMv
Y2hhbm5lbC1kaXNwbGF5LWdzdC5jIGIvc3JjL2NoYW5uZWwtZGlzcGxheS1nc3QuYwo+IGluZGV4
IDZmY2NmNjIxLi42NzNmNDE3NyAxMDA2NDQKPiAtLS0gYS9zcmMvY2hhbm5lbC1kaXNwbGF5LWdz
dC5jCj4gKysrIGIvc3JjL2NoYW5uZWwtZGlzcGxheS1nc3QuYwo+IEBAIC01MCw3ICs1MCw3IEBA
IHR5cGVkZWYgc3RydWN0IFNwaWNlR3N0RGVjb2RlciB7Cj4gIAo+ICAgICAgLyogLS0tLS0tLS0t
LSBEZWNvZGluZyBhbmQgZGlzcGxheSBxdWV1ZXMgLS0tLS0tLS0tLSAqLwo+ICAKPiAtICAgIHVp
bnQzMl90IGxhc3RfbW1fdGltZTsKPiArICAgIHVpbnQzMl90IGxhc3RfZnJhbWVfdGltZTsKPiAg
Cj4gICAgICBHTXV0ZXggcXVldWVzX211dGV4Owo+ICAgICAgR1F1ZXVlICpkZWNvZGluZ19xdWV1
ZTsKPiBAQCAtMjk3LDggKzI5Nyw4IEBAIHN0YXRpYyB2b2lkIHNjaGVkdWxlX2ZyYW1lKFNwaWNl
R3N0RGVjb2RlciAqZGVjb2RlcikKPiAgICAgICAgICAgICAgYnJlYWs7Cj4gICAgICAgICAgfQo+
ICAKPiAtICAgICAgICBpZiAoc3BpY2VfbW10aW1lX2RpZmYoZ3N0ZnJhbWUtPmVuY29kZWRfZnJh
bWUtPm1tX3RpbWUsIG5vdykgPj0gMCkgewo+IC0gICAgICAgICAgICBkZWNvZGVyLT50aW1lcl9p
ZCA9Cj4gZ190aW1lb3V0X2FkZChnc3RmcmFtZS0+ZW5jb2RlZF9mcmFtZS0+bW1fdGltZSAtIG5v
dywKPiArICAgICAgICBpZiAoc3BpY2VfbW10aW1lX2RpZmYoZ3N0ZnJhbWUtPmVuY29kZWRfZnJh
bWUtPnRpbWUsIG5vdykgPj0gMCkgewo+ICsgICAgICAgICAgICBkZWNvZGVyLT50aW1lcl9pZCA9
IGdfdGltZW91dF9hZGQoZ3N0ZnJhbWUtPmVuY29kZWRfZnJhbWUtPnRpbWUKPiAtIG5vdywKPiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlfZnJh
bWUsIGRlY29kZXIpOwo+ICAgICAgICAgIH0gZWxzZSBpZiAoZGVjb2Rlci0+ZGlzcGxheV9mcmFt
ZSAmJiAhZGVjb2Rlci0+cGVuZGluZ19zYW1wbGVzKSB7Cj4gICAgICAgICAgICAgIC8qIFN0aWxs
IGF0dGVtcHQgdG8gZGlzcGxheSB0aGUgbGVhc3Qgb3V0IG9mIGRhdGUgZnJhbWUgc28gdGhlCj4g
QEAgLTMwNyw4ICszMDcsOCBAQCBzdGF0aWMgdm9pZCBzY2hlZHVsZV9mcmFtZShTcGljZUdzdERl
Y29kZXIgKmRlY29kZXIpCj4gICAgICAgICAgICAgIGRlY29kZXItPnRpbWVyX2lkID0gZ190aW1l
b3V0X2FkZCgwLCBkaXNwbGF5X2ZyYW1lLCBkZWNvZGVyKTsKPiAgICAgICAgICB9IGVsc2Ugewo+
ICAgICAgICAgICAgICBTUElDRV9ERUJVRygiJXM6IHJlbmRlcmluZyB0b28gbGF0ZSBieSAldSBt
cyAodHM6ICV1LCBtbXRpbWU6Cj4gICAgICAgICAgICAgICV1KSwgZHJvcHBpbmciLAo+IC0gICAg
ICAgICAgICAgICAgICAgICAgICBfX0ZVTkNUSU9OX18sIG5vdyAtCj4gZ3N0ZnJhbWUtPmVuY29k
ZWRfZnJhbWUtPm1tX3RpbWUsCj4gLSAgICAgICAgICAgICAgICAgICAgICAgIGdzdGZyYW1lLT5l
bmNvZGVkX2ZyYW1lLT5tbV90aW1lLCBub3cpOwo+ICsgICAgICAgICAgICAgICAgICAgICAgICBf
X0ZVTkNUSU9OX18sIG5vdyAtIGdzdGZyYW1lLT5lbmNvZGVkX2ZyYW1lLT50aW1lLAo+ICsgICAg
ICAgICAgICAgICAgICAgICAgICBnc3RmcmFtZS0+ZW5jb2RlZF9mcmFtZS0+dGltZSwgbm93KTsK
PiAgICAgICAgICAgICAgc3RyZWFtX2Ryb3BwZWRfZnJhbWVfb25fcGxheWJhY2soZGVjb2Rlci0+
YmFzZS5zdHJlYW0pOwo+ICAgICAgICAgICAgICBkZWNvZGVyLT5kaXNwbGF5X2ZyYW1lID0gTlVM
TDsKPiAgICAgICAgICAgICAgZnJlZV9nc3RfZnJhbWUoZ3N0ZnJhbWUpOwo+IEBAIC00NDksOSAr
NDQ5LDkgQEAgc2lua19ldmVudF9wcm9iZShHc3RQYWQgKnBhZCwgR3N0UGFkUHJvYmVJbmZvICpp
bmZvLAo+IGdwb2ludGVyIGRhdGEpCj4gICAgICAgICAgICAgICAqICAgb3IgbW9yZSBmcmFtZSBp
bnRlcnZhbHMuCj4gICAgICAgICAgICAgICAqLwo+ICAgICAgICAgICAgICByZWNvcmQoZnJhbWVz
X3N0YXRzLAo+IC0gICAgICAgICAgICAgICAgICAgImZyYW1lIG1tX3RpbWUgJXUgc2l6ZSAldSBj
cmVhdGlvbiB0aW1lICUiIFBSSWQ2NAo+ICsgICAgICAgICAgICAgICAgICAgImZyYW1lIHRpbWUg
JXUgc2l6ZSAldSBjcmVhdGlvbiB0aW1lICUiIFBSSWQ2NAo+ICAgICAgICAgICAgICAgICAgICAg
IiBkZWNvZGVkIHRpbWUgJSIgUFJJZDY0ICIgcXVldWUgJXUgYmVmb3JlICV1IiwKPiAtICAgICAg
ICAgICAgICAgICAgIGZyYW1lLT5tbV90aW1lLCBmcmFtZS0+c2l6ZSwgZnJhbWUtPmNyZWF0aW9u
X3RpbWUsCj4gZHVyYXRpb24sCj4gKyAgICAgICAgICAgICAgICAgICBmcmFtZS0+dGltZSwgZnJh
bWUtPnNpemUsIGZyYW1lLT5jcmVhdGlvbl90aW1lLCBkdXJhdGlvbiwKCkhlcmUgd2UgcmVhbGx5
IG5lZWQgdGhlIG9yaWdpbmFsIHNlcnZlciBtbXRpbWUsIG5vdCBoYXJkIHRvIGZpeCB0aGlzLApq
dXN0IGFkZCBhZ2FpbiB0aGUgbW1fdGltZSB3aXRoIHRoZSBpbml0aWFsIHNlcnZlciB2YWx1ZSBi
dXQgdXNlCmp1c3QgInRpbWUiIGZpZWxkIGZvciBldmVyeXRoaW5nIGVsc2UKCj4gICAgICAgICAg
ICAgICAgICAgICBkZWNvZGVyLT5kZWNvZGluZ19xdWV1ZS0+bGVuZ3RoLCBnc3RmcmFtZS0+cXVl
dWVfbGVuKTsKPiAgCj4gICAgICAgICAgICAgIGlmICghZGVjb2Rlci0+YXBwc2luaykgewo+IEBA
IC02ODksMTMgKzY4OSwxMyBAQCBzdGF0aWMgZ2Jvb2xlYW4KPiBzcGljZV9nc3RfZGVjb2Rlcl9x
dWV1ZV9mcmFtZShWaWRlb0RlY29kZXIgKnZpZGVvX2RlY29kZXIsCj4gICAgICAgICAgcmV0dXJu
IFRSVUU7Cj4gICAgICB9Cj4gIAo+IC0gICAgaWYgKHNwaWNlX21tdGltZV9kaWZmKGZyYW1lLT5t
bV90aW1lLCBkZWNvZGVyLT5sYXN0X21tX3RpbWUpIDwgMCkgewo+ICsgICAgaWYgKHNwaWNlX21t
dGltZV9kaWZmKGZyYW1lLT50aW1lLCBkZWNvZGVyLT5sYXN0X2ZyYW1lX3RpbWUpIDwgMCkgewo+
ICAgICAgICAgIFNQSUNFX0RFQlVHKCJuZXctZnJhbWUtdGltZSA8IGxhc3QtZnJhbWUtdGltZSAo
JXUgPCAldSk6Igo+ICAgICAgICAgICAgICAgICAgICAgICIgcmVzZXR0aW5nIHN0cmVhbSIsCj4g
LSAgICAgICAgICAgICAgICAgICAgZnJhbWUtPm1tX3RpbWUsIGRlY29kZXItPmxhc3RfbW1fdGlt
ZSk7Cj4gKyAgICAgICAgICAgICAgICAgICAgZnJhbWUtPnRpbWUsIGRlY29kZXItPmxhc3RfZnJh
bWVfdGltZSk7Cj4gICAgICAgICAgLyogTGV0IEdTdHJlYW1lciBkZWFsIHdpdGggdGhlIGZyYW1l
IGFueXdheSAqLwo+ICAgICAgfQo+IC0gICAgZGVjb2Rlci0+bGFzdF9tbV90aW1lID0gZnJhbWUt
Pm1tX3RpbWU7Cj4gKyAgICBkZWNvZGVyLT5sYXN0X2ZyYW1lX3RpbWUgPSBmcmFtZS0+dGltZTsK
PiAgCj4gICAgICBpZiAobWFyZ2luIDwgMCAmJgo+ICAgICAgICAgIGRlY29kZXItPmJhc2UuY29k
ZWNfdHlwZSA9PSBTUElDRV9WSURFT19DT0RFQ19UWVBFX01KUEVHKSB7Cj4gQEAgLTc3OCw3ICs3
NzgsNyBAQCBWaWRlb0RlY29kZXIqIGNyZWF0ZV9nc3RyZWFtZXJfZGVjb2RlcihpbnQgY29kZWNf
dHlwZSwKPiBkaXNwbGF5X3N0cmVhbSAqc3RyZWFtKQo+ICAgICAgICAgIGRlY29kZXItPmJhc2Uu
cXVldWVfZnJhbWUgPSBzcGljZV9nc3RfZGVjb2Rlcl9xdWV1ZV9mcmFtZTsKPiAgICAgICAgICBk
ZWNvZGVyLT5iYXNlLmNvZGVjX3R5cGUgPSBjb2RlY190eXBlOwo+ICAgICAgICAgIGRlY29kZXIt
PmJhc2Uuc3RyZWFtID0gc3RyZWFtOwo+IC0gICAgICAgIGRlY29kZXItPmxhc3RfbW1fdGltZSA9
IHN0cmVhbV9nZXRfdGltZShzdHJlYW0pOwo+ICsgICAgICAgIGRlY29kZXItPmxhc3RfZnJhbWVf
dGltZSA9IHN0cmVhbV9nZXRfdGltZShzdHJlYW0pOwo+ICAgICAgICAgIGdfbXV0ZXhfaW5pdCgm
ZGVjb2Rlci0+cXVldWVzX211dGV4KTsKPiAgICAgICAgICBkZWNvZGVyLT5kZWNvZGluZ19xdWV1
ZSA9IGdfcXVldWVfbmV3KCk7Cj4gIAo+IGRpZmYgLS1naXQgYS9zcmMvY2hhbm5lbC1kaXNwbGF5
LW1qcGVnLmMgYi9zcmMvY2hhbm5lbC1kaXNwbGF5LW1qcGVnLmMKPiBpbmRleCA2NDdkMzFiMC4u
ZDNhYjc3YzggMTAwNjQ0Cj4gLS0tIGEvc3JjL2NoYW5uZWwtZGlzcGxheS1tanBlZy5jCj4gKysr
IGIvc3JjL2NoYW5uZWwtZGlzcGxheS1tanBlZy5jCj4gQEAgLTE4MSwxNiArMTgxLDE2IEBAIHN0
YXRpYyB2b2lkIG1qcGVnX2RlY29kZXJfc2NoZWR1bGUoTUpwZWdEZWNvZGVyCj4gKmRlY29kZXIp
Cj4gICAgICBkZWNvZGVyLT5jdXJfZnJhbWUgPSBOVUxMOwo+ICAgICAgZG8gewo+ICAgICAgICAg
IGlmIChmcmFtZSkgewo+IC0gICAgICAgICAgICBpZiAoc3BpY2VfbW10aW1lX2RpZmYodGltZSwg
ZnJhbWUtPm1tX3RpbWUpIDw9IDApIHsKPiAtICAgICAgICAgICAgICAgIGd1aW50MzIgZCA9IGZy
YW1lLT5tbV90aW1lIC0gdGltZTsKPiArICAgICAgICAgICAgaWYgKHNwaWNlX21tdGltZV9kaWZm
KHRpbWUsIGZyYW1lLT50aW1lKSA8PSAwKSB7Cj4gKyAgICAgICAgICAgICAgICBndWludDMyIGQg
PSBmcmFtZS0+dGltZSAtIHRpbWU7Cj4gICAgICAgICAgICAgICAgICBkZWNvZGVyLT5jdXJfZnJh
bWUgPSBmcmFtZTsKPiAgICAgICAgICAgICAgICAgIGRlY29kZXItPnRpbWVyX2lkID0gZ190aW1l
b3V0X2FkZChkLAo+ICAgICAgICAgICAgICAgICAgbWpwZWdfZGVjb2Rlcl9kZWNvZGVfZnJhbWUs
IGRlY29kZXIpOwo+ICAgICAgICAgICAgICAgICAgYnJlYWs7Cj4gICAgICAgICAgICAgIH0KPiAg
Cj4gICAgICAgICAgICAgIFNQSUNFX0RFQlVHKCIlczogcmVuZGVyaW5nIHRvbyBsYXRlIGJ5ICV1
IG1zICh0czogJXUsIG1tdGltZToKPiAgICAgICAgICAgICAgJXUpLCBkcm9wcGluZyAiLAo+IC0g
ICAgICAgICAgICAgICAgICAgICAgICBfX0ZVTkNUSU9OX18sIHRpbWUgLSBmcmFtZS0+bW1fdGlt
ZSwKPiAtICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWUtPm1tX3RpbWUsIHRpbWUpOwo+ICsg
ICAgICAgICAgICAgICAgICAgICAgICBfX0ZVTkNUSU9OX18sIHRpbWUgLSBmcmFtZS0+dGltZSwK
PiArICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWUtPnRpbWUsIHRpbWUpOwo+ICAgICAgICAg
ICAgICBzdHJlYW1fZHJvcHBlZF9mcmFtZV9vbl9wbGF5YmFjayhkZWNvZGVyLT5iYXNlLnN0cmVh
bSk7Cj4gICAgICAgICAgICAgIHNwaWNlX2ZyYW1lX2ZyZWUoZnJhbWUpOwo+ICAgICAgICAgIH0K
PiBAQCAtMjI2LDEyICsyMjYsMTIgQEAgc3RhdGljIGdib29sZWFuIG1qcGVnX2RlY29kZXJfcXVl
dWVfZnJhbWUoVmlkZW9EZWNvZGVyCj4gKnZpZGVvX2RlY29kZXIsCj4gIAo+ICAgICAgbGFzdF9m
cmFtZSA9IGdfcXVldWVfcGVla190YWlsKGRlY29kZXItPm1zZ3EpOwo+ICAgICAgaWYgKGxhc3Rf
ZnJhbWUpIHsKPiAtICAgICAgICBpZiAoc3BpY2VfbW10aW1lX2RpZmYoZnJhbWUtPm1tX3RpbWUs
IGxhc3RfZnJhbWUtPm1tX3RpbWUpIDwgMCkgewo+ICsgICAgICAgIGlmIChzcGljZV9tbXRpbWVf
ZGlmZihmcmFtZS0+dGltZSwgbGFzdF9mcmFtZS0+dGltZSkgPCAwKSB7Cj4gICAgICAgICAgICAg
IC8qIFRoaXMgc2hvdWxkIHJlYWxseSBub3QgaGFwcGVuICovCj4gICAgICAgICAgICAgIFNQSUNF
X0RFQlVHKCJuZXctZnJhbWUtdGltZSA8IGxhc3QtZnJhbWUtdGltZSAoJXUgPCAldSk6Igo+ICAg
ICAgICAgICAgICAgICAgICAgICAgICAiIHJlc2V0dGluZyBzdHJlYW0iLAo+IC0gICAgICAgICAg
ICAgICAgICAgICAgICBmcmFtZS0+bW1fdGltZSwKPiAtICAgICAgICAgICAgICAgICAgICAgICAg
bGFzdF9mcmFtZS0+bW1fdGltZSk7Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lLT50
aW1lLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICBsYXN0X2ZyYW1lLT50aW1lKTsKPiAgICAg
ICAgICAgICAgbWpwZWdfZGVjb2Rlcl9kcm9wX3F1ZXVlKGRlY29kZXIpOwo+ICAgICAgICAgIH0K
PiAgICAgIH0KPiBkaWZmIC0tZ2l0IGEvc3JjL2NoYW5uZWwtZGlzcGxheS1wcml2LmggYi9zcmMv
Y2hhbm5lbC1kaXNwbGF5LXByaXYuaAo+IGluZGV4IDQ5NWRmN2FjLi5iYWRkOWQ0MiAxMDA2NDQK
PiAtLS0gYS9zcmMvY2hhbm5lbC1kaXNwbGF5LXByaXYuaAo+ICsrKyBiL3NyYy9jaGFubmVsLWRp
c3BsYXktcHJpdi5oCj4gQEAgLTM5LDcgKzM5LDcgQEAgdHlwZWRlZiBzdHJ1Y3QgZGlzcGxheV9z
dHJlYW0gZGlzcGxheV9zdHJlYW07Cj4gIAo+ICB0eXBlZGVmIHN0cnVjdCBTcGljZUZyYW1lIFNw
aWNlRnJhbWU7Cj4gIHN0cnVjdCBTcGljZUZyYW1lIHsKPiAtICAgIHVpbnQzMl90IG1tX3RpbWU7
Cj4gKyAgICB1aW50MzJfdCB0aW1lOwo+ICAgICAgU3BpY2VSZWN0IGRlc3Q7Cj4gIAo+ICAgICAg
dWludDhfdCAqZGF0YTsKPiBAQCAtMTI0LDggKzEyNCwyMiBAQCBzdHJ1Y3QgZGlzcGxheV9zdHJl
YW0gewo+ICAKPiAgICAgIFNwaWNlQ2hhbm5lbCAgICAgICAgICAgICAgICAqY2hhbm5lbDsKPiAg
Cj4gLSAgICAvKiBzdGF0cyAqLwo+ICAgICAgdWludDMyX3QgICAgICAgICAgICAgZmlyc3RfZnJh
bWVfbW1fdGltZTsKCnNob3VsZCB0aGlzIGZpZWxkIGJlIG1vdmVkIHRvICJzdGF0cyIgc2VjdGlv
biA/Cgo+ICsgICAgdWludDMyX3QgICAgICAgICAgICAgbGFzdF9mcmFtZV9tbV90aW1lOwo+ICsg
ICAgdWludDMyX3QgICAgICAgICAgICAgbGFzdF9mcmFtZV90aW1lOwo+ICsKPiArICAgIC8qIExh
ZyBtYW5hZ2VtZW50IChzZWUgZGlzcGxheV9oYW5kbGVfc3RyZWFtX2RhdGEoKSkgKi8KPiArICAg
IHVpbnQzMl90ICAgICAgICAgICAgIGRlbGF5Owo+ICsgICAgdWludDMyX3QgICAgICAgICAgICAg
bWFyZ2luX2V2YWxfc3RhcnQ7CgoiZXZhbCIgbWVhbmluZyAiZXZhbHVhdGlvbiIgPwoKPiArICAg
IHVpbnQzMl90ICAgICAgICAgICAgIG1hcmdpbl9ldmFsX2NvdW50Owo+ICsgICAgaW50MzJfdCAg
ICAgICAgICAgICAgbWluX21hcmdpbjsKPiArICAgIGludDMyX3QgICAgICAgICAgICAgIG1pbl9t
YXJnaW5fbmV4dDsKPiArICAgIGZsb2F0ICAgICAgICAgICAgICAgIGF2Z19tYXJnaW47Cj4gKyAg
ICBpbnQzMl90ICAgICAgICAgICAgICBtaW5fYXZnX21hcmdpbjsKPiArICAgIGludDMyX3QgICAg
ICAgICAgICAgIG1heF9hdmdfbWFyZ2luOwo+ICsgICAgdWludDMyX3QgICAgICAgICAgICAgbWFy
Z2luX3NwcmVhZDsKCkkgdGhpbmsgdGhlc2UgZmllbGRzIGRlc2VydmUgc29tZSBtb3JlIGRvY3Vt
ZW50YXRpb24sIG1hbnkgc2VlbXMKc28gc2ltaWxhciBhbmQgYXJlIG5vdCBjbGVhci4gU3VyZSB5
b3UgbmVlZCB0aGVtIGFsbD8KRm9yIGluc3RhbmNlIHdoYXQgdGhlIGRpZmZlcmVuY2UgYmV0d2Vl
biAibWluX21hcmdpbiIgYW5kICJtaW5fbWFyZ2luX25leHQiCmFuZCB3aHkgeW91IG5lZWQgYm90
aD8KV2h5ICJhdmdfbWFyZ2luIiBpcyBmbG9hdCBidXQgIm1pbl9hdmdfbWFyZ2luL21heF9hdmdf
bWFyZ2luIiBhcmUgbm90PwpGcm9tIGNvbW1lbnQgaW4gdGhlIGNvZGUgaXMgYSByb3VuZGluZyBp
c3N1ZSBidXQgdGhhbiB5b3UgY291bGQgY2hhbmdlCmF2Z19tYXJnaW4gZm9ybXVsYWUgKHNlZSBi
ZWxvdykuCgo+ICsKPiArICAgIC8qIHN0YXRzICovCj4gICAgICB1aW50MzJfdCAgICAgICAgICAg
ICBhcnJpdmVfbGF0ZV9jb3VudDsKPiAgICAgIHVpbnQ2NF90ICAgICAgICAgICAgIGFycml2ZV9s
YXRlX3RpbWU7Cj4gICAgICB1aW50MzJfdCAgICAgICAgICAgICBudW1fZHJvcHNfb25fcGxheWJh
Y2s7Cj4gZGlmZiAtLWdpdCBhL3NyYy9jaGFubmVsLWRpc3BsYXkuYyBiL3NyYy9jaGFubmVsLWRp
c3BsYXkuYwo+IGluZGV4IGIyNjMyNmQ2Li44MTUyNDJkZSAxMDA2NDQKPiAtLS0gYS9zcmMvY2hh
bm5lbC1kaXNwbGF5LmMKPiArKysgYi9zcmMvY2hhbm5lbC1kaXNwbGF5LmMKPiBAQCAtMjAsNiAr
MjAsNyBAQAo+ICAjaWZkZWYgSEFWRV9TWVNfVFlQRVNfSAo+ICAjaW5jbHVkZSA8c3lzL3R5cGVz
Lmg+Cj4gICNlbmRpZgo+ICsjaW5jbHVkZSA8bWF0aC5oPiAvKiBmb3IgY2VpbGYoKSAqLwo+ICAK
PiAgI2luY2x1ZGUgInNwaWNlLWNsaWVudC5oIgo+ICAjaW5jbHVkZSAic3BpY2UtY29tbW9uLmgi
Cj4gQEAgLTEzNzgsOCArMTM3OSw3IEBAIHN0YXRpYyB1aW50MzJfdCBzcGljZV9tc2dfaW5fZnJh
bWVfZGF0YShTcGljZU1zZ0luCj4gKmZyYW1lX21zZywgdWludDhfdCAqKmRhdGEpCj4gIEdfR05V
Q19JTlRFUk5BTAo+ICBndWludDMyIHN0cmVhbV9nZXRfdGltZShkaXNwbGF5X3N0cmVhbSAqc3Qp
Cj4gIHsKPiAtICAgIFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbiA9IHNwaWNlX2NoYW5uZWxfZ2V0X3Nl
c3Npb24oc3QtPmNoYW5uZWwpOwo+IC0gICAgcmV0dXJuIHNlc3Npb24gPyBzcGljZV9zZXNzaW9u
X2dldF9tbV90aW1lKHNlc3Npb24pIDogMDsKPiArICAgIHJldHVybiBnX2dldF9tb25vdG9uaWNf
dGltZSgpIC8gMTAwMDsKPiAgfQo+ICAKPiAgLyogY29yb3V0aW5lIG9yIG1haW4gY29udGV4dCAq
Lwo+IEBAIC0xNjQzLDcgKzE2NDMsNyBAQCBzdGF0aWMgdm9pZCBkaXNwbGF5X3N0cmVhbV9zdGF0
c19zYXZlKGRpc3BsYXlfc3RyZWFtCj4gKnN0LAo+ICAKPiAgc3RhdGljIFNwaWNlRnJhbWUgKnNw
aWNlX2ZyYW1lX25ldyhkaXNwbGF5X3N0cmVhbSAqc3QsCj4gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgU3BpY2VNc2dJbiAqaW4sCj4gLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgZ3VpbnQzMiBmcmFtZV9tbXRpbWUpCj4gKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgZ3VpbnQzMiBmcmFtZV90aW1lKQo+ICB7Cj4gICAgICBTcGljZUZyYW1l
ICpmcmFtZTsKPiAgICAgIGd1aW50OCAqZGF0YV9wdHI7Cj4gQEAgLTE2NTEsNyArMTY1MSw3IEBA
IHN0YXRpYyBTcGljZUZyYW1lICpzcGljZV9mcmFtZV9uZXcoZGlzcGxheV9zdHJlYW0gKnN0LAo+
ICAgICAgZ3VpbnQzMiBkYXRhX3NpemUgPSBzcGljZV9tc2dfaW5fZnJhbWVfZGF0YShpbiwgJmRh
dGFfcHRyKTsKPiAgCj4gICAgICBmcmFtZSA9IGdfbmV3KFNwaWNlRnJhbWUsIDEpOwo+IC0gICAg
ZnJhbWUtPm1tX3RpbWUgPSBmcmFtZV9tbXRpbWU7Cj4gKyAgICBmcmFtZS0+dGltZSA9IGZyYW1l
X3RpbWU7CgpIZXJlIGFuZCBhYm92ZSBhZGQgYWdhaW4gdGhlIG9sZCAibW1fdGltZSIgZm9yIGxv
Z2dpbmcgKEkgY2FuIHBvc3QgYSBmb2xsb3cgdXAKaWYgeW91IGxpa2UpLgoKPiAgICAgIGZyYW1l
LT5kZXN0ID0gKmRlc3RfcmVjdDsKPiAgICAgIGZyYW1lLT5kYXRhID0gZGF0YV9wdHI7Cj4gICAg
ICBmcmFtZS0+c2l6ZSA9IGRhdGFfc2l6ZTsKPiBAQCAtMTY3Miw0NCArMTY3MiwxODQgQEAgdm9p
ZCBzcGljZV9mcmFtZV9mcmVlKFNwaWNlRnJhbWUgKmZyYW1lKQo+ICAgICAgZ19mcmVlKGZyYW1l
KTsKPiAgfQo+ICAKPiArLyogUGljayBhbiBpbml0aWFsIHZhbHVlIGxpa2VseSB0byBjb3ZlciB0
aGUgbmV0d29yayBqaXR0ZXIgYW5kIG5vdCB0byBjYXVzZQo+ICsgKiBhIHNpZ25pZmljYW50IGxh
Zy4gVGhlIGRlbGF5IHdpbGwgYmUgYWRqdXN0ZWQgZnJvbSB0aGVyZS4KPiArICovCj4gKyNkZWZp
bmUgSU5JVElBTF9ERUxBWSA0MAo+ICsKPiArLyogQ29sbGVjdCBkYXRhIG9uIGEgbG9uZyBlbm91
Z2ggcGVyaW9kIHRvIGNhcHR1cmUgcmFyZSBldmVudHMsIGJ1dCBzaG9ydAo+ICsgKiBlbm91Z2gg
c28gdGhhdCB0aGUgYWxnb3JpdGhtIGlzIHN0aWxsIHJlc3BvbnNpdmUgdG8gY2hhbmdlcy4KPiAr
ICovCj4gKyNkZWZpbmUgTUFSR0lOX0VWQUxfVElNRSAoMSAqIDEwMDApCj4gKwo+ICsvKiBNYWtl
IHN1cmUgd2UgaGF2ZSBlbm91Z2ggZGF0YSBwb2ludHMgZXZlbiBpZiB0aGUgZnJhbWVyYXRlIGlz
IHZlcnkgbG93Lgo+ICovCj4gKyNkZWZpbmUgTUFSR0lOX0VWQUxfQ09VTlQgMjAKPiArCj4gIC8q
IGNvcm91dGluZSBjb250ZXh0ICovCj4gIHN0YXRpYyB2b2lkIGRpc3BsYXlfaGFuZGxlX3N0cmVh
bV9kYXRhKFNwaWNlQ2hhbm5lbCAqY2hhbm5lbCwgU3BpY2VNc2dJbgo+ICAqaW4pCj4gIHsKPiAr
ICAgIFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbiA9IHNwaWNlX2NoYW5uZWxfZ2V0X3Nlc3Npb24oY2hh
bm5lbCk7Cj4gICAgICBTcGljZURpc3BsYXlDaGFubmVsUHJpdmF0ZSAqYyA9IFNQSUNFX0RJU1BM
QVlfQ0hBTk5FTChjaGFubmVsKS0+cHJpdjsKPiAgICAgIFNwaWNlU3RyZWFtRGF0YUhlYWRlciAq
b3AgPSBzcGljZV9tc2dfaW5fcGFyc2VkKGluKTsKPiAgICAgIGRpc3BsYXlfc3RyZWFtICpzdCA9
IGdldF9zdHJlYW1fYnlfaWQoY2hhbm5lbCwgb3AtPmlkKTsKPiAtICAgIGd1aW50MzIgbW10aW1l
Owo+IC0gICAgaW50MzJfdCBtYXJnaW4sIG1hcmdpbl9yZXBvcnQ7Cj4gKyAgICBndWludDMyIGN1
cnJlbnRfbW10aW1lLCBmcmFtZV9pbnRlcnZhbDsKPiArICAgIGd1aW50MzIgc3RyZWFtX3RpbWUs
IGZyYW1lX3RpbWU7Cj4gKyAgICBnaW50MzIgbW10aW1lX21hcmdpbiwgbWFyZ2luOwo+ICAgICAg
U3BpY2VGcmFtZSAqZnJhbWU7Cj4gIAo+ICAgICAgZ19yZXR1cm5faWZfZmFpbChzdCAhPSBOVUxM
KTsKPiAtICAgIG1tdGltZSA9IHN0cmVhbV9nZXRfdGltZShzdCk7Cj4gKwo+ICsgICAgY3VycmVu
dF9tbXRpbWUgPSBzcGljZV9zZXNzaW9uX2dldF9tbV90aW1lKHNlc3Npb24pOwo+ICAKPiAgICAg
IGlmIChzcGljZV9tc2dfaW5fdHlwZShpbikgPT0gU1BJQ0VfTVNHX0RJU1BMQVlfU1RSRUFNX0RB
VEFfU0laRUQpIHsKPiAgICAgICAgICBDSEFOTkVMX0RFQlVHKGNoYW5uZWwsICJzdHJlYW0gJXUg
Y29udGFpbnMgc2l6ZWQgZGF0YSIsIG9wLT5pZCk7Cj4gICAgICB9Cj4gIAo+ICsgICAgZnJhbWVf
aW50ZXJ2YWwgPSAwOwo+ICsgICAgbW10aW1lX21hcmdpbiA9IDQwMDsgLyogc2VydmVyJ3MgZGVm
YXVsdCBtbV90aW1lIG9mZnNldCAqLwoKVGhpcyB2YWx1ZXMsIHdoaWNoIGlzIHVzZWQganVzdCBm
b3IgdGhlIHJlcG9ydCB3YXMgc2ltcGx5OgoKIm1hcmdpbl9yZXBvcnQgPSBvcC0+bXVsdGlfbWVk
aWFfdGltZSAtIG1tdGltZTsiCgp0aGUgY29tcHV0YXRpb24gZ290IHF1aXRlIGNvbXBsaWNhdGVk
IGV2ZW4gaWYgdGhlIHB1cnBvc2Ugb2YgdGhpcyBwYXRjaAppcyBub3QgbXVjaCBhYm91dCBjaGFu
Z2luZyBzdHJlYW1pbmcgcmVwb3J0cy4KCj4gICAgICBpZiAob3AtPm11bHRpX21lZGlhX3RpbWUg
PT0gMCkgewo+IC0gICAgICAgIGdfY3JpdGljYWwoIlJlY2VpdmVkIGZyYW1lIHdpdGggaW52YWxp
ZCAwIHRpbWVzdGFtcCEgcGVyaGFwcyB3cm9uZwo+IGdyYXBoaWMgZHJpdmVyPyIpOwo+IC0gICAg
ICAgIG9wLT5tdWx0aV9tZWRpYV90aW1lID0gbW10aW1lICsgMTAwOyAvKiB3b3JrYXJvdW5kLi4u
ICovCj4gLSAgICB9Cj4gKyAgICAgICAgZ19jcml0aWNhbCgiUmVjZWl2ZWQgZnJhbWUgd2l0aCBp
bnZhbGlkIDAgdGltZXN0YW1wISBQZXJoYXBzIHdyb25nCj4gZ3JhcGhpYyBkcml2ZXI/Iik7Cj4g
KyAgICAgICAgb3AtPm11bHRpX21lZGlhX3RpbWUgPSBjdXJyZW50X21tdGltZTsgLyogd29ya2Fy
b3VuZC4uLiAqLwo+ICsgICAgICAgIGZyYW1lX2ludGVydmFsID0gc3BpY2VfbW10aW1lX2RpZmYo
b3AtPm11bHRpX21lZGlhX3RpbWUsCj4gc3QtPmxhc3RfZnJhbWVfbW1fdGltZSk7Cj4gKyAgICB9
IGVsc2UgaWYgKHN0LT5sYXN0X2ZyYW1lX21tX3RpbWUgPT0gMCkgewo+ICsgICAgICAgIC8qIEZp
cnN0IGZyYW1lIHNvIGZyYW1lX2ludGVydmFsIGlzIHVua25vd24gKi8KPiArICAgICAgICBtbXRp
bWVfbWFyZ2luID0gc3BpY2VfbW10aW1lX2RpZmYob3AtPm11bHRpX21lZGlhX3RpbWUsCj4gY3Vy
cmVudF9tbXRpbWUpOwo+ICsgICAgfSBlbHNlIGlmIChvcC0+bXVsdGlfbWVkaWFfdGltZSA8IHN0
LT5sYXN0X2ZyYW1lX21tX3RpbWUpIHsKCkhlcmUgc3BpY2VfbW10aW1lX2RpZmYgc2hvdWxkIGJl
IHVzZWQKCj4gKyAgICAgICAgLyogVGhpcyBjYW4gaGFwcGVuIHdoZW4gbWlncmF0aW5nIGZyb20g
YSBzZXJ2ZXIgd2l0aCBhIGhpZ2ggbW1fdGltZQo+ICsgICAgICAgICAqIChpLmUuIGhpZ2ggdXB0
aW1lKSB0byBvbmUgd2l0aCBhIGxvdyBtbV90aW1lOgo+ICsgICAgICAgICAqIC0gc2VydmVyIEEg
c2VuZHMgYSBmcmFtZSB3aXRoIEFfbW1fdGltZQo+ICsgICAgICAgICAqIC0gY2xpZW50IHJlY2Vp
dmVzIHRoZSBmcmFtZSBhbmQgc2V0cyBsYXN0X2ZyYW1lX21tX3RpbWUgPQo+IEFfbW1fdGltZQo+
ICsgICAgICAgICAqIC0gc2VydmVyIEIgc2VuZHMgYSBmcmFtZSB3aXRoIEJfbW1fdGltZQo+ICsg
ICAgICAgICAqIC0gY2xpZW50IHJlY2VpdmVzIHNlcnZlciBCJ3MgZnJhbWUgd2l0aCBCX21tX3Rp
bWUgPDwgQV9tbV90aW1lCj4gKyAgICAgICAgICogQWxzbyBub3RlIHRoYXQgYWx0aG91Z2ggc2Vy
dmVyIEIgd291bGQgbm9ybWFsbHkgc2VuZCBhbiBtbV90aW1lCj4gKyAgICAgICAgICogcmVzZXQg
bWVzc2FnZSwgdGhlcmUgaXMgbm8gZ3VhcmFudGVlIGl0IHdpbGwgYmUgcmVjZWl2ZWQgYmVmb3Jl
Cj4gKyAgICAgICAgICogc2VydmVyIEIncyBmaXJzdCBmcmFtZSBzbyBpdCdzIG5vdCBtdWNoIGhl
bHAuCj4gKyAgICAgICAgICovCj4gKyAgICAgICAgU1BJQ0VfREVCVUcoIiV1IGdvdCBhbiBvdXQg
b2Ygb3JkZXIgZnJhbWUgLSV1Iiwgb3AtPmlkLAo+ICsgICAgICAgICAgICAgICAgICAgIHN0LT5s
YXN0X2ZyYW1lX21tX3RpbWUgLSBvcC0+bXVsdGlfbWVkaWFfdGltZSk7Cj4gKyAgICAgICAgc3Qt
Pmxhc3RfZnJhbWVfbW1fdGltZSA9IG9wLT5tdWx0aV9tZWRpYV90aW1lOwo+ICsgICAgfSBlbHNl
IGlmIChvcC0+bXVsdGlfbWVkaWFfdGltZSA+IHN0LT5sYXN0X2ZyYW1lX21tX3RpbWUgKyAxMDAw
KSB7CgpIZXJlIHRvby4KCj4gKyAgICAgICAgLyogU3RyZWFtcyBhcmUgc3VwcG9zZWQgdG8gc2Vu
ZCBhdCBsZWFzdCAxIGZyYW1lIHBlciBzZWNvbmQuCj4gKyAgICAgICAgICogU28gaXQncyBtb3Jl
IGxpa2VseSB0aGF0IHdlIGdvdCBtaWdyYXRlZCBmcm9tIGEgc2VydmVyIHdpdGggYSBsb3cKPiAr
ICAgICAgICAgKiBtbV90aW1lIChpLmUuIGxvdyB1cHRpbWUpIHRvIG9uZSB3aXRoIGEgaGlnaCBt
bV90aW1lLiBTZWUgdGhlCj4gY2FzZQo+ICsgICAgICAgICAqIGFib3ZlIGZvciBkZXRhaWxzLiBJ
biBzdWNoIGEgY2FzZSBzaW1wbHkgcmVpbml0aWFsaXplIHRoZSBzdHJlYW0uCj4gKyAgICAgICAg
ICovCj4gKyAgICAgICAgU1BJQ0VfREVCVUcoIiV1IGdvdCBhbiBhYm5vcm1hbGx5IGxvbmcgbW1f
dGltZSBmcmFtZSBpbnRlcnZhbCAldSIsCj4gb3AtPmlkLAo+ICsgICAgICAgICAgICAgICAgICAg
IG9wLT5tdWx0aV9tZWRpYV90aW1lIC0gc3QtPmxhc3RfZnJhbWVfbW1fdGltZSk7Cj4gKyAgICAg
ICAgc3QtPmxhc3RfZnJhbWVfdGltZSA9IDA7Cj4gKyAgICB9IGVsc2Ugewo+ICsgICAgICAgIG1t
dGltZV9tYXJnaW4gPSBzcGljZV9tbXRpbWVfZGlmZihvcC0+bXVsdGlfbWVkaWFfdGltZSwKPiBj
dXJyZW50X21tdGltZSk7Cj4gKyAgICAgICAgZnJhbWVfaW50ZXJ2YWwgPSBzcGljZV9tbXRpbWVf
ZGlmZihvcC0+bXVsdGlfbWVkaWFfdGltZSwKPiBzdC0+bGFzdF9mcmFtZV9tbV90aW1lKTsKPiAr
ICAgIH0KPiArICAgIGRpc3BsYXlfc3RyZWFtX3N0YXRzX3NhdmUoc3QsIG9wLT5tdWx0aV9tZWRp
YV90aW1lLCBjdXJyZW50X21tdGltZSk7Cj4gKyAgICBzdC0+bGFzdF9mcmFtZV9tbV90aW1lID0g
b3AtPm11bHRpX21lZGlhX3RpbWU7Cj4gKwo+ICsgICAgLyogQ29tcHV0ZSB0aGUgbG9jYWwgZnJh
bWUgbW10aW1lICovCj4gKyAgICBzdHJlYW1fdGltZSA9IHN0cmVhbV9nZXRfdGltZShzdCk7Cj4g
KyAgICBmcmFtZV90aW1lID0gc3BpY2Vfc2Vzc2lvbl9nZXRfY2xpZW50X3RpbWUoc2Vzc2lvbiwK
PiBvcC0+bXVsdGlfbWVkaWFfdGltZSk7Cj4gKyAgICBndWludDMyIHRhcmdldF9sYWcgPSBzcGlj
ZV9zZXNzaW9uX2dldF9wbGF5YmFja19sYXRlbmN5KHNlc3Npb24pOwo+ICsgICAgaWYgKHN0LT5s
YXN0X2ZyYW1lX3RpbWUgPT0gMCkgewo+ICsgICAgICAgIG1hcmdpbiA9IHNwaWNlX21tdGltZV9k
aWZmKGZyYW1lX3RpbWUsIHN0cmVhbV90aW1lKTsKPiArICAgICAgICBzdC0+ZGVsYXkgPSBNQVgo
dGFyZ2V0X2xhZyAtIG1hcmdpbiwgSU5JVElBTF9ERUxBWSk7Cj4gKyAgICAgICAgZnJhbWVfdGlt
ZSArPSBzdC0+ZGVsYXk7Cj4gKyAgICAgICAgbWFyZ2luICs9IHN0LT5kZWxheTsKPiArCj4gKyAg
ICAgICAgc3QtPm1hcmdpbl9ldmFsX3N0YXJ0ID0gc3RyZWFtX3RpbWU7Cj4gKyAgICAgICAgc3Qt
Pm1hcmdpbl9ldmFsX2NvdW50ID0gMDsKPiArICAgICAgICBzdC0+bWluX21hcmdpbiA9IDA7IC8q
IEZvcmNlIHdhaXQgYmVmb3JlIHJlZHVjaW5nIHRoZSBkZWxheSAqLwoKSSBzdXBwb3NlIG1hcmdp
biBpcyBuZXZlciBuZWdhdGl2ZSBvdGhlcndpc2UgeW91IHdvdWxkIGhhdmUgYSBtaW5pbXVtCnRo
YXQgaXMgYmlnZ2VyIHRoZW4gdGhlIHJlYWwgbWluaW11bS4KCj4gKyAgICAgICAgc3QtPm1pbl9t
YXJnaW5fbmV4dCA9IG1hcmdpbjsKPiArICAgICAgICBzdC0+YXZnX21hcmdpbiA9IG1hcmdpbjsK
PiArICAgICAgICBzdC0+bWF4X2F2Z19tYXJnaW4gPSBzdC0+bWluX2F2Z19tYXJnaW4gPSBtYXJn
aW47Cj4gKyAgICAgICAgc3QtPm1hcmdpbl9zcHJlYWQgPSBzdC0+ZGVsYXk7Cj4gKyAgICB9IGVs
c2Ugewo+ICsgICAgICAgIGZyYW1lX3RpbWUgPSBNQVgoZnJhbWVfdGltZSArIHN0LT5kZWxheSwK
PiArICAgICAgICAgICAgICAgICAgICAgICAgIHN0LT5sYXN0X2ZyYW1lX3RpbWUgKyAoZnJhbWVf
aW50ZXJ2YWwgKyAzKSAvIDQpOwo+ICsgICAgICAgIG1hcmdpbiA9IHNwaWNlX21tdGltZV9kaWZm
KGZyYW1lX3RpbWUsIHN0cmVhbV90aW1lKTsKPiArCj4gKyAgICAgICAgLyogTm90ZSB0aGF0IHdo
ZW4gdXNpbmcgaW50ZWdlcnMgdGhlIG1vdmluZyBhdmVyYWdlIGNhbiBzdGFiaWxpemUgdXAKPiB0
bwo+ICsgICAgICAgICAqIHdlaWdodC8yLTEgYXdheSBmcm9tIHRoZSB0cnVlIGF2ZXJhZ2UgKHdo
ZXJlIHdlaWdodD0xNiBoZXJlKSBkdWUKPiArICAgICAgICAgKiB0byB0aGUgcm91bmRpbmcgZXJy
b3JzIChlLmcuIGNvbnNpZGVyIDEgMTYgMTYuLi4pLgo+ICsgICAgICAgICAqIFNvIHVzZSBhIGZs
b2F0IGZvciBhdmdfbWFyZ2luLgoKV2h5IG5vdCAiKHN0LT5hdmdfbWFyZ2luICogMTUgKyBtYXJn
aW4gKyA4KSAvIDE2IiA/Cgo+ICsgICAgICAgICAqLwo+ICsgICAgICAgIHN0LT5hdmdfbWFyZ2lu
ID0gKHN0LT5hdmdfbWFyZ2luICogMTUgKyBtYXJnaW4pIC8gMTY7Cj4gKyAgICAgICAgaWYgKHN0
LT5hdmdfbWFyZ2luIDwgc3QtPm1pbl9hdmdfbWFyZ2luKSB7Cj4gKyAgICAgICAgICAgIHN0LT5t
aW5fYXZnX21hcmdpbiA9IHN0LT5hdmdfbWFyZ2luOwo+ICsgICAgICAgIH0gZWxzZSBpZiAoc3Qt
PmF2Z19tYXJnaW4gPiBzdC0+bWF4X2F2Z19tYXJnaW4pIHsKPiArICAgICAgICAgICAgc3QtPm1h
eF9hdmdfbWFyZ2luID0gY2VpbGYoc3QtPmF2Z19tYXJnaW4pOwo+ICsgICAgICAgIH0KPiArCj4g
KyAgICAgICAgaWYgKG1hcmdpbiA8IHN0LT5taW5fbWFyZ2luX25leHQpIHsKPiArICAgICAgICAg
ICAgc3QtPm1pbl9tYXJnaW5fbmV4dCA9IG1hcmdpbjsKPiArICAgICAgICAgICAgLyogVGFrZSBp
bnRvIGFjY291bnQgc2lnbnMgdGhhdCB0aGUgc2l0dWF0aW9uIHdvcnNlbmVkIHdpdGhvdXQKPiAr
ICAgICAgICAgICAgICogZGVsYXkuCj4gKyAgICAgICAgICAgICAqLwo+ICsgICAgICAgICAgICBz
dC0+bWluX21hcmdpbiA9IE1JTihzdC0+bWluX21hcmdpbiwgc3QtPm1pbl9tYXJnaW5fbmV4dCk7
Cj4gKyAgICAgICAgfQo+ICAKPiAtICAgIG1hcmdpbiA9IG1hcmdpbl9yZXBvcnQgPSBvcC0+bXVs
dGlfbWVkaWFfdGltZSAtIG1tdGltZTsKPiAtICAgIGlmIChtYXJnaW4gPiAwKSB7Cj4gLSAgICAg
ICAgU3BpY2VTZXNzaW9uICpzID0gc3BpY2VfY2hhbm5lbF9nZXRfc2Vzc2lvbihjaGFubmVsKTsK
PiArICAgICAgICAvKiBPbmx5IHJlcGxhY2UgdGhlIGN1cnJlbnQgbWluX21hcmdpbiBhbmQgbWFy
Z2luX3NwcmVhZCBlc3RpbWF0ZXMKPiBvbmNlCj4gKyAgICAgICAgICogZW5vdWdoIGRhdGEgaGFz
IGJlZW4gY29sbGVjdGVkIGZvciB0aGUgKl9uZXh0IHZhbHVlcywgYm90aCBpbgo+IHRlcm0KPiAr
ICAgICAgICAgKiBvZiBlbGFwc2VkIHRpbWUgYW5kIG51bWJlciBvZiBmcmFtZXMuCj4gKyAgICAg
ICAgICovCj4gKyAgICAgICAgc3QtPm1hcmdpbl9ldmFsX2NvdW50Kys7Cj4gKyAgICAgICAgaWYg
KHN0cmVhbV90aW1lIC0gc3QtPm1hcmdpbl9ldmFsX3N0YXJ0ID4gTUFSR0lOX0VWQUxfVElNRSAm
Jgo+ICsgICAgICAgICAgICBzdC0+bWFyZ2luX2V2YWxfY291bnQgPj0gTUFSR0lOX0VWQUxfQ09V
TlQpIHsKPiArICAgICAgICAgICAgc3QtPm1pbl9tYXJnaW4gPSBzdC0+bWluX21hcmdpbl9uZXh0
Owo+ICsKPiArICAgICAgICAgICAgc3QtPm1hcmdpbl9ldmFsX3N0YXJ0ID0gc3RyZWFtX3RpbWU7
Cj4gKyAgICAgICAgICAgIHN0LT5tYXJnaW5fZXZhbF9jb3VudCA9IDE7Cj4gKyAgICAgICAgICAg
IHN0LT5taW5fbWFyZ2luX25leHQgPSBtYXJnaW47Cj4gKwo+ICsgICAgICAgICAgICBzdC0+bWFy
Z2luX3NwcmVhZCA9IChzdC0+bWF4X2F2Z19tYXJnaW4gLSBzdC0+bWluX2F2Z19tYXJnaW4gKwo+
IDEpIC8gMjsKPiArICAgICAgICAgICAgc3QtPm1pbl9hdmdfbWFyZ2luID0gc3QtPmF2Z19tYXJn
aW47Cj4gKyAgICAgICAgICAgIHN0LT5tYXhfYXZnX21hcmdpbiA9IGNlaWxmKHN0LT5hdmdfbWFy
Z2luKTsKCldoeSBkbyB5b3UgbmVlZCBjZWlsZiBoZXJlPyBZb3UgYXJlIGp1c3QgcmVzdGFydGlu
ZyB0aGUgbWluL21heCBjb21wdXRhdGlvbi4KCj4gKyAgICAgICAgfQo+ICAKPiAtICAgICAgICBp
ZiAoc3QtPnN1cmZhY2UtPnN0cmVhbWluZ19tb2RlICYmCj4gIXNwaWNlX3Nlc3Npb25faXNfcGxh
eWJhY2tfYWN0aXZlKHMpKSB7Cj4gLSAgICAgICAgICAgIENIQU5ORUxfREVCVUcoY2hhbm5lbCwg
InZpZGVvIG1hcmdpbjogJWQsIHNldCB0byAwIHNpbmNlIHRoZXJlCj4gaXMgbm8gcGxheWJhY2si
LCBtYXJnaW4pOwo+IC0gICAgICAgICAgICBtYXJnaW4gPSAwOwo+ICsgICAgICAgIGlmIChtYXJn
aW4gPCAwKSB7Cj4gKyAgICAgICAgICAgIGdpbnQzMiBudWRnZSA9IC1tYXJnaW47Cj4gKyAgICAg
ICAgICAgIG1hcmdpbiArPSBudWRnZTsKPiArICAgICAgICAgICAgc3QtPmRlbGF5ICs9IG51ZGdl
Owo+ICsgICAgICAgICAgICBmcmFtZV90aW1lID0gc3RyZWFtX3RpbWUgKyAoZnJhbWVfaW50ZXJ2
YWwgKyAzKSAvIDQ7Cj4gKwo+ICsgICAgICAgICAgICAvKiBUaGUgZGVsYXkgbnVkZ2UgYWxzbyBp
bXBhY3RzIHRoZSBtYXJnaW4gaGlzdG9yeSAqLwo+ICsgICAgICAgICAgICBzdC0+bWluX21hcmdp
bl9uZXh0ICs9IG51ZGdlOwo+ICsgICAgICAgICAgICBzdC0+bWluX21hcmdpbiA9IG1hcmdpbjsK
PiArICAgICAgICAgICAgc3QtPmF2Z19tYXJnaW4gKz0gbnVkZ2U7Cj4gKyAgICAgICAgICAgIHN0
LT5taW5fYXZnX21hcmdpbiArPSBudWRnZTsKPiArICAgICAgICAgICAgc3QtPm1heF9hdmdfbWFy
Z2luICs9IG51ZGdlOwo+ICsgICAgICAgIH0gZWxzZSB7Cj4gKyAgICAgICAgICAgIC8qIFRyeSB0
byBtYXRjaCB0aGUgdGFyZ2V0IGxhZyB3aXRob3V0IG1ha2luZyBuZWVkbGVzcwo+IGFkanVzdG1l
bnRzCj4gKyAgICAgICAgICAgICAqIGZvciBtaW5vciBvZmZzZXRzLgo+ICsgICAgICAgICAgICAg
Ki8KPiArICAgICAgICAgICAgZ2ludDMyIG51ZGdlID0gMDsKPiArICAgICAgICAgICAgaWYgKHN0
LT5hdmdfbWFyZ2luICsgc3QtPm1hcmdpbl9zcHJlYWQgPCB0YXJnZXRfbGFnKSB7Cj4gKyAgICAg
ICAgICAgICAgICBudWRnZSA9IE1JTigoZnJhbWVfaW50ZXJ2YWwgKyAzKSAvIDQsCj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfbGFnIC0gc3QtPmF2Z19tYXJnaW4pOwo+ICsg
ICAgICAgICAgICB9IGVsc2UgaWYgKHN0LT5taW5fbWFyZ2luID4gMCAmJgo+ICsgICAgICAgICAg
ICAgICAgICAgICAgIHN0LT5hdmdfbWFyZ2luICA+IHRhcmdldF9sYWcgKyBzdC0+bWFyZ2luX3Nw
cmVhZCkgewo+ICsgICAgICAgICAgICAgICAgbnVkZ2UgPSAtTUlOKChmcmFtZV9pbnRlcnZhbCAr
IDMpIC8gNCwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNSU4oc3QtPmF2Z19tYXJn
aW4gLSB0YXJnZXRfbGFnLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdC0+
bWluX21hcmdpbikpOwo+ICsgICAgICAgICAgICB9Cj4gKyAgICAgICAgICAgIGlmIChudWRnZSkg
ewo+ICsgICAgICAgICAgICAgICAgc3QtPmRlbGF5ICs9IG51ZGdlOwo+ICsgICAgICAgICAgICAg
ICAgZnJhbWVfdGltZSArPSBudWRnZTsKPiArCj4gKyAgICAgICAgICAgICAgICAvKiBUaGUgZGVs
YXkgbnVkZ2UgYWxzbyBpbXBhY3RzIHRoZSBtYXJnaW4gaGlzdG9yeSAqLwo+ICsgICAgICAgICAg
ICAgICAgc3QtPm1pbl9tYXJnaW5fbmV4dCArPSBudWRnZTsKPiArICAgICAgICAgICAgICAgIHN0
LT5taW5fbWFyZ2luICs9IG51ZGdlOwo+ICsgICAgICAgICAgICAgICAgc3QtPmF2Z19tYXJnaW4g
Kz0gbnVkZ2U7Cj4gKyAgICAgICAgICAgICAgICBzdC0+bWluX2F2Z19tYXJnaW4gKz0gbnVkZ2U7
Cj4gKyAgICAgICAgICAgICAgICBzdC0+bWF4X2F2Z19tYXJnaW4gKz0gbnVkZ2U7Cj4gKyAgICAg
ICAgICAgIH0KPiAgICAgICAgICB9Cj4gICAgICB9CgpJIHdpbGwgaGF2ZSB0byByZWFkIGFsbCB0
aGVzZSBmb3JtdWxhZXMgYWdhaW4gYnV0IGxvb2tzIGxpa2UgeW91IGhhdmUKcGFydCBvZiB0aGUg
Y29kZSB3aGljaCBpcyBkb2luZyBzb21lIHNtb290aCBjaGFuZ2VzIGJ1dCBhdCBzb21lIGludGVy
dmFscwp5b3UgZG8gc29tZSBiaWdnZXIgYWRqdXN0bWVudHMuCkl0IGxvb2tzIHF1aXRlIGNvbXBs
aWNhdGVkIGFuZCBpdCBzZWVtcyBoYXJkIHRvIHNlZSBpZiBpdCdzIGdvb2Qgb3Igbm90LgpOb3Qg
c3VyZSBpZiBpdCB3b3VsZCBiZSBwb3NzaWJsZSB0byBlbmNhcHN1bGF0ZSBhbGwgdGhhdCBjb21w
bGV4aXR5IAphbmQgaGF2ZSBzb21lIHRlc3RzLgpXaGF0IHRoZSBjYXNlcyB5b3UgaGF2ZSBpbiBt
aW5kIHRvIHJlc29sdj8gSnVzdCBpZ25vcmluZyBwZWFrcz8KCj4gLSAgICBkaXNwbGF5X3N0cmVh
bV9zdGF0c19zYXZlKHN0LCBvcC0+bXVsdGlfbWVkaWFfdGltZSwgbW10aW1lKTsKPiArICAgIHN0
LT5sYXN0X2ZyYW1lX3RpbWUgPSBmcmFtZV90aW1lOwo+ICAKPiAgICAgIC8qIExldCB0aGUgdmlk
ZW8gZGVjb2RlciBxdWV1ZSB0aGUgZnJhbWVzIHNvIGl0IGNhbiBvcHRpbWl6ZSB0aGVpcgo+ICAg
ICAgICogZGVjb2RpbmcgYW5kIGJlc3QgZGVjaWRlIGlmL3doZW4gdG8gZHJvcCB0aGVtIHdoZW4g
dGhleSBhcmUgbGF0ZSwKPiAgICAgICAqIHRha2luZyBpbnRvIGFjY291bnQgdGhlIGltcGFjdCBv
biBsYXRlciBmcmFtZXMuCj4gICAgICAgKi8KPiAtICAgIGZyYW1lID0gc3BpY2VfZnJhbWVfbmV3
KHN0LCBpbiwgb3AtPm11bHRpX21lZGlhX3RpbWUpOwo+ICsgICAgZnJhbWUgPSBzcGljZV9mcmFt
ZV9uZXcoc3QsIGluLCBmcmFtZV90aW1lKTsKPiAgICAgIGlmICghc3QtPnZpZGVvX2RlY29kZXIt
PnF1ZXVlX2ZyYW1lKHN0LT52aWRlb19kZWNvZGVyLCBmcmFtZSwgbWFyZ2luKSkgewo+ICAgICAg
ICAgIGRlc3Ryb3lfc3RyZWFtKGNoYW5uZWwsIG9wLT5pZCk7Cj4gICAgICAgICAgcmVwb3J0X2lu
dmFsaWRfc3RyZWFtKGNoYW5uZWwsIG9wLT5pZCk7Cj4gQEAgLTE3MTgsNyArMTg1OCw3IEBAIHN0
YXRpYyB2b2lkIGRpc3BsYXlfaGFuZGxlX3N0cmVhbV9kYXRhKFNwaWNlQ2hhbm5lbAo+ICpjaGFu
bmVsLCBTcGljZU1zZ0luICppbikKPiAgCj4gICAgICBpZiAoYy0+ZW5hYmxlX2FkYXB0aXZlX3N0
cmVhbWluZykgewo+ICAgICAgICAgIGRpc3BsYXlfdXBkYXRlX3N0cmVhbV9yZXBvcnQoU1BJQ0Vf
RElTUExBWV9DSEFOTkVMKGNoYW5uZWwpLCBvcC0+aWQsCj4gLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBvcC0+bXVsdGlfbWVkaWFfdGltZSwgbWFyZ2luX3JlcG9ydCk7Cj4g
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcC0+bXVsdGlfbWVkaWFfdGlt
ZSwgbW10aW1lX21hcmdpbik7Cj4gICAgICAgICAgaWYgKHN0LT5wbGF5YmFja19zeW5jX2Ryb3Bz
X3NlcV9sZW4gPj0KPiAgICAgICAgICBTVFJFQU1fUExBWUJBQ0tfU1lOQ19EUk9QX1NFUV9MRU5f
TElNSVQpIHsKPiAgICAgICAgICAgICAgc3BpY2Vfc2Vzc2lvbl9zeW5jX3BsYXliYWNrX2xhdGVu
Y3koc3BpY2VfY2hhbm5lbF9nZXRfc2Vzc2lvbihjaGFubmVsKSk7Cj4gICAgICAgICAgICAgIHN0
LT5wbGF5YmFja19zeW5jX2Ryb3BzX3NlcV9sZW4gPSAwOwo+IGRpZmYgLS1naXQgYS9zcmMvc3Bp
Y2Utc2Vzc2lvbi1wcml2LmggYi9zcmMvc3BpY2Utc2Vzc2lvbi1wcml2LmgKPiBpbmRleCA2ZWNl
N2UwMS4uNzk0ZDg2YTcgMTAwNjQ0Cj4gLS0tIGEvc3JjL3NwaWNlLXNlc3Npb24tcHJpdi5oCj4g
KysrIGIvc3JjL3NwaWNlLXNlc3Npb24tcHJpdi5oCj4gQEAgLTUwLDYgKzUwLDcgQEAgR1NvY2tl
dENvbm5lY3Rpb24qCj4gc3BpY2Vfc2Vzc2lvbl9jaGFubmVsX29wZW5faG9zdChTcGljZVNlc3Np
b24gKnNlc3Npb24sIFNwaWNlQwo+ICB2b2lkIHNwaWNlX3Nlc3Npb25fY2hhbm5lbF9uZXcoU3Bp
Y2VTZXNzaW9uICpzZXNzaW9uLCBTcGljZUNoYW5uZWwKPiAgKmNoYW5uZWwpOwo+ICB2b2lkIHNw
aWNlX3Nlc3Npb25fY2hhbm5lbF9taWdyYXRlKFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbiwgU3BpY2VD
aGFubmVsCj4gICpjaGFubmVsKTsKPiAgCj4gK2d1aW50MzIgc3BpY2Vfc2Vzc2lvbl9nZXRfY2xp
ZW50X3RpbWUoU3BpY2VTZXNzaW9uICpzZXNzaW9uLCBndWludDMyCj4gc3JjX3RpbWUpOwo+ICB2
b2lkIHNwaWNlX3Nlc3Npb25fc2V0X21tX3RpbWUoU3BpY2VTZXNzaW9uICpzZXNzaW9uLCBndWlu
dDMyIHRpbWUpOwo+ICBndWludDMyIHNwaWNlX3Nlc3Npb25fZ2V0X21tX3RpbWUoU3BpY2VTZXNz
aW9uICpzZXNzaW9uKTsKPiAgCj4gZGlmZiAtLWdpdCBhL3NyYy9zcGljZS1zZXNzaW9uLmMgYi9z
cmMvc3BpY2Utc2Vzc2lvbi5jCj4gaW5kZXggMDRiYTEyNGEuLjRlNWE3ODIzIDEwMDY0NAo+IC0t
LSBhL3NyYy9zcGljZS1zZXNzaW9uLmMKPiArKysgYi9zcmMvc3BpY2Utc2Vzc2lvbi5jCj4gQEAg
LTEwMiw2ICsxMDIsNyBAQCBzdHJ1Y3QgX1NwaWNlU2Vzc2lvblByaXZhdGUgewo+ICAgICAgZ3Vp
bnQgICAgICAgICAgICAgY2hhbm5lbHNfZGVzdHJveWluZzsKPiAgICAgIGdib29sZWFuICAgICAg
ICAgIGNsaWVudF9wcm92aWRlZF9zb2NrZXRzOwo+ICAgICAgZ3VpbnQ2NCAgICAgICAgICAgbW1f
dGltZV9vZmZzZXQ7Cj4gKyAgICBnaW50NjQgICAgICAgICAgICBjbGllbnRfdGltZV9vZmZzZXQ7
CgpUaGlzIHNob3VsZCBiZSBqdXN0IDMyIGJpdC4KCj4gICAgICBTcGljZVNlc3Npb24gICAgICAq
bWlncmF0aW9uOwo+ICAgICAgR0xpc3QgICAgICAgICAgICAgKm1pZ3JhdGlvbl9sZWZ0Owo+ICAg
ICAgU3BpY2VTZXNzaW9uTWlncmF0aW9uIG1pZ3JhdGlvbl9zdGF0ZTsKPiBAQCAtMTI5LDYgKzEz
MCwxMCBAQCBzdHJ1Y3QgX1NwaWNlU2Vzc2lvblByaXZhdGUgewo+ICAgICAgUGhvZGF2U2VydmVy
ICAgICAgKndlYmRhdjsKPiAgfTsKPiAgCj4gKy8qIEluaXRpYWxpemUgdGhlIGNsaWVudF90aW1l
X29mZnNldCB0byBhbiB1bmxpa2VseSB2YWx1ZS4KPiArICogU2VlIHNwaWNlX3Nlc3Npb25fZ2V0
X2NsaWVudF90aW1lKCkuCj4gKyAqLwo+ICsjIGRlZmluZSBVTlNFVF9DTElFTlRfVElNRV9PRkZT
RVQgMHhkMWNlY2E1ZQo+ICAKPiAgLyoqCj4gICAqIFNFQ1RJT046c3BpY2Utc2Vzc2lvbgo+IEBA
IC0yOTIsNiArMjk3LDcgQEAgc3RhdGljIHZvaWQgc3BpY2Vfc2Vzc2lvbl9pbml0KFNwaWNlU2Vz
c2lvbiAqc2Vzc2lvbikKPiAgICAgIFNQSUNFX0RFQlVHKCJTdXBwb3J0ZWQgY2hhbm5lbHM6ICVz
IiwgY2hhbm5lbHMpOwo+ICAgICAgZ19mcmVlKGNoYW5uZWxzKTsKPiAgCj4gKyAgICBzLT5jbGll
bnRfdGltZV9vZmZzZXQgPSBVTlNFVF9DTElFTlRfVElNRV9PRkZTRVQ7Cj4gICAgICBzLT5pbWFn
ZXMgPSBjYWNoZV9pbWFnZV9uZXcoKEdEZXN0cm95Tm90aWZ5KXBpeG1hbl9pbWFnZV91bnJlZik7
Cj4gICAgICBzLT5nbHpfd2luZG93ID0gZ2x6X2RlY29kZXJfd2luZG93X25ldygpOwo+ICAgICAg
dXBkYXRlX3Byb3h5KHNlc3Npb24sIE5VTEwpOwo+IEBAIC0yMzg1LDYgKzIzOTEsNDYgQEAgaW50
IHNwaWNlX3Nlc3Npb25fZ2V0X2Nvbm5lY3Rpb25faWQoU3BpY2VTZXNzaW9uCj4gKnNlc3Npb24p
Cj4gICAgICByZXR1cm4gcy0+Y29ubmVjdGlvbl9pZDsKPiAgfQo+ICAKPiArR19HTlVDX0lOVEVS
TkFMCj4gK2d1aW50MzIgc3BpY2Vfc2Vzc2lvbl9nZXRfY2xpZW50X3RpbWUoU3BpY2VTZXNzaW9u
ICpzZXNzaW9uLCBndWludDMyIG1tdGltZSkKPiArewoKSSBhZ3JlZSB3aXRoIFNuaXIgdGhhdCBh
ICJnZXQiIGZ1bmN0aW9uIGRvaW5nIHNvIG11Y2ggc3R1ZmYgaXMgY29uZnVzaW5nLAptYXliZSBh
ICJzcGljZV9zZXNzaW9uX2FkanVzdF90b19jbGllbnRfdGltZSIgb3IgYSAic3BpY2Vfc2Vzc2lv
bl9tbXRpbWUyY2xpZW50X3RpbWUiLgoKPiArICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKFNQSUNF
X0lTX1NFU1NJT04oc2Vzc2lvbiksIGdfZ2V0X21vbm90b25pY190aW1lKCkpOwo+ICsKCkkgc3Vw
cG9zZSBoZXJlIHNob3VsZCBiZSAiZ19nZXRfbW9ub3RvbmljX3RpbWUoKSAvIDEwMDAiLCB0aGF0
IGlzIG5leHQgIm5vdyIKdmFsdWUuCgo+ICsgICAgU3BpY2VTZXNzaW9uUHJpdmF0ZSAqcyA9IHNl
c3Npb24tPnByaXY7Cj4gKwo+ICsgICAgZ3VpbnQzMiBub3cgPSBnX2dldF9tb25vdG9uaWNfdGlt
ZSgpIC8gMTAwMDsKPiArICAgIGdpbnQ2NCBuZXdfb2Zmc2V0ID0gbm93IC0gbW10aW1lOwoKVGhp
cyBzaG91bGQgYmUgYW4gdW5zaWduZWQgMzIgYml0LCBhbGwgYXJpdGhtZXRpYyBhcmUgbW9kdWxv
IDIqKjMyLgoKPiArCj4gKyAgICBpZiAocy0+Y2xpZW50X3RpbWVfb2Zmc2V0ID09IFVOU0VUX0NM
SUVOVF9USU1FX09GRlNFVCkgewo+ICsgICAgICAgIC8qIEluaXRpYWxpemUgdGhlIHRpbWUgb2Zm
c2V0Lgo+ICsgICAgICAgICAqIE5vdGUgdGhhdCBVTlNFVF9DTElFTlRfVElNRV9PRkZTRVQgY2Fu
IGJlIGFueSB2YWx1ZSBpbmNsdWRpbmcgMAo+ICsgICAgICAgICAqIHdoaWNoIGlzIGNvbW1vbiBv
biBsb3ctbGF0ZW5jeSBMQU5zLiBCdXQgYW4gdW5saWtlbHkgb25lIGhlbHBzCj4gd2hlbgo+ICsg
ICAgICAgICAqIGFkZGluZyBhIHRyYWNlIGluIHRoaXMgY29kZXBhdGguCj4gKyAgICAgICAgICov
Cj4gKyAgICAgICAgcy0+Y2xpZW50X3RpbWVfb2Zmc2V0ID0gbmV3X29mZnNldDsKPiArICAgICAg
ICByZXR1cm4gbm93Owo+ICsgICAgfQo+ICsgICAgaWYgKG5ld19vZmZzZXQgPCBzLT5jbGllbnRf
dGltZV9vZmZzZXQgLSAxMDAwIHx8Cj4gKyAgICAgICAgbmV3X29mZnNldCA+IHMtPmNsaWVudF90
aW1lX29mZnNldCArIDEwMDApIHsKPiArICAgICAgICAvKiBUaGUgY2hhbmdlIGluIG9mZnNldCB3
YXMgbGlrZWx5IGNhdXNlZCBieSBhIHNlcnZlciBtaWdyYXRpb24uCj4gKyAgICAgICAgICogUmVz
ZXQgdGhlIHRpbWUgb2Zmc2V0Lgo+ICsgICAgICAgICAqLwoKV2FzIHRoaXMgdGVzdGVkPyBJcyB0
aGVyZSBubyBvdGhlciBldmVudCB0byBzcGVjaWZpY2FsbHkgZGV0ZWN0IG1pZ3JhdGlvbj8KV2Ug
KHRoZSBjbGllbnQpIG5lZWRzIHRvIHJlY29ubmVjdCBkdXJpbmcgbWlncmF0aW9uIHNvIHN1cmVs
eSB0aGVyZSdzCmFub3RoZXIgZXZlbnQgZHVyaW5nIHRoaXMgY2hhbmdlLgoKPiArICAgICAgICBz
LT5jbGllbnRfdGltZV9vZmZzZXQgPSBuZXdfb2Zmc2V0Owo+ICsgICAgICAgIHJldHVybiBub3c7
Cj4gKyAgICB9Cj4gKyAgICBpZiAobmV3X29mZnNldCA8IHMtPmNsaWVudF90aW1lX29mZnNldCkg
ewo+ICsgICAgICAgIC8qIFRoZSBwcmV2aW91cyBtZXNzYWdlIHdlIHVzZWQgdG8gY29tcHV0ZSB0
aGUgb2Zmc2V0IHdhcyBwcm9iYWJseQo+ICsgICAgICAgICAqIGRlbGF5ZWQgcmVzdWx0aW5nIGlu
IGEgdG9vIGxhcmdlIG9mZnNldC4gRXZlbnR1YWxseSB0aGUgb2Zmc2V0Cj4gKyAgICAgICAgICog
c2hvdWxkIHNldHRsZSB0byB0aGUgdHJ1ZSBjbG9jayBvZmZzZXQgcGx1cyB0aGUgbmV0d29yayBs
YXRlbmN5LAo+ICsgICAgICAgICAqIGV4Y2x1ZGluZyB0aGUgbmV0d29yayBqaXR0ZXIuCj4gKyAg
ICAgICAgICovCgpBIGJpdCBPVDogbWF5YmUgd291bGQgYmUgZ3JlYXQgdG8gaGF2ZSB0aGUgImNs
aWVudCB0aW1lIiB3aGVuIHdlIHN0YXJ0IHJlY2VpdmluZwp0aGUgbWVzc2FnZSBmcm9tIHRoZSBz
ZXJ2ZXIgaW5zdGVhZCBvZiB0YWtpbmcgdGhlIHRpbWUgYWZ0ZXIgdGhlIGZ1bGwgbWVzc2FnZQph
cnJpdmVzLiBTaG91bGQgYmUgbW9yZSBjb25zaXN0ZW50IHdpdGggc2VydmVyIG1tdGltZSBjaGFu
Z2VzIChzZXJ2ZXIgdGltZXN0YW1wCm1lc3NhZ2VzIGJlZm9yZSBzZW5kaW5nKS4KCj4gKyAgICAg
ICAgcy0+Y2xpZW50X3RpbWVfb2Zmc2V0ID0gbmV3X29mZnNldDsKPiArICAgICAgICByZXR1cm4g
bm93Owo+ICsgICAgfQo+ICsKPiArICAgIHJldHVybiBtbXRpbWUgKyBzLT5jbGllbnRfdGltZV9v
ZmZzZXQ7Cj4gK30KPiArCj4gIEdfR05VQ19JTlRFUk5BTAo+ICBndWludDMyIHNwaWNlX3Nlc3Np
b25fZ2V0X21tX3RpbWUoU3BpY2VTZXNzaW9uICpzZXNzaW9uKQo+ICB7CgpGcmVkaWFubwpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpTcGljZS1kZXZlbCBt
YWlsaW5nIGxpc3QKU3BpY2UtZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vc3BpY2UtZGV2ZWw=
