Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id BECFBF30B
	for <lists+spice-devel@lfdr.de>; Tue, 30 Apr 2019 11:34:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2E9E0891A3;
	Tue, 30 Apr 2019 09:34:07 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 638CE891A3
 for <spice-devel@lists.freedesktop.org>; Tue, 30 Apr 2019 09:34:05 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx08.intmail.prod.int.phx2.redhat.com
 [10.5.11.23])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 0AC7B821F3
 for <spice-devel@lists.freedesktop.org>; Tue, 30 Apr 2019 09:34:05 +0000 (UTC)
Received: from jjanku-t480s.redhat.com (unknown [10.40.205.166])
 by smtp.corp.redhat.com (Postfix) with ESMTP id A17F72A193;
 Tue, 30 Apr 2019 09:34:03 +0000 (UTC)
From: =?UTF-8?q?Jakub=20Jank=C5=AF?= <jjanku@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Tue, 30 Apr 2019 11:33:36 +0200
Message-Id: <20190430093339.14062-3-jjanku@redhat.com>
In-Reply-To: <20190430093339.14062-1-jjanku@redhat.com>
References: <20190430093339.14062-1-jjanku@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.23
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.28]); Tue, 30 Apr 2019 09:34:05 +0000 (UTC)
Subject: [Spice-devel] [vdagent-linux v2 2/5] introduce VDAgentConnection
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

MSkgVkRBZ2VudENvbm5lY3Rpb24KCkFkZCB2ZGFnZW50LWNvbm5lY3Rpb24ue2MsaH0gZmlsZXMs
CmRlZmluZSBhIG5ldyBkZXJpdmFibGUgY2xhc3MgVkRBZ2VudENvbm5lY3Rpb24uCgpWREFnZW50
Q29ubmVjdGlvbiB1c2VzIEdJTyBhbmQgdGhlcmVmb3JlIGludGVncmF0ZXMgd2VsbCB3aXRoIEdN
YWluTG9vcC4KClJlYWQgbWVzc2FnZXMgbXVzdCBiZWdpbiB3aXRoIGEgaGVhZGVyIG9mIGEgZml4
ZWQgc2l6ZS4KTWVzc2FnZSBib2R5IHNpemUgY2FuIHZhcnkuCgpOb3RlOgp2ZGFnZW50X2Nvbm5l
Y3Rpb25fZGVzdHJveSgpIGNhbmNlbHMgb25nb2luZyBJL08tb3BzCmFuZCBjbG9zZXMgdGhlIHVu
ZGVybHlpbmcgRkQuCkhvd2V2ZXIsIHRoZSBJL08tb3BzIGRvIG5vdCBmaW5pc2ggaW1tZWRpYXRl
bHksCmJ1dCBhc3luY2hyb25vdXNseSBpbiB0aGUgbmV4dCBpdGVyYXRpb24gb2YgdGhlIG1haW4g
bG9vcC4KQXQgdGhlIGJlZ2lubmluZyBvZiBlYWNoIG9wLCBWREFnZW50Q29ubmVjdGlvbiBpcyBy
ZWZlcmVuY2VkLApzbyB0aGUgb2JqZWN0IGlzbid0IGZpbmFsaXplZCB1bnRpbCB0aGUgb3BzIHRo
ZW1zZWx2ZXMgZmluaXNoLgpUbyBzb2x2ZSB0aGlzLCBjYWxsIGdfbWFpbl9jb250ZXh0X2l0ZXJh
dGlvbigpIGJlZm9yZSB0aGUgYWdlbnQgZXhpdHMuCgoyKSB1ZHNjcwoKTWFrZSB1ZHNjc19jb25u
ZWN0aW9uIGEgc3ViY2xhc3Mgb2YgVkRBZ2VudENvbm5lY3Rpb24uCgpSZXdyaXRlIHVkc2NzX3Nl
cnZlciB1c2luZyBHU29ja2V0U2VydmljZS4KVXNlIEdMaXN0IHRvIHN0b3JlIHNlcnZlcidzIGNv
bm5lY3Rpb25zLgoKRHJvcCBzdXBwb3J0IGZvciBzZWxlY3QoKSwgcmVtb3ZlOgogKiB1ZHNjc19z
ZXJ2ZXJfZmlsbF9mZHMoKQogKiB1ZHNjc19zZXJ2ZXJfaGFuZGxlX2ZkcygpCgpSZW1vdmUgdWRz
Y3Nfe3NldCxnZXR9X3VzZXJfZGF0YSgpLiBDdXN0b20gZGF0YSBjYW4gYmUKYXNzb2NpYXRlZCB3
aXRoIHRoZSBHT2JqZWN0IHVzaW5nIGdfb2JqZWN0X3NldF9kYXRhKCkuCgozKSB2aXJ0aW9fcG9y
dAoKTWFrZSB2ZGFnZW50X3ZpcnRpb19wb3J0IGEgc3ViY2xhc3Mgb2YgVkRBZ2VudENvbm5lY3Rp
b24uCgpEcm9wIHN1cHBvcnQgZm9yIHNlbGVjdCgpLCByZW1vdmU6CiAqIHZkYWdlbnRfdmlydGlv
X3BvcnRfZmlsbF9mZHMoKQogKiB2ZGFnZW50X3ZpcnRpb19wb3J0X2hhbmRsZV9mZHMoKQoKNCkg
dmRhZ2VudGQKClJlcGxhY2UgdGhlIG1haW5fbG9vcCgpIHdpdGggYSBHTWFpbkxvb3AuCgpVc2Ug
Z191bml4X3NpZ25hbF9hZGQoKSB0byBoYW5kbGUgU0lHSU5ULCBTSUdIVVAsIFNJR1RFUk0uClNJ
R1FVSVQgaGFuZGxpbmcgaXMgbm90IHN1cHBvcnRlZCBieSBHTGliLgoKSW50ZWdyYXRlIHRoZSBz
ZXNzaW9uX2luZm8gaW50byB0aGUgbG9vcCB1c2luZwpHSU9DaGFubmVsIGFuZCBnX2lvX2FkZF93
YXRjaCgpLgoKU2lnbmVkLW9mZi1ieTogSmFrdWIgSmFua8WvIDxqamFua3VAcmVkaGF0LmNvbT4K
LS0tCiBNYWtlZmlsZS5hbSAgICAgICAgICAgICAgICB8ICAgMiArCiBzcmMvdWRzY3MuYyAgICAg
ICAgICAgICAgICB8IDU4NiArKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiBz
cmMvdWRzY3MuaCAgICAgICAgICAgICAgICB8ICA4MCArKy0tLQogc3JjL3ZkYWdlbnQtY29ubmVj
dGlvbi5jICAgfCAzMjIgKysrKysrKysrKysrKysrKysrKysKIHNyYy92ZGFnZW50LWNvbm5lY3Rp
b24uaCAgIHwgMTAyICsrKysrKysKIHNyYy92ZGFnZW50L3ZkYWdlbnQuYyAgICAgIHwgIDMwICst
CiBzcmMvdmRhZ2VudGQvdmRhZ2VudGQuYyAgICB8IDI1NiArKysrKysrKy0tLS0tLS0tCiBzcmMv
dmRhZ2VudGQvdmlydGlvLXBvcnQuYyB8IDQxMCArKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLQog
c3JjL3ZkYWdlbnRkL3ZpcnRpby1wb3J0LmggfCAgNjQgKystLQogOSBmaWxlcyBjaGFuZ2VkLCA5
MTIgaW5zZXJ0aW9ucygrKSwgOTQwIGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IHNy
Yy92ZGFnZW50LWNvbm5lY3Rpb24uYwogY3JlYXRlIG1vZGUgMTAwNjQ0IHNyYy92ZGFnZW50LWNv
bm5lY3Rpb24uaAoKZGlmZiAtLWdpdCBhL01ha2VmaWxlLmFtIGIvTWFrZWZpbGUuYW0KaW5kZXgg
YmY5MzdiOS4uNzg3ZjE1OCAxMDA2NDQKLS0tIGEvTWFrZWZpbGUuYW0KKysrIGIvTWFrZWZpbGUu
YW0KQEAgLTksNiArOSw4IEBAIFRFU1RTID0gJChjaGVja19QUk9HUkFNUykKIGNvbW1vbl9zb3Vy
Y2VzID0JCQkJXAogCXNyYy91ZHNjcy5jCQkJCVwKIAlzcmMvdWRzY3MuaAkJCQlcCisJc3JjL3Zk
YWdlbnQtY29ubmVjdGlvbi5jCQlcCisJc3JjL3ZkYWdlbnQtY29ubmVjdGlvbi5oCQlcCiAJc3Jj
L3ZkYWdlbnRkLXByb3RvLXN0cmluZ3MuaAkJXAogCXNyYy92ZGFnZW50ZC1wcm90by5oCQkJXAog
CSQoTlVMTCkKZGlmZiAtLWdpdCBhL3NyYy91ZHNjcy5jIGIvc3JjL3Vkc2NzLmMKaW5kZXggMzJi
ZDZlNi4uN2FlMWViZSAxMDA2NDQKLS0tIGEvc3JjL3Vkc2NzLmMKKysrIGIvc3JjL3Vkc2NzLmMK
QEAgLTIyLDU4ICsyMiwyNCBAQAogKi8KICNpbmNsdWRlIDxjb25maWcuaD4KIAotI2luY2x1ZGUg
PHN0ZGlvLmg+CiAjaW5jbHVkZSA8c3RkbGliLmg+CiAjaW5jbHVkZSA8c3lzbG9nLmg+Ci0jaW5j
bHVkZSA8dW5pc3RkLmg+Ci0jaW5jbHVkZSA8ZXJybm8uaD4KLSNpbmNsdWRlIDxzeXMvc29ja2V0
Lmg+Ci0jaW5jbHVkZSA8c3lzL3VuLmg+Ci0jaW5jbHVkZSA8Z2xpYi5oPgogI2luY2x1ZGUgPGds
aWItdW5peC5oPgorI2luY2x1ZGUgPGdpby9ndW5peHNvY2tldGFkZHJlc3MuaD4KICNpbmNsdWRl
ICJ1ZHNjcy5oIgogI2luY2x1ZGUgInZkYWdlbnRkLXByb3RvLXN0cmluZ3MuaCIKLQotc3RydWN0
IHVkc2NzX2J1ZiB7Ci0gICAgdWludDhfdCAqYnVmOwotICAgIHNpemVfdCBwb3M7Ci0gICAgc2l6
ZV90IHNpemU7Ci0KLSAgICBzdHJ1Y3QgdWRzY3NfYnVmICpuZXh0OwotfTsKKyNpbmNsdWRlICJ2
ZGFnZW50LWNvbm5lY3Rpb24uaCIKIAogc3RydWN0IHVkc2NzX2Nvbm5lY3Rpb24gewotICAgIGlu
dCBmZDsKLSAgICBpbnQgZGVidWc7Ci0gICAgdm9pZCAqdXNlcl9kYXRhOwotI2lmbmRlZiBVRFND
U19OT19TRVJWRVIKLSAgICBzdHJ1Y3QgdWNyZWQgcGVlcl9jcmVkOwotI2VuZGlmCi0KLSAgICAv
KiBSZWFkIHN0dWZmLCBzaW5nbGUgYnVmZmVyLCBzZXBhcmF0ZSBoZWFkZXIgYW5kIGRhdGEgYnVm
ZmVyICovCi0gICAgaW50IGhlYWRlcl9yZWFkOwotICAgIHN0cnVjdCB1ZHNjc19tZXNzYWdlX2hl
YWRlciBoZWFkZXI7Ci0gICAgc3RydWN0IHVkc2NzX2J1ZiBkYXRhOworICAgIFZEQWdlbnRDb25u
ZWN0aW9uIHBhcmVudF9pbnN0YW5jZTsKIAotICAgIC8qIFdyaXRlcyBhcmUgc3RvcmVkIGluIGEg
bGlua2VkIGxpc3Qgb2YgYnVmZmVycywgd2l0aCBib3RoIHRoZSBoZWFkZXIKLSAgICAgICArIGRh
dGEgZm9yIGEgc2luZ2xlIG1lc3NhZ2UgaW4gMSBidWZmZXIuICovCi0gICAgc3RydWN0IHVkc2Nz
X2J1ZiAqd3JpdGVfYnVmOworICAgIGludCBkZWJ1ZzsKIAogICAgIC8qIENhbGxiYWNrcyAqLwog
ICAgIHVkc2NzX3JlYWRfY2FsbGJhY2sgcmVhZF9jYWxsYmFjazsKLSAgICB1ZHNjc19kaXNjb25u
ZWN0X2NhbGxiYWNrIGRpc2Nvbm5lY3RfY2FsbGJhY2s7Ci0KLSAgICBzdHJ1Y3QgdWRzY3NfY29u
bmVjdGlvbiAqbmV4dDsKLSAgICBzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqcHJldjsKLQotICAg
IEdJT0NoYW5uZWwgICAgICAgICAgICAgICAgICAgICAqaW9fY2hhbm5lbDsKLSAgICBndWludCAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlX3dhdGNoX2lkOwotICAgIGd1aW50ICAgICAg
ICAgICAgICAgICAgICAgICAgICAgcmVhZF93YXRjaF9pZDsKIH07CiAKLXN0YXRpYyBnYm9vbGVh
biB1ZHNjc19pb19jaGFubmVsX2NiKEdJT0NoYW5uZWwgKnNvdXJjZSwKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIEdJT0NvbmRpdGlvbiBjb25kaXRpb24sCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBncG9pbnRlciBkYXRhKTsKK0dfREVGSU5FX1RZUEUo
VWRzY3NDb25uZWN0aW9uLCB1ZHNjc19jb25uZWN0aW9uLCBWREFHRU5UX1RZUEVfQ09OTkVDVElP
Tik7CiAKIHN0YXRpYyB2b2lkIGRlYnVnX3ByaW50X21lc3NhZ2VfaGVhZGVyKHN0cnVjdCB1ZHNj
c19jb25uZWN0aW9uICAgICAqY29ubiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHN0cnVjdCB1ZHNjc19tZXNzYWdlX2hlYWRlciAqaGVhZGVyLApAQCAtOTEsNDg1ICs1
NywyNTYgQEAgc3RhdGljIHZvaWQgZGVidWdfcHJpbnRfbWVzc2FnZV9oZWFkZXIoc3RydWN0IHVk
c2NzX2Nvbm5lY3Rpb24gICAgICpjb25uLAogICAgICAgICBjb25uLCBkaXJlY3Rpb24sIHR5cGUs
IGhlYWRlci0+YXJnMSwgaGVhZGVyLT5hcmcyLCBoZWFkZXItPnNpemUpOwogfQogCi1zdHJ1Y3Qg
dWRzY3NfY29ubmVjdGlvbiAqdWRzY3NfY29ubmVjdChjb25zdCBjaGFyICpzb2NrZXRuYW1lLAot
ICAgIHVkc2NzX3JlYWRfY2FsbGJhY2sgcmVhZF9jYWxsYmFjaywKLSAgICB1ZHNjc19kaXNjb25u
ZWN0X2NhbGxiYWNrIGRpc2Nvbm5lY3RfY2FsbGJhY2ssCi0gICAgaW50IGRlYnVnKQorc3RhdGlj
IGdzaXplIGNvbm5faGFuZGxlX2hlYWRlcihWREFnZW50Q29ubmVjdGlvbiAqY29ubiwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3BvaW50ZXIgICAgICAgICAgIGhlYWRlcl9idWYp
CiB7Ci0gICAgaW50IGM7Ci0gICAgc3RydWN0IHNvY2thZGRyX3VuIGFkZHJlc3M7Ci0gICAgc3Ry
dWN0IHVkc2NzX2Nvbm5lY3Rpb24gKmNvbm47Ci0KLSAgICBjb25uID0gZ19uZXcwKHN0cnVjdCB1
ZHNjc19jb25uZWN0aW9uLCAxKTsKLSAgICBjb25uLT5kZWJ1ZyA9IGRlYnVnOwotCi0gICAgY29u
bi0+ZmQgPSBzb2NrZXQoUEZfVU5JWCwgU09DS19TVFJFQU0sIDApOwotICAgIGlmIChjb25uLT5m
ZCA9PSAtMSkgewotICAgICAgICBzeXNsb2coTE9HX0VSUiwgImNyZWF0aW5nIHVuaXggZG9tYWlu
IHNvY2tldDogJW0iKTsKLSAgICAgICAgZ19mcmVlKGNvbm4pOwotICAgICAgICByZXR1cm4gTlVM
TDsKLSAgICB9Ci0KLSAgICBhZGRyZXNzLnN1bl9mYW1pbHkgPSBBRl9VTklYOwotICAgIHNucHJp
bnRmKGFkZHJlc3Muc3VuX3BhdGgsIHNpemVvZihhZGRyZXNzLnN1bl9wYXRoKSwgIiVzIiwgc29j
a2V0bmFtZSk7Ci0gICAgYyA9IGNvbm5lY3QoY29ubi0+ZmQsIChzdHJ1Y3Qgc29ja2FkZHIgKikm
YWRkcmVzcywgc2l6ZW9mKGFkZHJlc3MpKTsKLSAgICBpZiAoYyAhPSAwKSB7Ci0gICAgICAgIGlm
IChjb25uLT5kZWJ1ZykgewotICAgICAgICAgICAgc3lzbG9nKExPR19ERUJVRywgImNvbm5lY3Qg
JXM6ICVtIiwgc29ja2V0bmFtZSk7Ci0gICAgICAgIH0KLSAgICAgICAgY2xvc2UoY29ubi0+ZmQp
OwotICAgICAgICBnX2ZyZWUoY29ubik7Ci0gICAgICAgIHJldHVybiBOVUxMOwotICAgIH0KLQot
ICAgIGNvbm4tPmlvX2NoYW5uZWwgPSBnX2lvX2NoYW5uZWxfdW5peF9uZXcoY29ubi0+ZmQpOwot
ICAgIGlmICghY29ubi0+aW9fY2hhbm5lbCkgewotICAgICAgICB1ZHNjc19kZXN0cm95X2Nvbm5l
Y3Rpb24oJmNvbm4pOwotICAgICAgICByZXR1cm4gTlVMTDsKLSAgICB9Ci0gICAgY29ubi0+cmVh
ZF93YXRjaF9pZCA9Ci0gICAgICAgIGdfaW9fYWRkX3dhdGNoKGNvbm4tPmlvX2NoYW5uZWwsCi0g
ICAgICAgICAgICAgICAgICAgICAgIEdfSU9fSU4gfCBHX0lPX0VSUiB8IEdfSU9fTlZBTCwKLSAg
ICAgICAgICAgICAgICAgICAgICAgdWRzY3NfaW9fY2hhbm5lbF9jYiwKLSAgICAgICAgICAgICAg
ICAgICAgICAgY29ubik7Ci0KLSAgICBjb25uLT5yZWFkX2NhbGxiYWNrID0gcmVhZF9jYWxsYmFj
azsKLSAgICBjb25uLT5kaXNjb25uZWN0X2NhbGxiYWNrID0gZGlzY29ubmVjdF9jYWxsYmFjazsK
LQotICAgIGlmIChjb25uLT5kZWJ1ZykKLSAgICAgICAgc3lzbG9nKExPR19ERUJVRywgIiVwIGNv
bm5lY3RlZCB0byAlcyIsIGNvbm4sIHNvY2tldG5hbWUpOwotCi0gICAgcmV0dXJuIGNvbm47Cisg
ICAgcmV0dXJuICgoc3RydWN0IHVkc2NzX21lc3NhZ2VfaGVhZGVyICopaGVhZGVyX2J1ZiktPnNp
emU7CiB9CiAKLXZvaWQgdWRzY3NfZGVzdHJveV9jb25uZWN0aW9uKHN0cnVjdCB1ZHNjc19jb25u
ZWN0aW9uICoqY29ubnApCitzdGF0aWMgdm9pZCBjb25uX2hhbmRsZV9tZXNzYWdlKFZEQWdlbnRD
b25uZWN0aW9uICpjb25uLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncG9pbnRl
ciAgICAgICAgICAgaGVhZGVyX2J1ZiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Z3BvaW50ZXIgICAgICAgICAgIGRhdGEpCiB7Ci0gICAgc3RydWN0IHVkc2NzX2J1ZiAqd2J1Ziwg
Km5leHRfd2J1ZjsKLSAgICBzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqY29ubiA9ICpjb25ucDsK
KyAgICBVZHNjc0Nvbm5lY3Rpb24gKnNlbGYgPSBVRFNDU19DT05ORUNUSU9OKGNvbm4pOworICAg
IHN0cnVjdCB1ZHNjc19tZXNzYWdlX2hlYWRlciAqaGVhZGVyID0gaGVhZGVyX2J1ZjsKIAotICAg
IGlmICghY29ubikKLSAgICAgICAgcmV0dXJuOworICAgIGRlYnVnX3ByaW50X21lc3NhZ2VfaGVh
ZGVyKHNlbGYsIGhlYWRlciwgInJlY2VpdmVkIik7CiAKLSAgICBpZiAoY29ubi0+ZGlzY29ubmVj
dF9jYWxsYmFjaykKLSAgICAgICAgY29ubi0+ZGlzY29ubmVjdF9jYWxsYmFjayhjb25uKTsKKyAg
ICBzZWxmLT5yZWFkX2NhbGxiYWNrKHNlbGYsIGhlYWRlciwgZGF0YSk7Cit9CiAKLSAgICB3YnVm
ID0gY29ubi0+d3JpdGVfYnVmOwotICAgIHdoaWxlICh3YnVmKSB7Ci0gICAgICAgIG5leHRfd2J1
ZiA9IHdidWYtPm5leHQ7Ci0gICAgICAgIGdfZnJlZSh3YnVmLT5idWYpOwotICAgICAgICBnX2Zy
ZWUod2J1Zik7Ci0gICAgICAgIHdidWYgPSBuZXh0X3didWY7Ci0gICAgfQorc3RhdGljIHZvaWQg
dWRzY3NfY29ubmVjdGlvbl9pbml0KFVkc2NzQ29ubmVjdGlvbiAqc2VsZikKK3sKK30KIAotICAg
IGdfY2xlYXJfcG9pbnRlcigmY29ubi0+ZGF0YS5idWYsIGdfZnJlZSk7CitzdGF0aWMgdm9pZCB1
ZHNjc19jb25uZWN0aW9uX2ZpbmFsaXplKEdPYmplY3QgKm9iaikKK3sKKyAgICBVZHNjc0Nvbm5l
Y3Rpb24gKnNlbGYgPSBVRFNDU19DT05ORUNUSU9OKG9iaik7CiAKLSAgICBpZiAoY29ubi0+bmV4
dCkKLSAgICAgICAgY29ubi0+bmV4dC0+cHJldiA9IGNvbm4tPnByZXY7Ci0gICAgaWYgKGNvbm4t
PnByZXYpCi0gICAgICAgIGNvbm4tPnByZXYtPm5leHQgPSBjb25uLT5uZXh0OworICAgIGlmIChz
ZWxmLT5kZWJ1ZykKKyAgICAgICAgc3lzbG9nKExPR19ERUJVRywgIiVwIGRpc2Nvbm5lY3RlZCIs
IHNlbGYpOwogCi0gICAgY2xvc2UoY29ubi0+ZmQpOworICAgIEdfT0JKRUNUX0NMQVNTKHVkc2Nz
X2Nvbm5lY3Rpb25fcGFyZW50X2NsYXNzKS0+ZmluYWxpemUob2JqKTsKK30KIAotICAgIGlmIChj
b25uLT53cml0ZV93YXRjaF9pZCAhPSAwKQotICAgICAgICBnX3NvdXJjZV9yZW1vdmUoY29ubi0+
d3JpdGVfd2F0Y2hfaWQpOwotICAgIGlmIChjb25uLT5yZWFkX3dhdGNoX2lkICE9IDApCi0gICAg
ICAgIGdfc291cmNlX3JlbW92ZShjb25uLT5yZWFkX3dhdGNoX2lkKTsKLSAgICBnX2NsZWFyX3Bv
aW50ZXIoJmNvbm4tPmlvX2NoYW5uZWwsIGdfaW9fY2hhbm5lbF91bnJlZik7CitzdGF0aWMgdm9p
ZCB1ZHNjc19jb25uZWN0aW9uX2NsYXNzX2luaXQoVWRzY3NDb25uZWN0aW9uQ2xhc3MgKmtsYXNz
KQoreworICAgIEdPYmplY3RDbGFzcyAqZ29iamVjdF9jbGFzcyA9IEdfT0JKRUNUX0NMQVNTKGts
YXNzKTsKKyAgICBWREFnZW50Q29ubmVjdGlvbkNsYXNzICpjb25uX2NsYXNzID0gVkRBR0VOVF9D
T05ORUNUSU9OX0NMQVNTKGtsYXNzKTsKIAotICAgIGlmIChjb25uLT5kZWJ1ZykKLSAgICAgICAg
c3lzbG9nKExPR19ERUJVRywgIiVwIGRpc2Nvbm5lY3RlZCIsIGNvbm4pOworICAgIGdvYmplY3Rf
Y2xhc3MtPmZpbmFsaXplID0gdWRzY3NfY29ubmVjdGlvbl9maW5hbGl6ZTsKIAotICAgIGdfY2xl
YXJfcG9pbnRlcihjb25ucCwgZ19mcmVlKTsKKyAgICBjb25uX2NsYXNzLT5oYW5kbGVfaGVhZGVy
ID0gY29ubl9oYW5kbGVfaGVhZGVyOworICAgIGNvbm5fY2xhc3MtPmhhbmRsZV9tZXNzYWdlID0g
Y29ubl9oYW5kbGVfbWVzc2FnZTsKIH0KIAotdm9pZCB1ZHNjc19zZXRfdXNlcl9kYXRhKHN0cnVj
dCB1ZHNjc19jb25uZWN0aW9uICpjb25uLCB2b2lkICpkYXRhKQorc3RydWN0IHVkc2NzX2Nvbm5l
Y3Rpb24gKnVkc2NzX2Nvbm5lY3QoY29uc3QgY2hhciAqc29ja2V0bmFtZSwKKyAgICB1ZHNjc19y
ZWFkX2NhbGxiYWNrIHJlYWRfY2FsbGJhY2ssCisgICAgVkRBZ2VudENvbm5FcnJvckNiIGVycm9y
X2NiLAorICAgIGludCBkZWJ1ZykKIHsKLSAgICBjb25uLT51c2VyX2RhdGEgPSBkYXRhOwotfQor
ICAgIEdJT1N0cmVhbSAqaW9fc3RyZWFtOworICAgIHN0cnVjdCB1ZHNjc19jb25uZWN0aW9uICpj
b25uOworICAgIEdFcnJvciAqZXJyID0gTlVMTDsKIAotdm9pZCAqdWRzY3NfZ2V0X3VzZXJfZGF0
YShzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqY29ubikKLXsKLSAgICBpZiAoIWNvbm4pCisgICAg
aW9fc3RyZWFtID0gdmRhZ2VudF9zb2NrZXRfY29ubmVjdChzb2NrZXRuYW1lLCAmZXJyKTsKKyAg
ICBpZiAoZXJyKSB7CisgICAgICAgIHN5c2xvZyhMT0dfRVJSLCAiJXM6ICVzIiwgX19mdW5jX18s
IGVyci0+bWVzc2FnZSk7CisgICAgICAgIGdfZXJyb3JfZnJlZShlcnIpOwogICAgICAgICByZXR1
cm4gTlVMTDsKKyAgICB9CiAKLSAgICByZXR1cm4gY29ubi0+dXNlcl9kYXRhOworICAgIGNvbm4g
PSBnX29iamVjdF9uZXcoVURTQ1NfVFlQRV9DT05ORUNUSU9OLCBOVUxMKTsKKyAgICBjb25uLT5k
ZWJ1ZyA9IGRlYnVnOworICAgIGNvbm4tPnJlYWRfY2FsbGJhY2sgPSByZWFkX2NhbGxiYWNrOwor
ICAgIHZkYWdlbnRfY29ubmVjdGlvbl9zZXR1cChWREFHRU5UX0NPTk5FQ1RJT04oY29ubiksCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlvX3N0cmVhbSwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgRkFMU0UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVvZihz
dHJ1Y3QgdWRzY3NfbWVzc2FnZV9oZWFkZXIpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBlcnJvcl9jYik7CisKKyAgICBpZiAoY29ubi0+ZGVidWcpCisgICAgICAgIHN5c2xvZyhMT0df
REVCVUcsICIlcCBjb25uZWN0ZWQgdG8gJXMiLCBjb25uLCBzb2NrZXRuYW1lKTsKKworICAgIHJl
dHVybiBjb25uOwogfQogCiB2b2lkIHVkc2NzX3dyaXRlKHN0cnVjdCB1ZHNjc19jb25uZWN0aW9u
ICpjb25uLCB1aW50MzJfdCB0eXBlLCB1aW50MzJfdCBhcmcxLAogICAgIHVpbnQzMl90IGFyZzIs
IGNvbnN0IHVpbnQ4X3QgKmRhdGEsIHVpbnQzMl90IHNpemUpCiB7Ci0gICAgc3RydWN0IHVkc2Nz
X2J1ZiAqd2J1ZiwgKm5ld193YnVmOworICAgIGdwb2ludGVyIGJ1ZjsKKyAgICBndWludCBidWZf
c2l6ZTsKICAgICBzdHJ1Y3QgdWRzY3NfbWVzc2FnZV9oZWFkZXIgaGVhZGVyOwogCi0gICAgbmV3
X3didWYgPSBnX25ldyhzdHJ1Y3QgdWRzY3NfYnVmLCAxKTsKLSAgICBuZXdfd2J1Zi0+cG9zID0g
MDsKLSAgICBuZXdfd2J1Zi0+c2l6ZSA9IHNpemVvZihoZWFkZXIpICsgc2l6ZTsKLSAgICBuZXdf
d2J1Zi0+bmV4dCA9IE5VTEw7Ci0gICAgbmV3X3didWYtPmJ1ZiA9IGdfbWFsbG9jKG5ld193YnVm
LT5zaXplKTsKKyAgICBidWZfc2l6ZSA9IHNpemVvZihoZWFkZXIpICsgc2l6ZTsKKyAgICBidWYg
PSBnX21hbGxvYyhidWZfc2l6ZSk7CiAKICAgICBoZWFkZXIudHlwZSA9IHR5cGU7CiAgICAgaGVh
ZGVyLmFyZzEgPSBhcmcxOwogICAgIGhlYWRlci5hcmcyID0gYXJnMjsKICAgICBoZWFkZXIuc2l6
ZSA9IHNpemU7CiAKLSAgICBtZW1jcHkobmV3X3didWYtPmJ1ZiwgJmhlYWRlciwgc2l6ZW9mKGhl
YWRlcikpOwotICAgIG1lbWNweShuZXdfd2J1Zi0+YnVmICsgc2l6ZW9mKGhlYWRlciksIGRhdGEs
IHNpemUpOworICAgIG1lbWNweShidWYsICZoZWFkZXIsIHNpemVvZihoZWFkZXIpKTsKKyAgICBt
ZW1jcHkoYnVmICsgc2l6ZW9mKGhlYWRlciksIGRhdGEsIHNpemUpOwogCiAgICAgZGVidWdfcHJp
bnRfbWVzc2FnZV9oZWFkZXIoY29ubiwgJmhlYWRlciwgInNlbnQiKTsKIAotICAgIGlmIChjb25u
LT5pb19jaGFubmVsICYmIGNvbm4tPndyaXRlX3dhdGNoX2lkID09IDApCi0gICAgICAgIGNvbm4t
PndyaXRlX3dhdGNoX2lkID0KLSAgICAgICAgICAgIGdfaW9fYWRkX3dhdGNoKGNvbm4tPmlvX2No
YW5uZWwsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICBHX0lPX09VVCB8IEdfSU9fRVJSIHwg
R19JT19OVkFMLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgdWRzY3NfaW9fY2hhbm5lbF9j
YiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbm4pOwotCi0gICAgaWYgKCFjb25uLT53
cml0ZV9idWYpIHsKLSAgICAgICAgY29ubi0+d3JpdGVfYnVmID0gbmV3X3didWY7Ci0gICAgICAg
IHJldHVybjsKLSAgICB9Ci0KLSAgICAvKiBtYXliZSB3ZSBzaG91bGQgbGltaXQgdGhlIHdyaXRl
X2J1ZiBzdGFjayBkZXB0aCA/ICovCi0gICAgd2J1ZiA9IGNvbm4tPndyaXRlX2J1ZjsKLSAgICB3
aGlsZSAod2J1Zi0+bmV4dCkKLSAgICAgICAgd2J1ZiA9IHdidWYtPm5leHQ7Ci0KLSAgICB3YnVm
LT5uZXh0ID0gbmV3X3didWY7Ci19Ci0KLS8qIEEgaGVscGVyIGZvciB1ZHNjc19kb19yZWFkKCkg
Ki8KLXN0YXRpYyB2b2lkIHVkc2NzX3JlYWRfY29tcGxldGUoc3RydWN0IHVkc2NzX2Nvbm5lY3Rp
b24gKipjb25ucCkKLXsKLSAgICBzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqY29ubiA9ICpjb25u
cDsKLQotICAgIGRlYnVnX3ByaW50X21lc3NhZ2VfaGVhZGVyKGNvbm4sICZjb25uLT5oZWFkZXIs
ICJyZWNlaXZlZCIpOwotCi0gICAgaWYgKGNvbm4tPnJlYWRfY2FsbGJhY2spIHsKLSAgICAgICAg
Y29ubi0+cmVhZF9jYWxsYmFjayhjb25ucCwgJmNvbm4tPmhlYWRlciwgY29ubi0+ZGF0YS5idWYp
OwotICAgICAgICBpZiAoISpjb25ucCkgLyogV2FzIHRoZSBjb25uZWN0aW9uIGRpc2Nvbm5lY3Rl
ZCBieSB0aGUgY2FsbGJhY2sgPyAqLwotICAgICAgICAgICAgcmV0dXJuOwotICAgIH0KLQotICAg
IGdfZnJlZShjb25uLT5kYXRhLmJ1Zik7Ci0gICAgbWVtc2V0KCZjb25uLT5kYXRhLCAwLCBzaXpl
b2YoY29ubi0+ZGF0YSkpOyAvKiBkYXRhLmJ1ZiA9IE5VTEwgKi8KLSAgICBjb25uLT5oZWFkZXJf
cmVhZCA9IDA7Ci19Ci0KLXN0YXRpYyB2b2lkIHVkc2NzX2RvX3JlYWQoc3RydWN0IHVkc2NzX2Nv
bm5lY3Rpb24gKipjb25ucCkKLXsKLSAgICBzc2l6ZV90IG47Ci0gICAgc2l6ZV90IHRvX3JlYWQ7
Ci0gICAgdWludDhfdCAqZGVzdDsKLSAgICBzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqY29ubiA9
ICpjb25ucDsKLQotICAgIGlmIChjb25uLT5oZWFkZXJfcmVhZCA8IHNpemVvZihjb25uLT5oZWFk
ZXIpKSB7Ci0gICAgICAgIHRvX3JlYWQgPSBzaXplb2YoY29ubi0+aGVhZGVyKSAtIGNvbm4tPmhl
YWRlcl9yZWFkOwotICAgICAgICBkZXN0ID0gKHVpbnQ4X3QgKikmY29ubi0+aGVhZGVyICsgY29u
bi0+aGVhZGVyX3JlYWQ7Ci0gICAgfSBlbHNlIHsKLSAgICAgICAgdG9fcmVhZCA9IGNvbm4tPmRh
dGEuc2l6ZSAtIGNvbm4tPmRhdGEucG9zOwotICAgICAgICBkZXN0ID0gY29ubi0+ZGF0YS5idWYg
KyBjb25uLT5kYXRhLnBvczsKLSAgICB9Ci0KLSAgICBuID0gcmVhZChjb25uLT5mZCwgZGVzdCwg
dG9fcmVhZCk7Ci0gICAgaWYgKG4gPCAwKSB7Ci0gICAgICAgIGlmIChlcnJubyA9PSBFSU5UUikK
LSAgICAgICAgICAgIHJldHVybjsKLSAgICAgICAgc3lzbG9nKExPR19FUlIsICJyZWFkaW5nIHVu
aXggZG9tYWluIHNvY2tldDogJW0sIGRpc2Nvbm5lY3RpbmcgJXAiLAotICAgICAgICAgICAgICAg
Y29ubik7Ci0gICAgfQotICAgIGlmIChuIDw9IDApIHsKLSAgICAgICAgdWRzY3NfZGVzdHJveV9j
b25uZWN0aW9uKGNvbm5wKTsKLSAgICAgICAgcmV0dXJuOwotICAgIH0KLQotICAgIGlmIChjb25u
LT5oZWFkZXJfcmVhZCA8IHNpemVvZihjb25uLT5oZWFkZXIpKSB7Ci0gICAgICAgIGNvbm4tPmhl
YWRlcl9yZWFkICs9IG47Ci0gICAgICAgIGlmIChjb25uLT5oZWFkZXJfcmVhZCA9PSBzaXplb2Yo
Y29ubi0+aGVhZGVyKSkgewotICAgICAgICAgICAgaWYgKGNvbm4tPmhlYWRlci5zaXplID09IDAp
IHsKLSAgICAgICAgICAgICAgICB1ZHNjc19yZWFkX2NvbXBsZXRlKGNvbm5wKTsKLSAgICAgICAg
ICAgICAgICByZXR1cm47Ci0gICAgICAgICAgICB9Ci0gICAgICAgICAgICBjb25uLT5kYXRhLnBv
cyA9IDA7Ci0gICAgICAgICAgICBjb25uLT5kYXRhLnNpemUgPSBjb25uLT5oZWFkZXIuc2l6ZTsK
LSAgICAgICAgICAgIGNvbm4tPmRhdGEuYnVmID0gZ19tYWxsb2MoY29ubi0+ZGF0YS5zaXplKTsK
LSAgICAgICAgfQotICAgIH0gZWxzZSB7Ci0gICAgICAgIGNvbm4tPmRhdGEucG9zICs9IG47Ci0g
ICAgICAgIGlmIChjb25uLT5kYXRhLnBvcyA9PSBjb25uLT5kYXRhLnNpemUpCi0gICAgICAgICAg
ICB1ZHNjc19yZWFkX2NvbXBsZXRlKGNvbm5wKTsKLSAgICB9Ci19Ci0KLXN0YXRpYyB2b2lkIHVk
c2NzX2RvX3dyaXRlKHN0cnVjdCB1ZHNjc19jb25uZWN0aW9uICoqY29ubnApCi17Ci0gICAgc3Np
emVfdCBuOwotICAgIHNpemVfdCB0b193cml0ZTsKLSAgICBzdHJ1Y3QgdWRzY3NfY29ubmVjdGlv
biAqY29ubiA9ICpjb25ucDsKLQotICAgIHN0cnVjdCB1ZHNjc19idWYqIHdidWYgPSBjb25uLT53
cml0ZV9idWY7Ci0gICAgaWYgKCF3YnVmKSB7Ci0gICAgICAgIHN5c2xvZyhMT0dfRVJSLAotICAg
ICAgICAgICAgICAgIiVwIGRvX3dyaXRlIGNhbGxlZCBvbiBhIGNvbm5lY3Rpb24gd2l0aG91dCBh
IHdyaXRlIGJ1ZiA/ISIsCi0gICAgICAgICAgICAgICBjb25uKTsKLSAgICAgICAgcmV0dXJuOwot
ICAgIH0KLQotICAgIHRvX3dyaXRlID0gd2J1Zi0+c2l6ZSAtIHdidWYtPnBvczsKLSAgICBuID0g
d3JpdGUoY29ubi0+ZmQsIHdidWYtPmJ1ZiArIHdidWYtPnBvcywgdG9fd3JpdGUpOwotICAgIGlm
IChuIDwgMCkgewotICAgICAgICBpZiAoZXJybm8gPT0gRUlOVFIpCi0gICAgICAgICAgICByZXR1
cm47Ci0gICAgICAgIHN5c2xvZyhMT0dfRVJSLCAid3JpdGluZyB0byB1bml4IGRvbWFpbiBzb2Nr
ZXQ6ICVtLCBkaXNjb25uZWN0aW5nICVwIiwKLSAgICAgICAgICAgICAgIGNvbm4pOwotICAgICAg
ICB1ZHNjc19kZXN0cm95X2Nvbm5lY3Rpb24oY29ubnApOwotICAgICAgICByZXR1cm47Ci0gICAg
fQotCi0gICAgd2J1Zi0+cG9zICs9IG47Ci0gICAgaWYgKHdidWYtPnBvcyA9PSB3YnVmLT5zaXpl
KSB7Ci0gICAgICAgIGNvbm4tPndyaXRlX2J1ZiA9IHdidWYtPm5leHQ7Ci0gICAgICAgIGdfZnJl
ZSh3YnVmLT5idWYpOwotICAgICAgICBnX2ZyZWUod2J1Zik7Ci0gICAgfQotfQotCi1zdGF0aWMg
Z2Jvb2xlYW4gdWRzY3NfaW9fY2hhbm5lbF9jYihHSU9DaGFubmVsICpzb3VyY2UsCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHSU9Db25kaXRpb24gY29uZGl0aW9uLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3BvaW50ZXIgZGF0YSkKLXsKLSAgICBz
dHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqY29ubiA9IGRhdGE7Ci0KLSAgICBpZiAoY29uZGl0aW9u
ICYgR19JT19JTikgewotICAgICAgICB1ZHNjc19kb19yZWFkKCZjb25uKTsKLSAgICAgICAgLy8g
Y292ZXJpdHlbY2hlY2tfYWZ0ZXJfZGVyZWZdIHByZXZpb3VzIGZ1bmN0aW9uIGNhbiBjaGFuZ2Ug
Y29ubgotICAgICAgICBpZiAoY29ubiA9PSBOVUxMKQotICAgICAgICAgICAgcmV0dXJuIEdfU09V
UkNFX1JFTU9WRTsKLSAgICAgICAgcmV0dXJuIEdfU09VUkNFX0NPTlRJTlVFOwotICAgIH0KLSAg
ICBpZiAoY29uZGl0aW9uICYgR19JT19PVVQpIHsKLSAgICAgICAgdWRzY3NfZG9fd3JpdGUoJmNv
bm4pOwotICAgICAgICAvLyBjb3Zlcml0eVtjaGVja19hZnRlcl9kZXJlZl0gcHJldmlvdXMgZnVu
Y3Rpb24gY2FuIGNoYW5nZSBjb25uCi0gICAgICAgIGlmIChjb25uID09IE5VTEwpCi0gICAgICAg
ICAgICByZXR1cm4gR19TT1VSQ0VfUkVNT1ZFOwotICAgICAgICBpZiAoY29ubi0+d3JpdGVfYnVm
KQotICAgICAgICAgICAgcmV0dXJuIEdfU09VUkNFX0NPTlRJTlVFOwotICAgICAgICBjb25uLT53
cml0ZV93YXRjaF9pZCA9IDA7Ci0gICAgICAgIHJldHVybiBHX1NPVVJDRV9SRU1PVkU7Ci0gICAg
fQotCi0gICAgdWRzY3NfZGVzdHJveV9jb25uZWN0aW9uKCZjb25uKTsKLSAgICByZXR1cm4gR19T
T1VSQ0VfUkVNT1ZFOworICAgIHZkYWdlbnRfY29ubmVjdGlvbl93cml0ZShWREFHRU5UX0NPTk5F
Q1RJT04oY29ubiksIGJ1ZiwgYnVmX3NpemUpOwogfQogCi0KICNpZm5kZWYgVURTQ1NfTk9fU0VS
VkVSCiAKIC8qIC0tLS0tLS0tLS0gU2VydmVyLXNpZGUgaW1wbGVtZW50YXRpb24gLS0tLS0tLS0t
LSAqLwogCiBzdHJ1Y3QgdWRzY3Nfc2VydmVyIHsKLSAgICBpbnQgZmQ7CisgICAgR1NvY2tldFNl
cnZpY2UgKnNlcnZpY2U7CisgICAgR0xpc3QgKmNvbm5lY3Rpb25zOworCiAgICAgaW50IGRlYnVn
OwotICAgIHN0cnVjdCB1ZHNjc19jb25uZWN0aW9uIGNvbm5lY3Rpb25zX2hlYWQ7CiAgICAgdWRz
Y3NfY29ubmVjdF9jYWxsYmFjayBjb25uZWN0X2NhbGxiYWNrOwogICAgIHVkc2NzX3JlYWRfY2Fs
bGJhY2sgcmVhZF9jYWxsYmFjazsKLSAgICB1ZHNjc19kaXNjb25uZWN0X2NhbGxiYWNrIGRpc2Nv
bm5lY3RfY2FsbGJhY2s7CisgICAgVkRBZ2VudENvbm5FcnJvckNiIGVycm9yX2NiOwogfTsKIAot
c3RydWN0IHVkc2NzX3NlcnZlciAqdWRzY3NfY3JlYXRlX3NlcnZlcl9mb3JfZmQoaW50IGZkLAor
c3RhdGljIGdib29sZWFuIHVkc2NzX3NlcnZlcl9hY2NlcHRfY2IoR1NvY2tldFNlcnZpY2UgICAg
KnNlcnZpY2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHU29ja2V0
Q29ubmVjdGlvbiAqc29ja2V0X2Nvbm4sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBHT2JqZWN0ICAgICAgICAgICAqc291cmNlX29iamVjdCwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGdwb2ludGVyICAgICAgICAgICB1c2VyX2RhdGEpOwor
CitzdGF0aWMgc3RydWN0IHVkc2NzX3NlcnZlciAqdWRzY3Nfc2VydmVyX25ldygKICAgICB1ZHNj
c19jb25uZWN0X2NhbGxiYWNrIGNvbm5lY3RfY2FsbGJhY2ssCiAgICAgdWRzY3NfcmVhZF9jYWxs
YmFjayByZWFkX2NhbGxiYWNrLAotICAgIHVkc2NzX2Rpc2Nvbm5lY3RfY2FsbGJhY2sgZGlzY29u
bmVjdF9jYWxsYmFjaywKKyAgICBWREFnZW50Q29ubkVycm9yQ2IgZXJyb3JfY2IsCiAgICAgaW50
IGRlYnVnKQogewogICAgIHN0cnVjdCB1ZHNjc19zZXJ2ZXIgKnNlcnZlcjsKIAotICAgIGlmIChm
ZCA8PSAwKSB7Ci0gICAgICAgIHN5c2xvZyhMT0dfRVJSLCAiSW52YWxpZCBmaWxlIGRlc2NyaXB0
b3I6ICVpIiwgZmQpOwotICAgICAgICByZXR1cm4gTlVMTDsKLSAgICB9Ci0KICAgICBzZXJ2ZXIg
PSBnX25ldzAoc3RydWN0IHVkc2NzX3NlcnZlciwgMSk7CiAgICAgc2VydmVyLT5kZWJ1ZyA9IGRl
YnVnOwotICAgIHNlcnZlci0+ZmQgPSBmZDsKICAgICBzZXJ2ZXItPmNvbm5lY3RfY2FsbGJhY2sg
PSBjb25uZWN0X2NhbGxiYWNrOwogICAgIHNlcnZlci0+cmVhZF9jYWxsYmFjayA9IHJlYWRfY2Fs
bGJhY2s7Ci0gICAgc2VydmVyLT5kaXNjb25uZWN0X2NhbGxiYWNrID0gZGlzY29ubmVjdF9jYWxs
YmFjazsKKyAgICBzZXJ2ZXItPmVycm9yX2NiID0gZXJyb3JfY2I7CisgICAgc2VydmVyLT5zZXJ2
aWNlID0gZ19zb2NrZXRfc2VydmljZV9uZXcoKTsKKworICAgIGdfc2lnbmFsX2Nvbm5lY3Qoc2Vy
dmVyLT5zZXJ2aWNlLCAiaW5jb21pbmciLAorICAgICAgICBHX0NBTExCQUNLKHVkc2NzX3NlcnZl
cl9hY2NlcHRfY2IpLCBzZXJ2ZXIpOwogCiAgICAgcmV0dXJuIHNlcnZlcjsKIH0KIAotc3RydWN0
IHVkc2NzX3NlcnZlciAqdWRzY3NfY3JlYXRlX3NlcnZlcihjb25zdCBjaGFyICpzb2NrZXRuYW1l
LAorc3RydWN0IHVkc2NzX3NlcnZlciAqdWRzY3NfY3JlYXRlX3NlcnZlcl9mb3JfZmQoaW50IGZk
LAogICAgIHVkc2NzX2Nvbm5lY3RfY2FsbGJhY2sgY29ubmVjdF9jYWxsYmFjaywKICAgICB1ZHNj
c19yZWFkX2NhbGxiYWNrIHJlYWRfY2FsbGJhY2ssCi0gICAgdWRzY3NfZGlzY29ubmVjdF9jYWxs
YmFjayBkaXNjb25uZWN0X2NhbGxiYWNrLAorICAgIFZEQWdlbnRDb25uRXJyb3JDYiBlcnJvcl9j
YiwKICAgICBpbnQgZGVidWcpCiB7Ci0gICAgaW50IGM7Ci0gICAgaW50IGZkOwotICAgIHN0cnVj
dCBzb2NrYWRkcl91biBhZGRyZXNzOwogICAgIHN0cnVjdCB1ZHNjc19zZXJ2ZXIgKnNlcnZlcjsK
KyAgICBHU29ja2V0ICpzb2NrZXQ7CisgICAgR0Vycm9yICplcnIgPSBOVUxMOwogCi0gICAgZmQg
PSBzb2NrZXQoUEZfVU5JWCwgU09DS19TVFJFQU0sIDApOwotICAgIGlmIChmZCA9PSAtMSkgewot
ICAgICAgICBzeXNsb2coTE9HX0VSUiwgImNyZWF0aW5nIHVuaXggZG9tYWluIHNvY2tldDogJW0i
KTsKLSAgICAgICAgcmV0dXJuIE5VTEw7Ci0gICAgfQorICAgIHNlcnZlciA9IHVkc2NzX3NlcnZl
cl9uZXcoY29ubmVjdF9jYWxsYmFjaywgcmVhZF9jYWxsYmFjaywKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGVycm9yX2NiLCBkZWJ1Zyk7CiAKLSAgICBhZGRyZXNzLnN1bl9mYW1pbHkg
PSBBRl9VTklYOwotICAgIHNucHJpbnRmKGFkZHJlc3Muc3VuX3BhdGgsIHNpemVvZihhZGRyZXNz
LnN1bl9wYXRoKSwgIiVzIiwgc29ja2V0bmFtZSk7Ci0gICAgYyA9IGJpbmQoZmQsIChzdHJ1Y3Qg
c29ja2FkZHIgKikmYWRkcmVzcywgc2l6ZW9mKGFkZHJlc3MpKTsKLSAgICBpZiAoYyAhPSAwKSB7
Ci0gICAgICAgIHN5c2xvZyhMT0dfRVJSLCAiYmluZCAlczogJW0iLCBzb2NrZXRuYW1lKTsKLSAg
ICAgICAgY2xvc2UoZmQpOwotICAgICAgICByZXR1cm4gTlVMTDsKLSAgICB9CisgICAgc29ja2V0
ID0gZ19zb2NrZXRfbmV3X2Zyb21fZmQoZmQsICZlcnIpOworICAgIGlmIChlcnIpCisgICAgICAg
IGdvdG8gZXJyb3I7CisgICAgZ19zb2NrZXRfbGlzdGVuZXJfYWRkX3NvY2tldChHX1NPQ0tFVF9M
SVNURU5FUihzZXJ2ZXItPnNlcnZpY2UpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgc29ja2V0LCBOVUxMLCAmZXJyKTsKKyAgICBnX29iamVjdF91bnJlZihzb2NrZXQpOworICAg
IGlmIChlcnIpCisgICAgICAgIGdvdG8gZXJyb3I7CiAKLSAgICBjID0gbGlzdGVuKGZkLCA1KTsK
LSAgICBpZiAoYyAhPSAwKSB7Ci0gICAgICAgIHN5c2xvZyhMT0dfRVJSLCAibGlzdGVuOiAlbSIp
OwotICAgICAgICBjbG9zZShmZCk7Ci0gICAgICAgIHJldHVybiBOVUxMOwotICAgIH0KLQotICAg
IHNlcnZlciA9IHVkc2NzX2NyZWF0ZV9zZXJ2ZXJfZm9yX2ZkKGZkLCBjb25uZWN0X2NhbGxiYWNr
LCByZWFkX2NhbGxiYWNrLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGRpc2Nvbm5lY3RfY2FsbGJhY2ssIGRlYnVnKTsKKyAgICByZXR1cm4gc2VydmVyOworZXJyb3I6
CisgICAgc3lzbG9nKExPR19FUlIsICIlczogJXMiLCBfX2Z1bmNfXywgZXJyLT5tZXNzYWdlKTsK
KyAgICBnX2Vycm9yX2ZyZWUoZXJyKTsKKyAgICB1ZHNjc19kZXN0cm95X3NlcnZlcihzZXJ2ZXIp
OworICAgIHJldHVybiBOVUxMOworfQogCi0gICAgaWYgKCFzZXJ2ZXIpIHsKLSAgICAgICAgY2xv
c2UoZmQpOworc3RydWN0IHVkc2NzX3NlcnZlciAqdWRzY3NfY3JlYXRlX3NlcnZlcihjb25zdCBj
aGFyICpzb2NrZXRuYW1lLAorICAgIHVkc2NzX2Nvbm5lY3RfY2FsbGJhY2sgY29ubmVjdF9jYWxs
YmFjaywKKyAgICB1ZHNjc19yZWFkX2NhbGxiYWNrIHJlYWRfY2FsbGJhY2ssCisgICAgVkRBZ2Vu
dENvbm5FcnJvckNiIGVycm9yX2NiLAorICAgIGludCBkZWJ1ZykKK3sKKyAgICBzdHJ1Y3QgdWRz
Y3Nfc2VydmVyICpzZXJ2ZXI7CisgICAgR1NvY2tldEFkZHJlc3MgKnNvY2tldF9hZGRyOworICAg
IEdFcnJvciAqZXJyID0gTlVMTDsKKworICAgIHNlcnZlciA9IHVkc2NzX3NlcnZlcl9uZXcoY29u
bmVjdF9jYWxsYmFjaywgcmVhZF9jYWxsYmFjaywKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGVycm9yX2NiLCBkZWJ1Zyk7CisKKyAgICBzb2NrZXRfYWRkciA9IGdfdW5peF9zb2NrZXRf
YWRkcmVzc19uZXcoc29ja2V0bmFtZSk7CisgICAgZ19zb2NrZXRfbGlzdGVuZXJfYWRkX2FkZHJl
c3MoR19TT0NLRVRfTElTVEVORVIoc2VydmVyLT5zZXJ2aWNlKSwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBzb2NrZXRfYWRkciwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBHX1NPQ0tFVF9UWVBFX1NUUkVBTSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBHX1NPQ0tFVF9QUk9UT0NPTF9ERUZBVUxULAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIE5VTEwsIE5VTEwsICZlcnIpOworICAgIGdfb2JqZWN0X3VucmVmKHNvY2tl
dF9hZGRyKTsKKyAgICBpZiAoZXJyKSB7CisgICAgICAgIHN5c2xvZyhMT0dfRVJSLCAiJXM6ICVz
IiwgX19mdW5jX18sIGVyci0+bWVzc2FnZSk7CisgICAgICAgIGdfZXJyb3JfZnJlZShlcnIpOwor
ICAgICAgICB1ZHNjc19kZXN0cm95X3NlcnZlcihzZXJ2ZXIpOworICAgICAgICByZXR1cm4gTlVM
TDsKICAgICB9CiAKICAgICByZXR1cm4gc2VydmVyOwogfQogCi12b2lkIHVkc2NzX2Rlc3Ryb3lf
c2VydmVyKHN0cnVjdCB1ZHNjc19zZXJ2ZXIgKnNlcnZlcikKK3ZvaWQgdWRzY3Nfc2VydmVyX2Rl
c3Ryb3lfY29ubmVjdGlvbihzdHJ1Y3QgdWRzY3Nfc2VydmVyICpzZXJ2ZXIsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgVWRzY3NDb25uZWN0aW9uICAgICAqY29ubikKIHsK
LSAgICBzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqY29ubiwgKm5leHRfY29ubjsKKyAgICBzZXJ2
ZXItPmNvbm5lY3Rpb25zID0gZ19saXN0X3JlbW92ZShzZXJ2ZXItPmNvbm5lY3Rpb25zLCBjb25u
KTsKKyAgICB2ZGFnZW50X2Nvbm5lY3Rpb25fZGVzdHJveShjb25uKTsKK30KIAordm9pZCB1ZHNj
c19kZXN0cm95X3NlcnZlcihzdHJ1Y3QgdWRzY3Nfc2VydmVyICpzZXJ2ZXIpCit7CiAgICAgaWYg
KCFzZXJ2ZXIpCiAgICAgICAgIHJldHVybjsKIAotICAgIGNvbm4gPSBzZXJ2ZXItPmNvbm5lY3Rp
b25zX2hlYWQubmV4dDsKLSAgICB3aGlsZSAoY29ubikgewotICAgICAgICBuZXh0X2Nvbm4gPSBj
b25uLT5uZXh0OwotICAgICAgICB1ZHNjc19kZXN0cm95X2Nvbm5lY3Rpb24oJmNvbm4pOwotICAg
ICAgICBjb25uID0gbmV4dF9jb25uOwotICAgIH0KLSAgICBjbG9zZShzZXJ2ZXItPmZkKTsKKyAg
ICBnX2xpc3RfZnJlZV9mdWxsKHNlcnZlci0+Y29ubmVjdGlvbnMsIHZkYWdlbnRfY29ubmVjdGlv
bl9kZXN0cm95KTsKKyAgICBnX29iamVjdF91bnJlZihzZXJ2ZXItPnNlcnZpY2UpOwogICAgIGdf
ZnJlZShzZXJ2ZXIpOwogfQogCi1pbnQgdWRzY3NfZ2V0X3BlZXJfcGlkKHN0cnVjdCB1ZHNjc19j
b25uZWN0aW9uICpjb25uKQorc3RhdGljIGdib29sZWFuIHVkc2NzX3NlcnZlcl9hY2NlcHRfY2Io
R1NvY2tldFNlcnZpY2UgICAgKnNlcnZpY2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBHU29ja2V0Q29ubmVjdGlvbiAqc29ja2V0X2Nvbm4sCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBHT2JqZWN0ICAgICAgICAgICAqc291cmNlX29iamVj
dCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdwb2ludGVyICAgICAg
ICAgICB1c2VyX2RhdGEpCiB7Ci0gICAgcmV0dXJuIChpbnQpY29ubi0+cGVlcl9jcmVkLnBpZDsK
LX0KLQotc3RhdGljIHZvaWQgdWRzY3Nfc2VydmVyX2FjY2VwdChzdHJ1Y3QgdWRzY3Nfc2VydmVy
ICpzZXJ2ZXIpIHsKLSAgICBzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqbmV3X2Nvbm4sICpjb25u
OwotICAgIHN0cnVjdCBzb2NrYWRkcl91biBhZGRyZXNzOwotICAgIHNvY2tsZW5fdCBsZW5ndGgg
PSBzaXplb2YoYWRkcmVzcyk7Ci0gICAgaW50IHIsIGZkOwotCi0gICAgZmQgPSBhY2NlcHQoc2Vy
dmVyLT5mZCwgKHN0cnVjdCBzb2NrYWRkciAqKSZhZGRyZXNzLCAmbGVuZ3RoKTsKLSAgICBpZiAo
ZmQgPT0gLTEpIHsKLSAgICAgICAgaWYgKGVycm5vID09IEVJTlRSKQotICAgICAgICAgICAgcmV0
dXJuOwotICAgICAgICBzeXNsb2coTE9HX0VSUiwgImFjY2VwdDogJW0iKTsKLSAgICAgICAgcmV0
dXJuOwotICAgIH0KKyAgICBzdHJ1Y3QgdWRzY3Nfc2VydmVyICpzZXJ2ZXIgPSB1c2VyX2RhdGE7
CisgICAgc3RydWN0IHVkc2NzX2Nvbm5lY3Rpb24gKm5ld19jb25uOwogCi0gICAgbmV3X2Nvbm4g
PSBnX25ldzAoc3RydWN0IHVkc2NzX2Nvbm5lY3Rpb24sIDEpOwotICAgIG5ld19jb25uLT5mZCA9
IGZkOworICAgIG5ld19jb25uID0gZ19vYmplY3RfbmV3KFVEU0NTX1RZUEVfQ09OTkVDVElPTiwg
TlVMTCk7CiAgICAgbmV3X2Nvbm4tPmRlYnVnID0gc2VydmVyLT5kZWJ1ZzsKICAgICBuZXdfY29u
bi0+cmVhZF9jYWxsYmFjayA9IHNlcnZlci0+cmVhZF9jYWxsYmFjazsKLSAgICBuZXdfY29ubi0+
ZGlzY29ubmVjdF9jYWxsYmFjayA9IHNlcnZlci0+ZGlzY29ubmVjdF9jYWxsYmFjazsKLQotICAg
IGxlbmd0aCA9IHNpemVvZihuZXdfY29ubi0+cGVlcl9jcmVkKTsKLSAgICByID0gZ2V0c29ja29w
dChmZCwgU09MX1NPQ0tFVCwgU09fUEVFUkNSRUQsICZuZXdfY29ubi0+cGVlcl9jcmVkLCAmbGVu
Z3RoKTsKLSAgICBpZiAociAhPSAwKSB7Ci0gICAgICAgIHN5c2xvZyhMT0dfRVJSLCAiQ291bGQg
bm90IGdldCBwZWVyY3JlZCwgZGlzY29ubmVjdGluZyBuZXcgY2xpZW50Iik7Ci0gICAgICAgIGNs
b3NlKGZkKTsKLSAgICAgICAgZ19mcmVlKG5ld19jb25uKTsKLSAgICAgICAgcmV0dXJuOwotICAg
IH0KLQotICAgIGNvbm4gPSAmc2VydmVyLT5jb25uZWN0aW9uc19oZWFkOwotICAgIHdoaWxlIChj
b25uLT5uZXh0KQotICAgICAgICBjb25uID0gY29ubi0+bmV4dDsKKyAgICBnX29iamVjdF9yZWYo
c29ja2V0X2Nvbm4pOworICAgIHZkYWdlbnRfY29ubmVjdGlvbl9zZXR1cChWREFHRU5UX0NPTk5F
Q1RJT04obmV3X2Nvbm4pLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHX0lPX1NUUkVB
TShzb2NrZXRfY29ubiksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZBTFNFLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplb2Yoc3RydWN0IHVkc2NzX21lc3NhZ2VfaGVh
ZGVyKSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyLT5lcnJvcl9jYik7CiAK
LSAgICBuZXdfY29ubi0+cHJldiA9IGNvbm47Ci0gICAgY29ubi0+bmV4dCA9IG5ld19jb25uOwor
ICAgIHNlcnZlci0+Y29ubmVjdGlvbnMgPSBnX2xpc3RfcHJlcGVuZChzZXJ2ZXItPmNvbm5lY3Rp
b25zLCBuZXdfY29ubik7CiAKICAgICBpZiAoc2VydmVyLT5kZWJ1ZykKLSAgICAgICAgc3lzbG9n
KExPR19ERUJVRywgIm5ldyBjbGllbnQgYWNjZXB0ZWQ6ICVwLCBwaWQ6ICVkIiwKLSAgICAgICAg
ICAgICAgIG5ld19jb25uLCB1ZHNjc19nZXRfcGVlcl9waWQobmV3X2Nvbm4pKTsKKyAgICAgICAg
c3lzbG9nKExPR19ERUJVRywgIm5ldyBjbGllbnQgYWNjZXB0ZWQ6ICVwIiwgbmV3X2Nvbm4pOwog
CiAgICAgaWYgKHNlcnZlci0+Y29ubmVjdF9jYWxsYmFjaykKICAgICAgICAgc2VydmVyLT5jb25u
ZWN0X2NhbGxiYWNrKG5ld19jb25uKTsKLX0KIAotaW50IHVkc2NzX3NlcnZlcl9maWxsX2Zkcyhz
dHJ1Y3QgdWRzY3Nfc2VydmVyICpzZXJ2ZXIsIGZkX3NldCAqcmVhZGZkcywKLSAgICAgICAgZmRf
c2V0ICp3cml0ZWZkcykKLXsKLSAgICBzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqY29ubjsKLSAg
ICBpbnQgbmZkczsKLQotICAgIGlmICghc2VydmVyKQotICAgICAgICByZXR1cm4gLTE7Ci0KLSAg
ICBuZmRzID0gc2VydmVyLT5mZCArIDE7Ci0gICAgRkRfU0VUKHNlcnZlci0+ZmQsIHJlYWRmZHMp
OwotCi0gICAgY29ubiA9IHNlcnZlci0+Y29ubmVjdGlvbnNfaGVhZC5uZXh0OwotICAgIHdoaWxl
IChjb25uKSB7Ci0gICAgICAgIEZEX1NFVChjb25uLT5mZCwgcmVhZGZkcyk7Ci0gICAgICAgIGlm
IChjb25uLT53cml0ZV9idWYpCi0gICAgICAgICAgICBGRF9TRVQoY29ubi0+ZmQsIHdyaXRlZmRz
KTsKLQotICAgICAgICBpZiAoY29ubi0+ZmQgPj0gbmZkcykKLSAgICAgICAgICAgIG5mZHMgPSBj
b25uLT5mZCArIDE7Ci0KLSAgICAgICAgY29ubiA9IGNvbm4tPm5leHQ7Ci0gICAgfQotCi0gICAg
cmV0dXJuIG5mZHM7Ci19Ci0KLXZvaWQgdWRzY3Nfc2VydmVyX2hhbmRsZV9mZHMoc3RydWN0IHVk
c2NzX3NlcnZlciAqc2VydmVyLCBmZF9zZXQgKnJlYWRmZHMsCi0gICAgICAgIGZkX3NldCAqd3Jp
dGVmZHMpCi17Ci0gICAgc3RydWN0IHVkc2NzX2Nvbm5lY3Rpb24gKmNvbm4sICpuZXh0X2Nvbm47
Ci0KLSAgICBpZiAoIXNlcnZlcikKLSAgICAgICAgcmV0dXJuOwotCi0gICAgaWYgKEZEX0lTU0VU
KHNlcnZlci0+ZmQsIHJlYWRmZHMpKQotICAgICAgICB1ZHNjc19zZXJ2ZXJfYWNjZXB0KHNlcnZl
cik7Ci0KLSAgICBjb25uID0gc2VydmVyLT5jb25uZWN0aW9uc19oZWFkLm5leHQ7Ci0gICAgd2hp
bGUgKGNvbm4pIHsKLSAgICAgICAgLyogY29ubiBtYXkgYmUgZGVzdHJveWVkIGJ5IHVkc2NzX2Rv
X3JlYWQoKSBvciB1ZHNjc19kb193cml0ZSgpCi0gICAgICAgICAqICh3aGVuIGRpc2Nvbm5lY3Rl
ZCksIHNvIGdldCB0aGUgbmV4dCBjb25uZWN0aW9uIGZpcnN0LiAqLwotICAgICAgICBuZXh0X2Nv
bm4gPSBjb25uLT5uZXh0OwotCi0gICAgICAgIGlmIChGRF9JU1NFVChjb25uLT5mZCwgcmVhZGZk
cykpCi0gICAgICAgICAgICB1ZHNjc19kb19yZWFkKCZjb25uKTsKLSAgICAgICAgaWYgKGNvbm4g
JiYgRkRfSVNTRVQoY29ubi0+ZmQsIHdyaXRlZmRzKSkKLSAgICAgICAgICAgIHVkc2NzX2RvX3dy
aXRlKCZjb25uKTsKLQotICAgICAgICBjb25uID0gbmV4dF9jb25uOwotICAgIH0KKyAgICByZXR1
cm4gVFJVRTsKIH0KIAogdm9pZCB1ZHNjc19zZXJ2ZXJfd3JpdGVfYWxsKHN0cnVjdCB1ZHNjc19z
ZXJ2ZXIgKnNlcnZlciwKICAgICAgICAgdWludDMyX3QgdHlwZSwgdWludDMyX3QgYXJnMSwgdWlu
dDMyX3QgYXJnMiwKICAgICAgICAgY29uc3QgdWludDhfdCAqZGF0YSwgdWludDMyX3Qgc2l6ZSkK
IHsKLSAgICBzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqY29ubjsKLQotICAgIGNvbm4gPSBzZXJ2
ZXItPmNvbm5lY3Rpb25zX2hlYWQubmV4dDsKLSAgICB3aGlsZSAoY29ubikgewotICAgICAgICB1
ZHNjc193cml0ZShjb25uLCB0eXBlLCBhcmcxLCBhcmcyLCBkYXRhLCBzaXplKTsKLSAgICAgICAg
Y29ubiA9IGNvbm4tPm5leHQ7CisgICAgR0xpc3QgKmw7CisgICAgZm9yIChsID0gc2VydmVyLT5j
b25uZWN0aW9uczsgbDsgbCA9IGwtPm5leHQpIHsKKyAgICAgICAgdWRzY3Nfd3JpdGUoVURTQ1Nf
Q09OTkVDVElPTihsLT5kYXRhKSwgdHlwZSwgYXJnMSwgYXJnMiwgZGF0YSwgc2l6ZSk7CiAgICAg
fQogfQogCkBAIC01NzcsMTcgKzMxNCwxNiBAQCBpbnQgdWRzY3Nfc2VydmVyX2Zvcl9hbGxfY2xp
ZW50cyhzdHJ1Y3QgdWRzY3Nfc2VydmVyICpzZXJ2ZXIsCiAgICAgdWRzY3NfZm9yX2FsbF9jbGll
bnRzX2NhbGxiYWNrIGZ1bmMsIHZvaWQgKnByaXYpCiB7CiAgICAgaW50IHIgPSAwOwotICAgIHN0
cnVjdCB1ZHNjc19jb25uZWN0aW9uICpjb25uLCAqbmV4dF9jb25uOworICAgIEdMaXN0ICpsLCAq
bmV4dDsKIAogICAgIGlmICghc2VydmVyKQogICAgICAgICByZXR1cm4gMDsKIAotICAgIGNvbm4g
PSBzZXJ2ZXItPmNvbm5lY3Rpb25zX2hlYWQubmV4dDsKLSAgICB3aGlsZSAoY29ubikgewotICAg
ICAgICAvKiBHZXQgbmV4dCBjb25uIGFzIGZ1bmMgbWF5IGRlc3Ryb3kgdGhlIGN1cnJlbnQgY29u
biAqLwotICAgICAgICBuZXh0X2Nvbm4gPSBjb25uLT5uZXh0OwotICAgICAgICByICs9IGZ1bmMo
JmNvbm4sIHByaXYpOwotICAgICAgICBjb25uID0gbmV4dF9jb25uOworICAgIGwgPSBzZXJ2ZXIt
PmNvbm5lY3Rpb25zOworICAgIHdoaWxlIChsKSB7CisgICAgICAgIG5leHQgPSBsLT5uZXh0Owor
ICAgICAgICByICs9IGZ1bmMobC0+ZGF0YSwgcHJpdik7CisgICAgICAgIGwgPSBuZXh0OwogICAg
IH0KICAgICByZXR1cm4gcjsKIH0KZGlmZiAtLWdpdCBhL3NyYy91ZHNjcy5oIGIvc3JjL3Vkc2Nz
LmgKaW5kZXggMzYzY2ExOC4uMzgyZGEwNiAxMDA2NDQKLS0tIGEvc3JjL3Vkc2NzLmgKKysrIGIv
c3JjL3Vkc2NzLmgKQEAgLTIyLDExICsyMiwyOCBAQAogI2lmbmRlZiBfX1VEU0NTX0gKICNkZWZp
bmUgX19VRFNDU19ICiAKLSNpbmNsdWRlIDxzdGRpby5oPgogI2luY2x1ZGUgPHN0ZGludC5oPgot
I2luY2x1ZGUgPHN5cy9zZWxlY3QuaD4KICNpbmNsdWRlIDxzeXMvc29ja2V0Lmg+CisjaW5jbHVk
ZSA8Z2xpYi1vYmplY3QuaD4KKyNpbmNsdWRlICJ2ZGFnZW50LWNvbm5lY3Rpb24uaCIKIAorR19C
RUdJTl9ERUNMUworCisjZGVmaW5lIFVEU0NTX1RZUEVfQ09OTkVDVElPTiAgICAgICAgICAgICh1
ZHNjc19jb25uZWN0aW9uX2dldF90eXBlKCkpCisjZGVmaW5lIFVEU0NTX0NPTk5FQ1RJT04ob2Jq
KSAgICAgICAgICAgIChHX1RZUEVfQ0hFQ0tfSU5TVEFOQ0VfQ0FTVCgob2JqKSwgVURTQ1NfVFlQ
RV9DT05ORUNUSU9OLCBVZHNjc0Nvbm5lY3Rpb24pKQorI2RlZmluZSBVRFNDU19JU19DT05ORUNU
SU9OKG9iaikgICAgICAgICAoR19UWVBFX0NIRUNLX0lOU1RBTkNFX1RZUEUoKG9iaiksIFVEU0NT
X1RZUEVfQ09OTkVDVElPTikpCisjZGVmaW5lIFVEU0NTX0NPTk5FQ1RJT05fQ0xBU1Moa2xhc3Mp
ICAgIChHX1RZUEVfQ0hFQ0tfQ0xBU1NfQ0FTVCgoa2xhc3MpLCBVRFNDU19UWVBFX0NPTk5FQ1RJ
T04sIFVkc2NzQ29ubmVjdGlvbkNsYXNzKSkKKyNkZWZpbmUgVURTQ1NfSVNfQ09OTkVDVElPTl9D
TEFTUyhrbGFzcykgKEdfVFlQRV9DSEVDS19DTEFTU19UWVBFKChrbGFzcyksIFVEU0NTX1RZUEVf
Q09OTkVDVElPTikpCisjZGVmaW5lIFVEU0NTX0NPTk5FQ1RJT05fR0VUX0NMQVNTKG9iaikgIChH
X1RZUEVfSU5TVEFOQ0VfR0VUX0NMQVNTKChvYmopLCBVRFNDU19UWVBFX0NPTk5FQ1RJT04sIFVk
c2NzQ29ubmVjdGlvbkNsYXNzKSkKKwordHlwZWRlZiBzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAg
ICAgVWRzY3NDb25uZWN0aW9uOwordHlwZWRlZiBzdHJ1Y3QgVWRzY3NDb25uZWN0aW9uQ2xhc3Mg
VWRzY3NDb25uZWN0aW9uQ2xhc3M7CisKK3N0cnVjdCBVZHNjc0Nvbm5lY3Rpb25DbGFzcyB7Cisg
ICAgVkRBZ2VudENvbm5lY3Rpb25DbGFzcyBwYXJlbnRfY2xhc3M7Cit9OworCitHVHlwZSB1ZHNj
c19jb25uZWN0aW9uX2dldF90eXBlKHZvaWQpOwogCiAvKiAtLS0tLS0tLS0tIEdlbmVyaWMgYml0
cyBhbmQgY2xpZW50LXNpZGUgQVBJIC0tLS0tLS0tLS0gKi8KIApAQCAtNDEsMjIgKzU4LDEwIEBA
IHN0cnVjdCB1ZHNjc19tZXNzYWdlX2hlYWRlciB7CiAvKiBDYWxsYmFja3Mgd2l0aCB0aGlzIHR5
cGUgd2lsbCBiZSBjYWxsZWQgd2hlbiBhIGNvbXBsZXRlIG1lc3NhZ2UgaGFzIGJlZW4KICAqIHJl
Y2VpdmVkLiBUaGUgY2FsbGJhY2sgZG9lcyBub3Qgb3duIHRoZSBkYXRhIGJ1ZmZlciBhbmQgc2hv
dWxkIG5vdCBmcmVlIGl0LgogICogVGhlIGRhdGEgYnVmZmVyIHdpbGwgYmUgZnJlZWQgc2hvcnRs
eSBhZnRlciB0aGUgcmVhZCBjYWxsYmFjayByZXR1cm5zLgotICogVGhlIGNhbGxiYWNrIG1heSBj
YWxsIHVkc2NzX2Rlc3Ryb3lfY29ubmVjdGlvbiwgaW4gd2hpY2ggY2FzZSAqY29ubnAgbXVzdCBi
ZQotICogbWFkZSBOVUxMICh3aGljaCB1ZHNjc19kZXN0cm95X2Nvbm5lY3Rpb24gdGFrZXMgY2Fy
ZSBvZikuCiAgKi8KLXR5cGVkZWYgdm9pZCAoKnVkc2NzX3JlYWRfY2FsbGJhY2spKHN0cnVjdCB1
ZHNjc19jb25uZWN0aW9uICoqY29ubnAsCit0eXBlZGVmIHZvaWQgKCp1ZHNjc19yZWFkX2NhbGxi
YWNrKShzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqY29ubnAsCiAgICAgc3RydWN0IHVkc2NzX21l
c3NhZ2VfaGVhZGVyICpoZWFkZXIsIHVpbnQ4X3QgKmRhdGEpOwogCi0vKiBDYWxsYmFja3Mgd2l0
aCB0aGlzIHR5cGUgd2lsbCBiZSBjYWxsZWQgd2hlbiB0aGUgY29ubmVjdGlvbiBpcyBkaXNjb25u
ZWN0ZWQuCi0gKiBOb3RlOgotICogMSkgdWRzY3Mgd2lsbCBkZXN0cm95IHRoZSBjb25uZWN0aW9u
IGluIHF1ZXN0aW9uIGl0c2VsZiBhZnRlcgotICogICAgdGhpcyBjYWxsYmFjayBoYXMgY29tcGxl
dGVkIQotICogMikgVGhpcyBjYWxsYmFjayBpcyBhbHdheXMgY2FsbGVkLCBldmVuIGlmIHRoZSBk
aXNjb25uZWN0IGlzIGluaXRpYXRlZAotICogICAgYnkgdGhlIHVkc2NzIHVzZXIgdGhyb3VnaCBy
ZXR1cm5pbmcgLTEgZnJvbSBhIHJlYWQgY2FsbGJhY2ssIG9yCi0gKiAgICBieSBleHBsaWNpdGx5
IGNhbGxpbmcgdWRzY3NfZGVzdHJveV9jb25uZWN0aW9uLgotICovCi10eXBlZGVmIHZvaWQgKCp1
ZHNjc19kaXNjb25uZWN0X2NhbGxiYWNrKShzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqY29ubik7
Ci0KIC8qIENvbm5lY3QgdG8gdGhlIHVuaXggZG9tYWluIHNvY2tldCBzcGVjaWZpZWQgYnkgc29j
a2V0bmFtZS4KICAqIE9ubHkgc29ja2V0cyBib3VuZCB0byBhIHBhdGhuYW1lIGFyZSBzdXBwb3J0
ZWQuCiAgKgpAQCAtNjUsMzAgKzcwLDE0IEBAIHR5cGVkZWYgdm9pZCAoKnVkc2NzX2Rpc2Nvbm5l
Y3RfY2FsbGJhY2spKHN0cnVjdCB1ZHNjc19jb25uZWN0aW9uICpjb25uKTsKICAqLwogc3RydWN0
IHVkc2NzX2Nvbm5lY3Rpb24gKnVkc2NzX2Nvbm5lY3QoY29uc3QgY2hhciAqc29ja2V0bmFtZSwK
ICAgICB1ZHNjc19yZWFkX2NhbGxiYWNrIHJlYWRfY2FsbGJhY2ssCi0gICAgdWRzY3NfZGlzY29u
bmVjdF9jYWxsYmFjayBkaXNjb25uZWN0X2NhbGxiYWNrLAorICAgIFZEQWdlbnRDb25uRXJyb3JD
YiBlcnJvcl9jYiwKICAgICBpbnQgZGVidWcpOwogCi0vKiBDbG9zZSB0aGUgY29ubmVjdGlvbiwg
cmVsZWFzZXMgdGhlIGNvcnJlc3BvbmRpbmcgcmVzb3VyY2VzIGFuZAotICogc2V0cyAqY29ubnAg
dG8gTlVMTC4KLSAqCi0gKiBEb2VzIG5vdGhpbmcgaWYgKmNvbm5wIGlzIE5VTEwuCi0gKi8KLXZv
aWQgdWRzY3NfZGVzdHJveV9jb25uZWN0aW9uKHN0cnVjdCB1ZHNjc19jb25uZWN0aW9uICoqY29u
bnApOwotCiAvKiBRdWV1ZSBhIG1lc3NhZ2UgZm9yIGRlbGl2ZXJ5IHRvIHRoZSBjbGllbnQgY29u
bmVjdGVkIHRocm91Z2ggY29ubi4KICAqLwogdm9pZCB1ZHNjc193cml0ZShzdHJ1Y3QgdWRzY3Nf
Y29ubmVjdGlvbiAqY29ubiwgdWludDMyX3QgdHlwZSwgdWludDMyX3QgYXJnMSwKICAgICAgICAg
dWludDMyX3QgYXJnMiwgY29uc3QgdWludDhfdCAqZGF0YSwgdWludDMyX3Qgc2l6ZSk7CiAKLS8q
IEFzc29jaWF0ZXMgdGhlIHNwZWNpZmllZCB1c2VyIGRhdGEgd2l0aCB0aGUgY29ubmVjdGlvbi4g
Ki8KLXZvaWQgdWRzY3Nfc2V0X3VzZXJfZGF0YShzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqY29u
biwgdm9pZCAqZGF0YSk7Ci0KLS8qIFJldHVybiB2YWx1ZTogdGhlIGNvbm5lY3Rpb24ncyBhc3Nv
Y2lhdGVkIHVzZXIgZGF0YSwKLSAqIE5VTEwgaWYgY29ubiBpcyBOVUxMLgotICovCi12b2lkICp1
ZHNjc19nZXRfdXNlcl9kYXRhKHN0cnVjdCB1ZHNjc19jb25uZWN0aW9uICpjb25uKTsKLQotCiAj
aWZuZGVmIFVEU0NTX05PX1NFUlZFUgogCiAvKiAtLS0tLS0tLS0tIFNlcnZlci1zaWRlIEFQSSAt
LS0tLS0tLS0tICovCkBAIC0xMDgsNyArOTcsNyBAQCB0eXBlZGVmIHZvaWQgKCp1ZHNjc19jb25u
ZWN0X2NhbGxiYWNrKShzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqY29ubik7CiBzdHJ1Y3QgdWRz
Y3Nfc2VydmVyICp1ZHNjc19jcmVhdGVfc2VydmVyX2Zvcl9mZChpbnQgZmQsCiAgICAgdWRzY3Nf
Y29ubmVjdF9jYWxsYmFjayBjb25uZWN0X2NhbGxiYWNrLAogICAgIHVkc2NzX3JlYWRfY2FsbGJh
Y2sgcmVhZF9jYWxsYmFjaywKLSAgICB1ZHNjc19kaXNjb25uZWN0X2NhbGxiYWNrIGRpc2Nvbm5l
Y3RfY2FsbGJhY2ssCisgICAgVkRBZ2VudENvbm5FcnJvckNiIGVycm9yX2NiLAogICAgIGludCBk
ZWJ1Zyk7CiAKIC8qIENyZWF0ZSB0aGUgdW5peCBkb21haW4gc29ja2V0IHNwZWNpZmllZCBieSBz
b2NrZXRuYW1lIGFuZApAQCAtMTIyLDkgKzExMSwxMiBAQCBzdHJ1Y3QgdWRzY3Nfc2VydmVyICp1
ZHNjc19jcmVhdGVfc2VydmVyX2Zvcl9mZChpbnQgZmQsCiBzdHJ1Y3QgdWRzY3Nfc2VydmVyICp1
ZHNjc19jcmVhdGVfc2VydmVyKGNvbnN0IGNoYXIgKnNvY2tldG5hbWUsCiAgICAgdWRzY3NfY29u
bmVjdF9jYWxsYmFjayBjb25uZWN0X2NhbGxiYWNrLAogICAgIHVkc2NzX3JlYWRfY2FsbGJhY2sg
cmVhZF9jYWxsYmFjaywKLSAgICB1ZHNjc19kaXNjb25uZWN0X2NhbGxiYWNrIGRpc2Nvbm5lY3Rf
Y2FsbGJhY2ssCisgICAgVkRBZ2VudENvbm5FcnJvckNiIGVycm9yX2NiLAogICAgIGludCBkZWJ1
Zyk7CiAKK3ZvaWQgdWRzY3Nfc2VydmVyX2Rlc3Ryb3lfY29ubmVjdGlvbihzdHJ1Y3QgdWRzY3Nf
c2VydmVyICpzZXJ2ZXIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVWRz
Y3NDb25uZWN0aW9uICAgICAqY29ubik7CisKIC8qIENsb3NlIGFsbCB0aGUgc2VydmVyJ3MgY29u
bmVjdGlvbnMgYW5kIHJlbGVhc2VzIHRoZSBjb3JyZXNwb25kaW5nCiAgKiByZXNvdXJjZXMuCiAg
KiBEb2VzIG5vdGhpbmcgaWYgc2VydmVyIGlzIE5VTEwuCkBAIC0xNDEsNyArMTMzLDcgQEAgdm9p
ZCB1ZHNjc19zZXJ2ZXJfd3JpdGVfYWxsKHN0cnVjdCB1ZHNjc19zZXJ2ZXIgKnNlcnZlciwKIC8q
IENhbGxiYWNrIHR5cGUgZm9yIHVkc2NzX3NlcnZlcl9mb3JfYWxsX2NsaWVudHMuIENsaWVudHMg
Y2FuIGJlIGRpc2Nvbm5lY3RlZAogICogZnJvbSB0aGlzIGNhbGxiYWNrIGp1c3QgbGlrZSB3aXRo
IGEgcmVhZCBjYWxsYmFjay4KICAqLwotdHlwZWRlZiBpbnQgKCp1ZHNjc19mb3JfYWxsX2NsaWVu
dHNfY2FsbGJhY2spKHN0cnVjdCB1ZHNjc19jb25uZWN0aW9uICoqY29ubnAsCit0eXBlZGVmIGlu
dCAoKnVkc2NzX2Zvcl9hbGxfY2xpZW50c19jYWxsYmFjaykoc3RydWN0IHVkc2NzX2Nvbm5lY3Rp
b24gKmNvbm4sCiAgICAgdm9pZCAqcHJpdik7CiAKIC8qIENhbGwgZnVuYyBmb3IgYWxsIGNsaWVu
dHMgY29ubmVjdGVkIHRvIHRoZSBzZXJ2ZXIsIHBhc3NpbmcgdGhyb3VnaApAQCAtMTUxLDIyICsx
NDMsOCBAQCB0eXBlZGVmIGludCAoKnVkc2NzX2Zvcl9hbGxfY2xpZW50c19jYWxsYmFjaykoc3Ry
dWN0IHVkc2NzX2Nvbm5lY3Rpb24gKipjb25ucCwKIGludCB1ZHNjc19zZXJ2ZXJfZm9yX2FsbF9j
bGllbnRzKHN0cnVjdCB1ZHNjc19zZXJ2ZXIgKnNlcnZlciwKICAgICB1ZHNjc19mb3JfYWxsX2Ns
aWVudHNfY2FsbGJhY2sgZnVuYywgdm9pZCAqcHJpdik7CiAKLS8qIEdpdmVuIGEgdWRzY3Mgc2Vy
dmVyLCBmaWxsIHRoZSBmZF9zZXRzIHBvaW50ZWQgdG8gYnkgcmVhZGZkcyBhbmQKLSAqIHdyaXRl
ZmRzIGZvciBzZWxlY3QoKSB1c2FnZS4KLSAqIFJldHVybiB2YWx1ZTogdmFsdWUgb2YgdGhlIGhp
Z2hlc3QgZmQgKyAxIG9yIC0xIGlmIHNlcnZlciBpcyBOVUxMCi0gKi8KLWludCB1ZHNjc19zZXJ2
ZXJfZmlsbF9mZHMoc3RydWN0IHVkc2NzX3NlcnZlciAqc2VydmVyLCBmZF9zZXQgKnJlYWRmZHMs
Ci0gICAgZmRfc2V0ICp3cml0ZWZkcyk7Ci0KLS8qIEhhbmRsZSBhbnkgZXZlbnRzIGZsYWdnZWQg
Ynkgc2VsZWN0IGZvciB0aGUgZ2l2ZW4gdWRzY3Mgc2VydmVyLgotICogRG9lcyBub3RoaW5nIGlm
IHNlcnZlciBpcyBOVUxMLgotICovCi12b2lkIHVkc2NzX3NlcnZlcl9oYW5kbGVfZmRzKHN0cnVj
dCB1ZHNjc19zZXJ2ZXIgKnNlcnZlciwgZmRfc2V0ICpyZWFkZmRzLAotICAgIGZkX3NldCAqd3Jp
dGVmZHMpOwotCi0vKiBSZXR1cm5zIHRoZSBwZWVyJ3MgUElELiAqLwotaW50IHVkc2NzX2dldF9w
ZWVyX3BpZChzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqY29ubik7Ci0KICNlbmRpZgogCitHX0VO
RF9ERUNMUworCiAjZW5kaWYKZGlmZiAtLWdpdCBhL3NyYy92ZGFnZW50LWNvbm5lY3Rpb24uYyBi
L3NyYy92ZGFnZW50LWNvbm5lY3Rpb24uYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAw
MDAwLi40ZmY1ODc5Ci0tLSAvZGV2L251bGwKKysrIGIvc3JjL3ZkYWdlbnQtY29ubmVjdGlvbi5j
CkBAIC0wLDAgKzEsMzIyIEBACisvKiAgdmRhZ2VudC1jb25uZWN0aW9uLmMKKworICAgIENvcHly
aWdodCAyMDE5IFJlZCBIYXQsIEluYy4KKworICAgIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3
YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CisgICAgaXQgdW5kZXIg
dGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQg
YnkKKyAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9m
IHRoZSBMaWNlbnNlLCBvcgorICAgIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24u
CisKKyAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3
aWxsIGJlIHVzZWZ1bCwKKyAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZl
biB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgorICAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNT
IEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKKyAgICBHTlUgR2VuZXJhbCBQdWJs
aWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgorCisgICAgWW91IHNob3VsZCBoYXZlIHJlY2Vp
dmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKKyAgICBhbG9uZyB3
aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5z
ZXMvPi4KKyovCisKKyNpbmNsdWRlIDxzeXNsb2cuaD4KKyNpbmNsdWRlIDxmY250bC5oPgorI2lu
Y2x1ZGUgPGVycm5vLmg+CisjaW5jbHVkZSA8Z2xpYi9nc3RkaW8uaD4KKyNpbmNsdWRlIDxnaW8v
Z3VuaXhpbnB1dHN0cmVhbS5oPgorI2luY2x1ZGUgPGdpby9ndW5peG91dHB1dHN0cmVhbS5oPgor
I2luY2x1ZGUgPGdpby9ndW5peHNvY2tldGFkZHJlc3MuaD4KKworI2luY2x1ZGUgInZkYWdlbnQt
Y29ubmVjdGlvbi5oIgorCit0eXBlZGVmIHN0cnVjdCB7CisgICAgR0lPU3RyZWFtICAgICAgICAg
KmlvX3N0cmVhbTsKKyAgICBnYm9vbGVhbiAgICAgICAgICAgb3BlbmluZzsKKyAgICBWREFnZW50
Q29ubkVycm9yQ2IgZXJyb3JfY2I7CisgICAgR0NhbmNlbGxhYmxlICAgICAgKmNhbmNlbGxhYmxl
OworCisgICAgR1F1ZXVlICAgICAgICAgICAgKndyaXRlX3F1ZXVlOworICAgIGdzaXplICAgICAg
ICAgICAgICBieXRlc193cml0dGVuOworCisgICAgZ3NpemUgICAgICAgICAgICAgIGhlYWRlcl9z
aXplOworICAgIGdwb2ludGVyICAgICAgICAgICBoZWFkZXJfYnVmOworICAgIGdwb2ludGVyICAg
ICAgICAgICBkYXRhX2J1ZjsKK30gVkRBZ2VudENvbm5lY3Rpb25Qcml2YXRlOworCitHX0RFRklO
RV9UWVBFX1dJVEhfUFJJVkFURShWREFnZW50Q29ubmVjdGlvbiwgdmRhZ2VudF9jb25uZWN0aW9u
LCBHX1RZUEVfT0JKRUNUKTsKKworc3RhdGljIHZvaWQgcmVhZF9uZXh0X21lc3NhZ2UoVkRBZ2Vu
dENvbm5lY3Rpb24gKnNlbGYpOworCitHSU9TdHJlYW0gKnZkYWdlbnRfZmlsZV9vcGVuKGNvbnN0
IGdjaGFyICpwYXRoLCBHRXJyb3IgKiplcnIpCit7CisgICAgZ2ludCBmZCwgZXJyc3Y7CisKKyAg
ICBmZCA9IGdfb3BlbihwYXRoLCBPX1JEV1IpOworICAgIGlmIChmZCA9PSAtMSkgeworICAgICAg
ICBlcnJzdiA9IGVycm5vOworICAgICAgICBnX3NldF9lcnJvcl9saXRlcmFsKGVyciwgR19GSUxF
X0VSUk9SLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdfZmlsZV9lcnJvcl9mcm9tX2Vy
cm5vKGVycnN2KSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBnX3N0cmVycm9yKGVycnN2
KSk7CisgICAgICAgIHJldHVybiBOVUxMOworICAgIH0KKworICAgIHJldHVybiBnX3NpbXBsZV9p
b19zdHJlYW1fbmV3KGdfdW5peF9pbnB1dF9zdHJlYW1fbmV3KGZkLCBUUlVFKSwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBnX3VuaXhfb3V0cHV0X3N0cmVhbV9uZXcoZmQsIFRS
VUUpKTsKK30KKworR0lPU3RyZWFtICp2ZGFnZW50X3NvY2tldF9jb25uZWN0KGNvbnN0IGdjaGFy
ICpwYXRoLCBHRXJyb3IgKiplcnIpCit7CisgICAgR1NvY2tldENvbm5lY3Rpb24gKmNvbm47Cisg
ICAgR1NvY2tldEFkZHJlc3MgKmFkZHI7CisgICAgR1NvY2tldENsaWVudCAqY2xpZW50OworCisg
ICAgYWRkciA9IGdfdW5peF9zb2NrZXRfYWRkcmVzc19uZXcocGF0aCk7CisgICAgY2xpZW50ID0g
Z19vYmplY3RfbmV3KEdfVFlQRV9TT0NLRVRfQ0xJRU5ULAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAiZmFtaWx5IiwgR19TT0NLRVRfRkFNSUxZX1VOSVgsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICJ0eXBlIiwgR19TT0NLRVRfVFlQRV9TVFJFQU0sCisgICAgICAgICAgICAgICAgICAg
ICAgICAgIE5VTEwpOworICAgIGNvbm4gPSBnX3NvY2tldF9jbGllbnRfY29ubmVjdChjbGllbnQs
IEdfU09DS0VUX0NPTk5FQ1RBQkxFKGFkZHIpLCBOVUxMLCBlcnIpOworICAgIGdfb2JqZWN0X3Vu
cmVmKGNsaWVudCk7CisgICAgZ19vYmplY3RfdW5yZWYoYWRkcik7CisgICAgcmV0dXJuIEdfSU9f
U1RSRUFNKGNvbm4pOworfQorCitzdGF0aWMgdm9pZCB2ZGFnZW50X2Nvbm5lY3Rpb25faW5pdChW
REFnZW50Q29ubmVjdGlvbiAqc2VsZikKK3sKKyAgICBWREFnZW50Q29ubmVjdGlvblByaXZhdGUg
KnByaXYgPSB2ZGFnZW50X2Nvbm5lY3Rpb25fZ2V0X2luc3RhbmNlX3ByaXZhdGUoc2VsZik7Cisg
ICAgcHJpdi0+Y2FuY2VsbGFibGUgPSBnX2NhbmNlbGxhYmxlX25ldygpOworICAgIHByaXYtPndy
aXRlX3F1ZXVlID0gZ19xdWV1ZV9uZXcoKTsKK30KKworc3RhdGljIHZvaWQgdmRhZ2VudF9jb25u
ZWN0aW9uX2Rpc3Bvc2UoR09iamVjdCAqb2JqKQoreworICAgIFZEQWdlbnRDb25uZWN0aW9uICpz
ZWxmID0gVkRBR0VOVF9DT05ORUNUSU9OKG9iaik7CisgICAgVkRBZ2VudENvbm5lY3Rpb25Qcml2
YXRlICpwcml2ID0gdmRhZ2VudF9jb25uZWN0aW9uX2dldF9pbnN0YW5jZV9wcml2YXRlKHNlbGYp
OworCisgICAgZ19jbGVhcl9vYmplY3QoJnByaXYtPmNhbmNlbGxhYmxlKTsKKyAgICBnX2NsZWFy
X29iamVjdCgmcHJpdi0+aW9fc3RyZWFtKTsKKworICAgIEdfT0JKRUNUX0NMQVNTKHZkYWdlbnRf
Y29ubmVjdGlvbl9wYXJlbnRfY2xhc3MpLT5kaXNwb3NlKG9iaik7Cit9CisKK3N0YXRpYyB2b2lk
IHZkYWdlbnRfY29ubmVjdGlvbl9maW5hbGl6ZShHT2JqZWN0ICpvYmopCit7CisgICAgVkRBZ2Vu
dENvbm5lY3Rpb24gKnNlbGYgPSBWREFHRU5UX0NPTk5FQ1RJT04ob2JqKTsKKyAgICBWREFnZW50
Q29ubmVjdGlvblByaXZhdGUgKnByaXYgPSB2ZGFnZW50X2Nvbm5lY3Rpb25fZ2V0X2luc3RhbmNl
X3ByaXZhdGUoc2VsZik7CisKKyAgICBnX3F1ZXVlX2ZyZWVfZnVsbChwcml2LT53cml0ZV9xdWV1
ZSwgKEdEZXN0cm95Tm90aWZ5KWdfYnl0ZXNfdW5yZWYpOworICAgIGdfZnJlZShwcml2LT5oZWFk
ZXJfYnVmKTsKKyAgICBnX2ZyZWUocHJpdi0+ZGF0YV9idWYpOworCisgICAgR19PQkpFQ1RfQ0xB
U1ModmRhZ2VudF9jb25uZWN0aW9uX3BhcmVudF9jbGFzcyktPmZpbmFsaXplKG9iaik7Cit9CisK
K3N0YXRpYyB2b2lkIHZkYWdlbnRfY29ubmVjdGlvbl9jbGFzc19pbml0KFZEQWdlbnRDb25uZWN0
aW9uQ2xhc3MgKmtsYXNzKQoreworICAgIEdPYmplY3RDbGFzcyAqZ29iamVjdF9jbGFzcyA9IEdf
T0JKRUNUX0NMQVNTKGtsYXNzKTsKKyAgICBnb2JqZWN0X2NsYXNzLT5kaXNwb3NlICA9IHZkYWdl
bnRfY29ubmVjdGlvbl9kaXNwb3NlOworICAgIGdvYmplY3RfY2xhc3MtPmZpbmFsaXplID0gdmRh
Z2VudF9jb25uZWN0aW9uX2ZpbmFsaXplOworfQorCit2b2lkIHZkYWdlbnRfY29ubmVjdGlvbl9z
ZXR1cChWREFnZW50Q29ubmVjdGlvbiAqc2VsZiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIEdJT1N0cmVhbSAgICAgICAgICppb19zdHJlYW0sCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBnYm9vbGVhbiAgICAgICAgICAgd2FpdF9vbl9vcGVuaW5nLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgZ3NpemUgICAgICAgICAgICAgIGhlYWRlcl9zaXplLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgVkRBZ2VudENvbm5FcnJvckNiIGVycm9yX2NiKQorewor
ICAgIFZEQWdlbnRDb25uZWN0aW9uUHJpdmF0ZSAqcHJpdiA9IHZkYWdlbnRfY29ubmVjdGlvbl9n
ZXRfaW5zdGFuY2VfcHJpdmF0ZShzZWxmKTsKKyAgICBwcml2LT5pb19zdHJlYW0gPSBpb19zdHJl
YW07CisgICAgcHJpdi0+b3BlbmluZyA9IHdhaXRfb25fb3BlbmluZzsKKyAgICBwcml2LT5oZWFk
ZXJfc2l6ZSA9IGhlYWRlcl9zaXplOworICAgIHByaXYtPmhlYWRlcl9idWYgPSBnX21hbGxvYyho
ZWFkZXJfc2l6ZSk7CisgICAgcHJpdi0+ZXJyb3JfY2IgPSBlcnJvcl9jYjsKKworICAgIHJlYWRf
bmV4dF9tZXNzYWdlKHNlbGYpOworfQorCit2b2lkIHZkYWdlbnRfY29ubmVjdGlvbl9kZXN0cm95
KGdwb2ludGVyIHApCit7CisgICAgZ19yZXR1cm5faWZfZmFpbChWREFHRU5UX0lTX0NPTk5FQ1RJ
T04ocCkpOworCisgICAgVkRBZ2VudENvbm5lY3Rpb24gKnNlbGYgPSBWREFHRU5UX0NPTk5FQ1RJ
T04ocCk7CisgICAgVkRBZ2VudENvbm5lY3Rpb25Qcml2YXRlICpwcml2ID0gdmRhZ2VudF9jb25u
ZWN0aW9uX2dldF9pbnN0YW5jZV9wcml2YXRlKHNlbGYpOworICAgIGdfY2FuY2VsbGFibGVfY2Fu
Y2VsKHByaXYtPmNhbmNlbGxhYmxlKTsKKyAgICBnX2lvX3N0cmVhbV9jbG9zZShwcml2LT5pb19z
dHJlYW0sIE5VTEwsIE5VTEwpOworICAgIGdfb2JqZWN0X3VucmVmKHNlbGYpOworfQorCitnaW50
IHZkYWdlbnRfY29ubmVjdGlvbl9nZXRfcGVlcl9waWQoVkRBZ2VudENvbm5lY3Rpb24gKnNlbGYs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR0Vycm9yICAgICAgICAgICAq
KmVycikKK3sKKyAgICBWREFnZW50Q29ubmVjdGlvblByaXZhdGUgKnByaXYgPSB2ZGFnZW50X2Nv
bm5lY3Rpb25fZ2V0X2luc3RhbmNlX3ByaXZhdGUoc2VsZik7CisgICAgR1NvY2tldCAqc29jazsK
KyAgICBHQ3JlZGVudGlhbHMgKmNyZWQ7CisgICAgZ2ludCBwaWQgPSAtMTsKKworICAgIGdfcmV0
dXJuX3ZhbF9pZl9mYWlsKEdfSVNfU09DS0VUX0NPTk5FQ1RJT04ocHJpdi0+aW9fc3RyZWFtKSwg
cGlkKTsKKworICAgIHNvY2sgPSBnX3NvY2tldF9jb25uZWN0aW9uX2dldF9zb2NrZXQoR19TT0NL
RVRfQ09OTkVDVElPTihwcml2LT5pb19zdHJlYW0pKTsKKyAgICBjcmVkID0gZ19zb2NrZXRfZ2V0
X2NyZWRlbnRpYWxzKHNvY2ssIGVycik7CisgICAgaWYgKGNyZWQpIHsKKyAgICAgICAgcGlkID0g
Z19jcmVkZW50aWFsc19nZXRfdW5peF9waWQoY3JlZCwgTlVMTCk7CisgICAgICAgIGdfb2JqZWN0
X3VucmVmKGNyZWQpOworICAgIH0KKworICAgIHJldHVybiBwaWQ7Cit9CisKKy8qIFBlcmZvcm1z
IHNpbmdsZSB3cml0ZSBvcGVyYXRpb24sCisgKiByZXR1cm5zIFRSVUUgaWYgdGhlcmUncyBzdGls
bCBkYXRhIHRvIGJlIHdyaXR0ZW4sIG90aGVyd2lzZSBGQUxTRS4gKi8KK3N0YXRpYyBnYm9vbGVh
biBkb193cml0ZShWREFnZW50Q29ubmVjdGlvbiAqc2VsZiwgZ2Jvb2xlYW4gYmxvY2spCit7Cisg
ICAgVkRBZ2VudENvbm5lY3Rpb25Qcml2YXRlICpwcml2ID0gdmRhZ2VudF9jb25uZWN0aW9uX2dl
dF9pbnN0YW5jZV9wcml2YXRlKHNlbGYpOworICAgIEdPdXRwdXRTdHJlYW0gKm91dDsKKyAgICBH
Qnl0ZXMgKm1zZzsKKyAgICBnc3NpemUgcmVzOworICAgIEdFcnJvciAqZXJyID0gTlVMTDsKKwor
ICAgIG1zZyA9IGdfcXVldWVfcGVla19oZWFkKHByaXYtPndyaXRlX3F1ZXVlKTsKKyAgICBvdXQg
PSBnX2lvX3N0cmVhbV9nZXRfb3V0cHV0X3N0cmVhbShwcml2LT5pb19zdHJlYW0pOworCisgICAg
aWYgKCFtc2cpIHsKKyAgICAgICAgcmV0dXJuIEZBTFNFOworICAgIH0KKworICAgIHJlcyA9IGdf
cG9sbGFibGVfc3RyZWFtX3dyaXRlKG91dCwKKyAgICAgICAgZ19ieXRlc19nZXRfZGF0YShtc2cs
IE5VTEwpICsgcHJpdi0+Ynl0ZXNfd3JpdHRlbiwKKyAgICAgICAgZ19ieXRlc19nZXRfc2l6ZSht
c2cpIC0gcHJpdi0+Ynl0ZXNfd3JpdHRlbiwKKyAgICAgICAgYmxvY2ssIHByaXYtPmNhbmNlbGxh
YmxlLCAmZXJyKTsKKworICAgIGlmIChlcnIpIHsKKyAgICAgICAgaWYgKGdfZXJyb3JfbWF0Y2hl
cyAoZXJyLCBHX0lPX0VSUk9SLCBHX0lPX0VSUk9SX1dPVUxEX0JMT0NLKSkgeworICAgICAgICAg
ICAgZ19lcnJvcl9mcmVlKGVycik7CisgICAgICAgICAgICByZXR1cm4gVFJVRTsKKyAgICAgICAg
fSBlbHNlIGlmIChnX2Vycm9yX21hdGNoZXMoZXJyLCBHX0lPX0VSUk9SLCBHX0lPX0VSUk9SX0NB
TkNFTExFRCkpIHsKKyAgICAgICAgICAgIGdfZXJyb3JfZnJlZShlcnIpOworICAgICAgICAgICAg
cmV0dXJuIEZBTFNFOworICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgcHJpdi0+ZXJyb3Jf
Y2Ioc2VsZiwgZXJyKTsKKyAgICAgICAgICAgIHJldHVybiBGQUxTRTsKKyAgICAgICAgfQorICAg
IH0KKworICAgIHByaXYtPmJ5dGVzX3dyaXR0ZW4gKz0gcmVzOworCisgICAgaWYgKHByaXYtPmJ5
dGVzX3dyaXR0ZW4gPT0gZ19ieXRlc19nZXRfc2l6ZShtc2cpKSB7CisgICAgICAgIGdfYnl0ZXNf
dW5yZWYoZ19xdWV1ZV9wb3BfaGVhZChwcml2LT53cml0ZV9xdWV1ZSkpOworICAgICAgICBwcml2
LT5ieXRlc193cml0dGVuID0gMDsKKyAgICB9CisKKyAgICByZXR1cm4gIWdfcXVldWVfaXNfZW1w
dHkocHJpdi0+d3JpdGVfcXVldWUpOworfQorCitzdGF0aWMgZ2Jvb2xlYW4gb3V0X3N0cmVhbV9y
ZWFkeV9jYihHT2JqZWN0ICpwb2xsYWJsZV9zdHJlYW0sCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBncG9pbnRlciB1c2VyX2RhdGEpCit7CisgICAgaWYgKGRvX3dyaXRlKHVz
ZXJfZGF0YSwgRkFMU0UpKSB7CisgICAgICAgIHJldHVybiBUUlVFOworICAgIH0KKyAgICBnX29i
amVjdF91bnJlZih1c2VyX2RhdGEpOworICAgIHJldHVybiBGQUxTRTsKK30KKwordm9pZCB2ZGFn
ZW50X2Nvbm5lY3Rpb25fd3JpdGUoVkRBZ2VudENvbm5lY3Rpb24gKnNlbGYsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBncG9pbnRlciAgICAgICAgICAgZGF0YSwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGdzaXplICAgICAgICAgICAgICBzaXplKQoreworICAgIFZEQWdl
bnRDb25uZWN0aW9uUHJpdmF0ZSAqcHJpdiA9IHZkYWdlbnRfY29ubmVjdGlvbl9nZXRfaW5zdGFu
Y2VfcHJpdmF0ZShzZWxmKTsKKyAgICBHUG9sbGFibGVPdXRwdXRTdHJlYW0gKm91dDsKKyAgICBH
U291cmNlICpzb3VyY2U7CisKKyAgICBnX3F1ZXVlX3B1c2hfdGFpbChwcml2LT53cml0ZV9xdWV1
ZSwgZ19ieXRlc19uZXdfdGFrZShkYXRhLCBzaXplKSk7CisKKyAgICBpZiAoZ19xdWV1ZV9nZXRf
bGVuZ3RoKHByaXYtPndyaXRlX3F1ZXVlKSA9PSAxKSB7CisgICAgICAgIG91dCA9IEdfUE9MTEFC
TEVfT1VUUFVUX1NUUkVBTShnX2lvX3N0cmVhbV9nZXRfb3V0cHV0X3N0cmVhbShwcml2LT5pb19z
dHJlYW0pKTsKKworICAgICAgICBzb3VyY2UgPSBnX3BvbGxhYmxlX291dHB1dF9zdHJlYW1fY3Jl
YXRlX3NvdXJjZShvdXQsIHByaXYtPmNhbmNlbGxhYmxlKTsKKyAgICAgICAgZ19zb3VyY2Vfc2V0
X2NhbGxiYWNrKHNvdXJjZSwgR19TT1VSQ0VfRlVOQyhvdXRfc3RyZWFtX3JlYWR5X2NiKSwKKyAg
ICAgICAgICAgIGdfb2JqZWN0X3JlZihzZWxmKSwgTlVMTCk7CisgICAgICAgIGdfc291cmNlX2F0
dGFjaChzb3VyY2UsIE5VTEwpOworICAgICAgICBnX3NvdXJjZV91bnJlZihzb3VyY2UpOworICAg
IH0KK30KKwordm9pZCB2ZGFnZW50X2Nvbm5lY3Rpb25fZmx1c2goVkRBZ2VudENvbm5lY3Rpb24g
KnNlbGYpCit7CisgICAgd2hpbGUgKGRvX3dyaXRlKHNlbGYsIFRSVUUpKTsKK30KKworc3RhdGlj
IHZvaWQgbWVzc2FnZV9yZWFkX2NiKEdPYmplY3QgICAgICAqc291cmNlX29iamVjdCwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBHQXN5bmNSZXN1bHQgKnJlcywKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBncG9pbnRlciAgICAgIHVzZXJfZGF0YSkKK3sKKyAgICBWREFnZW50Q29u
bmVjdGlvbiAqc2VsZiA9IHVzZXJfZGF0YTsKKyAgICBWREFnZW50Q29ubmVjdGlvblByaXZhdGUg
KnByaXYgPSB2ZGFnZW50X2Nvbm5lY3Rpb25fZ2V0X2luc3RhbmNlX3ByaXZhdGUoc2VsZik7Cisg
ICAgR0lucHV0U3RyZWFtICppbiA9IEdfSU5QVVRfU1RSRUFNKHNvdXJjZV9vYmplY3QpOworICAg
IEdFcnJvciAqZXJyID0gTlVMTDsKKyAgICBnc2l6ZSBieXRlc19yZWFkLCBkYXRhX3NpemU7CisK
KyAgICBnX2lucHV0X3N0cmVhbV9yZWFkX2FsbF9maW5pc2goaW4sIHJlcywgJmJ5dGVzX3JlYWQs
ICZlcnIpOworICAgIGlmIChlcnIpIHsKKyAgICAgICAgaWYgKGdfZXJyb3JfbWF0Y2hlcyhlcnIs
IEdfSU9fRVJST1IsIEdfSU9fRVJST1JfQ0FOQ0VMTEVEKSkgeworICAgICAgICAgICAgZ19lcnJv
cl9mcmVlKGVycik7CisgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICBwcml2LT5lcnJvcl9j
YihzZWxmLCBlcnIpOworICAgICAgICB9CisgICAgICAgIGdvdG8gdW5yZWY7CisgICAgfQorCisg
ICAgaWYgKGJ5dGVzX3JlYWQgPT0gMCkgeworICAgICAgICAvKiBzZWUgdmlydGlvLXBvcnQuYyBm
b3IgdGhlIHJhdGlvbmFsZSBiZWhpbmQgdGhpcyAqLworICAgICAgICBpZiAocHJpdi0+b3Blbmlu
ZykgeworICAgICAgICAgICAgZ191c2xlZXAoMTAwMDApOworICAgICAgICAgICAgcmVhZF9uZXh0
X21lc3NhZ2Uoc2VsZik7CisgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICBwcml2LT5lcnJv
cl9jYihzZWxmLCBOVUxMKTsKKyAgICAgICAgfQorICAgICAgICBnb3RvIHVucmVmOworICAgIH0K
KyAgICBwcml2LT5vcGVuaW5nID0gRkFMU0U7CisKKyAgICBpZiAoIXByaXYtPmRhdGFfYnVmKSB7
CisgICAgICAgIC8qIHdlJ3ZlIHJlYWQgdGhlIG1lc3NhZ2UgaGVhZGVyLCBub3cgbGV0J3MgcmVh
ZCBpdHMgYm9keSAqLworICAgICAgICBkYXRhX3NpemUgPSBWREFHRU5UX0NPTk5FQ1RJT05fR0VU
X0NMQVNTKHNlbGYpLT5oYW5kbGVfaGVhZGVyKAorICAgICAgICAgICAgc2VsZiwgcHJpdi0+aGVh
ZGVyX2J1Zik7CisKKyAgICAgICAgaWYgKGdfY2FuY2VsbGFibGVfaXNfY2FuY2VsbGVkKHByaXYt
PmNhbmNlbGxhYmxlKSkgeworICAgICAgICAgICAgZ290byB1bnJlZjsKKyAgICAgICAgfQorCisg
ICAgICAgIGlmIChkYXRhX3NpemUgPiAwKSB7CisgICAgICAgICAgICBwcml2LT5kYXRhX2J1ZiA9
IGdfbWFsbG9jKGRhdGFfc2l6ZSk7CisgICAgICAgICAgICBnX2lucHV0X3N0cmVhbV9yZWFkX2Fs
bF9hc3luYyhpbiwKKyAgICAgICAgICAgICAgICBwcml2LT5kYXRhX2J1ZiwgZGF0YV9zaXplLAor
ICAgICAgICAgICAgICAgIEdfUFJJT1JJVFlfREVGQVVMVCwgcHJpdi0+Y2FuY2VsbGFibGUsCisg
ICAgICAgICAgICAgICAgbWVzc2FnZV9yZWFkX2NiLCBnX29iamVjdF9yZWYoc2VsZikpOworICAg
ICAgICAgICAgZ290byB1bnJlZjsKKyAgICAgICAgfQorICAgIH0KKworICAgIFZEQUdFTlRfQ09O
TkVDVElPTl9HRVRfQ0xBU1Moc2VsZiktPmhhbmRsZV9tZXNzYWdlKAorICAgICAgICBzZWxmLCBw
cml2LT5oZWFkZXJfYnVmLCBwcml2LT5kYXRhX2J1Zik7CisKKyAgICBnX2NsZWFyX3BvaW50ZXIo
JnByaXYtPmRhdGFfYnVmLCBnX2ZyZWUpOworICAgIHJlYWRfbmV4dF9tZXNzYWdlKHNlbGYpOwor
Cit1bnJlZjoKKyAgICBnX29iamVjdF91bnJlZihzZWxmKTsKK30KKworc3RhdGljIHZvaWQgcmVh
ZF9uZXh0X21lc3NhZ2UoVkRBZ2VudENvbm5lY3Rpb24gKnNlbGYpCit7CisgICAgVkRBZ2VudENv
bm5lY3Rpb25Qcml2YXRlICpwcml2ID0gdmRhZ2VudF9jb25uZWN0aW9uX2dldF9pbnN0YW5jZV9w
cml2YXRlKHNlbGYpOworICAgIEdJbnB1dFN0cmVhbSAqaW47CisKKyAgICBpZiAoZ19jYW5jZWxs
YWJsZV9pc19jYW5jZWxsZWQocHJpdi0+Y2FuY2VsbGFibGUpKSB7CisgICAgICAgIHJldHVybjsK
KyAgICB9CisKKyAgICBpbiA9IGdfaW9fc3RyZWFtX2dldF9pbnB1dF9zdHJlYW0ocHJpdi0+aW9f
c3RyZWFtKTsKKworICAgIGdfaW5wdXRfc3RyZWFtX3JlYWRfYWxsX2FzeW5jKGluLAorICAgICAg
ICBwcml2LT5oZWFkZXJfYnVmLCBwcml2LT5oZWFkZXJfc2l6ZSwKKyAgICAgICAgR19QUklPUklU
WV9ERUZBVUxULCBwcml2LT5jYW5jZWxsYWJsZSwKKyAgICAgICAgbWVzc2FnZV9yZWFkX2NiLCBn
X29iamVjdF9yZWYoc2VsZikpOworfQpkaWZmIC0tZ2l0IGEvc3JjL3ZkYWdlbnQtY29ubmVjdGlv
bi5oIGIvc3JjL3ZkYWdlbnQtY29ubmVjdGlvbi5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4
IDAwMDAwMDAuLmJkNWVkYzQKLS0tIC9kZXYvbnVsbAorKysgYi9zcmMvdmRhZ2VudC1jb25uZWN0
aW9uLmgKQEAgLTAsMCArMSwxMDIgQEAKKy8qICB2ZGFnZW50LWNvbm5lY3Rpb24uaAorCisgICAg
Q29weXJpZ2h0IDIwMTkgUmVkIEhhdCwgSW5jLgorCisgICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUg
c29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKKyAgICBpdCB1
bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxp
c2hlZCBieQorICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9u
IDMgb2YgdGhlIExpY2Vuc2UsIG9yCisgICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVy
c2lvbi4KKworICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0
IGl0IHdpbGwgYmUgdXNlZnVsLAorICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91
dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCisgICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJ
VE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQorICAgIEdOVSBHZW5lcmFs
IFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCisKKyAgICBZb3Ugc2hvdWxkIGhhdmUg
cmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQorICAgIGFs
b25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9s
aWNlbnNlcy8+LgorKi8KKworI2lmbmRlZiBfX1ZEQUdFTlRfQ09OTkVDVElPTl9ICisjZGVmaW5l
IF9fVkRBR0VOVF9DT05ORUNUSU9OX0gKKworI2luY2x1ZGUgPGdsaWIuaD4KKyNpbmNsdWRlIDxn
aW8vZ2lvLmg+CisjaW5jbHVkZSA8Z2xpYi1vYmplY3QuaD4KKworR19CRUdJTl9ERUNMUworCisj
ZGVmaW5lIFZEQUdFTlRfVFlQRV9DT05ORUNUSU9OIHZkYWdlbnRfY29ubmVjdGlvbl9nZXRfdHlw
ZSgpCitHX0RFQ0xBUkVfREVSSVZBQkxFX1RZUEUoVkRBZ2VudENvbm5lY3Rpb24sIHZkYWdlbnRf
Y29ubmVjdGlvbiwgVkRBR0VOVCwgQ09OTkVDVElPTiwgR09iamVjdCk7CisKKy8qIFN1Ymxhc3Nl
cyBvZiBWREFnZW50Q29ubmVjdGlvbiBtdXN0IGltcGxlbWVudAorICogaGFuZGxlX2hlYWRlciBh
bmQgaGFuZGxlX21lc3NhZ2UuICovCitzdHJ1Y3QgX1ZEQWdlbnRDb25uZWN0aW9uQ2xhc3Mgewor
ICAgIEdPYmplY3RDbGFzcyBwYXJlbnRfY2xhc3M7CisKKyAgICAvKiBDYWxsZWQgd2hlbiBhIG1l
c3NhZ2UgaGVhZGVyIGhhcyBiZWVuIHJlYWQuCisgICAgKgorICAgICogSGFuZGxlciBtdXN0IHBh
cnNlIHRoZSBAaGVhZGVyX2J1ZiBhbmQKKyAgICAqIHJldHVybiB0aGUgc2l6ZSBvZiBtZXNzYWdl
J3MgYm9keS4KKyAgICAqCisgICAgKiBAaGVhZGVyX2J1ZiBtdXN0IG5vdCBiZSBmcmVlZC4gKi8K
KyAgICBnc2l6ZSAoKmhhbmRsZV9oZWFkZXIpIChWREFnZW50Q29ubmVjdGlvbiAqc2VsZiwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBncG9pbnRlciAgICAgICAgICAgaGVhZGVyX2J1Zik7
CisKKyAgICAvKiBDYWxsZWQgd2hlbiBhIGZ1bGwgbWVzc2FnZSBoYXMgYmVlbiByZWFkLgorICAg
ICoKKyAgICAqIEBoZWFkZXIsIEBkYXRhIG11c3Qgbm90IGJlIGZyZWVkLiAqLworICAgIHZvaWQg
KCpoYW5kbGVfbWVzc2FnZSkgKFZEQWdlbnRDb25uZWN0aW9uICpzZWxmLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGdwb2ludGVyICAgICAgICAgICBoZWFkZXJfYnVmLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGdwb2ludGVyICAgICAgICAgICBkYXRhX2J1Zik7Cit9OworCisv
KiBJbnZva2VkIHdoZW4gYW4gZXJyb3Igb2NjdXJzIGR1cmluZyByZWFkIG9yIHdyaXRlLgorICoK
KyAqIElmIEBlcnIgaXMgTlVMTCwgdGhlIGNvbm5lY3Rpb24gd2FzIGNsb3NlZCBieSB0aGUgcmVt
b3RlIHNpZGUsCisgKiBvdGhlcndpc2UgdGhlIGhhbmRsZXIgbXVzdCBmcmVlIEBlcnIgdXNpbmcg
Z19lcnJvcl9mcmVlKCkuCisgKgorICogVkRBZ2VudENvbm5lY3Rpb24gd2lsbCBub3QgY29udGlu
dWUgd2l0aCB0aGUgZ2l2ZW4gSS9PLW9wIHRoYXQgZmFpbGVkLiAqLwordHlwZWRlZiB2b2lkICgq
VkRBZ2VudENvbm5FcnJvckNiKShWREFnZW50Q29ubmVjdGlvbiAqc2VsZiwgR0Vycm9yICplcnIp
OworCisvKiBPcGVuIGEgZmlsZSBpbiBAcGF0aCBmb3IgcmVhZCBhbmQgd3JpdGUuCisgKiBSZXR1
cm5zIGEgbmV3IEdJT1N0cmVhbSB0byB0aGUgZ2l2ZW4gZmlsZSBvciBOVUxMIHdoZW4gQGVyciBp
cyBzZXQuICovCitHSU9TdHJlYW0gKnZkYWdlbnRfZmlsZV9vcGVuKGNvbnN0IGdjaGFyICpwYXRo
LCBHRXJyb3IgKiplcnIpOworCisvKiBDcmVhdGUgYSBzb2NrZXQgYW5kIGluaXRpYXRlIGEgbmV3
IGNvbm5lY3Rpb24gdG8gdGhlIHNvY2tldCBpbiBAcGF0aC4KKyAqIFJldHVybnMgYSBuZXcgR0lP
U3RyZWFtIG9yIE5VTEwgd2hlbiBAZXJyIGlzIHNldC4gKi8KK0dJT1N0cmVhbSAqdmRhZ2VudF9z
b2NrZXRfY29ubmVjdChjb25zdCBnY2hhciAqcGF0aCwgR0Vycm9yICoqZXJyKTsKKworLyogU2V0
IHVwIEBzZWxmIHRvIHVzZSBAaW9fc3RyZWFtIGFuZCBzdGFydCByZWFkaW5nIGZyb20gaXQuCisg
KgorICogSWYgQHdhaXRfb25fb3BlbmluZyBpcyBzZXQgdG8gVFJVRSwgRU9GIHdvbid0IGJlIHRy
ZWF0ZWQgYXMgYW4gZXJyb3IKKyAqIHVudGlsIHRoZSBmaXJzdCBtZXNzYWdlIGlzIHN1Y2Nlc3Nm
dWxseSByZWFkIG9yIHdyaXR0ZW4gdG8gdGhlIEBpb19zdHJlYW0uICovCit2b2lkIHZkYWdlbnRf
Y29ubmVjdGlvbl9zZXR1cChWREFnZW50Q29ubmVjdGlvbiAqc2VsZiwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIEdJT1N0cmVhbSAgICAgICAgICppb19zdHJlYW0sCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBnYm9vbGVhbiAgICAgICAgICAgd2FpdF9vbl9vcGVuaW5nLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3NpemUgICAgICAgICAgICAgIGhlYWRlcl9z
aXplLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVkRBZ2VudENvbm5FcnJvckNiIGVy
cm9yX2NiKTsKKworCisvKiBDYW5jZWwgcnVubmluZyBJL08tb3BlcmF0aW9ucywgY2xvc2UgdGhl
IHVuZGVybHlpbmcgRkQgYW5kCisgKiB1bnJlZiB0aGUgVkRBZ2VudENvbm5lY3Rpb24gb2JqZWN0
LiAqLwordm9pZCB2ZGFnZW50X2Nvbm5lY3Rpb25fZGVzdHJveShncG9pbnRlciBwKTsKKworLyog
QXBwZW5kIGEgbWVzc2FnZSB0byB0aGUgd3JpdGUgcXVldWUuCisgKgorICogVkRBZ2VudENvbm5l
Y3Rpb24gdGFrZXMgb3duZXJzaGlwIG9mIEBkYXRhCisgKiBhbmQgZnJlZXMgaXQgb25jZSB0aGUg
bWVzc2FnZSBpcyBmbHVzaGVkLiAqLwordm9pZCB2ZGFnZW50X2Nvbm5lY3Rpb25fd3JpdGUoVkRB
Z2VudENvbm5lY3Rpb24gKnNlbGYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncG9p
bnRlciAgICAgICAgICAgZGF0YSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdzaXpl
ICAgICAgICAgICAgICBzaXplKTsKKworLyogU3luY2hyb25vdXNseSB3cml0ZSBhbGwgcXVldWVk
IG1lc3NhZ2VzIHRvIHRoZSBvdXRwdXQgc3RyZWFtLiAqLwordm9pZCB2ZGFnZW50X2Nvbm5lY3Rp
b25fZmx1c2goVkRBZ2VudENvbm5lY3Rpb24gKnNlbGYpOworCisvKiBSZXR1cm5zIHRoZSBQSUQg
b2YgdGhlIGZvcmVpZ24gcHJvY2VzcyBjb25uZWN0ZWQgdG8gdGhlIHNvY2tldAorICogb3IgLTEg
d2l0aCBAZXJyIHNldC4gKi8KK2dpbnQgdmRhZ2VudF9jb25uZWN0aW9uX2dldF9wZWVyX3BpZChW
REFnZW50Q29ubmVjdGlvbiAqc2VsZiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBHRXJyb3IgICAgICAgICAgICoqZXJyKTsKKworR19FTkRfREVDTFMKKworI2VuZGlmCmRp
ZmYgLS1naXQgYS9zcmMvdmRhZ2VudC92ZGFnZW50LmMgYi9zcmMvdmRhZ2VudC92ZGFnZW50LmMK
aW5kZXggMTNlZjI5Zi4uMTgxYzUxYSAxMDA2NDQKLS0tIGEvc3JjL3ZkYWdlbnQvdmRhZ2VudC5j
CisrKyBiL3NyYy92ZGFnZW50L3ZkYWdlbnQuYwpAQCAtMTY1LDEwICsxNjUsMTAgQEAgc3RhdGlj
IHZvaWQgdmRhZ2VudF9xdWl0X2xvb3AoVkRBZ2VudCAqYWdlbnQpCiAgICAgICAgIGdfbWFpbl9s
b29wX3F1aXQoYWdlbnQtPmxvb3ApOwogfQogCi1zdGF0aWMgdm9pZCBkYWVtb25fcmVhZF9jb21w
bGV0ZShzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqKmNvbm5wLAorc3RhdGljIHZvaWQgZGFlbW9u
X3JlYWRfY29tcGxldGUoc3RydWN0IHVkc2NzX2Nvbm5lY3Rpb24gKmNvbm4sCiAgICAgc3RydWN0
IHVkc2NzX21lc3NhZ2VfaGVhZGVyICpoZWFkZXIsIHVpbnQ4X3QgKmRhdGEpCiB7Ci0gICAgVkRB
Z2VudCAqYWdlbnQgPSB1ZHNjc19nZXRfdXNlcl9kYXRhKCpjb25ucCk7CisgICAgVkRBZ2VudCAq
YWdlbnQgPSBnX29iamVjdF9nZXRfZGF0YShHX09CSkVDVChjb25uKSwgImFnZW50Iik7CiAKICAg
ICBzd2l0Y2ggKGhlYWRlci0+dHlwZSkgewogICAgIGNhc2UgVkRBR0VOVERfTU9OSVRPUlNfQ09O
RklHOgpAQCAtMjAxLDcgKzIwMSw3IEBAIHN0YXRpYyB2b2lkIGRhZW1vbl9yZWFkX2NvbXBsZXRl
KHN0cnVjdCB1ZHNjc19jb25uZWN0aW9uICoqY29ubnAsCiAgICAgICAgICAgICB2ZGFnZW50X2Zp
bGVfeGZlcnNfc3RhcnQoYWdlbnQtPnhmZXJzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIChWREFnZW50RmlsZVhmZXJTdGFydE1lc3NhZ2UgKilkYXRhKTsKICAgICAgICAg
fSBlbHNlIHsKLSAgICAgICAgICAgIHZkYWdlbnRfZmlsZV94ZmVyc19lcnJvcl9kaXNhYmxlZCgq
Y29ubnAsCisgICAgICAgICAgICB2ZGFnZW50X2ZpbGVfeGZlcnNfZXJyb3JfZGlzYWJsZWQoY29u
biwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKFZEQWdl
bnRGaWxlWGZlclN0YXJ0TWVzc2FnZSAqKWRhdGEpLT5pZCk7CiAgICAgICAgIH0KICAgICAgICAg
YnJlYWs7CkBAIC0yMTAsNyArMjEwLDcgQEAgc3RhdGljIHZvaWQgZGFlbW9uX3JlYWRfY29tcGxl
dGUoc3RydWN0IHVkc2NzX2Nvbm5lY3Rpb24gKipjb25ucCwKICAgICAgICAgICAgIHZkYWdlbnRf
ZmlsZV94ZmVyc19zdGF0dXMoYWdlbnQtPnhmZXJzLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAoVkRBZ2VudEZpbGVYZmVyU3RhdHVzTWVzc2FnZSAqKWRhdGEpOwogICAg
ICAgICB9IGVsc2UgewotICAgICAgICAgICAgdmRhZ2VudF9maWxlX3hmZXJzX2Vycm9yX2Rpc2Fi
bGVkKCpjb25ucCwKKyAgICAgICAgICAgIHZkYWdlbnRfZmlsZV94ZmVyc19lcnJvcl9kaXNhYmxl
ZChjb25uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgo
VkRBZ2VudEZpbGVYZmVyU3RhdHVzTWVzc2FnZSAqKWRhdGEpLT5pZCk7CiAgICAgICAgIH0KICAg
ICAgICAgYnJlYWs7CkBAIC0yMzQsNyArMjM0LDcgQEAgc3RhdGljIHZvaWQgZGFlbW9uX3JlYWRf
Y29tcGxldGUoc3RydWN0IHVkc2NzX2Nvbm5lY3Rpb24gKipjb25ucCwKICAgICAgICAgICAgIHZk
YWdlbnRfZmlsZV94ZmVyc19kYXRhKGFnZW50LT54ZmVycywKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIChWREFnZW50RmlsZVhmZXJEYXRhTWVzc2FnZSAqKWRhdGEpOwogICAg
ICAgICB9IGVsc2UgewotICAgICAgICAgICAgdmRhZ2VudF9maWxlX3hmZXJzX2Vycm9yX2Rpc2Fi
bGVkKCpjb25ucCwKKyAgICAgICAgICAgIHZkYWdlbnRfZmlsZV94ZmVyc19lcnJvcl9kaXNhYmxl
ZChjb25uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgo
VkRBZ2VudEZpbGVYZmVyRGF0YU1lc3NhZ2UgKilkYXRhKS0+aWQpOwogICAgICAgICB9CiAgICAg
ICAgIGJyZWFrOwpAQCAtMjUzLDEwICsyNTMsMTUgQEAgc3RhdGljIHZvaWQgZGFlbW9uX3JlYWRf
Y29tcGxldGUoc3RydWN0IHVkc2NzX2Nvbm5lY3Rpb24gKipjb25ucCwKICAgICB9CiB9CiAKLXN0
YXRpYyB2b2lkIGRhZW1vbl9kaXNjb25uZWN0X2NiKHN0cnVjdCB1ZHNjc19jb25uZWN0aW9uICpj
b25uKQorc3RhdGljIHZvaWQgZGFlbW9uX2Vycm9yX2NiKFZEQWdlbnRDb25uZWN0aW9uICpjb25u
LCBHRXJyb3IgKmVycikKIHsKLSAgICBWREFnZW50ICphZ2VudCA9IHVkc2NzX2dldF91c2VyX2Rh
dGEoY29ubik7Ci0gICAgYWdlbnQtPmNvbm4gPSBOVUxMOworICAgIFZEQWdlbnQgKmFnZW50ID0g
Z19vYmplY3RfZ2V0X2RhdGEoR19PQkpFQ1QoY29ubiksICJhZ2VudCIpOworCisgICAgaWYgKGVy
cikgeworICAgICAgICBzeXNsb2coTE9HX0VSUiwgIiVzIiwgZXJyLT5tZXNzYWdlKTsKKyAgICAg
ICAgZ19lcnJvcl9mcmVlKGVycik7CisgICAgfQorICAgIGdfY2xlYXJfcG9pbnRlcigmYWdlbnQt
PmNvbm4sIHZkYWdlbnRfY29ubmVjdGlvbl9kZXN0cm95KTsKICAgICB2ZGFnZW50X3F1aXRfbG9v
cChhZ2VudCk7CiB9CiAKQEAgLTM1NSw3ICszNjAsNyBAQCBzdGF0aWMgdm9pZCB2ZGFnZW50X2Rl
c3Ryb3koVkRBZ2VudCAqYWdlbnQpCiB7CiAgICAgdmRhZ2VudF9maW5hbGl6ZV9maWxlX3hmZXIo
YWdlbnQpOwogICAgIHZkYWdlbnRfeDExX2Rlc3Ryb3koYWdlbnQtPngxMSwgYWdlbnQtPmNvbm4g
PT0gTlVMTCk7Ci0gICAgdWRzY3NfZGVzdHJveV9jb25uZWN0aW9uKCZhZ2VudC0+Y29ubik7Cisg
ICAgZ19jbGVhcl9wb2ludGVyKCZhZ2VudC0+Y29ubiwgdmRhZ2VudF9jb25uZWN0aW9uX2Rlc3Ry
b3kpOwogCiAgICAgd2hpbGUgKGdfc291cmNlX3JlbW92ZV9ieV91c2VyX2RhdGEoYWdlbnQpKQog
ICAgICAgICBjb250aW51ZTsKQEAgLTM3MCwxMyArMzc1LDEzIEBAIHN0YXRpYyBnYm9vbGVhbiB2
ZGFnZW50X2luaXRfYXN5bmNfY2IoZ3BvaW50ZXIgdXNlcl9kYXRhKQogICAgIFZEQWdlbnQgKmFn
ZW50ID0gdXNlcl9kYXRhOwogCiAgICAgYWdlbnQtPmNvbm4gPSB1ZHNjc19jb25uZWN0KHZkYWdl
bnRkX3NvY2tldCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGFlbW9uX3JlYWRf
Y29tcGxldGUsIGRhZW1vbl9kaXNjb25uZWN0X2NiLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBkYWVtb25fcmVhZF9jb21wbGV0ZSwgZGFlbW9uX2Vycm9yX2NiLAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBkZWJ1Zyk7CiAgICAgaWYgKGFnZW50LT5jb25uID09IE5V
TEwpIHsKICAgICAgICAgZ190aW1lb3V0X2FkZF9zZWNvbmRzKDEsIHZkYWdlbnRfaW5pdF9hc3lu
Y19jYiwgYWdlbnQpOwogICAgICAgICByZXR1cm4gR19TT1VSQ0VfUkVNT1ZFOwogICAgIH0KLSAg
ICB1ZHNjc19zZXRfdXNlcl9kYXRhKGFnZW50LT5jb25uLCBhZ2VudCk7CisgICAgZ19vYmplY3Rf
c2V0X2RhdGEoR19PQkpFQ1QoYWdlbnQtPmNvbm4pLCAiYWdlbnQiLCBhZ2VudCk7CiAKICAgICBh
Z2VudC0+eDExID0gdmRhZ2VudF94MTFfY3JlYXRlKGFnZW50LT5jb25uLCBkZWJ1ZywgeDExX3N5
bmMpOwogICAgIGlmIChhZ2VudC0+eDExID09IE5VTEwpCkBAIC00NzUsNiArNDgwLDkgQEAgcmVj
b25uZWN0OgogICAgIHZkYWdlbnRfZGVzdHJveShhZ2VudCk7CiAgICAgYWdlbnQgPSBOVUxMOwog
CisgICAgLyogYWxsb3cgdGhlIFZEQWdlbnRDb25uZWN0aW9uIHRvIGZpbmFsaXplIHByb3Blcmx5
ICovCisgICAgZ19tYWluX2NvbnRleHRfaXRlcmF0aW9uKE5VTEwsIEZBTFNFKTsKKwogICAgIGlm
ICghcXVpdCAmJiBkb19kYWVtb25pemUpCiAgICAgICAgIGdvdG8gcmVjb25uZWN0OwogCmRpZmYg
LS1naXQgYS9zcmMvdmRhZ2VudGQvdmRhZ2VudGQuYyBiL3NyYy92ZGFnZW50ZC92ZGFnZW50ZC5j
CmluZGV4IDcyYTNlMTMuLjY4OWE4M2EgMTAwNjQ0Ci0tLSBhL3NyYy92ZGFnZW50ZC92ZGFnZW50
ZC5jCisrKyBiL3NyYy92ZGFnZW50ZC92ZGFnZW50ZC5jCkBAIC0yOSwxMCArMjksOSBAQAogI2lu
Y2x1ZGUgPGVycm5vLmg+CiAjaW5jbHVkZSA8c2lnbmFsLmg+CiAjaW5jbHVkZSA8c3lzbG9nLmg+
Ci0jaW5jbHVkZSA8c3lzL3NlbGVjdC5oPgogI2luY2x1ZGUgPHN5cy9zdGF0Lmg+CiAjaW5jbHVk
ZSA8c3BpY2UvdmRfYWdlbnQuaD4KLSNpbmNsdWRlIDxnbGliLmg+CisjaW5jbHVkZSA8Z2xpYi11
bml4Lmg+CiAKICNpZmRlZiBXSVRIX1NZU1RFTURfU09DS0VUX0FDVElWQVRJT04KICNpbmNsdWRl
IDxzeXN0ZW1kL3NkLWRhZW1vbi5oPgpAQCAtNzksMTEgKzc4LDE4IEBAIHN0YXRpYyBjb25zdCBj
aGFyICphY3RpdmVfc2Vzc2lvbiA9IE5VTEw7CiBzdGF0aWMgdW5zaWduZWQgaW50IHNlc3Npb25f
Y291bnQgPSAwOwogc3RhdGljIHN0cnVjdCB1ZHNjc19jb25uZWN0aW9uICphY3RpdmVfc2Vzc2lv
bl9jb25uID0gTlVMTDsKIHN0YXRpYyBpbnQgYWdlbnRfb3duc19jbGlwYm9hcmRbMjU2XSA9IHsg
MCwgfTsKLXN0YXRpYyBpbnQgcXVpdCA9IDA7CiBzdGF0aWMgaW50IHJldHZhbCA9IDA7CiBzdGF0
aWMgaW50IGNsaWVudF9jb25uZWN0ZWQgPSAwOwogc3RhdGljIGludCBtYXhfY2xpcGJvYXJkID0g
LTE7CiAKK3N0YXRpYyBHTWFpbkxvb3AgKmxvb3A7CisKK3N0YXRpYyB2b2lkIHZkYWdlbnRkX3F1
aXQoZ2ludCBleGl0X2NvZGUpCit7CisgICAgcmV0dmFsID0gZXhpdF9jb2RlOworICAgIGdfbWFp
bl9sb29wX3F1aXQobG9vcCk7Cit9CisKIC8qIHV0aWxpdHkgZnVuY3Rpb25zICovCiBzdGF0aWMg
dm9pZCB2aXJ0aW9fbXNnX3VpbnQzMl90b19sZSh1aW50OF90ICpfbXNnLCB1aW50MzJfdCBzaXpl
LCB1aW50MzJfdCBvZmZzZXQpCiB7CkBAIC0xNTUsOSArMTYxLDkgQEAgdm9pZCBkb19jbGllbnRf
bW91c2Uoc3RydWN0IHZkYWdlbnRkX3VpbnB1dCAqKnVpbnB1dHAsIFZEQWdlbnRNb3VzZVN0YXRl
ICptb3VzZSkKICAgICB2ZGFnZW50ZF91aW5wdXRfZG9fbW91c2UodWlucHV0cCwgbW91c2UpOwog
ICAgIGlmICghKnVpbnB1dHApIHsKICAgICAgICAgLyogVHJ5IHRvIHJlLW9wZW4gdGhlIHRhYmxl
dCAqLwotICAgICAgICBzdHJ1Y3QgYWdlbnRfZGF0YSAqYWdlbnRfZGF0YSA9Ci0gICAgICAgICAg
ICB1ZHNjc19nZXRfdXNlcl9kYXRhKGFjdGl2ZV9zZXNzaW9uX2Nvbm4pOwotICAgICAgICBpZiAo
YWdlbnRfZGF0YSkKKyAgICAgICAgaWYgKGFjdGl2ZV9zZXNzaW9uX2Nvbm4pIHsKKyAgICAgICAg
ICAgIHN0cnVjdCBhZ2VudF9kYXRhICphZ2VudF9kYXRhID0KKyAgICAgICAgICAgIGdfb2JqZWN0
X2dldF9kYXRhKEdfT0JKRUNUKGFjdGl2ZV9zZXNzaW9uX2Nvbm4pLCAiYWdlbnRfZGF0YSIpOwog
ICAgICAgICAgICAgKnVpbnB1dHAgPSB2ZGFnZW50ZF91aW5wdXRfY3JlYXRlKHVpbnB1dF9kZXZp
Y2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWdlbnRf
ZGF0YS0+d2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgYWdlbnRfZGF0YS0+aGVpZ2h0LApAQCAtMTY1LDEwICsxNzEsMTAgQEAgdm9pZCBkb19jbGll
bnRfbW91c2Uoc3RydWN0IHZkYWdlbnRkX3VpbnB1dCAqKnVpbnB1dHAsIFZEQWdlbnRNb3VzZVN0
YXRlICptb3VzZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBhZ2VudF9kYXRhLT5zY3JlZW5fY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgZGVidWcgPiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHVpbnB1dF9mYWtlKTsKKyAgICAgICAgfQogICAgICAgICBpZiAo
ISp1aW5wdXRwKSB7CiAgICAgICAgICAgICBzeXNsb2coTE9HX0NSSVQsICJGYXRhbCB1aW5wdXQg
ZXJyb3IiKTsKLSAgICAgICAgICAgIHJldHZhbCA9IDE7Ci0gICAgICAgICAgICBxdWl0ID0gMTsK
KyAgICAgICAgICAgIHZkYWdlbnRkX3F1aXQoMSk7CiAgICAgICAgIH0KICAgICB9CiB9CkBAIC01
MTcsMTQgKzUyMywxNCBAQCBzdGF0aWMgZ2Jvb2xlYW4gdmRhZ2VudF9tZXNzYWdlX2NoZWNrX3Np
emUoY29uc3QgVkRBZ2VudE1lc3NhZ2UgKm1lc3NhZ2VfaGVhZGVyKQogCiBzdGF0aWMgVkRBZ2Vu
dEdyYXBoaWNzRGV2aWNlSW5mbyAqZGV2aWNlX2luZm8gPSBOVUxMOwogc3RhdGljIHNpemVfdCBk
ZXZpY2VfaW5mb19zaXplID0gMDsKLXN0YXRpYyBpbnQgdmlydGlvX3BvcnRfcmVhZF9jb21wbGV0
ZSgKK3N0YXRpYyB2b2lkIHZpcnRpb19wb3J0X3JlYWRfY29tcGxldGUoCiAgICAgICAgIHN0cnVj
dCB2ZGFnZW50X3ZpcnRpb19wb3J0ICp2cG9ydCwKICAgICAgICAgaW50IHBvcnRfbnIsCiAgICAg
ICAgIFZEQWdlbnRNZXNzYWdlICptZXNzYWdlX2hlYWRlciwKICAgICAgICAgdWludDhfdCAqZGF0
YSkKIHsKICAgICBpZiAoIXZkYWdlbnRfbWVzc2FnZV9jaGVja19zaXplKG1lc3NhZ2VfaGVhZGVy
KSkKLSAgICAgICAgcmV0dXJuIDA7CisgICAgICAgIHJldHVybjsKIAogICAgIHN3aXRjaCAobWVz
c2FnZV9oZWFkZXItPnR5cGUpIHsKICAgICBjYXNlIFZEX0FHRU5UX01PVVNFX1NUQVRFOgpAQCAt
NTg2LDggKzU5MiwyNiBAQCBzdGF0aWMgaW50IHZpcnRpb19wb3J0X3JlYWRfY29tcGxldGUoCiAg
ICAgZGVmYXVsdDoKICAgICAgICAgZ193YXJuX2lmX3JlYWNoZWQoKTsKICAgICB9Cit9CiAKLSAg
ICByZXR1cm4gMDsKK3N0YXRpYyB2b2lkIHZpcnRpb19wb3J0X2Vycm9yX2NiKFZEQWdlbnRDb25u
ZWN0aW9uICpjb25uLCBHRXJyb3IgKmVycikKK3sKKyAgICBnYm9vbGVhbiBvbGRfY2xpZW50X2Nv
bm5lY3RlZCA9IGNsaWVudF9jb25uZWN0ZWQ7CisgICAgc3lzbG9nKExPR19DUklULCAiQUlJRUVF
IGxvc3Qgc3BpY2UgY2xpZW50IGNvbm5lY3Rpb24sIHJlY29ubmVjdGluZyAoZXJyOiAlcykiLAor
ICAgICAgICAgICAgICAgICAgICAgZXJyID8gZXJyLT5tZXNzYWdlIDogIiIpOworICAgIGdfY2xl
YXJfZXJyb3IoJmVycik7CisKKyAgICB2ZGFnZW50X2Nvbm5lY3Rpb25fZGVzdHJveSh2aXJ0aW9f
cG9ydCk7CisgICAgdmlydGlvX3BvcnQgPSB2ZGFnZW50X3ZpcnRpb19wb3J0X2NyZWF0ZShwb3J0
ZGV2LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlydGlv
X3BvcnRfcmVhZF9jb21wbGV0ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHZpcnRpb19wb3J0X2Vycm9yX2NiKTsKKyAgICBpZiAodmlydGlvX3BvcnQgPT0g
TlVMTCkgeworICAgICAgICBzeXNsb2coTE9HX0NSSVQsICJGYXRhbCBlcnJvciBvcGVuaW5nIHZk
YWdlbnQgdmlydGlvIGNoYW5uZWwiKTsKKyAgICAgICAgdmRhZ2VudGRfcXVpdCgxKTsKKyAgICAg
ICAgcmV0dXJuOworICAgIH0KKyAgICBkb19jbGllbnRfZGlzY29ubmVjdCgpOworICAgIGNsaWVu
dF9jb25uZWN0ZWQgPSBvbGRfY2xpZW50X2Nvbm5lY3RlZDsKIH0KIAogc3RhdGljIHZvaWQgdmly
dGlvX3dyaXRlX2NsaXBib2FyZCh1aW50OF90IHNlbGVjdGlvbiwgdWludDMyX3QgbXNnX3R5cGUs
CkBAIC02MjIsNyArNjQ2LDcgQEAgc3RhdGljIHZvaWQgdmlydGlvX3dyaXRlX2NsaXBib2FyZCh1
aW50OF90IHNlbGVjdGlvbiwgdWludDMyX3QgbXNnX3R5cGUsCiB9CiAKIC8qIHZkYWdlbnRkIDwt
PiB2ZGFnZW50IGNvbW11bmljYXRpb24gaGFuZGxpbmcgKi8KLXN0YXRpYyBpbnQgZG9fYWdlbnRf
Y2xpcGJvYXJkKHN0cnVjdCB1ZHNjc19jb25uZWN0aW9uICpjb25uLAorc3RhdGljIHZvaWQgZG9f
YWdlbnRfY2xpcGJvYXJkKHN0cnVjdCB1ZHNjc19jb25uZWN0aW9uICpjb25uLAogICAgICAgICBz
dHJ1Y3QgdWRzY3NfbWVzc2FnZV9oZWFkZXIgKmhlYWRlciwgdWludDhfdCAqZGF0YSkKIHsKICAg
ICB1aW50OF90IHNlbGVjdGlvbiA9IGhlYWRlci0+YXJnMTsKQEAgLTY2OCw3ICs2OTIsNyBAQCBz
dGF0aWMgaW50IGRvX2FnZW50X2NsaXBib2FyZChzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqY29u
biwKICAgICAgICAgICAgIHN5c2xvZyhMT0dfV0FSTklORywgImNsaXBib2FyZCBpcyB0b28gbGFy
Z2UgKCVkID4gJWQpLCBkaXNjYXJkaW5nIiwKICAgICAgICAgICAgICAgICAgICBzaXplLCBtYXhf
Y2xpcGJvYXJkKTsKICAgICAgICAgICAgIHZpcnRpb193cml0ZV9jbGlwYm9hcmQoc2VsZWN0aW9u
LCBtc2dfdHlwZSwgZGF0YV90eXBlLCBOVUxMLCAwKTsKLSAgICAgICAgICAgIHJldHVybiAwOwor
ICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgICAgIGJyZWFrOwogICAgIGNhc2Ug
VkRBR0VOVERfQ0xJUEJPQVJEX1JFTEVBU0U6CkBAIC02ODQsMTIgKzcwOCwxMyBAQCBzdGF0aWMg
aW50IGRvX2FnZW50X2NsaXBib2FyZChzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqY29ubiwKICAg
ICBpZiAoc2l6ZSAhPSBoZWFkZXItPnNpemUpIHsKICAgICAgICAgc3lzbG9nKExPR19FUlIsCiAg
ICAgICAgICAgICAgICAidW5leHBlY3RlZCBleHRyYSBkYXRhIGluIGNsaXBib2FyZCBtc2csIGRp
c2Nvbm5lY3RpbmcgYWdlbnQiKTsKLSAgICAgICAgcmV0dXJuIC0xOworICAgICAgICB1ZHNjc19z
ZXJ2ZXJfZGVzdHJveV9jb25uZWN0aW9uKHNlcnZlciwgY29ubik7CisgICAgICAgIHJldHVybjsK
ICAgICB9CiAKICAgICB2aXJ0aW9fd3JpdGVfY2xpcGJvYXJkKHNlbGVjdGlvbiwgbXNnX3R5cGUs
IGRhdGFfdHlwZSwgZGF0YSwgaGVhZGVyLT5zaXplKTsKIAotICAgIHJldHVybiAwOworICAgIHJl
dHVybjsKIAogZXJyb3I6CiAgICAgaWYgKGhlYWRlci0+dHlwZSA9PSBWREFHRU5URF9DTElQQk9B
UkRfUkVRVUVTVCkgewpAQCAtNjk3LDcgKzcyMiw2IEBAIGVycm9yOgogICAgICAgICB1ZHNjc193
cml0ZShjb25uLCBWREFHRU5URF9DTElQQk9BUkRfREFUQSwKICAgICAgICAgICAgICAgICAgICAg
c2VsZWN0aW9uLCBWRF9BR0VOVF9DTElQQk9BUkRfTk9ORSwgTlVMTCwgMCk7CiAgICAgfQotICAg
IHJldHVybiAwOwogfQogCiAvKiBXaGVuIHdlIG9wZW4gdGhlIHZkYWdlbnQgdmlydGlvIGNoYW5u
ZWwsIHRoZSBzZXJ2ZXIgYXV0b21hdGljYWxseSBnb2VzIGludG8KQEAgLTcwOSw3ICs3MzMsOSBA
QCBlcnJvcjoKICAgIGNsb3NlcyBib3RoLiAqLwogc3RhdGljIHZvaWQgY2hlY2tfeG9yZ19yZXNv
bHV0aW9uKHZvaWQpCiB7Ci0gICAgc3RydWN0IGFnZW50X2RhdGEgKmFnZW50X2RhdGEgPSB1ZHNj
c19nZXRfdXNlcl9kYXRhKGFjdGl2ZV9zZXNzaW9uX2Nvbm4pOworICAgIHN0cnVjdCBhZ2VudF9k
YXRhICphZ2VudF9kYXRhID0gTlVMTDsKKyAgICBpZiAoYWN0aXZlX3Nlc3Npb25fY29ubikKKyAg
ICAgICAgYWdlbnRfZGF0YSA9IGdfb2JqZWN0X2dldF9kYXRhKEdfT0JKRUNUKGFjdGl2ZV9zZXNz
aW9uX2Nvbm4pLCAiYWdlbnRfZGF0YSIpOwogCiAgICAgaWYgKGFnZW50X2RhdGEgJiYgYWdlbnRf
ZGF0YS0+c2NyZWVuX2luZm8pIHsKICAgICAgICAgaWYgKCF1aW5wdXQpCkBAIC03MjgsOCArNzU0
LDcgQEAgc3RhdGljIHZvaWQgY2hlY2tfeG9yZ19yZXNvbHV0aW9uKHZvaWQpCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWdlbnRfZGF0YS0+c2NyZWVuX2NvdW50KTsK
ICAgICAgICAgaWYgKCF1aW5wdXQpIHsKICAgICAgICAgICAgIHN5c2xvZyhMT0dfQ1JJVCwgIkZh
dGFsIHVpbnB1dCBlcnJvciIpOwotICAgICAgICAgICAgcmV0dmFsID0gMTsKLSAgICAgICAgICAg
IHF1aXQgPSAxOworICAgICAgICAgICAgdmRhZ2VudGRfcXVpdCgxKTsKICAgICAgICAgICAgIHJl
dHVybjsKICAgICAgICAgfQogCkBAIC03MzcsMTEgKzc2MiwxMCBAQCBzdGF0aWMgdm9pZCBjaGVj
a194b3JnX3Jlc29sdXRpb24odm9pZCkKICAgICAgICAgICAgIHN5c2xvZyhMT0dfSU5GTywgIm9w
ZW5pbmcgdmRhZ2VudCB2aXJ0aW8gY2hhbm5lbCIpOwogICAgICAgICAgICAgdmlydGlvX3BvcnQg
PSB2ZGFnZW50X3ZpcnRpb19wb3J0X2NyZWF0ZShwb3J0ZGV2LAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXJ0aW9fcG9ydF9yZWFkX2NvbXBs
ZXRlLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBOVUxMKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgdmlydGlvX3BvcnRfZXJyb3JfY2IpOwogICAgICAgICAgICAgaWYgKCF2aXJ0aW9fcG9y
dCkgewogICAgICAgICAgICAgICAgIHN5c2xvZyhMT0dfQ1JJVCwgIkZhdGFsIGVycm9yIG9wZW5p
bmcgdmRhZ2VudCB2aXJ0aW8gY2hhbm5lbCIpOwotICAgICAgICAgICAgICAgIHJldHZhbCA9IDE7
Ci0gICAgICAgICAgICAgICAgcXVpdCA9IDE7CisgICAgICAgICAgICAgICAgdmRhZ2VudGRfcXVp
dCgxKTsKICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICB9CiAgICAgICAgICAg
ICBzZW5kX2NhcGFiaWxpdGllcyh2aXJ0aW9fcG9ydCwgMSk7CkBAIC03NTEsMTggKzc3NSwyMyBA
QCBzdGF0aWMgdm9pZCBjaGVja194b3JnX3Jlc29sdXRpb24odm9pZCkKICAgICAgICAgdmRhZ2Vu
dGRfdWlucHV0X2Rlc3Ryb3koJnVpbnB1dCk7CiAjZW5kaWYKICAgICAgICAgaWYgKHZpcnRpb19w
b3J0KSB7Ci0gICAgICAgICAgICB2ZGFnZW50X3ZpcnRpb19wb3J0X2ZsdXNoKCZ2aXJ0aW9fcG9y
dCk7Ci0gICAgICAgICAgICB2ZGFnZW50X3ZpcnRpb19wb3J0X2Rlc3Ryb3koJnZpcnRpb19wb3J0
KTsKKyAgICAgICAgICAgIGlmIChvbmx5X29uY2UpIHsKKyAgICAgICAgICAgICAgICBzeXNsb2co
TE9HX0lORk8sICJFeGl0aW5nIGFmdGVyIG9uZSBjbGllbnQgc2Vzc2lvbi4iKTsKKyAgICAgICAg
ICAgICAgICB2ZGFnZW50ZF9xdWl0KDApOworICAgICAgICAgICAgICAgIHJldHVybjsKKyAgICAg
ICAgICAgIH0KKyAgICAgICAgICAgIHZkYWdlbnRfY29ubmVjdGlvbl9mbHVzaChWREFHRU5UX0NP
Tk5FQ1RJT04odmlydGlvX3BvcnQpKTsKKyAgICAgICAgICAgIGdfY2xlYXJfcG9pbnRlcigmdmly
dGlvX3BvcnQsIHZkYWdlbnRfY29ubmVjdGlvbl9kZXN0cm95KTsKICAgICAgICAgICAgIHN5c2xv
ZyhMT0dfSU5GTywgImNsb3NlZCB2ZGFnZW50IHZpcnRpbyBjaGFubmVsIik7CiAgICAgICAgIH0K
ICAgICB9CiB9CiAKLXN0YXRpYyBpbnQgY29ubmVjdGlvbl9tYXRjaGVzX2FjdGl2ZV9zZXNzaW9u
KHN0cnVjdCB1ZHNjc19jb25uZWN0aW9uICoqY29ubnAsCitzdGF0aWMgaW50IGNvbm5lY3Rpb25f
bWF0Y2hlc19hY3RpdmVfc2Vzc2lvbihzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAqY29ubiwKICAg
ICB2b2lkICpwcml2KQogewogICAgIHN0cnVjdCB1ZHNjc19jb25uZWN0aW9uICoqY29ubl9yZXQg
PSAoc3RydWN0IHVkc2NzX2Nvbm5lY3Rpb24gKiopcHJpdjsKLSAgICBzdHJ1Y3QgYWdlbnRfZGF0
YSAqYWdlbnRfZGF0YSA9IHVkc2NzX2dldF91c2VyX2RhdGEoKmNvbm5wKTsKKyAgICBzdHJ1Y3Qg
YWdlbnRfZGF0YSAqYWdlbnRfZGF0YSA9IGdfb2JqZWN0X2dldF9kYXRhKEdfT0JKRUNUKGNvbm4p
LCAiYWdlbnRfZGF0YSIpOwogCiAgICAgLyogQ2hlY2sgaWYgdGhpcyBjb25uZWN0aW9uIG1hdGNo
ZXMgdGhlIGN1cnJlbnRseSBhY3RpdmUgc2Vzc2lvbiAqLwogICAgIGlmICghYWdlbnRfZGF0YS0+
c2Vzc2lvbiB8fCAhYWN0aXZlX3Nlc3Npb24pCkBAIC03NzAsNyArNzk5LDcgQEAgc3RhdGljIGlu
dCBjb25uZWN0aW9uX21hdGNoZXNfYWN0aXZlX3Nlc3Npb24oc3RydWN0IHVkc2NzX2Nvbm5lY3Rp
b24gKipjb25ucCwKICAgICBpZiAoc3RyY21wKGFnZW50X2RhdGEtPnNlc3Npb24sIGFjdGl2ZV9z
ZXNzaW9uKSkKICAgICAgICAgcmV0dXJuIDA7CiAKLSAgICAqY29ubl9yZXQgPSAqY29ubnA7Cisg
ICAgKmNvbm5fcmV0ID0gY29ubjsKICAgICByZXR1cm4gMTsKIH0KIApAQCAtODUyLDEzICs4ODEs
MjQgQEAgc3RhdGljIHZvaWQgYWdlbnRfY29ubmVjdChzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAq
Y29ubikKIHsKICAgICBzdHJ1Y3QgYWdlbnRfZGF0YSAqYWdlbnRfZGF0YTsKICAgICBhZ2VudF9k
YXRhID0gZ19uZXcwKHN0cnVjdCBhZ2VudF9kYXRhLCAxKTsKKyAgICBHRXJyb3IgKmVyciA9IE5V
TEw7CisgICAgZ2ludCBwaWQ7CiAKICAgICBpZiAoc2Vzc2lvbl9pbmZvKSB7Ci0gICAgICAgIHVp
bnQzMl90IHBpZCA9IHVkc2NzX2dldF9wZWVyX3BpZChjb25uKTsKKyAgICAgICAgcGlkID0gdmRh
Z2VudF9jb25uZWN0aW9uX2dldF9wZWVyX3BpZChWREFHRU5UX0NPTk5FQ1RJT04oY29ubiksICZl
cnIpOworICAgICAgICBpZiAoZXJyKSB7CisgICAgICAgICAgICBzeXNsb2coTE9HX0VSUiwgIkNv
dWxkIG5vdCBnZXQgcGVlciBQSUQsIGRpc2Nvbm5lY3RpbmcgbmV3IGNsaWVudDogJXMiLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGVyci0+bWVzc2FnZSk7CisgICAgICAgICAgICBnX2Vy
cm9yX2ZyZWUoZXJyKTsKKyAgICAgICAgICAgIGdfZnJlZShhZ2VudF9kYXRhKTsKKyAgICAgICAg
ICAgIHVkc2NzX3NlcnZlcl9kZXN0cm95X2Nvbm5lY3Rpb24oc2VydmVyLCBjb25uKTsKKyAgICAg
ICAgICAgIHJldHVybjsKKyAgICAgICAgfQorCiAgICAgICAgIGFnZW50X2RhdGEtPnNlc3Npb24g
PSBzZXNzaW9uX2luZm9fc2Vzc2lvbl9mb3JfcGlkKHNlc3Npb25faW5mbywgcGlkKTsKICAgICB9
CiAKLSAgICB1ZHNjc19zZXRfdXNlcl9kYXRhKGNvbm4sICh2b2lkICopYWdlbnRfZGF0YSk7Cisg
ICAgZ19vYmplY3Rfc2V0X2RhdGEoR19PQkpFQ1QoY29ubiksICJhZ2VudF9kYXRhIiwgYWdlbnRf
ZGF0YSk7CiAgICAgdWRzY3Nfd3JpdGUoY29ubiwgVkRBR0VOVERfVkVSU0lPTiwgMCwgMCwKICAg
ICAgICAgICAgICAgICAodWludDhfdCAqKVZFUlNJT04sIHN0cmxlbihWRVJTSU9OKSArIDEpOwog
ICAgIHVwZGF0ZV9hY3RpdmVfc2Vzc2lvbl9jb25uZWN0aW9uKGNvbm4pOwpAQCAtODY5LDI0ICs5
MDksMjkgQEAgc3RhdGljIHZvaWQgYWdlbnRfY29ubmVjdChzdHJ1Y3QgdWRzY3NfY29ubmVjdGlv
biAqY29ubikKICAgICB9CiB9CiAKLXN0YXRpYyB2b2lkIGFnZW50X2Rpc2Nvbm5lY3Qoc3RydWN0
IHVkc2NzX2Nvbm5lY3Rpb24gKmNvbm4pCitzdGF0aWMgdm9pZCBhZ2VudF9kaXNjb25uZWN0KFZE
QWdlbnRDb25uZWN0aW9uICpjb25uLCBHRXJyb3IgKmVycikKIHsKLSAgICBzdHJ1Y3QgYWdlbnRf
ZGF0YSAqYWdlbnRfZGF0YSA9IHVkc2NzX2dldF91c2VyX2RhdGEoY29ubik7CisgICAgc3RydWN0
IGFnZW50X2RhdGEgKmFnZW50X2RhdGEgPSBnX29iamVjdF9nZXRfZGF0YShHX09CSkVDVChjb25u
KSwgImFnZW50X2RhdGEiKTsKIAogICAgIGdfaGFzaF90YWJsZV9mb3JlYWNoX3JlbW92ZShhY3Rp
dmVfeGZlcnMsIHJlbW92ZV9hY3RpdmVfeGZlcnMsIGNvbm4pOwogCiAgICAgZ19jbGVhcl9wb2lu
dGVyKCZhZ2VudF9kYXRhLT5zZXNzaW9uLCBnX2ZyZWUpOwotICAgIHVwZGF0ZV9hY3RpdmVfc2Vz
c2lvbl9jb25uZWN0aW9uKE5VTEwpOwotCiAgICAgZ19mcmVlKGFnZW50X2RhdGEtPnNjcmVlbl9p
bmZvKTsKICAgICBnX2ZyZWUoYWdlbnRfZGF0YSk7CisgICAgaWYgKGVycikgeworICAgICAgICBz
eXNsb2coTE9HX0VSUiwgIiVzIiwgZXJyLT5tZXNzYWdlKTsKKyAgICAgICAgZ19lcnJvcl9mcmVl
KGVycik7CisgICAgfQorICAgIHVkc2NzX3NlcnZlcl9kZXN0cm95X2Nvbm5lY3Rpb24oc2VydmVy
LCBVRFNDU19DT05ORUNUSU9OKGNvbm4pKTsKKworICAgIHVwZGF0ZV9hY3RpdmVfc2Vzc2lvbl9j
b25uZWN0aW9uKE5VTEwpOwogfQogCi1zdGF0aWMgdm9pZCBkb19hZ2VudF94b3JnX3Jlc29sdXRp
b24oc3RydWN0IHVkc2NzX2Nvbm5lY3Rpb24gICAgKipjb25ucCwKK3N0YXRpYyB2b2lkIGRvX2Fn
ZW50X3hvcmdfcmVzb2x1dGlvbihzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAgICAgKmNvbm4sCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHVkc2NzX21lc3NhZ2Vf
aGVhZGVyICpoZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3Vp
bnQ4ICAgICAgICAgICAgICAgICAgICAgICpkYXRhKQogewotICAgIHN0cnVjdCBhZ2VudF9kYXRh
ICphZ2VudF9kYXRhID0gdWRzY3NfZ2V0X3VzZXJfZGF0YSgqY29ubnApOworICAgIHN0cnVjdCBh
Z2VudF9kYXRhICphZ2VudF9kYXRhID0gZ19vYmplY3RfZ2V0X2RhdGEoR19PQkpFQ1QoY29ubiks
ICJhZ2VudF9kYXRhIik7CiAgICAgZ3VpbnQgcmVzX3NpemUgPSBzaXplb2Yoc3RydWN0IHZkYWdl
bnRkX2d1ZXN0X3hvcmdfcmVzb2x1dGlvbik7CiAgICAgZ3VpbnQgbiA9IGhlYWRlci0+c2l6ZSAv
IHJlc19zaXplOwogCkBAIC05MDIsNyArOTQ3LDcgQEAgc3RhdGljIHZvaWQgZG9fYWdlbnRfeG9y
Z19yZXNvbHV0aW9uKHN0cnVjdCB1ZHNjc19jb25uZWN0aW9uICAgICoqY29ubnAsCiAgICAgaWYg
KGhlYWRlci0+c2l6ZSAhPSBuICogcmVzX3NpemUpIHsKICAgICAgICAgc3lzbG9nKExPR19FUlIs
ICJndWVzdCB4b3JnIHJlc29sdXRpb24gbWVzc2FnZSBoYXMgd3Jvbmcgc2l6ZSwgIgogICAgICAg
ICAgICAgICAgICAgICAgICAgImRpc2Nvbm5lY3RpbmcgYWdlbnQiKTsKLSAgICAgICAgdWRzY3Nf
ZGVzdHJveV9jb25uZWN0aW9uKGNvbm5wKTsKKyAgICAgICAgdWRzY3Nfc2VydmVyX2Rlc3Ryb3lf
Y29ubmVjdGlvbihzZXJ2ZXIsIGNvbm4pOwogICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC05
MTUsNyArOTYwLDcgQEAgc3RhdGljIHZvaWQgZG9fYWdlbnRfeG9yZ19yZXNvbHV0aW9uKHN0cnVj
dCB1ZHNjc19jb25uZWN0aW9uICAgICoqY29ubnAsCiAgICAgY2hlY2tfeG9yZ19yZXNvbHV0aW9u
KCk7CiB9CiAKLXN0YXRpYyB2b2lkIGRvX2FnZW50X2ZpbGVfeGZlcl9zdGF0dXMoc3RydWN0IHVk
c2NzX2Nvbm5lY3Rpb24gICAgKipjb25ucCwKK3N0YXRpYyB2b2lkIGRvX2FnZW50X2ZpbGVfeGZl
cl9zdGF0dXMoc3RydWN0IHVkc2NzX2Nvbm5lY3Rpb24gICAgICpjb25uLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgdWRzY3NfbWVzc2FnZV9oZWFkZXIgKmhl
YWRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3VpbnQ4ICAgICAg
ICAgICAgICAgICAgICAgICpkYXRhKQogewpAQCAtOTM4LDI5ICs5ODMsMjYgQEAgc3RhdGljIHZv
aWQgZG9fYWdlbnRfZmlsZV94ZmVyX3N0YXR1cyhzdHJ1Y3QgdWRzY3NfY29ubmVjdGlvbiAgICAq
KmNvbm5wLAogICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLCBkYXRhX3NpemUpOwogCiAg
ICAgaWYgKGhlYWRlci0+YXJnMiA9PSBWRF9BR0VOVF9GSUxFX1hGRVJfU1RBVFVTX0NBTl9TRU5E
X0RBVEEpCi0gICAgICAgIGdfaGFzaF90YWJsZV9pbnNlcnQoYWN0aXZlX3hmZXJzLCB0YXNrX2lk
LCAqY29ubnApOworICAgICAgICBnX2hhc2hfdGFibGVfaW5zZXJ0KGFjdGl2ZV94ZmVycywgdGFz
a19pZCwgY29ubik7CiAgICAgZWxzZQogICAgICAgICBnX2hhc2hfdGFibGVfcmVtb3ZlKGFjdGl2
ZV94ZmVycywgdGFza19pZCk7CiB9CiAKLXN0YXRpYyB2b2lkIGFnZW50X3JlYWRfY29tcGxldGUo
c3RydWN0IHVkc2NzX2Nvbm5lY3Rpb24gKipjb25ucCwKK3N0YXRpYyB2b2lkIGFnZW50X3JlYWRf
Y29tcGxldGUoc3RydWN0IHVkc2NzX2Nvbm5lY3Rpb24gKmNvbm4sCiAgICAgc3RydWN0IHVkc2Nz
X21lc3NhZ2VfaGVhZGVyICpoZWFkZXIsIHVpbnQ4X3QgKmRhdGEpCiB7CiAgICAgc3dpdGNoICho
ZWFkZXItPnR5cGUpIHsKICAgICBjYXNlIFZEQUdFTlREX0dVRVNUX1hPUkdfUkVTT0xVVElPTjoK
LSAgICAgICAgZG9fYWdlbnRfeG9yZ19yZXNvbHV0aW9uKGNvbm5wLCBoZWFkZXIsIGRhdGEpOwor
ICAgICAgICBkb19hZ2VudF94b3JnX3Jlc29sdXRpb24oY29ubiwgaGVhZGVyLCBkYXRhKTsKICAg
ICAgICAgYnJlYWs7CiAgICAgY2FzZSBWREFHRU5URF9DTElQQk9BUkRfR1JBQjoKICAgICBjYXNl
IFZEQUdFTlREX0NMSVBCT0FSRF9SRVFVRVNUOgogICAgIGNhc2UgVkRBR0VOVERfQ0xJUEJPQVJE
X0RBVEE6CiAgICAgY2FzZSBWREFHRU5URF9DTElQQk9BUkRfUkVMRUFTRToKLSAgICAgICAgaWYg
KGRvX2FnZW50X2NsaXBib2FyZCgqY29ubnAsIGhlYWRlciwgZGF0YSkpIHsKLSAgICAgICAgICAg
IHVkc2NzX2Rlc3Ryb3lfY29ubmVjdGlvbihjb25ucCk7Ci0gICAgICAgICAgICByZXR1cm47Ci0g
ICAgICAgIH0KKyAgICAgICAgZG9fYWdlbnRfY2xpcGJvYXJkKGNvbm4sIGhlYWRlciwgZGF0YSk7
CiAgICAgICAgIGJyZWFrOwogICAgIGNhc2UgVkRBR0VOVERfRklMRV9YRkVSX1NUQVRVUzoKLSAg
ICAgICAgZG9fYWdlbnRfZmlsZV94ZmVyX3N0YXR1cyhjb25ucCwgaGVhZGVyLCBkYXRhKTsKKyAg
ICAgICAgZG9fYWdlbnRfZmlsZV94ZmVyX3N0YXR1cyhjb25uLCBoZWFkZXIsIGRhdGEpOwogICAg
ICAgICBicmVhazsKIAogICAgIGRlZmF1bHQ6CkBAIC05NjksNiArMTAxMSwxNSBAQCBzdGF0aWMg
dm9pZCBhZ2VudF9yZWFkX2NvbXBsZXRlKHN0cnVjdCB1ZHNjc19jb25uZWN0aW9uICoqY29ubnAs
CiAgICAgfQogfQogCitzdGF0aWMgZ2Jvb2xlYW4gc2lfaW9fY2hhbm5lbF9jYihHSU9DaGFubmVs
ICAqc291cmNlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR0lPQ29uZGl0aW9u
IGNvbmRpdGlvbiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdwb2ludGVyICAg
ICBkYXRhKQoreworICAgIGFjdGl2ZV9zZXNzaW9uID0gc2Vzc2lvbl9pbmZvX2dldF9hY3RpdmVf
c2Vzc2lvbihzZXNzaW9uX2luZm8pOworICAgIHVwZGF0ZV9hY3RpdmVfc2Vzc2lvbl9jb25uZWN0
aW9uKE5VTEwpOworICAgIHJldHVybiBHX1NPVVJDRV9DT05USU5VRTsKK30KKwogLyogbWFpbiAq
LwogCiBzdGF0aWMgdm9pZCBkYWVtb25pemUodm9pZCkKQEAgLTEwMTAsNzYgKzEwNjEsMTAgQEAg
c3RhdGljIHZvaWQgZGFlbW9uaXplKHZvaWQpCiAgICAgfQogfQogCi1zdGF0aWMgdm9pZCBtYWlu
X2xvb3Aodm9pZCkKLXsKLSAgICBmZF9zZXQgcmVhZGZkcywgd3JpdGVmZHM7Ci0gICAgaW50IG4s
IG5mZHM7Ci0gICAgaW50IGNrX2ZkID0gMDsKLSAgICBpbnQgb25jZSA9IDA7Ci0KLSAgICB3aGls
ZSAoIXF1aXQpIHsKLSAgICAgICAgRkRfWkVSTygmcmVhZGZkcyk7Ci0gICAgICAgIEZEX1pFUk8o
JndyaXRlZmRzKTsKLQotICAgICAgICBuZmRzID0gdWRzY3Nfc2VydmVyX2ZpbGxfZmRzKHNlcnZl
ciwgJnJlYWRmZHMsICZ3cml0ZWZkcyk7Ci0gICAgICAgIG4gPSB2ZGFnZW50X3ZpcnRpb19wb3J0
X2ZpbGxfZmRzKHZpcnRpb19wb3J0LCAmcmVhZGZkcywgJndyaXRlZmRzKTsKLSAgICAgICAgaWYg
KG4gPj0gbmZkcykKLSAgICAgICAgICAgIG5mZHMgPSBuICsgMTsKLQotICAgICAgICBpZiAoc2Vz
c2lvbl9pbmZvKSB7Ci0gICAgICAgICAgICBja19mZCA9IHNlc3Npb25faW5mb19nZXRfZmQoc2Vz
c2lvbl9pbmZvKTsKLSAgICAgICAgICAgIEZEX1NFVChja19mZCwgJnJlYWRmZHMpOwotICAgICAg
ICAgICAgaWYgKGNrX2ZkID49IG5mZHMpCi0gICAgICAgICAgICAgICAgbmZkcyA9IGNrX2ZkICsg
MTsKLSAgICAgICAgfQotCi0gICAgICAgIG4gPSBzZWxlY3QobmZkcywgJnJlYWRmZHMsICZ3cml0
ZWZkcywgTlVMTCwgTlVMTCk7Ci0gICAgICAgIGlmIChuID09IC0xKSB7Ci0gICAgICAgICAgICBp
ZiAoZXJybm8gPT0gRUlOVFIpCi0gICAgICAgICAgICAgICAgY29udGludWU7Ci0gICAgICAgICAg
ICBzeXNsb2coTE9HX0NSSVQsICJGYXRhbCBlcnJvciBzZWxlY3Q6ICVtIik7Ci0gICAgICAgICAg
ICByZXR2YWwgPSAxOwotICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgIH0KLQotICAgICAgICB1
ZHNjc19zZXJ2ZXJfaGFuZGxlX2ZkcyhzZXJ2ZXIsICZyZWFkZmRzLCAmd3JpdGVmZHMpOwotCi0g
ICAgICAgIGlmICh2aXJ0aW9fcG9ydCkgewotICAgICAgICAgICAgb25jZSA9IDE7Ci0gICAgICAg
ICAgICB2ZGFnZW50X3ZpcnRpb19wb3J0X2hhbmRsZV9mZHMoJnZpcnRpb19wb3J0LCAmcmVhZGZk
cywgJndyaXRlZmRzKTsKLSAgICAgICAgICAgIGlmICghdmlydGlvX3BvcnQpIHsKLSAgICAgICAg
ICAgICAgICBpbnQgb2xkX2NsaWVudF9jb25uZWN0ZWQgPSBjbGllbnRfY29ubmVjdGVkOwotICAg
ICAgICAgICAgICAgIHN5c2xvZyhMT0dfQ1JJVCwKLSAgICAgICAgICAgICAgICAgICAgICAgIkFJ
SUVFRSBsb3N0IHNwaWNlIGNsaWVudCBjb25uZWN0aW9uLCByZWNvbm5lY3RpbmciKTsKLSAgICAg
ICAgICAgICAgICB2aXJ0aW9fcG9ydCA9IHZkYWdlbnRfdmlydGlvX3BvcnRfY3JlYXRlKHBvcnRk
ZXYsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHZpcnRpb19wb3J0X3JlYWRfY29tcGxldGUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIE5VTEwpOwotICAgICAgICAgICAgICAgIGlmICghdmly
dGlvX3BvcnQpIHsKLSAgICAgICAgICAgICAgICAgICAgc3lzbG9nKExPR19DUklULAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIkZhdGFsIGVycm9yIG9wZW5pbmcgdmRhZ2VudCB2aXJ0aW8g
Y2hhbm5lbCIpOwotICAgICAgICAgICAgICAgICAgICByZXR2YWwgPSAxOwotICAgICAgICAgICAg
ICAgICAgICBicmVhazsKLSAgICAgICAgICAgICAgICB9Ci0gICAgICAgICAgICAgICAgZG9fY2xp
ZW50X2Rpc2Nvbm5lY3QoKTsKLSAgICAgICAgICAgICAgICBjbGllbnRfY29ubmVjdGVkID0gb2xk
X2NsaWVudF9jb25uZWN0ZWQ7Ci0gICAgICAgICAgICB9Ci0gICAgICAgIH0KLSAgICAgICAgZWxz
ZSBpZiAob25seV9vbmNlICYmIG9uY2UpCi0gICAgICAgIHsKLSAgICAgICAgICAgIHN5c2xvZyhM
T0dfSU5GTywgIkV4aXRpbmcgYWZ0ZXIgb25lIGNsaWVudCBzZXNzaW9uLiIpOwotICAgICAgICAg
ICAgYnJlYWs7Ci0gICAgICAgIH0KLQotICAgICAgICBpZiAoc2Vzc2lvbl9pbmZvICYmIEZEX0lT
U0VUKGNrX2ZkLCAmcmVhZGZkcykpIHsKLSAgICAgICAgICAgIGFjdGl2ZV9zZXNzaW9uID0gc2Vz
c2lvbl9pbmZvX2dldF9hY3RpdmVfc2Vzc2lvbihzZXNzaW9uX2luZm8pOwotICAgICAgICAgICAg
dXBkYXRlX2FjdGl2ZV9zZXNzaW9uX2Nvbm5lY3Rpb24oTlVMTCk7Ci0gICAgICAgIH0KLSAgICB9
Ci19Ci0KLXN0YXRpYyB2b2lkIHF1aXRfaGFuZGxlcihpbnQgc2lnKQorc3RhdGljIGdib29sZWFu
IHNpZ25hbF9oYW5kbGVyKGdwb2ludGVyIHVzZXJfZGF0YSkKIHsKLSAgICBxdWl0ID0gMTsKKyAg
ICB2ZGFnZW50ZF9xdWl0KDApOworICAgIHJldHVybiBHX1NPVVJDRV9SRU1PVkU7CiB9CiAKIHN0
YXRpYyBnYm9vbGVhbiBwYXJzZV9kZWJ1Z19sZXZlbF9jYihjb25zdCBnY2hhciAqb3B0aW9uX25h
bWUsCkBAIC0xMTMzLDggKzExMTgsOSBAQCBpbnQgbWFpbihpbnQgYXJnYywgY2hhciAqYXJndltd
KQogewogICAgIEdPcHRpb25Db250ZXh0ICpjb250ZXh0OwogICAgIEdFcnJvciAqZXJyID0gTlVM
TDsKLSAgICBzdHJ1Y3Qgc2lnYWN0aW9uIGFjdDsKICAgICBnYm9vbGVhbiBvd25fc29ja2V0ID0g
VFJVRTsKKyAgICBHSU9DaGFubmVsICpzaV9pb19jaGFubmVsID0gTlVMTDsKKyAgICBndWludCBz
aV93YXRjaF9pZCA9IDA7CiAKICAgICBjb250ZXh0ID0gZ19vcHRpb25fY29udGV4dF9uZXcoTlVM
TCk7CiAgICAgZ19vcHRpb25fY29udGV4dF9hZGRfbWFpbl9lbnRyaWVzKGNvbnRleHQsIGNtZF9l
bnRyaWVzLCBOVUxMKTsKQEAgLTExNTksMTMgKzExNDUsOSBAQCBpbnQgbWFpbihpbnQgYXJnYywg
Y2hhciAqYXJndltdKQogICAgICAgICB1aW5wdXRfZGV2aWNlID0gZ19zdHJkdXAoREVGQVVMVF9V
SU5QVVRfREVWSUNFKTsKICAgICB9CiAKLSAgICBtZW1zZXQoJmFjdCwgMCwgc2l6ZW9mKGFjdCkp
OwotICAgIGFjdC5zYV9mbGFncyA9IFNBX1JFU1RBUlQ7Ci0gICAgYWN0LnNhX2hhbmRsZXIgPSBx
dWl0X2hhbmRsZXI7Ci0gICAgc2lnYWN0aW9uKFNJR0lOVCwgJmFjdCwgTlVMTCk7Ci0gICAgc2ln
YWN0aW9uKFNJR0hVUCwgJmFjdCwgTlVMTCk7Ci0gICAgc2lnYWN0aW9uKFNJR1RFUk0sICZhY3Qs
IE5VTEwpOwotICAgIHNpZ2FjdGlvbihTSUdRVUlULCAmYWN0LCBOVUxMKTsKKyAgICBnX3VuaXhf
c2lnbmFsX2FkZChTSUdJTlQsIHNpZ25hbF9oYW5kbGVyLCBOVUxMKTsKKyAgICBnX3VuaXhfc2ln
bmFsX2FkZChTSUdIVVAsIHNpZ25hbF9oYW5kbGVyLCBOVUxMKTsKKyAgICBnX3VuaXhfc2lnbmFs
X2FkZChTSUdURVJNLCBzaWduYWxfaGFuZGxlciwgTlVMTCk7CiAKICAgICBvcGVubG9nKCJzcGlj
ZS12ZGFnZW50ZCIsIGRvX2RhZW1vbml6ZSA/IDAgOiBMT0dfUEVSUk9SLCBMT0dfVVNFUik7CiAK
QEAgLTExOTcsNyArMTE3OSw3IEBAIGludCBtYWluKGludCBhcmdjLCBjaGFyICphcmd2W10pCiAg
ICAgICAgICAgICBzeXNsb2coTE9HX0NSSVQsICJGYXRhbCB0aGUgc2VydmVyIHNvY2tldCAlcyBl
eGlzdHMgYWxyZWFkeS4gRGVsZXRlIGl0PyIsCiAgICAgICAgICAgICAgICAgICAgdmRhZ2VudGRf
c29ja2V0KTsKICAgICAgICAgfSBlbHNlIHsKLSAgICAgICAgICAgIHN5c2xvZyhMT0dfQ1JJVCwg
IkZhdGFsIGNvdWxkIG5vdCBjcmVhdGUgdGhlIHNlcnZlciBzb2NrZXQgJXM6ICVtIiwKKyAgICAg
ICAgICAgIHN5c2xvZyhMT0dfQ1JJVCwgIkZhdGFsIGNvdWxkIG5vdCBjcmVhdGUgdGhlIHNlcnZl
ciBzb2NrZXQgJXMiLAogICAgICAgICAgICAgICAgICAgIHZkYWdlbnRkX3NvY2tldCk7CiAgICAg
ICAgIH0KICAgICAgICAgcmV0dXJuIDE7CkBAIC0xMjI3LDE5ICsxMjA5LDM1IEBAIGludCBtYWlu
KGludCBhcmdjLCBjaGFyICphcmd2W10pCiAKICAgICBpZiAod2FudF9zZXNzaW9uX2luZm8pCiAg
ICAgICAgIHNlc3Npb25faW5mbyA9IHNlc3Npb25faW5mb19jcmVhdGUoZGVidWcpOwotICAgIGlm
ICghc2Vzc2lvbl9pbmZvKQorICAgIGlmIChzZXNzaW9uX2luZm8pIHsKKyAgICAgICAgc2lfaW9f
Y2hhbm5lbCA9IGdfaW9fY2hhbm5lbF91bml4X25ldyhzZXNzaW9uX2luZm9fZ2V0X2ZkKHNlc3Np
b25faW5mbykpOworICAgICAgICBzaV93YXRjaF9pZCA9IGdfaW9fYWRkX3dhdGNoKHNpX2lvX2No
YW5uZWwsIEdfSU9fSU4sIHNpX2lvX2NoYW5uZWxfY2IsIE5VTEwpOworICAgICAgICBnX2lvX2No
YW5uZWxfdW5yZWYoc2lfaW9fY2hhbm5lbCk7CisgICAgfSBlbHNlCiAgICAgICAgIHN5c2xvZyhM
T0dfV0FSTklORywgIm5vIHNlc3Npb24gaW5mbywgbWF4IDEgc2Vzc2lvbiBhZ2VudCBhbGxvd2Vk
Iik7CiAKICAgICBhY3RpdmVfeGZlcnMgPSBnX2hhc2hfdGFibGVfbmV3KGdfZGlyZWN0X2hhc2gs
IGdfZGlyZWN0X2VxdWFsKTsKLSAgICBtYWluX2xvb3AoKTsKKworICAgIGxvb3AgPSBnX21haW5f
bG9vcF9uZXcoTlVMTCwgRkFMU0UpOworICAgIGdfbWFpbl9sb29wX3J1bihsb29wKTsKIAogICAg
IHJlbGVhc2VfY2xpcGJvYXJkcygpOwogCiAgICAgdmRhZ2VudGRfdWlucHV0X2Rlc3Ryb3koJnVp
bnB1dCk7Ci0gICAgdmRhZ2VudF92aXJ0aW9fcG9ydF9mbHVzaCgmdmlydGlvX3BvcnQpOwotICAg
IHZkYWdlbnRfdmlydGlvX3BvcnRfZGVzdHJveSgmdmlydGlvX3BvcnQpOwotICAgIHNlc3Npb25f
aW5mb19kZXN0cm95KHNlc3Npb25faW5mbyk7Ci0gICAgdWRzY3NfZGVzdHJveV9zZXJ2ZXIoc2Vy
dmVyKTsKKyAgICBpZiAoc2lfd2F0Y2hfaWQgPiAwKSB7CisgICAgICAgIGdfc291cmNlX3JlbW92
ZShzaV93YXRjaF9pZCk7CisgICAgfQorICAgIGdfY2xlYXJfcG9pbnRlcigmc2Vzc2lvbl9pbmZv
LCBzZXNzaW9uX2luZm9fZGVzdHJveSk7CisgICAgZ19jbGVhcl9wb2ludGVyKCZzZXJ2ZXIsIHVk
c2NzX2Rlc3Ryb3lfc2VydmVyKTsKKyAgICBpZiAodmlydGlvX3BvcnQpIHsKKyAgICAgICAgdmRh
Z2VudF9jb25uZWN0aW9uX2ZsdXNoKFZEQUdFTlRfQ09OTkVDVElPTih2aXJ0aW9fcG9ydCkpOwor
ICAgICAgICBnX2NsZWFyX3BvaW50ZXIoJnZpcnRpb19wb3J0LCB2ZGFnZW50X2Nvbm5lY3Rpb25f
ZGVzdHJveSk7CisgICAgfQorCisgICAgLyogYWxsb3cgdGhlIFZEQWdlbnRDb25uZWN0aW9uKHMp
IHRvIGZpbmFsaXplIHByb3Blcmx5ICovCisgICAgZ19tYWluX2NvbnRleHRfaXRlcmF0aW9uKE5V
TEwsIEZBTFNFKTsKKworICAgIGdfbWFpbl9sb29wX3VucmVmKGxvb3ApOwogCiAgICAgLyogbGVh
dmUgdGhlIHNvY2tldCBhcm91bmQgaWYgaXQgd2FzIHByb3ZpZGVkIGJ5IHN5c3RlbWQgKi8KICAg
ICBpZiAob3duX3NvY2tldCkgewpkaWZmIC0tZ2l0IGEvc3JjL3ZkYWdlbnRkL3ZpcnRpby1wb3J0
LmMgYi9zcmMvdmRhZ2VudGQvdmlydGlvLXBvcnQuYwppbmRleCBiMDU1NmNlLi5hZDlkMjdiIDEw
MDY0NAotLS0gYS9zcmMvdmRhZ2VudGQvdmlydGlvLXBvcnQuYworKysgYi9zcmMvdmRhZ2VudGQv
dmlydGlvLXBvcnQuYwpAQCAtMjAsMjcgKzIwLDIwIEBACiAqLwogI2luY2x1ZGUgPGNvbmZpZy5o
PgogCi0jaW5jbHVkZSA8ZXJybm8uaD4KICNpbmNsdWRlIDxzdGRsaWIuaD4KICNpbmNsdWRlIDxz
dHJpbmcuaD4KICNpbmNsdWRlIDxzeXNsb2cuaD4KLSNpbmNsdWRlIDx1bmlzdGQuaD4KLSNpbmNs
dWRlIDxmY250bC5oPgotI2luY2x1ZGUgPHN5cy9zZWxlY3QuaD4KLSNpbmNsdWRlIDxzeXMvc29j
a2V0Lmg+Ci0jaW5jbHVkZSA8c3lzL3VuLmg+Ci0jaW5jbHVkZSA8Z2xpYi5oPgorI2luY2x1ZGUg
PGdpby9naW8uaD4KKyNpbmNsdWRlIDxnbGliLXVuaXguaD4KIAorI2luY2x1ZGUgInZkYWdlbnQt
Y29ubmVjdGlvbi5oIgogI2luY2x1ZGUgInZpcnRpby1wb3J0LmgiCiAKIAogc3RydWN0IHZkYWdl
bnRfdmlydGlvX3BvcnRfYnVmIHsKICAgICB1aW50OF90ICpidWY7Ci0gICAgc2l6ZV90IHBvczsK
ICAgICBzaXplX3Qgc2l6ZTsKICAgICBzaXplX3Qgd3JpdGVfcG9zOwotCi0gICAgc3RydWN0IHZk
YWdlbnRfdmlydGlvX3BvcnRfYnVmICpuZXh0OwogfTsKIAogLyogRGF0YSB0byBrZWVwIHRyYWNr
IG9mIHRoZSBhc3NlbWJsaW5nIG9mIHZkYWdlbnQgbWVzc2FnZXMgcGVyIGNodW5rIHBvcnQsCkBA
IC01MywxNDEgKzQ2LDEzMSBAQCBzdHJ1Y3QgdmRhZ2VudF92aXJ0aW9fcG9ydF9jaHVua19wb3J0
X2RhdGEgewogfTsKIAogc3RydWN0IHZkYWdlbnRfdmlydGlvX3BvcnQgewotICAgIGludCBmZDsK
LSAgICBpbnQgb3BlbmluZzsKLSAgICBpbnQgaXNfdWRzOwotCi0gICAgLyogQ2h1bmsgcmVhZCBz
dHVmZiwgc2luZ2xlIGJ1ZmZlciwgc2VwYXJhdGUgaGVhZGVyIGFuZCBkYXRhIGJ1ZmZlciAqLwot
ICAgIGludCBjaHVua19oZWFkZXJfcmVhZDsKLSAgICBpbnQgY2h1bmtfZGF0YV9wb3M7Ci0gICAg
VkRJQ2h1bmtIZWFkZXIgY2h1bmtfaGVhZGVyOwotICAgIHVpbnQ4X3QgY2h1bmtfZGF0YVtWRF9B
R0VOVF9NQVhfREFUQV9TSVpFXTsKKyAgICBWREFnZW50Q29ubmVjdGlvbiBwYXJlbnRfaW5zdGFu
Y2U7CiAKICAgICAvKiBQZXIgY2h1bmsgcG9ydCBkYXRhICovCiAgICAgc3RydWN0IHZkYWdlbnRf
dmlydGlvX3BvcnRfY2h1bmtfcG9ydF9kYXRhIHBvcnRfZGF0YVtWRFBfRU5EX1BPUlRdOwogCi0g
ICAgLyogV3JpdGVzIGFyZSBzdG9yZWQgaW4gYSBsaW5rZWQgbGlzdCBvZiBidWZmZXJzLCB3aXRo
IGJvdGggdGhlIGhlYWRlcgotICAgICAgICsgZGF0YSBmb3IgYSBzaW5nbGUgbWVzc2FnZSBpbiAx
IGJ1ZmZlci4gKi8KLSAgICBzdHJ1Y3QgdmRhZ2VudF92aXJ0aW9fcG9ydF9idWYgKndyaXRlX2J1
ZjsKKyAgICBzdHJ1Y3QgdmRhZ2VudF92aXJ0aW9fcG9ydF9idWYgd3JpdGVfYnVmOwogCiAgICAg
LyogQ2FsbGJhY2tzICovCiAgICAgdmRhZ2VudF92aXJ0aW9fcG9ydF9yZWFkX2NhbGxiYWNrIHJl
YWRfY2FsbGJhY2s7Ci0gICAgdmRhZ2VudF92aXJ0aW9fcG9ydF9kaXNjb25uZWN0X2NhbGxiYWNr
IGRpc2Nvbm5lY3RfY2FsbGJhY2s7CisgICAgVkRBZ2VudENvbm5FcnJvckNiIGVycm9yX2NiOwog
fTsKIAotc3RhdGljIHZvaWQgdmRhZ2VudF92aXJ0aW9fcG9ydF9kb193cml0ZShzdHJ1Y3QgdmRh
Z2VudF92aXJ0aW9fcG9ydCAqKnZwb3J0cCk7Ci1zdGF0aWMgdm9pZCB2ZGFnZW50X3ZpcnRpb19w
b3J0X2RvX3JlYWQoc3RydWN0IHZkYWdlbnRfdmlydGlvX3BvcnQgKip2cG9ydHApOworR19ERUZJ
TkVfVFlQRShWaXJ0aW9Qb3J0LCB2aXJ0aW9fcG9ydCwgVkRBR0VOVF9UWVBFX0NPTk5FQ1RJT04p
OwogCi1zdHJ1Y3QgdmRhZ2VudF92aXJ0aW9fcG9ydCAqdmRhZ2VudF92aXJ0aW9fcG9ydF9jcmVh
dGUoY29uc3QgY2hhciAqcG9ydG5hbWUsCi0gICAgdmRhZ2VudF92aXJ0aW9fcG9ydF9yZWFkX2Nh
bGxiYWNrIHJlYWRfY2FsbGJhY2ssCi0gICAgdmRhZ2VudF92aXJ0aW9fcG9ydF9kaXNjb25uZWN0
X2NhbGxiYWNrIGRpc2Nvbm5lY3RfY2FsbGJhY2spCi17Ci0gICAgc3RydWN0IHZkYWdlbnRfdmly
dGlvX3BvcnQgKnZwb3J0OwotICAgIHN0cnVjdCBzb2NrYWRkcl91biBhZGRyZXNzOwotICAgIGlu
dCBjOworc3RhdGljIHZvaWQgdmRhZ2VudF92aXJ0aW9fcG9ydF9kb19jaHVuayhWREFnZW50Q29u
bmVjdGlvbiAqY29ubiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Z3BvaW50ZXIgaGVhZGVyX2RhdGEsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGdwb2ludGVyIGNodW5rX2RhdGEpOwogCi0gICAgdnBvcnQgPSBnX25ldzAoc3RydWN0
IHZkYWdlbnRfdmlydGlvX3BvcnQsIDEpOwotCi0gICAgdnBvcnQtPmZkID0gb3Blbihwb3J0bmFt
ZSwgT19SRFdSKTsKLSAgICBpZiAodnBvcnQtPmZkID09IC0xKSB7Ci0gICAgICAgIHZwb3J0LT5m
ZCA9IHNvY2tldChQRl9VTklYLCBTT0NLX1NUUkVBTSwgMCk7Ci0gICAgICAgIGlmICh2cG9ydC0+
ZmQgPT0gLTEpIHsKLSAgICAgICAgICAgIGdvdG8gZXJyb3I7Ci0gICAgICAgIH0KLSAgICAgICAg
YWRkcmVzcy5zdW5fZmFtaWx5ID0gQUZfVU5JWDsKLSAgICAgICAgc25wcmludGYoYWRkcmVzcy5z
dW5fcGF0aCwgc2l6ZW9mKGFkZHJlc3Muc3VuX3BhdGgpLCAiJXMiLCBwb3J0bmFtZSk7Ci0gICAg
ICAgIGMgPSBjb25uZWN0KHZwb3J0LT5mZCwgKHN0cnVjdCBzb2NrYWRkciAqKSZhZGRyZXNzLCBz
aXplb2YoYWRkcmVzcykpOwotICAgICAgICBpZiAoYyA9PSAwKSB7Ci0gICAgICAgICAgICB2cG9y
dC0+aXNfdWRzID0gMTsKLSAgICAgICAgfSBlbHNlIHsKLSAgICAgICAgICAgIGdvdG8gZXJyb3I7
Ci0gICAgICAgIH0KLSAgICB9IGVsc2UgewotICAgICAgICB2cG9ydC0+aXNfdWRzID0gMDsKK3N0
YXRpYyBnc2l6ZSBjb25uX2hhbmRsZV9oZWFkZXIoVkRBZ2VudENvbm5lY3Rpb24gKmNvbm4sCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdwb2ludGVyIGhlYWRlcl9idWYpCit7Cisg
ICAgVmlydGlvUG9ydCAqc2VsZiA9IFZJUlRJT19QT1JUKGNvbm4pOworICAgIFZESUNodW5rSGVh
ZGVyICpoZWFkZXIgPSBoZWFkZXJfYnVmOworICAgIEdFcnJvciAqZXJyOworCisgICAgaGVhZGVy
LT5zaXplID0gR1VJTlQzMl9GUk9NX0xFKGhlYWRlci0+c2l6ZSk7CisgICAgaGVhZGVyLT5wb3J0
ID0gR1VJTlQzMl9GUk9NX0xFKGhlYWRlci0+cG9ydCk7CisKKyAgICBpZiAoaGVhZGVyLT5zaXpl
ID4gVkRfQUdFTlRfTUFYX0RBVEFfU0laRSkgeworICAgICAgICBlcnIgPSBnX2Vycm9yX25ldyhH
X0lPX0VSUk9SLCBHX0lPX0VSUk9SX0ZBSUxFRCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ImNodW5rIHNpemUgJXUgdG9vIGxhcmdlIiwgaGVhZGVyLT5zaXplKTsKKyAgICAgICAgc2VsZi0+
ZXJyb3JfY2IoY29ubiwgZXJyKTsKKyAgICAgICAgcmV0dXJuIDA7CiAgICAgfQotICAgIHZwb3J0
LT5vcGVuaW5nID0gMTsKLQotICAgIHZwb3J0LT5yZWFkX2NhbGxiYWNrID0gcmVhZF9jYWxsYmFj
azsKLSAgICB2cG9ydC0+ZGlzY29ubmVjdF9jYWxsYmFjayA9IGRpc2Nvbm5lY3RfY2FsbGJhY2s7
Ci0KLSAgICByZXR1cm4gdnBvcnQ7Ci0KLWVycm9yOgotICAgIHN5c2xvZyhMT0dfRVJSLCAib3Bl
biAlczogJW0iLCBwb3J0bmFtZSk7Ci0gICAgaWYgKHZwb3J0LT5mZCAhPSAtMSkgewotICAgICAg
ICBjbG9zZSh2cG9ydC0+ZmQpOworICAgIGlmIChoZWFkZXItPnBvcnQgPj0gVkRQX0VORF9QT1JU
KSB7CisgICAgICAgIGVyciA9IGdfZXJyb3JfbmV3KEdfSU9fRVJST1IsIEdfSU9fRVJST1JfRkFJ
TEVELAorICAgICAgICAgICAgICAgICAgICAgICAgICAiY2h1bmsgcG9ydCAldSBvdXQgb2YgcmFu
Z2UiLCBoZWFkZXItPnBvcnQpOworICAgICAgICBzZWxmLT5lcnJvcl9jYihjb25uLCBlcnIpOwor
ICAgICAgICByZXR1cm4gMDsKICAgICB9Ci0gICAgZ19mcmVlKHZwb3J0KTsKLSAgICByZXR1cm4g
TlVMTDsKKworICAgIHJldHVybiBoZWFkZXItPnNpemU7CiB9CiAKLXZvaWQgdmRhZ2VudF92aXJ0
aW9fcG9ydF9kZXN0cm95KHN0cnVjdCB2ZGFnZW50X3ZpcnRpb19wb3J0ICoqdnBvcnRwKQorc3Rh
dGljIHZvaWQgdmlydGlvX3BvcnRfaW5pdChWaXJ0aW9Qb3J0ICpzZWxmKQogewotICAgIHN0cnVj
dCB2ZGFnZW50X3ZpcnRpb19wb3J0X2J1ZiAqd2J1ZiwgKm5leHRfd2J1ZjsKLSAgICBzdHJ1Y3Qg
dmRhZ2VudF92aXJ0aW9fcG9ydCAqdnBvcnQgPSAqdnBvcnRwOwotICAgIGludCBpOwotCi0gICAg
aWYgKCF2cG9ydCkKLSAgICAgICAgcmV0dXJuOworfQogCi0gICAgaWYgKHZwb3J0LT5kaXNjb25u
ZWN0X2NhbGxiYWNrKQotICAgICAgICB2cG9ydC0+ZGlzY29ubmVjdF9jYWxsYmFjayh2cG9ydCk7
CitzdGF0aWMgdm9pZCB2aXJ0aW9fcG9ydF9maW5hbGl6ZShHT2JqZWN0ICpvYmopCit7CisgICAg
VmlydGlvUG9ydCAqc2VsZiA9IFZJUlRJT19QT1JUKG9iaik7CisgICAgZ3VpbnQgaTsKIAotICAg
IHdidWYgPSB2cG9ydC0+d3JpdGVfYnVmOwotICAgIHdoaWxlICh3YnVmKSB7Ci0gICAgICAgIG5l
eHRfd2J1ZiA9IHdidWYtPm5leHQ7Ci0gICAgICAgIGdfZnJlZSh3YnVmLT5idWYpOwotICAgICAg
ICBnX2ZyZWUod2J1Zik7Ci0gICAgICAgIHdidWYgPSBuZXh0X3didWY7Ci0gICAgfQorICAgIGdf
ZnJlZShzZWxmLT53cml0ZV9idWYuYnVmKTsKIAogICAgIGZvciAoaSA9IDA7IGkgPCBWRFBfRU5E
X1BPUlQ7IGkrKykgewotICAgICAgICBnX2ZyZWUodnBvcnQtPnBvcnRfZGF0YVtpXS5tZXNzYWdl
X2RhdGEpOworICAgICAgICBnX2ZyZWUoc2VsZi0+cG9ydF9kYXRhW2ldLm1lc3NhZ2VfZGF0YSk7
CiAgICAgfQogCi0gICAgY2xvc2UodnBvcnQtPmZkKTsKLSAgICBnX2NsZWFyX3BvaW50ZXIodnBv
cnRwLCBnX2ZyZWUpOworICAgIEdfT0JKRUNUX0NMQVNTKHZpcnRpb19wb3J0X3BhcmVudF9jbGFz
cyktPmZpbmFsaXplKG9iaik7CiB9CiAKLWludCB2ZGFnZW50X3ZpcnRpb19wb3J0X2ZpbGxfZmRz
KHN0cnVjdCB2ZGFnZW50X3ZpcnRpb19wb3J0ICp2cG9ydCwKLSAgICAgICAgZmRfc2V0ICpyZWFk
ZmRzLCBmZF9zZXQgKndyaXRlZmRzKQorc3RhdGljIHZvaWQgdmlydGlvX3BvcnRfY2xhc3NfaW5p
dChWaXJ0aW9Qb3J0Q2xhc3MgKmtsYXNzKQogewotICAgIGlmICghdnBvcnQpCi0gICAgICAgIHJl
dHVybiAtMTsKKyAgICBHT2JqZWN0Q2xhc3MgKmdvYmplY3RfY2xhc3MgPSBHX09CSkVDVF9DTEFT
UyhrbGFzcyk7CisgICAgVkRBZ2VudENvbm5lY3Rpb25DbGFzcyAqY29ubl9jbGFzcyA9IFZEQUdF
TlRfQ09OTkVDVElPTl9DTEFTUyhrbGFzcyk7CiAKLSAgICBGRF9TRVQodnBvcnQtPmZkLCByZWFk
ZmRzKTsKLSAgICBpZiAodnBvcnQtPndyaXRlX2J1ZikKLSAgICAgICAgRkRfU0VUKHZwb3J0LT5m
ZCwgd3JpdGVmZHMpOworICAgIGdvYmplY3RfY2xhc3MtPmZpbmFsaXplICA9IHZpcnRpb19wb3J0
X2ZpbmFsaXplOwogCi0gICAgcmV0dXJuIHZwb3J0LT5mZCArIDE7CisgICAgY29ubl9jbGFzcy0+
aGFuZGxlX2hlYWRlciA9IGNvbm5faGFuZGxlX2hlYWRlcjsKKyAgICBjb25uX2NsYXNzLT5oYW5k
bGVfbWVzc2FnZSA9IHZkYWdlbnRfdmlydGlvX3BvcnRfZG9fY2h1bms7CiB9CiAKLXZvaWQgdmRh
Z2VudF92aXJ0aW9fcG9ydF9oYW5kbGVfZmRzKHN0cnVjdCB2ZGFnZW50X3ZpcnRpb19wb3J0ICoq
dnBvcnRwLAotICAgICAgICBmZF9zZXQgKnJlYWRmZHMsIGZkX3NldCAqd3JpdGVmZHMpCi17Ci0g
ICAgaWYgKCEqdnBvcnRwKQotICAgICAgICByZXR1cm47Ci0KLSAgICBpZiAoRkRfSVNTRVQoKCp2
cG9ydHApLT5mZCwgcmVhZGZkcykpCi0gICAgICAgIHZkYWdlbnRfdmlydGlvX3BvcnRfZG9fcmVh
ZCh2cG9ydHApOwotCi0gICAgaWYgKCp2cG9ydHAgJiYgRkRfSVNTRVQoKCp2cG9ydHApLT5mZCwg
d3JpdGVmZHMpKQotICAgICAgICB2ZGFnZW50X3ZpcnRpb19wb3J0X2RvX3dyaXRlKHZwb3J0cCk7
Ci19Ci0KLXN0YXRpYyBzdHJ1Y3QgdmRhZ2VudF92aXJ0aW9fcG9ydF9idWYqIHZkYWdlbnRfdmly
dGlvX3BvcnRfZ2V0X2xhc3Rfd2J1ZigKLSAgICBzdHJ1Y3QgdmRhZ2VudF92aXJ0aW9fcG9ydCAq
dnBvcnQpCitzdHJ1Y3QgdmRhZ2VudF92aXJ0aW9fcG9ydCAqdmRhZ2VudF92aXJ0aW9fcG9ydF9j
cmVhdGUoY29uc3QgY2hhciAqcG9ydG5hbWUsCisgICAgdmRhZ2VudF92aXJ0aW9fcG9ydF9yZWFk
X2NhbGxiYWNrIHJlYWRfY2FsbGJhY2ssCisgICAgVkRBZ2VudENvbm5FcnJvckNiIGVycm9yX2Ni
KQogewotICAgIHN0cnVjdCB2ZGFnZW50X3ZpcnRpb19wb3J0X2J1ZiAqd2J1ZjsKKyAgICBzdHJ1
Y3QgdmRhZ2VudF92aXJ0aW9fcG9ydCAqdnBvcnQ7CisgICAgR0lPU3RyZWFtICppb19zdHJlYW07
CisgICAgR0Vycm9yICplcnIgPSBOVUxMOworCisgICAgaW9fc3RyZWFtID0gdmRhZ2VudF9maWxl
X29wZW4ocG9ydG5hbWUsICZlcnIpOworICAgIGlmIChlcnIpIHsKKyAgICAgICAgc3lzbG9nKExP
R19FUlIsICIlczogJXMiLCBfX2Z1bmNfXywgZXJyLT5tZXNzYWdlKTsKKyAgICAgICAgZ19jbGVh
cl9lcnJvcigmZXJyKTsKKyAgICAgICAgaW9fc3RyZWFtID0gdmRhZ2VudF9zb2NrZXRfY29ubmVj
dChwb3J0bmFtZSwgJmVycik7CisgICAgICAgIGlmIChlcnIpIHsKKyAgICAgICAgICAgIHN5c2xv
ZyhMT0dfRVJSLCAiJXM6ICVzIiwgX19mdW5jX18sIGVyci0+bWVzc2FnZSk7CisgICAgICAgICAg
ICBnX2Vycm9yX2ZyZWUoZXJyKTsKKyAgICAgICAgICAgIHJldHVybiBOVUxMOworICAgICAgICB9
CisgICAgfQogCi0gICAgd2J1ZiA9IHZwb3J0LT53cml0ZV9idWY7Ci0gICAgaWYgKCF3YnVmKQot
ICAgICAgICByZXR1cm4gTlVMTDsKKyAgICB2cG9ydCA9IGdfb2JqZWN0X25ldyhWSVJUSU9fVFlQ
RV9QT1JULCBOVUxMKTsKKworICAgIC8qIFdoZW4gY2FsbGluZyB2ZGFnZW50X2Nvbm5lY3Rpb25f
bmV3KCksCisgICAgICogQHdhaXRfb25fb3BlbmluZyBNVVNUIGJlIHNldCB0byBUUlVFOgorICAg
ICAqCisgICAgICogV2hlbiB3ZSBvcGVuIHRoZSB2aXJ0aW8gc2VyaWFsIHBvcnQsIHRoZSBmb2xs
b3dpbmcgaGFwcGVuczoKKyAgICAgKiAxKSBUaGUgbGludXgga2VybmVsIHZpcnRpb19jb25zb2xl
IGRyaXZlciBzZW5kcyBhCisgICAgICogICAgVklSVElPX0NPTlNPTEVfUE9SVF9PUEVOIG1lc3Nh
Z2UgdG8gcWVtdQorICAgICAqIDIpIHFlbXUncyBzcGljZXZtYyBjaGFyZGV2IGRyaXZlciBjYWxs
cyBxZW11X3NwaWNlX2FkZF9pbnRlcmZhY2UgdG8KKyAgICAgKiAgICByZWdpc3RlciB0aGUgYWdl
bnQgY2hhcmRldiB3aXRoIHRoZSBzcGljZS1zZXJ2ZXIKKyAgICAgKiAzKSBzcGljZS1zZXJ2ZXIg
dGhlbiBjYWxscyB0aGUgc3BpY2V2bWMgY2hhcmRldiBkcml2ZXIncyBzdGF0ZQorICAgICAqICAg
IGNhbGxiYWNrIHRvIGxldCBpdCBrbm93IGl0IGlzIHJlYWR5IHRvIHJlY2VpdmUgZGF0YQorICAg
ICAqIDQpIFRoZSBzdGF0ZSBjYWxsYmFjayBzZW5kcyBhIENIUl9FVkVOVF9PUEVORUQgdG8gdGhl
IHZpcnRpby1jb25zb2xlCisgICAgICogICAgY2hhcmRldiBiYWNrZW5kCisgICAgICogNSkgVGhl
IHZpcnRpby1jb25zb2xlIGNoYXJkZXYgYmFja2VuZCBzZW5kcyBWSVJUSU9fQ09OU09MRV9QT1JU
X09QRU4KKyAgICAgKiAgICB0byB0aGUgbGludXgga2VybmVsIHZpcnRpb19jb25zb2xlIGRyaXZl
cgorICAgICAqCisgICAgICogVW50aWwgc3RlcHMgMSAtIDUgaGF2ZSBjb21wbGV0ZWQgdGhlIGxp
bnV4IGtlcm5lbCB2aXJ0aW9fY29uc29sZQorICAgICAqIGRyaXZlciBzZWVzIHRoZSB2aXJ0aW8g
c2VyaWFsIHBvcnQgYXMgYmVpbmcgaW4gYSBkaXNjb25uZWN0ZWQgc3RhdGUKKyAgICAgKiBhbmQg
cmVhZCB3aWxsIHJldHVybiAwICEgU28gaWYgd2UgYmxpbmRseSBhc3N1bWUgdGhhdCBhIHJlYWQg
MCBtZWFucworICAgICAqIHRoYXQgdGhlIGNoYW5uZWwgaXMgY2xvc2VkIHdlIHdpbGwgaGl0IGEg
cmFjZSBoZXJlLgorICAgICAqLworICAgIHZkYWdlbnRfY29ubmVjdGlvbl9zZXR1cChWREFHRU5U
X0NPTk5FQ1RJT04odnBvcnQpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpb19zdHJl
YW0sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRSVUUsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHNpemVvZihWRElDaHVua0hlYWRlciksCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGVycm9yX2NiKTsKIAotICAgIHdoaWxlICh3YnVmLT5uZXh0KQotICAgICAgICB3
YnVmID0gd2J1Zi0+bmV4dDsKKyAgICB2cG9ydC0+cmVhZF9jYWxsYmFjayA9IHJlYWRfY2FsbGJh
Y2s7CisgICAgdnBvcnQtPmVycm9yX2NiID0gZXJyb3JfY2I7CiAKLSAgICByZXR1cm4gd2J1ZjsK
KyAgICByZXR1cm4gdnBvcnQ7CiB9CiAKIHZvaWQgdmRhZ2VudF92aXJ0aW9fcG9ydF93cml0ZV9z
dGFydCgKQEAgLTE5NywxNSArMTgwLDE1IEBAIHZvaWQgdmRhZ2VudF92aXJ0aW9fcG9ydF93cml0
ZV9zdGFydCgKICAgICAgICAgdWludDMyX3QgbWVzc2FnZV9vcGFxdWUsCiAgICAgICAgIHVpbnQz
Ml90IGRhdGFfc2l6ZSkKIHsKLSAgICBzdHJ1Y3QgdmRhZ2VudF92aXJ0aW9fcG9ydF9idWYgKndi
dWYsICpuZXdfd2J1ZjsKKyAgICBzdHJ1Y3QgdmRhZ2VudF92aXJ0aW9fcG9ydF9idWYgKm5ld193
YnVmOwogICAgIFZESUNodW5rSGVhZGVyICpjaHVua19oZWFkZXI7CiAgICAgVkRBZ2VudE1lc3Nh
Z2UgKm1lc3NhZ2VfaGVhZGVyOwogCi0gICAgbmV3X3didWYgPSBnX25ldyhzdHJ1Y3QgdmRhZ2Vu
dF92aXJ0aW9fcG9ydF9idWYsIDEpOwotICAgIG5ld193YnVmLT5wb3MgPSAwOworICAgIGdfcmV0
dXJuX2lmX2ZhaWwodnBvcnQtPndyaXRlX2J1Zi5idWYgPT0gTlVMTCk7CisKKyAgICBuZXdfd2J1
ZiA9ICZ2cG9ydC0+d3JpdGVfYnVmOwogICAgIG5ld193YnVmLT53cml0ZV9wb3MgPSAwOwogICAg
IG5ld193YnVmLT5zaXplID0gc2l6ZW9mKCpjaHVua19oZWFkZXIpICsgc2l6ZW9mKCptZXNzYWdl
X2hlYWRlcikgKyBkYXRhX3NpemU7Ci0gICAgbmV3X3didWYtPm5leHQgPSBOVUxMOwogICAgIG5l
d193YnVmLT5idWYgPSBnX21hbGxvYyhuZXdfd2J1Zi0+c2l6ZSk7CiAKICAgICBjaHVua19oZWFk
ZXIgPSAoVkRJQ2h1bmtIZWFkZXIgKikgKG5ld193YnVmLT5idWYgKyBuZXdfd2J1Zi0+d3JpdGVf
cG9zKTsKQEAgLTIxOSwxNCArMjAyLDYgQEAgdm9pZCB2ZGFnZW50X3ZpcnRpb19wb3J0X3dyaXRl
X3N0YXJ0KAogICAgIG1lc3NhZ2VfaGVhZGVyLT5vcGFxdWUgPSBHVUlOVDY0X1RPX0xFKG1lc3Nh
Z2Vfb3BhcXVlKTsKICAgICBtZXNzYWdlX2hlYWRlci0+c2l6ZSA9IEdVSU5UMzJfVE9fTEUoZGF0
YV9zaXplKTsKICAgICBuZXdfd2J1Zi0+d3JpdGVfcG9zICs9IHNpemVvZigqbWVzc2FnZV9oZWFk
ZXIpOwotCi0gICAgaWYgKCF2cG9ydC0+d3JpdGVfYnVmKSB7Ci0gICAgICAgIHZwb3J0LT53cml0
ZV9idWYgPSBuZXdfd2J1ZjsKLSAgICAgICAgcmV0dXJuOwotICAgIH0KLQotICAgIHdidWYgPSB2
ZGFnZW50X3ZpcnRpb19wb3J0X2dldF9sYXN0X3didWYodnBvcnQpOwotICAgIHdidWYtPm5leHQg
PSBuZXdfd2J1ZjsKIH0KIAogaW50IHZkYWdlbnRfdmlydGlvX3BvcnRfd3JpdGVfYXBwZW5kKHN0
cnVjdCB2ZGFnZW50X3ZpcnRpb19wb3J0ICp2cG9ydCwKQEAgLTIzNCw4ICsyMDksMTEgQEAgaW50
IHZkYWdlbnRfdmlydGlvX3BvcnRfd3JpdGVfYXBwZW5kKHN0cnVjdCB2ZGFnZW50X3ZpcnRpb19w
b3J0ICp2cG9ydCwKIHsKICAgICBzdHJ1Y3QgdmRhZ2VudF92aXJ0aW9fcG9ydF9idWYgKndidWY7
CiAKLSAgICB3YnVmID0gdmRhZ2VudF92aXJ0aW9fcG9ydF9nZXRfbGFzdF93YnVmKHZwb3J0KTsK
LSAgICBpZiAoIXdidWYpIHsKKyAgICBpZiAoc2l6ZSA9PSAwKQorICAgICAgICByZXR1cm4gMDsK
KworICAgIHdidWYgPSAmdnBvcnQtPndyaXRlX2J1ZjsKKyAgICBpZiAoIXdidWYtPmJ1Zikgewog
ICAgICAgICBzeXNsb2coTE9HX0VSUiwgImNhbid0IGFwcGVuZCB3aXRob3V0IGEgYnVmZmVyIik7
CiAgICAgICAgIHJldHVybiAtMTsKICAgICB9CkBAIC0yNDcsNiArMjI1LDExIEBAIGludCB2ZGFn
ZW50X3ZpcnRpb19wb3J0X3dyaXRlX2FwcGVuZChzdHJ1Y3QgdmRhZ2VudF92aXJ0aW9fcG9ydCAq
dnBvcnQsCiAKICAgICBtZW1jcHkod2J1Zi0+YnVmICsgd2J1Zi0+d3JpdGVfcG9zLCBkYXRhLCBz
aXplKTsKICAgICB3YnVmLT53cml0ZV9wb3MgKz0gc2l6ZTsKKworICAgIGlmICh3YnVmLT53cml0
ZV9wb3MgPT0gd2J1Zi0+c2l6ZSkgeworICAgICAgICB2ZGFnZW50X2Nvbm5lY3Rpb25fd3JpdGUo
VkRBR0VOVF9DT05ORUNUSU9OKHZwb3J0KSwgd2J1Zi0+YnVmLCB3YnVmLT5zaXplKTsKKyAgICAg
ICAgd2J1Zi0+YnVmID0gTlVMTDsKKyAgICB9CiAgICAgcmV0dXJuIDA7CiB9CiAKQEAgLTI2Mywx
MiArMjQ2LDYgQEAgdm9pZCB2ZGFnZW50X3ZpcnRpb19wb3J0X3dyaXRlKAogICAgIHZkYWdlbnRf
dmlydGlvX3BvcnRfd3JpdGVfYXBwZW5kKHZwb3J0LCBkYXRhLCBkYXRhX3NpemUpOwogfQogCi12
b2lkIHZkYWdlbnRfdmlydGlvX3BvcnRfZmx1c2goc3RydWN0IHZkYWdlbnRfdmlydGlvX3BvcnQg
Kip2cG9ydHApCi17Ci0gICAgd2hpbGUgKCp2cG9ydHAgJiYgKCp2cG9ydHApLT53cml0ZV9idWYp
Ci0gICAgICAgIHZkYWdlbnRfdmlydGlvX3BvcnRfZG9fd3JpdGUodnBvcnRwKTsKLX0KLQogdm9p
ZCB2ZGFnZW50X3ZpcnRpb19wb3J0X3Jlc2V0KHN0cnVjdCB2ZGFnZW50X3ZpcnRpb19wb3J0ICp2
cG9ydCwgaW50IHBvcnQpCiB7CiAgICAgaWYgKHBvcnQgPj0gVkRQX0VORF9QT1JUKSB7CkBAIC0y
NzksMjAgKzI1NiwyMyBAQCB2b2lkIHZkYWdlbnRfdmlydGlvX3BvcnRfcmVzZXQoc3RydWN0IHZk
YWdlbnRfdmlydGlvX3BvcnQgKnZwb3J0LCBpbnQgcG9ydCkKICAgICBtZW1zZXQoJnZwb3J0LT5w
b3J0X2RhdGFbcG9ydF0sIDAsIHNpemVvZih2cG9ydC0+cG9ydF9kYXRhWzBdKSk7CiB9CiAKLXN0
YXRpYyB2b2lkIHZkYWdlbnRfdmlydGlvX3BvcnRfZG9fY2h1bmsoc3RydWN0IHZkYWdlbnRfdmly
dGlvX3BvcnQgKip2cG9ydHApCitzdGF0aWMgdm9pZCB2ZGFnZW50X3ZpcnRpb19wb3J0X2RvX2No
dW5rKFZEQWdlbnRDb25uZWN0aW9uICpjb25uLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBncG9pbnRlciBoZWFkZXJfZGF0YSwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZ3BvaW50ZXIgY2h1bmtfZGF0YSkKIHsKICAgICBpbnQgYXZh
aWwsIHJlYWQsIHBvcyA9IDA7Ci0gICAgc3RydWN0IHZkYWdlbnRfdmlydGlvX3BvcnQgKnZwb3J0
ID0gKnZwb3J0cDsKKyAgICBzdHJ1Y3QgdmRhZ2VudF92aXJ0aW9fcG9ydCAqdnBvcnQgPSBWSVJU
SU9fUE9SVChjb25uKTsKKyAgICBWRElDaHVua0hlYWRlciAqY2h1bmtfaGVhZGVyID0gaGVhZGVy
X2RhdGE7CiAgICAgc3RydWN0IHZkYWdlbnRfdmlydGlvX3BvcnRfY2h1bmtfcG9ydF9kYXRhICpw
b3J0ID0KLSAgICAgICAgJnZwb3J0LT5wb3J0X2RhdGFbdnBvcnQtPmNodW5rX2hlYWRlci5wb3J0
XTsKKyAgICAgICAgJnZwb3J0LT5wb3J0X2RhdGFbY2h1bmtfaGVhZGVyLT5wb3J0XTsKIAogICAg
IGlmIChwb3J0LT5tZXNzYWdlX2hlYWRlcl9yZWFkIDwgc2l6ZW9mKHBvcnQtPm1lc3NhZ2VfaGVh
ZGVyKSkgewogICAgICAgICByZWFkID0gc2l6ZW9mKHBvcnQtPm1lc3NhZ2VfaGVhZGVyKSAtIHBv
cnQtPm1lc3NhZ2VfaGVhZGVyX3JlYWQ7Ci0gICAgICAgIGlmIChyZWFkID4gdnBvcnQtPmNodW5r
X2hlYWRlci5zaXplKSB7Ci0gICAgICAgICAgICByZWFkID0gdnBvcnQtPmNodW5rX2hlYWRlci5z
aXplOworICAgICAgICBpZiAocmVhZCA+IGNodW5rX2hlYWRlci0+c2l6ZSkgeworICAgICAgICAg
ICAgcmVhZCA9IGNodW5rX2hlYWRlci0+c2l6ZTsKICAgICAgICAgfQogICAgICAgICBtZW1jcHko
KHVpbnQ4X3QgKikmcG9ydC0+bWVzc2FnZV9oZWFkZXIgKyBwb3J0LT5tZXNzYWdlX2hlYWRlcl9y
ZWFkLAotICAgICAgICAgICAgICAgdnBvcnQtPmNodW5rX2RhdGEsIHJlYWQpOworICAgICAgICAg
ICAgICAgY2h1bmtfZGF0YSwgcmVhZCk7CiAgICAgICAgIHBvcnQtPm1lc3NhZ2VfaGVhZGVyX3Jl
YWQgKz0gcmVhZDsKICAgICAgICAgaWYgKHBvcnQtPm1lc3NhZ2VfaGVhZGVyX3JlYWQgPT0gc2l6
ZW9mKHBvcnQtPm1lc3NhZ2VfaGVhZGVyKSkgewogCkBAIC0zMTAsMTEgKzI5MCwxMiBAQCBzdGF0
aWMgdm9pZCB2ZGFnZW50X3ZpcnRpb19wb3J0X2RvX2NodW5rKHN0cnVjdCB2ZGFnZW50X3ZpcnRp
b19wb3J0ICoqdnBvcnRwKQogCiAgICAgaWYgKHBvcnQtPm1lc3NhZ2VfaGVhZGVyX3JlYWQgPT0g
c2l6ZW9mKHBvcnQtPm1lc3NhZ2VfaGVhZGVyKSkgewogICAgICAgICByZWFkICA9IHBvcnQtPm1l
c3NhZ2VfaGVhZGVyLnNpemUgLSBwb3J0LT5tZXNzYWdlX2RhdGFfcG9zOwotICAgICAgICBhdmFp
bCA9IHZwb3J0LT5jaHVua19oZWFkZXIuc2l6ZSAtIHBvczsKKyAgICAgICAgYXZhaWwgPSBjaHVu
a19oZWFkZXItPnNpemUgLSBwb3M7CiAKICAgICAgICAgaWYgKGF2YWlsID4gcmVhZCkgewotICAg
ICAgICAgICAgc3lzbG9nKExPR19FUlIsICJjaHVuayBsYXJnZXIgdGhhbiBtZXNzYWdlLCBsb3N0
IHN5bmM/Iik7Ci0gICAgICAgICAgICB2ZGFnZW50X3ZpcnRpb19wb3J0X2Rlc3Ryb3kodnBvcnRw
KTsKKyAgICAgICAgICAgIEdFcnJvciAqZXJyID0gZ19lcnJvcl9uZXcoR19JT19FUlJPUiwgR19J
T19FUlJPUl9GQUlMRUQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJj
aHVuayBsYXJnZXIgdGhhbiBtZXNzYWdlLCBsb3N0IHN5bmM/Iik7CisgICAgICAgICAgICB2cG9y
dC0+ZXJyb3JfY2IoVkRBR0VOVF9DT05ORUNUSU9OKHZwb3J0KSwgZXJyKTsKICAgICAgICAgICAg
IHJldHVybjsKICAgICAgICAgfQogCkBAIC0zMjMsMTggKzMwNCwxNCBAQCBzdGF0aWMgdm9pZCB2
ZGFnZW50X3ZpcnRpb19wb3J0X2RvX2NodW5rKHN0cnVjdCB2ZGFnZW50X3ZpcnRpb19wb3J0ICoq
dnBvcnRwKQogCiAgICAgICAgIGlmIChyZWFkKSB7CiAgICAgICAgICAgICBtZW1jcHkocG9ydC0+
bWVzc2FnZV9kYXRhICsgcG9ydC0+bWVzc2FnZV9kYXRhX3BvcywKLSAgICAgICAgICAgICAgICAg
ICB2cG9ydC0+Y2h1bmtfZGF0YSArIHBvcywgcmVhZCk7CisgICAgICAgICAgICAgICAgICAgY2h1
bmtfZGF0YSArIHBvcywgcmVhZCk7CiAgICAgICAgICAgICBwb3J0LT5tZXNzYWdlX2RhdGFfcG9z
ICs9IHJlYWQ7CiAgICAgICAgIH0KIAogICAgICAgICBpZiAocG9ydC0+bWVzc2FnZV9kYXRhX3Bv
cyA9PSBwb3J0LT5tZXNzYWdlX2hlYWRlci5zaXplKSB7CiAgICAgICAgICAgICBpZiAodnBvcnQt
PnJlYWRfY2FsbGJhY2spIHsKLSAgICAgICAgICAgICAgICBpbnQgciA9IHZwb3J0LT5yZWFkX2Nh
bGxiYWNrKHZwb3J0LCB2cG9ydC0+Y2h1bmtfaGVhZGVyLnBvcnQsCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAmcG9ydC0+bWVzc2FnZV9oZWFkZXIsIHBvcnQtPm1lc3NhZ2VfZGF0
YSk7Ci0gICAgICAgICAgICAgICAgaWYgKHIgPT0gLTEpIHsKLSAgICAgICAgICAgICAgICAgICAg
dmRhZ2VudF92aXJ0aW9fcG9ydF9kZXN0cm95KHZwb3J0cCk7Ci0gICAgICAgICAgICAgICAgICAg
IHJldHVybjsKLSAgICAgICAgICAgICAgICB9CisgICAgICAgICAgICAgICAgdnBvcnQtPnJlYWRf
Y2FsbGJhY2sodnBvcnQsIGNodW5rX2hlYWRlci0+cG9ydCwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAmcG9ydC0+bWVzc2FnZV9oZWFkZXIsIHBvcnQtPm1lc3NhZ2VfZGF0
YSk7CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICBwb3J0LT5tZXNzYWdlX2hlYWRlcl9yZWFk
ID0gMDsKICAgICAgICAgICAgIHBvcnQtPm1lc3NhZ2VfZGF0YV9wb3MgPSAwOwpAQCAtMzQyLDE0
MCArMzE5LDMgQEAgc3RhdGljIHZvaWQgdmRhZ2VudF92aXJ0aW9fcG9ydF9kb19jaHVuayhzdHJ1
Y3QgdmRhZ2VudF92aXJ0aW9fcG9ydCAqKnZwb3J0cCkKICAgICAgICAgfQogICAgIH0KIH0KLQot
c3RhdGljIGludCB2cG9ydF9yZWFkKHN0cnVjdCB2ZGFnZW50X3ZpcnRpb19wb3J0ICp2cG9ydCwg
dWludDhfdCAqYnVmLCBpbnQgbGVuKQotewotICAgIGlmICh2cG9ydC0+aXNfdWRzKSB7Ci0gICAg
ICAgIHJldHVybiByZWN2KHZwb3J0LT5mZCwgYnVmLCBsZW4sIDApOwotICAgIH0gZWxzZSB7Ci0g
ICAgICAgIHJldHVybiByZWFkKHZwb3J0LT5mZCwgYnVmLCBsZW4pOwotICAgIH0KLX0KLQotc3Rh
dGljIHZvaWQgdmRhZ2VudF92aXJ0aW9fcG9ydF9kb19yZWFkKHN0cnVjdCB2ZGFnZW50X3ZpcnRp
b19wb3J0ICoqdnBvcnRwKQotewotICAgIHNzaXplX3QgbjsKLSAgICBzaXplX3QgdG9fcmVhZDsK
LSAgICB1aW50OF90ICpkZXN0OwotICAgIHN0cnVjdCB2ZGFnZW50X3ZpcnRpb19wb3J0ICp2cG9y
dCA9ICp2cG9ydHA7Ci0KLSAgICBpZiAodnBvcnQtPmNodW5rX2hlYWRlcl9yZWFkIDwgc2l6ZW9m
KHZwb3J0LT5jaHVua19oZWFkZXIpKSB7Ci0gICAgICAgIHRvX3JlYWQgPSBzaXplb2YodnBvcnQt
PmNodW5rX2hlYWRlcikgLSB2cG9ydC0+Y2h1bmtfaGVhZGVyX3JlYWQ7Ci0gICAgICAgIGRlc3Qg
PSAodWludDhfdCAqKSZ2cG9ydC0+Y2h1bmtfaGVhZGVyICsgdnBvcnQtPmNodW5rX2hlYWRlcl9y
ZWFkOwotICAgIH0gZWxzZSB7Ci0gICAgICAgIHRvX3JlYWQgPSB2cG9ydC0+Y2h1bmtfaGVhZGVy
LnNpemUgLSB2cG9ydC0+Y2h1bmtfZGF0YV9wb3M7Ci0gICAgICAgIGRlc3QgPSB2cG9ydC0+Y2h1
bmtfZGF0YSArIHZwb3J0LT5jaHVua19kYXRhX3BvczsKLSAgICB9Ci0KLSAgICBuID0gdnBvcnRf
cmVhZCh2cG9ydCwgZGVzdCwgdG9fcmVhZCk7Ci0gICAgaWYgKG4gPCAwKSB7Ci0gICAgICAgIGlm
IChlcnJubyA9PSBFSU5UUikKLSAgICAgICAgICAgIHJldHVybjsKLSAgICAgICAgc3lzbG9nKExP
R19FUlIsICJyZWFkaW5nIGZyb20gdmRhZ2VudCB2aXJ0aW8gcG9ydDogJW0iKTsKLSAgICB9Ci0g
ICAgaWYgKG4gPT0gMCAmJiB2cG9ydC0+b3BlbmluZykgewotICAgICAgICAvKiBXaGVuIHdlIG9w
ZW4gdGhlIHZpcnRpbyBzZXJpYWwgcG9ydCwgdGhlIGZvbGxvd2luZyBoYXBwZW5zOgotICAgICAg
ICAgICAxKSBUaGUgbGludXgga2VybmVsIHZpcnRpb19jb25zb2xlIGRyaXZlciBzZW5kcyBhCi0g
ICAgICAgICAgICAgIFZJUlRJT19DT05TT0xFX1BPUlRfT1BFTiBtZXNzYWdlIHRvIHFlbXUKLSAg
ICAgICAgICAgMikgcWVtdSdzIHNwaWNldm1jIGNoYXJkZXYgZHJpdmVyIGNhbGxzIHFlbXVfc3Bp
Y2VfYWRkX2ludGVyZmFjZSB0bwotICAgICAgICAgICAgICByZWdpc3RlciB0aGUgYWdlbnQgY2hh
cmRldiB3aXRoIHRoZSBzcGljZS1zZXJ2ZXIKLSAgICAgICAgICAgMykgc3BpY2Utc2VydmVyIHRo
ZW4gY2FsbHMgdGhlIHNwaWNldm1jIGNoYXJkZXYgZHJpdmVyJ3Mgc3RhdGUKLSAgICAgICAgICAg
ICAgY2FsbGJhY2sgdG8gbGV0IGl0IGtub3cgaXQgaXMgcmVhZHkgdG8gcmVjZWl2ZSBkYXRhCi0g
ICAgICAgICAgIDQpIFRoZSBzdGF0ZSBjYWxsYmFjayBzZW5kcyBhIENIUl9FVkVOVF9PUEVORUQg
dG8gdGhlIHZpcnRpby1jb25zb2xlCi0gICAgICAgICAgICAgIGNoYXJkZXYgYmFja2VuZAotICAg
ICAgICAgICA1KSBUaGUgdmlydGlvLWNvbnNvbGUgY2hhcmRldiBiYWNrZW5kIHNlbmRzIFZJUlRJ
T19DT05TT0xFX1BPUlRfT1BFTgotICAgICAgICAgICAgICB0byB0aGUgbGludXgga2VybmVsIHZp
cnRpb19jb25zb2xlIGRyaXZlcgotCi0gICAgICAgICAgIFVudGlsIHN0ZXBzIDEgLSA1IGhhdmUg
Y29tcGxldGVkIHRoZSBsaW51eCBrZXJuZWwgdmlydGlvX2NvbnNvbGUKLSAgICAgICAgICAgZHJp
dmVyIHNlZXMgdGhlIHZpcnRpbyBzZXJpYWwgcG9ydCBhcyBiZWluZyBpbiBhIGRpc2Nvbm5lY3Rl
ZCBzdGF0ZQotICAgICAgICAgICBhbmQgcmVhZCB3aWxsIHJldHVybiAwICEgU28gaWYgd2UgYmxp
bmRseSBhc3N1bWUgdGhhdCBhIHJlYWQgMCBtZWFucwotICAgICAgICAgICB0aGF0IHRoZSBjaGFu
bmVsIGlzIGNsb3NlZCB3ZSB3aWxsIGhpdCBhIHJhY2UgaGVyZS4KLQotICAgICAgICAgICBUaGVy
ZWZvcmUgd2UgaWdub3JlIHJlYWQgcmV0dXJuaW5nIDAgdW50aWwgd2UndmUgc3VjY2Vzc2Z1bGx5
IHJlYWQKLSAgICAgICAgICAgb3Igd3JpdHRlbiBzb21lIGRhdGEuIElmIHdlIGhpdCB0aGlzIHJh
Y2Ugd2UgYWxzbyBzbGVlcCBhIGJpdCBoZXJlCi0gICAgICAgICAgIHRvIGF2b2lkIGJ1c3kgd2Fp
dGluZyB1bnRpbCB0aGUgYWJvdmUgc3RlcHMgY29tcGxldGUgKi8KLSAgICAgICAgdXNsZWVwKDEw
MDAwKTsKLSAgICAgICAgcmV0dXJuOwotICAgIH0KLSAgICBpZiAobiA8PSAwKSB7Ci0gICAgICAg
IHZkYWdlbnRfdmlydGlvX3BvcnRfZGVzdHJveSh2cG9ydHApOwotICAgICAgICByZXR1cm47Ci0g
ICAgfQotICAgIHZwb3J0LT5vcGVuaW5nID0gMDsKLQotICAgIGlmICh2cG9ydC0+Y2h1bmtfaGVh
ZGVyX3JlYWQgPCBzaXplb2YodnBvcnQtPmNodW5rX2hlYWRlcikpIHsKLSAgICAgICAgdnBvcnQt
PmNodW5rX2hlYWRlcl9yZWFkICs9IG47Ci0gICAgICAgIGlmICh2cG9ydC0+Y2h1bmtfaGVhZGVy
X3JlYWQgPT0gc2l6ZW9mKHZwb3J0LT5jaHVua19oZWFkZXIpKSB7Ci0gICAgICAgICAgICB2cG9y
dC0+Y2h1bmtfaGVhZGVyLnNpemUgPSBHVUlOVDMyX0ZST01fTEUodnBvcnQtPmNodW5rX2hlYWRl
ci5zaXplKTsKLSAgICAgICAgICAgIHZwb3J0LT5jaHVua19oZWFkZXIucG9ydCA9IEdVSU5UMzJf
RlJPTV9MRSh2cG9ydC0+Y2h1bmtfaGVhZGVyLnBvcnQpOwotICAgICAgICAgICAgaWYgKHZwb3J0
LT5jaHVua19oZWFkZXIuc2l6ZSA+IFZEX0FHRU5UX01BWF9EQVRBX1NJWkUpIHsKLSAgICAgICAg
ICAgICAgICBzeXNsb2coTE9HX0VSUiwgImNodW5rIHNpemUgJXUgdG9vIGxhcmdlIiwKLSAgICAg
ICAgICAgICAgICAgICAgICAgdnBvcnQtPmNodW5rX2hlYWRlci5zaXplKTsKLSAgICAgICAgICAg
ICAgICB2ZGFnZW50X3ZpcnRpb19wb3J0X2Rlc3Ryb3kodnBvcnRwKTsKLSAgICAgICAgICAgICAg
ICByZXR1cm47Ci0gICAgICAgICAgICB9Ci0gICAgICAgICAgICBpZiAodnBvcnQtPmNodW5rX2hl
YWRlci5wb3J0ID49IFZEUF9FTkRfUE9SVCkgewotICAgICAgICAgICAgICAgIHN5c2xvZyhMT0df
RVJSLCAiY2h1bmsgcG9ydCAldSBvdXQgb2YgcmFuZ2UiLAotICAgICAgICAgICAgICAgICAgICAg
ICB2cG9ydC0+Y2h1bmtfaGVhZGVyLnBvcnQpOwotICAgICAgICAgICAgICAgIHZkYWdlbnRfdmly
dGlvX3BvcnRfZGVzdHJveSh2cG9ydHApOwotICAgICAgICAgICAgICAgIHJldHVybjsKLSAgICAg
ICAgICAgIH0KLSAgICAgICAgfQotICAgIH0gZWxzZSB7Ci0gICAgICAgIHZwb3J0LT5jaHVua19k
YXRhX3BvcyArPSBuOwotICAgICAgICBpZiAodnBvcnQtPmNodW5rX2RhdGFfcG9zID09IHZwb3J0
LT5jaHVua19oZWFkZXIuc2l6ZSkgewotICAgICAgICAgICAgdmRhZ2VudF92aXJ0aW9fcG9ydF9k
b19jaHVuayh2cG9ydHApOwotICAgICAgICAgICAgLy8gY292ZXJpdHlbY2hlY2tfYWZ0ZXJfZGVy
ZWZdIHByZXZpb3VzIGZ1bmN0aW9uIGNhbiBjaGFuZ2UgKnZwb3J0ZAotICAgICAgICAgICAgaWYg
KCEqdnBvcnRwKQotICAgICAgICAgICAgICAgIHJldHVybjsKLSAgICAgICAgICAgIHZwb3J0LT5j
aHVua19oZWFkZXJfcmVhZCA9IDA7Ci0gICAgICAgICAgICB2cG9ydC0+Y2h1bmtfZGF0YV9wb3Mg
PSAwOwotICAgICAgICB9Ci0gICAgfQotfQotCi1zdGF0aWMgaW50IHZwb3J0X3dyaXRlKHN0cnVj
dCB2ZGFnZW50X3ZpcnRpb19wb3J0ICp2cG9ydCwgdWludDhfdCAqYnVmLCBpbnQgbGVuKQotewot
ICAgIGlmICh2cG9ydC0+aXNfdWRzKSB7Ci0gICAgICAgIHJldHVybiBzZW5kKHZwb3J0LT5mZCwg
YnVmLCBsZW4sIDApOwotICAgIH0gZWxzZSB7Ci0gICAgICAgIHJldHVybiB3cml0ZSh2cG9ydC0+
ZmQsIGJ1ZiwgbGVuKTsKLSAgICB9Ci19Ci0KLXN0YXRpYyB2b2lkIHZkYWdlbnRfdmlydGlvX3Bv
cnRfZG9fd3JpdGUoc3RydWN0IHZkYWdlbnRfdmlydGlvX3BvcnQgKip2cG9ydHApCi17Ci0gICAg
c3NpemVfdCBuOwotICAgIHNpemVfdCB0b193cml0ZTsKLSAgICBzdHJ1Y3QgdmRhZ2VudF92aXJ0
aW9fcG9ydCAqdnBvcnQgPSAqdnBvcnRwOwotCi0gICAgc3RydWN0IHZkYWdlbnRfdmlydGlvX3Bv
cnRfYnVmKiB3YnVmID0gdnBvcnQtPndyaXRlX2J1ZjsKLSAgICBpZiAoIXdidWYpIHsKLSAgICAg
ICAgc3lzbG9nKExPR19FUlIsICJkb193cml0ZSBjYWxsZWQgb24gYSBwb3J0IHdpdGhvdXQgYSB3
cml0ZSBidWYgPyEiKTsKLSAgICAgICAgcmV0dXJuOwotICAgIH0KLQotICAgIGlmICh3YnVmLT53
cml0ZV9wb3MgIT0gd2J1Zi0+c2l6ZSkgewotICAgICAgICBzeXNsb2coTE9HX0VSUiwgImRvX3dy
aXRlOiBidWZmZXIgaXMgaW5jb21wbGV0ZSEhIik7Ci0gICAgICAgIHJldHVybjsKLSAgICB9Ci0K
LSAgICB0b193cml0ZSA9IHdidWYtPnNpemUgLSB3YnVmLT5wb3M7Ci0gICAgbiA9IHZwb3J0X3dy
aXRlKHZwb3J0LCB3YnVmLT5idWYgKyB3YnVmLT5wb3MsIHRvX3dyaXRlKTsKLSAgICBpZiAobiA8
IDApIHsKLSAgICAgICAgaWYgKGVycm5vID09IEVJTlRSKQotICAgICAgICAgICAgcmV0dXJuOwot
ICAgICAgICBzeXNsb2coTE9HX0VSUiwgIndyaXRpbmcgdG8gdmRhZ2VudCB2aXJ0aW8gcG9ydDog
JW0iKTsKLSAgICAgICAgdmRhZ2VudF92aXJ0aW9fcG9ydF9kZXN0cm95KHZwb3J0cCk7Ci0gICAg
ICAgIHJldHVybjsKLSAgICB9Ci0gICAgaWYgKG4gPiAwKQotICAgICAgICB2cG9ydC0+b3Blbmlu
ZyA9IDA7Ci0KLSAgICB3YnVmLT5wb3MgKz0gbjsKLSAgICBpZiAod2J1Zi0+cG9zID09IHdidWYt
PnNpemUpIHsKLSAgICAgICAgdnBvcnQtPndyaXRlX2J1ZiA9IHdidWYtPm5leHQ7Ci0gICAgICAg
IGdfZnJlZSh3YnVmLT5idWYpOwotICAgICAgICBnX2ZyZWUod2J1Zik7Ci0gICAgfQotfQpkaWZm
IC0tZ2l0IGEvc3JjL3ZkYWdlbnRkL3ZpcnRpby1wb3J0LmggYi9zcmMvdmRhZ2VudGQvdmlydGlv
LXBvcnQuaAppbmRleCBkZmZiNDEwLi4zMmNmOGI3IDEwMDY0NAotLS0gYS9zcmMvdmRhZ2VudGQv
dmlydGlvLXBvcnQuaAorKysgYi9zcmMvdmRhZ2VudGQvdmlydGlvLXBvcnQuaApAQCAtMjIsNTgg
KzIyLDQzIEBACiAjaWZuZGVmIF9fVklSVElPX1BPUlRfSAogI2RlZmluZSBfX1ZJUlRJT19QT1JU
X0gKIAotI2luY2x1ZGUgPHN0ZGlvLmg+CiAjaW5jbHVkZSA8c3RkaW50Lmg+Ci0jaW5jbHVkZSA8
c3lzL3NlbGVjdC5oPgogI2luY2x1ZGUgPHNwaWNlL3ZkX2FnZW50Lmg+CisjaW5jbHVkZSA8Z2xp
Yi1vYmplY3QuaD4KKyNpbmNsdWRlICJ2ZGFnZW50LWNvbm5lY3Rpb24uaCIKKworR19CRUdJTl9E
RUNMUworCisjZGVmaW5lIFZJUlRJT19UWVBFX1BPUlQgICAgICAgICAgICAodmlydGlvX3BvcnRf
Z2V0X3R5cGUoKSkKKyNkZWZpbmUgVklSVElPX1BPUlQob2JqKSAgICAgICAgICAgIChHX1RZUEVf
Q0hFQ0tfSU5TVEFOQ0VfQ0FTVCgob2JqKSwgVklSVElPX1RZUEVfUE9SVCwgVmlydGlvUG9ydCkp
CisjZGVmaW5lIFZJUlRJT19JU19QT1JUKG9iaikgICAgICAgICAoR19UWVBFX0NIRUNLX0lOU1RB
TkNFX1RZUEUoKG9iaiksIFZJUlRJT19UWVBFX1BPUlQpKQorI2RlZmluZSBWSVJUSU9fUE9SVF9D
TEFTUyhrbGFzcykgICAgKEdfVFlQRV9DSEVDS19DTEFTU19DQVNUKChrbGFzcyksIFZJUlRJT19U
WVBFX1BPUlQsIFZpcnRpb1BvcnRDbGFzcykpCisjZGVmaW5lIFZJUlRJT19JU19QT1JUX0NMQVNT
KGtsYXNzKSAoR19UWVBFX0NIRUNLX0NMQVNTX1RZUEUoKGtsYXNzKSwgVklSVElPX1RZUEVfUE9S
VCkpCisjZGVmaW5lIFZJUlRJT19QT1JUX0dFVF9DTEFTUyhvYmopICAoR19UWVBFX0lOU1RBTkNF
X0dFVF9DTEFTUygob2JqKSwgVklSVElPX1RZUEVfUE9SVCwgVmlydGlvUG9ydENsYXNzKSkKKwor
dHlwZWRlZiBzdHJ1Y3QgdmRhZ2VudF92aXJ0aW9fcG9ydCBWaXJ0aW9Qb3J0OwordHlwZWRlZiBz
dHJ1Y3QgVmlydGlvUG9ydENsYXNzIFZpcnRpb1BvcnRDbGFzczsKKworc3RydWN0IFZpcnRpb1Bv
cnRDbGFzcyB7CisgICAgVkRBZ2VudENvbm5lY3Rpb25DbGFzcyBwYXJlbnRfY2xhc3M7Cit9Owor
CitHVHlwZSB2aXJ0aW9fcG9ydF9nZXRfdHlwZSh2b2lkKTsKIAogc3RydWN0IHZkYWdlbnRfdmly
dGlvX3BvcnQ7CiAKIC8qIENhbGxiYWNrcyB3aXRoIHRoaXMgdHlwZSB3aWxsIGJlIGNhbGxlZCB3
aGVuIGEgY29tcGxldGUgbWVzc2FnZSBoYXMgYmVlbgotICAgcmVjZWl2ZWQuIFNvbWV0aW1lcyB0
aGUgY2FsbGJhY2sgbWF5IHdhbnQgdG8gY2xvc2UgdGhlIHBvcnQsIGluIHRoaXMKLSAgIGNhc2Ug
ZG8gKm5vdCogY2FsbCB2ZGFnZW50X3ZpcnRpb19wb3J0X2Rlc3Ryb3kgZnJvbSB0aGUgY2FsbGJh
Y2suIFRoZSBkZXNpcmUKLSAgIHRvIGNsb3NlIHRoZSBwb3J0IGNhbiBiZSBpbmRpY2F0ZWQgYmUg
cmV0dXJuaW5nIC0xIGZyb20gdGhlIGNhbGxiYWNrLAotICAgaW4gb3RoZXIgY2FzZXMgcmV0dXJu
IDAuICovCi10eXBlZGVmIGludCAoKnZkYWdlbnRfdmlydGlvX3BvcnRfcmVhZF9jYWxsYmFjayko
CisgICByZWNlaXZlZC4gKi8KK3R5cGVkZWYgdm9pZCAoKnZkYWdlbnRfdmlydGlvX3BvcnRfcmVh
ZF9jYWxsYmFjaykoCiAgICAgc3RydWN0IHZkYWdlbnRfdmlydGlvX3BvcnQgKnZwb3J0LAogICAg
IGludCBwb3J0X25yLAogICAgIFZEQWdlbnRNZXNzYWdlICptZXNzYWdlX2hlYWRlciwKICAgICB1
aW50OF90ICpkYXRhKTsKIAotLyogQ2FsbGJhY2tzIHdpdGggdGhpcyB0eXBlIHdpbGwgYmUgY2Fs
bGVkIHdoZW4gdGhlIHBvcnQgaXMgZGlzY29ubmVjdGVkLgotICAgTm90ZToKLSAgIDEpIHZkYWdl
bnRfdmlydGlvX3BvcnQgd2lsbCBkZXN0cm95IHRoZSBwb3J0IGluIHF1ZXN0aW9uIGl0c2VsZiBh
ZnRlcgotICAgICAgdGhpcyBjYWxsYmFjayBoYXMgY29tcGxldGVkIQotICAgMikgVGhpcyBjYWxs
YmFjayBpcyBhbHdheXMgY2FsbGVkLCBldmVuIGlmIHRoZSBkaXNjb25uZWN0IGlzIGluaXRpYXRl
ZAotICAgICAgYnkgdGhlIHZkYWdlbnRfdmlydGlvX3BvcnQgdXNlciB0aHJvdWdoIHJldHVybmlu
ZyAtMSBmcm9tIGEgcmVhZAotICAgICAgY2FsbGJhY2ssIG9yIGJ5IGV4cGxpY2l0bHkgY2FsbGlu
ZyB2ZGFnZW50X3ZpcnRpb19wb3J0X2Rlc3Ryb3kgKi8KLXR5cGVkZWYgdm9pZCAoKnZkYWdlbnRf
dmlydGlvX3BvcnRfZGlzY29ubmVjdF9jYWxsYmFjaykoCi0gICAgc3RydWN0IHZkYWdlbnRfdmly
dGlvX3BvcnQgKmNvbm4pOwotCi0KIC8qIENyZWF0ZSBhIHZkYWdlbnQgdmlydGlvIHBvcnQgb2Jq
ZWN0IGZvciBwb3J0IHBvcnRuYW1lICovCiBzdHJ1Y3QgdmRhZ2VudF92aXJ0aW9fcG9ydCAqdmRh
Z2VudF92aXJ0aW9fcG9ydF9jcmVhdGUoY29uc3QgY2hhciAqcG9ydG5hbWUsCiAgICAgdmRhZ2Vu
dF92aXJ0aW9fcG9ydF9yZWFkX2NhbGxiYWNrIHJlYWRfY2FsbGJhY2ssCi0gICAgdmRhZ2VudF92
aXJ0aW9fcG9ydF9kaXNjb25uZWN0X2NhbGxiYWNrIGRpc2Nvbm5lY3RfY2FsbGJhY2spOwotCi0v
KiBUaGUgY29udGVudHMgb2YgcG9ydHAgd2lsbCBiZSBtYWRlIE5VTEwgKi8KLXZvaWQgdmRhZ2Vu
dF92aXJ0aW9fcG9ydF9kZXN0cm95KHN0cnVjdCB2ZGFnZW50X3ZpcnRpb19wb3J0ICoqdnBvcnRw
KTsKLQotCi0vKiBHaXZlbiBhIHZkYWdlbnRfdmlydGlvX3BvcnQgZmlsbCB0aGUgZmRfc2V0cyBw
b2ludGVkIHRvIGJ5IHJlYWRmZHMgYW5kCi0gICB3cml0ZWZkcyBmb3Igc2VsZWN0KCkgdXNhZ2Uu
Ci0KLSAgIFJldHVybiB2YWx1ZTogdmFsdWUgb2YgdGhlIGhpZ2hlc3QgZmQgKyAxICovCi1pbnQg
dmRhZ2VudF92aXJ0aW9fcG9ydF9maWxsX2ZkcyhzdHJ1Y3QgdmRhZ2VudF92aXJ0aW9fcG9ydCAq
dnBvcnQsCi0gICAgICAgIGZkX3NldCAqcmVhZGZkcywgZmRfc2V0ICp3cml0ZWZkcyk7Ci0KLS8q
IEhhbmRsZSBhbnkgZXZlbnRzIGZsYWdnZWQgYnkgc2VsZWN0IGZvciB0aGUgZ2l2ZW4gdmRhZ2Vu
dF92aXJ0aW9fcG9ydC4KLSAgIE5vdGUgdGhlIHBvcnQgbWF5IGJlIGRlc3Ryb3llZCAod2hlbiBk
aXNjb25uZWN0ZWQpIGJ5IHRoaXMgY2FsbAotICAgaW4gdGhpcyBjYXNlIHRoZSBkaXNjb25uZWN0
IGNhbGxsYmFjayB3aWxsIGdldCBjYWxsZWQgYmVmb3JlIHRoZQotICAgZGVzdHJ1Y3Rpb24gYW5k
IHRoZSBjb250ZW50cyBvZiBjb25ucCB3aWxsIGJlIG1hZGUgTlVMTCAqLwotdm9pZCB2ZGFnZW50
X3ZpcnRpb19wb3J0X2hhbmRsZV9mZHMoc3RydWN0IHZkYWdlbnRfdmlydGlvX3BvcnQgKip2cG9y
dHAsCi0gICAgICAgIGZkX3NldCAqcmVhZGZkcywgZmRfc2V0ICp3cml0ZWZkcyk7Ci0KKyAgICBW
REFnZW50Q29ubkVycm9yQ2IgZXJyb3JfY2IpOwogCiAvKiBRdWV1ZSBhIG1lc3NhZ2UgZm9yIGRl
bGl2ZXJ5LCBlaXRoZXIgYml0IGJ5IGJpdCwgb3IgYWxsIGF0IG9uY2UgKi8KIHZvaWQgdmRhZ2Vu
dF92aXJ0aW9fcG9ydF93cml0ZV9zdGFydCgKQEAgLTk2LDcgKzgxLDggQEAgdm9pZCB2ZGFnZW50
X3ZpcnRpb19wb3J0X3dyaXRlKAogICAgICAgICBjb25zdCB1aW50OF90ICpkYXRhLAogICAgICAg
ICB1aW50MzJfdCBkYXRhX3NpemUpOwogCi12b2lkIHZkYWdlbnRfdmlydGlvX3BvcnRfZmx1c2go
c3RydWN0IHZkYWdlbnRfdmlydGlvX3BvcnQgKip2cG9ydHApOwogdm9pZCB2ZGFnZW50X3ZpcnRp
b19wb3J0X3Jlc2V0KHN0cnVjdCB2ZGFnZW50X3ZpcnRpb19wb3J0ICp2cG9ydCwgaW50IHBvcnQp
OwogCitHX0VORF9ERUNMUworCiAjZW5kaWYKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KU3BpY2UtZGV2ZWwgbWFpbGluZyBsaXN0ClNw
aWNlLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
