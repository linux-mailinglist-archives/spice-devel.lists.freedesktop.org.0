Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3C48ABC49C
	for <lists+spice-devel@lfdr.de>; Tue, 24 Sep 2019 11:15:14 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9E2E56E9B6;
	Tue, 24 Sep 2019 09:15:12 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DAF1589B60
 for <spice-devel@lists.freedesktop.org>; Tue, 24 Sep 2019 09:15:08 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx04.intmail.prod.int.phx2.redhat.com
 [10.5.11.14])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 815A11DCD
 for <spice-devel@lists.freedesktop.org>; Tue, 24 Sep 2019 09:15:08 +0000 (UTC)
Received: from wingsuit.mxp.redhat.com (unknown [10.32.181.60])
 by smtp.corp.redhat.com (Postfix) with ESMTP id ACB325D9E1
 for <spice-devel@lists.freedesktop.org>; Tue, 24 Sep 2019 09:15:07 +0000 (UTC)
From: Victor Toso <victortoso@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Tue, 24 Sep 2019 11:15:02 +0200
Message-Id: <20190924091502.16038-7-victortoso@redhat.com>
In-Reply-To: <20190924091502.16038-1-victortoso@redhat.com>
References: <20190924091502.16038-1-victortoso@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.14
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.6.2
 (mx1.redhat.com [10.5.110.71]); Tue, 24 Sep 2019 09:15:08 +0000 (UTC)
Subject: [Spice-devel] [spice-gtk v1 6/6] Introduce SpiceMainChannelMigration
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogVmljdG9yIFRvc28gPG1lQHZpY3RvcnRvc28uY29tPgoKVGhlIG1pZ3JhdGlvbiBpcyBh
IGNvbXBsaWNhdGVkIGZlYXR1cmUgd2hlcmUgdGhlcmUgdGhlIFZpcnR1YWwgTWFjaGluZQppcyBp
dHMgY29ubmVjdGlvbiBkZXRhaWxzIGZyb20gaXRzIGhvc3QsIG5vdyB0byBiZSBjYWxsZWQgc291
cmNlLWhvc3QsCnRvIGEgbmV3IGhvc3QsIG5vdyBjYWxsZWQgdGFyZ2V0LWhvc3QuCgpGb3IgdGhl
IGNsaWVudCwgdGhlIG1pZ3JhdGlvbiBjYW4gaGFwcGVuIGluIGRpZmZlcmVudCB3YXlzIGFzCnN1
cHBvcnRlZCBieSBzcGljZS1wcm90b2NvbC4gVGhlIGZvY3VzIG9mIHRoaXMgcGF0Y2ggaXMgdG8g
Y3JlYXRlIGFuCm9iamVjdCB0aGF0IHNob3VsZCBiZSBoYW5kbGluZyB0aGUgc3RhdGUgb2YgdGhl
IG1pZ3JhdGlvbiBpdHNlbGYgYXMKbXVjaCBhcyBwb3NzaWJsZS4KCldpdGggdGhhdCBnb2FsIGlu
IG1pbmQsIHdlIHdpbGwgYmUgYWJsZSB0byByZW1vdmUgc29tZSBjb2RlIGZyb20KY2hhbm5lbC1t
YWluIGFuZCBzcGljZS1zZXNzaW9uIGFuZCBwb2ludCBvdXQgd2hhdCBhcmUgdGhlaXIgcm9sZXMK
ZHVyaW5nIHRoZSBleGVjdXRpb24gb2YgZWFjaCB0eXBlIG9mIG1pZ3JhdGlvbi4KClRoaXMgcGF0
Y2ggaW50cm9kdWNlcyBTcGljZU1haW5DaGFubmVsTWlncmF0aW9uIG9iamVjdC4gVGhlIG5hbWUg
Z29lcwphZnRlciBjaGFubmVsLW1haW4gYXMgdGhpcyBpcyBhIGZlYXR1cmUgdGhhdCBnb2VzIGJv
dW5kZWQgdG8gdGhpcwpjaGFubmVsLiBXaXRoIHRoaXMgcGF0Y2gsIHdlIHJlbW92ZSBzdHJ1Y3Qg
c3BpY2VfbWlncmF0ZSBmcm9tCmNoYW5uZWwtbWFpbiBhbmQgbWFrZSB0aGF0IGJlY29tZSB0aGUg
YmFzZSBmb3IgdGhlIG5ldyBvYmplY3QuCgpOb3RlIHRoYXQgb25lIGRlc2lnbiBjaG9pY2UgaXMg
dG8gdGhlIGNoYW5uZWwtbWFpbiBub3QgaG9sZCBhCnJlZmVyZW5jZSB0byBTcGljZU1haW5DaGFu
bmVsTWlncmF0aW9uIGJlY2F1c2UsIGV2ZW4gaWYgdGhlIG1pZ3JhdGlvbgptZXNzYWdlcyBjb21l
cyBmcm9tIGNoYW5uZWwtbWFpbiwgdGhlIG1pZ3JhdGlvbiBzY2VuYXJpbyBoYXBwZW5zIGZvcgp0
aGUgd2hvbGUgc2Vzc2lvbiBzbywgaXQgaXMgU3BpY2VTZXNzaW9uIHdobyBob2xkcyBhIHJlZmVy
ZW5jZSB0bwpTcGljZU1haW5DaGFubmVsTWlncmF0aW9uLgoKSW4gZnV0dXJlIHBhdGNoZXMsIG5v
bi1zZWFtbGVzcyBtaWdyYXRpb24gY2FuIGJlIG1vdmVkIHRvClNwaWNlTWFpbkNoYW5uZWxNaWdy
YXRpb24gYXMgd2VsbCwgcmVkdWNpbmcgdGhlIGxvZ2ljIGluIGNoYW5uZWwtbWFpbgphbmQgc3Bp
Y2Utc2Vzc2lvbi4KClRoaXMgaGFzIGJlZW4gdGVzdGVkIGEgZmV3IHRpbWVzIHdpdGggUkhFTDgg
R3Vlc3QgdW5kZXIgUkhWIDQuMywgYWxzbwp1bmRlciB2YWxncmluZC4KClNpZ25lZC1vZmYtYnk6
IFZpY3RvciBUb3NvIDx2aWN0b3J0b3NvQHJlZGhhdC5jb20+Ci0tLQogZG9jL3JlZmVyZW5jZS9t
ZXNvbi5idWlsZCAgICB8ICAgMSArCiBzcmMvY2hhbm5lbC1tYWluLW1pZ3JhdGlvbi5jIHwgMzk4
ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiBzcmMvY2hhbm5lbC1tYWluLW1p
Z3JhdGlvbi5oIHwgIDYzICsrKysrKwogc3JjL2NoYW5uZWwtbWFpbi5jICAgICAgICAgICB8IDIx
NyArKysrLS0tLS0tLS0tLS0tLS0tCiBzcmMvbWVzb24uYnVpbGQgICAgICAgICAgICAgIHwgICAy
ICsKIHNyYy9zcGljZS1zZXNzaW9uLXByaXYuaCAgICAgfCAgIDQgKwogc3JjL3NwaWNlLXNlc3Np
b24uYyAgICAgICAgICB8ICAyNiArKysKIDcgZmlsZXMgY2hhbmdlZCwgNTMzIGluc2VydGlvbnMo
KyksIDE3OCBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBzcmMvY2hhbm5lbC1tYWlu
LW1pZ3JhdGlvbi5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgc3JjL2NoYW5uZWwtbWFpbi1taWdyYXRp
b24uaAoKZGlmZiAtLWdpdCBhL2RvYy9yZWZlcmVuY2UvbWVzb24uYnVpbGQgYi9kb2MvcmVmZXJl
bmNlL21lc29uLmJ1aWxkCmluZGV4IDYxYzQxMGYuLmQ5ZDUyMDMgMTAwNjQ0Ci0tLSBhL2RvYy9y
ZWZlcmVuY2UvbWVzb24uYnVpbGQKKysrIGIvZG9jL3JlZmVyZW5jZS9tZXNvbi5idWlsZApAQCAt
MSw2ICsxLDcgQEAKIGlnbm9yZV9oZWFkZXJzID0gWwogICAnYmlvLWdpby5oJywKICAgJ2NoYW5u
ZWwtZGlzcGxheS1wcml2LmgnLAorICAnY2hhbm5lbC1tYWluLW1pZ3JhdGlvbi5oJywKICAgJ2No
YW5uZWwtdXNicmVkaXItcHJpdi5oJywKICAgJ2NsaWVudF9zd19jYW52YXMuaCcsCiAgICdjb250
aW51YXRpb24uaCcsCmRpZmYgLS1naXQgYS9zcmMvY2hhbm5lbC1tYWluLW1pZ3JhdGlvbi5jIGIv
c3JjL2NoYW5uZWwtbWFpbi1taWdyYXRpb24uYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAw
MDAwMDAwLi45MDYzZTBlCi0tLSAvZGV2L251bGwKKysrIGIvc3JjL2NoYW5uZWwtbWFpbi1taWdy
YXRpb24uYwpAQCAtMCwwICsxLDM5OCBAQAorLyoKKyAgIENvcHlyaWdodCAoQykgMjAxOSBSZWQg
SGF0LCBJbmMuCisKKyAgIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJl
ZGlzdHJpYnV0ZSBpdCBhbmQvb3IKKyAgIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhl
IEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKKyAgIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRo
ZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlcgorICAgdmVyc2lvbiAyLjEgb2YgdGhl
IExpY2Vuc2UsIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCisKKyAgIFRo
aXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNl
ZnVsLAorICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxp
ZWQgd2FycmFudHkgb2YKKyAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJ
Q1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUgR05VCisgICBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGlj
ZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgorCisgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBj
b3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCisgICBMaWNlbnNlIGFsb25nIHdp
dGggdGhpcyBsaWJyYXJ5OyBpZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2Vz
Lz4uCisqLworCisjaW5jbHVkZSAiY29uZmlnLmgiCisKKyNpbmNsdWRlICJjaGFubmVsLW1haW4t
bWlncmF0aW9uLmgiCisjaW5jbHVkZSAic3BpY2Utc2Vzc2lvbi1wcml2LmgiCisjaW5jbHVkZSAi
c3BpY2UtY2hhbm5lbC1wcml2LmgiCisKK3R5cGVkZWYgc3RydWN0IF9TcGljZU1haW5DaGFubmVs
TWlncmF0aW9uUHJpdmF0ZSBTcGljZU1haW5DaGFubmVsTWlncmF0aW9uUHJpdmF0ZTsKKworc3Ry
dWN0IF9TcGljZU1haW5DaGFubmVsTWlncmF0aW9uUHJpdmF0ZQoreworICAgIFNwaWNlU2Vzc2lv
biAqc291cmNlX3Nlc3Npb247CisgICAgU3BpY2VTZXNzaW9uICp0YXJnZXRfc2Vzc2lvbjsKKwor
ICAgIGd1aW50IHNvdXJjZV9ob3N0X3ZlcnNpb247CisgICAgZ2Jvb2xlYW4gc2VhbWxlc3NfbWln
cmF0aW9uOworCisgICAgc3RydWN0IGNvcm91dGluZSAqc291cmNlX2Nvcm91dGluZTsKKworICAg
IGd1aW50IG51bV9jaGFubmVsczsgLyogdG8gbWlncmF0ZSAqLworICAgIGd1aW50IG51bV9taWdy
YXRpbmdfY2hhbm5lbHM7Cit9OworCitzdHJ1Y3QgX1NwaWNlTWFpbkNoYW5uZWxNaWdyYXRpb24K
K3sKKyAgICBHT2JqZWN0IHBhcmVudDsKKworICAgIFNwaWNlTWFpbkNoYW5uZWxNaWdyYXRpb25Q
cml2YXRlICpwcml2OworfTsKKworc3RydWN0IF9TcGljZU1haW5DaGFubmVsTWlncmF0aW9uQ2xh
c3MKK3sKKyAgICBHT2JqZWN0Q2xhc3MgcGFyZW50X2NsYXNzOworfTsKKworZW51bSB7CisgICAg
UFJPUF9DT1JPVVRJTkVfQ09OVEVYVCA9IDEsCisgICAgUFJPUF9TRUFNTEVTU19NSUdSQVRJT04s
CisgICAgUFJPUF9TT1VSQ0VfSE9TVF9WRVJTSU9OLAorICAgIFBST1BfU09VUkNFX1NFU1NJT04s
CisgICAgUFJPUF9UQVJHRVRfU0VTU0lPTiwKKworICAgIFBST1BfTEFTVCwKK307CisKK3N0YXRp
YyBHUGFyYW1TcGVjICpnX3Byb3BlcnRpZXNbUFJPUF9MQVNUXSA9IHsgTlVMTCwgfTsKKworR19E
RUZJTkVfVFlQRV9XSVRIX1BSSVZBVEUoU3BpY2VNYWluQ2hhbm5lbE1pZ3JhdGlvbiwgc3BpY2Vf
bWFpbl9jaGFubmVsX21pZ3JhdGlvbiwgR19UWVBFX09CSkVDVCkKKworLyoqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioKKyAqIEhlbHBlcnMKKyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCisKKy8qIG1haW4g
Y29udGV4dCAqLworc3RhdGljIGdib29sZWFuCittYWluX2NoYW5uZWxfbWlncmF0aW9uX3NlYW1s
ZXNzX21pZ3JhdGlvbl9oYW5kc2hha2VfY2IoZ3BvaW50ZXIgZGF0YSkKK3sKKyAgICBTcGljZU1h
aW5DaGFubmVsTWlncmF0aW9uICpzZWxmID0gU1BJQ0VfTUFJTl9DSEFOTkVMX01JR1JBVElPTihk
YXRhKTsKKyAgICBTcGljZUNoYW5uZWwgKmNoYW5uZWwgPSBzcGljZV9zZXNzaW9uX2xvb2t1cF9j
aGFubmVsKHNlbGYtPnByaXYtPnRhcmdldF9zZXNzaW9uLCBTUElDRV9DSEFOTkVMX01BSU4sIDAp
OworCisgICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwoc3BpY2VfY2hhbm5lbF9nZXRfc3RhdGUoY2hh
bm5lbCkgPT0gU1BJQ0VfQ0hBTk5FTF9TVEFURV9NSUdSQVRJT05fSEFORFNIQUtFLCBGQUxTRSk7
CisKKyAgICBzcGljZV9jaGFubmVsX3NldF9zdGF0ZShjaGFubmVsLCBTUElDRV9DSEFOTkVMX1NU
QVRFX01JR1JBVElORyk7CisgICAgc2VsZi0+cHJpdi0+bnVtX21pZ3JhdGluZ19jaGFubmVscysr
OworCisgICAgc3BpY2VfZGVidWcoIm1pZ3JhdGlvbjogY2hhbm5lbCBvcGVuZWQgY2hhbjolcCAo
bWFpbikgLSAldS8ldSBpbiBtaWdyYXRpbmcgc3RhdGUiLAorICAgICAgICAgICAgICAgIGNoYW5u
ZWwsIHNlbGYtPnByaXYtPm51bV9taWdyYXRpbmdfY2hhbm5lbHMsIHNlbGYtPnByaXYtPm51bV9j
aGFubmVscyk7CisKKyAgICBpZiAoc2VsZi0+cHJpdi0+bnVtX21pZ3JhdGluZ19jaGFubmVscyA9
PSBzZWxmLT5wcml2LT5udW1fY2hhbm5lbHMpIHsKKyAgICAgICAgY29yb3V0aW5lX3lpZWxkdG8o
c2VsZi0+cHJpdi0+c291cmNlX2Nvcm91dGluZSwgTlVMTCk7CisgICAgfQorICAgIHJldHVybiBG
QUxTRTsKK30KKworLyogbWFpbiBjb250ZXh0ICovCitzdGF0aWMgYm9vbAorbWFpbl9jaGFubmVs
X21pZ3JhdGlvbl9jcmVhdGVfYW5kX2Nvbm5lY3RfY2hhbm5lbChTcGljZU1haW5DaGFubmVsTWln
cmF0aW9uICpzZWxmLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBpbnQgY2hhbm5lbF90eXBlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBpbnQgY2hhbm5lbF9pZCkKK3sKKyAgICBzcGljZV9kZWJ1Zygi
bWlncmF0aW9uOiBjcmVhdGluZyBjaGFubmVsIHR5cGU6ICVkLCBpZDogJWQiLCBjaGFubmVsX3R5
cGUsIGNoYW5uZWxfaWQpOworCisgICAgU3BpY2VDaGFubmVsICpjaGFubmVsID0gc3BpY2VfY2hh
bm5lbF9uZXcoc2VsZi0+cHJpdi0+dGFyZ2V0X3Nlc3Npb24sIGNoYW5uZWxfdHlwZSwgY2hhbm5l
bF9pZCk7CisgICAgYm9vbCBzdWNjZXNzID0gKGNoYW5uZWwgIT0gTlVMTCAmJiBzcGljZV9jaGFu
bmVsX2Nvbm5lY3QoY2hhbm5lbCkpOworICAgIGlmICghc3VjY2VzcykgeworICAgICAgICBzcGlj
ZV9kZWJ1ZygibWlncmF0aW9uOiBmYWlsZWQgdG8gY3JlYXRlIGNoYW5uZWwiKTsKKyAgICAgICAg
cmV0dXJuIGZhbHNlOworICAgIH0KKyAgICBzZWxmLT5wcml2LT5udW1fY2hhbm5lbHMrKzsKKyAg
ICByZXR1cm4gdHJ1ZTsKK30KKworLyogbWFpbiBjb250ZXh0ICovCitzdGF0aWMgdm9pZAorbWFp
bl9jaGFubmVsX21pZ3JhdGlvbl9vbl9jaGFubmVsX2V2ZW50KFNwaWNlQ2hhbm5lbCAqY2hhbm5l
bCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZUNoYW5uZWxF
dmVudCBldmVudCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncG9p
bnRlciBkYXRhKQoreworICAgIFNwaWNlTWFpbkNoYW5uZWxNaWdyYXRpb24gKnNlbGYgPSBTUElD
RV9NQUlOX0NIQU5ORUxfTUlHUkFUSU9OKGRhdGEpOworCisgICAgZ19zaWduYWxfaGFuZGxlcnNf
ZGlzY29ubmVjdF9ieV9mdW5jKGNoYW5uZWwsIG1haW5fY2hhbm5lbF9taWdyYXRpb25fb25fY2hh
bm5lbF9ldmVudCwgZGF0YSk7CisgICAgLyogS2VlcGluZyB0aGUgc2VjdXJpdHkgY2hlY2suIFNo
b3VsZCBhbHdheXMgYmUgcG9zaXRpdmUgaGVyZSwgdGhlIG1haW4tY2hhbm5lbCBhdCBsZWFzdCAq
LworICAgIGdfcmV0dXJuX2lmX2ZhaWwoc2VsZi0+cHJpdi0+bnVtX2NoYW5uZWxzID4gMCk7CisK
KyAgICBzd2l0Y2ggKGV2ZW50KSB7CisgICAgY2FzZSBTUElDRV9DSEFOTkVMX09QRU5FRDoKKyAg
ICB7CisgICAgICAgIGlmIChzcGljZV9jaGFubmVsX2dldF9jaGFubmVsX3R5cGUoY2hhbm5lbCkg
IT0gU1BJQ0VfQ0hBTk5FTF9NQUlOKSB7CisgICAgICAgICAgICBzcGljZV9jaGFubmVsX3NldF9z
dGF0ZShjaGFubmVsLCBTUElDRV9DSEFOTkVMX1NUQVRFX01JR1JBVElORyk7CisgICAgICAgICAg
ICBzZWxmLT5wcml2LT5udW1fbWlncmF0aW5nX2NoYW5uZWxzKys7CisgICAgICAgICAgICBicmVh
azsKKyAgICAgICAgfQorCisgICAgICAgIGlmIChzZWxmLT5wcml2LT5zZWFtbGVzc19taWdyYXRp
b24pIHsKKyAgICAgICAgICAgIC8qIE5vdyB0aGF0IGNoYW5uZWwgaXMgb3BlbiBhbmQgc2VhbWxl
c3MtbWlncmF0aW9uIGlzIHBvc3NpYmxlLCB3ZSB3YWl0CisgICAgICAgICAgICAgKiBmb3IgdGhl
IHNlYW1sZXNzLW1pZ3JhdGlvbi1oYW5kc2hha2UgYWNrL25hY2sgZnJvbSB0YXJnZXQgaG9zdCAq
LworICAgICAgICAgICAgc3BpY2VfY2hhbm5lbF9zZXRfc3RhdGUoY2hhbm5lbCwgU1BJQ0VfQ0hB
Tk5FTF9TVEFURV9NSUdSQVRJT05fSEFORFNIQUtFKTsKKyAgICAgICAgfSBlbHNlIHsKKyAgICAg
ICAgICAgIHNwaWNlX2NoYW5uZWxfc2V0X3N0YXRlKGNoYW5uZWwsIFNQSUNFX0NIQU5ORUxfU1RB
VEVfTUlHUkFUSU5HKTsKKyAgICAgICAgICAgIHNlbGYtPnByaXYtPm51bV9taWdyYXRpbmdfY2hh
bm5lbHMrKzsKKyAgICAgICAgfQorCisgICAgICAgIC8qIG5vdyBjb25uZWN0IHRoZSByZXN0IG9m
IHRoZSBjaGFubmVscyAqLworICAgICAgICBHTGlzdCAqaXQsICpjaGFubmVscyA9IHNwaWNlX3Nl
c3Npb25fZ2V0X2NoYW5uZWxzKHNlbGYtPnByaXYtPnNvdXJjZV9zZXNzaW9uKTsKKyAgICAgICAg
Zm9yIChpdCA9IGNoYW5uZWxzOyBpdCAhPSBOVUxMOyBpdCA9IGl0LT5uZXh0KSB7CisgICAgICAg
ICAgICBTcGljZUNoYW5uZWwgKml0X2NoYW5uZWwgPSBTUElDRV9DSEFOTkVMKGl0LT5kYXRhKTsK
KyAgICAgICAgICAgIGlmIChzcGljZV9jaGFubmVsX2dldF9jaGFubmVsX3R5cGUoaXRfY2hhbm5l
bCkgIT0gU1BJQ0VfQ0hBTk5FTF9NQUlOKSB7CisgICAgICAgICAgICAgICAgbWFpbl9jaGFubmVs
X21pZ3JhdGlvbl9jcmVhdGVfYW5kX2Nvbm5lY3RfY2hhbm5lbChzZWxmLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwaWNlX2NoYW5uZWxfZ2V0X2NoYW5uZWxfdHlw
ZShpdF9jaGFubmVsKSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBz
cGljZV9jaGFubmVsX2dldF9jaGFubmVsX2lkKGl0X2NoYW5uZWwpKTsKKyAgICAgICAgICAgIH0K
KyAgICAgICAgfQorICAgICAgICBnX2xpc3RfZnJlZShjaGFubmVscyk7CisgICAgICAgIGJyZWFr
OworICAgIH0KKyAgICBkZWZhdWx0OgorICAgICAgICBDSEFOTkVMX0RFQlVHKGNoYW5uZWwsICJl
cnJvciBvciB1bmhhbmRsZWQgY2hhbm5lbCBldmVudCBkdXJpbmcgbWlncmF0aW9uOiAldSIsIGV2
ZW50KTsKKyAgICAgICAgLyogZ28gYmFjayB0byBtYWluIGNoYW5uZWwgdG8gcmVwb3J0IGVycm9y
ICovCisgICAgICAgIGNvcm91dGluZV95aWVsZHRvKHNlbGYtPnByaXYtPnNvdXJjZV9jb3JvdXRp
bmUsIE5VTEwpOworICAgICAgICByZXR1cm47CisgICAgfQorCisgICAgc3BpY2VfZGVidWcoIm1p
Z3JhdGlvbjogY2hhbm5lbCBvcGVuZWQgY2hhbjolcCAtICV1LyV1IGluIG1pZ3JhdGluZyBzdGF0
ZSIsCisgICAgICAgICAgICAgICAgY2hhbm5lbCwgc2VsZi0+cHJpdi0+bnVtX21pZ3JhdGluZ19j
aGFubmVscywgc2VsZi0+cHJpdi0+bnVtX2NoYW5uZWxzKTsKKworICAgIGlmIChzZWxmLT5wcml2
LT5udW1fbWlncmF0aW5nX2NoYW5uZWxzID09IHNlbGYtPnByaXYtPm51bV9jaGFubmVscykgewor
ICAgICAgICBjb3JvdXRpbmVfeWllbGR0byhzZWxmLT5wcml2LT5zb3VyY2VfY29yb3V0aW5lLCBO
VUxMKTsKKyAgICB9Cit9CisKKy8qIG1haW4gY29udGV4dCAqLworc3RhdGljIHZvaWQKK21haW5f
Y2hhbm5lbF9taWdyYXRpb25fb25fY2hhbm5lbF9uZXcoU3BpY2VTZXNzaW9uICp0YXJnZXRfc2Vz
c2lvbiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VDaGFubmVs
ICpjaGFubmVsLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncG9pbnRl
ciBkYXRhKQoreworICAgIGdfc2lnbmFsX2Nvbm5lY3QoY2hhbm5lbCwgImNoYW5uZWwtZXZlbnQi
LAorICAgICAgICAgICAgICAgICAgICAgR19DQUxMQkFDSyhtYWluX2NoYW5uZWxfbWlncmF0aW9u
X29uX2NoYW5uZWxfZXZlbnQpLCBkYXRhKTsKK30KKworLyogbWFpbiBjb250ZXh0ICovCitzdGF0
aWMgZ2Jvb2xlYW4KK21haW5fY2hhbm5lbF9taWdyYXRpb25fcnVuX2NiKGdwb2ludGVyIGRhdGEp
Cit7CisgICAgU3BpY2VNYWluQ2hhbm5lbE1pZ3JhdGlvbiAqc2VsZiA9IFNQSUNFX01BSU5fQ0hB
Tk5FTF9NSUdSQVRJT04oZGF0YSk7CisKKyAgICBzcGljZV9zZXNzaW9uX3NldF9taWdyYXRpb25f
c3RhdGUoc2VsZi0+cHJpdi0+dGFyZ2V0X3Nlc3Npb24sCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIFNQSUNFX1NFU1NJT05fTUlHUkFUSU9OX0NPTk5FQ1RJTkcpOworICAg
IGdfc2lnbmFsX2Nvbm5lY3Qoc2VsZi0+cHJpdi0+dGFyZ2V0X3Nlc3Npb24sICJjaGFubmVsLW5l
dyIsCisgICAgICAgICAgICAgICAgICAgICBHX0NBTExCQUNLKG1haW5fY2hhbm5lbF9taWdyYXRp
b25fb25fY2hhbm5lbF9uZXcpLCBzZWxmKTsKKyAgICAvKiB0aGUgbWlncmF0aW9uIHByb2Nlc3Mg
aXMgaW4gMiBzdGVwcywgZmlyc3QgdGhlIG1haW4gY2hhbm5lbCBhbmQKKyAgICAgICB0aGVuIHRo
ZSByZXN0IG9mIHRoZSBjaGFubmVscyAqLworICAgIG1haW5fY2hhbm5lbF9taWdyYXRpb25fY3Jl
YXRlX2FuZF9jb25uZWN0X2NoYW5uZWwoc2VsZiwgU1BJQ0VfQ0hBTk5FTF9NQUlOLCAwKTsKKwor
ICAgIHJldHVybiBGQUxTRTsKK30KKworLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKKyAqIEludGVy
bmFsIEFQSQorICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KKworLyogY29yb3V0aW5lIGNvbnRleHQg
Ki8KK0dfR05VQ19JTlRFUk5BTAorYm9vbCBzcGljZV9tYWluX2NoYW5uZWxfbWlncmF0aW9uX2lu
aXRfbWlncmF0aW9uKFNwaWNlTWFpbkNoYW5uZWxNaWdyYXRpb24gKnNlbGYpCit7CisgICAgLyog
T24gU3BpY2VNYWluQ2hhbm5lbE1pZ3JhdGlvbiBjcmVhdGlvbiwgd2UgY2hlY2sgYm90aCBzb3Vy
Y2Vfc2Vzc2lvbiBhbmQKKyAgICAgKiB0YXJnZXRfc2Vzc2lvbiBhbmQgaW5pdGlhbGl6YXRpb24g
d291bGQgZmFpbCBpZiBtaW5pbXVtIHBhcmFtZXRlcnMgd2VyZQorICAgICAqIGxhY2tpbmcuIFRo
ZSBndWFyZCBiZWxvdyBpcyBlbm91Z2ggZm9yIG1pbmltYWwgY2hlY2sgKi8KKyAgICBnX3JldHVy
bl92YWxfaWZfZmFpbChTUElDRV9JU19NQUlOX0NIQU5ORUxfTUlHUkFUSU9OKHNlbGYpLCBGQUxT
RSk7CisKKyAgICAvKiBubyBuZWVkIHRvIHRyYWNrIGlkbGUsIGNhbGwgaXMgc3luYyBmb3IgdGhp
cyBjb3JvdXRpbmUgKi8KKyAgICBnX2lkbGVfYWRkKG1haW5fY2hhbm5lbF9taWdyYXRpb25fcnVu
X2NiLCBzZWxmKTsKKworICAgIC8qIHN3aXRjaCB0byBtYWluIGxvb3AgYW5kIHdhaXQgZm9yIGNv
bm5lY3Rpb25zICovCisgICAgY29yb3V0aW5lX3lpZWxkKE5VTEwpOworCisgICAgcmV0dXJuIHNl
bGYtPnByaXYtPm51bV9jaGFubmVscyA9PSBzZWxmLT5wcml2LT5udW1fbWlncmF0aW5nX2NoYW5u
ZWxzOworfQorCisvKiBjb3JvdXRpbmUgY29udGV4dCAqLworR19HTlVDX0lOVEVSTkFMIHZvaWQK
K3NwaWNlX21haW5fY2hhbm5lbF9taWdyYXRpb25fc2VhbWxlc3NfaGFuZHNoYWtlX2RvbmUoU3Bp
Y2VNYWluQ2hhbm5lbE1pZ3JhdGlvbiAqc2VsZiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2Jvb2xlYW4gc2VhbWxlc3NfbWlncmF0aW9uKQor
eworICAgIHNlbGYtPnByaXYtPnNlYW1sZXNzX21pZ3JhdGlvbiA9IHNlYW1sZXNzX21pZ3JhdGlv
bjsKKyAgICAvKiBtb3ZlIHRvIG1haW4gY29udGV4dCAqLworICAgIGdfaWRsZV9hZGQobWFpbl9j
aGFubmVsX21pZ3JhdGlvbl9zZWFtbGVzc19taWdyYXRpb25faGFuZHNoYWtlX2NiLCBzZWxmKTsK
K30KKworR19HTlVDX0lOVEVSTkFMCitndWludCBzcGljZV9tYWluX2NoYW5uZWxfbWlncmF0aW9u
X2dldF9zb3VyY2VfaG9zdF92ZXJzaW9uKFNwaWNlTWFpbkNoYW5uZWxNaWdyYXRpb24gKnNlbGYp
Cit7CisgICAgcmV0dXJuIHNlbGYtPnByaXYtPnNvdXJjZV9ob3N0X3ZlcnNpb247Cit9CisKK0df
R05VQ19JTlRFUk5BTAorYm9vbCBzcGljZV9tYWluX2NoYW5uZWxfbWlncmF0aW9uX2lzX3NlYW1s
ZXNzKFNwaWNlTWFpbkNoYW5uZWxNaWdyYXRpb24gKnNlbGYpCit7CisgICAgcmV0dXJuIHNlbGYt
PnByaXYtPnNlYW1sZXNzX21pZ3JhdGlvbjsKK30KKworLyoqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioK
KyAqIEdPYmplY3QKKyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCisKK3N0YXRpYyB2b2lkCitzcGlj
ZV9tYWluX2NoYW5uZWxfbWlncmF0aW9uX2luaXQoU3BpY2VNYWluQ2hhbm5lbE1pZ3JhdGlvbiAq
c2VsZikKK3sKKyAgICAgc2VsZi0+cHJpdiA9IHNwaWNlX21haW5fY2hhbm5lbF9taWdyYXRpb25f
Z2V0X2luc3RhbmNlX3ByaXZhdGUoc2VsZik7Cit9CisKK3N0YXRpYyB2b2lkCitzcGljZV9tYWlu
X2NoYW5uZWxfbWlncmF0aW9uX2Rpc3Bvc2UoR09iamVjdCAqZ29iamVjdCkKK3sKKyAgICBTcGlj
ZU1haW5DaGFubmVsTWlncmF0aW9uICpzZWxmID0gU1BJQ0VfTUFJTl9DSEFOTkVMX01JR1JBVElP
Tihnb2JqZWN0KTsKKworICAgIGdfY2xlYXJfb2JqZWN0KCZzZWxmLT5wcml2LT50YXJnZXRfc2Vz
c2lvbik7CisgICAgZ19jbGVhcl9vYmplY3QoJnNlbGYtPnByaXYtPnNvdXJjZV9zZXNzaW9uKTsK
KworICAgIGlmIChHX09CSkVDVF9DTEFTUyhzcGljZV9tYWluX2NoYW5uZWxfbWlncmF0aW9uX3Bh
cmVudF9jbGFzcyktPmRpc3Bvc2UpIHsKKyAgICAgICAgR19PQkpFQ1RfQ0xBU1Moc3BpY2VfbWFp
bl9jaGFubmVsX21pZ3JhdGlvbl9wYXJlbnRfY2xhc3MpLT5kaXNwb3NlKGdvYmplY3QpOworICAg
IH0KK30KKworc3RhdGljIHZvaWQKK3NwaWNlX21haW5fY2hhbm5lbF9taWdyYXRpb25fZ2V0X3By
b3BlcnR5KEdPYmplY3QgKm9iamVjdCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGd1aW50IHByb3BlcnR5X2lkLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgR1ZhbHVlICp2YWx1ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIEdQYXJhbVNwZWMgKnBzcGVjKQoreworICAgIFNwaWNlTWFpbkNoYW5u
ZWxNaWdyYXRpb24gKnNlbGYgPSBTUElDRV9NQUlOX0NIQU5ORUxfTUlHUkFUSU9OKG9iamVjdCk7
CisKKyAgICBzd2l0Y2ggKHByb3BlcnR5X2lkKSB7CisgICAgY2FzZSBQUk9QX0NPUk9VVElORV9D
T05URVhUOgorICAgICAgICBnX3ZhbHVlX3NldF9wb2ludGVyKHZhbHVlLCBzZWxmLT5wcml2LT5z
b3VyY2VfY29yb3V0aW5lKTsKKyAgICAgICAgYnJlYWs7CisKKyAgICBjYXNlIFBST1BfU0VBTUxF
U1NfTUlHUkFUSU9OOgorICAgICAgICBnX3ZhbHVlX3NldF9ib29sZWFuKHZhbHVlLCBzZWxmLT5w
cml2LT5zZWFtbGVzc19taWdyYXRpb24pOworICAgICAgICBicmVhazsKKworICAgIGNhc2UgUFJP
UF9TT1VSQ0VfSE9TVF9WRVJTSU9OOgorICAgICAgICBnX3ZhbHVlX3NldF91aW50KHZhbHVlLCBz
ZWxmLT5wcml2LT5zb3VyY2VfaG9zdF92ZXJzaW9uKTsKKyAgICAgICAgYnJlYWs7CisKKyAgICBj
YXNlIFBST1BfU09VUkNFX1NFU1NJT046CisgICAgICAgIGdfdmFsdWVfc2V0X29iamVjdCh2YWx1
ZSwgc2VsZi0+cHJpdi0+c291cmNlX3Nlc3Npb24pOworICAgICAgICBicmVhazsKKworICAgIGNh
c2UgUFJPUF9UQVJHRVRfU0VTU0lPTjoKKyAgICAgICAgZ192YWx1ZV9zZXRfb2JqZWN0KHZhbHVl
LCBzZWxmLT5wcml2LT50YXJnZXRfc2Vzc2lvbik7CisgICAgICAgIGJyZWFrOworCisgICAgZGVm
YXVsdDoKKyAgICAgICAgR19PQkpFQ1RfV0FSTl9JTlZBTElEX1BST1BFUlRZX0lEKG9iamVjdCwg
cHJvcGVydHlfaWQsIHBzcGVjKTsKKyAgICAgICAgYnJlYWs7CisgICAgfQorfQorCitzdGF0aWMg
dm9pZAorc3BpY2VfbWFpbl9jaGFubmVsX21pZ3JhdGlvbl9zZXRfcHJvcGVydHkoR09iamVjdCAq
b2JqZWN0LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3VpbnQg
cHJvcGVydHlfaWQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBj
b25zdCBHVmFsdWUgKnZhbHVlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgR1BhcmFtU3BlYyAqcHNwZWMpCit7CisgICAgU3BpY2VNYWluQ2hhbm5lbE1pZ3JhdGlv
biAqc2VsZiA9IFNQSUNFX01BSU5fQ0hBTk5FTF9NSUdSQVRJT04ob2JqZWN0KTsKKworICAgIHN3
aXRjaCAocHJvcGVydHlfaWQpIHsKKyAgICBjYXNlIFBST1BfQ09ST1VUSU5FX0NPTlRFWFQ6Cisg
ICAgICAgIHNlbGYtPnByaXYtPnNvdXJjZV9jb3JvdXRpbmUgPSBnX3ZhbHVlX2dldF9wb2ludGVy
KHZhbHVlKTsKKyAgICAgICAgYnJlYWs7CisKKyAgICBjYXNlIFBST1BfU0VBTUxFU1NfTUlHUkFU
SU9OOgorICAgICAgICBzZWxmLT5wcml2LT5zZWFtbGVzc19taWdyYXRpb24gPSBnX3ZhbHVlX2dl
dF9ib29sZWFuKHZhbHVlKTsKKyAgICAgICAgYnJlYWs7CisKKyAgICBjYXNlIFBST1BfU09VUkNF
X0hPU1RfVkVSU0lPTjoKKyAgICAgICAgc2VsZi0+cHJpdi0+c291cmNlX2hvc3RfdmVyc2lvbiA9
IGdfdmFsdWVfZ2V0X3VpbnQodmFsdWUpOworICAgICAgICBicmVhazsKKworICAgIGNhc2UgUFJP
UF9TT1VSQ0VfU0VTU0lPTjoKKyAgICAgICAgZ19jbGVhcl9vYmplY3QoJnNlbGYtPnByaXYtPnNv
dXJjZV9zZXNzaW9uKTsKKyAgICAgICAgc2VsZi0+cHJpdi0+c291cmNlX3Nlc3Npb24gPSBnX3Zh
bHVlX2R1cF9vYmplY3QodmFsdWUpOworICAgICAgICBicmVhazsKKworICAgIGNhc2UgUFJPUF9U
QVJHRVRfU0VTU0lPTjoKKyAgICAgICAgZ19jbGVhcl9vYmplY3QoJnNlbGYtPnByaXYtPnRhcmdl
dF9zZXNzaW9uKTsKKyAgICAgICAgc2VsZi0+cHJpdi0+dGFyZ2V0X3Nlc3Npb24gPSBnX3ZhbHVl
X2R1cF9vYmplY3QodmFsdWUpOworICAgICAgICBicmVhazsKKworICAgIGRlZmF1bHQ6CisgICAg
ICAgIEdfT0JKRUNUX1dBUk5fSU5WQUxJRF9QUk9QRVJUWV9JRChvYmplY3QsIHByb3BlcnR5X2lk
LCBwc3BlYyk7CisgICAgICAgIGJyZWFrOworICAgIH0KK30KKworc3RhdGljIHZvaWQKK3NwaWNl
X21haW5fY2hhbm5lbF9taWdyYXRpb25fY29uc3RydWN0ZWQoR09iamVjdCAqZ29iamVjdCkKK3sK
KyAgICBTcGljZU1haW5DaGFubmVsTWlncmF0aW9uICpzZWxmID0gU1BJQ0VfTUFJTl9DSEFOTkVM
X01JR1JBVElPTihnb2JqZWN0KTsKKworICAgIGdfcmV0dXJuX2lmX2ZhaWwoU1BJQ0VfSVNfU0VT
U0lPTihzZWxmLT5wcml2LT5zb3VyY2Vfc2Vzc2lvbikpOworICAgIGdfcmV0dXJuX2lmX2ZhaWwo
U1BJQ0VfSVNfU0VTU0lPTihzZWxmLT5wcml2LT50YXJnZXRfc2Vzc2lvbikpOworICAgIGdfcmV0
dXJuX2lmX2ZhaWwoc3BpY2Vfc2Vzc2lvbl9nZXRfbWFpbl9jaGFubmVsX21pZ3JhdGlvbihzZWxm
LT5wcml2LT5zb3VyY2Vfc2Vzc2lvbikgPT0gTlVMTCk7CisgICAgZ19yZXR1cm5faWZfZmFpbChz
cGljZV9zZXNzaW9uX2dldF9tYWluX2NoYW5uZWxfbWlncmF0aW9uKHNlbGYtPnByaXYtPnRhcmdl
dF9zZXNzaW9uKSA9PSBOVUxMKTsKKworICAgIHNwaWNlX3Nlc3Npb25fc2V0X21haW5fY2hhbm5l
bF9taWdyYXRpb24oc2VsZi0+cHJpdi0+c291cmNlX3Nlc3Npb24sIHNlbGYpOworICAgIHNwaWNl
X3Nlc3Npb25fc2V0X21haW5fY2hhbm5lbF9taWdyYXRpb24oc2VsZi0+cHJpdi0+dGFyZ2V0X3Nl
c3Npb24sIHNlbGYpOworCisgICAgaWYgKEdfT0JKRUNUX0NMQVNTKHNwaWNlX21haW5fY2hhbm5l
bF9taWdyYXRpb25fcGFyZW50X2NsYXNzKS0+Y29uc3RydWN0ZWQpIHsKKyAgICAgICAgR19PQkpF
Q1RfQ0xBU1Moc3BpY2VfbWFpbl9jaGFubmVsX21pZ3JhdGlvbl9wYXJlbnRfY2xhc3MpLT5jb25z
dHJ1Y3RlZChnb2JqZWN0KTsKKyAgICB9Cit9CisKK3N0YXRpYyB2b2lkCitzcGljZV9tYWluX2No
YW5uZWxfbWlncmF0aW9uX2NsYXNzX2luaXQoU3BpY2VNYWluQ2hhbm5lbE1pZ3JhdGlvbkNsYXNz
ICprbGFzcykKK3sKKyAgICBHT2JqZWN0Q2xhc3MgKmdvYmplY3RfY2xhc3MgPSBHX09CSkVDVF9D
TEFTUyAoa2xhc3MpOworCisgICAgZ29iamVjdF9jbGFzcy0+ZGlzcG9zZSA9IHNwaWNlX21haW5f
Y2hhbm5lbF9taWdyYXRpb25fZGlzcG9zZTsKKyAgICBnb2JqZWN0X2NsYXNzLT5nZXRfcHJvcGVy
dHkgPSBzcGljZV9tYWluX2NoYW5uZWxfbWlncmF0aW9uX2dldF9wcm9wZXJ0eTsKKyAgICBnb2Jq
ZWN0X2NsYXNzLT5zZXRfcHJvcGVydHkgPSBzcGljZV9tYWluX2NoYW5uZWxfbWlncmF0aW9uX3Nl
dF9wcm9wZXJ0eTsKKyAgICBnb2JqZWN0X2NsYXNzLT5jb25zdHJ1Y3RlZCA9IHNwaWNlX21haW5f
Y2hhbm5lbF9taWdyYXRpb25fY29uc3RydWN0ZWQ7CisKKyAgICBnX3Byb3BlcnRpZXNbUFJPUF9D
T1JPVVRJTkVfQ09OVEVYVF0gPQorICAgICAgICBnX3BhcmFtX3NwZWNfcG9pbnRlcigiY29yb3V0
aW5lLWNvbnRleHQiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQ29yb3V0aW5lIGNv
bnRleHQiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQ29yb3V0aW5lIGNvbnRleHQg
dG8geWllbGQgYmFjayBvbiBmYWlsdXJlIiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IEdfUEFSQU1fUkVBRFdSSVRFIHwgR19QQVJBTV9DT05TVFJVQ1RfT05MWSB8IEdfUEFSQU1fU1RB
VElDX1NUUklOR1MpOworCisKKyAgICBnX3Byb3BlcnRpZXNbUFJPUF9TRUFNTEVTU19NSUdSQVRJ
T05dID0KKyAgICAgICAgZ19wYXJhbV9zcGVjX2Jvb2xlYW4oInNlYW1sZXNzLW1pZ3JhdGlvbiIs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJTZWFtbGVzcyBtaWdyYXRpb24iLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAiVG8gZW5hYmxlIHNlYW1sZXNzIG1pZ3JhdGlvbiIs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZBTFNFLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBHX1BBUkFNX1JFQURXUklURSB8IEdfUEFSQU1fU1RBVElDX1NUUklOR1MpOwor
CisgICAgZ19wcm9wZXJ0aWVzW1BST1BfU09VUkNFX0hPU1RfVkVSU0lPTl0gPQorICAgICAgICBn
X3BhcmFtX3NwZWNfdWludCgic291cmNlLWhvc3QtdmVyc2lvbiIsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICJTb3VyY2UgU2Vzc2lvbiIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICJD
dXJyZW50IHNlc3Npb24gdGhhdCB3ZSBhcmUgbWlncmF0aW5nIGZyb20iLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAwLCBHX01BWFVJTlQsIDAsCisgICAgICAgICAgICAgICAgICAgICAgICAg
IEdfUEFSQU1fUkVBRFdSSVRFIHwgR19QQVJBTV9DT05TVFJVQ1RfT05MWSB8IEdfUEFSQU1fU1RB
VElDX1NUUklOR1MpOworCisgICAgZ19wcm9wZXJ0aWVzW1BST1BfU09VUkNFX1NFU1NJT05dID0K
KyAgICAgICAgZ19wYXJhbV9zcGVjX29iamVjdCgic291cmNlLXNlc3Npb24iLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICJTb3VyY2UgU2Vzc2lvbiIsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIkN1cnJlbnQgc2Vzc2lvbiB0aGF0IHdlIGFyZSBtaWdyYXRpbmcgZnJvbSIsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgU1BJQ0VfVFlQRV9TRVNTSU9OLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIEdfUEFSQU1fUkVBRFdSSVRFIHwgR19QQVJBTV9DT05TVFJVQ1Rf
T05MWSB8IEdfUEFSQU1fU1RBVElDX1NUUklOR1MpOworCisgICAgZ19wcm9wZXJ0aWVzW1BST1Bf
VEFSR0VUX1NFU1NJT05dID0KKyAgICAgICAgZ19wYXJhbV9zcGVjX29iamVjdCgidGFyZ2V0LXNl
c3Npb24iLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICJUYXJnZXQgU2Vzc2lvbiIsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIlRhcmdldCBzZXNzaW9uIHdlIGFyZSBjb25uZWN0
aW5nIHRvIiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBTUElDRV9UWVBFX1NFU1NJT04s
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgR19QQVJBTV9SRUFEV1JJVEUgfCBHX1BBUkFN
X0NPTlNUUlVDVF9PTkxZIHwgR19QQVJBTV9TVEFUSUNfU1RSSU5HUyk7CisKKyAgICBnX29iamVj
dF9jbGFzc19pbnN0YWxsX3Byb3BlcnRpZXMoZ29iamVjdF9jbGFzcywgUFJPUF9MQVNULCBnX3By
b3BlcnRpZXMpOworfQorCmRpZmYgLS1naXQgYS9zcmMvY2hhbm5lbC1tYWluLW1pZ3JhdGlvbi5o
IGIvc3JjL2NoYW5uZWwtbWFpbi1taWdyYXRpb24uaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRl
eCAwMDAwMDAwLi4xNWE3ZTM3Ci0tLSAvZGV2L251bGwKKysrIGIvc3JjL2NoYW5uZWwtbWFpbi1t
aWdyYXRpb24uaApAQCAtMCwwICsxLDYzIEBACisvKiAtKi0gTW9kZTogQzsgYy1iYXNpYy1vZmZz
ZXQ6IDQ7IGluZGVudC10YWJzLW1vZGU6IG5pbCAtKi0gKi8KKy8qCisgICBDb3B5cmlnaHQgKEMp
IDIwMTkgUmVkIEhhdCwgSW5jLgorCisgICBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsg
eW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCisgICBtb2RpZnkgaXQgdW5kZXIgdGhlIHRl
cm1zIG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCisgICBMaWNlbnNlIGFzIHB1Ymxp
c2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIKKyAgIHZlcnNpb24g
Mi4xIG9mIHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9u
LgorCisgICBUaGlzIGxpYnJhcnkgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3
aWxsIGJlIHVzZWZ1bCwKKyAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVu
IHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCisgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBG
T1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQorICAgTGVzc2VyIEdlbmVyYWwg
UHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKworICAgWW91IHNob3VsZCBoYXZlIHJl
Y2VpdmVkIGEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYworICAgTGljZW5z
ZSBhbG9uZyB3aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9y
Zy9saWNlbnNlcy8+LgorKi8KKyNpZm5kZWYgX19TUElDRV9DTElFTlRfTUFJTl9DSEFOTkVMX01J
R1JBVElPTl9IX18KKyNkZWZpbmUgX19TUElDRV9DTElFTlRfTUFJTl9DSEFOTkVMX01JR1JBVElP
Tl9IX18KKworI2lmICFkZWZpbmVkKF9fU1BJQ0VfQ0xJRU5UX0hfSU5TSURFX18pICYmICFkZWZp
bmVkKFNQSUNFX0NPTVBJTEFUSU9OKQorI3dhcm5pbmcgIk9ubHkgPHNwaWNlLWNsaWVudC5oPiBj
YW4gYmUgaW5jbHVkZWQgZGlyZWN0bHkiCisjZW5kaWYKKworI2luY2x1ZGUgInNwaWNlLWNsaWVu
dC5oIgorCisjaW5jbHVkZSA8c3RkYm9vbC5oPgorCitHX0JFR0lOX0RFQ0xTCisKKyNkZWZpbmUg
U1BJQ0VfVFlQRV9NQUlOX0NIQU5ORUxfTUlHUkFUSU9OICAgKHNwaWNlX21haW5fY2hhbm5lbF9t
aWdyYXRpb25fZ2V0X3R5cGUoKSkKKyNkZWZpbmUgU1BJQ0VfTUFJTl9DSEFOTkVMX01JR1JBVElP
TihvYmopICAgKEdfVFlQRV9DSEVDS19JTlNUQU5DRV9DQVNUKChvYmopLCBcCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTUElDRV9UWVBFX01BSU5fQ0hBTk5F
TF9NSUdSQVRJT04sIFwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIFNwaWNlTWFpbkNoYW5uZWxNaWdyYXRpb24pKQorI2RlZmluZSBTUElDRV9NQUlOX0NIQU5O
RUxfTUlHUkFUSU9OX0NMQVNTKGtsYXNzKSAgIChHX1RZUEVfQ0hFQ0tfQ0xBU1NfQ0FTVCgoa2xh
c3MpLCBcCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIFNQSUNFX1RZUEVfTUFJTl9DSEFOTkVMX01JR1JBVElPTiwgXAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZU1haW5DaGFubmVsTWln
cmF0aW9uQ2xhc3MpKQorI2RlZmluZSBTUElDRV9JU19NQUlOX0NIQU5ORUxfTUlHUkFUSU9OKG9i
aikgICAgKEdfVFlQRV9DSEVDS19JTlNUQU5DRV9UWVBFKChvYmopLCBcCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU1BJQ0VfVFlQRV9NQUlOX0NIQU5O
RUxfTUlHUkFUSU9OKSkKKyNkZWZpbmUgU1BJQ0VfSVNfTUFJTl9DSEFOTkVMX01JR1JBVElPTl9D
TEFTUyhrbGFzcykgICAgKEdfVFlQRV9DSEVDS19DTEFTU19UWVBFKChrbGFzcyksIFwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNQSUNF
X1RZUEVfTUFJTl9DSEFOTkVMX01JR1JBVElPTikpCisjZGVmaW5lIFNQSUNFX01BSU5fQ0hBTk5F
TF9NSUdSQVRJT05fR0VUX0NMQVNTKG9iaikgKEdfVFlQRV9JTlNUQU5DRV9HRVRfQ0xBU1MoKG9i
aiksIFwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgU1BJQ0VfVFlQRV9NQUlOX0NIQU5ORUxfTUlHUkFUSU9OLCBcCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNlTWFpbkNoYW5uZWxNaWdy
YXRpb25DbGFzcykpCisKKy8qKgorICogU3BpY2VNYWluQ2hhbm5lbE1pZ3JhdGlvbgorICoKKyAq
IE9wYXF1ZSBkYXRhIHN0cnVjdHVyZS4KKyAqKi8KK3R5cGVkZWYgc3RydWN0IF9TcGljZU1haW5D
aGFubmVsTWlncmF0aW9uIFNwaWNlTWFpbkNoYW5uZWxNaWdyYXRpb247Cit0eXBlZGVmIHN0cnVj
dCBfU3BpY2VNYWluQ2hhbm5lbE1pZ3JhdGlvbkNsYXNzIFNwaWNlTWFpbkNoYW5uZWxNaWdyYXRp
b25DbGFzczsKKworR1R5cGUgc3BpY2VfbWFpbl9jaGFubmVsX21pZ3JhdGlvbl9nZXRfdHlwZSh2
b2lkKSBHX0dOVUNfQ09OU1Q7Citib29sIHNwaWNlX21haW5fY2hhbm5lbF9taWdyYXRpb25faW5p
dF9taWdyYXRpb24oU3BpY2VNYWluQ2hhbm5lbE1pZ3JhdGlvbiAqc2VsZik7Cit2b2lkIHNwaWNl
X21haW5fY2hhbm5lbF9taWdyYXRpb25fc2VhbWxlc3NfaGFuZHNoYWtlX2RvbmUoU3BpY2VNYWlu
Q2hhbm5lbE1pZ3JhdGlvbiAqc2VsZiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBnYm9vbGVhbiBzZWFtbGVzc19taWdyYXRpb24pOwor
Z3VpbnQgc3BpY2VfbWFpbl9jaGFubmVsX21pZ3JhdGlvbl9nZXRfc291cmNlX2hvc3RfdmVyc2lv
bihTcGljZU1haW5DaGFubmVsTWlncmF0aW9uICpzZWxmKTsKK2Jvb2wgc3BpY2VfbWFpbl9jaGFu
bmVsX21pZ3JhdGlvbl9pc19zZWFtbGVzcyhTcGljZU1haW5DaGFubmVsTWlncmF0aW9uICpzZWxm
KTsKKworR19FTkRfREVDTFMKKworI2VuZGlmIC8qIF9fU1BJQ0VfQ0xJRU5UX01BSU5fQ0hBTk5F
TF9NSUdSQVRJT05fSF9fICovCmRpZmYgLS1naXQgYS9zcmMvY2hhbm5lbC1tYWluLmMgYi9zcmMv
Y2hhbm5lbC1tYWluLmMKaW5kZXggM2RiYTM5OS4uM2JkOTFiOCAxMDA2NDQKLS0tIGEvc3JjL2No
YW5uZWwtbWFpbi5jCisrKyBiL3NyYy9jaGFubmVsLW1haW4uYwpAQCAtMzEsNiArMzEsNyBAQAog
I2luY2x1ZGUgInNwaWNlLXNlc3Npb24tcHJpdi5oIgogI2luY2x1ZGUgInNwaWNlLWF1ZGlvLXBy
aXYuaCIKICNpbmNsdWRlICJzcGljZS1maWxlLXRyYW5zZmVyLXRhc2stcHJpdi5oIgorI2luY2x1
ZGUgImNoYW5uZWwtbWFpbi1taWdyYXRpb24uaCIKIAogLyoqCiAgKiBTRUNUSU9OOmNoYW5uZWwt
bWFpbgpAQCAtNTAsOCArNTEsNiBAQAogCiAjZGVmaW5lIE1BWF9ESVNQTEFZIDE2IC8qIE5vdGUg
bXVzdCBmaXQgaW4gYSBndWludDMyLCBzZWUgbW9uaXRvcnNfYWxpZ24gKi8KIAotdHlwZWRlZiBz
dHJ1Y3Qgc3BpY2VfbWlncmF0ZSBzcGljZV9taWdyYXRlOwotCiB0eXBlZGVmIGVudW0gewogICAg
IERJU1BMQVlfVU5ERUZJTkVELAogICAgIERJU1BMQVlfRElTQUJMRUQsCkBAIC0xMDksNyArMTA4
LDYgQEAgc3RydWN0IF9TcGljZU1haW5DaGFubmVsUHJpdmF0ZSAgewogCiAgICAgZ3VpbnQgICAg
ICAgICAgICAgICAgICAgICAgIHN3aXRjaF9ob3N0X2RlbGF5ZWRfaWQ7CiAgICAgZ3VpbnQgICAg
ICAgICAgICAgICAgICAgICAgIG1pZ3JhdGVfZGVsYXllZF9pZDsKLSAgICBzcGljZV9taWdyYXRl
ICAgICAgICAgICAgICAgKm1pZ3JhdGVfZGF0YTsKICAgICBpbnQgICAgICAgICAgICAgICAgICAg
ICAgICAgbWF4X2NsaXBib2FyZDsKIAogICAgIGdib29sZWFuICAgICAgICAgICAgICAgICAgICBh
Z2VudF92b2x1bWVfcGxheWJhY2tfc3luYzsKQEAgLTExNywyMSArMTE1LDYgQEAgc3RydWN0IF9T
cGljZU1haW5DaGFubmVsUHJpdmF0ZSAgewogICAgIEdDYW5jZWxsYWJsZSAgICAgICAgICAgICAg
ICAqY2FuY2VsbGFibGVfdm9sdW1lX2luZm87CiB9OwogCi1zdHJ1Y3Qgc3BpY2VfbWlncmF0ZSB7
Ci0gICAgc3RydWN0IGNvcm91dGluZSAqZnJvbTsKLSAgICBTcGljZU1pZ3JhdGlvbkRzdEluZm8g
KmluZm87Ci0gICAgU3BpY2VTZXNzaW9uICpzZXNzaW9uOwotICAgIGd1aW50IG5jaGFubmVsczsK
LSAgICBTcGljZUNoYW5uZWwgKnNyY19jaGFubmVsOwotICAgIFNwaWNlQ2hhbm5lbCAqZHN0X2No
YW5uZWw7Ci0gICAgYm9vbCBkb19zZWFtbGVzczsgLyogdXNlZCBhcyBpbnB1dCBhbmQgb3V0cHV0
IGZvciB0aGUgc2VhbWxlc3MgbWlncmF0aW9uIGhhbmRzaGFrZS4KLSAgICAgICAgICAgICAgICAg
ICAgICAgICBpbnB1dDogd2hldGhlciB0byBzZW5kIHRvIHRoZSBkZXN0IFNQSUNFX01TR0NfTUFJ
Tl9NSUdSQVRFX0RTVF9ET19TRUFNTEVTUwotICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1
dDogd2hldGhlciB0aGUgZGVzdCBhcHByb3ZlZCBzZWFtbGVzcyBtaWdyYXRpb24KLSAgICAgICAg
ICAgICAgICAgICAgICAgICAoU1BJQ0VfTVNHX01BSU5fTUlHUkFURV9EU1RfU0VBTUxFU1NfQUNL
L05BQ0spCi0gICAgICAgICAgICAgICAgICAgICAgICovCi0gICAgdWludDMyX3Qgc3JjX21pZ192
ZXJzaW9uOwotfTsKLQogR19ERUZJTkVfVFlQRV9XSVRIX1BSSVZBVEUoU3BpY2VNYWluQ2hhbm5l
bCwgc3BpY2VfbWFpbl9jaGFubmVsLCBTUElDRV9UWVBFX0NIQU5ORUwpCiAKIC8qIFByb3BlcnRp
ZXMgKi8KQEAgLTE3Miw5ICsxNTUsNiBAQCBzdGF0aWMgdm9pZCBzcGljZV9tYWluX2hhbmRsZV9t
c2coU3BpY2VDaGFubmVsICpjaGFubmVsLCBTcGljZU1zZ0luICptc2cpOwogc3RhdGljIHZvaWQg
Y2hhbm5lbF9zZXRfaGFuZGxlcnMoU3BpY2VDaGFubmVsQ2xhc3MgKmtsYXNzKTsKIHN0YXRpYyB2
b2lkIGFnZW50X3NlbmRfbXNnX3F1ZXVlKFNwaWNlTWFpbkNoYW5uZWwgKmNoYW5uZWwpOwogc3Rh
dGljIHZvaWQgYWdlbnRfZnJlZV9tc2dfcXVldWUoU3BpY2VNYWluQ2hhbm5lbCAqY2hhbm5lbCk7
Ci1zdGF0aWMgdm9pZCBtaWdyYXRlX2NoYW5uZWxfZXZlbnRfY2IoU3BpY2VDaGFubmVsICpjaGFu
bmVsLCBTcGljZUNoYW5uZWxFdmVudCBldmVudCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBncG9pbnRlciBkYXRhKTsKLXN0YXRpYyBnYm9vbGVhbiBtYWluX21pZ3JhdGVf
aGFuZHNoYWtlX2RvbmUoZ3BvaW50ZXIgZGF0YSk7CiBzdGF0aWMgdm9pZCBzcGljZV9tYWluX2No
YW5uZWxfc2VuZF9taWdyYXRpb25faGFuZHNoYWtlKFNwaWNlQ2hhbm5lbCAqY2hhbm5lbCk7CiBz
dGF0aWMgdm9pZCBmaWxlX3hmZXJfZmx1c2hlZChTcGljZU1haW5DaGFubmVsICpjaGFubmVsLCBn
Ym9vbGVhbiBzdWNjZXNzKTsKIHN0YXRpYyB2b2lkIGZpbGVfeGZlcl9yZWFkX2FzeW5jX2NiKEdP
YmplY3QgKnNvdXJjZV9vYmplY3QsCkBAIC0yMTYxLDM3ICsyMTQxLDE5IEBAIHN0YXRpYyB2b2lk
IG1haW5faGFuZGxlX2FnZW50X3Rva2VuKFNwaWNlQ2hhbm5lbCAqY2hhbm5lbCwgU3BpY2VNc2dJ
biAqaW4pCiAgICAgYWdlbnRfc2VuZF9tc2dfcXVldWUoU1BJQ0VfTUFJTl9DSEFOTkVMKGNoYW5u
ZWwpKTsKIH0KIAotLyogbWFpbiBjb250ZXh0ICovCi1zdGF0aWMgdm9pZCBtaWdyYXRlX2NoYW5u
ZWxfbmV3X2NiKFNwaWNlU2Vzc2lvbiAqcywgU3BpY2VDaGFubmVsICpjaGFubmVsLCBncG9pbnRl
ciBkYXRhKQotewotICAgIGdfc2lnbmFsX2Nvbm5lY3QoY2hhbm5lbCwgImNoYW5uZWwtZXZlbnQi
LAotICAgICAgICAgICAgICAgICAgICAgR19DQUxMQkFDSyhtaWdyYXRlX2NoYW5uZWxfZXZlbnRf
Y2IpLCBkYXRhKTsKLX0KLQotc3RhdGljIHZvaWQKLW1pZ3JhdGVfY2hhbm5lbF9jb25uZWN0KHNw
aWNlX21pZ3JhdGUgKm1pZywgaW50IHR5cGUsIGludCBpZCkKLXsKLSAgICBTUElDRV9ERUJVRygi
bWlncmF0ZV9jaGFubmVsX2Nvbm5lY3QgJWQ6JWQiLCB0eXBlLCBpZCk7Ci0KLSAgICBTcGljZUNo
YW5uZWwgKm5ld2MgPSBzcGljZV9jaGFubmVsX25ldyhtaWctPnNlc3Npb24sIHR5cGUsIGlkKTsK
LSAgICBpZiAobmV3YyAhPSBOVUxMICYmIHNwaWNlX2NoYW5uZWxfY29ubmVjdChuZXdjKSkgewot
ICAgICAgICBtaWctPm5jaGFubmVscysrOwotICAgIH0KLX0KLQogLyogY29yb3V0aW5lIGNvbnRl
eHQgKi8KIHN0YXRpYyB2b2lkIHNwaWNlX21haW5fY2hhbm5lbF9zZW5kX21pZ3JhdGlvbl9oYW5k
c2hha2UoU3BpY2VDaGFubmVsICpjaGFubmVsKQogewotICAgIFNwaWNlTWFpbkNoYW5uZWxQcml2
YXRlICpjID0gU1BJQ0VfTUFJTl9DSEFOTkVMKGNoYW5uZWwpLT5wcml2OworICAgIFNwaWNlU2Vz
c2lvbiAqc2Vzc2lvbiA9IHNwaWNlX2NoYW5uZWxfZ2V0X3Nlc3Npb24oY2hhbm5lbCk7CisgICAg
U3BpY2VNYWluQ2hhbm5lbE1pZ3JhdGlvbiAqbWlncmF0aW9uID0gc3BpY2Vfc2Vzc2lvbl9nZXRf
bWFpbl9jaGFubmVsX21pZ3JhdGlvbihzZXNzaW9uKTsKIAogICAgIGlmICghc3BpY2VfY2hhbm5l
bF90ZXN0X2NhcGFiaWxpdHkoY2hhbm5lbCwgU1BJQ0VfTUFJTl9DQVBfU0VBTUxFU1NfTUlHUkFU
RSkpIHsKLSAgICAgICAgYy0+bWlncmF0ZV9kYXRhLT5kb19zZWFtbGVzcyA9IGZhbHNlOwotICAg
ICAgICBnX2lkbGVfYWRkKG1haW5fbWlncmF0ZV9oYW5kc2hha2VfZG9uZSwgYy0+bWlncmF0ZV9k
YXRhKTsKKyAgICAgICAgc3BpY2VfbWFpbl9jaGFubmVsX21pZ3JhdGlvbl9zZWFtbGVzc19oYW5k
c2hha2VfZG9uZShtaWdyYXRpb24sIEZBTFNFKTsKICAgICB9IGVsc2UgewogICAgICAgICBTcGlj
ZU1zZ2NNYWluTWlncmF0ZURzdERvU2VhbWxlc3MgbXNnX2RhdGE7CiAgICAgICAgIFNwaWNlTXNn
T3V0ICptc2dfb3V0OwogCi0gICAgICAgIG1zZ19kYXRhLnNyY192ZXJzaW9uID0gYy0+bWlncmF0
ZV9kYXRhLT5zcmNfbWlnX3ZlcnNpb247CisgICAgICAgIG1zZ19kYXRhLnNyY192ZXJzaW9uID0g
c3BpY2VfbWFpbl9jaGFubmVsX21pZ3JhdGlvbl9nZXRfc291cmNlX2hvc3RfdmVyc2lvbihtaWdy
YXRpb24pOwogCiAgICAgICAgIG1zZ19vdXQgPSBzcGljZV9tc2dfb3V0X25ldyhjaGFubmVsLCBT
UElDRV9NU0dDX01BSU5fTUlHUkFURV9EU1RfRE9fU0VBTUxFU1MpOwogICAgICAgICBtc2dfb3V0
LT5tYXJzaGFsbGVycy0+bXNnY19tYWluX21pZ3JhdGVfZHN0X2RvX3NlYW1sZXNzKG1zZ19vdXQt
Pm1hcnNoYWxsZXIsICZtc2dfZGF0YSk7CkBAIC0yMTk5LDc2ICsyMTYxLDYgQEAgc3RhdGljIHZv
aWQgc3BpY2VfbWFpbl9jaGFubmVsX3NlbmRfbWlncmF0aW9uX2hhbmRzaGFrZShTcGljZUNoYW5u
ZWwgKmNoYW5uZWwpCiAgICAgfQogfQogCi0vKiBtYWluIGNvbnRleHQgKi8KLXN0YXRpYyB2b2lk
IG1pZ3JhdGVfY2hhbm5lbF9ldmVudF9jYihTcGljZUNoYW5uZWwgKmNoYW5uZWwsIFNwaWNlQ2hh
bm5lbEV2ZW50IGV2ZW50LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdw
b2ludGVyIGRhdGEpCi17Ci0gICAgc3BpY2VfbWlncmF0ZSAqbWlnID0gZGF0YTsKLQotICAgIGdf
cmV0dXJuX2lmX2ZhaWwobWlnLT5uY2hhbm5lbHMgPiAwKTsKLSAgICBnX3NpZ25hbF9oYW5kbGVy
c19kaXNjb25uZWN0X2J5X2Z1bmMoY2hhbm5lbCwgbWlncmF0ZV9jaGFubmVsX2V2ZW50X2NiLCBk
YXRhKTsKLQotICAgIHN3aXRjaCAoZXZlbnQpIHsKLSAgICBjYXNlIFNQSUNFX0NIQU5ORUxfT1BF
TkVEOgotICAgICAgICBpZiAoc3BpY2VfY2hhbm5lbF9nZXRfY2hhbm5lbF90eXBlKGNoYW5uZWwp
ID09IFNQSUNFX0NIQU5ORUxfTUFJTikgewotICAgICAgICAgICAgU3BpY2VTZXNzaW9uICpzZXNz
aW9uID0gc3BpY2VfY2hhbm5lbF9nZXRfc2Vzc2lvbihtaWctPnNyY19jaGFubmVsKTsKLSAgICAg
ICAgICAgIGlmIChtaWctPmRvX3NlYW1sZXNzKSB7Ci0gICAgICAgICAgICAgICAgU3BpY2VNYWlu
Q2hhbm5lbFByaXZhdGUgKm1haW5fcHJpdiA9IFNQSUNFX01BSU5fQ0hBTk5FTChjaGFubmVsKS0+
cHJpdjsKLQotICAgICAgICAgICAgICAgIHNwaWNlX2NoYW5uZWxfc2V0X3N0YXRlKGNoYW5uZWws
IFNQSUNFX0NIQU5ORUxfU1RBVEVfTUlHUkFUSU9OX0hBTkRTSEFLRSk7Ci0gICAgICAgICAgICAg
ICAgbWlnLT5kc3RfY2hhbm5lbCA9IGNoYW5uZWw7Ci0gICAgICAgICAgICAgICAgbWFpbl9wcml2
LT5taWdyYXRlX2RhdGEgPSBtaWc7Ci0gICAgICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAg
ICAgIHNwaWNlX2NoYW5uZWxfc2V0X3N0YXRlKGNoYW5uZWwsIFNQSUNFX0NIQU5ORUxfU1RBVEVf
TUlHUkFUSU5HKTsKLSAgICAgICAgICAgICAgICBtaWctPm5jaGFubmVscy0tOwotICAgICAgICAg
ICAgfQotICAgICAgICAgICAgLyogbm93IGNvbm5lY3QgdGhlIHJlc3Qgb2YgdGhlIGNoYW5uZWxz
ICovCi0gICAgICAgICAgICBHTGlzdCAqY2hhbm5lbHMsICpsOwotICAgICAgICAgICAgbCA9IGNo
YW5uZWxzID0gc3BpY2Vfc2Vzc2lvbl9nZXRfY2hhbm5lbHMoc2Vzc2lvbik7Ci0gICAgICAgICAg
ICB3aGlsZSAobCAhPSBOVUxMKSB7Ci0gICAgICAgICAgICAgICAgU3BpY2VDaGFubmVsICppdCA9
IFNQSUNFX0NIQU5ORUwobC0+ZGF0YSk7Ci0KLSAgICAgICAgICAgICAgICBsID0gbC0+bmV4dDsK
LSAgICAgICAgICAgICAgICBpZiAoc3BpY2VfY2hhbm5lbF9nZXRfY2hhbm5lbF90eXBlKGl0KSA9
PSBTUElDRV9DSEFOTkVMX01BSU4pIHsKLSAgICAgICAgICAgICAgICAgICAgY29udGludWU7Ci0g
ICAgICAgICAgICAgICAgfQotICAgICAgICAgICAgICAgIG1pZ3JhdGVfY2hhbm5lbF9jb25uZWN0
KG1pZywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGljZV9jaGFu
bmVsX2dldF9jaGFubmVsX3R5cGUoaXQpLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHNwaWNlX2NoYW5uZWxfZ2V0X2NoYW5uZWxfaWQoaXQpKTsKLSAgICAgICAgICAg
IH0KLSAgICAgICAgICAgIGdfbGlzdF9mcmVlKGNoYW5uZWxzKTsKLSAgICAgICAgfSBlbHNlIHsK
LSAgICAgICAgICAgIHNwaWNlX2NoYW5uZWxfc2V0X3N0YXRlKGNoYW5uZWwsIFNQSUNFX0NIQU5O
RUxfU1RBVEVfTUlHUkFUSU5HKTsKLSAgICAgICAgICAgIG1pZy0+bmNoYW5uZWxzLS07Ci0gICAg
ICAgIH0KLQotICAgICAgICBTUElDRV9ERUJVRygibWlncmF0aW9uOiBjaGFubmVsIG9wZW5lZCBj
aGFuOiVwLCBsZWZ0ICV1IiwgY2hhbm5lbCwgbWlnLT5uY2hhbm5lbHMpOwotICAgICAgICBpZiAo
bWlnLT5uY2hhbm5lbHMgPT0gMCkKLSAgICAgICAgICAgIGNvcm91dGluZV95aWVsZHRvKG1pZy0+
ZnJvbSwgTlVMTCk7Ci0gICAgICAgIGJyZWFrOwotICAgIGRlZmF1bHQ6Ci0gICAgICAgIENIQU5O
RUxfREVCVUcoY2hhbm5lbCwgImVycm9yIG9yIHVuaGFuZGxlZCBjaGFubmVsIGV2ZW50IGR1cmlu
ZyBtaWdyYXRpb246ICV1IiwgZXZlbnQpOwotICAgICAgICAvKiBnbyBiYWNrIHRvIG1haW4gY2hh
bm5lbCB0byByZXBvcnQgZXJyb3IgKi8KLSAgICAgICAgY29yb3V0aW5lX3lpZWxkdG8obWlnLT5m
cm9tLCBOVUxMKTsKLSAgICB9Ci19Ci0KLS8qIG1haW4gY29udGV4dCAqLwotc3RhdGljIGdib29s
ZWFuIG1haW5fbWlncmF0ZV9oYW5kc2hha2VfZG9uZShncG9pbnRlciBkYXRhKQotewotICAgIHNw
aWNlX21pZ3JhdGUgKm1pZyA9IGRhdGE7Ci0gICAgU3BpY2VDaGFubmVsICpjaGFubmVsID0gU1BJ
Q0VfQ0hBTk5FTChtaWctPmRzdF9jaGFubmVsKTsKLQotICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWls
KHNwaWNlX2NoYW5uZWxfZ2V0X2NoYW5uZWxfdHlwZShjaGFubmVsKSA9PSBTUElDRV9DSEFOTkVM
X01BSU4sIEZBTFNFKTsKLSAgICBnX3JldHVybl92YWxfaWZfZmFpbChzcGljZV9jaGFubmVsX2dl
dF9zdGF0ZShjaGFubmVsKSA9PSBTUElDRV9DSEFOTkVMX1NUQVRFX01JR1JBVElPTl9IQU5EU0hB
S0UsIEZBTFNFKTsKLQotICAgIHNwaWNlX2NoYW5uZWxfc2V0X3N0YXRlKGNoYW5uZWwsIFNQSUNF
X0NIQU5ORUxfU1RBVEVfTUlHUkFUSU5HKTsKLSAgICBtaWctPm5jaGFubmVscy0tOwotICAgIGlm
IChtaWctPm5jaGFubmVscyA9PSAwKQotICAgICAgICBjb3JvdXRpbmVfeWllbGR0byhtaWctPmZy
b20sIE5VTEwpOwotICAgIHJldHVybiBGQUxTRTsKLX0KLQogI2lmZGVmIF9fR05VQ19fCiB0eXBl
ZGVmIHN0cnVjdCBfX2F0dHJpYnV0ZV9fICgoX19wYWNrZWRfXykpIE9sZFJlZE1pZ3JhdGlvbkJl
Z2luIHsKICNlbHNlCkBAIC0yMjc5LDM4ICsyMTcxLDYgQEAgdHlwZWRlZiBzdHJ1Y3QgX19kZWNs
c3BlYyhhbGlnbigxKSkgT2xkUmVkTWlncmF0aW9uQmVnaW4gewogICAgIGNoYXIgaG9zdFswXTsK
IH0gT2xkUmVkTWlncmF0aW9uQmVnaW47CiAKLS8qIG1haW4gY29udGV4dCAqLwotc3RhdGljIGdi
b29sZWFuIG1pZ3JhdGVfY29ubmVjdChncG9pbnRlciBkYXRhKQotewotICAgIHNwaWNlX21pZ3Jh
dGUgKm1pZyA9IGRhdGE7Ci0gICAgU3BpY2VDaGFubmVsUHJpdmF0ZSAgKmM7Ci0KLSAgICBnX3Jl
dHVybl92YWxfaWZfZmFpbChtaWcgIT0gTlVMTCwgRkFMU0UpOwotICAgIGdfcmV0dXJuX3ZhbF9p
Zl9mYWlsKG1pZy0+aW5mbyAhPSBOVUxMLCBGQUxTRSk7Ci0gICAgZ19yZXR1cm5fdmFsX2lmX2Zh
aWwobWlnLT5uY2hhbm5lbHMgPT0gMCwgRkFMU0UpOwotICAgIGMgPSBTUElDRV9DSEFOTkVMKG1p
Zy0+c3JjX2NoYW5uZWwpLT5wcml2OwotICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKGMgIT0gTlVM
TCwgRkFMU0UpOwotICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKG1pZy0+c2Vzc2lvbiAhPSBOVUxM
LCBGQUxTRSk7Ci0KLSAgICBzcGljZV9zZXNzaW9uX3NldF9taWdyYXRpb25fc3RhdGUobWlnLT5z
ZXNzaW9uLCBTUElDRV9TRVNTSU9OX01JR1JBVElPTl9DT05ORUNUSU5HKTsKLQotICAgIFNwaWNl
TWlncmF0aW9uRHN0SW5mbyAqaW5mbyA9IG1pZy0+aW5mbzsKLSAgICBTUElDRV9ERUJVRygibWln
cmF0ZV9iZWdpbiAldSAlcyAlZCAlZCIsCi0gICAgICAgICAgICAgICAgaW5mby0+aG9zdF9zaXpl
LCBpbmZvLT5ob3N0X2RhdGEsIGluZm8tPnBvcnQsIGluZm8tPnNwb3J0KTsKLQotICAgIGdfc2ln
bmFsX2Nvbm5lY3QobWlnLT5zZXNzaW9uLCAiY2hhbm5lbC1uZXciLAotICAgICAgICAgICAgICAg
ICAgICAgR19DQUxMQkFDSyhtaWdyYXRlX2NoYW5uZWxfbmV3X2NiKSwgbWlnKTsKLQotICAgIGdf
c2lnbmFsX2VtaXQobWlnLT5zcmNfY2hhbm5lbCwgc2lnbmFsc1tTUElDRV9NSUdSQVRJT05fU1RB
UlRFRF0sIDAsCi0gICAgICAgICAgICAgICAgICBtaWctPnNlc3Npb24pOwotCi0gICAgLyogdGhl
IG1pZ3JhdGlvbiBwcm9jZXNzIGlzIGluIDIgc3RlcHMsIGZpcnN0IHRoZSBtYWluIGNoYW5uZWwg
YW5kCi0gICAgICAgdGhlbiB0aGUgcmVzdCBvZiB0aGUgY2hhbm5lbHMgKi8KLSAgICBtaWdyYXRl
X2NoYW5uZWxfY29ubmVjdChtaWcsIFNQSUNFX0NIQU5ORUxfTUFJTiwgMCk7Ci0KLSAgICByZXR1
cm4gRkFMU0U7Ci19Ci0KIHN0YXRpYyB2b2lkCiBtaWdyYXRpb25fc2Vzc2lvbl9zZXRfZGVzdGlu
YXRpb25faW5mbyhTcGljZVNlc3Npb24gKnRhcmdldF9zZXNzaW9uLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VNaWdyYXRpb25Ec3RJbmZvICppbmZvKQpAQCAt
MjM0OCw1MCArMjIwOCw1MSBAQCBzdGF0aWMgdm9pZCBtYWluX21pZ3JhdGVfY29ubmVjdChTcGlj
ZUNoYW5uZWwgKmNoYW5uZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29s
IGRvX3NlYW1sZXNzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3Qg
c3JjX21pZ192ZXJzaW9uKQogewotICAgIFNwaWNlTWFpbkNoYW5uZWxQcml2YXRlICptYWluX3By
aXYgPSBTUElDRV9NQUlOX0NIQU5ORUwoY2hhbm5lbCktPnByaXY7CiAgICAgaW50IHJlcGx5X3R5
cGUgPSBTUElDRV9NU0dDX01BSU5fTUlHUkFURV9DT05ORUNUX0VSUk9SOwotICAgIHNwaWNlX21p
Z3JhdGUgbWlnID0geyAwLCB9OwogICAgIFNwaWNlTXNnT3V0ICpvdXQ7Ci0gICAgU3BpY2VTZXNz
aW9uICpzZXNzaW9uOwotCi0gICAgbWlnLnNyY19jaGFubmVsID0gY2hhbm5lbDsKLSAgICBtaWcu
aW5mbyA9IGRzdF9pbmZvOwotICAgIG1pZy5mcm9tID0gY29yb3V0aW5lX3NlbGYoKTsKLSAgICBt
aWcuZG9fc2VhbWxlc3MgPSBkb19zZWFtbGVzczsKLSAgICBtaWcuc3JjX21pZ192ZXJzaW9uID0g
c3JjX21pZ192ZXJzaW9uOworICAgIFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbiwgKnRhcmdldF9zZXNz
aW9uOworICAgIFNwaWNlTWFpbkNoYW5uZWxNaWdyYXRpb24gKm1pZ3JhdGlvbiA9IE5VTEw7CiAK
ICAgICBDSEFOTkVMX0RFQlVHKGNoYW5uZWwsICJtaWdyYXRlIGNvbm5lY3QiKTsKICAgICBzZXNz
aW9uID0gc3BpY2VfY2hhbm5lbF9nZXRfc2Vzc2lvbihjaGFubmVsKTsKLSAgICBtaWcuc2Vzc2lv
biA9IHNwaWNlX3Nlc3Npb25fbmV3X2Zyb21fc2Vzc2lvbihzZXNzaW9uKTsKLSAgICBpZiAoIXNw
aWNlX3Nlc3Npb25fc2V0X21pZ3JhdGlvbl9zZXNzaW9uKHNlc3Npb24sIG1pZy5zZXNzaW9uKSkg
eworICAgIHRhcmdldF9zZXNzaW9uID0gc3BpY2Vfc2Vzc2lvbl9uZXdfZnJvbV9zZXNzaW9uKHNl
c3Npb24pOworICAgIGlmICghc3BpY2Vfc2Vzc2lvbl9zZXRfbWlncmF0aW9uX3Nlc3Npb24oc2Vz
c2lvbiwgdGFyZ2V0X3Nlc3Npb24pKSB7CiAgICAgICAgIGdvdG8gZW5kOwogICAgIH0KIAotICAg
IG1pZ3JhdGlvbl9zZXNzaW9uX3NldF9kZXN0aW5hdGlvbl9pbmZvKG1pZy5zZXNzaW9uLCBkc3Rf
aW5mbyk7Ci0KLSAgICBtYWluX3ByaXYtPm1pZ3JhdGVfZGF0YSA9ICZtaWc7CisgICAgbWlncmF0
aW9uX3Nlc3Npb25fc2V0X2Rlc3RpbmF0aW9uX2luZm8odGFyZ2V0X3Nlc3Npb24sIGRzdF9pbmZv
KTsKKyAgICBtaWdyYXRpb24gPSBnX29iamVjdF9uZXcoU1BJQ0VfVFlQRV9NQUlOX0NIQU5ORUxf
TUlHUkFUSU9OLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic291cmNlLXNlc3Npb24i
LCBzZXNzaW9uLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidGFyZ2V0LXNlc3Npb24i
LCB0YXJnZXRfc2Vzc2lvbiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImNvcm91dGlu
ZS1jb250ZXh0IiwgY29yb3V0aW5lX3NlbGYoKSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgInNlYW1sZXNzLW1pZ3JhdGlvbiIsIGRvX3NlYW1sZXNzLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAic291cmNlLWhvc3QtdmVyc2lvbiIsIHNyY19taWdfdmVyc2lvbiwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgTlVMTCk7CiAKLSAgICAvKiBubyBuZWVkIHRvIHRyYWNr
IGlkbGUsIGNhbGwgaXMgc3luYyBmb3IgdGhpcyBjb3JvdXRpbmUgKi8KLSAgICBnX2lkbGVfYWRk
KG1pZ3JhdGVfY29ubmVjdCwgJm1pZyk7CisgICAgLyogQWxsb3cgYXBwbGljYXRpb24gdG8gdHJh
Y2sgbmV3LWNoYW5uZWwgZXZlbnRzIG9uIHRhcmdldCBzZXNzaW9uICovCisgICAgZ19zaWduYWxf
ZW1pdChjaGFubmVsLCBzaWduYWxzW1NQSUNFX01JR1JBVElPTl9TVEFSVEVEXSwgMCwgdGFyZ2V0
X3Nlc3Npb24pOwogCi0gICAgLyogc3dpdGNoIHRvIG1haW4gbG9vcCBhbmQgd2FpdCBmb3IgY29u
bmVjdGlvbnMgKi8KLSAgICBjb3JvdXRpbmVfeWllbGQoTlVMTCk7CisgICAgLyogUnVucyBzeW5j
IGZyb20gY29yb3V0aW5lIHBlcnNwZWN0aXZlICovCisgICAgYm9vbCBzdWNjZXNzID0gc3BpY2Vf
bWFpbl9jaGFubmVsX21pZ3JhdGlvbl9pbml0X21pZ3JhdGlvbihtaWdyYXRpb24pOwogCi0gICAg
aWYgKG1pZy5uY2hhbm5lbHMgIT0gMCkgeworICAgIGlmICghc3VjY2VzcykgewogICAgICAgICBD
SEFOTkVMX0RFQlVHKGNoYW5uZWwsICJtaWdyYXRlIGZhaWxlZDogc29tZSBjaGFubmVscyBmYWls
ZWQgdG8gY29ubmVjdCIpOwogICAgICAgICBzcGljZV9zZXNzaW9uX2Fib3J0X21pZ3JhdGlvbihz
ZXNzaW9uKTsKKyAgICAgICAgZ290byBlbmQ7CisgICAgfQorCisgICAgaWYgKHNwaWNlX21haW5f
Y2hhbm5lbF9taWdyYXRpb25faXNfc2VhbWxlc3MobWlncmF0aW9uKSkgeworICAgICAgICBTUElD
RV9ERUJVRygibWlncmF0aW9uIChzZWFtbGVzcyk6IGNvbm5lY3Rpb25zIGFsbCBvayIpOworICAg
ICAgICByZXBseV90eXBlID0gU1BJQ0VfTVNHQ19NQUlOX01JR1JBVEVfQ09OTkVDVEVEX1NFQU1M
RVNTOwogICAgIH0gZWxzZSB7Ci0gICAgICAgIGlmIChtaWcuZG9fc2VhbWxlc3MpIHsKLSAgICAg
ICAgICAgIFNQSUNFX0RFQlVHKCJtaWdyYXRpb24gKHNlYW1sZXNzKTogY29ubmVjdGlvbnMgYWxs
IG9rIik7Ci0gICAgICAgICAgICByZXBseV90eXBlID0gU1BJQ0VfTVNHQ19NQUlOX01JR1JBVEVf
Q09OTkVDVEVEX1NFQU1MRVNTOwotICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAgU1BJQ0Vf
REVCVUcoIm1pZ3JhdGlvbiAoc2VtaS1zZWFtbGVzcyk6IGNvbm5lY3Rpb25zIGFsbCBvayIpOwot
ICAgICAgICAgICAgcmVwbHlfdHlwZSA9IFNQSUNFX01TR0NfTUFJTl9NSUdSQVRFX0NPTk5FQ1RF
RDsKLSAgICAgICAgfQotICAgICAgICBzcGljZV9zZXNzaW9uX3N0YXJ0X21pZ3JhdGluZyhzZXNz
aW9uLCBtaWcuZG9fc2VhbWxlc3MpOworICAgICAgICBTUElDRV9ERUJVRygibWlncmF0aW9uIChz
ZW1pLXNlYW1sZXNzKTogY29ubmVjdGlvbnMgYWxsIG9rIik7CisgICAgICAgIHJlcGx5X3R5cGUg
PSBTUElDRV9NU0dDX01BSU5fTUlHUkFURV9DT05ORUNURUQ7CiAgICAgfQogCisgICAgc3BpY2Vf
c2Vzc2lvbl9zdGFydF9taWdyYXRpbmcoc2Vzc2lvbiwgc3BpY2VfbWFpbl9jaGFubmVsX21pZ3Jh
dGlvbl9pc19zZWFtbGVzcyhtaWdyYXRpb24pKTsKKwogZW5kOgorICAgIGdfY2xlYXJfb2JqZWN0
KCZtaWdyYXRpb24pOwogICAgIENIQU5ORUxfREVCVUcoY2hhbm5lbCwgIm1pZ3JhdGUgY29ubmVj
dCByZXBseSAlZCIsIHJlcGx5X3R5cGUpOwogICAgIG91dCA9IHNwaWNlX21zZ19vdXRfbmV3KGNo
YW5uZWwsIHJlcGx5X3R5cGUpOwogICAgIHNwaWNlX21zZ19vdXRfc2VuZChvdXQpOwpAQCAtMjQx
NSwyMCArMjI3NiwyMCBAQCBzdGF0aWMgdm9pZCBtYWluX2hhbmRsZV9taWdyYXRlX2JlZ2luX3Nl
YW1sZXNzKFNwaWNlQ2hhbm5lbCAqY2hhbm5lbCwgU3BpY2VNc2dJbgogCiBzdGF0aWMgdm9pZCBt
YWluX2hhbmRsZV9taWdyYXRlX2RzdF9zZWFtbGVzc19hY2soU3BpY2VDaGFubmVsICpjaGFubmVs
LCBTcGljZU1zZ0luICppbikKIHsKLSAgICBTcGljZU1haW5DaGFubmVsUHJpdmF0ZSAqbWFpbl9w
cml2ID0gU1BJQ0VfTUFJTl9DSEFOTkVMKGNoYW5uZWwpLT5wcml2OworICAgIFNwaWNlU2Vzc2lv
biAqc2Vzc2lvbiA9IHNwaWNlX2NoYW5uZWxfZ2V0X3Nlc3Npb24oY2hhbm5lbCk7CisgICAgU3Bp
Y2VNYWluQ2hhbm5lbE1pZ3JhdGlvbiAqbWlncmF0aW9uID0gc3BpY2Vfc2Vzc2lvbl9nZXRfbWFp
bl9jaGFubmVsX21pZ3JhdGlvbihzZXNzaW9uKTsKIAogICAgIGdfcmV0dXJuX2lmX2ZhaWwoc3Bp
Y2VfY2hhbm5lbF9nZXRfc3RhdGUoY2hhbm5lbCkgPT0gU1BJQ0VfQ0hBTk5FTF9TVEFURV9NSUdS
QVRJT05fSEFORFNIQUtFKTsKLSAgICBtYWluX3ByaXYtPm1pZ3JhdGVfZGF0YS0+ZG9fc2VhbWxl
c3MgPSB0cnVlOwotICAgIGdfaWRsZV9hZGQobWFpbl9taWdyYXRlX2hhbmRzaGFrZV9kb25lLCBt
YWluX3ByaXYtPm1pZ3JhdGVfZGF0YSk7CisgICAgc3BpY2VfbWFpbl9jaGFubmVsX21pZ3JhdGlv
bl9zZWFtbGVzc19oYW5kc2hha2VfZG9uZShtaWdyYXRpb24sIFRSVUUpOwogfQogCiBzdGF0aWMg
dm9pZCBtYWluX2hhbmRsZV9taWdyYXRlX2RzdF9zZWFtbGVzc19uYWNrKFNwaWNlQ2hhbm5lbCAq
Y2hhbm5lbCwgU3BpY2VNc2dJbiAqaW4pCiB7Ci0gICAgU3BpY2VNYWluQ2hhbm5lbFByaXZhdGUg
Km1haW5fcHJpdiA9IFNQSUNFX01BSU5fQ0hBTk5FTChjaGFubmVsKS0+cHJpdjsKKyAgICBTcGlj
ZVNlc3Npb24gKnNlc3Npb24gPSBzcGljZV9jaGFubmVsX2dldF9zZXNzaW9uKGNoYW5uZWwpOwor
ICAgIFNwaWNlTWFpbkNoYW5uZWxNaWdyYXRpb24gKm1pZ3JhdGlvbiA9IHNwaWNlX3Nlc3Npb25f
Z2V0X21haW5fY2hhbm5lbF9taWdyYXRpb24oc2Vzc2lvbik7CiAKICAgICBnX3JldHVybl9pZl9m
YWlsKHNwaWNlX2NoYW5uZWxfZ2V0X3N0YXRlKGNoYW5uZWwpID09IFNQSUNFX0NIQU5ORUxfU1RB
VEVfTUlHUkFUSU9OX0hBTkRTSEFLRSk7Ci0gICAgbWFpbl9wcml2LT5taWdyYXRlX2RhdGEtPmRv
X3NlYW1sZXNzID0gZmFsc2U7Ci0gICAgZ19pZGxlX2FkZChtYWluX21pZ3JhdGVfaGFuZHNoYWtl
X2RvbmUsIG1haW5fcHJpdi0+bWlncmF0ZV9kYXRhKTsKKyAgICBzcGljZV9tYWluX2NoYW5uZWxf
bWlncmF0aW9uX3NlYW1sZXNzX2hhbmRzaGFrZV9kb25lKG1pZ3JhdGlvbiwgRkFMU0UpOwogfQog
CiAvKiBtYWluIGNvbnRleHQgKi8KZGlmZiAtLWdpdCBhL3NyYy9tZXNvbi5idWlsZCBiL3NyYy9t
ZXNvbi5idWlsZAppbmRleCAwNDYxZGVhLi44NGVlOWJlIDEwMDY0NAotLS0gYS9zcmMvbWVzb24u
YnVpbGQKKysrIGIvc3JjL21lc29uLmJ1aWxkCkBAIC05MCw2ICs5MCw4IEBAIHNwaWNlX2NsaWVu
dF9nbGliX3NvdXJjZXMgPSBbCiAgICdjaGFubmVsLWJhc2UuYycsCiAgICdjaGFubmVsLWRpc3Bs
YXktZ3N0LmMnLAogICAnY2hhbm5lbC1kaXNwbGF5LXByaXYuaCcsCisgICdjaGFubmVsLW1haW4t
bWlncmF0aW9uLmMnLAorICAnY2hhbm5lbC1tYWluLW1pZ3JhdGlvbi5oJywKICAgJ2NoYW5uZWwt
cGxheWJhY2stcHJpdi5oJywKICAgJ2NoYW5uZWwtdXNicmVkaXItcHJpdi5oJywKICAgJ2NsaWVu
dF9zd19jYW52YXMuYycsCmRpZmYgLS1naXQgYS9zcmMvc3BpY2Utc2Vzc2lvbi1wcml2LmggYi9z
cmMvc3BpY2Utc2Vzc2lvbi1wcml2LmgKaW5kZXggNjJjZWJjNS4uYjQ1M2Y5MiAxMDA2NDQKLS0t
IGEvc3JjL3NwaWNlLXNlc3Npb24tcHJpdi5oCisrKyBiL3NyYy9zcGljZS1zZXNzaW9uLXByaXYu
aApAQCAtMjgsNiArMjgsNyBAQAogdHlwZWRlZiBzdHJ1Y3QgX1Bob2RhdlNlcnZlciBQaG9kYXZT
ZXJ2ZXI7CiAjZW5kaWYKIAorI2luY2x1ZGUgImNoYW5uZWwtbWFpbi1taWdyYXRpb24uaCIKICNp
bmNsdWRlICJkZXNrdG9wLWludGVncmF0aW9uLmgiCiAjaW5jbHVkZSAic3BpY2Utc2Vzc2lvbi5o
IgogI2luY2x1ZGUgInNwaWNlLWd0ay1zZXNzaW9uLmgiCkBAIC05NSw2ICs5Niw5IEBAIFBob2Rh
dlNlcnZlciAqc3BpY2Vfc2Vzc2lvbl9nZXRfd2ViZGF2X3NlcnZlcihTcGljZVNlc3Npb24gKnNl
c3Npb24pOwogUGhvZGF2U2VydmVyKiBjaGFubmVsX3dlYmRhdl9zZXJ2ZXJfbmV3KFNwaWNlU2Vz
c2lvbiAqc2Vzc2lvbik7CiBndWludCBzcGljZV9zZXNzaW9uX2dldF9uX2Rpc3BsYXlfY2hhbm5l
bHMoU3BpY2VTZXNzaW9uICpzZXNzaW9uKTsKIGdib29sZWFuIHNwaWNlX3Nlc3Npb25fc2V0X21p
Z3JhdGlvbl9zZXNzaW9uKFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbiwgU3BpY2VTZXNzaW9uICptaWdf
c2Vzc2lvbik7CitTcGljZU1haW5DaGFubmVsTWlncmF0aW9uICogc3BpY2Vfc2Vzc2lvbl9nZXRf
bWFpbl9jaGFubmVsX21pZ3JhdGlvbihTcGljZVNlc3Npb24gKnNlbGYpOwordm9pZCBzcGljZV9z
ZXNzaW9uX3NldF9tYWluX2NoYW5uZWxfbWlncmF0aW9uKFNwaWNlU2Vzc2lvbiAqc2VsZiwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZU1haW5DaGFu
bmVsTWlncmF0aW9uICptY19taWdyYXRpb24pOwogU3BpY2VBdWRpbyAqc3BpY2VfYXVkaW9fZ2V0
KFNwaWNlU2Vzc2lvbiAqc2Vzc2lvbiwgR01haW5Db250ZXh0ICpjb250ZXh0KTsKIGNvbnN0IGdj
aGFyKiBzcGljZV9hdWRpb19kYXRhX21vZGVfdG9fc3RyaW5nKGdpbnQgbW9kZSk7CiBHX0VORF9E
RUNMUwpkaWZmIC0tZ2l0IGEvc3JjL3NwaWNlLXNlc3Npb24uYyBiL3NyYy9zcGljZS1zZXNzaW9u
LmMKaW5kZXggYTc3MGM5Mi4uZTZiYmI0ZiAxMDA2NDQKLS0tIGEvc3JjL3NwaWNlLXNlc3Npb24u
YworKysgYi9zcmMvc3BpY2Utc2Vzc2lvbi5jCkBAIC0xMTAsNiArMTEwLDkgQEAgc3RydWN0IF9T
cGljZVNlc3Npb25Qcml2YXRlIHsKICAgICBnYm9vbGVhbiAgICAgICAgICBtaWdyYXRlX3dhaXRf
aW5pdDsKICAgICBndWludCAgICAgICAgICAgICBhZnRlcl9tYWluX2luaXQ7CiAgICAgZ2Jvb2xl
YW4gICAgICAgICAgZm9yX21pZ3JhdGlvbjsKKyAgICAKKyAgICAvKiBGSVhNRTogQ2FuIHBvc3Np
Ymx5IHJlbW92ZSBsb3RzIG9mIHRoZSBhYm92ZSAqLworICAgIFNwaWNlTWFpbkNoYW5uZWxNaWdy
YXRpb24gKm1jX21pZ3JhdGlvbjsKIAogICAgIGRpc3BsYXlfY2FjaGUgICAgICppbWFnZXM7CiAg
ICAgZGlzcGxheV9jYWNoZSAgICAgKnBhbGV0dGVzOwpAQCAtMzQ0LDYgKzM0Nyw3IEBAIHNwaWNl
X3Nlc3Npb25fZGlzcG9zZShHT2JqZWN0ICpnb2JqZWN0KQogICAgIGdfY2xlYXJfb2JqZWN0KCZz
LT51c2JfbWFuYWdlcik7CiAgICAgZ19jbGVhcl9vYmplY3QoJnMtPnByb3h5KTsKICAgICBnX2Ns
ZWFyX29iamVjdCgmcy0+d2ViZGF2KTsKKyAgICBnX2NsZWFyX29iamVjdCgmcy0+bWNfbWlncmF0
aW9uKTsKIAogICAgIC8qIENoYWluIHVwIHRvIHRoZSBwYXJlbnQgY2xhc3MgKi8KICAgICBpZiAo
R19PQkpFQ1RfQ0xBU1Moc3BpY2Vfc2Vzc2lvbl9wYXJlbnRfY2xhc3MpLT5kaXNwb3NlKQpAQCAt
MTc1Miw2ICsxNzU2LDcgQEAgdm9pZCBzcGljZV9zZXNzaW9uX3N0YXJ0X21pZ3JhdGluZyhTcGlj
ZVNlc3Npb24gKnNlc3Npb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdi
b29sZWFuIGZ1bGxfbWlncmF0aW9uKQogewogICAgIGdfcmV0dXJuX2lmX2ZhaWwoU1BJQ0VfSVNf
U0VTU0lPTihzZXNzaW9uKSk7CisgICAgZ19yZXR1cm5faWZfZmFpbChTUElDRV9JU19NQUlOX0NI
QU5ORUxfTUlHUkFUSU9OKHNlc3Npb24tPnByaXYtPm1jX21pZ3JhdGlvbikpOwogCiAgICAgU3Bp
Y2VTZXNzaW9uUHJpdmF0ZSAqcyA9IHNlc3Npb24tPnByaXY7CiAgICAgU3BpY2VTZXNzaW9uUHJp
dmF0ZSAqbTsKQEAgLTE4MzQsNiArMTgzOSw3IEBAIGVuZDoKICAgICBnX2NsZWFyX3BvaW50ZXIo
JnMtPm1pZ3JhdGlvbl9sZWZ0LCBnX2xpc3RfZnJlZSk7CiAgICAgc2Vzc2lvbl9kaXNjb25uZWN0
KHMtPm1pZ3JhdGlvbiwgRkFMU0UpOwogICAgIGdfY2xlYXJfcG9pbnRlcigmcy0+bWlncmF0aW9u
LCBnX29iamVjdF91bnJlZik7CisgICAgZ19jbGVhcl9vYmplY3QoJnMtPm1jX21pZ3JhdGlvbik7
CiAKICAgICBzLT5taWdyYXRlX3dhaXRfaW5pdCA9IEZBTFNFOwogICAgIGlmIChzLT5hZnRlcl9t
YWluX2luaXQpIHsKQEAgLTE4NzQsNiArMTg4MCw3IEBAIHZvaWQgc3BpY2Vfc2Vzc2lvbl9jaGFu
bmVsX21pZ3JhdGUoU3BpY2VTZXNzaW9uICpzZXNzaW9uLCBTcGljZUNoYW5uZWwgKmNoYW5uZWwp
CiAgICAgICAgIHNlc3Npb25fZGlzY29ubmVjdChzLT5taWdyYXRpb24sIEZBTFNFKTsKICAgICAg
ICAgZ19jbGVhcl9wb2ludGVyKCZzLT5taWdyYXRpb24sIGdfb2JqZWN0X3VucmVmKTsKICAgICAg
ICAgc3BpY2Vfc2Vzc2lvbl9zZXRfbWlncmF0aW9uX3N0YXRlKHNlc3Npb24sIFNQSUNFX1NFU1NJ
T05fTUlHUkFUSU9OX05PTkUpOworICAgICAgICBnX2NsZWFyX29iamVjdCgmcy0+bWNfbWlncmF0
aW9uKTsKICAgICB9CiB9CiAKQEAgLTI4NjQsMyArMjg3MSwyMiBAQCBnYm9vbGVhbiBzcGljZV9z
ZXNzaW9uX3NldF9taWdyYXRpb25fc2Vzc2lvbihTcGljZVNlc3Npb24gKnNlc3Npb24sIFNwaWNl
U2Vzc2lvbgogCiAgICAgcmV0dXJuIFRSVUU7CiB9CisKK0dfR05VQ19JTlRFUk5BTCB2b2lkCitz
cGljZV9zZXNzaW9uX3NldF9tYWluX2NoYW5uZWxfbWlncmF0aW9uKFNwaWNlU2Vzc2lvbiAqc2Vs
ZiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VNYWluQ2hh
bm5lbE1pZ3JhdGlvbiAqbWNfbWlncmF0aW9uKQoreworICAgIGdfcmV0dXJuX2lmX2ZhaWwoU1BJ
Q0VfSVNfU0VTU0lPTihzZWxmKSk7CisgICAgZ19yZXR1cm5faWZfZmFpbChTUElDRV9JU19NQUlO
X0NIQU5ORUxfTUlHUkFUSU9OKG1jX21pZ3JhdGlvbikpOworICAgIGdfcmV0dXJuX2lmX2ZhaWwo
c2VsZi0+cHJpdi0+bWNfbWlncmF0aW9uID09IE5VTEwpOworCisgICAgc2VsZi0+cHJpdi0+bWNf
bWlncmF0aW9uID0gZ19vYmplY3RfcmVmKG1jX21pZ3JhdGlvbik7Cit9CisKK0dfR05VQ19JTlRF
Uk5BTCBTcGljZU1haW5DaGFubmVsTWlncmF0aW9uICoKK3NwaWNlX3Nlc3Npb25fZ2V0X21haW5f
Y2hhbm5lbF9taWdyYXRpb24oU3BpY2VTZXNzaW9uICpzZWxmKQoreworICAgIGdfcmV0dXJuX3Zh
bF9pZl9mYWlsKFNQSUNFX0lTX1NFU1NJT04oc2VsZiksIEZBTFNFKTsKKworICAgIHJldHVybiBz
ZWxmLT5wcml2LT5tY19taWdyYXRpb247Cit9Ci0tIAoyLjIxLjAKCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApT
cGljZS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9zcGljZS1kZXZlbA==
