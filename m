Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 97763AA4CE
	for <lists+spice-devel@lfdr.de>; Thu,  5 Sep 2019 15:42:54 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EBE256E0DD;
	Thu,  5 Sep 2019 13:42:52 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B1EB46E0D6
 for <spice-devel@lists.freedesktop.org>; Thu,  5 Sep 2019 13:42:50 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx06.intmail.prod.int.phx2.redhat.com
 [10.5.11.16])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 57C0731752AF;
 Thu,  5 Sep 2019 13:42:50 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.10])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 1B8A35C578;
 Thu,  5 Sep 2019 13:42:47 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Thu,  5 Sep 2019 14:42:24 +0100
Message-Id: <20190905134241.28873-2-fziglio@redhat.com>
In-Reply-To: <20190905134241.28873-1-fziglio@redhat.com>
References: <20190905134241.28873-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.16
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.49]); Thu, 05 Sep 2019 13:42:50 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-gtk v6 01/18] usb-redir: define
 interfaces to support emulated devices
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogWXVyaSBCZW5kaXRvdmljaCA8eXVyaS5iZW5kaXRvdmljaEBkYXluaXguY29tPgoKU3Bp
Y2VVc2JCYWNrZW5kRGV2aWNlIHN0cnVjdHVyZSBpcyBleHRlbmRlZCB0byBzdXBwb3J0CmFkZGl0
aW9uYWwga2luZCBvZiBkZXZpY2UgdGhhdCBpcyBlbXVsYXRlZCBieSBTcGljZS1HVEsKYW5kIG5v
dCBwcmVzZW50IGxvY2FsbHkgKGFuZCBkb2VzIG5vdCBoYXZlIGxpYnVzYl9kZXZpY2UpLApzdWNo
IGRldmljZSBoYXMgaW5zdGVhZCBwb2ludGVyIHRvIFNwaWNlVXNiRW11bGF0ZWREZXZpY2UKYWJz
dHJhY3Qgc3RydWN0dXJlLiBTcGVjaWZpYyBpbXBsZW1lbnRhdGlvbiBvZiBzdWNoIGRldmljZQpk
ZXBlbmRzIG9uIGl0cyBkZXZpY2UgdHlwZS4gSW1wbGVtZW50YXRpb24gbW9kdWxlIHdpbGwgZGVm
aW5lCmNvbnN0cnVjdG9yIGZvciBzcGVjaWZpYyBkZXZpY2UgdHlwZS4KRGV2aWNlIHN0cnVjdHVy
ZSBpcyBhYnN0cmFjdCBidXQgYWx3YXlzIHN0YXJ0cyBmcm9tIHRhYmxlIG9mCnZpcnR1YWwgZnVu
Y3Rpb25zIHJlcXVpcmVkIHRvIHJlZGlyZWN0IHN1Y2ggdmlydHVhbCBkZXZpY2UuCgpTaWduZWQt
b2ZmLWJ5OiBZdXJpIEJlbmRpdG92aWNoIDx5dXJpLmJlbmRpdG92aWNoQGRheW5peC5jb20+CkFj
a2VkLWJ5OiBGcmVkaWFubyBaaWdsaW8gPGZ6aWdsaW9AcmVkaGF0LmNvbT4KLS0tCiBzcmMvbWVz
b24uYnVpbGQgICAgIHwgICAxICsKIHNyYy91c2ItYmFja2VuZC5jICAgfCAxMDMgKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0KIHNyYy91c2ItYmFja2VuZC5oICAg
fCAgIDMgKysKIHNyYy91c2ItZW11bGF0aW9uLmggfCAgODggKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKwogNCBmaWxlcyBjaGFuZ2VkLCAxOTMgaW5zZXJ0aW9ucygrKSwgMiBk
ZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBzcmMvdXNiLWVtdWxhdGlvbi5oCgpkaWZm
IC0tZ2l0IGEvc3JjL21lc29uLmJ1aWxkIGIvc3JjL21lc29uLmJ1aWxkCmluZGV4IGRhYzg1YTdi
Li40ZDkyMTVjOCAxMDA2NDQKLS0tIGEvc3JjL21lc29uLmJ1aWxkCisrKyBiL3NyYy9tZXNvbi5i
dWlsZApAQCAtMTIyLDYgKzEyMiw3IEBAIHNwaWNlX2NsaWVudF9nbGliX3NvdXJjZXMgPSBbCiAg
ICd1c2J1dGlsLmMnLAogICAndXNidXRpbC5oJywKICAgJ3VzYi1iYWNrZW5kLmMnLAorICAndXNi
LWVtdWxhdGlvbi5oJywKICAgJ3VzYi1iYWNrZW5kLmgnLAogICAndm1jc3RyZWFtLmMnLAogICAn
dm1jc3RyZWFtLmgnLApkaWZmIC0tZ2l0IGEvc3JjL3VzYi1iYWNrZW5kLmMgYi9zcmMvdXNiLWJh
Y2tlbmQuYwppbmRleCBlMDIxZDQzNC4uY2I0MWY3MTcgMTAwNjQ0Ci0tLSBhL3NyYy91c2ItYmFj
a2VuZC5jCisrKyBiL3NyYy91c2ItYmFja2VuZC5jCkBAIC0zOSw2ICszOSw3IEBACiAjaW5jbHVk
ZSAidXNicmVkaXJwYXJzZXIuaCIKICNpbmNsdWRlICJzcGljZS11dGlsLmgiCiAjaW5jbHVkZSAi
dXNiLWJhY2tlbmQuaCIKKyNpbmNsdWRlICJ1c2ItZW11bGF0aW9uLmgiCiAjaW5jbHVkZSAiY2hh
bm5lbC11c2JyZWRpci1wcml2LmgiCiAjaW5jbHVkZSAic3BpY2UtY2hhbm5lbC1wcml2LmgiCiAK
QEAgLTQ2LDcgKzQ3LDEwIEBACiAKIHN0cnVjdCBfU3BpY2VVc2JEZXZpY2UKIHsKKyAgICAvKiBQ
b2ludGVyIHRvIGRldmljZS4gRWl0aGVyIHJlYWwgZGV2aWNlIChsaWJ1c2JfZGV2aWNlKQorICAg
ICAqIG9yIGVtdWxhdGVkIG9uZSAoZWRldikgKi8KICAgICBsaWJ1c2JfZGV2aWNlICpsaWJ1c2Jf
ZGV2aWNlOworICAgIFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmVkZXY7CiAgICAgZ2ludCByZWZf
Y291bnQ7CiAgICAgU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqYXR0YWNoZWRfdG87CiAgICAgVXNi
RGV2aWNlSW5mb3JtYXRpb24gZGV2aWNlX2luZm87CkBAIC02OCw2ICs3MiwxMCBAQCBzdHJ1Y3Qg
X1NwaWNlVXNiQmFja2VuZAogICAgIGxpYnVzYl9kZXZpY2UgKipsaWJ1c2JfZGV2aWNlX2xpc3Q7
CiAgICAgZ2ludCByZWRpcmVjdGluZzsKICNlbmRpZgorCisgICAgLyogTWFzayBvZiBhbGxvY2F0
ZWQgZGV2aWNlLCBhIHNwZWNpZmljIGJpdCBzZXQgdG8gMSB0byBpbmRpY2F0ZSB0aGF0IHRoZSBk
ZXZpY2UgYXQKKyAgICAgKiB0aGF0IGFkZHJlc3MgaXMgYWxsb2NhdGVkICovCisgICAgdWludDMy
X3Qgb3duX2RldmljZXNfbWFzazsKIH07CiAKIHN0cnVjdCBfU3BpY2VVc2JCYWNrZW5kQ2hhbm5l
bApAQCAtNDIyLDYgKzQzMCw4IEBAIFNwaWNlVXNiQmFja2VuZCAqc3BpY2VfdXNiX2JhY2tlbmRf
bmV3KEdFcnJvciAqKmVycm9yKQogICAgICAgICBsaWJ1c2Jfc2V0X29wdGlvbihiZS0+bGlidXNi
X2NvbnRleHQsIExJQlVTQl9PUFRJT05fVVNFX1VTQkRLKTsKICNlbmRpZgogI2VuZGlmCisgICAg
ICAgIC8qIGV4Y2x1ZGUgYWRkcmVzc2VzIDAgKHJlc2VydmVkKSBhbmQgMSAocm9vdCBodWIpICov
CisgICAgICAgIGJlLT5vd25fZGV2aWNlc19tYXNrID0gMzsKICAgICB9CiAgICAgU1BJQ0VfREVC
VUcoIiVzIDw8IiwgX19GVU5DVElPTl9fKTsKICAgICByZXR1cm4gYmU7CkBAIC01MzgsOCArNTQ4
LDEzIEBAIHZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX3VucmVmKFNwaWNlVXNiQmFja2Vu
ZERldmljZSAqZGV2KQogewogICAgIExPVURfREVCVUcoIiVzID4+ICVwKCVkKSIsIF9fRlVOQ1RJ
T05fXywgZGV2LCBkZXYtPnJlZl9jb3VudCk7CiAgICAgaWYgKGdfYXRvbWljX2ludF9kZWNfYW5k
X3Rlc3QoJmRldi0+cmVmX2NvdW50KSkgewotICAgICAgICBsaWJ1c2JfdW5yZWZfZGV2aWNlKGRl
di0+bGlidXNiX2RldmljZSk7Ci0gICAgICAgIExPVURfREVCVUcoIiVzIGZyZWVpbmcgJXAgKGxp
YnVzYiAlcCkiLCBfX0ZVTkNUSU9OX18sIGRldiwgZGV2LT5saWJ1c2JfZGV2aWNlKTsKKyAgICAg
ICAgaWYgKGRldi0+bGlidXNiX2RldmljZSkgeworICAgICAgICAgICAgbGlidXNiX3VucmVmX2Rl
dmljZShkZXYtPmxpYnVzYl9kZXZpY2UpOworICAgICAgICAgICAgTE9VRF9ERUJVRygiJXMgZnJl
ZWluZyAlcCAobGlidXNiICVwKSIsIF9fRlVOQ1RJT05fXywgZGV2LCBkZXYtPmxpYnVzYl9kZXZp
Y2UpOworICAgICAgICB9CisgICAgICAgIGlmIChkZXYtPmVkZXYpIHsKKyAgICAgICAgICAgIGRl
dmljZV9vcHMoZGV2LT5lZGV2KS0+dW5yZWFsaXplKGRldi0+ZWRldik7CisgICAgICAgIH0KICAg
ICAgICAgZ19mcmVlKGRldik7CiAgICAgfQogfQpAQCAtODM3LDQgKzg1Miw4OCBAQCBzcGljZV91
c2JfYmFja2VuZF9jaGFubmVsX2dldF9ndWVzdF9maWx0ZXIoU3BpY2VVc2JCYWNrZW5kQ2hhbm5l
bCAqY2gsCiAgICAgfQogfQogCit2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9yZXBvcnRf
Y2hhbmdlKFNwaWNlVXNiQmFja2VuZCAqYmUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2KQoreworICAgIGdjaGFy
ICpkZXNjOworICAgIGdfcmV0dXJuX2lmX2ZhaWwoZGV2ICYmIGRldi0+ZWRldik7CisKKyAgICBk
ZXNjID0gZGV2aWNlX29wcyhkZXYtPmVkZXYpLT5nZXRfcHJvZHVjdF9kZXNjcmlwdGlvbihkZXYt
PmVkZXYpOworICAgIFNQSUNFX0RFQlVHKCIlczogJXMiLCBfX0ZVTkNUSU9OX18sIGRlc2MpOwor
ICAgIGdfZnJlZShkZXNjKTsKK30KKwordm9pZCBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfZWpl
Y3QoU3BpY2VVc2JCYWNrZW5kICpiZSwgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYpCit7Cisg
ICAgZ19yZXR1cm5faWZfZmFpbChkZXYpOworCisgICAgaWYgKGRldi0+ZWRldikgeworICAgICAg
ICBiZS0+b3duX2RldmljZXNfbWFzayAmPSB+KDEgPDwgZGV2LT5kZXZpY2VfaW5mby5hZGRyZXNz
KTsKKyAgICB9CisgICAgaWYgKGJlLT5ob3RwbHVnX2NhbGxiYWNrKSB7CisgICAgICAgIGJlLT5o
b3RwbHVnX2NhbGxiYWNrKGJlLT5ob3RwbHVnX3VzZXJfZGF0YSwgZGV2LCBGQUxTRSk7CisgICAg
fQorfQorCitnYm9vbGVhbgorc3BpY2VfdXNiX2JhY2tlbmRfY3JlYXRlX2VtdWxhdGVkX2Rldmlj
ZShTcGljZVVzYkJhY2tlbmQgKmJlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBTcGljZVVzYkVtdWxhdGVkRGV2aWNlQ3JlYXRlIGNyZWF0ZV9wcm9jLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICpjcmVhdGVfcGFyYW1zLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHRXJyb3IgKiplcnIpCit7
CisgICAgU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZWRldjsKKyAgICBTcGljZVVzYkJhY2tlbmRE
ZXZpY2UgKmRldjsKKyAgICBzdHJ1Y3QgbGlidXNiX2RldmljZV9kZXNjcmlwdG9yICpkZXNjOwor
ICAgIHVpbnQxNl90IGRldmljZV9kZXNjX3NpemU7CisgICAgdWludDhfdCBhZGRyZXNzID0gMDsK
KworICAgIGlmIChiZS0+b3duX2RldmljZXNfbWFzayA9PSAweGZmZmZmZmZmKSB7CisgICAgICAg
IGdfc2V0X2Vycm9yKGVyciwgU1BJQ0VfQ0xJRU5UX0VSUk9SLCBTUElDRV9DTElFTlRfRVJST1Jf
RkFJTEVELAorICAgICAgICAgICAgICAgICAgICBfKCJjYW4ndCBjcmVhdGUgZGV2aWNlIC0gbGlt
aXQgcmVhY2hlZCIpKTsKKyAgICAgICAgcmV0dXJuIEZBTFNFOworICAgIH0KKyAgICBmb3IgKGFk
ZHJlc3MgPSAwOyBhZGRyZXNzIDwgMzI7ICsrYWRkcmVzcykgeworICAgICAgICBpZiAofmJlLT5v
d25fZGV2aWNlc19tYXNrICYgKDEgPDwgYWRkcmVzcykpIHsKKyAgICAgICAgICAgIGJyZWFrOwor
ICAgICAgICB9CisgICAgfQorCisgICAgZGV2ID0gZ19uZXcwKFNwaWNlVXNiQmFja2VuZERldmlj
ZSwgMSk7CisgICAgZGV2LT5kZXZpY2VfaW5mby5idXMgPSBCVVNfTlVNQkVSX0ZPUl9FTVVMQVRF
RF9VU0I7CisgICAgZGV2LT5kZXZpY2VfaW5mby5hZGRyZXNzID0gYWRkcmVzczsKKyAgICBkZXYt
PnJlZl9jb3VudCA9IDE7CisKKyAgICBkZXYtPmVkZXYgPSBlZGV2ID0gY3JlYXRlX3Byb2MoYmUs
IGRldiwgY3JlYXRlX3BhcmFtcywgZXJyKTsKKyAgICBpZiAoZWRldiA9PSBOVUxMKSB7CisgICAg
ICAgIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV91bnJlZihkZXYpOworICAgICAgICByZXR1cm4g
RkFMU0U7CisgICAgfQorCisgICAgaWYgKCFkZXZpY2Vfb3BzKGVkZXYpLT5nZXRfZGVzY3JpcHRv
cihlZGV2LCBMSUJVU0JfRFRfREVWSUNFLCAwLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgKHZvaWQgKiopJmRlc2MsICZkZXZpY2VfZGVzY19zaXplKQorICAgICAg
ICB8fCBkZXZpY2VfZGVzY19zaXplICE9IHNpemVvZigqZGVzYykpIHsKKworICAgICAgICBzcGlj
ZV91c2JfYmFja2VuZF9kZXZpY2VfdW5yZWYoZGV2KTsKKyAgICAgICAgZ19zZXRfZXJyb3IoZXJy
LCBTUElDRV9DTElFTlRfRVJST1IsIFNQSUNFX0NMSUVOVF9FUlJPUl9GQUlMRUQsCisgICAgICAg
ICAgICAgICAgICAgIF8oImNhbid0IGNyZWF0ZSBkZXZpY2UgLSBpbnRlcm5hbCBlcnJvciIpKTsK
KyAgICAgICAgcmV0dXJuIEZBTFNFOworICAgIH0KKworICAgIGJlLT5vd25fZGV2aWNlc19tYXNr
IHw9IDEgPDwgYWRkcmVzczsKKworICAgIGRldi0+ZGV2aWNlX2luZm8udmlkID0gZGVzYy0+aWRW
ZW5kb3I7CisgICAgZGV2LT5kZXZpY2VfaW5mby5waWQgPSBkZXNjLT5pZFByb2R1Y3Q7CisgICAg
ZGV2LT5kZXZpY2VfaW5mby5iY2RVU0IgPSBkZXNjLT5iY2RVU0I7CisgICAgZGV2LT5kZXZpY2Vf
aW5mby5jbGFzcyA9IGRlc2MtPmJEZXZpY2VDbGFzczsKKyAgICBkZXYtPmRldmljZV9pbmZvLnN1
YmNsYXNzID0gZGVzYy0+YkRldmljZVN1YkNsYXNzOworICAgIGRldi0+ZGV2aWNlX2luZm8ucHJv
dG9jb2wgPSBkZXNjLT5iRGV2aWNlUHJvdG9jb2w7CisKKyAgICBpZiAoYmUtPmhvdHBsdWdfY2Fs
bGJhY2spIHsKKyAgICAgICAgYmUtPmhvdHBsdWdfY2FsbGJhY2soYmUtPmhvdHBsdWdfdXNlcl9k
YXRhLCBkZXYsIFRSVUUpOworICAgIH0KKyAgICBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfdW5y
ZWYoZGV2KTsKKworICAgIHJldHVybiBUUlVFOworfQorCiAjZW5kaWYgLyogVVNCX1JFRElSICov
CmRpZmYgLS1naXQgYS9zcmMvdXNiLWJhY2tlbmQuaCBiL3NyYy91c2ItYmFja2VuZC5oCmluZGV4
IDc1NTg4MDcwLi44MzMxOWRjNiAxMDA2NDQKLS0tIGEvc3JjL3VzYi1iYWNrZW5kLmgKKysrIGIv
c3JjL3VzYi1iYWNrZW5kLmgKQEAgLTMwLDEyICszMCwxNSBAQCB0eXBlZGVmIHN0cnVjdCBfU3Bp
Y2VVc2JCYWNrZW5kIFNwaWNlVXNiQmFja2VuZDsKIHR5cGVkZWYgc3RydWN0IF9TcGljZVVzYkRl
dmljZSBTcGljZVVzYkJhY2tlbmREZXZpY2U7CiB0eXBlZGVmIHN0cnVjdCBfU3BpY2VVc2JCYWNr
ZW5kQ2hhbm5lbCBTcGljZVVzYkJhY2tlbmRDaGFubmVsOwogCisjZGVmaW5lIEJVU19OVU1CRVJf
Rk9SX0VNVUxBVEVEX1VTQiBHX01BWFVJTlQxNgorCiB0eXBlZGVmIHN0cnVjdCBVc2JEZXZpY2VJ
bmZvcm1hdGlvbgogewogICAgIHVpbnQxNl90IGJ1czsKICAgICB1aW50MTZfdCBhZGRyZXNzOwog
ICAgIHVpbnQxNl90IHZpZDsKICAgICB1aW50MTZfdCBwaWQ7CisgICAgdWludDE2X3QgYmNkVVNC
OwogICAgIHVpbnQ4X3QgY2xhc3M7CiAgICAgdWludDhfdCBzdWJjbGFzczsKICAgICB1aW50OF90
IHByb3RvY29sOwpkaWZmIC0tZ2l0IGEvc3JjL3VzYi1lbXVsYXRpb24uaCBiL3NyYy91c2ItZW11
bGF0aW9uLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAuLmFjM2Q4ZTA1Ci0t
LSAvZGV2L251bGwKKysrIGIvc3JjL3VzYi1lbXVsYXRpb24uaApAQCAtMCwwICsxLDg4IEBACisv
KiAtKi0gTW9kZTogQzsgYy1iYXNpYy1vZmZzZXQ6IDQ7IGluZGVudC10YWJzLW1vZGU6IG5pbCAt
Ki0gKi8KKy8qCisgICAgQ29weXJpZ2h0IChDKSAyMDE5IFJlZCBIYXQsIEluYy4KKworICAgIFJl
ZCBIYXQgQXV0aG9yczoKKyAgICBZdXJpIEJlbmRpdG92aWNoPHliZW5kaXRvQHJlZGhhdC5jb20+
CisKKyAgICBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1
dGUgaXQgYW5kL29yCisgICAgbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExl
c3NlciBHZW5lcmFsIFB1YmxpYworICAgIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVl
IFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlcgorICAgIHZlcnNpb24gMi4xIG9mIHRoZSBMaWNl
bnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgorCisgICAgVGhpcyBs
aWJyYXJ5IGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWws
CisgICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQg
d2FycmFudHkgb2YKKyAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNV
TEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQorICAgIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNl
bnNlIGZvciBtb3JlIGRldGFpbHMuCisKKyAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBj
b3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCisgICAgTGljZW5zZSBhbG9uZyB3
aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNl
cy8+LgorKi8KKworI3ByYWdtYSBvbmNlCisKKyNpbmNsdWRlICJ1c2JyZWRpcnBhcnNlci5oIgor
I2luY2x1ZGUgInVzYi1iYWNrZW5kLmgiCisKK3R5cGVkZWYgc3RydWN0IFNwaWNlVXNiRW11bGF0
ZWREZXZpY2UgU3BpY2VVc2JFbXVsYXRlZERldmljZTsKK3R5cGVkZWYgU3BpY2VVc2JFbXVsYXRl
ZERldmljZSoKKygqU3BpY2VVc2JFbXVsYXRlZERldmljZUNyZWF0ZSkoU3BpY2VVc2JCYWNrZW5k
ICpiZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VVc2JCYWNrZW5kRGV2
aWNlICpwYXJlbnQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKmNyZWF0
ZV9wYXJhbXMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdFcnJvciAqKmVycik7
CisKKy8qCisgICAgZnVuY3Rpb24gdGFibGUgZm9yIGVtdWxhdGVkIFVTQiBkZXZpY2UKKyAgICBt
dXN0IGJlIGZpcnN0IG1lbWJlciBvZiBkZXZpY2Ugc3RydWN0dXJlCisgICAgYWxsIGZ1bmN0aW9u
cyBhcmUgbWFuZGF0b3J5IGZvciBpbXBsZW1lbnRhdGlvbgorKi8KK3R5cGVkZWYgc3RydWN0IFVz
YkRldmljZU9wcyB7CisgICAgZ2Jvb2xlYW4gKCpnZXRfZGVzY3JpcHRvcikoU3BpY2VVc2JFbXVs
YXRlZERldmljZSAqZGV2aWNlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ4
X3QgdHlwZSwgdWludDhfdCBpbmRleCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2
b2lkICoqYnVmZmVyLCB1aW50MTZfdCAqc2l6ZSk7CisgICAgZ2NoYXIgKiAoKmdldF9wcm9kdWN0
X2Rlc2NyaXB0aW9uKShTcGljZVVzYkVtdWxhdGVkRGV2aWNlICpkZXZpY2UpOworICAgIHZvaWQg
KCphdHRhY2gpKFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmRldmljZSwgc3RydWN0IHVzYnJlZGly
cGFyc2VyICpwYXJzZXIpOworICAgIHZvaWQgKCpyZXNldCkoU3BpY2VVc2JFbXVsYXRlZERldmlj
ZSAqZGV2aWNlKTsKKyAgICAvKgorICAgICAgICBwcm9jZXNzaW5nIGlzIHN5bmNocm9ub3VzLCBk
ZWZhdWx0ID0gc3RhbGw6CisgICAgICAgIC0gcmV0dXJuIHN1Y2Nlc3Mgd2l0aG91dCBkYXRhOiBz
ZXQgc3RhdHVzIHRvIDAKKyAgICAgICAgLSByZXR1cm4gZXJyb3IgLSBzZXQgc3RhdHVzIHRvIGVy
cm9yCisgICAgICAgIC0gcmV0dXJuIHN1Y2Nlc3Mgd2l0aCBkYXRhIC0gc2V0IHN0YXR1cyB0byAw
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0IGJ1ZmZlciB0byBzb21l
IGJ1ZmZlcgorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0IGxlbmd0aCB0
byBvdXQgbGVuCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVuY2F0aW9u
IGlzIGF1dG9tYXRpYworICAgICovCisgICAgdm9pZCAoKmNvbnRyb2xfcmVxdWVzdCkoU3BpY2VV
c2JFbXVsYXRlZERldmljZSAqZGV2aWNlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVp
bnQ4X3QgKmRhdGEsIGludCBkYXRhX2xlbiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBz
dHJ1Y3QgdXNiX3JlZGlyX2NvbnRyb2xfcGFja2V0X2hlYWRlciAqaCwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB2b2lkICoqYnVmZmVyKTsKKyAgICAvKgorICAgICAgICBwcm9jZXNzaW5n
IGlzIHN5bmNocm9ub3VzOgorICAgICAgICAtIHNldCBoLT5zdGF0dXMgdG8gcmVzdWx0aW5nIHN0
YXR1cywgZGVmYXVsdCA9IHN0YWxsCisgICAgKi8KKyAgICB2b2lkICgqYnVsa19vdXRfcmVxdWVz
dCkoU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZGV2aWNlLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB1aW50OF90IGVwLCB1aW50OF90ICpkYXRhLCBpbnQgZGF0YV9sZW4sCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHVpbnQ4X3QgKnN0YXR1cyk7CisgICAgLyoKKyAgICAgICAg
aWYgcmV0dXJucyB0cnVlLCBwcm9jZXNzaW5nIGlzIGFzeW5jaHJvbm91cworICAgICAgICBvdGhl
cndpc2UgaGVhZGVyIGNvbnRhaW5zIGVycm9yIHN0YXR1cworICAgICovCisgICAgZ2Jvb2xlYW4g
KCpidWxrX2luX3JlcXVlc3QpKFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmRldmljZSwgdWludDY0
X3QgaWQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHVzYl9yZWRpcl9idWxr
X3BhY2tldF9oZWFkZXIgKmJ1bGtfaGVhZGVyKTsKKyAgICB2b2lkICgqY2FuY2VsX3JlcXVlc3Qp
KFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmRldmljZSwgdWludDY0X3QgaWQpOworICAgIHZvaWQg
KCpkZXRhY2gpKFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmRldmljZSk7CisgICAgdm9pZCAoKnVu
cmVhbGl6ZSkoU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZGV2aWNlKTsKK30gVXNiRGV2aWNlT3Bz
OworCitzdGF0aWMgaW5saW5lIGNvbnN0IFVzYkRldmljZU9wcyAqZGV2aWNlX29wcyhTcGljZVVz
YkVtdWxhdGVkRGV2aWNlICpkZXYpCit7CisgICAgcmV0dXJuIChjb25zdCBVc2JEZXZpY2VPcHMg
KilkZXY7Cit9CisKK2dib29sZWFuCitzcGljZV91c2JfYmFja2VuZF9jcmVhdGVfZW11bGF0ZWRf
ZGV2aWNlKFNwaWNlVXNiQmFja2VuZCAqYmUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIFNwaWNlVXNiRW11bGF0ZWREZXZpY2VDcmVhdGUgY3JlYXRlX3Byb2MsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKmNyZWF0ZV9wYXJh
bXMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdFcnJvciAqKmVy
cik7Cit2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9lamVjdChTcGljZVVzYkJhY2tlbmQg
KmJlLCBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldmljZSk7Cit2b2lkIHNwaWNlX3VzYl9iYWNr
ZW5kX2RldmljZV9yZXBvcnRfY2hhbmdlKFNwaWNlVXNiQmFja2VuZCAqYmUsIFNwaWNlVXNiQmFj
a2VuZERldmljZSAqZGV2aWNlKTsKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KU3BpY2UtZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRl
dmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9t
YWlsbWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
