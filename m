Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A1B48324A5
	for <lists+spice-devel@lfdr.de>; Sun,  2 Jun 2019 21:32:35 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id ABD078925D;
	Sun,  2 Jun 2019 19:32:33 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5A4FB8925D
 for <spice-devel@lists.freedesktop.org>; Sun,  2 Jun 2019 19:32:32 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx08.intmail.prod.int.phx2.redhat.com
 [10.5.11.23])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id CCE58C057F4F
 for <spice-devel@lists.freedesktop.org>; Sun,  2 Jun 2019 19:32:31 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.3])
 by smtp.corp.redhat.com (Postfix) with ESMTP id BE76A196A6;
 Sun,  2 Jun 2019 19:32:30 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Sun,  2 Jun 2019 20:32:25 +0100
Message-Id: <20190602193226.19766-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.23
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.32]); Sun, 02 Jun 2019 19:32:31 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-server v2 1/2] char-device: Don't use
 RedClient API
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

UmVkQ2xpZW50IHdhcyBhbiBvcGFxdWUgc3RydWN0dXJlIGZvciBSZWRDaGFyRGV2aWNlLgpJdCBz
dGFydGVkIHRvIGJlIHVzZWQgd2hlbiBSZWRzU3RhdGUgc3RhcnRlZCB0byBjb250YWluIGFsbAp0
aGUgZ2xvYmFsIHN0YXRlLgpNYWtlIGl0IG9wYXF1ZSBhZ2FpbiB1c2luZyBhIG5ldyBSZWRDaGFy
RGV2aWNlQ2xpZW50T3BhcXVlLgpUaGUgUmVkQ2hhckRldmljZUNsaWVudE9wYXF1ZSBkZWZpbmUg
aW4gdGhlIGhlYWRlciBhbGxvd3MgdXNlcnMKb2YgdGhlIGNsYXNzIHRvIG92ZXJyaWRlIHRoZSB0
eXBlIHRvIGdldCBhIG1vcmUgc2FmZSB0eXBlCnRoYW4gUmVkQ2xpZW50LgpUaGUgZGVmaW5lIGF0
IHRoZSBiZWdpbm5pbmcgb2YgQyBmaWxlIGlzIHRvIG1ha2Ugc3VyZSB3ZSBkb24ndAp1c2UgdGhl
IG9wYXF1ZSB0eXBlIGFzIGEgc3BlY2lmaWMgb25lLgoKU2lnbmVkLW9mZi1ieTogRnJlZGlhbm8g
WmlnbGlvIDxmemlnbGlvQHJlZGhhdC5jb20+Ci0tLQogc2VydmVyL2NoYXItZGV2aWNlLmMgfCA1
MiArKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLQogc2VydmVyL2No
YXItZGV2aWNlLmggfCAyMiArKysrKysrKysrKy0tLS0tLS0tCiAyIGZpbGVzIGNoYW5nZWQsIDQy
IGluc2VydGlvbnMoKyksIDMyIGRlbGV0aW9ucygtKQoKVGhpcyBwYXRjaCB3YXMgbmFtZWQgImNo
YXItZGV2aWNlOiBNYWtlIFJlZENsaWVudCBhbiBvcGFxdWUgc3RydWN0dXJlIGFnYWluIgoKZGlm
ZiAtLWdpdCBhL3NlcnZlci9jaGFyLWRldmljZS5jIGIvc2VydmVyL2NoYXItZGV2aWNlLmMKaW5k
ZXggOWVlMjU1NjY0Li44MjI1NWU4MTEgMTAwNjQ0Ci0tLSBhL3NlcnZlci9jaGFyLWRldmljZS5j
CisrKyBiL3NlcnZlci9jaGFyLWRldmljZS5jCkBAIC0yMiw4ICsyMiwxMiBAQAogCiAjaW5jbHVk
ZSA8Y29uZmlnLmg+CiAjaW5jbHVkZSA8aW50dHlwZXMuaD4KKworCit0eXBlZGVmIHN0cnVjdCBS
ZWRDaGFyRGV2aWNlQ2xpZW50T3BhcXVlIFJlZENoYXJEZXZpY2VDbGllbnRPcGFxdWU7CisjZGVm
aW5lIFJlZENoYXJEZXZpY2VDbGllbnRPcGFxdWUgUmVkQ2hhckRldmljZUNsaWVudE9wYXF1ZQor
CiAjaW5jbHVkZSAiY2hhci1kZXZpY2UuaCIKLSNpbmNsdWRlICJyZWQtY2xpZW50LmgiCiAjaW5j
bHVkZSAicmVkcy5oIgogI2luY2x1ZGUgImdsaWItY29tcGF0LmgiCiAKQEAgLTM5LDcgKzQzLDcg
QEAgdHlwZWRlZiBlbnVtIHsKIH0gV3JpdGVCdWZmZXJPcmlnaW47CiAKIHN0cnVjdCBSZWRDaGFy
RGV2aWNlV3JpdGVCdWZmZXJQcml2YXRlIHsKLSAgICBSZWRDbGllbnQgKmNsaWVudDsgLyogVGhl
IGNsaWVudCB0aGF0IHNlbnQgdGhlIG1lc3NhZ2UgdG8gdGhlIGRldmljZS4KKyAgICBSZWRDaGFy
RGV2aWNlQ2xpZW50T3BhcXVlICpjbGllbnQ7IC8qIFRoZSBjbGllbnQgdGhhdCBzZW50IHRoZSBt
ZXNzYWdlIHRvIHRoZSBkZXZpY2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgIE5VTEwgaWYg
dGhlIHNlcnZlciBjcmVhdGVkIHRoZSBtZXNzYWdlICovCiAgICAgV3JpdGVCdWZmZXJPcmlnaW4g
b3JpZ2luOwogICAgIHVpbnQzMl90IHRva2VuX3ByaWNlOwpAQCAtNDksNyArNTMsNyBAQCBzdHJ1
Y3QgUmVkQ2hhckRldmljZVdyaXRlQnVmZmVyUHJpdmF0ZSB7CiB0eXBlZGVmIHN0cnVjdCBSZWRD
aGFyRGV2aWNlQ2xpZW50IFJlZENoYXJEZXZpY2VDbGllbnQ7CiBzdHJ1Y3QgUmVkQ2hhckRldmlj
ZUNsaWVudCB7CiAgICAgUmVkQ2hhckRldmljZSAqZGV2OwotICAgIFJlZENsaWVudCAqY2xpZW50
OworICAgIFJlZENoYXJEZXZpY2VDbGllbnRPcGFxdWUgKmNsaWVudDsKICAgICBpbnQgZG9fZmxv
d19jb250cm9sOwogICAgIHVpbnQ2NF90IG51bV9jbGllbnRfdG9rZW5zOwogICAgIHVpbnQ2NF90
IG51bV9jbGllbnRfdG9rZW5zX2ZyZWU7IC8qIGNsaWVudCBtZXNzYWdlcyB0aGF0IHdlcmUgY29u
c3VtZWQgYnkgdGhlIGRldmljZSAqLwpAQCAtMTA4LDcgKzExMiw3IEBAIHJlZF9jaGFyX2Rldmlj
ZV9yZWFkX29uZV9tc2dfZnJvbV9kZXZpY2UoUmVkQ2hhckRldmljZSAqZGV2KQogc3RhdGljIHZv
aWQKIHJlZF9jaGFyX2RldmljZV9zZW5kX21zZ190b19jbGllbnQoUmVkQ2hhckRldmljZSAqZGV2
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWRQaXBlSXRlbSAqbXNnLAot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWRDbGllbnQgKmNsaWVudCkKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVkQ2hhckRldmljZUNsaWVudE9wYXF1
ZSAqY2xpZW50KQogewogICAgUmVkQ2hhckRldmljZUNsYXNzICprbGFzcyA9IFJFRF9DSEFSX0RF
VklDRV9HRVRfQ0xBU1MoZGV2KTsKIApAQCAtMTE3LDcgKzEyMSw3IEBAIHJlZF9jaGFyX2Rldmlj
ZV9zZW5kX21zZ190b19jbGllbnQoUmVkQ2hhckRldmljZSAqZGV2LAogCiBzdGF0aWMgdm9pZAog
cmVkX2NoYXJfZGV2aWNlX3NlbmRfdG9rZW5zX3RvX2NsaWVudChSZWRDaGFyRGV2aWNlICpkZXYs
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlZENsaWVudCAqY2xpZW50
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWRDaGFyRGV2aWNlQ2xp
ZW50T3BhcXVlICpjbGllbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHVpbnQzMl90IHRva2VucykKIHsKICAgIFJlZENoYXJEZXZpY2VDbGFzcyAqa2xhc3MgPSBSRURf
Q0hBUl9ERVZJQ0VfR0VUX0NMQVNTKGRldik7CkBAIC0xNDAsNyArMTQ0LDcgQEAgcmVkX2NoYXJf
ZGV2aWNlX29uX2ZyZWVfc2VsZl90b2tlbihSZWRDaGFyRGV2aWNlICpkZXYpCiB9CiAKIHN0YXRp
YyB2b2lkCi1yZWRfY2hhcl9kZXZpY2VfcmVtb3ZlX2NsaWVudChSZWRDaGFyRGV2aWNlICpkZXYs
IFJlZENsaWVudCAqY2xpZW50KQorcmVkX2NoYXJfZGV2aWNlX3JlbW92ZV9jbGllbnQoUmVkQ2hh
ckRldmljZSAqZGV2LCBSZWRDaGFyRGV2aWNlQ2xpZW50T3BhcXVlICpjbGllbnQpCiB7CiAgICBS
ZWRDaGFyRGV2aWNlQ2xhc3MgKmtsYXNzID0gUkVEX0NIQVJfREVWSUNFX0dFVF9DTEFTUyhkZXYp
OwogCkBAIC0yMjIsNyArMjI2LDcgQEAgc3RhdGljIHZvaWQgcmVkX2NoYXJfZGV2aWNlX2hhbmRs
ZV9jbGllbnRfb3ZlcmZsb3coUmVkQ2hhckRldmljZUNsaWVudCAqZGV2X2NsaWUKIH0KIAogc3Rh
dGljIFJlZENoYXJEZXZpY2VDbGllbnQgKnJlZF9jaGFyX2RldmljZV9jbGllbnRfZmluZChSZWRD
aGFyRGV2aWNlICpkZXYsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIFJlZENsaWVudCAqY2xpZW50KQorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWRDaGFyRGV2aWNlQ2xpZW50T3Bh
cXVlICpjbGllbnQpCiB7CiAgICAgR0xpc3QgKml0ZW07CiAKQEAgLTQwMCw3ICs0MDQsNyBAQCBz
dGF0aWMgdm9pZCByZWRfY2hhcl9kZXZpY2Vfc2VuZF90b19jbGllbnRfdG9rZW5zX2Fic29yYihS
ZWRDaGFyRGV2aWNlQ2xpZW50ICpkZQogfQogCiB2b2lkIHJlZF9jaGFyX2RldmljZV9zZW5kX3Rv
X2NsaWVudF90b2tlbnNfYWRkKFJlZENoYXJEZXZpY2UgKmRldiwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVkQ2xpZW50ICpjbGllbnQsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlZENoYXJEZXZpY2VDbGll
bnRPcGFxdWUgKmNsaWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdWludDMyX3QgdG9rZW5zKQogewogICAgIFJlZENoYXJEZXZpY2VDbGllbnQgKmRl
dl9jbGllbnQ7CkBAIC00MTUsNyArNDE5LDcgQEAgdm9pZCByZWRfY2hhcl9kZXZpY2Vfc2VuZF90
b19jbGllbnRfdG9rZW5zX2FkZChSZWRDaGFyRGV2aWNlICpkZXYsCiB9CiAKIHZvaWQgcmVkX2No
YXJfZGV2aWNlX3NlbmRfdG9fY2xpZW50X3Rva2Vuc19zZXQoUmVkQ2hhckRldmljZSAqZGV2LAot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWRDbGllbnQg
KmNsaWVudCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
UmVkQ2hhckRldmljZUNsaWVudE9wYXF1ZSAqY2xpZW50LAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCB0b2tlbnMpCiB7CiAgICAgUmVkQ2hh
ckRldmljZUNsaWVudCAqZGV2X2NsaWVudDsKQEAgLTUzNCw3ICs1MzgsNyBAQCBzdGF0aWMgdm9p
ZCByZWRfY2hhcl9kZXZpY2Vfd3JpdGVfcmV0cnkodm9pZCAqb3BhcXVlKQogfQogCiBzdGF0aWMg
UmVkQ2hhckRldmljZVdyaXRlQnVmZmVyICoKLXJlZF9jaGFyX2RldmljZV93cml0ZV9idWZmZXJf
Z2V0KFJlZENoYXJEZXZpY2UgKmRldiwgUmVkQ2xpZW50ICpjbGllbnQsIGludCBzaXplLAorcmVk
X2NoYXJfZGV2aWNlX3dyaXRlX2J1ZmZlcl9nZXQoUmVkQ2hhckRldmljZSAqZGV2LCBSZWRDaGFy
RGV2aWNlQ2xpZW50T3BhcXVlICpjbGllbnQsIGludCBzaXplLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgV3JpdGVCdWZmZXJPcmlnaW4gb3JpZ2luLCBpbnQgbWlncmF0ZWRfZGF0
YV90b2tlbnMpCiB7CiAgICAgUmVkQ2hhckRldmljZVdyaXRlQnVmZmVyICpyZXQ7CkBAIC01OTgs
NyArNjAyLDcgQEAgZXJyb3I6CiB9CiAKIFJlZENoYXJEZXZpY2VXcml0ZUJ1ZmZlciAqcmVkX2No
YXJfZGV2aWNlX3dyaXRlX2J1ZmZlcl9nZXRfY2xpZW50KFJlZENoYXJEZXZpY2UgKmRldiwKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIFJlZENsaWVudCAqY2xpZW50LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVkQ2hhckRldmljZUNsaWVudE9w
YXF1ZSAqY2xpZW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgaW50IHNpemUpCiB7CiAgICAgc3BpY2VfYXNzZXJ0KGNs
aWVudCk7CkBAIC02NTgsNyArNjYyLDcgQEAgdm9pZCByZWRfY2hhcl9kZXZpY2Vfd3JpdGVfYnVm
ZmVyX3JlbGVhc2UoUmVkQ2hhckRldmljZSAqZGV2LAogCiAgICAgV3JpdGVCdWZmZXJPcmlnaW4g
YnVmX29yaWdpbiA9IHdyaXRlX2J1Zi0+cHJpdi0+b3JpZ2luOwogICAgIHVpbnQzMl90IGJ1Zl90
b2tlbl9wcmljZSA9IHdyaXRlX2J1Zi0+cHJpdi0+dG9rZW5fcHJpY2U7Ci0gICAgUmVkQ2xpZW50
ICpjbGllbnQgPSB3cml0ZV9idWYtPnByaXYtPmNsaWVudDsKKyAgICBSZWRDaGFyRGV2aWNlQ2xp
ZW50T3BhcXVlICpjbGllbnQgPSB3cml0ZV9idWYtPnByaXYtPmNsaWVudDsKIAogICAgIGlmICgh
ZGV2KSB7CiAgICAgICAgIGdfd2FybmluZygibm8gZGV2aWNlLiB3cml0ZSBidWZmZXIgaXMgZnJl
ZWQiKTsKQEAgLTcwMywxMSArNzA3LDEzIEBAIHZvaWQgcmVkX2NoYXJfZGV2aWNlX2Rlc3Ryb3ko
UmVkQ2hhckRldmljZSAqY2hhcl9kZXYpCiAgICAgZ19vYmplY3RfdW5yZWYoY2hhcl9kZXYpOwog
fQogCi1zdGF0aWMgUmVkQ2hhckRldmljZUNsaWVudCAqcmVkX2NoYXJfZGV2aWNlX2NsaWVudF9u
ZXcoUmVkQ2xpZW50ICpjbGllbnQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgaW50IGRvX2Zsb3dfY29udHJvbCwKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBtYXhfc2Vu
ZF9xdWV1ZV9zaXplLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHVpbnQzMl90IG51bV9jbGllbnRfdG9rZW5zLAotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IG51bV9zZW5k
X3Rva2VucykKK3N0YXRpYyBSZWRDaGFyRGV2aWNlQ2xpZW50ICoKK3JlZF9jaGFyX2RldmljZV9j
bGllbnRfbmV3KFJlZHNTdGF0ZSAqcmVkcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIFJl
ZENoYXJEZXZpY2VDbGllbnRPcGFxdWUgKmNsaWVudCwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGludCBkb19mbG93X2NvbnRyb2wsCisgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50
MzJfdCBtYXhfc2VuZF9xdWV1ZV9zaXplLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgdWlu
dDMyX3QgbnVtX2NsaWVudF90b2tlbnMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50
MzJfdCBudW1fc2VuZF90b2tlbnMpCiB7CiAgICAgUmVkQ2hhckRldmljZUNsaWVudCAqZGV2X2Ns
aWVudDsKIApAQCAtNzE3LDggKzcyMyw2IEBAIHN0YXRpYyBSZWRDaGFyRGV2aWNlQ2xpZW50ICpy
ZWRfY2hhcl9kZXZpY2VfY2xpZW50X25ldyhSZWRDbGllbnQgKmNsaWVudCwKICAgICBkZXZfY2xp
ZW50LT5tYXhfc2VuZF9xdWV1ZV9zaXplID0gbWF4X3NlbmRfcXVldWVfc2l6ZTsKICAgICBkZXZf
Y2xpZW50LT5kb19mbG93X2NvbnRyb2wgPSBkb19mbG93X2NvbnRyb2w7CiAgICAgaWYgKGRvX2Zs
b3dfY29udHJvbCkgewotICAgICAgICBSZWRzU3RhdGUgKnJlZHMgPSByZWRfY2xpZW50X2dldF9z
ZXJ2ZXIoY2xpZW50KTsKLQogICAgICAgICBkZXZfY2xpZW50LT53YWl0X2Zvcl90b2tlbnNfdGlt
ZXIgPQogICAgICAgICAgICAgcmVkc19jb3JlX3RpbWVyX2FkZChyZWRzLCBkZXZpY2VfY2xpZW50
X3dhaXRfZm9yX3Rva2Vuc190aW1lb3V0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBkZXZfY2xpZW50KTsKQEAgLTczNiw3ICs3NDAsNyBAQCBzdGF0aWMgUmVkQ2hhckRldmljZUNs
aWVudCAqcmVkX2NoYXJfZGV2aWNlX2NsaWVudF9uZXcoUmVkQ2xpZW50ICpjbGllbnQsCiB9CiAK
IGJvb2wgcmVkX2NoYXJfZGV2aWNlX2NsaWVudF9hZGQoUmVkQ2hhckRldmljZSAqZGV2LAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWRDbGllbnQgKmNsaWVudCwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgUmVkQ2hhckRldmljZUNsaWVudE9wYXF1ZSAqY2xpZW50
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgZG9fZmxvd19jb250cm9sLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBtYXhfc2VuZF9xdWV1ZV9z
aXplLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBudW1fY2xpZW50
X3Rva2VucywKQEAgLTc1Nyw3ICs3NjEsOSBAQCBib29sIHJlZF9jaGFyX2RldmljZV9jbGllbnRf
YWRkKFJlZENoYXJEZXZpY2UgKmRldiwKICAgICBkZXYtPnByaXYtPndhaXRfZm9yX21pZ3JhdGVf
ZGF0YSA9IHdhaXRfZm9yX21pZ3JhdGVfZGF0YTsKIAogICAgIHNwaWNlX2RlYnVnKCJjaGFyIGRl
dmljZSAlcCwgY2xpZW50ICVwIiwgZGV2LCBjbGllbnQpOwotICAgIGRldl9jbGllbnQgPSByZWRf
Y2hhcl9kZXZpY2VfY2xpZW50X25ldyhjbGllbnQsIGRvX2Zsb3dfY29udHJvbCwKKyAgICBkZXZf
Y2xpZW50ID0gcmVkX2NoYXJfZGV2aWNlX2NsaWVudF9uZXcoZGV2LT5wcml2LT5yZWRzLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGllbnQsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvX2Zsb3dfY29udHJvbCwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4X3NlbmRfcXVldWVf
c2l6ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtX2Ns
aWVudF90b2tlbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IG51bV9zZW5kX3Rva2Vucyk7CkBAIC03NjksNyArNzc1LDcgQEAgYm9vbCByZWRfY2hhcl9kZXZp
Y2VfY2xpZW50X2FkZChSZWRDaGFyRGV2aWNlICpkZXYsCiB9CiAKIHZvaWQgcmVkX2NoYXJfZGV2
aWNlX2NsaWVudF9yZW1vdmUoUmVkQ2hhckRldmljZSAqZGV2LAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBSZWRDbGllbnQgKmNsaWVudCkKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgUmVkQ2hhckRldmljZUNsaWVudE9wYXF1ZSAqY2xpZW50KQogewogICAg
IFJlZENoYXJEZXZpY2VDbGllbnQgKmRldl9jbGllbnQ7CiAKQEAgLTc5Niw3ICs4MDIsNyBAQCB2
b2lkIHJlZF9jaGFyX2RldmljZV9jbGllbnRfcmVtb3ZlKFJlZENoYXJEZXZpY2UgKmRldiwKIH0K
IAogaW50IHJlZF9jaGFyX2RldmljZV9jbGllbnRfZXhpc3RzKFJlZENoYXJEZXZpY2UgKmRldiwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWRDbGllbnQgKmNsaWVudCkKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWRDaGFyRGV2aWNlQ2xpZW50T3BhcXVl
ICpjbGllbnQpCiB7CiAgICAgcmV0dXJuIChyZWRfY2hhcl9kZXZpY2VfY2xpZW50X2ZpbmQoZGV2
LCBjbGllbnQpICE9IE5VTEwpOwogfQpkaWZmIC0tZ2l0IGEvc2VydmVyL2NoYXItZGV2aWNlLmgg
Yi9zZXJ2ZXIvY2hhci1kZXZpY2UuaAppbmRleCAzMmVlNGY3OGEuLjlkNGNmOWQ5MiAxMDA2NDQK
LS0tIGEvc2VydmVyL2NoYXItZGV2aWNlLmgKKysrIGIvc2VydmVyL2NoYXItZGV2aWNlLmgKQEAg
LTM4LDYgKzM4LDEwIEBAIHR5cGVkZWYgc3RydWN0IFNwaWNlQ2hhckRldmljZVN0YXRlIFJlZENo
YXJEZXZpY2U7CiB0eXBlZGVmIHN0cnVjdCBSZWRDaGFyRGV2aWNlQ2xhc3MgUmVkQ2hhckRldmlj
ZUNsYXNzOwogdHlwZWRlZiBzdHJ1Y3QgUmVkQ2hhckRldmljZVByaXZhdGUgUmVkQ2hhckRldmlj
ZVByaXZhdGU7CiAKKyNpZm5kZWYgUmVkQ2hhckRldmljZUNsaWVudE9wYXF1ZQorI2RlZmluZSBS
ZWRDaGFyRGV2aWNlQ2xpZW50T3BhcXVlIFJlZENsaWVudAorI2VuZGlmCisKIC8qICdTcGljZUNo
YXJEZXZpY2VTdGF0ZScgbmFtZSBpcyB1c2VkIGZvciBjb25zaXN0ZW5jeSB3aXRoIHdoYXQgc3Bp
Y2UtY2hhci5oIGV4cG9ydHMgKi8KIHN0cnVjdCBTcGljZUNoYXJEZXZpY2VTdGF0ZQogewpAQCAt
NjIsMTIgKzY2LDEyIEBAIHN0cnVjdCBSZWRDaGFyRGV2aWNlQ2xhc3MKICAgICAvKiBhZnRlciB0
aGlzIGNhbGwsIHRoZSBtZXNzYWdlIGlzIHVucmVmZXJlbmNlZCAqLwogICAgIHZvaWQgKCpzZW5k
X21zZ190b19jbGllbnQpKFJlZENoYXJEZXZpY2UgKnNlbGYsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgUmVkUGlwZUl0ZW0gKm1zZywKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBSZWRDbGllbnQgKmNsaWVudCk7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
UmVkQ2hhckRldmljZUNsaWVudE9wYXF1ZSAqY2xpZW50KTsKIAogICAgIC8qIFRoZSBjYiBpcyBj
YWxsZWQgd2hlbiBhIHByZWRlZmluZWQgbnVtYmVyIG9mIHdyaXRlIGJ1ZmZlcnMgd2VyZSBjb25z
dW1lZCBieSB0aGUKICAgICAgKiBkZXZpY2UgKi8KICAgICB2b2lkICgqc2VuZF90b2tlbnNfdG9f
Y2xpZW50KShSZWRDaGFyRGV2aWNlICpzZWxmLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIFJlZENsaWVudCAqY2xpZW50LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIFJlZENoYXJEZXZpY2VDbGllbnRPcGFxdWUgKmNsaWVudCwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB1aW50MzJfdCB0b2tlbnMpOwogCiAgICAgLyogVGhlIGNiIGlzIGNh
bGxlZCB3aGVuIGEgc2VydmVyIChzZWxmKSBtZXNzYWdlIHRoYXQgd2FzIGFkZHJlc3NlZCB0byB0
aGUgZGV2aWNlLApAQCAtNzcsNyArODEsNyBAQCBzdHJ1Y3QgUmVkQ2hhckRldmljZUNsYXNzCiAg
ICAgLyogVGhpcyBjYiBpcyBjYWxsZWQgaWYgaXQgaXMgcmVjb21tZW5kZWQgdG8gcmVtb3ZlIHRo
ZSBjbGllbnQKICAgICAgKiBkdWUgdG8gc2xvdyBmbG93IG9yIGR1ZSB0byBzb21lIG90aGVyIGVy
cm9yLgogICAgICAqIFRoZSBjYWxsZWQgaW5zdGFuY2Ugc2hvdWxkIGRpc2Nvbm5lY3QgdGhlIGNs
aWVudCwgb3IgYXQgbGVhc3QgdGhlIGNvcnJlc3BvbmRpbmcgY2hhbm5lbCAqLwotICAgIHZvaWQg
KCpyZW1vdmVfY2xpZW50KShSZWRDaGFyRGV2aWNlICpzZWxmLCBSZWRDbGllbnQgKmNsaWVudCk7
CisgICAgdm9pZCAoKnJlbW92ZV9jbGllbnQpKFJlZENoYXJEZXZpY2UgKnNlbGYsIFJlZENoYXJE
ZXZpY2VDbGllbnRPcGFxdWUgKmNsaWVudCk7CiAKICAgICAvKiBUaGlzIGNiIGlzIGNhbGxlZCB3
aGVuIGRldmljZSByZWNlaXZlcyBhbiBldmVudCAqLwogICAgIHZvaWQgKCpwb3J0X2V2ZW50KShS
ZWRDaGFyRGV2aWNlICpzZWxmLCB1aW50OF90IGV2ZW50KTsKQEAgLTE4OCw3ICsxOTIsNyBAQCB2
b2lkIHJlZF9jaGFyX2RldmljZV9yZXNldChSZWRDaGFyRGV2aWNlICpkZXYpOwogLyogbWF4X3Nl
bmRfcXVldWVfc2l6ZSA9IGhvdyBtYW55IG1lc3NhZ2VzIHdlIGNhbiByZWFkIGZyb20gdGhlIGRl
dmljZSBhbmQgZW5xdWV1ZSBmb3IgdGhpcyBjbGllbnQsCiAgKiB3aGVuIHdlIGhhdmUgdG9rZW5z
IGZvciBvdGhlciBjbGllbnRzIGFuZCBubyB0b2tlbnMgZm9yIHRoaXMgb25lICovCiBib29sIHJl
ZF9jaGFyX2RldmljZV9jbGllbnRfYWRkKFJlZENoYXJEZXZpY2UgKmRldiwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgUmVkQ2xpZW50ICpjbGllbnQsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIFJlZENoYXJEZXZpY2VDbGllbnRPcGFxdWUgKmNsaWVudCwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGRvX2Zsb3dfY29udHJvbCwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgbWF4X3NlbmRfcXVldWVfc2l6ZSwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgbnVtX2NsaWVudF90b2tlbnMs
CkBAIC0xOTYsOSArMjAwLDkgQEAgYm9vbCByZWRfY2hhcl9kZXZpY2VfY2xpZW50X2FkZChSZWRD
aGFyRGV2aWNlICpkZXYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCB3YWl0
X2Zvcl9taWdyYXRlX2RhdGEpOwogCiB2b2lkIHJlZF9jaGFyX2RldmljZV9jbGllbnRfcmVtb3Zl
KFJlZENoYXJEZXZpY2UgKmRldiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
UmVkQ2xpZW50ICpjbGllbnQpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBS
ZWRDaGFyRGV2aWNlQ2xpZW50T3BhcXVlICpjbGllbnQpOwogaW50IHJlZF9jaGFyX2RldmljZV9j
bGllbnRfZXhpc3RzKFJlZENoYXJEZXZpY2UgKmRldiwKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBSZWRDbGllbnQgKmNsaWVudCk7CisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgUmVkQ2hhckRldmljZUNsaWVudE9wYXF1ZSAqY2xpZW50KTsKIAogdm9pZCByZWRf
Y2hhcl9kZXZpY2Vfc3RhcnQoUmVkQ2hhckRldmljZSAqZGV2KTsKIHZvaWQgcmVkX2NoYXJfZGV2
aWNlX3N0b3AoUmVkQ2hhckRldmljZSAqZGV2KTsKQEAgLTIwOSwxNyArMjEzLDE3IEBAIFNwaWNl
U2VydmVyKiByZWRfY2hhcl9kZXZpY2VfZ2V0X3NlcnZlcihSZWRDaGFyRGV2aWNlICpkZXYpOwog
dm9pZCByZWRfY2hhcl9kZXZpY2Vfd2FrZXVwKFJlZENoYXJEZXZpY2UgKmRldik7CiAKIHZvaWQg
cmVkX2NoYXJfZGV2aWNlX3NlbmRfdG9fY2xpZW50X3Rva2Vuc19hZGQoUmVkQ2hhckRldmljZSAq
ZGV2LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWRD
bGllbnQgKmNsaWVudCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgUmVkQ2hhckRldmljZUNsaWVudE9wYXF1ZSAqY2xpZW50LAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCB0b2tlbnMpOwogCiAKIHZv
aWQgcmVkX2NoYXJfZGV2aWNlX3NlbmRfdG9fY2xpZW50X3Rva2Vuc19zZXQoUmVkQ2hhckRldmlj
ZSAqZGV2LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBS
ZWRDbGllbnQgKmNsaWVudCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgUmVkQ2hhckRldmljZUNsaWVudE9wYXF1ZSAqY2xpZW50LAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCB0b2tlbnMpOwogLyoq
IFdyaXRlIHRvIGRldmljZSAqKi8KIAogUmVkQ2hhckRldmljZVdyaXRlQnVmZmVyICpyZWRfY2hh
cl9kZXZpY2Vfd3JpdGVfYnVmZmVyX2dldF9jbGllbnQoUmVkQ2hhckRldmljZSAqZGV2LAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgUmVkQ2xpZW50ICpjbGllbnQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWRDaGFyRGV2aWNlQ2xpZW50T3Bh
cXVlICpjbGllbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBpbnQgc2l6ZSk7CiAKIC8qIFJldHVybnMgTlVMTCBpZiB1
c2VfdG9rZW4gPT0gdHJ1ZSBhbmQgbm8gdG9rZW5zIGFyZSBhdmFpbGFibGUgKi8KLS0gCjIuMjAu
MQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KU3BpY2Ut
ZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
