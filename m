Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C8C2A7DE5F
	for <lists+spice-devel@lfdr.de>; Thu,  1 Aug 2019 17:01:27 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 515836E6C1;
	Thu,  1 Aug 2019 15:01:26 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6D1316E6C2
 for <spice-devel@lists.freedesktop.org>; Thu,  1 Aug 2019 15:01:24 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx08.intmail.prod.int.phx2.redhat.com
 [10.5.11.23])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 1AE0FC08E28A
 for <spice-devel@lists.freedesktop.org>; Thu,  1 Aug 2019 15:01:24 +0000 (UTC)
Received: from dhcp-4-93.tlv.redhat.com (dhcp-4-93.tlv.redhat.com [10.35.4.93])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 7B9E0196FF
 for <spice-devel@lists.freedesktop.org>; Thu,  1 Aug 2019 15:01:23 +0000 (UTC)
From: Snir Sheriber <ssheribe@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Thu,  1 Aug 2019 18:01:19 +0300
Message-Id: <20190801150119.29179-4-ssheribe@redhat.com>
In-Reply-To: <20190801150119.29179-1-ssheribe@redhat.com>
References: <20190801150119.29179-1-ssheribe@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.23
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.31]); Thu, 01 Aug 2019 15:01:24 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-streaming-agent 4/4] gst-plugin: reduce
 number of templates being used
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

LS0tCgpUaGlzIHBhdGNoIGlzIG5vdCByZWFsbHkgbmVjZXNzYXJ5LCBqdXN0IGEgc3VnZ2VzdGlv
biwgaXQncyBhIGJpdCBoYWNreQpidXQgd291bGQgc2F2ZSBzb21lIGNvZGUuCk90aGVyIG9wdGlv
bnMgd291bGQgYmUgdG8gdXNlIGV4cGxpY2l0IHRlbXBsYXRlIHNwZWNpYWxpemF0aW9uIG9yIHRv
CmxlYXZlIGl0IGFzIGlzLgoKLS0tCiBzcmMvZ3N0LXBsdWdpbi5jcHAgfCA0NCArKysrKysrKysr
KysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDE0IGlu
c2VydGlvbnMoKyksIDMwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3NyYy9nc3QtcGx1Z2lu
LmNwcCBiL3NyYy9nc3QtcGx1Z2luLmNwcAppbmRleCBjNzQxMmM1Li41ZjRjYzNkIDEwMDY0NAot
LS0gYS9zcmMvZ3N0LXBsdWdpbi5jcHAKKysrIGIvc3JjL2dzdC1wbHVnaW4uY3BwCkBAIC00OSwz
MiArNDksMTYgQEAgc3RydWN0IEdzdE9iamVjdERlbGV0ZXIgewogdGVtcGxhdGUgPHR5cGVuYW1l
IFQ+CiB1c2luZyBHc3RPYmplY3RVUHRyID0gc3RkOjp1bmlxdWVfcHRyPFQsIEdzdE9iamVjdERl
bGV0ZXI8VD4+OwogCi1zdHJ1Y3QgR3N0Q2Fwc0RlbGV0ZXIgewotICAgIHZvaWQgb3BlcmF0b3Io
KShHc3RDYXBzKiBwKQotICAgIHsKLSAgICAgICAgZ3N0X2NhcHNfdW5yZWYocCk7Ci0gICAgfQot
fTsKLQotdXNpbmcgR3N0Q2Fwc1VQdHIgPSBzdGQ6OnVuaXF1ZV9wdHI8R3N0Q2FwcywgR3N0Q2Fw
c0RlbGV0ZXI+OwotCi1zdHJ1Y3QgR3N0U2FtcGxlRGVsZXRlciB7Ci0gICAgdm9pZCBvcGVyYXRv
cigpKEdzdFNhbXBsZSogcCkKLSAgICB7Ci0gICAgICAgIGdzdF9zYW1wbGVfdW5yZWYocCk7Ci0g
ICAgfQotfTsKLQotdXNpbmcgR3N0U2FtcGxlVVB0ciA9IHN0ZDo6dW5pcXVlX3B0cjxHc3RTYW1w
bGUsIEdzdFNhbXBsZURlbGV0ZXI+OwotCi1zdHJ1Y3QgR3N0QnVmZmVyRGVsZXRlciB7Ci0gICAg
dm9pZCBvcGVyYXRvcigpKEdzdEJ1ZmZlciogcCkKK3RlbXBsYXRlIDx0eXBlbmFtZSBUPgorc3Ry
dWN0IEdzdE1pbmlPYmplY3REZWxldGVyIHsKKyAgICB2b2lkIG9wZXJhdG9yKCkoVCogcCkKICAg
ICB7Ci0gICAgICAgIGdzdF9idWZmZXJfdW5yZWYocCk7CisgICAgICAgIGdzdF9taW5pX29iamVj
dF91bnJlZihHU1RfTUlOSV9PQkpFQ1RfQ0FTVChwKSk7CiAgICAgfQogfTsKIAotdXNpbmcgR3N0
QnVmZmVyVVB0ciA9IHN0ZDo6dW5pcXVlX3B0cjxHc3RCdWZmZXIsIEdzdEJ1ZmZlckRlbGV0ZXI+
OwordGVtcGxhdGUgPHR5cGVuYW1lIFQ+Cit1c2luZyBHc3RNaW5pT2JqZWN0VVB0ciA9IHN0ZDo6
dW5pcXVlX3B0cjxULCBHc3RNaW5pT2JqZWN0RGVsZXRlcjxUPj47CiAKIGNsYXNzIEdzdHJlYW1l
ckZyYW1lQ2FwdHVyZSBmaW5hbCA6IHB1YmxpYyBGcmFtZUNhcHR1cmUKIHsKQEAgLTg5LDcgKzcz
LDcgQEAgcHVibGljOgogICAgIHN0ZDo6dmVjdG9yPERldmljZURpc3BsYXlJbmZvPiBnZXRfZGV2
aWNlX2Rpc3BsYXlfaW5mbygpIGNvbnN0IG92ZXJyaWRlOwogcHJpdmF0ZToKICAgICB2b2lkIGZy
ZWVfc2FtcGxlKCk7Ci0gICAgR3N0RWxlbWVudCAqZ2V0X2VuY29kZXJfcGx1Z2luKGNvbnN0IEdz
dHJlYW1lckVuY29kZXJTZXR0aW5ncyAmc2V0dGluZ3MsIEdzdENhcHNVUHRyICZzaW5rX2NhcHMp
OworICAgIEdzdEVsZW1lbnQgKmdldF9lbmNvZGVyX3BsdWdpbihjb25zdCBHc3RyZWFtZXJFbmNv
ZGVyU2V0dGluZ3MgJnNldHRpbmdzLCBHc3RNaW5pT2JqZWN0VVB0cjxHc3RDYXBzPiAmc2lua19j
YXBzKTsKICAgICBHc3RFbGVtZW50ICpnZXRfY2FwdHVyZV9wbHVnaW4oY29uc3QgR3N0cmVhbWVy
RW5jb2RlclNldHRpbmdzICZzZXR0aW5ncyk7CiAgICAgdm9pZCBwaXBlbGluZV9pbml0KGNvbnN0
IEdzdHJlYW1lckVuY29kZXJTZXR0aW5ncyAmc2V0dGluZ3MpOwogICAgIERpc3BsYXkgKmNvbnN0
IGRweTsKQEAgLTk3LDcgKzgxLDcgQEAgcHJpdmF0ZToKICAgICB2b2lkIHhsaWJfY2FwdHVyZSgp
OwogI2VuZGlmCiAgICAgR3N0T2JqZWN0VVB0cjxHc3RFbGVtZW50PiBwaXBlbGluZSwgY2FwdHVy
ZSwgc2luazsKLSAgICBHc3RTYW1wbGVVUHRyIHNhbXBsZTsKKyAgICBHc3RNaW5pT2JqZWN0VVB0
cjxHc3RTYW1wbGU+IHNhbXBsZTsKICAgICBHc3RNYXBJbmZvIG1hcCA9IHt9OwogICAgIHVpbnQz
Ml90IGxhc3Rfd2lkdGggPSB+MHUsIGxhc3RfaGVpZ2h0ID0gfjB1OwogICAgIHVpbnQzMl90IGN1
cl93aWR0aCA9IDAsIGN1cl9oZWlnaHQgPSAwOwpAQCAtMTM0LDcgKzExOCw3IEBAIEdzdEVsZW1l
bnQgKkdzdHJlYW1lckZyYW1lQ2FwdHVyZTo6Z2V0X2NhcHR1cmVfcGx1Z2luKGNvbnN0IEdzdHJl
YW1lckVuY29kZXJTZXR0CiB9CiAKIEdzdEVsZW1lbnQgKkdzdHJlYW1lckZyYW1lQ2FwdHVyZTo6
Z2V0X2VuY29kZXJfcGx1Z2luKGNvbnN0IEdzdHJlYW1lckVuY29kZXJTZXR0aW5ncyAmc2V0dGlu
Z3MsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBHc3RDYXBzVVB0ciAmc2lua19jYXBzKQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgR3N0TWluaU9iamVjdFVQdHI8R3N0Q2Fwcz4gJnNpbmtf
Y2FwcykKIHsKICAgICBHTGlzdCAqZW5jb2RlcnM7CiAgICAgR0xpc3QgKmZpbHRlcmVkOwpAQCAt
MjM4LDcgKzIyMiw3IEBAIHZvaWQgR3N0cmVhbWVyRnJhbWVDYXB0dXJlOjpwaXBlbGluZV9pbml0
KGNvbnN0IEdzdHJlYW1lckVuY29kZXJTZXR0aW5ncyAmc2V0dGluCiAgICAgaWYgKCFjb252ZXJ0
KSB7CiAgICAgICAgIHRocm93IHN0ZDo6cnVudGltZV9lcnJvcigiR3N0cmVhbWVyJ3MgJ2F1dG92
aWRlb2NvbnZlcnQnIGVsZW1lbnQgY2Fubm90IGJlIGNyZWF0ZWQiKTsKICAgICB9Ci0gICAgR3N0
Q2Fwc1VQdHIgc2lua19jYXBzOworICAgIEdzdE1pbmlPYmplY3RVUHRyPEdzdENhcHM+IHNpbmtf
Y2FwczsKICAgICBHc3RPYmplY3RVUHRyPEdzdEVsZW1lbnQ+IGVuY29kZXIoZ2V0X2VuY29kZXJf
cGx1Z2luKHNldHRpbmdzLCBzaW5rX2NhcHMpKTsKICAgICBpZiAoIWVuY29kZXIpIHsKICAgICAg
ICAgdGhyb3cgc3RkOjpydW50aW1lX2Vycm9yKCJHc3RyZWFtZXIncyBlbmNvZGVyIGVsZW1lbnQg
Y2Fubm90IGJlIGNyZWF0ZWQiKTsKQEAgLTI2MCw3ICsyNDQsNyBAQCB2b2lkIEdzdHJlYW1lckZy
YW1lQ2FwdHVyZTo6cGlwZWxpbmVfaW5pdChjb25zdCBHc3RyZWFtZXJFbmNvZGVyU2V0dGluZ3Mg
JnNldHRpbgogICAgIGdzdF9iaW5fYWRkKGJpbiwgZW5jb2Rlcik7CiAgICAgZ3N0X2Jpbl9hZGQo
YmluLCBzaW5rKTsKIAotICAgIEdzdENhcHNVUHRyIGNhcHMoZ3N0X2NhcHNfZnJvbV9zdHJpbmco
InZpZGVvL3gtcmF3KEFOWSkiKSk7CisgICAgR3N0TWluaU9iamVjdFVQdHI8R3N0Q2Fwcz4gY2Fw
cyhnc3RfY2Fwc19mcm9tX3N0cmluZygidmlkZW8veC1yYXcoQU5ZKSIpKTsKICAgICBsaW5rID0g
Z3N0X2VsZW1lbnRfbGluayhjYXB0dXJlLmdldCgpLCBjb252ZXJ0LmdldCgpKSAmJgogICAgICAg
ICAgICBnc3RfZWxlbWVudF9saW5rX2ZpbHRlcmVkKGNvbnZlcnQuZ2V0KCksIGVuY29kZXIuZ2V0
KCksIGNhcHMuZ2V0KCkpICYmCiAgICAgICAgICAgIGdzdF9lbGVtZW50X2xpbmtfZmlsdGVyZWQo
ZW5jb2Rlci5nZXQoKSwgc2luay5nZXQoKSwgc2lua19jYXBzLmdldCgpKTsKQEAgLTM2Miw3ICsz
NDYsNyBAQCB2b2lkIEdzdHJlYW1lckZyYW1lQ2FwdHVyZTo6eGxpYl9jYXB0dXJlKCkKICAgICAg
ICAgdGhyb3cgc3RkOjpydW50aW1lX2Vycm9yKCJDYW5ub3QgY2FwdHVyZSBmcm9tIFgiKTsKICAg
ICB9CiAKLSAgICBHc3RCdWZmZXJVUHRyIGJ1Zihnc3RfYnVmZmVyX25ld193cmFwcGVkX2Z1bGwo
KEdzdE1lbW9yeUZsYWdzKTAsIGltYWdlLT5kYXRhLAorICAgIEdzdE1pbmlPYmplY3RVUHRyPEdz
dEJ1ZmZlcj4gYnVmKGdzdF9idWZmZXJfbmV3X3dyYXBwZWRfZnVsbCgoR3N0TWVtb3J5RmxhZ3Mp
MCwgaW1hZ2UtPmRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGltYWdlLT5oZWlnaHQgKiBpbWFnZS0+Ynl0ZXNfcGVyX2xpbmUsIDAsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlLT5oZWln
aHQgKiBpbWFnZS0+Ynl0ZXNfcGVyX2xpbmUsIGltYWdlLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmVlX3hpbWFnZSkpOwpAQCAtMzcwLDcgKzM1
NCw3IEBAIHZvaWQgR3N0cmVhbWVyRnJhbWVDYXB0dXJlOjp4bGliX2NhcHR1cmUoKQogICAgICAg
ICB0aHJvdyBzdGQ6OnJ1bnRpbWVfZXJyb3IoIkZhaWxlZCB0byB3cmFwIGltYWdlIGluIGdzdHJl
YW1lciBidWZmZXIiKTsKICAgICB9CiAKLSAgICBHc3RDYXBzVVB0ciBjYXBzKGdzdF9jYXBzX25l
d19zaW1wbGUoInZpZGVvL3gtcmF3IiwKKyAgICBHc3RNaW5pT2JqZWN0VVB0cjxHc3RDYXBzPiBj
YXBzKGdzdF9jYXBzX25ld19zaW1wbGUoInZpZGVvL3gtcmF3IiwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgImZvcm1hdCIsIEdfVFlQRV9TVFJJTkcsICJCR1J4IiwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIndpZHRoIiwgR19UWVBF
X0lOVCwgaW1hZ2UtPndpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAiaGVpZ2h0IiwgR19UWVBFX0lOVCwgaW1hZ2UtPmhlaWdodCwKQEAgLTM3OCw3ICszNjIs
NyBAQCB2b2lkIEdzdHJlYW1lckZyYW1lQ2FwdHVyZTo6eGxpYl9jYXB0dXJlKCkKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbHB0cikpOwogCiAgICAgLy8gUHVz
aCBzYW1wbGUKLSAgICBHc3RTYW1wbGVVUHRyIGFwcHNyY19zYW1wbGUoZ3N0X3NhbXBsZV9uZXco
YnVmLmdldCgpLCBjYXBzLmdldCgpLCBudWxscHRyLCBudWxscHRyKSk7CisgICAgR3N0TWluaU9i
amVjdFVQdHI8R3N0U2FtcGxlPiBhcHBzcmNfc2FtcGxlKGdzdF9zYW1wbGVfbmV3KGJ1Zi5nZXQo
KSwgY2Fwcy5nZXQoKSwgbnVsbHB0ciwgbnVsbHB0cikpOwogICAgIGlmIChnc3RfYXBwX3NyY19w
dXNoX3NhbXBsZShHU1RfQVBQX1NSQyhjYXB0dXJlLmdldCgpKSwgYXBwc3JjX3NhbXBsZS5nZXQo
KSkgIT0gR1NUX0ZMT1dfT0spIHsKICAgICAgICAgdGhyb3cgc3RkOjpydW50aW1lX2Vycm9yKCJn
c3RyYW1lciBhcHBzcmMgZWxlbWVudCBjYW5ub3QgcHVzaCBzYW1wbGUiKTsKICAgICB9Ci0tIAoy
LjIxLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClNw
aWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9zcGljZS1kZXZl
bA==
