Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 0F6C68355D
	for <lists+spice-devel@lfdr.de>; Tue,  6 Aug 2019 17:35:02 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2B3C289D7B;
	Tue,  6 Aug 2019 15:35:00 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail-wm1-f52.google.com (mail-wm1-f52.google.com
 [209.85.128.52])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8B4BE89D5C
 for <spice-devel@lists.freedesktop.org>; Tue,  6 Aug 2019 15:34:58 +0000 (UTC)
Received: by mail-wm1-f52.google.com with SMTP id p74so78633320wme.4
 for <spice-devel@lists.freedesktop.org>; Tue, 06 Aug 2019 08:34:58 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=QxnWhjdoZI1wLifRPFNEibao499ifUGPPs8yAZ1KTlQ=;
 b=rKXiIRflGJa+jRexc5UMtsqmTrLFUZtSjU2BIG1IAzaftew7DDjYs/5rhVdCxV/Z9i
 U/KnggHVpPljnEyfvZpXQZswGe4TyDGdVIjQRHs++Y6oyIL9HUnAHs5i+jcpUVkMY4Au
 nyivEQJh5GqipxVvaeoLexyfC6KRNZLCZhqeXBJu8esEgTfspLAHXaPDHdhzW8IXsMao
 1eSXcctBji1lb/Lpcucc1EmDHi0TCMN2iRoALo+UyzTEy/9V62wuOBfxxE+EtfdnGB0H
 nfDn5thmHikkoqKzAfGrp88TMJ4UN6mgCj/Y3sz6/c+BhBJVzshGGRdBFde+y5BUi5Pi
 cRFw==
X-Gm-Message-State: APjAAAV4duYi9rVaaUtrYrX9cHsvUdiVy18Z/lsUN9Q+BXISz0JIbauA
 KBbpu8vHVqqMadR1j9IOVaqUIm6GJeXEFA==
X-Google-Smtp-Source: APXvYqw6DMN1hu3Z2LSiIPOdgPcHiJsvT1gVGNWhtIPihIUhzipvorxkBZ3P1kEg3xE+aEVguuHIBA==
X-Received: by 2002:a1c:cc0d:: with SMTP id h13mr5256473wmb.119.1565105696839; 
 Tue, 06 Aug 2019 08:34:56 -0700 (PDT)
Received: from pinea.redhat.com (25.119.19.109.rev.sfr.net. [109.19.119.25])
 by smtp.gmail.com with ESMTPSA id y18sm84860282wmi.23.2019.08.06.08.34.55
 for <spice-devel@lists.freedesktop.org>
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Tue, 06 Aug 2019 08:34:56 -0700 (PDT)
From: Kevin Pouget <kpouget@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Tue,  6 Aug 2019 17:34:45 +0200
Message-Id: <20190806153453.20616-2-kpouget@redhat.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190806153453.20616-1-kpouget@redhat.com>
References: <20190806153453.20616-1-kpouget@redhat.com>
MIME-Version: 1.0
Subject: [Spice-devel] [RFC spice-server 1/3] stream-channel: Add preferred
 video codec capability
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

VGhpcyBwYXRjaCBlbmFibGVzIHRoZSBTUElDRV9ESVNQTEFZX0NBUF9QUkVGX1ZJREVPX0NPREVD
X1RZUEUKY2FwYWJpbGl0eSBmb3IgdGhlIHN0cmVhbS1jaGFubmVsLgoKdmlkZW9fc3RyZWFtX3Bh
cnNlX3ByZWZlcnJlZF9jb2RlY3M6IG5ldyBmdW5jdGlvbiBmb3IgcGFyc2luZyB0aGUKU1BJQ0Ug
cHJvdG9jb2wgbWVzc2FnZS4gVGhpcyBjb2RlIHVzZWQgdG8gYmUgaW5zaWRlCmRjY19oYW5kbGVf
cHJlZmVycmVkX3ZpZGVvX2NvZGVjX3R5cGUuCgpzdHJ1Y3QgU3RyZWFtQ2hhbm5lbENsaWVudDo6
Y2xpZW50X3ByZWZlcnJlZF92aWRlb19jb2RlY3M6IG5ldyBmaWVsZC4KClNpZ25lZC1vZmYtYnk6
IEtldmluIFBvdWdldCA8a3BvdWdldEByZWRoYXQuY29tPgotLS0KIHNlcnZlci9kY2MuYyAgICAg
ICAgICAgIHwgMzAgKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiBzZXJ2ZXIvc3RyZWFt
LWNoYW5uZWwuYyB8IDQwICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysK
IHNlcnZlci92aWRlby1zdHJlYW0uYyAgIHwgMzYgKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrCiBzZXJ2ZXIvdmlkZW8tc3RyZWFtLmggICB8ICAxICsKIDQgZmlsZXMgY2hhbmdl
ZCwgNzggaW5zZXJ0aW9ucygrKSwgMjkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvc2VydmVy
L2RjYy5jIGIvc2VydmVyL2RjYy5jCmluZGV4IDIxZTg1OThlLi41MzhmMWY1MSAxMDA2NDQKLS0t
IGEvc2VydmVyL2RjYy5jCisrKyBiL3NlcnZlci9kY2MuYwpAQCAtMTE1OCwzOCArMTE1OCwxMCBA
QCBzdGF0aWMgdm9pZCBvbl9kaXNwbGF5X3ZpZGVvX2NvZGVjc191cGRhdGUoR09iamVjdCAqZ29i
amVjdCwgR1BhcmFtU3BlYyAqcHNwZWMsCiBzdGF0aWMgaW50IGRjY19oYW5kbGVfcHJlZmVycmVk
X3ZpZGVvX2NvZGVjX3R5cGUoRGlzcGxheUNoYW5uZWxDbGllbnQgKmRjYywKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZU1zZ2NEaXNwbGF5UHJl
ZmVycmVkVmlkZW9Db2RlY1R5cGUgKm1zZykKIHsKLSAgICBnaW50IGksIGxlbjsKLSAgICBnaW50
IGluZGV4ZXNbU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9FTlVNX0VORF07Ci0gICAgR0FycmF5ICpj
bGllbnQ7Ci0KICAgICBnX3JldHVybl92YWxfaWZfZmFpbChtc2ctPm51bV9vZl9jb2RlY3MgPiAw
LCBUUlVFKTsKCi0gICAgLyogc2V0IGRlZmF1bHQgdG8gYSBiaWcgYW5kIHBvc2l0aXZlIG51bWJl
ciAqLwotICAgIG1lbXNldChpbmRleGVzLCAweDdmLCBzaXplb2YoaW5kZXhlcykpOwotCi0gICAg
Zm9yIChsZW4gPSAwLCBpID0gMDsgaSA8IG1zZy0+bnVtX29mX2NvZGVjczsgaSsrKSB7Ci0gICAg
ICAgIGdpbnQgdmlkZW9fY29kZWMgPSBtc2ctPmNvZGVjc1tpXTsKLQotICAgICAgICBpZiAodmlk
ZW9fY29kZWMgPCBTUElDRV9WSURFT19DT0RFQ19UWVBFX01KUEVHIHx8Ci0gICAgICAgICAgICB2
aWRlb19jb2RlYyA+PSBTUElDRV9WSURFT19DT0RFQ19UWVBFX0VOVU1fRU5EKSB7Ci0gICAgICAg
ICAgICBzcGljZV9kZWJ1ZygiQ2xpZW50IGhhcyBzZW50IHVua25vd24gdmlkZW8tY29kZWMgKHZh
bHVlICVkIGF0IGluZGV4ICVkKS4gIgotICAgICAgICAgICAgICAgICAgICAgICAgIklnbm9yaW5n
IGFzIHNlcnZlciBjYW4ndCBoYW5kbGUgaXQiLAotICAgICAgICAgICAgICAgICAgICAgICAgIHZp
ZGVvX2NvZGVjLCBpKTsKLSAgICAgICAgICAgIGNvbnRpbnVlOwotICAgICAgICB9Ci0KLSAgICAg
ICAgaWYgKGluZGV4ZXNbdmlkZW9fY29kZWNdIDwgU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9FTlVN
X0VORCkgewotICAgICAgICAgICAgY29udGludWU7Ci0gICAgICAgIH0KLQotICAgICAgICBsZW4r
KzsKLSAgICAgICAgaW5kZXhlc1t2aWRlb19jb2RlY10gPSBsZW47Ci0gICAgfQotICAgIGNsaWVu
dCA9IGdfYXJyYXlfc2l6ZWRfbmV3KEZBTFNFLCBGQUxTRSwgc2l6ZW9mKGdpbnQpLCBTUElDRV9W
SURFT19DT0RFQ19UWVBFX0VOVU1fRU5EKTsKLSAgICBnX2FycmF5X2FwcGVuZF92YWxzKGNsaWVu
dCwgaW5kZXhlcywgU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9FTlVNX0VORCk7Ci0KICAgICBnX2Ns
ZWFyX3BvaW50ZXIoJmRjYy0+cHJpdi0+Y2xpZW50X3ByZWZlcnJlZF92aWRlb19jb2RlY3MsIGdf
YXJyYXlfdW5yZWYpOwotICAgIGRjYy0+cHJpdi0+Y2xpZW50X3ByZWZlcnJlZF92aWRlb19jb2Rl
Y3MgPSBjbGllbnQ7CisgICAgZGNjLT5wcml2LT5jbGllbnRfcHJlZmVycmVkX3ZpZGVvX2NvZGVj
cyA9IHZpZGVvX3N0cmVhbV9wYXJzZV9wcmVmZXJyZWRfY29kZWNzKG1zZyk7CgogICAgIC8qIE5l
dyBjbGllbnQgcHJlZmVyZW5jZSAqLwogICAgIGRjY191cGRhdGVfcHJlZmVycmVkX3ZpZGVvX2Nv
ZGVjcyhkY2MpOwpkaWZmIC0tZ2l0IGEvc2VydmVyL3N0cmVhbS1jaGFubmVsLmMgYi9zZXJ2ZXIv
c3RyZWFtLWNoYW5uZWwuYwppbmRleCA3OTUzMDE4ZS4uZmE0ODA0ZjEgMTAwNjQ0Ci0tLSBhL3Nl
cnZlci9zdHJlYW0tY2hhbm5lbC5jCisrKyBiL3NlcnZlci9zdHJlYW0tY2hhbm5lbC5jCkBAIC0y
Miw2ICsyMiw3IEBACiAjaW5jbHVkZSA8c3BpY2Uvc3RyZWFtLWRldmljZS5oPgoKICNpbmNsdWRl
ICJyZWQtY2hhbm5lbC1jbGllbnQuaCIKKyNpbmNsdWRlICJyZWQtY2xpZW50LmgiCiAjaW5jbHVk
ZSAic3RyZWFtLWNoYW5uZWwuaCIKICNpbmNsdWRlICJyZWRzLmgiCiAjaW5jbHVkZSAiY29tbW9u
LWdyYXBoaWNzLWNoYW5uZWwuaCIKQEAgLTUyLDYgKzUzLDkgQEAgc3RydWN0IFN0cmVhbUNoYW5u
ZWxDbGllbnQgewogICAgIC8qIGN1cnJlbnQgdmlkZW8gc3RyZWFtIGlkLCA8MCBpZiBub3QgaW5p
dGlhbGl6ZWQgb3IKICAgICAgKiB3ZSBhcmUgbm90IHNlbmRpbmcgYSBzdHJlYW0gKi8KICAgICBp
bnQgc3RyZWFtX2lkOworICAgIC8qIEFycmF5IHdpdGggU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9F
TlVNX0VORCBlbGVtZW50cywgd2l0aCB0aGUgY2xpZW50CisgICAgICogcHJlZmVyZW5jZSBvcmRl
ciAoaW5kZXgpIGFzIHZhbHVlICovCisgICAgR0FycmF5ICpjbGllbnRfcHJlZmVycmVkX3ZpZGVv
X2NvZGVjczsKIH07Cgogc3RydWN0IFN0cmVhbUNoYW5uZWxDbGllbnRDbGFzcyB7CkBAIC0xMTQs
NiArMTE4LDggQEAgdHlwZWRlZiBzdHJ1Y3QgU3RyZWFtRGF0YUl0ZW0gewogI2RlZmluZSBQUklN
QVJZX1NVUkZBQ0VfSUQgMAoKIHN0YXRpYyB2b2lkIHN0cmVhbV9jaGFubmVsX2NsaWVudF9vbl9k
aXNjb25uZWN0KFJlZENoYW5uZWxDbGllbnQgKnJjYyk7CitzdGF0aWMgYm9vbCBzdHJlYW1fY2hh
bm5lbF9oYW5kbGVfcHJlZmVycmVkX3ZpZGVvX2NvZGVjX3R5cGUoUmVkQ2hhbm5lbENsaWVudCAq
cmNjLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgU3BpY2VNc2djRGlzcGxheVByZWZlcnJlZFZpZGVvQ29kZWNUeXBlICptc2cpOwoKIFJFQ09S
REVSKHN0cmVhbV9jaGFubmVsX2RhdGEsIDMyLCAiU3RyZWFtIGNoYW5uZWwgZGF0YSBwYWNrZXQi
KTsKCkBAIC0zMjQsNiArMzMwLDEwIEBAIGhhbmRsZV9tZXNzYWdlKFJlZENoYW5uZWxDbGllbnQg
KnJjYywgdWludDE2X3QgdHlwZSwgdWludDMyX3Qgc2l6ZSwgdm9pZCAqbXNnKQogICAgIGNhc2Ug
U1BJQ0VfTVNHQ19ESVNQTEFZX0dMX0RSQVdfRE9ORToKICAgICAgICAgLyogY2xpZW50IHNob3Vs
ZCBub3Qgc2VuZCB0aGlzIG1lc3NhZ2UgKi8KICAgICAgICAgcmV0dXJuIGZhbHNlOworICAgIGNh
c2UgU1BJQ0VfTVNHQ19ESVNQTEFZX1BSRUZFUlJFRF9WSURFT19DT0RFQ19UWVBFOgorICAgICAg
ICByZXR1cm4gc3RyZWFtX2NoYW5uZWxfaGFuZGxlX3ByZWZlcnJlZF92aWRlb19jb2RlY190eXBl
KHJjYywKKyAgICAgICAgICAgIChTcGljZU1zZ2NEaXNwbGF5UHJlZmVycmVkVmlkZW9Db2RlY1R5
cGUgKiltc2cpOworICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgZGVmYXVsdDoKICAgICAgICAg
cmV0dXJuIHJlZF9jaGFubmVsX2NsaWVudF9oYW5kbGVfbWVzc2FnZShyY2MsIHR5cGUsIHNpemUs
IG1zZyk7CiAgICAgfQpAQCAtMzkwLDYgKzQwMCwyMCBAQCBzdHJlYW1fY2hhbm5lbF9nZXRfc3Vw
cG9ydGVkX2NvZGVjcyhTdHJlYW1DaGFubmVsICpjaGFubmVsLCB1aW50OF90ICpvdXRfY29kZWNz
KQogICAgIHJldHVybiBudW07CiB9Cgorc3RhdGljIGJvb2wKK3N0cmVhbV9jaGFubmVsX2hhbmRs
ZV9wcmVmZXJyZWRfdmlkZW9fY29kZWNfdHlwZShSZWRDaGFubmVsQ2xpZW50ICpyY2MsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3BpY2VNc2djRGlz
cGxheVByZWZlcnJlZFZpZGVvQ29kZWNUeXBlICptc2cpCit7CisgICAgU3RyZWFtQ2hhbm5lbENs
aWVudCAqc2NjID0gU1RSRUFNX0NIQU5ORUxfQ0xJRU5UKHJjYyk7CisKKyAgICBnX3JldHVybl92
YWxfaWZfZmFpbChtc2ctPm51bV9vZl9jb2RlY3MgPiAwLCBUUlVFKTsKKworICAgIGdfY2xlYXJf
cG9pbnRlcigmc2NjLT5jbGllbnRfcHJlZmVycmVkX3ZpZGVvX2NvZGVjcywgZ19hcnJheV91bnJl
Zik7CisgICAgc2NjLT5jbGllbnRfcHJlZmVycmVkX3ZpZGVvX2NvZGVjcyA9IHZpZGVvX3N0cmVh
bV9wYXJzZV9wcmVmZXJyZWRfY29kZWNzKG1zZyk7CisKKyAgICByZXR1cm4gVFJVRTsKK30KKwog
c3RhdGljIHZvaWQKIHN0cmVhbV9jaGFubmVsX2Nvbm5lY3QoUmVkQ2hhbm5lbCAqcmVkX2NoYW5u
ZWwsIFJlZENsaWVudCAqcmVkX2NsaWVudCwgUmVkU3RyZWFtICpzdHJlYW0sCiAgICAgICAgICAg
ICAgICAgICAgICAgIGludCBtaWdyYXRpb24sIFJlZENoYW5uZWxDYXBhYmlsaXRpZXMgKmNhcHMp
CkBAIC00NDgsMTAgKzQ3MiwyNSBAQCBzdHJlYW1fY2hhbm5lbF9jb25zdHJ1Y3RlZChHT2JqZWN0
ICpvYmplY3QpCgogICAgIHJlZF9jaGFubmVsX3NldF9jYXAocmVkX2NoYW5uZWwsIFNQSUNFX0RJ
U1BMQVlfQ0FQX01PTklUT1JTX0NPTkZJRyk7CiAgICAgcmVkX2NoYW5uZWxfc2V0X2NhcChyZWRf
Y2hhbm5lbCwgU1BJQ0VfRElTUExBWV9DQVBfU1RSRUFNX1JFUE9SVCk7CisgICAgcmVkX2NoYW5u
ZWxfc2V0X2NhcChyZWRfY2hhbm5lbCwgU1BJQ0VfRElTUExBWV9DQVBfUFJFRl9WSURFT19DT0RF
Q19UWVBFKTsKCiAgICAgcmVkc19yZWdpc3Rlcl9jaGFubmVsKHJlZHMsIHJlZF9jaGFubmVsKTsK
IH0KCitzdGF0aWMgdm9pZAorc3RyZWFtX2NoYW5uZWxfZmluYWxpemUoR09iamVjdCAqb2JqZWN0
KQoreworICAgIFN0cmVhbUNoYW5uZWwgKnNlbGYgPSBTVFJFQU1fQ0hBTk5FTChvYmplY3QpOwor
ICAgIFJlZENoYW5uZWxDbGllbnQgKnJjYzsKKworICAgIEZPUkVBQ0hfQ0xJRU5UKHNlbGYsIHJj
YykgeworICAgICAgICBTdHJlYW1DaGFubmVsQ2xpZW50ICpzY2MgPSBTVFJFQU1fQ0hBTk5FTF9D
TElFTlQocmNjKTsKKyAgICAgICAgZ19jbGVhcl9wb2ludGVyKCZzY2MtPmNsaWVudF9wcmVmZXJy
ZWRfdmlkZW9fY29kZWNzLCBnX2FycmF5X3VucmVmKTsKKyAgICB9CisKKyAgICBHX09CSkVDVF9D
TEFTUyhzdHJlYW1fY2hhbm5lbF9wYXJlbnRfY2xhc3MpLT5maW5hbGl6ZShvYmplY3QpOworfQor
CiBzdGF0aWMgdm9pZAogc3RyZWFtX2NoYW5uZWxfY2xhc3NfaW5pdChTdHJlYW1DaGFubmVsQ2xh
c3MgKmtsYXNzKQogewpAQCAtNDU5LDYgKzQ5OCw3IEBAIHN0cmVhbV9jaGFubmVsX2NsYXNzX2lu
aXQoU3RyZWFtQ2hhbm5lbENsYXNzICprbGFzcykKICAgICBSZWRDaGFubmVsQ2xhc3MgKmNoYW5u
ZWxfY2xhc3MgPSBSRURfQ0hBTk5FTF9DTEFTUyhrbGFzcyk7CgogICAgIG9iamVjdF9jbGFzcy0+
Y29uc3RydWN0ZWQgPSBzdHJlYW1fY2hhbm5lbF9jb25zdHJ1Y3RlZDsKKyAgICBvYmplY3RfY2xh
c3MtPmZpbmFsaXplID0gc3RyZWFtX2NoYW5uZWxfZmluYWxpemU7CgogICAgIGNoYW5uZWxfY2xh
c3MtPnBhcnNlciA9IHNwaWNlX2dldF9jbGllbnRfY2hhbm5lbF9wYXJzZXIoU1BJQ0VfQ0hBTk5F
TF9ESVNQTEFZLCBOVUxMKTsKICAgICBjaGFubmVsX2NsYXNzLT5oYW5kbGVfbWVzc2FnZSA9IGhh
bmRsZV9tZXNzYWdlOwpkaWZmIC0tZ2l0IGEvc2VydmVyL3ZpZGVvLXN0cmVhbS5jIGIvc2VydmVy
L3ZpZGVvLXN0cmVhbS5jCmluZGV4IDZhYTg1OWEwLi5hNjFjOGFiMiAxMDA2NDQKLS0tIGEvc2Vy
dmVyL3ZpZGVvLXN0cmVhbS5jCisrKyBiL3NlcnZlci92aWRlby1zdHJlYW0uYwpAQCAtMjAsNiAr
MjAsNyBAQAogI2luY2x1ZGUgImRpc3BsYXktY2hhbm5lbC1wcml2YXRlLmgiCiAjaW5jbHVkZSAi
bWFpbi1jaGFubmVsLWNsaWVudC5oIgogI2luY2x1ZGUgInJlZC1jbGllbnQuaCIKKyNpbmNsdWRl
ICJzdHJlYW0tY2hhbm5lbC5oIgoKICNkZWZpbmUgRlBTX1RFU1RfSU5URVJWQUwgMQogI2RlZmlu
ZSBGT1JFQUNIX1NUUkVBTVMoZGlzcGxheSwgaXRlbSkgICAgICAgICAgICAgICAgICBcCkBAIC00
NjgsNiArNDY5LDQxIEBAIHN0YXRpYyBib29sIHZpZGVvX3N0cmVhbV9hZGRfZnJhbWUoRGlzcGxh
eUNoYW5uZWwgKmRpc3BsYXksCiAgICAgcmV0dXJuIEZBTFNFOwogfQoKKy8qIFJldHVybnMgYW4g
YXJyYXkgd2l0aCBTUElDRV9WSURFT19DT0RFQ19UWVBFX0VOVU1fRU5EIGVsZW1lbnRzLAorICog
d2l0aCB0aGUgY2xpZW50IHByZWZlcmVuY2Ugb3JkZXIgKGluZGV4KSBhcyB2YWx1ZSAqLworR0Fy
cmF5ICp2aWRlb19zdHJlYW1fcGFyc2VfcHJlZmVycmVkX2NvZGVjcyhTcGljZU1zZ2NEaXNwbGF5
UHJlZmVycmVkVmlkZW9Db2RlY1R5cGUgKm1zZykKK3sKKyAgICBnaW50IGksIGxlbjsKKyAgICBn
aW50IGluZGV4ZXNbU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9FTlVNX0VORF07CisgICAgR0FycmF5
ICpjbGllbnQ7CisKKyAgICAvKiBzZXQgZGVmYXVsdCB0byBhIGJpZyBhbmQgcG9zaXRpdmUgbnVt
YmVyICovCisgICAgbWVtc2V0KGluZGV4ZXMsIDB4N2YsIHNpemVvZihpbmRleGVzKSk7CisKKyAg
ICBmb3IgKGxlbiA9IDAsIGkgPSAwOyBpIDwgbXNnLT5udW1fb2ZfY29kZWNzOyBpKyspIHsKKyAg
ICAgICAgZ2ludCB2aWRlb19jb2RlYyA9IG1zZy0+Y29kZWNzW2ldOworCisgICAgICAgIGlmICh2
aWRlb19jb2RlYyA8IFNQSUNFX1ZJREVPX0NPREVDX1RZUEVfTUpQRUcgfHwKKyAgICAgICAgICAg
IHZpZGVvX2NvZGVjID49IFNQSUNFX1ZJREVPX0NPREVDX1RZUEVfRU5VTV9FTkQpIHsKKyAgICAg
ICAgICAgIHNwaWNlX2RlYnVnKCJDbGllbnQgaGFzIHNlbnQgdW5rbm93biB2aWRlby1jb2RlYyAo
dmFsdWUgJWQgYXQgaW5kZXggJWQpLiAiCisgICAgICAgICAgICAgICAgICAgICAgICAiSWdub3Jp
bmcgYXMgc2VydmVyIGNhbid0IGhhbmRsZSBpdCIsCisgICAgICAgICAgICAgICAgICAgICAgICAg
dmlkZW9fY29kZWMsIGkpOworICAgICAgICAgICAgY29udGludWU7CisgICAgICAgIH0KKworICAg
ICAgICBpZiAoaW5kZXhlc1t2aWRlb19jb2RlY10gPCBTUElDRV9WSURFT19DT0RFQ19UWVBFX0VO
VU1fRU5EKSB7CisgICAgICAgICAgICBjb250aW51ZTsKKyAgICAgICAgfQorCisgICAgICAgIGxl
bisrOworICAgICAgICBpbmRleGVzW3ZpZGVvX2NvZGVjXSA9IGxlbjsKKyAgICB9CisgICAgY2xp
ZW50ID0gZ19hcnJheV9zaXplZF9uZXcoRkFMU0UsIEZBTFNFLCBzaXplb2YoZ2ludCksIFNQSUNF
X1ZJREVPX0NPREVDX1RZUEVfRU5VTV9FTkQpOworICAgIGdfYXJyYXlfYXBwZW5kX3ZhbHMoY2xp
ZW50LCBpbmRleGVzLCBTUElDRV9WSURFT19DT0RFQ19UWVBFX0VOVU1fRU5EKTsKKworICAgIHJl
dHVybiBjbGllbnQ7Cit9CisKIC8qIFRPRE86IGRvY3VtZW50IHRoZSBkaWZmZXJlbmNlIGJldHdl
ZW4gdGhlIDIgZnVuY3Rpb25zIGJlbG93ICovCiB2b2lkIHZpZGVvX3N0cmVhbV90cmFjZV91cGRh
dGUoRGlzcGxheUNoYW5uZWwgKmRpc3BsYXksIERyYXdhYmxlICpkcmF3YWJsZSkKIHsKZGlmZiAt
LWdpdCBhL3NlcnZlci92aWRlby1zdHJlYW0uaCBiL3NlcnZlci92aWRlby1zdHJlYW0uaAppbmRl
eCA0NmIwNzZmZC4uNzM0MzU1MTUgMTAwNjQ0Ci0tLSBhL3NlcnZlci92aWRlby1zdHJlYW0uaAor
KysgYi9zZXJ2ZXIvdmlkZW8tc3RyZWFtLmgKQEAgLTE0Nyw2ICsxNDcsNyBAQCB2b2lkIHZpZGVv
X3N0cmVhbV9kZXRhY2hfYW5kX3N0b3AoRGlzcGxheUNoYW5uZWwgKmRpc3BsYXkpOwogdm9pZCB2
aWRlb19zdHJlYW1fdHJhY2VfYWRkX2RyYXdhYmxlKERpc3BsYXlDaGFubmVsICpkaXNwbGF5LCBE
cmF3YWJsZSAqaXRlbSk7CiB2b2lkIHZpZGVvX3N0cmVhbV9kZXRhY2hfYmVoaW5kKERpc3BsYXlD
aGFubmVsICpkaXNwbGF5LCBRUmVnaW9uICpyZWdpb24sCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIERyYXdhYmxlICpkcmF3YWJsZSk7CitHQXJyYXkgKnZpZGVvX3N0cmVhbV9wYXJz
ZV9wcmVmZXJyZWRfY29kZWNzKFNwaWNlTXNnY0Rpc3BsYXlQcmVmZXJyZWRWaWRlb0NvZGVjVHlw
ZSAqbXNnKTsKCiB2b2lkIHZpZGVvX3N0cmVhbV9hZ2VudF91bnJlZihEaXNwbGF5Q2hhbm5lbCAq
ZGlzcGxheSwgVmlkZW9TdHJlYW1BZ2VudCAqYWdlbnQpOwogdm9pZCB2aWRlb19zdHJlYW1fYWdl
bnRfc3RvcChWaWRlb1N0cmVhbUFnZW50ICphZ2VudCk7Ci0tCjIuMjEuMApfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpTcGljZS1kZXZlbCBtYWlsaW5nIGxp
c3QKU3BpY2UtZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRl
c2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vc3BpY2UtZGV2ZWw=
