Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id F06EF49A6B
	for <lists+spice-devel@lfdr.de>; Tue, 18 Jun 2019 09:23:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 09C396E103;
	Tue, 18 Jun 2019 07:23:22 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6B0A26E103
 for <spice-devel@lists.freedesktop.org>; Tue, 18 Jun 2019 07:23:21 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx04.intmail.prod.int.phx2.redhat.com
 [10.5.11.14])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 044EE30C1AD7;
 Tue, 18 Jun 2019 07:23:21 +0000 (UTC)
Received: from colo-mx.corp.redhat.com
 (colo-mx02.intmail.prod.int.phx2.redhat.com [10.5.11.21])
 by smtp.corp.redhat.com (Postfix) with ESMTPS id EE0BD36FA;
 Tue, 18 Jun 2019 07:23:19 +0000 (UTC)
Received: from zmail25.collab.prod.int.phx2.redhat.com
 (zmail25.collab.prod.int.phx2.redhat.com [10.5.83.31])
 by colo-mx.corp.redhat.com (Postfix) with ESMTP id E0384206D1;
 Tue, 18 Jun 2019 07:23:18 +0000 (UTC)
Date: Tue, 18 Jun 2019 03:23:17 -0400 (EDT)
From: Frediano Ziglio <fziglio@redhat.com>
To: Francois Gouget <fgouget@codeweavers.com>
Message-ID: <2113883838.23348931.1560842597463.JavaMail.zimbra@redhat.com>
In-Reply-To: <6e53d1bc6954ec61a690632fe517e9693af1f79b.1560790607.git.fgouget@free.fr>
References: <cover.1560790607.git.fgouget@free.fr>
 <6e53d1bc6954ec61a690632fe517e9693af1f79b.1560790607.git.fgouget@free.fr>
MIME-Version: 1.0
X-Originating-IP: [10.40.204.128, 10.4.195.21]
Thread-Topic: channel-display: The video latency is in fact a margin
Thread-Index: b6FgibZSXVY7HRzUfKkycP6pgW+kpw==
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.14
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.40]); Tue, 18 Jun 2019 07:23:21 +0000 (UTC)
Subject: Re: [Spice-devel] [client v2 05/12] channel-display: The video
 latency is in fact a margin
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Spice devel <spice-devel@lists.freedesktop.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

PiAKPiAnTGF0ZW5jeScgaXMgY29uZnVzaW5nIGJlY2F1c2UgaXQgZXZva2VzIGVpdGhlciB0aGUg
bmV0d29yayBsYXRlbmN5Cj4gb3IgdGhlIGF1ZGlvIGxhdGVuY3ksIG5laXRoZXIgb2Ygd2hpY2gg
bWF0Y2ggd2hhdCB0aGUgbGF0ZW5jeQo+IHZhcmlhYmxlcyBjb250YWluLiBJbnN0ZWFkIHRoZXkg
cmVjb3JkIGhvdyBtdWNoIG1hcmdpbiB0aGVyZSB3YXMKPiBiZXR3ZWVuIHdoZW4gdGhlIGZyYW1l
IHdhcyByZWNlaXZlZCwgYW5kIHdoZW4gaXQgaXMgc3VwcG9zZWQgdG8gYmUKPiBkaXNwbGF5ZWQu
IEhlbmNlIHRoZSBuZXcgbmFtZS4KPiAKPiBTaWduZWQtb2ZmLWJ5OiBGcmFuY29pcyBHb3VnZXQg
PGZnb3VnZXRAY29kZXdlYXZlcnMuY29tPgoKQWNrZWQKCj4gLS0tCj4gCj4gSXQncyBsZXNzIGNv
bmZ1c2luZyB3aGVuIHVzaW5nIHRoZSByaWdodCB0ZXJtaW5vbG9neSBzbyBJJ20gc3RhcnRpbmcK
PiB3aXRoIHRoaXMgYmVmb3JlIHRoZSBtb3JlIGludm9sdmVkIHBhdGNoZXMuCj4gCj4gIHNyYy9j
aGFubmVsLWRpc3BsYXktZ3N0LmMgICB8ICA2ICsrKy0tLQo+ICBzcmMvY2hhbm5lbC1kaXNwbGF5
LW1qcGVnLmMgfCAgNCArKy0tCj4gIHNyYy9jaGFubmVsLWRpc3BsYXkuYyAgICAgICB8IDI2ICsr
KysrKysrKysrKystLS0tLS0tLS0tLS0tCj4gIDMgZmlsZXMgY2hhbmdlZCwgMTggaW5zZXJ0aW9u
cygrKSwgMTggZGVsZXRpb25zKC0pCj4gCj4gZGlmZiAtLWdpdCBhL3NyYy9jaGFubmVsLWRpc3Bs
YXktZ3N0LmMgYi9zcmMvY2hhbm5lbC1kaXNwbGF5LWdzdC5jCj4gaW5kZXggNDQ5YjljYjguLjZm
Y2NmNjIxIDEwMDY0NAo+IC0tLSBhL3NyYy9jaGFubmVsLWRpc3BsYXktZ3N0LmMKPiArKysgYi9z
cmMvY2hhbm5lbC1kaXNwbGF5LWdzdC5jCj4gQEAgLTY3OSw3ICs2NzksNyBAQCBzdGF0aWMgdm9p
ZCBzcGljZV9nc3RfZGVjb2Rlcl9kZXN0cm95KFZpZGVvRGVjb2Rlcgo+ICp2aWRlb19kZWNvZGVy
KQo+ICAgKiAgICAgIHNwaWNlX2ZyYW1lX2ZyZWUoKSBhbmQgZnJlZSBpdHMgZW5jb2RlZF9mcmFt
ZS4KPiAgICovCj4gIHN0YXRpYyBnYm9vbGVhbiBzcGljZV9nc3RfZGVjb2Rlcl9xdWV1ZV9mcmFt
ZShWaWRlb0RlY29kZXIgKnZpZGVvX2RlY29kZXIsCj4gLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBTcGljZUZyYW1lICpmcmFtZSwgaW50Cj4gbGF0ZW5jeSkK
PiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNlRnJh
bWUgKmZyYW1lLCBpbnQgbWFyZ2luKQo+ICB7Cj4gICAgICBTcGljZUdzdERlY29kZXIgKmRlY29k
ZXIgPSAoU3BpY2VHc3REZWNvZGVyKil2aWRlb19kZWNvZGVyOwo+ICAKPiBAQCAtNjk3LDcgKzY5
Nyw3IEBAIHN0YXRpYyBnYm9vbGVhbgo+IHNwaWNlX2dzdF9kZWNvZGVyX3F1ZXVlX2ZyYW1lKFZp
ZGVvRGVjb2RlciAqdmlkZW9fZGVjb2RlciwKPiAgICAgIH0KPiAgICAgIGRlY29kZXItPmxhc3Rf
bW1fdGltZSA9IGZyYW1lLT5tbV90aW1lOwo+ICAKPiAtICAgIGlmIChsYXRlbmN5IDwgMCAmJgo+
ICsgICAgaWYgKG1hcmdpbiA8IDAgJiYKPiAgICAgICAgICBkZWNvZGVyLT5iYXNlLmNvZGVjX3R5
cGUgPT0gU1BJQ0VfVklERU9fQ09ERUNfVFlQRV9NSlBFRykgewo+ICAgICAgICAgIC8qIERyb3Bw
aW5nIE1KUEVHIGZyYW1lcyBoYXMgbm8gaW1wYWN0IG9uIHRob3NlIHRoYXQgZm9sbG93IGFuZAo+
ICAgICAgICAgICAqIHNhdmVzIENQVSBzbyBkbyBpdC4KPiBAQCAtNzI2LDcgKzcyNiw3IEBAIHN0
YXRpYyBnYm9vbGVhbgo+IHNwaWNlX2dzdF9kZWNvZGVyX3F1ZXVlX2ZyYW1lKFZpZGVvRGVjb2Rl
ciAqdmlkZW9fZGVjb2RlciwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGZyYW1lLT5kYXRhLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWUtPnNpemUsIDAsCj4gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFtZS0+c2l6ZSwKPiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1l
LCAoR0Rlc3Ryb3lOb3RpZnkpCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBzcGljZV9mcmFtZV9mcmVlKTsKPiAgCj4gLSAgICBHc3RDbG9ja1Rp
bWUgcHRzID0gZ3N0X2Nsb2NrX2dldF90aW1lKGRlY29kZXItPmNsb2NrKSAtCj4gZ3N0X2VsZW1l
bnRfZ2V0X2Jhc2VfdGltZShkZWNvZGVyLT5waXBlbGluZSkgKyAoKHVpbnQ2NF90KU1BWCgwLCBs
YXRlbmN5KSkgKgo+IDEwMDAgKiAxMDAwOwo+ICsgICAgR3N0Q2xvY2tUaW1lIHB0cyA9IGdzdF9j
bG9ja19nZXRfdGltZShkZWNvZGVyLT5jbG9jaykgLQo+IGdzdF9lbGVtZW50X2dldF9iYXNlX3Rp
bWUoZGVjb2Rlci0+cGlwZWxpbmUpICsgKCh1aW50NjRfdClNQVgoMCwgbWFyZ2luKSkgKgo+IDEw
MDAgKiAxMDAwOwo+ICAgICAgR1NUX0JVRkZFUl9EVVJBVElPTihidWZmZXIpID0gR1NUX0NMT0NL
X1RJTUVfTk9ORTsKPiAgICAgIEdTVF9CVUZGRVJfRFRTKGJ1ZmZlcikgPSBHU1RfQ0xPQ0tfVElN
RV9OT05FOwo+ICAgICAgR1NUX0JVRkZFUl9QVFMoYnVmZmVyKSA9IHB0czsKPiBkaWZmIC0tZ2l0
IGEvc3JjL2NoYW5uZWwtZGlzcGxheS1tanBlZy5jIGIvc3JjL2NoYW5uZWwtZGlzcGxheS1tanBl
Zy5jCj4gaW5kZXggYmE3ZjI2NmUuLjY0N2QzMWIwIDEwMDY0NAo+IC0tLSBhL3NyYy9jaGFubmVs
LWRpc3BsYXktbWpwZWcuYwo+ICsrKyBiL3NyYy9jaGFubmVsLWRpc3BsYXktbWpwZWcuYwo+IEBA
IC0yMTksNyArMjE5LDcgQEAgc3RhdGljIHZvaWQgbWpwZWdfZGVjb2Rlcl9kcm9wX3F1ZXVlKE1K
cGVnRGVjb2Rlcgo+ICpkZWNvZGVyKQo+ICAvKiAtLS0tLS0tLS0tIFZpZGVvRGVjb2RlcidzIHB1
YmxpYyBBUEkgLS0tLS0tLS0tLSAqLwo+ICAKPiAgc3RhdGljIGdib29sZWFuIG1qcGVnX2RlY29k
ZXJfcXVldWVfZnJhbWUoVmlkZW9EZWNvZGVyICp2aWRlb19kZWNvZGVyLAo+IC0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZUZyYW1lICpmcmFtZSwgaW50MzJf
dAo+IGxhdGVuY3kpCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFNwaWNlRnJhbWUgKmZyYW1lLCBpbnQzMl90IG1hcmdpbikKPiAgewo+ICAgICAgTUpwZWdEZWNv
ZGVyICpkZWNvZGVyID0gKE1KcGVnRGVjb2RlciopdmlkZW9fZGVjb2RlcjsKPiAgICAgIFNwaWNl
RnJhbWUgKmxhc3RfZnJhbWU7Cj4gQEAgLTIzOSw3ICsyMzksNyBAQCBzdGF0aWMgZ2Jvb2xlYW4g
bWpwZWdfZGVjb2Rlcl9xdWV1ZV9mcmFtZShWaWRlb0RlY29kZXIKPiAqdmlkZW9fZGVjb2RlciwK
PiAgICAgIC8qIERyb3BwZWQgTUpQRUcgZnJhbWVzIGRvbid0IGltcGFjdCB0aGUgb25lcyB0aGF0
IGNvbWUgYWZ0ZXIuCj4gICAgICAgKiBTbyBkcm9wIGxhdGUgZnJhbWVzIGFzIGVhcmx5IGFzIHBv
c3NpYmxlIHRvIHNhdmUgb24gcHJvY2Vzc2luZyB0aW1lLgo+ICAgICAgICovCj4gLSAgICBpZiAo
bGF0ZW5jeSA8IDApIHsKPiArICAgIGlmIChtYXJnaW4gPCAwKSB7Cj4gICAgICAgICAgU1BJQ0Vf
REVCVUcoImRyb3BwaW5nIGEgbGF0ZSBNSlBFRyBmcmFtZSIpOwo+ICAgICAgICAgIHNwaWNlX2Zy
YW1lX2ZyZWUoZnJhbWUpOwo+ICAgICAgICAgIHJldHVybiBUUlVFOwo+IGRpZmYgLS1naXQgYS9z
cmMvY2hhbm5lbC1kaXNwbGF5LmMgYi9zcmMvY2hhbm5lbC1kaXNwbGF5LmMKPiBpbmRleCA2YzJh
OTljNy4uY2RhMGZjZGQgMTAwNjQ0Cj4gLS0tIGEvc3JjL2NoYW5uZWwtZGlzcGxheS5jCj4gKysr
IGIvc3JjL2NoYW5uZWwtZGlzcGxheS5jCj4gQEAgLTE0MzIsNyArMTQzMiw3IEBAIGdib29sZWFu
IGhhbmRfcGlwZWxpbmVfdG9fd2lkZ2V0KGRpc3BsYXlfc3RyZWFtICpzdCwKPiBHc3RQaXBlbGlu
ZSAqcGlwZWxpbmUpCj4gICNkZWZpbmUgU1RSRUFNX1JFUE9SVF9EUk9QX1NFUV9MRU5fTElNSVQg
Mwo+ICAKPiAgc3RhdGljIHZvaWQgZGlzcGxheV91cGRhdGVfc3RyZWFtX3JlcG9ydChTcGljZURp
c3BsYXlDaGFubmVsICpjaGFubmVsLAo+ICB1aW50MzJfdCBzdHJlYW1faWQsCj4gLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgZnJhbWVfdGltZSwgaW50
MzJfdAo+IGxhdGVuY3kpCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgdWludDMyX3QgZnJhbWVfdGltZSwgaW50MzJfdAo+IG1hcmdpbikKPiAgewo+ICAgICAgZGlz
cGxheV9zdHJlYW0gKnN0ID0gZ2V0X3N0cmVhbV9ieV9pZChTUElDRV9DSEFOTkVMKGNoYW5uZWwp
LAo+ICAgICAgc3RyZWFtX2lkKTsKPiAgICAgIGd1aW50NjQgbm93Owo+IEBAIC0xNDQ5LDcgKzE0
NDksNyBAQCBzdGF0aWMgdm9pZAo+IGRpc3BsYXlfdXBkYXRlX3N0cmVhbV9yZXBvcnQoU3BpY2VE
aXNwbGF5Q2hhbm5lbCAqY2hhbm5lbCwgdWludDMyX3QKPiAgICAgIH0KPiAgICAgIHN0LT5yZXBv
cnRfbnVtX2ZyYW1lcysrOwo+ICAKPiAtICAgIGlmIChsYXRlbmN5IDwgMCkgeyAvLyBkcm9wCj4g
KyAgICBpZiAobWFyZ2luIDwgMCkgeyAvLyBkcm9wCj4gICAgICAgICAgc3QtPnJlcG9ydF9udW1f
ZHJvcHMrKzsKPiAgICAgICAgICBzdC0+cmVwb3J0X2Ryb3BzX3NlcV9sZW4rKzsKPiAgICAgIH0g
ZWxzZSB7Cj4gQEAgLTE0NjksNyArMTQ2OSw3IEBAIHN0YXRpYyB2b2lkCj4gZGlzcGxheV91cGRh
dGVfc3RyZWFtX3JlcG9ydChTcGljZURpc3BsYXlDaGFubmVsICpjaGFubmVsLCB1aW50MzJfdAo+
ICAgICAgICAgIHJlcG9ydC5lbmRfZnJhbWVfbW1fdGltZSA9IGZyYW1lX3RpbWU7Cj4gICAgICAg
ICAgcmVwb3J0Lm51bV9mcmFtZXMgPSBzdC0+cmVwb3J0X251bV9mcmFtZXM7Cj4gICAgICAgICAg
cmVwb3J0Lm51bV9kcm9wcyA9IHN0LT4gcmVwb3J0X251bV9kcm9wczsKPiAtICAgICAgICByZXBv
cnQubGFzdF9mcmFtZV9kZWxheSA9IGxhdGVuY3k7Cj4gKyAgICAgICAgcmVwb3J0Lmxhc3RfZnJh
bWVfZGVsYXkgPSBtYXJnaW47Cj4gICAgICAgICAgaWYgKHNwaWNlX3Nlc3Npb25faXNfcGxheWJh
Y2tfYWN0aXZlKHNlc3Npb24pKSB7Cj4gICAgICAgICAgICAgIHJlcG9ydC5hdWRpb19kZWxheSA9
Cj4gICAgICAgICAgICAgIHNwaWNlX3Nlc3Npb25fZ2V0X3BsYXliYWNrX2xhdGVuY3koc2Vzc2lv
bik7Cj4gICAgICAgICAgfSBlbHNlIHsKPiBAQCAtMTYwNiwxNCArMTYwNiwxNCBAQCBzdGF0aWMg
dm9pZCBkaXNwbGF5X3N0cmVhbV9zdGF0c19zYXZlKGRpc3BsYXlfc3RyZWFtCj4gKnN0LAo+ICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGd1aW50MzIgc2VydmVyX21tdGlt
ZSwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBndWludDMyIGNsaWVu
dF9tbXRpbWUpCj4gIHsKPiAtICAgIGdpbnQzMiBsYXRlbmN5ID0gc2VydmVyX21tdGltZSAtIGNs
aWVudF9tbXRpbWU7Cj4gKyAgICBnaW50MzIgbWFyZ2luID0gc2VydmVyX21tdGltZSAtIGNsaWVu
dF9tbXRpbWU7Cj4gIAo+ICAgICAgaWYgKCFzdC0+bnVtX2lucHV0X2ZyYW1lcykgewo+ICAgICAg
ICAgIHN0LT5maXJzdF9mcmFtZV9tbV90aW1lID0gc2VydmVyX21tdGltZTsKPiAgICAgIH0KPiAg
ICAgIHN0LT5udW1faW5wdXRfZnJhbWVzKys7Cj4gIAo+IC0gICAgaWYgKGxhdGVuY3kgPCAwKSB7
Cj4gKyAgICBpZiAobWFyZ2luIDwgMCkgewo+ICAgICAgICAgIENIQU5ORUxfREVCVUcoc3QtPmNo
YW5uZWwsICJzdHJlYW0gZGF0YSB0b28gbGF0ZSBieSAldSBtcyAodHM6ICV1LAo+ICAgICAgICAg
IG1tdGltZTogJXUpIiwKPiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudF9tbXRpbWUgLSBz
ZXJ2ZXJfbW10aW1lLCBzZXJ2ZXJfbW10aW1lLAo+ICAgICAgICAgICAgICAgICAgICAgICAgY2xp
ZW50X21tdGltZSk7Cj4gICAgICAgICAgc3QtPmFycml2ZV9sYXRlX3RpbWUgKz0gY2xpZW50X21t
dGltZSAtIHNlcnZlcl9tbXRpbWU7Cj4gQEAgLTE2MzAsNyArMTYzMCw3IEBAIHN0YXRpYyB2b2lk
IGRpc3BsYXlfc3RyZWFtX3N0YXRzX3NhdmUoZGlzcGxheV9zdHJlYW0KPiAqc3QsCj4gICAgICAg
ICAgcmV0dXJuOwo+ICAgICAgfQo+ICAKPiAtICAgIENIQU5ORUxfREVCVUcoc3QtPmNoYW5uZWws
ICJ2aWRlbyBsYXRlbmN5OiAlZCIsIGxhdGVuY3kpOwo+ICsgICAgQ0hBTk5FTF9ERUJVRyhzdC0+
Y2hhbm5lbCwgInZpZGVvIG1hcmdpbjogJWQiLCBtYXJnaW4pOwo+ICAgICAgaWYgKHN0LT5jdXJf
ZHJvcHNfc2VxX3N0YXRzLmxlbikgewo+ICAgICAgICAgIHN0LT5jdXJfZHJvcHNfc2VxX3N0YXRz
LmR1cmF0aW9uID0gc2VydmVyX21tdGltZSAtCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBzdC0+Y3VyX2Ryb3BzX3NlcV9zdGF0cy5zdGFydF9tbV90aW1lOwo+
IEBAIC0xNjc5LDcgKzE2NzksNyBAQCBzdGF0aWMgdm9pZCBkaXNwbGF5X2hhbmRsZV9zdHJlYW1f
ZGF0YShTcGljZUNoYW5uZWwKPiAqY2hhbm5lbCwgU3BpY2VNc2dJbiAqaW4pCj4gICAgICBTcGlj
ZVN0cmVhbURhdGFIZWFkZXIgKm9wID0gc3BpY2VfbXNnX2luX3BhcnNlZChpbik7Cj4gICAgICBk
aXNwbGF5X3N0cmVhbSAqc3QgPSBnZXRfc3RyZWFtX2J5X2lkKGNoYW5uZWwsIG9wLT5pZCk7Cj4g
ICAgICBndWludDMyIG1tdGltZTsKPiAtICAgIGludDMyX3QgbGF0ZW5jeSwgbGF0ZW5jeV9yZXBv
cnQ7Cj4gKyAgICBpbnQzMl90IG1hcmdpbiwgbWFyZ2luX3JlcG9ydDsKPiAgICAgIFNwaWNlRnJh
bWUgKmZyYW1lOwo+ICAKPiAgICAgIGdfcmV0dXJuX2lmX2ZhaWwoc3QgIT0gTlVMTCk7Cj4gQEAg
LTE2OTQsMTMgKzE2OTQsMTMgQEAgc3RhdGljIHZvaWQgZGlzcGxheV9oYW5kbGVfc3RyZWFtX2Rh
dGEoU3BpY2VDaGFubmVsCj4gKmNoYW5uZWwsIFNwaWNlTXNnSW4gKmluKQo+ICAgICAgICAgIG9w
LT5tdWx0aV9tZWRpYV90aW1lID0gbW10aW1lICsgMTAwOyAvKiB3b3JrYXJvdW5kLi4uICovCj4g
ICAgICB9Cj4gIAo+IC0gICAgbGF0ZW5jeSA9IGxhdGVuY3lfcmVwb3J0ID0gb3AtPm11bHRpX21l
ZGlhX3RpbWUgLSBtbXRpbWU7Cj4gLSAgICBpZiAobGF0ZW5jeSA+IDApIHsKPiArICAgIG1hcmdp
biA9IG1hcmdpbl9yZXBvcnQgPSBvcC0+bXVsdGlfbWVkaWFfdGltZSAtIG1tdGltZTsKPiArICAg
IGlmIChtYXJnaW4gPiAwKSB7Cj4gICAgICAgICAgU3BpY2VTZXNzaW9uICpzID0gc3BpY2VfY2hh
bm5lbF9nZXRfc2Vzc2lvbihjaGFubmVsKTsKPiAgCj4gICAgICAgICAgaWYgKHN0LT5zdXJmYWNl
LT5zdHJlYW1pbmdfbW9kZSAmJgo+ICAgICAgICAgICFzcGljZV9zZXNzaW9uX2lzX3BsYXliYWNr
X2FjdGl2ZShzKSkgewo+IC0gICAgICAgICAgICBDSEFOTkVMX0RFQlVHKGNoYW5uZWwsICJ2aWRl
byBsYXRlbmN5OiAlZCwgc2V0IHRvIDAgc2luY2UgdGhlcmUKPiBpcyBubyBwbGF5YmFjayIsIGxh
dGVuY3kpOwo+IC0gICAgICAgICAgICBsYXRlbmN5ID0gMDsKPiArICAgICAgICAgICAgQ0hBTk5F
TF9ERUJVRyhjaGFubmVsLCAidmlkZW8gbWFyZ2luOiAlZCwgc2V0IHRvIDAgc2luY2UgdGhlcmUK
PiBpcyBubyBwbGF5YmFjayIsIG1hcmdpbik7Cj4gKyAgICAgICAgICAgIG1hcmdpbiA9IDA7Cj4g
ICAgICAgICAgfQo+ICAgICAgfQo+ICAgICAgZGlzcGxheV9zdHJlYW1fc3RhdHNfc2F2ZShzdCwg
b3AtPm11bHRpX21lZGlhX3RpbWUsIG1tdGltZSk7Cj4gQEAgLTE3MTAsNyArMTcxMCw3IEBAIHN0
YXRpYyB2b2lkIGRpc3BsYXlfaGFuZGxlX3N0cmVhbV9kYXRhKFNwaWNlQ2hhbm5lbAo+ICpjaGFu
bmVsLCBTcGljZU1zZ0luICppbikKPiAgICAgICAqIHRha2luZyBpbnRvIGFjY291bnQgdGhlIGlt
cGFjdCBvbiBsYXRlciBmcmFtZXMuCj4gICAgICAgKi8KPiAgICAgIGZyYW1lID0gc3BpY2VfZnJh
bWVfbmV3KHN0LCBpbiwgb3AtPm11bHRpX21lZGlhX3RpbWUpOwo+IC0gICAgaWYgKCFzdC0+dmlk
ZW9fZGVjb2Rlci0+cXVldWVfZnJhbWUoc3QtPnZpZGVvX2RlY29kZXIsIGZyYW1lLCBsYXRlbmN5
KSkKPiB7Cj4gKyAgICBpZiAoIXN0LT52aWRlb19kZWNvZGVyLT5xdWV1ZV9mcmFtZShzdC0+dmlk
ZW9fZGVjb2RlciwgZnJhbWUsIG1hcmdpbikpIHsKPiAgICAgICAgICBkZXN0cm95X3N0cmVhbShj
aGFubmVsLCBvcC0+aWQpOwo+ICAgICAgICAgIHJlcG9ydF9pbnZhbGlkX3N0cmVhbShjaGFubmVs
LCBvcC0+aWQpOwo+ICAgICAgICAgIHJldHVybjsKPiBAQCAtMTcxOCw3ICsxNzE4LDcgQEAgc3Rh
dGljIHZvaWQgZGlzcGxheV9oYW5kbGVfc3RyZWFtX2RhdGEoU3BpY2VDaGFubmVsCj4gKmNoYW5u
ZWwsIFNwaWNlTXNnSW4gKmluKQo+ICAKPiAgICAgIGlmIChjLT5lbmFibGVfYWRhcHRpdmVfc3Ry
ZWFtaW5nKSB7Cj4gICAgICAgICAgZGlzcGxheV91cGRhdGVfc3RyZWFtX3JlcG9ydChTUElDRV9E
SVNQTEFZX0NIQU5ORUwoY2hhbm5lbCksIG9wLT5pZCwKPiAtICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIG9wLT5tdWx0aV9tZWRpYV90aW1lLCBsYXRlbmN5X3JlcG9ydCk7Cj4g
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcC0+bXVsdGlfbWVkaWFfdGlt
ZSwgbWFyZ2luX3JlcG9ydCk7Cj4gICAgICAgICAgaWYgKHN0LT5wbGF5YmFja19zeW5jX2Ryb3Bz
X3NlcV9sZW4gPj0KPiAgICAgICAgICBTVFJFQU1fUExBWUJBQ0tfU1lOQ19EUk9QX1NFUV9MRU5f
TElNSVQpIHsKPiAgICAgICAgICAgICAgc3BpY2Vfc2Vzc2lvbl9zeW5jX3BsYXliYWNrX2xhdGVu
Y3koc3BpY2VfY2hhbm5lbF9nZXRfc2Vzc2lvbihjaGFubmVsKSk7Cj4gICAgICAgICAgICAgIHN0
LT5wbGF5YmFja19zeW5jX2Ryb3BzX3NlcV9sZW4gPSAwOwpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpTcGljZS1kZXZlbCBtYWlsaW5nIGxpc3QKU3BpY2Ut
ZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vc3BpY2UtZGV2ZWw=
