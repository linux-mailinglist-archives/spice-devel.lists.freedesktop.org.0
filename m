Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3647BB3802
	for <lists+spice-devel@lfdr.de>; Mon, 16 Sep 2019 12:21:22 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7B7E16E904;
	Mon, 16 Sep 2019 10:21:19 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B02636E8F2
 for <spice-devel@lists.freedesktop.org>; Mon, 16 Sep 2019 10:21:17 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
 [10.5.11.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 5A383C053FDF
 for <spice-devel@lists.freedesktop.org>; Mon, 16 Sep 2019 10:21:17 +0000 (UTC)
Received: from wingsuit.mxp.redhat.com (unknown [10.32.181.155])
 by smtp.corp.redhat.com (Postfix) with ESMTP id D9F045D6B2
 for <spice-devel@lists.freedesktop.org>; Mon, 16 Sep 2019 10:21:16 +0000 (UTC)
From: Victor Toso <victortoso@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Mon, 16 Sep 2019 12:20:58 +0200
Message-Id: <20190916102104.20943-16-victortoso@redhat.com>
In-Reply-To: <20190916102104.20943-1-victortoso@redhat.com>
References: <20190916102104.20943-1-victortoso@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.32]); Mon, 16 Sep 2019 10:21:17 +0000 (UTC)
Subject: [Spice-devel] [PATCH v7 15/20] test-cd-emu: Add base test for
 cd-emulation
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogRnJlZGlhbm8gWmlnbGlvIDxmemlnbGlvQHJlZGhhdC5jb20+CgpKdXN0IGFsbG9jYXRl
IGFuZCBmcmVlIHRvIHRlc3QgZm9yIGJhc2UgbGVha3MgYW5kIHJlZmVyZW5jZQpjb3VudGluZy4K
ClNpZ25lZC1vZmYtYnk6IEZyZWRpYW5vIFppZ2xpbyA8ZnppZ2xpb0ByZWRoYXQuY29tPgotLS0K
IHRlc3RzL2NkLWVtdS5jICAgIHwgOTcgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysKIHRlc3RzL21lc29uLmJ1aWxkIHwgIDQgKysKIDIgZmlsZXMgY2hhbmdl
ZCwgMTAxIGluc2VydGlvbnMoKykKIGNyZWF0ZSBtb2RlIDEwMDY0NCB0ZXN0cy9jZC1lbXUuYwoK
ZGlmZiAtLWdpdCBhL3Rlc3RzL2NkLWVtdS5jIGIvdGVzdHMvY2QtZW11LmMKbmV3IGZpbGUgbW9k
ZSAxMDA2NDQKaW5kZXggMDAwMDAwMC4uYjdjNjU0MwotLS0gL2Rldi9udWxsCisrKyBiL3Rlc3Rz
L2NkLWVtdS5jCkBAIC0wLDAgKzEsOTcgQEAKKy8qCisgICBDb3B5cmlnaHQgKEMpIDIwMTkgUmVk
IEhhdCwgSW5jLgorCisgICBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiBy
ZWRpc3RyaWJ1dGUgaXQgYW5kL29yCisgICBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRo
ZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCisgICBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0
aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIKKyAgIHZlcnNpb24gMi4xIG9mIHRo
ZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgorCisgICBU
aGlzIGxpYnJhcnkgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVz
ZWZ1bCwKKyAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBs
aWVkIHdhcnJhbnR5IG9mCisgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJU
SUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQorICAgTGVzc2VyIEdlbmVyYWwgUHVibGljIExp
Y2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKworICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEg
Y29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYworICAgTGljZW5zZSBhbG9uZyB3
aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNl
cy8+LgorKi8KKyNpbmNsdWRlIDxnaW8vZ2lvLmg+CisKKyNpbmNsdWRlICJ1c2ItZGV2aWNlLWNk
LmgiCisjaW5jbHVkZSAidXNiLWVtdWxhdGlvbi5oIgorCitzdGF0aWMgU3BpY2VVc2JCYWNrZW5k
RGV2aWNlICpkZXZpY2UgPSBOVUxMOworCisvKiBzaW1wbGUgdXNiIG1hbmFnZXIgaG90cGx1ZyBj
YWxsYmFjayBlbXVsYXRpb24uICovCitzdGF0aWMgdm9pZAordGVzdF9ob3RwbHVnX2NhbGxiYWNr
KHZvaWQgKnVzZXJfZGF0YSwgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYsIGdib29sZWFuIGFk
ZGVkKQoreworICAgIC8vIGlnbm9yZSBub3QgZW11bGF0ZWQgZGV2aWNlcworICAgIGNvbnN0IFVz
YkRldmljZUluZm9ybWF0aW9uICppbmZvID0gc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX2dldF9p
bmZvKGRldik7CisgICAgaWYgKGluZm8tPmJ1cyAhPSBCVVNfTlVNQkVSX0ZPUl9FTVVMQVRFRF9V
U0IpIHsKKyAgICAgICAgcmV0dXJuOworICAgIH0KKworICAgIGlmIChhZGRlZCkgeworICAgICAg
ICBnX2Fzc2VydF9udWxsKGRldmljZSk7CisgICAgICAgIGRldmljZSA9IHNwaWNlX3VzYl9iYWNr
ZW5kX2RldmljZV9yZWYoZGV2KTsKKyAgICB9IGVsc2UgeworICAgICAgICBnX2Fzc2VydF9ub25u
dWxsKGRldmljZSk7CisgICAgICAgIGdfYXNzZXJ0KGRldmljZSA9PSBkZXYpOworICAgICAgICBz
cGljZV91c2JfYmFja2VuZF9kZXZpY2VfdW5yZWYoZGV2KTsKKyAgICAgICAgZGV2aWNlID0gTlVM
TDsKKyAgICB9Cit9CisKK3N0YXRpYyB2b2lkIG11bHRpcGxlKGNvbnN0IHZvaWQgKnBhcmFtKQor
eworICAgIGd1aW50IGxpbWl0ID0gR1BPSU5URVJfVE9fVUlOVChwYXJhbSk7CisgICAgQ2RFbXVs
YXRpb25QYXJhbXMgcGFyYW1zID0geyAidGVzdC1jZC1lbXUuaXNvIiwgMSB9OworICAgIEdFcnJv
ciAqZXJyID0gTlVMTDsKKyAgICBTcGljZVVzYkJhY2tlbmQgKiBiZSA9IHNwaWNlX3VzYl9iYWNr
ZW5kX25ldygmZXJyKTsKKyAgICBnX2Fzc2VydF9ub25udWxsKGJlKTsKKyAgICBnX2Fzc2VydF9u
dWxsKGVycik7CisgICAgc3BpY2VfdXNiX2JhY2tlbmRfcmVnaXN0ZXJfaG90cGx1ZyhiZSwgTlVM
TCwgdGVzdF9ob3RwbHVnX2NhbGxiYWNrLCAmZXJyKTsKKyAgICBnX2Fzc2VydF9udWxsKGVycik7
CisgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsaW1pdDsgaSsrKSB7CisgICAgICAgIC8vIGFsbG9j
YXRlIGEgQ0QgZW11bGF0aW9uIGRldmljZQorICAgICAgICBnX2Fzc2VydF90cnVlKGNyZWF0ZV9l
bXVsYXRlZF9jZChiZSwgJnBhcmFtcywgJmVycikpOworICAgICAgICBnX2Fzc2VydF9udWxsKGVy
cik7CisgICAgICAgIGdfYXNzZXJ0X25vbm51bGwoZGV2aWNlKTsKKworICAgICAgICAvLyBlbXVs
YXRlIGF1dG9tYXRpYyBDRCBlamVjdGlvbiwgdGhpcyBzaG91bGQgcmVsZWFzZSB0aGUKKyAgICAg
ICAgLy8gb2JqZWN0CisgICAgICAgIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9lamVjdChiZSwg
ZGV2aWNlKTsKKyAgICAgICAgZ19hc3NlcnRfbnVsbChkZXZpY2UpOworICAgIH0KKyAgICBzcGlj
ZV91c2JfYmFja2VuZF9kZXJlZ2lzdGVyX2hvdHBsdWcoYmUpOworICAgIHNwaWNlX3VzYl9iYWNr
ZW5kX2RlbGV0ZShiZSk7Cit9CisKKyNkZWZpbmUgVEVTVF9DRF9JU09fRklMRSAidGVzdC1jZC1l
bXUuaXNvIgorCitzdGF0aWMgdm9pZAord3JpdGVfdGVzdF9pc28odm9pZCkKK3sKKyAgICB1aW50
OF90IHNlY3RvclsyMDQ4XTsKKyAgICBGSUxFICpmID0gZm9wZW4oVEVTVF9DRF9JU09fRklMRSwg
IndiIik7CisgICAgZ19hc3NlcnRfbm9ubnVsbChmKTsKKyAgICBtZW1zZXQoc2VjdG9yLCAwLCBz
aXplb2Yoc2VjdG9yKSk7CisgICAgc3RyY3B5KChjaGFyKikgc2VjdG9yLCAic2VjdG9yIDAiKTsK
KyAgICBmd3JpdGUoc2VjdG9yLCBzaXplb2Yoc2VjdG9yKSwgMSwgZik7CisgICAgZmNsb3NlKGYp
OworfQorCitpbnQgbWFpbihpbnQgYXJnYywgY2hhciogYXJndltdKQoreworICAgIHdyaXRlX3Rl
c3RfaXNvKCk7CisKKyAgICBnX3Rlc3RfaW5pdCgmYXJnYywgJmFyZ3YsIE5VTEwpOworCisgICAg
Z190ZXN0X2FkZF9kYXRhX2Z1bmMoIi9jZC1lbXUvc2ltcGxlIiwgR1VJTlRfVE9fUE9JTlRFUigx
KSwgbXVsdGlwbGUpOworICAgIGdfdGVzdF9hZGRfZGF0YV9mdW5jKCIvY2QtZW11L211bHRpcGxl
IiwgR1VJTlRfVE9fUE9JTlRFUigxMjgpLCBtdWx0aXBsZSk7CisKKyAgICBpbnQgcmV0ID0gIGdf
dGVzdF9ydW4oKTsKKworICAgIHVubGluayhURVNUX0NEX0lTT19GSUxFKTsKKyAgICByZXR1cm4g
cmV0OworfQpkaWZmIC0tZ2l0IGEvdGVzdHMvbWVzb24uYnVpbGQgYi90ZXN0cy9tZXNvbi5idWls
ZAppbmRleCA2YzgwNzc2Li4zOWVhYzljIDEwMDY0NAotLS0gYS90ZXN0cy9tZXNvbi5idWlsZAor
KysgYi90ZXN0cy9tZXNvbi5idWlsZApAQCAtMTAsNiArMTAsMTAgQEAgaWYgc3BpY2VfZ3RrX2hh
c19waG9kYXYKICAgdGVzdHNfc291cmNlcyArPSAncGlwZS5jJwogZW5kaWYKIAoraWYgc3BpY2Vf
Z3RrX2hhc191c2JyZWRpcgorICB0ZXN0c19zb3VyY2VzICs9ICdjZC1lbXUuYycKK2VuZGlmCisK
IGlmIHNwaWNlX2d0a19oYXNfcG9sa2l0CiAgIHRlc3RzX3NvdXJjZXMgKz0gWwogICAgICd1c2It
YWNsLWhlbHBlci5jJywKLS0gCjIuMjEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KU3BpY2UtZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxp
c3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFu
L2xpc3RpbmZvL3NwaWNlLWRldmVs
