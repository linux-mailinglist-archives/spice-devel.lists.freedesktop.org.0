Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D5CD47A62D
	for <lists+spice-devel@lfdr.de>; Tue, 30 Jul 2019 12:43:52 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0B7E46E48F;
	Tue, 30 Jul 2019 10:43:51 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5F1C56E48F
 for <spice-devel@lists.freedesktop.org>; Tue, 30 Jul 2019 10:43:50 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx07.intmail.prod.int.phx2.redhat.com
 [10.5.11.22])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id E158A30BD1BE;
 Tue, 30 Jul 2019 10:43:49 +0000 (UTC)
Received: from colo-mx.corp.redhat.com
 (colo-mx01.intmail.prod.int.phx2.redhat.com [10.5.11.20])
 by smtp.corp.redhat.com (Postfix) with ESMTPS id D53A710013A7;
 Tue, 30 Jul 2019 10:43:49 +0000 (UTC)
Received: from zmail25.collab.prod.int.phx2.redhat.com
 (zmail25.collab.prod.int.phx2.redhat.com [10.5.83.31])
 by colo-mx.corp.redhat.com (Postfix) with ESMTP id C688018089C8;
 Tue, 30 Jul 2019 10:43:49 +0000 (UTC)
Date: Tue, 30 Jul 2019 06:43:49 -0400 (EDT)
From: Frediano Ziglio <fziglio@redhat.com>
To: Yuri Benditovich <yuri.benditovich@daynix.com>
Message-ID: <1039725951.3474044.1564483429122.JavaMail.zimbra@redhat.com>
In-Reply-To: <20190724105351.13753-9-yuri.benditovich@daynix.com>
References: <20190724105351.13753-1-yuri.benditovich@daynix.com>
 <20190724105351.13753-9-yuri.benditovich@daynix.com>
MIME-Version: 1.0
X-Originating-IP: [10.33.32.10, 10.4.195.27]
Thread-Topic: usb-redir: add implementation of emulated CD device
Thread-Index: dEad4NcsZ6sjvr5V3LPqBnjrTlkExA==
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.22
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.49]); Tue, 30 Jul 2019 10:43:49 +0000 (UTC)
Subject: Re: [Spice-devel] [spice-gtk 8/9] usb-redir: add implementation of
 emulated CD device
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: yan@daynix.com, spice-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

PiAKPiBUaGlzIG1vZHVsZSBjb250YWlucyBpbXBsZW1lbnRhdGlvbiBvZiBlbXVsYXRlZCBkZXZp
Y2UKPiBpbnRlcmZhY2UgZm9yIHNoYXJlZCBDRC4KPiAKPiBTaWduZWQtb2ZmLWJ5OiBZdXJpIEJl
bmRpdG92aWNoIDx5dXJpLmJlbmRpdG92aWNoQGRheW5peC5jb20+Cj4gLS0tCj4gIHNyYy91c2It
ZGV2aWNlLWNkLmMgfCA3OTQgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysKPiAgMSBmaWxlIGNoYW5nZWQsIDc5NCBpbnNlcnRpb25zKCspCj4gIGNyZWF0ZSBtb2Rl
IDEwMDY0NCBzcmMvdXNiLWRldmljZS1jZC5jCj4gCj4gZGlmZiAtLWdpdCBhL3NyYy91c2ItZGV2
aWNlLWNkLmMgYi9zcmMvdXNiLWRldmljZS1jZC5jCj4gbmV3IGZpbGUgbW9kZSAxMDA2NDQKPiBp
bmRleCAwMDAwMDAwLi4xOGRiY2VhCj4gLS0tIC9kZXYvbnVsbAo+ICsrKyBiL3NyYy91c2ItZGV2
aWNlLWNkLmMKPiBAQCAtMCwwICsxLDc5NCBAQAo+ICsvKiAtKi0gTW9kZTogQzsgYy1iYXNpYy1v
ZmZzZXQ6IDQ7IGluZGVudC10YWJzLW1vZGU6IG5pbCAtKi0gKi8KPiArLyoKPiArICAgIENvcHly
aWdodCAoQykgMjAxOSBSZWQgSGF0LCBJbmMuCj4gKwo+ICsgICAgUmVkIEhhdCBBdXRob3JzOgo+
ICsgICAgWXVyaSBCZW5kaXRvdmljaDx5YmVuZGl0b0ByZWRoYXQuY29tPgo+ICsKPiArICAgIFRo
aXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQv
b3IKPiArICAgIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2Vu
ZXJhbCBQdWJsaWMKPiArICAgIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3
YXJlIEZvdW5kYXRpb247IGVpdGhlcgo+ICsgICAgdmVyc2lvbiAyLjEgb2YgdGhlIExpY2Vuc2Us
IG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCj4gKwo+ICsgICAgVGhpcyBs
aWJyYXJ5IGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWws
Cj4gKyAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGll
ZCB3YXJyYW50eSBvZgo+ICsgICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFS
VElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUKPiArICAgIExlc3NlciBHZW5lcmFsIFB1Ymxp
YyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCj4gKwo+ICsgICAgWW91IHNob3VsZCBoYXZlIHJl
Y2VpdmVkIGEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYwo+ICsgICAgTGlj
ZW5zZSBhbG9uZyB3aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCBzZWUKPiA8aHR0cDovL3d3dy5n
bnUub3JnL2xpY2Vuc2VzLz4uCj4gKyovCj4gKwo+ICsjaW5jbHVkZSAiY29uZmlnLmgiCj4gKwo+
ICsjaWZkZWYgVVNFX1VTQlJFRElSCj4gKwo+ICsjaW5jbHVkZSA8Z2xpYi1vYmplY3QuaD4KPiAr
I2luY2x1ZGUgPGludHR5cGVzLmg+Cj4gKyNpbmNsdWRlIDxnaW8vZ2lvLmg+Cj4gKyNpbmNsdWRl
IDxnbGliL2dpMThuLWxpYi5oPgo+ICsjaW5jbHVkZSA8ZXJybm8uaD4KPiArI2luY2x1ZGUgPGxp
YnVzYi5oPgo+ICsjaW5jbHVkZSA8ZmNudGwuaD4KPiArCj4gKyNpZmRlZiBHX09TX1dJTjMyCj4g
KyNpbmNsdWRlIDx3aW5kb3dzLmg+Cj4gKyNpbmNsdWRlIDxudGRkY2RybS5oPgo+ICsjaW5jbHVk
ZSA8bnRkZG1tYy5oPgo+ICsjZWxzZQo+ICsjaW5jbHVkZSA8c3lzL3N0YXQuaD4KPiArI2luY2x1
ZGUgPHN5cy9pb2N0bC5oPgo+ICsjaW5jbHVkZSA8bGludXgvZnMuaD4KPiArI2luY2x1ZGUgPGxp
bnV4L2Nkcm9tLmg+Cj4gKyNlbmRpZgo+ICsKPiArI2luY2x1ZGUgInVzYi1lbXVsYXRpb24uaCIK
PiArI2luY2x1ZGUgImNkLXVzYi1idWxrLW1zZC5oIgo+ICsKPiArdHlwZWRlZiBzdHJ1Y3QgU3Bp
Y2VDZExVCj4gK3sKPiArICAgIGNoYXIgKmZpbGVuYW1lOwo+ICsgICAgR0ZpbGUgKmZpbGVfb2Jq
ZWN0Owo+ICsgICAgR0ZpbGVJbnB1dFN0cmVhbSAqc3RyZWFtOwo+ICsgICAgdWludDY0X3Qgc2l6
ZTsKPiArICAgIHVpbnQzMl90IGJsb2NrU2l6ZTsKPiArICAgIHVpbnQzMl90IGxvYWRlZCA6IDE7
Cj4gKyAgICB1aW50MzJfdCBkZXZpY2UgOiAxOwo+ICt9IFNwaWNlQ2RMVTsKPiArCj4gKyNkZWZp
bmUgTUFYX0xVTl9QRVJfREVWSUNFICAgICAgICAgICAgICAxCj4gKyNkZWZpbmUgVVNCMl9CQ0Qg
ICAgICAgICAgICAgICAgICAgICAgICAweDIwMAo+ICsjZGVmaW5lIENEX0RFVl9WSUQgICAgICAg
ICAgICAgICAgICAgICAgMHgyYjIzCj4gKyNkZWZpbmUgQ0RfREVWX1BJRCAgICAgICAgICAgICAg
ICAgICAgICAweENEQ0QKCldoZXJlIHRoZXNlIHZhbHVlcyBjYW1lPyBMYXRlciB5b3UgYXJlIHN0
YXRpbmcgdmVuZG9yCmlzICJSZWQgSGF0IiBidXQgUmVkIEhhdCBpcyAweDFiMzYgYW5kIFF1bXJh
bmV0IGlzIDB4MWFmNC4KQXJlIHRoZXNlIHRlbXBvcmFyeSB2YWx1ZXM/Cgo+ICsjZGVmaW5lIENE
X0RFVl9DTEFTUyAgICAgICAgICAgICAgICAgICAgOAo+ICsjZGVmaW5lIENEX0RFVl9TVUJDTEFT
UyAgICAgICAgICAgICAgICAgNgo+ICsjZGVmaW5lIENEX0RFVl9QUk9UT0NPTCAgICAgICAgICAg
ICAgICAgMHg1MAo+ICsjZGVmaW5lIENEX0RFVl9CTE9DS19TSVpFICAgICAgICAgICAgICAgMHgy
MDAKCkkgZGlkbid0IGV4cGVjdGVkIHRoaXMuIEkgdGhvdWdoIGFsbCBDRHMgd2VyZSAyMDQ4IHNl
Y3RvciBzaXplZC4KCj4gKyNkZWZpbmUgQ0RfREVWX01BWF9TSVpFICAgICAgICAgICAgICAgICA3
MzcyODAwMDAKClRoaXMgaXMgdW51c2VkLiBJIHdvdWxkIHJlbW92ZSBJIHN1cHBvc2UgRFZEIGRl
dmljZXMgb3IgaW1hZ2VzCndvbid0IGZpdCBoZXJlIGFueXdheS4KCj4gKyNkZWZpbmUgRFZEX0RF
Vl9CTE9DS19TSVpFICAgICAgICAgICAgICAweDgwMAo+ICsjZGVmaW5lIE1BWF9CVUxLX0lOX1JF
UVVFU1RTICAgICAgICAgICAgNjQKPiArCj4gK3N0cnVjdCBCdWZmZXJlZEJ1bGtSZWFkCj4gK3sK
PiArICAgIHN0cnVjdCB1c2JfcmVkaXJfYnVsa19wYWNrZXRfaGVhZGVyIGhvdXQ7Cj4gKyAgICB1
aW50NjRfdCBpZDsKPiArfTsKPiArCj4gK3N0cnVjdCBfU3BpY2VVc2JFbXVsYXRlZERldmljZQo+
ICt7Cj4gKyAgICBVc2JEZXZpY2VPcHMgZGV2X29wczsKPiArICAgIFNwaWNlVXNiQmFja2VuZCAq
YmFja2VuZDsKPiArICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqcGFyZW50Owo+ICsgICAgc3Ry
dWN0IHVzYnJlZGlycGFyc2VyICpwYXJzZXI7Cj4gKyAgICB2b2lkICogbXNjOwo+ICsgICAgU3Bp
Y2VDZExVIHVuaXRzW01BWF9MVU5fUEVSX0RFVklDRV07Cj4gKyAgICBnYm9vbGVhbiBsb2NrZWQ7
Cj4gKyAgICBnYm9vbGVhbiBkZWxldGVfb25fZWplY3Q7Cj4gKyAgICBnYm9vbGVhbiBkZWxldGlu
ZzsKPiArICAgIHVpbnQzMl90IG51bV9yZWFkczsKPiArICAgIHN0cnVjdCBCdWZmZXJlZEJ1bGtS
ZWFkIHJlYWRfYnVsa1tNQVhfQlVMS19JTl9SRVFVRVNUU107Cj4gKyAgICB1aW50MTZfdCBzZXJp
YWxbNF07CgpTcGVjaWZpY2F0aW9ucyBzdGF0ZSB0aGF0IHNlcmlhbCBzaG91bGQgYmUgYXQgbGVh
c3QgMTIgY2hhcmFjdGVycy4KCj4gKyAgICB1aW50OF90ICBtYXhfbHVuX2luZGV4Owo+ICt9Owo+
ICsKPiArdHlwZWRlZiBTcGljZVVzYkVtdWxhdGVkRGV2aWNlIFVzYkNkOwo+ICsKPiArI2lmbmRl
ZiBHX09TX1dJTjMyCj4gKwo+ICtzdGF0aWMgaW50IGNkX2RldmljZV9vcGVuX3N0cmVhbShTcGlj
ZUNkTFUgKnVuaXQsIGNvbnN0IGNoYXIgKmZpbGVuYW1lKQo+ICt7Cj4gKyAgICBpbnQgZXJyb3Ig
PSAwOwo+ICsgICAgdW5pdC0+ZGV2aWNlID0gMDsKPiArCj4gKyAgICBpZiAoIXVuaXQtPmZpbGVu
YW1lICYmICFmaWxlbmFtZSkgewo+ICsgICAgICAgIFNQSUNFX0RFQlVHKCIlczogZmlsZSBuYW1l
IG5vdCBwcm92aWRlZCIsIF9fRlVOQ1RJT05fXyk7Cj4gKyAgICAgICAgcmV0dXJuIC0xOwo+ICsg
ICAgfQo+ICsgICAgaWYgKHVuaXQtPmZpbGVuYW1lICYmIGZpbGVuYW1lKSB7Cj4gKyAgICAgICAg
Z19mcmVlKHVuaXQtPmZpbGVuYW1lKTsKPiArICAgICAgICB1bml0LT5maWxlbmFtZSA9IE5VTEw7
Cj4gKyAgICB9Cj4gKyAgICBpZiAoZmlsZW5hbWUpIHsKPiArICAgICAgICB1bml0LT5maWxlbmFt
ZSA9IGdfc3RyZHVwKGZpbGVuYW1lKTsKPiArICAgIH0KPiArCj4gKyAgICBpbnQgZmQgPSBvcGVu
KHVuaXQtPmZpbGVuYW1lLCBPX1JET05MWSB8IE9fTk9OQkxPQ0spOwo+ICsgICAgaWYgKGZkID4g
MCkgewo+ICsgICAgICAgIHN0cnVjdCBzdGF0IGZpbGVfc3RhdCA9IHsgMCB9Owo+ICsgICAgICAg
IGlmIChmc3RhdChmZCwgJmZpbGVfc3RhdCkgfHwgZmlsZV9zdGF0LnN0X3NpemUgPT0gMCkgewo+
ICsgICAgICAgICAgICBmaWxlX3N0YXQuc3Rfc2l6ZSA9IDA7Cj4gKyAgICAgICAgICAgIHVuaXQt
PmRldmljZSA9IDE7Cj4gKyAgICAgICAgICAgIGlmICghaW9jdGwoZmQsIEJMS0dFVFNJWkU2NCwg
JmZpbGVfc3RhdC5zdF9zaXplKSAmJgo+ICsgICAgICAgICAgICAgICAgIWlvY3RsKGZkLCBCTEtT
U1pHRVQsICZ1bml0LT5ibG9ja1NpemUpKSB7Cj4gKyAgICAgICAgICAgIH0KPiArICAgICAgICB9
Cj4gKyAgICAgICAgdW5pdC0+c2l6ZSA9IGZpbGVfc3RhdC5zdF9zaXplOwo+ICsgICAgICAgIGNs
b3NlKGZkKTsKPiArICAgICAgICBpZiAodW5pdC0+c2l6ZSkgewo+ICsgICAgICAgICAgICB1bml0
LT5maWxlX29iamVjdCA9IGdfZmlsZV9uZXdfZm9yX3BhdGgodW5pdC0+ZmlsZW5hbWUpOwo+ICsg
ICAgICAgICAgICB1bml0LT5zdHJlYW0gPSBnX2ZpbGVfcmVhZCh1bml0LT5maWxlX29iamVjdCwg
TlVMTCwgTlVMTCk7Cj4gKyAgICAgICAgfQo+ICsgICAgICAgIGlmICghdW5pdC0+c3RyZWFtKSB7
Cj4gKyAgICAgICAgICAgIFNQSUNFX0RFQlVHKCIlczogY2FuJ3Qgb3BlbiBzdHJlYW0gb24gJXMi
LCBfX0ZVTkNUSU9OX18sCj4gdW5pdC0+ZmlsZW5hbWUpOwo+ICsgICAgICAgICAgICBnX29iamVj
dF91bnJlZih1bml0LT5maWxlX29iamVjdCk7Cj4gKyAgICAgICAgICAgIHVuaXQtPmZpbGVfb2Jq
ZWN0ID0gTlVMTDsKPiArICAgICAgICAgICAgZXJyb3IgPSAtMTsKPiArICAgICAgICB9Cj4gKyAg
ICB9Cj4gKyAgICBlbHNlIHsKPiArICAgICAgICBTUElDRV9ERUJVRygiJXM6IGNhbid0IG9wZW4g
ZmlsZSAlcyIsIF9fRlVOQ1RJT05fXywgdW5pdC0+ZmlsZW5hbWUpOwo+ICsgICAgICAgIGVycm9y
ID0gLTE7Cj4gKyAgICB9Cj4gKwo+ICsgICAgcmV0dXJuIGVycm9yOwo+ICt9Cj4gKwo+ICtzdGF0
aWMgaW50IGNkX2RldmljZV9sb2FkKFNwaWNlQ2RMVSAqdW5pdCwgZ2Jvb2xlYW4gbG9hZCkKPiAr
ewo+ICsgICAgaW50IGVycm9yOwo+ICsgICAgaWYgKCF1bml0LT5kZXZpY2UgfHwgIXVuaXQtPmZp
bGVuYW1lKSB7Cj4gKyAgICAgICAgcmV0dXJuIC0xOwo+ICsgICAgfQo+ICsgICAgaW50IGZkID0g
b3Blbih1bml0LT5maWxlbmFtZSwgT19SRE9OTFkgfCBPX05PTkJMT0NLKTsKPiArICAgIGlmIChm
ZCA8IDApIHsKPiArICAgICAgICByZXR1cm4gLTE7Cj4gKyAgICB9Cj4gKyAgICBpZiAobG9hZCkg
ewo+ICsgICAgICAgIGVycm9yID0gaW9jdGwoZmQsIENEUk9NQ0xPU0VUUkFZLCAwKTsKPiArICAg
IH0gZWxzZSB7Cj4gKyAgICAgICAgZXJyb3IgPSBpb2N0bChmZCwgQ0RST01fTE9DS0RPT1IsIDAp
Owo+ICsgICAgICAgIGVycm9yID0gaW9jdGwoZmQsIENEUk9NRUpFQ1QsIDApOwo+ICsgICAgfQo+
ICsgICAgaWYgKGVycm9yKSB7Cj4gKyAgICAgICAgLy8gbm90ZSB0aGF0IGVqZWN0aW5nIG1pZ2h0
IGJlIGF2YWlsYWJsZSBvbmx5IGZvciByb290Cj4gKyAgICAgICAgLy8gbG9hZGluZyBtaWdodCBi
ZSBhdmFpbGFibGUgYWxzbyBmb3IgcmVndWxhciB1c2VyCj4gKyAgICAgICAgU1BJQ0VfREVCVUco
IiVzOiBjYW4ndCAlc2xvYWQgJXMsIHJlcyAlZCwgZXJybm8gJWQiLAo+ICsgICAgICAgICAgICBf
X0ZVTkNUSU9OX18sIGxvYWQgPyAiIiA6ICJ1biIsIHVuaXQtPmZpbGVuYW1lLCBlcnJvciwgZXJy
bm8pOwo+ICsgICAgfQo+ICsgICAgY2xvc2UoZmQpOwo+ICsgICAgcmV0dXJuIGVycm9yOwo+ICt9
Cj4gKwo+ICtzdGF0aWMgaW50IGNkX2RldmljZV9jaGVjayhTcGljZUNkTFUgKnVuaXQpCj4gK3sK
PiArICAgIGludCBlcnJvcjsKPiArICAgIGlmICghdW5pdC0+ZGV2aWNlIHx8ICF1bml0LT5maWxl
bmFtZSkgewo+ICsgICAgICAgIHJldHVybiAtMTsKPiArICAgIH0KPiArICAgIGludCBmZCA9IG9w
ZW4odW5pdC0+ZmlsZW5hbWUsIE9fUkRPTkxZIHwgT19OT05CTE9DSyk7Cj4gKyAgICBpZiAoZmQg
PCAwKSB7Cj4gKyAgICAgICAgcmV0dXJuIC0xOwo+ICsgICAgfQo+ICsgICAgZXJyb3IgPSBpb2N0
bChmZCwgQ0RST01fRFJJVkVfU1RBVFVTLCAwKTsKPiArICAgIGVycm9yID0gKGVycm9yID09IENE
U19ESVNDX09LKSA/IDAgOiAtMTsKPiArICAgIGlmICghZXJyb3IpIHsKPiArICAgICAgICBlcnJv
ciA9IGlvY3RsKGZkLCBDRFJPTV9ESVNDX1NUQVRVUywgMCk7Cj4gKyAgICAgICAgZXJyb3IgPSAo
ZXJyb3IgPT0gQ0RTX0RBVEFfMSkgPyAwIDogLTE7Cj4gKyAgICB9Cj4gKyAgICBjbG9zZShmZCk7
Cj4gKyAgICByZXR1cm4gZXJyb3I7Cj4gK30KPiArCj4gKyNlbHNlCj4gKwo+ICtzdGF0aWMgZ2Jv
b2xlYW4gaXNfZGV2aWNlX25hbWUoY29uc3QgY2hhciAqZmlsZW5hbWUpCj4gK3sKPiArICAgIGdi
b29sZWFuIGIgPSBzdHJsZW4oZmlsZW5hbWUpID09IDIgJiYgZmlsZW5hbWVbMV0gPT0gJzonOwo+
ICsgICAgcmV0dXJuIGI7CgpIZXJlICI6OiIgb3IgIjA6IiBhcmUgYWNjZXB0ZWQuIEkgaGF2ZSBh
IGZvbGxvdyB1cCBmb3IgdGhpcy4KCj4gK30KPiArCj4gK3N0YXRpYyBIQU5ETEUgb3Blbl9maWxl
KGNvbnN0IGNoYXIgKmZpbGVuYW1lKQo+ICt7Cj4gKyAgICBIQU5ETEUgaCA9IENyZWF0ZUZpbGVB
KGZpbGVuYW1lLAoKTWlub3IgYnV0IG1heWJlIHdlIHdhbnQgdG8gY29udmVydCBmcm9tIHV0Zjgg
KHVzdWFsbHkgdXNlZCBieQpHTGliKSB0byB1dGYxNiBhbmQgdXNlIENyZWF0ZUZpbGVXLgoKPiAr
ICAgICAgICAgICAgICAgICAgICAgICAgICAgR0VORVJJQ19SRUFELAo+ICsgICAgICAgICAgICAg
ICAgICAgICAgICAgICBGSUxFX1NIQVJFX1JFQUQgfCBGSUxFX1NIQVJFX1dSSVRFLAoKVGhpcyB3
aWxsIGFsbG93IG90aGVyIHByb2dyYW0gdG8gY2hhbmdlIHRoZSBJU08gd2hpbGUgdGhlIHByb2dy
YW0gaXMKcnVubmluZy4gSXMgdGhpcyB3YW50ZWQ/IEkga25vdyBpdCdzIGNvbXBhdGlibGUgd2l0
aCBVbml4IHNvbWVob3cgYnV0CkkgdGhpbmsgdXN1YWxseSBvbiBXaW5kb3dzIHlvdSBkb24ndCBl
eHBlY3QgdGhpcy4KQnV0IGhvbmVzdGx5IGlzIGp1c3QgYSBtaW5vci4KCj4gKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgIE5VTEwsIE9QRU5fRVhJU1RJTkcsCj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgIDAsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgIE5VTEwpOwo+ICsgICAg
aWYgKGggPT0gSU5WQUxJRF9IQU5ETEVfVkFMVUUpIHsKPiArICAgICAgICBoID0gTlVMTDsKPiAr
ICAgIH0KPiArICAgIHJldHVybiBoOwo+ICt9Cj4gKwo+ICtzdGF0aWMgdWludDMyX3QgaW9jdGxf
b3V0KEhBTkRMRSBoLCB1aW50MzJfdCBjb2RlLCB2b2lkICpvdXRfYnVmZmVyLAo+IHVpbnQzMl90
IG91dF9zaXplKQo+ICt7Cj4gKyAgICB1aW50MzJfdCBlcnJvcjsKPiArICAgIERXT1JEIHJldDsK
PiArICAgIEJPT0wgYiA9IERldmljZUlvQ29udHJvbChoLCBjb2RlLCBOVUxMLCAwLCBvdXRfYnVm
ZmVyLCBvdXRfc2l6ZSwgJnJldCwKPiBOVUxMKTsKPiArICAgIGVycm9yID0gYiA/IDAgOiBHZXRM
YXN0RXJyb3IoKTsKPiArICAgIHJldHVybiBlcnJvcjsKPiArfQo+ICsKPiArc3RhdGljIHVpbnQz
Ml90IGlvY3RsX25vbmUoSEFORExFIGgsIHVpbnQzMl90IGNvZGUpCj4gK3sKPiArICAgIHJldHVy
biBpb2N0bF9vdXQoaCwgY29kZSwgTlVMTCwgMCk7Cj4gK30KPiArCj4gK3N0YXRpYyBnYm9vbGVh
biBjaGVja19kZXZpY2UoSEFORExFIGgpCj4gK3sKPiArICAgIEdFVF9DT05GSUdVUkFUSU9OX0lP
Q1RMX0lOUFVUIGNmZ0luID0KPiArICAgICAgICB7IEZlYXR1cmVDZFJlYWQsIFNDU0lfR0VUX0NP
TkZJR1VSQVRJT05fUkVRVUVTVF9UWVBFX0FMTCwge30gfTsKPiArICAgIERXT1JEIHJldDsKPiAr
ICAgIEdFVF9DT05GSUdVUkFUSU9OX0hFQURFUiBjZmdPdXQ7Cj4gKyAgICByZXR1cm4gRGV2aWNl
SW9Db250cm9sKGgsIElPQ1RMX0NEUk9NX0dFVF9DT05GSUdVUkFUSU9OLAo+ICsgICAgICAgICAg
ICAgICAgICAgICAgICAgICAmY2ZnSW4sIHNpemVvZihjZmdJbiksICZjZmdPdXQsIHNpemVvZihj
ZmdPdXQpLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAmcmV0LCBOVUxMKTsKPiArfQo+
ICsKPiArc3RhdGljIGludCBjZF9kZXZpY2Vfb3Blbl9zdHJlYW0oU3BpY2VDZExVICp1bml0LCBj
b25zdCBjaGFyICpmaWxlbmFtZSkKPiArewo+ICsgICAgaW50IGVycm9yID0gMDsKPiArICAgIEhB
TkRMRSBoOwo+ICsgICAgdW5pdC0+ZGV2aWNlID0gMDsKPiArICAgIGlmICghdW5pdC0+ZmlsZW5h
bWUgJiYgIWZpbGVuYW1lKSB7Cj4gKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiB1bm5hbWVkIGZp
bGUiLCBfX0ZVTkNUSU9OX18pOwo+ICsgICAgICAgIHJldHVybiAtMTsKPiArICAgIH0KPiArICAg
IGlmICh1bml0LT5maWxlbmFtZSAmJiBmaWxlbmFtZSkgewo+ICsgICAgICAgIGdfZnJlZSh1bml0
LT5maWxlbmFtZSk7Cj4gKyAgICAgICAgdW5pdC0+ZmlsZW5hbWUgPSBOVUxMOwo+ICsgICAgfQo+
ICsgICAgaWYgKCFmaWxlbmFtZSkgewo+ICsgICAgICAgIC8vIHJlb3BlbmluZyB0aGUgc3RyZWFt
IG9uIGV4aXN0aW5nIGZpbGUgbmFtZQo+ICsgICAgfSBlbHNlIGlmIChpc19kZXZpY2VfbmFtZShm
aWxlbmFtZSkpIHsKPiArICAgICAgICB1bml0LT5maWxlbmFtZSA9IGdfc3RyZHVwX3ByaW50Zigi
XFxcXC5cXCVzIiwgZmlsZW5hbWUpOwo+ICsgICAgfSBlbHNlIHsKPiArICAgICAgICB1bml0LT5m
aWxlbmFtZSA9IGdfc3RyZHVwKGZpbGVuYW1lKTsKPiArICAgIH0KPiArICAgIGggPSBvcGVuX2Zp
bGUodW5pdC0+ZmlsZW5hbWUpOwo+ICsgICAgaWYgKGgpIHsKPiArICAgICAgICBMQVJHRV9JTlRF
R0VSIHNpemUgPSB7IDAgfTsKPiArICAgICAgICBpZiAoIUdldEZpbGVTaXplRXgoaCwgJnNpemUp
KSB7Cj4gKyAgICAgICAgICAgIHVpbnQ2NF90IGJ1ZmZlclsyNTZdOwo+ICsgICAgICAgICAgICB1
aW50MzJfdCByZXM7Cj4gKyAgICAgICAgICAgIHVuaXQtPmRldmljZSA9IGNoZWNrX2RldmljZSho
KTsKPiArICAgICAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiBDRCBkZXZpY2UgJXNyZWNvZ25pemVk
IG9uICVzIiwKPiArICAgICAgICAgICAgICAgIF9fRlVOQ1RJT05fXywgdW5pdC0+ZGV2aWNlID8g
IiIgOiAiTk9UICIsIHVuaXQtPmZpbGVuYW1lKTsKPiArICAgICAgICAgICAgcmVzID0gaW9jdGxf
b3V0KGgsIElPQ1RMX0RJU0tfR0VUX0RSSVZFX0dFT01FVFJZX0VYLAo+ICsgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgYnVmZmVyLCBzaXplb2YoYnVmZmVyKSk7Cj4gKyAgICAgICAgICAgIGlm
ICghcmVzKQo+ICsgICAgICAgICAgICB7Cj4gKyAgICAgICAgICAgICAgICBESVNLX0dFT01FVFJZ
X0VYICpwZyA9IChESVNLX0dFT01FVFJZX0VYICopYnVmZmVyOwo+ICsgICAgICAgICAgICAgICAg
dW5pdC0+YmxvY2tTaXplID0gcGctPkdlb21ldHJ5LkJ5dGVzUGVyU2VjdG9yOwo+ICsgICAgICAg
ICAgICAgICAgc2l6ZSA9IHBnLT5EaXNrU2l6ZTsKPiArICAgICAgICAgICAgfSBlbHNlIHsKPiAr
ICAgICAgICAgICAgICAgIFNQSUNFX0RFQlVHKCIlczogY2FuJ3Qgb2J0YWluIHNpemUgb2YgJXMg
KGVycm9yICV1KSIsCj4gKyAgICAgICAgICAgICAgICAgICAgX19GVU5DVElPTl9fLCB1bml0LT5m
aWxlbmFtZSwgcmVzKTsKPiArICAgICAgICAgICAgfQo+ICsgICAgICAgIH0KPiArICAgICAgICB1
bml0LT5zaXplID0gc2l6ZS5RdWFkUGFydDsKPiArICAgICAgICBDbG9zZUhhbmRsZShoKTsKPiAr
ICAgICAgICBpZiAodW5pdC0+c2l6ZSkgewo+ICsgICAgICAgICAgICB1bml0LT5maWxlX29iamVj
dCA9IGdfZmlsZV9uZXdfZm9yX3BhdGgodW5pdC0+ZmlsZW5hbWUpOwo+ICsgICAgICAgICAgICB1
bml0LT5zdHJlYW0gPSBnX2ZpbGVfcmVhZCh1bml0LT5maWxlX29iamVjdCwgTlVMTCwgTlVMTCk7
Cj4gKyAgICAgICAgfQo+ICsgICAgICAgIGlmICghdW5pdC0+c3RyZWFtKSB7Cj4gKyAgICAgICAg
ICAgIFNQSUNFX0RFQlVHKCIlczogY2FuJ3Qgb3BlbiBzdHJlYW0gb24gJXMiLCBfX0ZVTkNUSU9O
X18sCj4gdW5pdC0+ZmlsZW5hbWUpOwo+ICsgICAgICAgICAgICBnX29iamVjdF91bnJlZih1bml0
LT5maWxlX29iamVjdCk7Cj4gKyAgICAgICAgICAgIHVuaXQtPmZpbGVfb2JqZWN0ID0gTlVMTDsK
PiArICAgICAgICAgICAgZXJyb3IgPSAtMTsKPiArICAgICAgICB9Cj4gKyAgICB9IGVsc2Ugewo+
ICsgICAgICAgIFNQSUNFX0RFQlVHKCIlczogY2FuJ3Qgb3BlbiBmaWxlICVzIiwgX19GVU5DVElP
Tl9fLCB1bml0LT5maWxlbmFtZSk7Cj4gKyAgICAgICAgZXJyb3IgPSAtMTsKPiArICAgIH0KPiAr
ICAgIHJldHVybiBlcnJvcjsKPiArfQo+ICsKPiArc3RhdGljIGludCBjZF9kZXZpY2VfbG9hZChT
cGljZUNkTFUgKnVuaXQsIGdib29sZWFuIGxvYWQpCj4gK3sKPiArICAgIGludCBlcnJvciA9IDA7
Cj4gKyAgICBIQU5ETEUgaDsKPiArICAgIGlmICghdW5pdC0+ZGV2aWNlIHx8ICF1bml0LT5maWxl
bmFtZSkgewo+ICsgICAgICAgIHJldHVybiAtMTsKPiArICAgIH0KPiArICAgIGggPSBvcGVuX2Zp
bGUodW5pdC0+ZmlsZW5hbWUpOwo+ICsgICAgaWYgKGgpIHsKPiArICAgICAgICB1aW50MzJfdCBy
ZXMgPSBpb2N0bF9ub25lKGgsIGxvYWQgPyBJT0NUTF9TVE9SQUdFX0xPQURfTUVESUEgOgo+IElP
Q1RMX1NUT1JBR0VfRUpFQ1RfTUVESUEpOwo+ICsgICAgICAgIGlmIChyZXMpIHsKPiArICAgICAg
ICAgICAgU1BJQ0VfREVCVUcoIiVzOiBjYW4ndCAlc2xvYWQgJXMsIHdpbiBlcnJvciAldSIsCj4g
KyAgICAgICAgICAgICAgICAgICAgICAgIF9fRlVOQ1RJT05fXywgbG9hZCA/ICIiIDogInVuIiwg
dW5pdC0+ZmlsZW5hbWUsCj4gcmVzKTsKPiArICAgICAgICAgICAgZXJyb3IgPSAtMTsKPiArICAg
ICAgICB9IGVsc2Ugewo+ICsgICAgICAgICAgICBTUElDRV9ERUJVRygiJXM6IGRldmljZSAlcyBb
JXNdIiwKPiArICAgICAgICAgICAgICAgICAgICAgICAgX19GVU5DVElPTl9fLCBsb2FkID8gImxv
YWRlZCIgOiAiZWplY3RlZCIsCj4gdW5pdC0+ZmlsZW5hbWUpOwo+ICsgICAgICAgIH0KPiArICAg
ICAgICBDbG9zZUhhbmRsZShoKTsKPiArICAgIH0KPiArICAgIHJldHVybiBlcnJvcjsKPiArfQo+
ICsKPiArc3RhdGljIGludCBjZF9kZXZpY2VfY2hlY2soU3BpY2VDZExVICp1bml0KQo+ICt7Cj4g
KyAgICBpbnQgZXJyb3IgPSAwOwo+ICsgICAgQ0RST01fRElTS19EQVRBIGRhdGE7Cj4gKyAgICBI
QU5ETEUgaDsKPiArICAgIGlmICghdW5pdC0+ZGV2aWNlIHx8ICF1bml0LT5maWxlbmFtZSkgewo+
ICsgICAgICAgIHJldHVybiAtMTsKPiArICAgIH0KPiArICAgIGggPSBvcGVuX2ZpbGUodW5pdC0+
ZmlsZW5hbWUpOwo+ICsgICAgaWYgKGgpIHsKPiArICAgICAgICB1aW50MzJfdCByZXMgPSBpb2N0
bF9ub25lKGgsIElPQ1RMX1NUT1JBR0VfQ0hFQ0tfVkVSSUZZKTsKPiArICAgICAgICBpZiAoIXJl
cykgewo+ICsgICAgICAgICAgICByZXMgPSBpb2N0bF9vdXQoaCwgSU9DVExfQ0RST01fRElTS19U
WVBFLCAmZGF0YSwgc2l6ZW9mKGRhdGEpKTsKPiArICAgICAgICB9Cj4gKyAgICAgICAgaWYgKHJl
cyAhPSAwIHx8IGRhdGEuRGlza0RhdGEgIT0gQ0RST01fRElTS19EQVRBX1RSQUNLKSB7Cj4gKyAg
ICAgICAgICAgIGVycm9yID0gLTE7Cj4gKyAgICAgICAgfQo+ICsgICAgICAgIENsb3NlSGFuZGxl
KGgpOwo+ICsgICAgfQo+ICsgICAgcmV0dXJuIGVycm9yOwo+ICt9Cj4gKwo+ICsjZW5kaWYKPiAr
Cj4gK3N0YXRpYyBnYm9vbGVhbiBvcGVuX3N0cmVhbShTcGljZUNkTFUgKnVuaXQsIGNvbnN0IGNo
YXIgKmZpbGVuYW1lKQo+ICt7Cj4gKyAgICBnYm9vbGVhbiBiID0gRkFMU0U7Cj4gKyAgICBiID0g
Y2RfZGV2aWNlX29wZW5fc3RyZWFtKHVuaXQsIGZpbGVuYW1lKSA9PSAwOwo+ICsgICAgcmV0dXJu
IGI7Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIGNsb3NlX3N0cmVhbShTcGljZUNkTFUgKnVuaXQp
Cj4gK3sKPiArICAgIGlmICh1bml0LT5zdHJlYW0pIHsKPiArICAgICAgICBnX29iamVjdF91bnJl
Zih1bml0LT5zdHJlYW0pOwo+ICsgICAgICAgIHVuaXQtPnN0cmVhbSA9IE5VTEw7Cj4gKyAgICB9
Cj4gKyAgICBpZiAodW5pdC0+ZmlsZV9vYmplY3QpIHsKPiArICAgICAgICBnX29iamVjdF91bnJl
Zih1bml0LT5maWxlX29iamVjdCk7Cj4gKyAgICAgICAgdW5pdC0+ZmlsZV9vYmplY3QgPSBOVUxM
Owo+ICsgICAgfQo+ICt9Cj4gKwo+ICtzdGF0aWMgZ2Jvb2xlYW4gbG9hZF9sdW4oVXNiQ2QgKmQs
IGludCB1bml0LCBnYm9vbGVhbiBsb2FkKQo+ICt7Cj4gKyAgICBnYm9vbGVhbiBiID0gVFJVRTsK
PiArICAgIGlmIChsb2FkICYmIGQtPnVuaXRzW3VuaXRdLmRldmljZSkgewo+ICsgICAgICAgIC8v
IHRoZXJlIGlzIG9uZSBwb3NzaWJsZSBwcm9ibGVtIGluIGNhc2Ugb3VyIGJhY2tlbmQgaXMgdGhl
Cj4gKyAgICAgICAgLy8gbG9jYWwgQ0QgZGV2aWNlIGFuZCBpdCBpcyBlamVjdGVkCj4gKyAgICAg
ICAgY2RfZGV2aWNlX2xvYWQoJmQtPnVuaXRzW3VuaXRdLCBUUlVFKTsKPiArICAgICAgICBjbG9z
ZV9zdHJlYW0oJmQtPnVuaXRzW3VuaXRdKTsKPiArICAgICAgICBpZiAoY2RfZGV2aWNlX2NoZWNr
KCZkLT51bml0c1t1bml0XSkgfHwKPiAhb3Blbl9zdHJlYW0oJmQtPnVuaXRzW3VuaXRdLCBOVUxM
KSkgewo+ICsgICAgICAgICAgICByZXR1cm4gRkFMU0U7Cj4gKyAgICAgICAgfQo+ICsgICAgfQo+
ICsKPiArICAgIGlmIChsb2FkKSB7Cj4gKyAgICAgICAgQ2RTY3NpTWVkaWFQYXJhbWV0ZXJzIG1l
ZGlhX3BhcmFtcyA9IHsgMCB9Owo+ICsKPiArICAgICAgICBtZWRpYV9wYXJhbXMuc3RyZWFtID0g
ZC0+dW5pdHNbdW5pdF0uc3RyZWFtOwo+ICsgICAgICAgIG1lZGlhX3BhcmFtcy5zaXplID0gZC0+
dW5pdHNbdW5pdF0uc2l6ZTsKPiArICAgICAgICBtZWRpYV9wYXJhbXMuYmxvY2tfc2l6ZSA9IGQt
PnVuaXRzW3VuaXRdLmJsb2NrU2l6ZTsKPiArICAgICAgICBpZiAobWVkaWFfcGFyYW1zLmJsb2Nr
X3NpemUgPT0gQ0RfREVWX0JMT0NLX1NJWkUgJiYKPiArICAgICAgICAgICAgbWVkaWFfcGFyYW1z
LnNpemUgJSBEVkRfREVWX0JMT0NLX1NJWkUgPT0gMCkgewo+ICsgICAgICAgICAgICBtZWRpYV9w
YXJhbXMuYmxvY2tfc2l6ZSA9IERWRF9ERVZfQkxPQ0tfU0laRTsKPiArICAgICAgICB9Cj4gKyAg
ICAgICAgU1BJQ0VfREVCVUcoIiVzOiBsb2FkaW5nICVzLCBzaXplICUiIFBSSXU2NCAiLCBibG9j
ayAldSIsCj4gKyAgICAgICAgICAgICAgICAgICAgX19GVU5DVElPTl9fLCBkLT51bml0c1t1bml0
XS5maWxlbmFtZSwKPiBtZWRpYV9wYXJhbXMuc2l6ZSwgbWVkaWFfcGFyYW1zLmJsb2NrX3NpemUp
Owo+ICsKPiArICAgICAgICBiID0gIWNkX3VzYl9idWxrX21zZF9sb2FkKGQtPm1zYywgdW5pdCwg
Jm1lZGlhX3BhcmFtcyk7Cj4gKwo+ICsgICAgICAgIGQtPnVuaXRzW3VuaXRdLmxvYWRlZCA9ICEh
YjsKPiArCj4gKyAgICB9IGVsc2Ugewo+ICsgICAgICAgIFNQSUNFX0RFQlVHKCIlczogdW5sb2Fk
aW5nICVzIiwgX19GVU5DVElPTl9fLAo+IGQtPnVuaXRzW3VuaXRdLmZpbGVuYW1lKTsKPiArICAg
ICAgICBjZF91c2JfYnVsa19tc2RfdW5sb2FkKGQtPm1zYywgdW5pdCk7Cj4gKyAgICAgICAgZC0+
dW5pdHNbdW5pdF0ubG9hZGVkID0gRkFMU0U7Cj4gKyAgICB9Cj4gKyAgICByZXR1cm4gYjsKPiAr
fQo+ICsKPiArc3RhdGljIHZvaWQgdXNiX2NkX2RlbGV0ZShVc2JDZCAqZCkKPiArewo+ICsgICAg
dWludDMyX3QgdW5pdCA9IDA7CgpXaHkgdW5pdCBpcyBhbHdheXMgMD8gSGVyZSBhbmQgaW4gb3Ro
ZXIgcGxhY2VzLgpNYXliZSB3b3J0aCBhZGRpbmcgYSBtbmVtb25pYz8KCj4gKyAgICBjZF91c2Jf
YnVsa19tc2RfdW5yZWFsaXplKGQtPm1zYywgdW5pdCk7Cj4gKyAgICBnX2NsZWFyX3BvaW50ZXIo
JmQtPnVuaXRzW3VuaXRdLmZpbGVuYW1lLCBnX2ZyZWUpOwo+ICsgICAgY2xvc2Vfc3RyZWFtKCZk
LT51bml0c1t1bml0XSk7Cj4gKyAgICBnX2NsZWFyX3BvaW50ZXIoJmQtPm1zYywgY2RfdXNiX2J1
bGtfbXNkX2ZyZWUpOwo+ICsgICAgZ19mcmVlKGQpOwo+ICt9Cj4gKwo+ICtzdGF0aWMgZ2Jvb2xl
YW4gdXNiX2NkX2dldF9kZXNjcmlwdG9yKFVzYkNkICpkLCB1aW50OF90IHR5cGUsIHVpbnQ4X3Qg
aW5kZXgsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqKmJ1
ZmZlciwgdWludDE2X3QgKnNpemUpCj4gK3sKPiArICAgIHN0YXRpYyBzdHJ1Y3QgbGlidXNiX2Rl
dmljZV9kZXNjcmlwdG9yIGRlc2MgPQo+ICsgICAgewo+ICsgICAgICAgIC5iTGVuZ3RoID0gMTgs
Cj4gKyAgICAgICAgLmJEZXNjcmlwdG9yVHlwZSA9IExJQlVTQl9EVF9ERVZJQ0UsCj4gKyAgICAg
ICAgLmJjZFVTQiA9IFVTQjJfQkNELAo+ICsgICAgICAgIC5iRGV2aWNlQ2xhc3MgPSAwLAo+ICsg
ICAgICAgIC5iRGV2aWNlU3ViQ2xhc3MgPSAwLAo+ICsgICAgICAgIC5iRGV2aWNlUHJvdG9jb2wg
PSAwLAo+ICsgICAgICAgIC5iTWF4UGFja2V0U2l6ZTAgPSA2NCwKPiArICAgICAgICAuaWRWZW5k
b3IgPSBDRF9ERVZfVklELAo+ICsgICAgICAgIC5pZFByb2R1Y3QgPSBDRF9ERVZfUElELAo+ICsg
ICAgICAgIC5iY2REZXZpY2UgPSAweDEwMCwKPiArICAgICAgICAuaU1hbnVmYWN0dXJlciA9IDEs
Cj4gKyAgICAgICAgLmlQcm9kdWN0ID0gMiwKPiArICAgICAgICAuaVNlcmlhbE51bWJlciA9IDMs
Cj4gKyAgICAgICAgLmJOdW1Db25maWd1cmF0aW9ucyA9IDEKPiArICAgIH07CgpTbyBhcmUgd2Ug
ZXhwZWN0aW5nIHRoZSBjYWxsZXIgdG8gYmUgYWJsZSB0byBjaGFuZ2UgdGhlc2Ugc3RhdGljIHN0
cnVjdHVyZXM/CkJvdGggZnVuY3Rpb24gZGVjbGFyYXRpb24gYW5kIGRhdGEgb25lcyBhcmUgc3Vn
Z2VzdGluZyBpdC4KCj4gKyAgICBzdGF0aWMgdWludDhfdCBjZmdbXSA9Cj4gKyAgICB7Cj4gKyAg
ICAgICAgOSwgLy9sZW4gb2YgY2ZnIGRlc2MKPiArICAgICAgICBMSUJVU0JfRFRfQ09ORklHLCAv
LyBkZXNjIHR5cGUKPiArICAgICAgICAweDIwLCAvLyB3bGVuCj4gKyAgICAgICAgMCwKPiArICAg
ICAgICAxLCAvLyBudW0gaWYKPiArICAgICAgICAxLCAvLyBjZmcgdmFsCj4gKyAgICAgICAgMCwg
Ly8gY2ZnIG5hbWUKPiArICAgICAgICAweDgwLCAvLyBidXMgcG93ZXJlZAo+ICsgICAgICAgIDB4
MzIsIC8vIDEwMCBtYQo+ICsgICAgICAgIDksIC8vIGxlbiBvZiBJRiBkZXNjCj4gKyAgICAgICAg
TElCVVNCX0RUX0lOVEVSRkFDRSwKPiArICAgICAgICAwLCAvLyBudW0gaWYKPiArICAgICAgICAw
LCAvLyBhbHQgc2V0dGluZwo+ICsgICAgICAgIDIsIC8vIG51bSBvZiBlbmRwb2ludHMKPiArICAg
ICAgICBDRF9ERVZfQ0xBU1MsCj4gKyAgICAgICAgQ0RfREVWX1NVQkNMQVNTLAo+ICsgICAgICAg
IENEX0RFVl9QUk9UT0NPTCwKPiArICAgICAgICAwLCAvLyBpZiBuYW1lCj4gKyAgICAgICAgNywK
PiArICAgICAgICBMSUJVU0JfRFRfRU5EUE9JTlQsCj4gKyAgICAgICAgMHg4MSwgLy8tPkRpcmVj
dGlvbiA6IElOIC0gRW5kcG9pbnRJRCA6IDEKPiArICAgICAgICAweDAyLCAvLy0+QnVsayBUcmFu
c2ZlciBUeXBlCj4gKyAgICAgICAgMCwgICAgLy93TWF4UGFja2V0U2l6ZSA6IDB4MDIwMCA9IDB4
MjAwIG1heCBieXRlcwo+ICsgICAgICAgIDIsCj4gKyAgICAgICAgMCwgICAgLy9iSW50ZXJ2YWwK
PiArICAgICAgICA3LAo+ICsgICAgICAgIExJQlVTQl9EVF9FTkRQT0lOVCwKPiArICAgICAgICAw
eDAyLCAvLy0+RGlyZWN0aW9uIDogT1VUIC0gRW5kcG9pbnRJRCA6IDIKPiArICAgICAgICAweDAy
LCAvLy0+QnVsayBUcmFuc2ZlciBUeXBlCj4gKyAgICAgICAgMCwgICAgLy93TWF4UGFja2V0U2l6
ZSA6IDB4MDIwMCA9IDB4MjAwIG1heCBieXRlcwo+ICsgICAgICAgIDIsCj4gKyAgICAgICAgMCwg
ICAgLy9iSW50ZXJ2YWwKPiArICAgIH07Cj4gKyAgICBzdGF0aWMgdWludDE2X3QgczBbMl0gPSB7
IDB4MzA0LCAweDQwOSB9Owo+ICsgICAgc3RhdGljIHVpbnQxNl90IHMxWzhdID0geyAweDMxMCwg
J1InLCAnZScsICdkJywgJyAnLCAnSCcsICdhJywgJ3QnIH07Cj4gKyAgICBzdGF0aWMgdWludDE2
X3QgczJbOV0gPSB7IDB4MzEyLCAnUycsICdwJywgJ2knLCAnYycsICdlJywgJyAnLCAnQycsICdE
JwoKTWlub3I6IHRoZXNlIHdpbGwgd29yayBvbmx5IG9uIGxpdHRsZSBlbmRpYW4sIG5vdCBhIGJp
ZyBpc3N1ZSBhdCB0aGUgbW9tZW50IGJ1dApJIHNhdyBvdGhlciBjb2RlIGRlYWxpbmcgd2l0aCBi
aWcgZW5kaWFuIG1hY2hpbmVzLgoKPiB9Owo+ICsKPiArICAgIHZvaWQgKnAgPSBOVUxMOwo+ICsg
ICAgdWludDE2X3QgbGVuID0gMDsKPiArCj4gKyAgICBzd2l0Y2ggKHR5cGUpCj4gKyAgICB7Cj4g
KyAgICAgICAgY2FzZSBMSUJVU0JfRFRfREVWSUNFOgo+ICsgICAgICAgICAgICBwID0gJmRlc2M7
Cj4gKyAgICAgICAgICAgIGxlbiA9IHNpemVvZihkZXNjKTsKPiArICAgICAgICAgICAgYnJlYWs7
Cj4gKyAgICAgICAgY2FzZSBMSUJVU0JfRFRfQ09ORklHOgo+ICsgICAgICAgICAgICBwID0gY2Zn
Owo+ICsgICAgICAgICAgICBsZW4gPSBzaXplb2YoY2ZnKTsKPiArICAgICAgICAgICAgYnJlYWs7
Cj4gKyAgICAgICAgY2FzZSBMSUJVU0JfRFRfU1RSSU5HOgo+ICsgICAgICAgICAgICBpZiAoaW5k
ZXggPT0gMCkgewo+ICsgICAgICAgICAgICAgICAgcCA9IHMwOyBsZW4gPSBzaXplb2YoczApOwo+
ICsgICAgICAgICAgICB9IGVsc2UgaWYgKGluZGV4ID09IDEpIHsKPiArICAgICAgICAgICAgICAg
IHAgPSBzMTsgbGVuID0gc2l6ZW9mKHMxKTsKPiArICAgICAgICAgICAgfSBlbHNlIGlmIChpbmRl
eCA9PSAyKSB7Cj4gKyAgICAgICAgICAgICAgICBwID0gczI7IGxlbiA9IHNpemVvZihzMik7Cj4g
KyAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5kZXggPT0gMykgewo+ICsgICAgICAgICAgICAgICAg
cCA9IGQtPnNlcmlhbDsgbGVuID0gc2l6ZW9mKGQtPnNlcmlhbCk7Cj4gKyAgICAgICAgICAgIH0K
PiArICAgICAgICAgICAgYnJlYWs7Cj4gKyAgICB9Cj4gKwo+ICsgICAgaWYgKHApIHsKPiArICAg
ICAgICAqYnVmZmVyID0gcDsKPiArICAgICAgICAqc2l6ZSA9IGxlbjsKPiArICAgIH0KPiArCj4g
KyAgICByZXR1cm4gcCAhPSBOVUxMOwo+ICt9Cj4gKwo+ICtzdGF0aWMgdm9pZCB1c2JfY2RfYXR0
YWNoKFVzYkNkICpkZXZpY2UsIHN0cnVjdCB1c2JyZWRpcnBhcnNlciAqcGFyc2VyKQo+ICt7Cj4g
KyAgICBkZXZpY2UtPnBhcnNlciA9IHBhcnNlcjsKPiArfQo+ICsKPiArc3RhdGljIHZvaWQgdXNi
X2NkX2RldGFjaChVc2JDZCAqZGV2aWNlKQo+ICt7Cj4gKyAgICBkZXZpY2UtPnBhcnNlciA9IE5V
TEw7Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIHVzYl9jZF9yZXNldChVc2JDZCAqZGV2aWNlKQo+
ICt7Cj4gKyAgICBjZF91c2JfYnVsa19tc2RfcmVzZXQoZGV2aWNlLT5tc2MpOwo+ICt9Cj4gKwo+
ICtzdGF0aWMgdm9pZCB1c2JfY2RfY29udHJvbF9yZXF1ZXN0KFVzYkNkICpkZXZpY2UsCj4gKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDhfdCAqZGF0YSwgaW50IGRhdGFf
bGVuLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCB1c2JfcmVk
aXJfY29udHJvbF9wYWNrZXRfaGVhZGVyCj4gKmgsCj4gKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdm9pZCAqKmJ1ZmZlcikKPiArewo+ICsgICAgdWludDhfdCByZXF0eXBlID0g
aC0+cmVxdWVzdHR5cGUgJiAweDdmOwo+ICsgICAgaWYgKCFkZXZpY2UtPm1zYykgewo+ICsgICAg
ICAgIHJldHVybjsKPiArICAgIH0KPiArICAgIGlmIChyZXF0eXBlID09IChMSUJVU0JfUkVRVUVT
VF9UWVBFX1NUQU5EQVJEIHwKPiBMSUJVU0JfUkVDSVBJRU5UX0VORFBPSU5UKSkgewo+ICsgICAg
ICAgIC8vIG1pZ2h0IGJlIGNsZWFyIHN0YWxsIHJlcXVlc3QKPiArICAgICAgICBoLT5sZW5ndGgg
PSAwOwo+ICsgICAgICAgIGgtPnN0YXR1cyA9IHVzYl9yZWRpcl9zdWNjZXNzOzsKPiArICAgICAg
ICByZXR1cm47Cj4gKyAgICB9Cj4gKwo+ICsgICAgaWYgKHJlcXR5cGUgPT0gKExJQlVTQl9SRVFV
RVNUX1RZUEVfQ0xBU1MgfCBMSUJVU0JfUkVDSVBJRU5UX0lOVEVSRkFDRSkpCj4gewo+ICsgICAg
ICAgIHN3aXRjaCAoaC0+cmVxdWVzdCkgewo+ICsgICAgICAgICAgICBjYXNlIDB4RkY6Cj4gKyAg
ICAgICAgICAgICAgICAvLyBtYXNzLXN0b3JhZ2UgY2xhc3MgcmVxdWVzdCAncmVzZXQnCj4gKyAg
ICAgICAgICAgICAgICB1c2JfY2RfcmVzZXQoZGV2aWNlKTsKPiArICAgICAgICAgICAgICAgIGgt
Pmxlbmd0aCA9IDA7Cj4gKyAgICAgICAgICAgICAgICBoLT5zdGF0dXMgPSB1c2JfcmVkaXJfc3Vj
Y2VzczsKPiArICAgICAgICAgICAgICAgIGJyZWFrOwo+ICsgICAgICAgICAgICBjYXNlIDB4RkU6
Cj4gKyAgICAgICAgICAgICAgICAvLyBtYXNzLXN0b3JhZ2UgY2xhc3MgcmVxdWVzdCAnZ2V0IG1h
eCBsdW4nCj4gKyAgICAgICAgICAgICAgICAvLyByZXR1cm5pbmcgb25lIGJ5dGUKPiArICAgICAg
ICAgICAgICAgIGlmIChoLT5sZW5ndGgpIHsKPiArICAgICAgICAgICAgICAgICAgICBoLT5sZW5n
dGggPSAxOwo+ICsgICAgICAgICAgICAgICAgICAgIGgtPnN0YXR1cyA9IHVzYl9yZWRpcl9zdWNj
ZXNzOzsKPiArICAgICAgICAgICAgICAgICAgICAqYnVmZmVyID0gJmRldmljZS0+bWF4X2x1bl9p
bmRleDsKPiArICAgICAgICAgICAgICAgIH0KPiArICAgICAgICAgICAgICAgIGJyZWFrOwo+ICsg
ICAgICAgIH0KPiArICAgIH0KPiArfQo+ICsKPiArc3RhdGljIHZvaWQgdXNiX2NkX2J1bGtfb3V0
X3JlcXVlc3QoVXNiQ2QgKmRldmljZSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgdWludDhfdCBlcCwgdWludDhfdCAqZGF0YSwgaW50IGRhdGFfbGVuLAo+ICsgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50OF90ICpzdGF0dXMpCj4gK3sKPiArICAg
IGlmICghY2RfdXNiX2J1bGtfbXNkX3dyaXRlKGRldmljZS0+bXNjLCBkYXRhLCBkYXRhX2xlbikp
IHsKPiArICAgICAgICAqc3RhdHVzID0gdXNiX3JlZGlyX3N1Y2Nlc3M7Cj4gKyAgICB9Cj4gK30K
PiArCj4gK3ZvaWQgY2RfdXNiX2J1bGtfbXNkX3JlYWRfY29tcGxldGUodm9pZCAqdXNlcl9kYXRh
LAo+ICsgICAgdWludDhfdCAqZGF0YSwgdWludDMyX3QgbGVuZ3RoLCBDZFVzYkJ1bGtTdGF0dXMg
c3RhdHVzKQo+ICt7Cj4gKyAgICBVc2JDZCAqZCA9IChVc2JDZCAqKXVzZXJfZGF0YTsKPiArCj4g
KyAgICBpZiAoZC0+ZGVsZXRpbmcpIHsKPiArICAgICAgICBkLT5kZWxldGluZyA9IEZBTFNFOwo+
ICsgICAgICAgIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9lamVjdChkLT5iYWNrZW5kLCBkLT5w
YXJlbnQpOwoKSSB3b3VsZCBwbGFjZSBhIHJldHVybiBhZnRlciB0aGlzLCB0aGUgcGFyZW50IGlz
IGRlbGV0ZWQgYW5kIHBvdGVudGlhbGx5CmFsbCB0aGlzIHN0cnVjdHVyZSB0b28uCgo+ICsgICAg
fQo+ICsKPiArICAgIGlmIChkLT5wYXJzZXIpIHsKPiArICAgICAgICBpbnQgbnJlYWQ7Cj4gKyAg
ICAgICAgdWludDMyX3Qgb2Zmc2V0ID0gMDsKPiArCj4gKyAgICAgICAgZm9yIChucmVhZCA9IDA7
IG5yZWFkIDwgZC0+bnVtX3JlYWRzOyBucmVhZCsrKSB7Cj4gKyAgICAgICAgICAgIHVpbnQzMl90
IG1heF9sZW47Cj4gKyAgICAgICAgICAgIG1heF9sZW4gPSAoZC0+cmVhZF9idWxrW25yZWFkXS5o
b3V0Lmxlbmd0aF9oaWdoIDw8IDE2KSB8Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgIGQtPnJl
YWRfYnVsa1tucmVhZF0uaG91dC5sZW5ndGg7Cj4gKyAgICAgICAgICAgIGlmIChtYXhfbGVuID4g
bGVuZ3RoKSB7Cj4gKyAgICAgICAgICAgICAgICBtYXhfbGVuID0gbGVuZ3RoOwo+ICsgICAgICAg
ICAgICAgICAgZC0+cmVhZF9idWxrW25yZWFkXS5ob3V0Lmxlbmd0aCA9IGxlbmd0aDsKPiArICAg
ICAgICAgICAgICAgIGQtPnJlYWRfYnVsa1tucmVhZF0uaG91dC5sZW5ndGhfaGlnaCA9IGxlbmd0
aCA+PiAxNjsKPiArICAgICAgICAgICAgfQo+ICsKPiArICAgICAgICAgICAgc3dpdGNoIChzdGF0
dXMpIHsKPiArICAgICAgICAgICAgY2FzZSBCVUxLX1NUQVRVU19HT09EOgo+ICsgICAgICAgICAg
ICAgICAgZC0+cmVhZF9idWxrW25yZWFkXS5ob3V0LnN0YXR1cyA9IHVzYl9yZWRpcl9zdWNjZXNz
Owo+ICsgICAgICAgICAgICAgICAgYnJlYWs7Cj4gKyAgICAgICAgICAgIGNhc2UgQlVMS19TVEFU
VVNfQ0FOQ0VMRUQ6Cj4gKyAgICAgICAgICAgICAgICBkLT5yZWFkX2J1bGtbbnJlYWRdLmhvdXQu
c3RhdHVzID0gdXNiX3JlZGlyX2NhbmNlbGxlZDsKPiArICAgICAgICAgICAgICAgIGJyZWFrOwo+
ICsgICAgICAgICAgICBjYXNlIEJVTEtfU1RBVFVTX0VSUk9SOgo+ICsgICAgICAgICAgICAgICAg
ZC0+cmVhZF9idWxrW25yZWFkXS5ob3V0LnN0YXR1cyA9IHVzYl9yZWRpcl9pb2Vycm9yOwo+ICsg
ICAgICAgICAgICAgICAgYnJlYWs7Cj4gKyAgICAgICAgICAgIGNhc2UgQlVMS19TVEFUVVNfU1RB
TEw6Cj4gKyAgICAgICAgICAgIGRlZmF1bHQ6Cj4gKyAgICAgICAgICAgICAgICBkLT5yZWFkX2J1
bGtbbnJlYWRdLmhvdXQuc3RhdHVzID0gdXNiX3JlZGlyX3N0YWxsOwo+ICsgICAgICAgICAgICAg
ICAgYnJlYWs7Cj4gKyAgICAgICAgICAgIH0KPiArCj4gKyAgICAgICAgICAgIFNQSUNFX0RFQlVH
KCIlczogcmVzcG9uZGluZyAlIiBQUkl1NjQgIiB3aXRoIGxlbiAldSBvdXQgb2YgJXUsCj4gc3Rh
dHVzICVkIiwKPiArICAgICAgICAgICAgICAgICAgICAgICAgX19GVU5DVElPTl9fLCBkLT5yZWFk
X2J1bGtbbnJlYWRdLmlkLCBtYXhfbGVuLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICBsZW5n
dGgsIGQtPnJlYWRfYnVsa1tucmVhZF0uaG91dC5zdGF0dXMpOwo+ICsgICAgICAgICAgICB1c2Jy
ZWRpcnBhcnNlcl9zZW5kX2J1bGtfcGFja2V0KGQtPnBhcnNlciwKPiBkLT5yZWFkX2J1bGtbbnJl
YWRdLmlkLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZk
LT5yZWFkX2J1bGtbbnJlYWRdLmhvdXQsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgbWF4X2xlbiA/IChkYXRhICsgb2Zmc2V0KSA6Cj4gTlVMTCwKPiArICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhfbGVuKTsKPiArICAg
ICAgICAgICAgb2Zmc2V0ICs9IG1heF9sZW47Cj4gKyAgICAgICAgICAgIGxlbmd0aCAtPSBtYXhf
bGVuOwo+ICsgICAgICAgIH0KPiArICAgICAgICBkLT5udW1fcmVhZHMgPSAwOwo+ICsgICAgICAg
IHVzYnJlZGlycGFyc2VyX2RvX3dyaXRlKGQtPnBhcnNlcik7Cj4gKwo+ICsgICAgICAgIGlmIChs
ZW5ndGgpIHsKPiArICAgICAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiBFUlJPUjogJXUgYnl0ZXMg
d2VyZSBub3QgcmVwb3J0ZWQhIiwKPiBfX0ZVTkNUSU9OX18sIGxlbmd0aCk7Cj4gKyAgICAgICAg
fQo+ICsKPiArICAgIH0gZWxzZSB7Cj4gKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiBicm9rZW4g
ZGV2aWNlPC0+Y2hhbm5lbCByZWxhdGlvbnNoaXAhIiwKPiBfX0ZVTkNUSU9OX18pOwo+ICsgICAg
fQo+ICt9Cj4gKwo+ICsvKiBkZXZpY2UgcmVzZXQgY29tcGxldGlvbiBjYWxsYmFjayAqLwo+ICt2
b2lkIGNkX3VzYl9idWxrX21zZF9yZXNldF9jb21wbGV0ZSh2b2lkICp1c2VyX2RhdGEsIGludCBz
dGF0dXMpCj4gK3sKPiArICAgIC8vIFVzYkNkICpkID0gKFVzYkNkICopdXNlcl9kYXRhOwo+ICt9
Cj4gKwo+ICtzdGF0aWMgZ2Jvb2xlYW4gdXNiX2NkX2J1bGtfaW5fcmVxdWVzdChVc2JDZCAqZCwg
dWludDY0X3QgaWQsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0
IHVzYl9yZWRpcl9idWxrX3BhY2tldF9oZWFkZXIgKmgpCj4gK3sKPiArICAgIGludCByZXM7Cj4g
KyAgICB1aW50MzJfdCBsZW4gPSAoaC0+bGVuZ3RoX2hpZ2ggPDwgMTYpIHwgaC0+bGVuZ3RoOwo+
ICsgICAgaWYgKGQtPm51bV9yZWFkcyA+PSBNQVhfQlVMS19JTl9SRVFVRVNUUykgewo+ICsgICAg
ICAgIGgtPmxlbmd0aCA9IGgtPmxlbmd0aF9oaWdoID0gMDsKPiArICAgICAgICBTUElDRV9ERUJV
RygiJXM6IHRvbyBtYW55IHBlbmRpbmcgcmVhZHMiLCBfX0ZVTkNUSU9OX18pOwo+ICsgICAgICAg
IGgtPnN0YXR1cyA9IHVzYl9yZWRpcl9iYWJibGU7Cj4gKyAgICAgICAgcmV0dXJuIEZBTFNFOwo+
ICsgICAgfQo+ICsKPiArICAgIGlmIChkLT5udW1fcmVhZHMpIHsKPiArICAgICAgICBTUElDRV9E
RUJVRygiJXM6IGFscmVhZHkgaGFzICV1IHBlbmRpbmcgcmVhZHMiLCBfX0ZVTkNUSU9OX18sCj4g
ZC0+bnVtX3JlYWRzKTsKPiArICAgIH0KPiArCj4gKyAgICBkLT5yZWFkX2J1bGtbZC0+bnVtX3Jl
YWRzXS5ob3V0ID0gKmg7Cj4gKyAgICBkLT5yZWFkX2J1bGtbZC0+bnVtX3JlYWRzXS5pZCA9IGlk
Owo+ICsgICAgZC0+bnVtX3JlYWRzKys7Cj4gKyAgICByZXMgPSBjZF91c2JfYnVsa19tc2RfcmVh
ZChkLT5tc2MsIGxlbik7Cj4gKyAgICBpZiAoIXJlcykgewo+ICsgICAgICAgIHJldHVybiBUUlVF
Owo+ICsgICAgfQo+ICsKPiArICAgIFNQSUNFX0RFQlVHKCIlczogZXJyb3Igb24gYnVsayByZWFk
IiwgX19GVU5DVElPTl9fKTsKPiArICAgIGQtPm51bV9yZWFkcy0tOwo+ICsgICAgaC0+bGVuZ3Ro
ID0gaC0+bGVuZ3RoX2hpZ2ggPSAwOwo+ICsgICAgaC0+c3RhdHVzID0gdXNiX3JlZGlyX2lvZXJy
b3I7Cj4gKwo+ICsgICAgcmV0dXJuIEZBTFNFOwo+ICt9Cj4gKwo+ICtzdGF0aWMgdm9pZCB1c2Jf
Y2RfY2FuY2VsX3JlcXVlc3QoVXNiQ2QgKmQsIHVpbnQ2NF90IGlkKQo+ICt7Cj4gKyAgICB1aW50
MzJfdCBucmVhZDsKPiArCj4gKyAgICBmb3IgKG5yZWFkID0gMDsgbnJlYWQgPCBkLT5udW1fcmVh
ZHM7IG5yZWFkKyspIHsKPiArICAgICAgICBpZiAoZC0+cmVhZF9idWxrW25yZWFkXS5pZCA9PSBp
ZCkgewo+ICsgICAgICAgICAgICBpZiAoY2RfdXNiX2J1bGtfbXNkX2NhbmNlbF9yZWFkKGQtPm1z
YykpIHsKPiArICAgICAgICAgICAgICAgIGNkX3VzYl9idWxrX21zZF9yZWFkX2NvbXBsZXRlKGQs
IE5VTEwsIDAsCj4gQlVMS19TVEFUVVNfQ0FOQ0VMRUQpOwo+ICsgICAgICAgICAgICB9Cj4gKyAg
ICAgICAgICAgIHJldHVybjsKPiArICAgICAgICB9Cj4gKyAgICB9Cj4gKyAgICBTUElDRV9ERUJV
RygiJXM6IEVSUk9SOiBubyBzdWNoIGlkIHRvIGNhbmNlbCEiLCBfX0ZVTkNUSU9OX18pOwo+ICt9
Cj4gKwo+ICsvLyBjYWxsZWQgd2hlbiBhIGNoYW5nZSBoYXBwZW5zIG9uIFNDU0kgbGF5ZXIKPiAr
dm9pZCBjZF91c2JfYnVsa19tc2RfbHVuX2NoYW5nZWQodm9pZCAqdXNlcl9kYXRhLCB1aW50MzJf
dCBsdW4pCj4gK3sKPiArICAgIFVzYkNkICpkID0gKFVzYkNkICopdXNlcl9kYXRhOwo+ICsgICAg
Q2RTY3NpRGV2aWNlSW5mbyBjZF9pbmZvOwo+ICsKPiArICAgIGlmICghY2RfdXNiX2J1bGtfbXNk
X2dldF9pbmZvKGQtPm1zYywgbHVuLCAmY2RfaW5mbykpIHsKPiArICAgICAgICAvLyBsb2FkIG9y
IHVubG9hZCBjb21tYW5kIHJlY2VpdmVkIGZyb20gU0NTSQo+ICsgICAgICAgIGlmIChkLT51bml0
c1tsdW5dLmxvYWRlZCAhPSBjZF9pbmZvLmxvYWRlZCkgewo+ICsgICAgICAgICAgICBpZiAoIWxv
YWRfbHVuKGQsIGx1biwgY2RfaW5mby5sb2FkZWQpKSB7Cj4gKyAgICAgICAgICAgICAgICBTUElD
RV9ERUJVRygiJXM6IGxvYWQgZmFpbGVkLCB1bmxvYWRpbmcgdW5pdCIsCj4gX19GVU5DVElPTl9f
KTsKPiArICAgICAgICAgICAgICAgIGNkX3VzYl9idWxrX21zZF91bmxvYWQoZC0+bXNjLCBsdW4p
Owo+ICsgICAgICAgICAgICB9Cj4gKyAgICAgICAgfQo+ICsgICAgfQo+ICsKPiArICAgIGlmIChk
LT5kZWxldGVfb25fZWplY3QpIHsKPiArICAgICAgICBkLT5kZWxldGVfb25fZWplY3QgPSBGQUxT
RTsKPiArICAgICAgICBkLT5kZWxldGluZyA9IFRSVUU7Cj4gKyAgICB9IGVsc2Ugewo+ICsgICAg
ICAgIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9yZXBvcnRfY2hhbmdlKGQtPmJhY2tlbmQsIGQt
PnBhcmVudCk7Cj4gKyAgICB9Cj4gK30KPiArCj4gK3N0YXRpYyBnY2hhciAqdXNiX2NkX2dldF9w
cm9kdWN0X2Rlc2NyaXB0aW9uKFVzYkNkICpkZXZpY2UpCj4gK3sKPiArICAgIGdjaGFyICpiYXNl
X25hbWUgPSBnX3BhdGhfZ2V0X2Jhc2VuYW1lKGRldmljZS0+dW5pdHNbMF0uZmlsZW5hbWUpOwo+
ICsgICAgZ2NoYXIgKnJlcyA9IGdfc3RyZHVwX3ByaW50ZigiU1BJQ0UgQ0QoJXMpIiwgYmFzZV9u
YW1lKTsKCk1heWJlIGxlYXZlIGEgc3BhY2UgYmV0d2VlbiAiU1BJQ0UgQ0QiIGFuZCB0aGUgZmls
ZSBuYW1lPwpPbiB0aGUgR1VJIGRvZXMgbm90IGFwcGVhciB0aGF0IGdyZWF0IHdpdGhvdXQuCgo+
ICsgICAgZ19mcmVlKGJhc2VfbmFtZSk7Cj4gKyAgICByZXR1cm4gcmVzOwo+ICt9Cj4gKwo+ICtz
dGF0aWMgY29uc3QgVXNiRGV2aWNlT3BzIGRldm9wcyA9Cj4gK3sKPiArICAgIC5nZXRfZGVzY3Jp
cHRvciA9IHVzYl9jZF9nZXRfZGVzY3JpcHRvciwKPiArICAgIC5nZXRfcHJvZHVjdF9kZXNjcmlw
dGlvbiA9IHVzYl9jZF9nZXRfcHJvZHVjdF9kZXNjcmlwdGlvbiwKPiArICAgIC5hdHRhY2ggPSB1
c2JfY2RfYXR0YWNoLAo+ICsgICAgLnJlc2V0ID0gdXNiX2NkX3Jlc2V0LAo+ICsgICAgLmRldGFj
aCA9IHVzYl9jZF9kZXRhY2gsCj4gKyAgICAuY29udHJvbF9yZXF1ZXN0ID0gdXNiX2NkX2NvbnRy
b2xfcmVxdWVzdCwKPiArICAgIC5idWxrX291dF9yZXF1ZXN0ID0gdXNiX2NkX2J1bGtfb3V0X3Jl
cXVlc3QsCj4gKyAgICAuYnVsa19pbl9yZXF1ZXN0ID0gdXNiX2NkX2J1bGtfaW5fcmVxdWVzdCwK
PiArICAgIC5jYW5jZWxfcmVxdWVzdCA9IHVzYl9jZF9jYW5jZWxfcmVxdWVzdCwKPiArICAgIC5k
ZWxldGUgPSB1c2JfY2RfZGVsZXRlLAo+ICt9Owo+ICsKPiArc3RhdGljIGludCB1c2JfY2RfY3Jl
YXRlKFNwaWNlVXNiQmFja2VuZCAqYmUsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICBTcGlj
ZVVzYkJhY2tlbmREZXZpY2UgKnBhcmVudCwKPiArICAgICAgICAgICAgICAgICAgICAgICAgIFVz
YkNyZWF0ZURldmljZVBhcmFtZXRlcnMgKnBhcmFtLAo+ICsgICAgICAgICAgICAgICAgICAgICAg
ICAgVXNiQ2QgKipkZXYpCj4gK3sKPiArICAgIGludCBlcnJvciA9IDA7CgpJcyB0aGlzIHJlc3Vs
dCB2YWx1ZSB1c2VkIG9yIHBsYW5uZWQgdG8gYmUgdXNlZD8gTG9va3MgbGlrZSB3ZSB1c2UKKGFu
ZCB0aGUgY2FsbGVyIHRvbykgbGlrZSBhIGJvb2xlYW4uCgo+ICsgICAgdWludDMyX3QgdW5pdCA9
IDA7CgpUaGlzIGlzIHRoZSBvdGhlciAidW5pdCIgY29uc3RhbnQgc2V0IHRvIDAgKGNvbW1lbnQg
YWJvdmUpLgoKPiArICAgIFVzYkNkICpkID0gZ19uZXcwKFVzYkNkLCAxKTsKPiArICAgIENkU2Nz
aURldmljZVBhcmFtZXRlcnMgZGV2X3BhcmFtcyA9IHsgMCB9Owo+ICsKPiArICAgIGQtPmRldl9v
cHMgPSBkZXZvcHM7Cj4gKyAgICBkLT5iYWNrZW5kID0gYmU7Cj4gKyAgICBkLT5wYXJlbnQgID0g
cGFyZW50Owo+ICsgICAgZC0+ZGVsZXRlX29uX2VqZWN0ID0gISFwYXJhbS0+ZGV2aWNlX3BhcmFt
LmNyZWF0ZV9jZC5kZWxldGVfb25fZWplY3Q7Cj4gKyAgICBkLT5sb2NrZWQgPSAhZC0+ZGVsZXRl
X29uX2VqZWN0Owo+ICsgICAgZC0+c2VyaWFsWzBdID0gMHgwMzA4Owo+ICsgICAgZC0+c2VyaWFs
WzFdID0gJ1gnOwoKU3BlY2lmaWNhdGlvbnMgc3RhdGUgdGhhdCB2YWx1ZSBjaGFyYWN0ZXJzIGFy
ZSAwLTkgYW5kIEEtRiAoY2FwaXRhbCBjYXNlCmhleGFkZWNpbWFsLCB5ZXMgcXVpdGUgYSB3YXN0
ZSBvZiBzcGFjZSBJIHdvdWxkIHNheSkuCgo+ICsgICAgZC0+c2VyaWFsWzJdID0gJzAnICsgcGFy
YW0tPmFkZHJlc3MgLyAxMDsKPiArICAgIGQtPnNlcmlhbFszXSA9ICcwJyArIHBhcmFtLT5hZGRy
ZXNzICUgMTA7Cj4gKyAgICBkLT5tYXhfbHVuX2luZGV4ID0gTUFYX0xVTl9QRVJfREVWSUNFIC0g
MTsKPiArCj4gKyAgICBkZXZfcGFyYW1zLnZlbmRvciA9ICJTUElDRSI7Cj4gKyAgICBkZXZfcGFy
YW1zLnByb2R1Y3QgPSAic2hhcmVkIENEIjsKCldoeSBub3QgIlJlZCBIYXQiIGFuZCAiU1BJQ0Ug
Q0QiIGV2ZW4gaGVyZT8KCj4gKyAgICBkZXZfcGFyYW1zLnZlcnNpb24gPSAiMCI7Cj4gKwo+ICsg
ICAgZC0+bXNjID0gY2RfdXNiX2J1bGtfbXNkX2FsbG9jKGQsIE1BWF9MVU5fUEVSX0RFVklDRSk7
Cj4gKyAgICBpZiAoIWQtPm1zYykgewo+ICsgICAgICAgIGdfY2xlYXJfcG9pbnRlcigmZCwgZ19m
cmVlKTsKPiArICAgICAgICBwYXJhbS0+ZXJyb3IgPSBnX2Vycm9yX25ldyhTUElDRV9DTElFTlRf
RVJST1IsCj4gU1BJQ0VfQ0xJRU5UX0VSUk9SX0ZBSUxFRCwKPiArICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBfKCJjYW4ndCBhbGxvY2F0ZSBkZXZpY2UiKSk7Cj4gKyAgICAgICAg
cmV0dXJuIDE7Cj4gKyAgICB9Cj4gKyAgICBkLT51bml0c1t1bml0XS5ibG9ja1NpemUgPSBDRF9E
RVZfQkxPQ0tfU0laRTsKPiArICAgIGlmICghY2RfdXNiX2J1bGtfbXNkX3JlYWxpemUoZC0+bXNj
LCB1bml0LCAmZGV2X3BhcmFtcykpIHsKPiArICAgICAgICBpZiAob3Blbl9zdHJlYW0oJmQtPnVu
aXRzW3VuaXRdLAo+IHBhcmFtLT5kZXZpY2VfcGFyYW0uY3JlYXRlX2NkLmZpbGVuYW1lKSAmJgo+
ICsgICAgICAgICAgICBsb2FkX2x1bihkLCB1bml0LCBUUlVFKSkgewo+ICsgICAgICAgICAgICBp
ZiAoZC0+bG9ja2VkKSB7Cj4gKyAgICAgICAgICAgICAgICBjZF91c2JfYnVsa19tc2RfbG9jayhk
LT5tc2MsIHVuaXQsIFRSVUUpOwo+ICsgICAgICAgICAgICB9Cj4gKyAgICAgICAgfSBlbHNlIHsK
PiArICAgICAgICAgICAgY2xvc2Vfc3RyZWFtKCZkLT51bml0c1t1bml0XSk7Cj4gKyAgICAgICAg
ICAgIGNkX3VzYl9idWxrX21zZF91bnJlYWxpemUoZC0+bXNjLCB1bml0KTsKPiArICAgICAgICAg
ICAgcGFyYW0tPmVycm9yID0gZ19lcnJvcl9uZXcoU1BJQ0VfQ0xJRU5UX0VSUk9SLAo+IFNQSUNF
X0NMSUVOVF9FUlJPUl9GQUlMRUQsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIF8oImNhbid0IGNyZWF0ZSBkZXZpY2Ugd2l0aCAlcyIpLAo+ICsKPiBwYXJhbS0+ZGV2
aWNlX3BhcmFtLmNyZWF0ZV9jZC5maWxlbmFtZSk7Cj4gKyAgICAgICAgICAgIGVycm9yID0gMzsK
PiArICAgICAgICB9Cj4gKyAgICB9IGVsc2Ugewo+ICsgICAgICAgIGVycm9yID0gMjsKPiArICAg
ICAgICBwYXJhbS0+ZXJyb3IgPSBnX2Vycm9yX25ldyhTUElDRV9DTElFTlRfRVJST1IsCj4gU1BJ
Q0VfQ0xJRU5UX0VSUk9SX0ZBSUxFRCwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBfKCJjYW4ndCBhbGxvY2F0ZSBkZXZpY2UiKSk7Cj4gKyAgICB9Cj4gKyAgICBpZiAoZXJy
b3IpIHsKPiArICAgICAgICBnX2NsZWFyX3BvaW50ZXIoJmQtPm1zYywgY2RfdXNiX2J1bGtfbXNk
X2ZyZWUpOwo+ICsgICAgICAgIGdfY2xlYXJfcG9pbnRlcigmZCwgZ19mcmVlKTsKPiArICAgIH0K
PiArCj4gKyAgICAqZGV2ID0gZDsKPiArICAgIHJldHVybiBlcnJvcjsKPiArfQo+ICsKPiArdm9p
ZCBzcGljZV91c2JfZGV2aWNlX3JlZ2lzdGVyX2NkKFNwaWNlVXNiQmFja2VuZCAqYmUpCj4gK3sK
PiArICAgIHNwaWNlX3VzYl9iYWNrZW5kX3JlZ2lzdGVyX2RldmljZV90eXBlKGJlLCBVU0JfREVW
X1RZUEVfQ0QsCj4gdXNiX2NkX2NyZWF0ZSk7Cj4gK30KPiArCj4gKyNlbmRpZiAvKiBVU0VfVVNC
UkVESVIgKi8KCkJ5IHRoZSB3YXksIHByZXBhcmluZyBzb21lIGZvbGxvdyB1cHMuCgpGcmVkaWFu
bwpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpTcGljZS1k
ZXZlbCBtYWlsaW5nIGxpc3QKU3BpY2UtZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vc3BpY2UtZGV2ZWw=
