Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8EA6FB7BCA
	for <lists+spice-devel@lfdr.de>; Thu, 19 Sep 2019 16:11:43 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id AB10E6F894;
	Thu, 19 Sep 2019 14:11:41 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 40D656F894
 for <spice-devel@lists.freedesktop.org>; Thu, 19 Sep 2019 14:11:40 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx06.intmail.prod.int.phx2.redhat.com
 [10.5.11.16])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id D970A309BDA2
 for <spice-devel@lists.freedesktop.org>; Thu, 19 Sep 2019 14:11:39 +0000 (UTC)
Received: from wingsuit.mxp.redhat.com (unknown [10.32.181.155])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 644EC5C1B5
 for <spice-devel@lists.freedesktop.org>; Thu, 19 Sep 2019 14:11:39 +0000 (UTC)
From: Victor Toso <victortoso@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Thu, 19 Sep 2019 16:11:20 +0200
Message-Id: <20190919141133.10691-8-victortoso@redhat.com>
In-Reply-To: <20190919141133.10691-1-victortoso@redhat.com>
References: <20190919141133.10691-1-victortoso@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.16
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.45]); Thu, 19 Sep 2019 14:11:39 +0000 (UTC)
Subject: [Spice-devel] [PATCH v8 07/20] usb-backend: include usbredirparser
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogWXVyaSBCZW5kaXRvdmljaCA8eXVyaS5iZW5kaXRvdmljaEBkYXluaXguY29tPgoKVGhp
cyBwYXRjaCBpbnRyb2R1Y2VzIHRoZSB1c2FnZSBvZiB1c2JyZWRpcnBhcnNlciBpbgpTcGljZVVz
YkJhY2tlbmRDaGFubmVsLgoKVGhlIGZvY3VzIG9mIHRoaXMgcGF0Y2ggaXMgdG8gdGhlIGNvZGUg
cGF0aCBvZiByZWFsIGRldmljZXMuIEFzIHdlCmRvbid0IGtub3cgYmVmb3JlaGFuZCBpZiBhIFNw
aWNlVXNiQmFja2VuZENoYW5uZWwgd2lsbCBiZSB1c2VkIGJ5IHJlYWwKb3IgZW11bGF0ZWQgZGV2
aWNlcywgYW4gaW5zdGFuY2Ugb2YgdXNicmVkaXJwYXJzZXIgbXVzdCBiZSBpbml0aWFsaXplZAp3
aXRoIHRoZSB1c2JyZWRpcmhvc3QncyBmaXJzdCBoZWxsbyBtZXNzYWdlLgoKVGhpcyBpcyBhIG11
c3QgdG8gdGhlIGN1cnJlbnQgZGVzaWduIG9uIHN1cHBvcnRpbmcgZW11bGF0ZWQgZGV2aWNlcy4K
VGhpcyB3aWxsIGJlIGV4dGVuZGVkIGluIHRoZSBuZXh0IHBhdGNoIHRvIG1hdGNoIHJlbW90ZSdz
IHVzYnJlZGlyaG9zdApjYXBhYmlsaXRpZXMgYW5kIHByb3ZpZGluZyBzdXBwb3J0IHRvIGVtdWxh
dGVkIGRldmljZXMuCgpTaWduZWQtb2ZmLWJ5OiBZdXJpIEJlbmRpdG92aWNoIDx5dXJpLmJlbmRp
dG92aWNoQGRheW5peC5jb20+ClNpZ25lZC1vZmYtYnk6IEZyZWRpYW5vIFppZ2xpbyA8ZnppZ2xp
b0ByZWRoYXQuY29tPgpTaWduZWQtb2ZmLWJ5OiBWaWN0b3IgVG9zbyA8dmljdG9ydG9zb0ByZWRo
YXQuY29tPgotLS0KIHNyYy91c2ItYmFja2VuZC5jIHwgMjIzICsrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrLS0KIDEgZmlsZSBjaGFuZ2VkLCAyMTggaW5zZXJ0aW9u
cygrKSwgNSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9zcmMvdXNiLWJhY2tlbmQuYyBiL3Ny
Yy91c2ItYmFja2VuZC5jCmluZGV4IGM0ZDhlMjAuLjE2OWYxYjAgMTAwNjQ0Ci0tLSBhL3NyYy91
c2ItYmFja2VuZC5jCisrKyBiL3NyYy91c2ItYmFja2VuZC5jCkBAIC00NSw2ICs0NSw3IEBACiAj
aW5jbHVkZSAidXNidXRpbC5oIgogCiAjZGVmaW5lIExPVURfREVCVUcoeCwgLi4uKQorI2RlZmlu
ZSBVU0JSRURJUl9DQUxMQkFDS19OT1RfSU1QTEVNRU5URUQoKSBzcGljZV9kZWJ1ZygiJXMgbm90
IGltcGxlbWVudGVkIC0gRklYTUUiLCBfX2Z1bmNfXykKIAogc3RydWN0IF9TcGljZVVzYkRldmlj
ZQogewpAQCAtODIsNiArODMsNyBAQCBzdHJ1Y3QgX1NwaWNlVXNiQmFja2VuZAogc3RydWN0IF9T
cGljZVVzYkJhY2tlbmRDaGFubmVsCiB7CiAgICAgc3RydWN0IHVzYnJlZGlyaG9zdCAqdXNicmVk
aXJob3N0OworICAgIHN0cnVjdCB1c2JyZWRpcnBhcnNlciAqcGFyc2VyOwogICAgIHVpbnQ4X3Qg
KnJlYWRfYnVmOwogICAgIGludCByZWFkX2J1Zl9zaXplOwogICAgIHN0cnVjdCB1c2JyZWRpcmZp
bHRlcl9ydWxlICpydWxlczsKQEAgLTYzMSwxMSArNjMzLDQ4IEBAIHN0YXRpYyB2b2lkIHVzYnJl
ZGlyX2xvZyh2b2lkICp1c2VyX2RhdGEsIGludCBsZXZlbCwgY29uc3QgY2hhciAqbXNnKQogICAg
IH0KIH0KIAorc3RhdGljIHN0cnVjdCB1c2JyZWRpcnBhcnNlciAqY3JlYXRlX3BhcnNlcihTcGlj
ZVVzYkJhY2tlbmRDaGFubmVsICpjaCk7CisKIHN0YXRpYyBpbnQgdXNicmVkaXJfd3JpdGVfY2Fs
bGJhY2sodm9pZCAqdXNlcl9kYXRhLCB1aW50OF90ICpkYXRhLCBpbnQgY291bnQpCiB7CiAgICAg
U3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSB1c2VyX2RhdGE7CiAgICAgaW50IHJlczsKICAg
ICBTUElDRV9ERUJVRygiJXMgY2ggJXAsICVkIGJ5dGVzIiwgX19GVU5DVElPTl9fLCBjaCwgY291
bnQpOworCisgICAgLy8gaGFuZGxlIGZpcnN0IHBhY2tldCAoSEVMTE8pIGNyZWF0aW5nIHBhcnNl
ciBmcm9tIGNhcGFiaWxpdGllcworICAgIGlmIChTUElDRV9VTkxJS0VMWShjaC0+cGFyc2VyID09
IE5VTEwpKSB7CisgICAgICAgIC8vIEhlcmUgd2UgcmV0dXJuIDAgZnJvbSB0aGlzIGZ1bmN0aW9u
IHRvIGtlZXAgdGhlIHBhY2tldCBpbgorICAgICAgICAvLyB0aGUgcXVldWUuIFRoZSBwYWNrZXQg
d2lsbCB0aGVuIGJlIHNlbnQgdG8gdGhlIGd1ZXN0LgorICAgICAgICAvLyBXZSBhcmUgaW5pdGlh
bGl6aW5nIFNwaWNlVXNiQmFja2VuZENoYW5uZWwsIHRoZQorICAgICAgICAvLyBTcGljZVVzYnJl
ZGlyQ2hhbm5lbCBpcyBub3QgcmVhZHkgdG8gcmVjZWl2ZSBwYWNrZXRzLgorCisgICAgICAgIC8v
IHdlIGFyZSBzdGlsbCBpbml0aWFsaXppbmcgdGhlIGhvc3QKKyAgICAgICAgaWYgKGNoLT51c2Jy
ZWRpcmhvc3QgPT0gTlVMTCkgeworICAgICAgICAgICAgcmV0dXJuIDA7CisgICAgICAgIH0KKwor
ICAgICAgICBjaC0+cGFyc2VyID0gY3JlYXRlX3BhcnNlcihjaCk7CisgICAgICAgIGlmICghY2gt
PnBhcnNlcikgeworICAgICAgICAgICAgcmV0dXJuIDA7CisgICAgICAgIH0KKworICAgICAgICAv
KiBoZWxsbyBpcyBzaG9ydCBoZWFkZXIgKDEyKSArIGhlbGxvIHN0cnVjdCAoNjQpICovCisgICAg
ICAgIGNvbnN0IGludCBoZWxsb19zaXplID0gMTIgKyBzaXplb2Yoc3RydWN0IHVzYl9yZWRpcl9o
ZWxsb19oZWFkZXIpOworICAgICAgICBnX2Fzc2VydChjb3VudCA+PSBoZWxsb19zaXplICsgNCk7
CisgICAgICAgIGdfYXNzZXJ0KFNQSUNFX0FMSUdORURfQ0FTVChzdHJ1Y3QgdXNiX3JlZGlyX2hl
YWRlciAqLCBkYXRhKS0+dHlwZSA9PSB1c2JfcmVkaXJfaGVsbG8pOworCisgICAgICAgIGNvbnN0
IHVpbnQzMl90IGZsYWdzID0KKyAgICAgICAgICAgIHVzYnJlZGlycGFyc2VyX2ZsX3dyaXRlX2Ni
X293bnNfYnVmZmVyIHwgdXNicmVkaXJwYXJzZXJfZmxfdXNiX2hvc3QgfAorICAgICAgICAgICAg
dXNicmVkaXJwYXJzZXJfZmxfbm9faGVsbG87CisKKyAgICAgICAgdXNicmVkaXJwYXJzZXJfaW5p
dChjaC0+cGFyc2VyLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBBQ0tBR0VfU1RSSU5H
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNQSUNFX0FMSUdORURfQ0FTVCh1aW50MzJf
dCAqLCBkYXRhICsgaGVsbG9fc2l6ZSksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNv
dW50IC0gaGVsbG9fc2l6ZSkgLyBzaXplb2YodWludDMyX3QpLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGZsYWdzKTsKKworICAgICAgICByZXR1cm4gMDsKKyAgICB9CiAgICAgcmVzID0g
c3BpY2VfdXNicmVkaXJfd3JpdGUoY2gtPnVzYnJlZGlyX2NoYW5uZWwsIGRhdGEsIGNvdW50KTsK
ICAgICByZXR1cm4gcmVzOwogfQpAQCAtNzAyLDYgKzc0MSwxNjUgQEAgR0Vycm9yICpzcGljZV91
c2JfYmFja2VuZF9nZXRfZXJyb3JfZGV0YWlscyhpbnQgZXJyb3JfY29kZSwgZ2NoYXIgKmRlc2Mp
CiAgICAgcmV0dXJuIGVycjsKIH0KIAorc3RhdGljIHZvaWQKK3VzYnJlZGlyX2NvbnRyb2xfcGFj
a2V0KHZvaWQgKnByaXYsIHVpbnQ2NF90IGlkLCBzdHJ1Y3QgdXNiX3JlZGlyX2NvbnRyb2xfcGFj
a2V0X2hlYWRlciAqaCwKKyAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ4X3QgKmRhdGEsIGlu
dCBkYXRhX2xlbikKK3sKKyAgICBVU0JSRURJUl9DQUxMQkFDS19OT1RfSU1QTEVNRU5URUQoKTsK
K30KKworc3RhdGljIHZvaWQKK3VzYnJlZGlyX2J1bGtfcGFja2V0KHZvaWQgKnByaXYsIHVpbnQ2
NF90IGlkLCBzdHJ1Y3QgdXNiX3JlZGlyX2J1bGtfcGFja2V0X2hlYWRlciAqaCwKKyAgICAgICAg
ICAgICAgICAgICAgIHVpbnQ4X3QgKmRhdGEsIGludCBkYXRhX2xlbikKK3sKKyAgICBVU0JSRURJ
Ul9DQUxMQkFDS19OT1RfSU1QTEVNRU5URUQoKTsKK30KKworc3RhdGljIHZvaWQgdXNicmVkaXJf
ZGV2aWNlX3Jlc2V0KHZvaWQgKnByaXYpCit7CisgICAgVVNCUkVESVJfQ0FMTEJBQ0tfTk9UX0lN
UExFTUVOVEVEKCk7Cit9CisKK3N0YXRpYyB2b2lkCit1c2JyZWRpcl9pbnRlcmZhY2VfaW5mbyh2
b2lkICpwcml2LCBzdHJ1Y3QgdXNiX3JlZGlyX2ludGVyZmFjZV9pbmZvX2hlYWRlciAqaW50ZXJm
YWNlX2luZm8pCit7CisgICAgVVNCUkVESVJfQ0FMTEJBQ0tfTk9UX0lNUExFTUVOVEVEKCk7Cit9
CisKK3N0YXRpYyB2b2lkCit1c2JyZWRpcl9pbnRlcmZhY2VfZXBfaW5mbyh2b2lkICpwcml2LCBz
dHJ1Y3QgdXNiX3JlZGlyX2VwX2luZm9faGVhZGVyICplcF9pbmZvKQoreworICAgIFVTQlJFRElS
X0NBTExCQUNLX05PVF9JTVBMRU1FTlRFRCgpOworfQorCitzdGF0aWMgdm9pZAordXNicmVkaXJf
c2V0X2NvbmZpZ3VyYXRpb24odm9pZCAqcHJpdiwgdWludDY0X3QgaWQsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICBzdHJ1Y3QgdXNiX3JlZGlyX3NldF9jb25maWd1cmF0aW9uX2hlYWRlciAq
c2V0X2NvbmZpZ3VyYXRpb24pCit7CisgICAgVVNCUkVESVJfQ0FMTEJBQ0tfTk9UX0lNUExFTUVO
VEVEKCk7Cit9CisKK3N0YXRpYyB2b2lkIHVzYnJlZGlyX2dldF9jb25maWd1cmF0aW9uKHZvaWQg
KnByaXYsIHVpbnQ2NF90IGlkKQoreworICAgIFVTQlJFRElSX0NBTExCQUNLX05PVF9JTVBMRU1F
TlRFRCgpOworfQorCitzdGF0aWMgdm9pZAordXNicmVkaXJfc2V0X2FsdF9zZXR0aW5nKHZvaWQg
KnByaXYsIHVpbnQ2NF90IGlkLCBzdHJ1Y3QgdXNiX3JlZGlyX3NldF9hbHRfc2V0dGluZ19oZWFk
ZXIgKnMpCit7CisgICAgVVNCUkVESVJfQ0FMTEJBQ0tfTk9UX0lNUExFTUVOVEVEKCk7Cit9CisK
K3N0YXRpYyB2b2lkCit1c2JyZWRpcl9nZXRfYWx0X3NldHRpbmcodm9pZCAqcHJpdiwgdWludDY0
X3QgaWQsIHN0cnVjdCB1c2JfcmVkaXJfZ2V0X2FsdF9zZXR0aW5nX2hlYWRlciAqcykKK3sKKyAg
ICBVU0JSRURJUl9DQUxMQkFDS19OT1RfSU1QTEVNRU5URUQoKTsKK30KKworc3RhdGljIHZvaWQg
dXNicmVkaXJfY2FuY2VsX2RhdGEodm9pZCAqcHJpdiwgdWludDY0X3QgaWQpCit7CisgICAgVVNC
UkVESVJfQ0FMTEJBQ0tfTk9UX0lNUExFTUVOVEVEKCk7Cit9CisKK3N0YXRpYyB2b2lkIHVzYnJl
ZGlyX2ZpbHRlcl9yZWplY3Qodm9pZCAqcHJpdikKK3sKKyAgICBVU0JSRURJUl9DQUxMQkFDS19O
T1RfSU1QTEVNRU5URUQoKTsKK30KKworLyogTm90ZSB0aGF0IHRoZSBvd25lcnNoaXAgb2YgdGhl
IHJ1bGVzIGFycmF5IGlzIHBhc3NlZCBvbiB0byB0aGUgY2FsbGJhY2suICovCitzdGF0aWMgdm9p
ZAordXNicmVkaXJfZmlsdGVyX2ZpbHRlcih2b2lkICpwcml2LCBzdHJ1Y3QgdXNicmVkaXJmaWx0
ZXJfcnVsZSAqciwgaW50IGNvdW50KQoreworICAgIFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNo
ID0gcHJpdjsKKyAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAgJWQgZmlsdGVycyIsIF9fRlVOQ1RJ
T05fXywgY2gsIGNvdW50KTsKKworICAgIGZyZWUoY2gtPnJ1bGVzKTsKKyAgICBjaC0+cnVsZXMg
PSByOworICAgIGNoLT5ydWxlc19jb3VudCA9IGNvdW50OworICAgIGlmIChjb3VudCkgeworICAg
ICAgICBpbnQgaTsKKyAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKKyAgICAg
ICAgICAgIFNQSUNFX0RFQlVHKCIlcyBjbGFzcyAlZCwgJVg6JVgiLAorICAgICAgICAgICAgICAg
IHJbaV0uYWxsb3cgPyAiYWxsb3dlZCIgOiAiZGVuaWVkIiwgcltpXS5kZXZpY2VfY2xhc3MsCisg
ICAgICAgICAgICAgICAgKHVpbnQzMl90KXJbaV0udmVuZG9yX2lkLCAodWludDMyX3QpcltpXS5w
cm9kdWN0X2lkKTsKKyAgICAgICAgfQorICAgIH0KK30KKworc3RhdGljIHZvaWQgdXNicmVkaXJf
ZGV2aWNlX2Rpc2Nvbm5lY3RfYWNrKHZvaWQgKnByaXYpCit7CisgICAgVVNCUkVESVJfQ0FMTEJB
Q0tfTk9UX0lNUExFTUVOVEVEKCk7Cit9CisKK3N0YXRpYyB2b2lkCit1c2JyZWRpcl9oZWxsbyh2
b2lkICpwcml2LCBzdHJ1Y3QgdXNiX3JlZGlyX2hlbGxvX2hlYWRlciAqaGVsbG8pCit7CisgICAg
VVNCUkVESVJfQ0FMTEJBQ0tfTk9UX0lNUExFTUVOVEVEKCk7Cit9CisKK3N0YXRpYyB2b2lkIGlu
aXRpYWxpemVfcGFyc2VyKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoKQoreworICAgIHVpbnQz
Ml90IGZsYWdzLCBjYXBzW1VTQl9SRURJUl9DQVBTX1NJWkVdID0geyAwIH07CisKKyAgICBnX2Fz
c2VydChjaC0+dXNicmVkaXJob3N0ID09IE5VTEwpOworCisgICAgZmxhZ3MgPSB1c2JyZWRpcnBh
cnNlcl9mbF93cml0ZV9jYl9vd25zX2J1ZmZlciB8IHVzYnJlZGlycGFyc2VyX2ZsX3VzYl9ob3N0
OworCisgICAgdXNicmVkaXJwYXJzZXJfY2Fwc19zZXRfY2FwKGNhcHMsIHVzYl9yZWRpcl9jYXBf
Y29ubmVjdF9kZXZpY2VfdmVyc2lvbik7CisgICAgdXNicmVkaXJwYXJzZXJfY2Fwc19zZXRfY2Fw
KGNhcHMsIHVzYl9yZWRpcl9jYXBfZmlsdGVyKTsKKyAgICB1c2JyZWRpcnBhcnNlcl9jYXBzX3Nl
dF9jYXAoY2FwcywgdXNiX3JlZGlyX2NhcF9kZXZpY2VfZGlzY29ubmVjdF9hY2spOworICAgIHVz
YnJlZGlycGFyc2VyX2NhcHNfc2V0X2NhcChjYXBzLCB1c2JfcmVkaXJfY2FwX2VwX2luZm9fbWF4
X3BhY2tldF9zaXplKTsKKyAgICB1c2JyZWRpcnBhcnNlcl9jYXBzX3NldF9jYXAoY2FwcywgdXNi
X3JlZGlyX2NhcF82NGJpdHNfaWRzKTsKKyAgICB1c2JyZWRpcnBhcnNlcl9jYXBzX3NldF9jYXAo
Y2FwcywgdXNiX3JlZGlyX2NhcF8zMmJpdHNfYnVsa19sZW5ndGgpOworICAgIHVzYnJlZGlycGFy
c2VyX2NhcHNfc2V0X2NhcChjYXBzLCB1c2JfcmVkaXJfY2FwX2J1bGtfcmVjZWl2aW5nKTsKKyAg
ICB1c2JyZWRpcnBhcnNlcl9jYXBzX3NldF9jYXAoY2FwcywgdXNiX3JlZGlyX2NhcF9idWxrX3N0
cmVhbXMpOworCisgICAgdXNicmVkaXJwYXJzZXJfaW5pdChjaC0+cGFyc2VyLCBQQUNLQUdFX1NU
UklORywgY2FwcywgVVNCX1JFRElSX0NBUFNfU0laRSwgZmxhZ3MpOworfQorCisvKgorICAgIFdl
IGNhbiBpbml0aWFsaXplIHRoZSB1c2JyZWRpcnBhcnNlciB3aXRoIEhFTExPIGVuYWJsZWQgb25s
eSBpbiBjYXNlCisgICAgdGhlIGxpYnVzYiBpcyBub3QgYWN0aXZlIGFuZCB0aGUgdXNicmVkaXJo
b3N0IGRvZXMgbm90IGZ1bmN0aW9uLgorICAgIFRoZW4gdGhlIHBhcnNlciBzZW5kcyBzZXNzaW9u
IEhFTExPIGFuZCByZWNlaXZlcyBzZXJ2ZXIncyByZXNwb25zZS4KKyAgICBPdGhlcndpc2UgKHVz
YnJlZGlycGFyc2VyIGluaXRpYWxpemVkIHdpdGggSEVMTE8gZGlzYWJsZWQpOgorICAgIC0gdGhl
IHVzYnJlZGlyaG9zdCBzZW5kcyBzZXNzaW9uIEhFTExPCisgICAgLSB3ZSBsb29rIGludG8gaXQg
dG8ga25vdyBzZXQgb2YgY2FwYWJpbGl0aWVzIHdlIHNoYWxsIGluaXRpYWxpemUKKyAgICAgIHRo
ZSBwYXJzZXIgd2l0aAorICAgIC0gd2hlbiB3ZSByZWNlaXZlIHNlcnZlcidzIHJlc3BvbnNlIHRv
IEhFTExPIHdlIHByb3ZpZGUgaXQgYWxzbyB0bworICAgICAgcGFyc2VyIHRvIGxldCBpdCBzeW5j
aHJvbml6ZSB3aXRoIHNlcnZlcidzIGNhcGFiaWxpdGllcworKi8KK3N0YXRpYyBzdHJ1Y3QgdXNi
cmVkaXJwYXJzZXIgKmNyZWF0ZV9wYXJzZXIoU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gpCit7
CisgICAgc3RydWN0IHVzYnJlZGlycGFyc2VyICpwYXJzZXIgPSB1c2JyZWRpcnBhcnNlcl9jcmVh
dGUoKTsKKworICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWlsKHBhcnNlciAhPSBOVUxMLCBOVUxMKTsK
KworICAgIHBhcnNlci0+cHJpdiA9IGNoOworICAgIHBhcnNlci0+bG9nX2Z1bmMgPSB1c2JyZWRp
cl9sb2c7CisgICAgcGFyc2VyLT5yZWFkX2Z1bmMgPSB1c2JyZWRpcl9yZWFkX2NhbGxiYWNrOwor
ICAgIHBhcnNlci0+d3JpdGVfZnVuYyA9IHVzYnJlZGlyX3dyaXRlX2NhbGxiYWNrOworICAgIHBh
cnNlci0+cmVzZXRfZnVuYyA9IHVzYnJlZGlyX2RldmljZV9yZXNldDsKKyAgICBwYXJzZXItPnNl
dF9jb25maWd1cmF0aW9uX2Z1bmMgPSB1c2JyZWRpcl9zZXRfY29uZmlndXJhdGlvbjsKKyAgICBw
YXJzZXItPmdldF9jb25maWd1cmF0aW9uX2Z1bmMgPSB1c2JyZWRpcl9nZXRfY29uZmlndXJhdGlv
bjsKKyAgICBwYXJzZXItPnNldF9hbHRfc2V0dGluZ19mdW5jID0gdXNicmVkaXJfc2V0X2FsdF9z
ZXR0aW5nOworICAgIHBhcnNlci0+Z2V0X2FsdF9zZXR0aW5nX2Z1bmMgPSB1c2JyZWRpcl9nZXRf
YWx0X3NldHRpbmc7CisgICAgcGFyc2VyLT5jYW5jZWxfZGF0YV9wYWNrZXRfZnVuYyA9IHVzYnJl
ZGlyX2NhbmNlbF9kYXRhOworICAgIHBhcnNlci0+Y29udHJvbF9wYWNrZXRfZnVuYyA9IHVzYnJl
ZGlyX2NvbnRyb2xfcGFja2V0OworICAgIHBhcnNlci0+YnVsa19wYWNrZXRfZnVuYyA9IHVzYnJl
ZGlyX2J1bGtfcGFja2V0OworICAgIHBhcnNlci0+YWxsb2NfbG9ja19mdW5jID0gdXNicmVkaXJf
YWxsb2NfbG9jazsKKyAgICBwYXJzZXItPmxvY2tfZnVuYyA9IHVzYnJlZGlyX2xvY2tfbG9jazsK
KyAgICBwYXJzZXItPnVubG9ja19mdW5jID0gdXNicmVkaXJfdW5sb2NrX2xvY2s7CisgICAgcGFy
c2VyLT5mcmVlX2xvY2tfZnVuYyA9IHVzYnJlZGlyX2ZyZWVfbG9jazsKKyAgICBwYXJzZXItPmhl
bGxvX2Z1bmMgPSB1c2JyZWRpcl9oZWxsbzsKKyAgICBwYXJzZXItPmZpbHRlcl9yZWplY3RfZnVu
YyA9IHVzYnJlZGlyX2ZpbHRlcl9yZWplY3Q7CisgICAgcGFyc2VyLT5kZXZpY2VfZGlzY29ubmVj
dF9hY2tfZnVuYyA9IHVzYnJlZGlyX2RldmljZV9kaXNjb25uZWN0X2FjazsKKyAgICBwYXJzZXIt
PmludGVyZmFjZV9pbmZvX2Z1bmMgPSB1c2JyZWRpcl9pbnRlcmZhY2VfaW5mbzsKKyAgICBwYXJz
ZXItPmVwX2luZm9fZnVuYyA9IHVzYnJlZGlyX2ludGVyZmFjZV9lcF9pbmZvOworICAgIHBhcnNl
ci0+ZmlsdGVyX2ZpbHRlcl9mdW5jID0gdXNicmVkaXJfZmlsdGVyX2ZpbHRlcjsKKworICAgIHJl
dHVybiBwYXJzZXI7Cit9CisKIHZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfcmV0dXJuX3dyaXRlX2Rh
dGEoU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gsIHZvaWQgKmRhdGEpCiB7CiAgICAgaWYgKGNo
LT51c2JyZWRpcmhvc3QpIHsKQEAgLTgwMCwxMSArOTk4LDIyIEBAIHNwaWNlX3VzYl9iYWNrZW5k
X2NoYW5uZWxfbmV3KFNwaWNlVXNiQmFja2VuZCAqYmUsCiAgICAgICAgICAgICBzcGljZV91dGls
X2dldF9kZWJ1ZygpID8gdXNicmVkaXJwYXJzZXJfZGVidWcgOiB1c2JyZWRpcnBhcnNlcl93YXJu
aW5nLAogICAgICAgICAgICAgdXNicmVkaXJob3N0X2ZsX3dyaXRlX2NiX293bnNfYnVmZmVyKTsK
ICAgICAgICAgZ193YXJuX2lmX2ZhaWwoY2gtPnVzYnJlZGlyaG9zdCAhPSBOVUxMKTsKLSAgICB9
Ci0gICAgaWYgKGNoLT51c2JyZWRpcmhvc3QpIHsKLSAgICAgICAgdXNicmVkaXJob3N0X3NldF9i
dWZmZXJlZF9vdXRwdXRfc2l6ZV9jYihjaC0+dXNicmVkaXJob3N0LCB1c2JyZWRpcl9idWZmZXJl
ZF9vdXRwdXRfc2l6ZV9jYWxsYmFjayk7CisgICAgICAgIGlmIChjaC0+dXNicmVkaXJob3N0KSB7
CisgICAgICAgICAgICB1c2JyZWRpcmhvc3Rfc2V0X2J1ZmZlcmVkX291dHB1dF9zaXplX2NiKGNo
LT51c2JyZWRpcmhvc3QsIHVzYnJlZGlyX2J1ZmZlcmVkX291dHB1dF9zaXplX2NhbGxiYWNrKTsK
KyAgICAgICAgICAgIC8vIGZvcmNlIGZsdXNoIG9mIEhFTExPIHBhY2tldCBhbmQgY3JlYXRpb24g
b2YgcGFyc2VyCisgICAgICAgICAgICB1c2JyZWRpcmhvc3Rfd3JpdGVfZ3Vlc3RfZGF0YShjaC0+
dXNicmVkaXJob3N0KTsKKyAgICAgICAgfQogICAgIH0gZWxzZSB7Ci0gICAgICAgIGdfZnJlZShj
aCk7CisgICAgICAgIC8vIG5vIHBoeXNpY2FsIGRldmljZSBzdXBwb3J0LCBvbmx5IGVtdWxhdGVk
LCBjcmVhdGUgdGhlCisgICAgICAgIC8vIHBhcnNlcgorICAgICAgICBjaC0+cGFyc2VyID0gY3Jl
YXRlX3BhcnNlcihjaCk7CisgICAgICAgIGlmIChjaC0+cGFyc2VyICE9IE5VTEwpIHsKKyAgICAg
ICAgICAgIGluaXRpYWxpemVfcGFyc2VyKGNoKTsKKyAgICAgICAgfQorICAgIH0KKworICAgIGlm
ICghY2gtPnBhcnNlcikgeworICAgICAgICBzcGljZV91c2JfYmFja2VuZF9jaGFubmVsX2RlbGV0
ZShjaCk7CiAgICAgICAgIGNoID0gTlVMTDsKICAgICB9CiAKQEAgLTgyOSw5ICsxMDM4LDEzIEBA
IHZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9kZWxldGUoU3BpY2VVc2JCYWNrZW5kQ2hh
bm5lbCAqY2gpCiAgICAgaWYgKGNoLT51c2JyZWRpcmhvc3QpIHsKICAgICAgICAgdXNicmVkaXJo
b3N0X2Nsb3NlKGNoLT51c2JyZWRpcmhvc3QpOwogICAgIH0KKyAgICBpZiAoY2gtPnBhcnNlcikg
eworICAgICAgICB1c2JyZWRpcnBhcnNlcl9kZXN0cm95KGNoLT5wYXJzZXIpOworICAgIH0KIAog
ICAgIGlmIChjaC0+cnVsZXMpIHsKLSAgICAgICAgZ19mcmVlKGNoLT5ydWxlcyk7CisgICAgICAg
IC8qIHJ1bGVzIHdlcmUgYWxsb2NhdGVkIGJ5IHVzYnJlZGlycGFyc2VyICovCisgICAgICAgIGZy
ZWUoY2gtPnJ1bGVzKTsKICAgICB9CiAKICAgICBnX2ZyZWUoY2gpOwotLSAKMi4yMS4wCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpTcGljZS1kZXZlbCBt
YWlsaW5nIGxpc3QKU3BpY2UtZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vc3BpY2UtZGV2ZWw=
