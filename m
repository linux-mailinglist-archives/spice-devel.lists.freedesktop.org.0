Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 6E90D7A78B
	for <lists+spice-devel@lfdr.de>; Tue, 30 Jul 2019 14:04:29 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BC8BC6E4F4;
	Tue, 30 Jul 2019 12:04:27 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B68D56E4F0
 for <spice-devel@lists.freedesktop.org>; Tue, 30 Jul 2019 12:04:26 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
 [10.5.11.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 62EEC3092649
 for <spice-devel@lists.freedesktop.org>; Tue, 30 Jul 2019 12:04:26 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.10])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 8B9935D6B2;
 Tue, 30 Jul 2019 12:04:25 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Tue, 30 Jul 2019 13:03:20 +0100
Message-Id: <20190730120331.17967-32-fziglio@redhat.com>
In-Reply-To: <20190730120331.17967-1-fziglio@redhat.com>
References: <20190730120331.17967-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.43]); Tue, 30 Jul 2019 12:04:26 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-gtk 32/44] fixup! usb-redir: add
 implementation of emulated CD device
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

VXBkYXRlIHRvIG5ldyB1c2ItYmFja2VuZCBpbnRlcmZhY2UuCi0tLQogc3JjL3VzYi1kZXZpY2Ut
Y2QuYyB8IDQ3ICsrKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLQog
c3JjL3VzYi1kZXZpY2UtY2QuaCB8IDM3ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrCiAyIGZpbGVzIGNoYW5nZWQsIDYzIGluc2VydGlvbnMoKyksIDIxIGRlbGV0aW9ucygtKQog
Y3JlYXRlIG1vZGUgMTAwNjQ0IHNyYy91c2ItZGV2aWNlLWNkLmgKCmRpZmYgLS1naXQgYS9zcmMv
dXNiLWRldmljZS1jZC5jIGIvc3JjL3VzYi1kZXZpY2UtY2QuYwppbmRleCA3OGU4ZjQwOC4uYTc2
ZWE0M2UgMTAwNjQ0Ci0tLSBhL3NyYy91c2ItZGV2aWNlLWNkLmMKKysrIGIvc3JjL3VzYi1kZXZp
Y2UtY2QuYwpAQCAtNDMsNiArNDMsNyBAQAogI2VuZGlmCiAKICNpbmNsdWRlICJ1c2ItZW11bGF0
aW9uLmgiCisjaW5jbHVkZSAidXNiLWRldmljZS1jZC5oIgogI2luY2x1ZGUgImNkLXVzYi1idWxr
LW1zZC5oIgogCiB0eXBlZGVmIHN0cnVjdCBTcGljZUNkTFUKQEAgLTc0LDcgKzc1LDcgQEAgc3Ry
dWN0IEJ1ZmZlcmVkQnVsa1JlYWQKICAgICB1aW50NjRfdCBpZDsKIH07CiAKLXN0cnVjdCBfU3Bp
Y2VVc2JFbXVsYXRlZERldmljZQorc3RydWN0IFNwaWNlVXNiRW11bGF0ZWREZXZpY2UKIHsKICAg
ICBVc2JEZXZpY2VPcHMgZGV2X29wczsKICAgICBTcGljZVVzYkJhY2tlbmQgKmJhY2tlbmQ7CkBA
IC03MjUsMTEgKzcyNiwxMiBAQCBzdGF0aWMgY29uc3QgVXNiRGV2aWNlT3BzIGRldm9wcyA9CiAg
ICAgLnVucmVhbGl6ZSA9IHVzYl9jZF91bnJlYWxpemUsCiB9OwogCi1zdGF0aWMgaW50IHVzYl9j
ZF9jcmVhdGUoU3BpY2VVc2JCYWNrZW5kICpiZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICBT
cGljZVVzYkJhY2tlbmREZXZpY2UgKnBhcmVudCwKLSAgICAgICAgICAgICAgICAgICAgICAgICBV
c2JDcmVhdGVEZXZpY2VQYXJhbWV0ZXJzICpwYXJhbSwKLSAgICAgICAgICAgICAgICAgICAgICAg
ICBVc2JDZCAqKmRldikKK3N0YXRpYyBVc2JDZCogdXNiX2NkX2NyZWF0ZShTcGljZVVzYkJhY2tl
bmQgKmJlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNlVXNiQmFja2VuZERldmlj
ZSAqcGFyZW50LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKm9wYXF1ZV9wYXJh
bSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBHRXJyb3IgKiplcnIpCiB7CisgICAgQ2RF
bXVsYXRpb25QYXJhbXMgKnBhcmFtID0gb3BhcXVlX3BhcmFtOwogICAgIGludCBlcnJvciA9IDA7
CiAgICAgdWludDMyX3QgdW5pdCA9IDA7CiAgICAgVXNiQ2QgKmQgPSBnX25ldzAoVXNiQ2QsIDEp
OwpAQCAtNzM4LDcgKzc0MCw3IEBAIHN0YXRpYyBpbnQgdXNiX2NkX2NyZWF0ZShTcGljZVVzYkJh
Y2tlbmQgKmJlLAogICAgIGQtPmRldl9vcHMgPSBkZXZvcHM7CiAgICAgZC0+YmFja2VuZCA9IGJl
OwogICAgIGQtPnBhcmVudCAgPSBwYXJlbnQ7Ci0gICAgZC0+ZGVsZXRlX29uX2VqZWN0ID0gISFw
YXJhbS0+ZGV2aWNlX3BhcmFtLmNyZWF0ZV9jZC5kZWxldGVfb25fZWplY3Q7CisgICAgZC0+ZGVs
ZXRlX29uX2VqZWN0ID0gISFwYXJhbS0+ZGVsZXRlX29uX2VqZWN0OwogICAgIGQtPmxvY2tlZCA9
ICFkLT5kZWxldGVfb25fZWplY3Q7CiAgICAgZC0+c2VyaWFsWzBdID0gMHgwMzA4OwogICAgIGQt
PnNlcmlhbFsxXSA9ICdYJzsKQEAgLTc1MywxMyArNzU1LDEzIEBAIHN0YXRpYyBpbnQgdXNiX2Nk
X2NyZWF0ZShTcGljZVVzYkJhY2tlbmQgKmJlLAogICAgIGQtPm1zYyA9IGNkX3VzYl9idWxrX21z
ZF9hbGxvYyhkLCBNQVhfTFVOX1BFUl9ERVZJQ0UpOwogICAgIGlmICghZC0+bXNjKSB7CiAgICAg
ICAgIGdfY2xlYXJfcG9pbnRlcigmZCwgZ19mcmVlKTsKLSAgICAgICAgcGFyYW0tPmVycm9yID0g
Z19lcnJvcl9uZXcoU1BJQ0VfQ0xJRU5UX0VSUk9SLCBTUElDRV9DTElFTlRfRVJST1JfRkFJTEVE
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfKCJjYW4ndCBhbGxvY2F0ZSBk
ZXZpY2UiKSk7Ci0gICAgICAgIHJldHVybiAxOworICAgICAgICBnX3NldF9lcnJvcihlcnIsIFNQ
SUNFX0NMSUVOVF9FUlJPUiwgU1BJQ0VfQ0xJRU5UX0VSUk9SX0ZBSUxFRCwKKyAgICAgICAgICAg
ICAgICAgICAgXygiY2FuJ3QgYWxsb2NhdGUgZGV2aWNlIikpOworICAgICAgICByZXR1cm4gTlVM
TDsKICAgICB9CiAgICAgZC0+dW5pdHNbdW5pdF0uYmxvY2tTaXplID0gQ0RfREVWX0JMT0NLX1NJ
WkU7CiAgICAgaWYgKCFjZF91c2JfYnVsa19tc2RfcmVhbGl6ZShkLT5tc2MsIHVuaXQsICZkZXZf
cGFyYW1zKSkgewotICAgICAgICBpZiAob3Blbl9zdHJlYW0oJmQtPnVuaXRzW3VuaXRdLCBwYXJh
bS0+ZGV2aWNlX3BhcmFtLmNyZWF0ZV9jZC5maWxlbmFtZSkgJiYKKyAgICAgICAgaWYgKG9wZW5f
c3RyZWFtKCZkLT51bml0c1t1bml0XSwgcGFyYW0tPmZpbGVuYW1lKSAmJgogICAgICAgICAgICAg
bG9hZF9sdW4oZCwgdW5pdCwgVFJVRSkpIHsKICAgICAgICAgICAgIGlmIChkLT5sb2NrZWQpIHsK
ICAgICAgICAgICAgICAgICBjZF91c2JfYnVsa19tc2RfbG9jayhkLT5tc2MsIHVuaXQsIFRSVUUp
OwpAQCAtNzY3LDI4ICs3NjksMzEgQEAgc3RhdGljIGludCB1c2JfY2RfY3JlYXRlKFNwaWNlVXNi
QmFja2VuZCAqYmUsCiAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICBjbG9zZV9zdHJlYW0o
JmQtPnVuaXRzW3VuaXRdKTsKICAgICAgICAgICAgIGNkX3VzYl9idWxrX21zZF91bnJlYWxpemUo
ZC0+bXNjLCB1bml0KTsKLSAgICAgICAgICAgIHBhcmFtLT5lcnJvciA9IGdfZXJyb3JfbmV3KFNQ
SUNFX0NMSUVOVF9FUlJPUiwgU1BJQ0VfQ0xJRU5UX0VSUk9SX0ZBSUxFRCwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8oImNhbid0IGNyZWF0ZSBkZXZpY2Ugd2l0aCAl
cyIpLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW0tPmRldmlj
ZV9wYXJhbS5jcmVhdGVfY2QuZmlsZW5hbWUpOwotICAgICAgICAgICAgZXJyb3IgPSAzOworICAg
ICAgICAgICAgZ19zZXRfZXJyb3IoZXJyLCBTUElDRV9DTElFTlRfRVJST1IsIFNQSUNFX0NMSUVO
VF9FUlJPUl9GQUlMRUQsCisgICAgICAgICAgICAgICAgICAgICAgICBfKCJjYW4ndCBjcmVhdGUg
ZGV2aWNlIHdpdGggJXMiKSwKKyAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtLT5maWxlbmFt
ZSk7CisgICAgICAgICAgICBlcnJvciA9IDE7CiAgICAgICAgIH0KICAgICB9IGVsc2UgewotICAg
ICAgICBlcnJvciA9IDI7Ci0gICAgICAgIHBhcmFtLT5lcnJvciA9IGdfZXJyb3JfbmV3KFNQSUNF
X0NMSUVOVF9FUlJPUiwgU1BJQ0VfQ0xJRU5UX0VSUk9SX0ZBSUxFRCwKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgXygiY2FuJ3QgYWxsb2NhdGUgZGV2aWNlIikpOworICAgICAg
ICBnX3NldF9lcnJvcihlcnIsIFNQSUNFX0NMSUVOVF9FUlJPUiwgU1BJQ0VfQ0xJRU5UX0VSUk9S
X0ZBSUxFRCwKKyAgICAgICAgICAgICAgICAgICAgXygiY2FuJ3QgYWxsb2NhdGUgZGV2aWNlIikp
OworICAgICAgICBlcnJvciA9IDE7CiAgICAgfQogICAgIGlmIChlcnJvcikgewogICAgICAgICBn
X2NsZWFyX3BvaW50ZXIoJmQtPm1zYywgY2RfdXNiX2J1bGtfbXNkX2ZyZWUpOwogICAgICAgICBn
X2NsZWFyX3BvaW50ZXIoJmQsIGdfZnJlZSk7CisgICAgICAgIHJldHVybiBOVUxMOwogICAgIH0K
IAotICAgICpkZXYgPSBkOwotICAgIHJldHVybiBlcnJvcjsKKyAgICByZXR1cm4gZDsKIH0KIAot
dm9pZCBzcGljZV91c2JfZGV2aWNlX3JlZ2lzdGVyX2NkKFNwaWNlVXNiQmFja2VuZCAqYmUpCitT
cGljZVVzYkJhY2tlbmREZXZpY2UqCitjcmVhdGVfZW11bGF0ZWRfY2QoU3BpY2VVc2JCYWNrZW5k
ICpiZSwKKyAgICAgICAgICAgICAgICAgICBDZEVtdWxhdGlvblBhcmFtcyAqcGFyYW0sCisgICAg
ICAgICAgICAgICAgICAgR0Vycm9yICoqZXJyKQogewotICAgIHNwaWNlX3VzYl9iYWNrZW5kX3Jl
Z2lzdGVyX2RldmljZV90eXBlKGJlLCBVU0JfREVWX1RZUEVfQ0QsIHVzYl9jZF9jcmVhdGUpOwor
ICAgIHJldHVybiBzcGljZV91c2JfYmFja2VuZF9jcmVhdGVfZW11bGF0ZWRfZGV2aWNlKGJlLCB1
c2JfY2RfY3JlYXRlLCBwYXJhbSwgZXJyKTsKIH0KIAogI2VuZGlmIC8qIFVTRV9VU0JSRURJUiAq
LwpkaWZmIC0tZ2l0IGEvc3JjL3VzYi1kZXZpY2UtY2QuaCBiL3NyYy91c2ItZGV2aWNlLWNkLmgK
bmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAuLmViMDgyYjc4Ci0tLSAvZGV2L251
bGwKKysrIGIvc3JjL3VzYi1kZXZpY2UtY2QuaApAQCAtMCwwICsxLDM3IEBACisvKiAtKi0gTW9k
ZTogQzsgYy1iYXNpYy1vZmZzZXQ6IDQ7IGluZGVudC10YWJzLW1vZGU6IG5pbCAtKi0gKi8KKy8q
CisgICAgQ29weXJpZ2h0IChDKSAyMDE5IFJlZCBIYXQsIEluYy4KKworICAgIFJlZCBIYXQgQXV0
aG9yczoKKyAgICBZdXJpIEJlbmRpdG92aWNoPHliZW5kaXRvQHJlZGhhdC5jb20+CisKKyAgICBU
aGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5k
L29yCisgICAgbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5l
cmFsIFB1YmxpYworICAgIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJl
IEZvdW5kYXRpb247IGVpdGhlcgorICAgIHZlcnNpb24gMi4xIG9mIHRoZSBMaWNlbnNlLCBvciAo
YXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgorCisgICAgVGhpcyBsaWJyYXJ5IGlz
IGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCisgICAgYnV0
IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkg
b2YKKyAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBP
U0UuICBTZWUgdGhlIEdOVQorICAgIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBt
b3JlIGRldGFpbHMuCisKKyAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRo
ZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCisgICAgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMg
bGlicmFyeTsgaWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgorKi8K
KworI2lmbmRlZiBTUElDRV9HVEtfVVNCX0RFVklDRV9DRF9IXworI2RlZmluZSBTUElDRV9HVEtf
VVNCX0RFVklDRV9DRF9IXworCisjaW5jbHVkZSAidXNiLWJhY2tlbmQuaCIKKwordHlwZWRlZiBz
dHJ1Y3QgQ2RFbXVsYXRpb25QYXJhbXMgeworICAgIGNvbnN0IGNoYXIgKmZpbGVuYW1lOworICAg
IHVpbnQzMl90IGRlbGV0ZV9vbl9lamVjdCA6IDE7Cit9IENkRW11bGF0aW9uUGFyYW1zOworCitT
cGljZVVzYkJhY2tlbmREZXZpY2UqCitjcmVhdGVfZW11bGF0ZWRfY2QoU3BpY2VVc2JCYWNrZW5k
ICpiZSwKKyAgICAgICAgICAgICAgICAgICBDZEVtdWxhdGlvblBhcmFtcyAqcGFyYW0sCisgICAg
ICAgICAgICAgICAgICAgR0Vycm9yICoqZXJyKTsKKworI2VuZGlmIC8vIFNQSUNFX0dUS19VU0Jf
REVWSUNFX0NEX0hfCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9zcGljZS1kZXZlbA==
