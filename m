Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 01B5BB37F6
	for <lists+spice-devel@lfdr.de>; Mon, 16 Sep 2019 12:21:14 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5B44D6E8F1;
	Mon, 16 Sep 2019 10:21:12 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 209AF6E8F1
 for <spice-devel@lists.freedesktop.org>; Mon, 16 Sep 2019 10:21:11 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
 [10.5.11.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id B7C3030603AD
 for <spice-devel@lists.freedesktop.org>; Mon, 16 Sep 2019 10:21:10 +0000 (UTC)
Received: from wingsuit.mxp.redhat.com (unknown [10.32.181.155])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 4124D5D6A3
 for <spice-devel@lists.freedesktop.org>; Mon, 16 Sep 2019 10:21:10 +0000 (UTC)
From: Victor Toso <victortoso@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Mon, 16 Sep 2019 12:20:50 +0200
Message-Id: <20190916102104.20943-8-victortoso@redhat.com>
In-Reply-To: <20190916102104.20943-1-victortoso@redhat.com>
References: <20190916102104.20943-1-victortoso@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.41]); Mon, 16 Sep 2019 10:21:10 +0000 (UTC)
Subject: [Spice-devel] [PATCH v7 07/20] usb-backend: include usbredirparser
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogWXVyaSBCZW5kaXRvdmljaCA8eXVyaS5iZW5kaXRvdmljaEBkYXluaXguY29tPgoKVGhp
cyBwYXRjaCBpbnRyb2R1Y2VzIHRoZSB1c2FnZSBvZiB1c2JyZWRpcnBhcnNlciBpbgpTcGljZVVz
YkJhY2tlbmRDaGFubmVsLgoKVGhlIGZvY3VzIG9mIHRoaXMgcGF0Y2ggaXMgdG8gdGhlIGNvZGUg
cGF0aCBvZiByZWFsIGRldmljZXMuIEFzIHdlCmRvbid0IGtub3cgYmVmb3JlaGFuZCBpZiBhIFNw
aWNlVXNiQmFja2VuZENoYW5uZWwgd2lsbCBiZSB1c2VkIGJ5IHJlYWwKb3IgZW11bGF0ZWQgZGV2
aWNlcywgYW4gaW5zdGFuY2Ugb2YgdXNicmVkaXJwYXJzZXIgbXVzdCBiZSBpbml0aWFsaXplZAp3
aXRoIHRoZSB1c2JyZWRpcmhvc3QncyBmaXJzdCBoZWxsbyBtZXNzYWdlLgoKVGhpcyBpcyBhIG11
c3QgdG8gdGhlIGN1cnJlbnQgZGVzaWduIG9uIHN1cHBvcnRpbmcgZW11bGF0ZWQgZGV2aWNlcy4K
VGhpcyB3aWxsIGJlIGV4dGVuZGVkIGluIHRoZSBuZXh0IHBhdGNoIHRvIG1hdGNoIHJlbW90ZSdz
IHVzYnJlZGlyaG9zdApjYXBhYmlsaXRpZXMgYW5kIHByb3ZpZGluZyBzdXBwb3J0IHRvIGVtdWxh
dGVkIGRldmljZXMuCgpTaWduZWQtb2ZmLWJ5OiBZdXJpIEJlbmRpdG92aWNoIDx5dXJpLmJlbmRp
dG92aWNoQGRheW5peC5jb20+ClNpZ25lZC1vZmYtYnk6IFZpY3RvciBUb3NvIDx2aWN0b3J0b3Nv
QHJlZGhhdC5jb20+Ci0tLQogc3JjL3VzYi1iYWNrZW5kLmMgfCAyMjMgKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKystLQogMSBmaWxlIGNoYW5nZWQsIDIxOCBpbnNl
cnRpb25zKCspLCA1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3NyYy91c2ItYmFja2VuZC5j
IGIvc3JjL3VzYi1iYWNrZW5kLmMKaW5kZXggNjhmYWFhZS4uZWYyOTkwMSAxMDA2NDQKLS0tIGEv
c3JjL3VzYi1iYWNrZW5kLmMKKysrIGIvc3JjL3VzYi1iYWNrZW5kLmMKQEAgLTQ1LDYgKzQ1LDcg
QEAKICNpbmNsdWRlICJ1c2J1dGlsLmgiCiAKICNkZWZpbmUgTE9VRF9ERUJVRyh4LCAuLi4pCisj
ZGVmaW5lIFVTQlJFRElSX0NBTExCQUNLX05PVF9JTVBMRU1FTlRFRCgpIHNwaWNlX2RlYnVnKCIl
cyBub3QgaW1wbGVtZW50ZWQgLSBGSVhNRSIsIF9fZnVuY19fKQogCiBzdHJ1Y3QgX1NwaWNlVXNi
RGV2aWNlCiB7CkBAIC04Miw2ICs4Myw3IEBAIHN0cnVjdCBfU3BpY2VVc2JCYWNrZW5kCiBzdHJ1
Y3QgX1NwaWNlVXNiQmFja2VuZENoYW5uZWwKIHsKICAgICBzdHJ1Y3QgdXNicmVkaXJob3N0ICp1
c2JyZWRpcmhvc3Q7CisgICAgc3RydWN0IHVzYnJlZGlycGFyc2VyICpwYXJzZXI7CiAgICAgdWlu
dDhfdCAqcmVhZF9idWY7CiAgICAgaW50IHJlYWRfYnVmX3NpemU7CiAgICAgc3RydWN0IHVzYnJl
ZGlyZmlsdGVyX3J1bGUgKnJ1bGVzOwpAQCAtNjMwLDExICs2MzIsNDggQEAgc3RhdGljIHZvaWQg
dXNicmVkaXJfbG9nKHZvaWQgKnVzZXJfZGF0YSwgaW50IGxldmVsLCBjb25zdCBjaGFyICptc2cp
CiAgICAgfQogfQogCitzdGF0aWMgc3RydWN0IHVzYnJlZGlycGFyc2VyICpjcmVhdGVfcGFyc2Vy
KFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoKTsKKwogc3RhdGljIGludCB1c2JyZWRpcl93cml0
ZV9jYWxsYmFjayh2b2lkICp1c2VyX2RhdGEsIHVpbnQ4X3QgKmRhdGEsIGludCBjb3VudCkKIHsK
ICAgICBTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCA9IHVzZXJfZGF0YTsKICAgICBpbnQgcmVz
OwogICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCwgJWQgYnl0ZXMiLCBfX0ZVTkNUSU9OX18sIGNo
LCBjb3VudCk7CisKKyAgICAvLyBoYW5kbGUgZmlyc3QgcGFja2V0IChIRUxMTykgY3JlYXRpbmcg
cGFyc2VyIGZyb20gY2FwYWJpbGl0aWVzCisgICAgaWYgKFNQSUNFX1VOTElLRUxZKGNoLT5wYXJz
ZXIgPT0gTlVMTCkpIHsKKyAgICAgICAgLy8gSGVyZSB3ZSByZXR1cm4gMCBmcm9tIHRoaXMgZnVu
Y3Rpb24gdG8ga2VlcCB0aGUgcGFja2V0IGluCisgICAgICAgIC8vIHRoZSBxdWV1ZS4gVGhlIHBh
Y2tldCB3aWxsIHRoZW4gYmUgc2VudCB0byB0aGUgZ3Vlc3QuCisgICAgICAgIC8vIFdlIGFyZSBp
bml0aWFsaXppbmcgU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCwgdGhlCisgICAgICAgIC8vIFNwaWNl
VXNicmVkaXJDaGFubmVsIGlzIG5vdCByZWFkeSB0byByZWNlaXZlIHBhY2tldHMuCisKKyAgICAg
ICAgLy8gd2UgYXJlIHN0aWxsIGluaXRpYWxpemluZyB0aGUgaG9zdAorICAgICAgICBpZiAoY2gt
PnVzYnJlZGlyaG9zdCA9PSBOVUxMKSB7CisgICAgICAgICAgICByZXR1cm4gMDsKKyAgICAgICAg
fQorCisgICAgICAgIGNoLT5wYXJzZXIgPSBjcmVhdGVfcGFyc2VyKGNoKTsKKyAgICAgICAgaWYg
KCFjaC0+cGFyc2VyKSB7CisgICAgICAgICAgICByZXR1cm4gMDsKKyAgICAgICAgfQorCisgICAg
ICAgIC8qIGhlbGxvIGlzIHNob3J0IGhlYWRlciAoMTIpICsgaGVsbG8gc3RydWN0ICg2NCkgKi8K
KyAgICAgICAgY29uc3QgaW50IGhlbGxvX3NpemUgPSAxMiArIHNpemVvZihzdHJ1Y3QgdXNiX3Jl
ZGlyX2hlbGxvX2hlYWRlcik7CisgICAgICAgIGdfYXNzZXJ0KGNvdW50ID49IGhlbGxvX3NpemUg
KyA0KTsKKyAgICAgICAgZ19hc3NlcnQoU1BJQ0VfQUxJR05FRF9DQVNUKHN0cnVjdCB1c2JfcmVk
aXJfaGVhZGVyICosIGRhdGEpLT50eXBlID09IHVzYl9yZWRpcl9oZWxsbyk7CisKKyAgICAgICAg
Y29uc3QgdWludDMyX3QgZmxhZ3MgPQorICAgICAgICAgICAgdXNicmVkaXJwYXJzZXJfZmxfd3Jp
dGVfY2Jfb3duc19idWZmZXIgfCB1c2JyZWRpcnBhcnNlcl9mbF91c2JfaG9zdCB8CisgICAgICAg
ICAgICB1c2JyZWRpcnBhcnNlcl9mbF9ub19oZWxsbzsKKworICAgICAgICB1c2JyZWRpcnBhcnNl
cl9pbml0KGNoLT5wYXJzZXIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgUEFDS0FHRV9T
VFJJTkcsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgU1BJQ0VfQUxJR05FRF9DQVNUKHVp
bnQzMl90ICosIGRhdGEgKyBoZWxsb19zaXplKSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAoY291bnQgLSBoZWxsb19zaXplKSAvIHNpemVvZih1aW50MzJfdCksCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgZmxhZ3MpOworCisgICAgICAgIHJldHVybiAwOworICAgIH0KICAgICBy
ZXMgPSBzcGljZV91c2JyZWRpcl93cml0ZShjaC0+dXNicmVkaXJfY2hhbm5lbCwgZGF0YSwgY291
bnQpOwogICAgIHJldHVybiByZXM7CiB9CkBAIC03MDEsNiArNzQwLDE2NSBAQCBHRXJyb3IgKnNw
aWNlX3VzYl9iYWNrZW5kX2dldF9lcnJvcl9kZXRhaWxzKGludCBlcnJvcl9jb2RlLCBnY2hhciAq
ZGVzYykKICAgICByZXR1cm4gZXJyOwogfQogCitzdGF0aWMgdm9pZAordXNicmVkaXJfY29udHJv
bF9wYWNrZXQodm9pZCAqcHJpdiwgdWludDY0X3QgaWQsIHN0cnVjdCB1c2JfcmVkaXJfY29udHJv
bF9wYWNrZXRfaGVhZGVyICpoLAorICAgICAgICAgICAgICAgICAgICAgICAgdWludDhfdCAqZGF0
YSwgaW50IGRhdGFfbGVuKQoreworICAgIFVTQlJFRElSX0NBTExCQUNLX05PVF9JTVBMRU1FTlRF
RCgpOworfQorCitzdGF0aWMgdm9pZAordXNicmVkaXJfYnVsa19wYWNrZXQodm9pZCAqcHJpdiwg
dWludDY0X3QgaWQsIHN0cnVjdCB1c2JfcmVkaXJfYnVsa19wYWNrZXRfaGVhZGVyICpoLAorICAg
ICAgICAgICAgICAgICAgICAgdWludDhfdCAqZGF0YSwgaW50IGRhdGFfbGVuKQoreworICAgIFVT
QlJFRElSX0NBTExCQUNLX05PVF9JTVBMRU1FTlRFRCgpOworfQorCitzdGF0aWMgdm9pZCB1c2Jy
ZWRpcl9kZXZpY2VfcmVzZXQodm9pZCAqcHJpdikKK3sKKyAgICBVU0JSRURJUl9DQUxMQkFDS19O
T1RfSU1QTEVNRU5URUQoKTsKK30KKworc3RhdGljIHZvaWQKK3VzYnJlZGlyX2ludGVyZmFjZV9p
bmZvKHZvaWQgKnByaXYsIHN0cnVjdCB1c2JfcmVkaXJfaW50ZXJmYWNlX2luZm9faGVhZGVyICpp
bnRlcmZhY2VfaW5mbykKK3sKKyAgICBVU0JSRURJUl9DQUxMQkFDS19OT1RfSU1QTEVNRU5URUQo
KTsKK30KKworc3RhdGljIHZvaWQKK3VzYnJlZGlyX2ludGVyZmFjZV9lcF9pbmZvKHZvaWQgKnBy
aXYsIHN0cnVjdCB1c2JfcmVkaXJfZXBfaW5mb19oZWFkZXIgKmVwX2luZm8pCit7CisgICAgVVNC
UkVESVJfQ0FMTEJBQ0tfTk9UX0lNUExFTUVOVEVEKCk7Cit9CisKK3N0YXRpYyB2b2lkCit1c2Jy
ZWRpcl9zZXRfY29uZmlndXJhdGlvbih2b2lkICpwcml2LCB1aW50NjRfdCBpZCwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHN0cnVjdCB1c2JfcmVkaXJfc2V0X2NvbmZpZ3VyYXRpb25faGVh
ZGVyICpzZXRfY29uZmlndXJhdGlvbikKK3sKKyAgICBVU0JSRURJUl9DQUxMQkFDS19OT1RfSU1Q
TEVNRU5URUQoKTsKK30KKworc3RhdGljIHZvaWQgdXNicmVkaXJfZ2V0X2NvbmZpZ3VyYXRpb24o
dm9pZCAqcHJpdiwgdWludDY0X3QgaWQpCit7CisgICAgVVNCUkVESVJfQ0FMTEJBQ0tfTk9UX0lN
UExFTUVOVEVEKCk7Cit9CisKK3N0YXRpYyB2b2lkCit1c2JyZWRpcl9zZXRfYWx0X3NldHRpbmco
dm9pZCAqcHJpdiwgdWludDY0X3QgaWQsIHN0cnVjdCB1c2JfcmVkaXJfc2V0X2FsdF9zZXR0aW5n
X2hlYWRlciAqcykKK3sKKyAgICBVU0JSRURJUl9DQUxMQkFDS19OT1RfSU1QTEVNRU5URUQoKTsK
K30KKworc3RhdGljIHZvaWQKK3VzYnJlZGlyX2dldF9hbHRfc2V0dGluZyh2b2lkICpwcml2LCB1
aW50NjRfdCBpZCwgc3RydWN0IHVzYl9yZWRpcl9nZXRfYWx0X3NldHRpbmdfaGVhZGVyICpzKQor
eworICAgIFVTQlJFRElSX0NBTExCQUNLX05PVF9JTVBMRU1FTlRFRCgpOworfQorCitzdGF0aWMg
dm9pZCB1c2JyZWRpcl9jYW5jZWxfZGF0YSh2b2lkICpwcml2LCB1aW50NjRfdCBpZCkKK3sKKyAg
ICBVU0JSRURJUl9DQUxMQkFDS19OT1RfSU1QTEVNRU5URUQoKTsKK30KKworc3RhdGljIHZvaWQg
dXNicmVkaXJfZmlsdGVyX3JlamVjdCh2b2lkICpwcml2KQoreworICAgIFVTQlJFRElSX0NBTExC
QUNLX05PVF9JTVBMRU1FTlRFRCgpOworfQorCisvKiBOb3RlIHRoYXQgdGhlIG93bmVyc2hpcCBv
ZiB0aGUgcnVsZXMgYXJyYXkgaXMgcGFzc2VkIG9uIHRvIHRoZSBjYWxsYmFjay4gKi8KK3N0YXRp
YyB2b2lkCit1c2JyZWRpcl9maWx0ZXJfZmlsdGVyKHZvaWQgKnByaXYsIHN0cnVjdCB1c2JyZWRp
cmZpbHRlcl9ydWxlICpyLCBpbnQgY291bnQpCit7CisgICAgU3BpY2VVc2JCYWNrZW5kQ2hhbm5l
bCAqY2ggPSBwcml2OworICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCAlZCBmaWx0ZXJzIiwgX19G
VU5DVElPTl9fLCBjaCwgY291bnQpOworCisgICAgZnJlZShjaC0+cnVsZXMpOworICAgIGNoLT5y
dWxlcyA9IHI7CisgICAgY2gtPnJ1bGVzX2NvdW50ID0gY291bnQ7CisgICAgaWYgKGNvdW50KSB7
CisgICAgICAgIGludCBpOworICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewor
ICAgICAgICAgICAgU1BJQ0VfREVCVUcoIiVzIGNsYXNzICVkLCAlWDolWCIsCisgICAgICAgICAg
ICAgICAgcltpXS5hbGxvdyA/ICJhbGxvd2VkIiA6ICJkZW5pZWQiLCByW2ldLmRldmljZV9jbGFz
cywKKyAgICAgICAgICAgICAgICAodWludDMyX3QpcltpXS52ZW5kb3JfaWQsICh1aW50MzJfdCly
W2ldLnByb2R1Y3RfaWQpOworICAgICAgICB9CisgICAgfQorfQorCitzdGF0aWMgdm9pZCB1c2Jy
ZWRpcl9kZXZpY2VfZGlzY29ubmVjdF9hY2sodm9pZCAqcHJpdikKK3sKKyAgICBVU0JSRURJUl9D
QUxMQkFDS19OT1RfSU1QTEVNRU5URUQoKTsKK30KKworc3RhdGljIHZvaWQKK3VzYnJlZGlyX2hl
bGxvKHZvaWQgKnByaXYsIHN0cnVjdCB1c2JfcmVkaXJfaGVsbG9faGVhZGVyICpoZWxsbykKK3sK
KyAgICBVU0JSRURJUl9DQUxMQkFDS19OT1RfSU1QTEVNRU5URUQoKTsKK30KKworc3RhdGljIHZv
aWQgaW5pdGlhbGl6ZV9wYXJzZXIoU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gpCit7CisgICAg
dWludDMyX3QgZmxhZ3MsIGNhcHNbVVNCX1JFRElSX0NBUFNfU0laRV0gPSB7IDAgfTsKKworICAg
IGdfYXNzZXJ0KGNoLT51c2JyZWRpcmhvc3QgPT0gTlVMTCk7CisKKyAgICBmbGFncyA9IHVzYnJl
ZGlycGFyc2VyX2ZsX3dyaXRlX2NiX293bnNfYnVmZmVyIHwgdXNicmVkaXJwYXJzZXJfZmxfdXNi
X2hvc3Q7CisKKyAgICB1c2JyZWRpcnBhcnNlcl9jYXBzX3NldF9jYXAoY2FwcywgdXNiX3JlZGly
X2NhcF9jb25uZWN0X2RldmljZV92ZXJzaW9uKTsKKyAgICB1c2JyZWRpcnBhcnNlcl9jYXBzX3Nl
dF9jYXAoY2FwcywgdXNiX3JlZGlyX2NhcF9maWx0ZXIpOworICAgIHVzYnJlZGlycGFyc2VyX2Nh
cHNfc2V0X2NhcChjYXBzLCB1c2JfcmVkaXJfY2FwX2RldmljZV9kaXNjb25uZWN0X2Fjayk7Cisg
ICAgdXNicmVkaXJwYXJzZXJfY2Fwc19zZXRfY2FwKGNhcHMsIHVzYl9yZWRpcl9jYXBfZXBfaW5m
b19tYXhfcGFja2V0X3NpemUpOworICAgIHVzYnJlZGlycGFyc2VyX2NhcHNfc2V0X2NhcChjYXBz
LCB1c2JfcmVkaXJfY2FwXzY0Yml0c19pZHMpOworICAgIHVzYnJlZGlycGFyc2VyX2NhcHNfc2V0
X2NhcChjYXBzLCB1c2JfcmVkaXJfY2FwXzMyYml0c19idWxrX2xlbmd0aCk7CisgICAgdXNicmVk
aXJwYXJzZXJfY2Fwc19zZXRfY2FwKGNhcHMsIHVzYl9yZWRpcl9jYXBfYnVsa19yZWNlaXZpbmcp
OworICAgIHVzYnJlZGlycGFyc2VyX2NhcHNfc2V0X2NhcChjYXBzLCB1c2JfcmVkaXJfY2FwX2J1
bGtfc3RyZWFtcyk7CisKKyAgICB1c2JyZWRpcnBhcnNlcl9pbml0KGNoLT5wYXJzZXIsIFBBQ0tB
R0VfU1RSSU5HLCBjYXBzLCBVU0JfUkVESVJfQ0FQU19TSVpFLCBmbGFncyk7Cit9CisKKy8qCisg
ICAgV2UgY2FuIGluaXRpYWxpemUgdGhlIHVzYnJlZGlycGFyc2VyIHdpdGggSEVMTE8gZW5hYmxl
ZCBvbmx5IGluIGNhc2UKKyAgICB0aGUgbGlidXNiIGlzIG5vdCBhY3RpdmUgYW5kIHRoZSB1c2Jy
ZWRpcmhvc3QgZG9lcyBub3QgZnVuY3Rpb24uCisgICAgVGhlbiB0aGUgcGFyc2VyIHNlbmRzIHNl
c3Npb24gSEVMTE8gYW5kIHJlY2VpdmVzIHNlcnZlcidzIHJlc3BvbnNlLgorICAgIE90aGVyd2lz
ZSAodXNicmVkaXJwYXJzZXIgaW5pdGlhbGl6ZWQgd2l0aCBIRUxMTyBkaXNhYmxlZCk6CisgICAg
LSB0aGUgdXNicmVkaXJob3N0IHNlbmRzIHNlc3Npb24gSEVMTE8KKyAgICAtIHdlIGxvb2sgaW50
byBpdCB0byBrbm93IHNldCBvZiBjYXBhYmlsaXRpZXMgd2Ugc2hhbGwgaW5pdGlhbGl6ZQorICAg
ICAgdGhlIHBhcnNlciB3aXRoCisgICAgLSB3aGVuIHdlIHJlY2VpdmUgc2VydmVyJ3MgcmVzcG9u
c2UgdG8gSEVMTE8gd2UgcHJvdmlkZSBpdCBhbHNvIHRvCisgICAgICBwYXJzZXIgdG8gbGV0IGl0
IHN5bmNocm9uaXplIHdpdGggc2VydmVyJ3MgY2FwYWJpbGl0aWVzCisqLworc3RhdGljIHN0cnVj
dCB1c2JyZWRpcnBhcnNlciAqY3JlYXRlX3BhcnNlcihTcGljZVVzYkJhY2tlbmRDaGFubmVsICpj
aCkKK3sKKyAgICBzdHJ1Y3QgdXNicmVkaXJwYXJzZXIgKnBhcnNlciA9IHVzYnJlZGlycGFyc2Vy
X2NyZWF0ZSgpOworCisgICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwocGFyc2VyICE9IE5VTEwsIE5V
TEwpOworCisgICAgcGFyc2VyLT5wcml2ID0gY2g7CisgICAgcGFyc2VyLT5sb2dfZnVuYyA9IHVz
YnJlZGlyX2xvZzsKKyAgICBwYXJzZXItPnJlYWRfZnVuYyA9IHVzYnJlZGlyX3JlYWRfY2FsbGJh
Y2s7CisgICAgcGFyc2VyLT53cml0ZV9mdW5jID0gdXNicmVkaXJfd3JpdGVfY2FsbGJhY2s7Cisg
ICAgcGFyc2VyLT5yZXNldF9mdW5jID0gdXNicmVkaXJfZGV2aWNlX3Jlc2V0OworICAgIHBhcnNl
ci0+c2V0X2NvbmZpZ3VyYXRpb25fZnVuYyA9IHVzYnJlZGlyX3NldF9jb25maWd1cmF0aW9uOwor
ICAgIHBhcnNlci0+Z2V0X2NvbmZpZ3VyYXRpb25fZnVuYyA9IHVzYnJlZGlyX2dldF9jb25maWd1
cmF0aW9uOworICAgIHBhcnNlci0+c2V0X2FsdF9zZXR0aW5nX2Z1bmMgPSB1c2JyZWRpcl9zZXRf
YWx0X3NldHRpbmc7CisgICAgcGFyc2VyLT5nZXRfYWx0X3NldHRpbmdfZnVuYyA9IHVzYnJlZGly
X2dldF9hbHRfc2V0dGluZzsKKyAgICBwYXJzZXItPmNhbmNlbF9kYXRhX3BhY2tldF9mdW5jID0g
dXNicmVkaXJfY2FuY2VsX2RhdGE7CisgICAgcGFyc2VyLT5jb250cm9sX3BhY2tldF9mdW5jID0g
dXNicmVkaXJfY29udHJvbF9wYWNrZXQ7CisgICAgcGFyc2VyLT5idWxrX3BhY2tldF9mdW5jID0g
dXNicmVkaXJfYnVsa19wYWNrZXQ7CisgICAgcGFyc2VyLT5hbGxvY19sb2NrX2Z1bmMgPSB1c2Jy
ZWRpcl9hbGxvY19sb2NrOworICAgIHBhcnNlci0+bG9ja19mdW5jID0gdXNicmVkaXJfbG9ja19s
b2NrOworICAgIHBhcnNlci0+dW5sb2NrX2Z1bmMgPSB1c2JyZWRpcl91bmxvY2tfbG9jazsKKyAg
ICBwYXJzZXItPmZyZWVfbG9ja19mdW5jID0gdXNicmVkaXJfZnJlZV9sb2NrOworICAgIHBhcnNl
ci0+aGVsbG9fZnVuYyA9IHVzYnJlZGlyX2hlbGxvOworICAgIHBhcnNlci0+ZmlsdGVyX3JlamVj
dF9mdW5jID0gdXNicmVkaXJfZmlsdGVyX3JlamVjdDsKKyAgICBwYXJzZXItPmRldmljZV9kaXNj
b25uZWN0X2Fja19mdW5jID0gdXNicmVkaXJfZGV2aWNlX2Rpc2Nvbm5lY3RfYWNrOworICAgIHBh
cnNlci0+aW50ZXJmYWNlX2luZm9fZnVuYyA9IHVzYnJlZGlyX2ludGVyZmFjZV9pbmZvOworICAg
IHBhcnNlci0+ZXBfaW5mb19mdW5jID0gdXNicmVkaXJfaW50ZXJmYWNlX2VwX2luZm87CisgICAg
cGFyc2VyLT5maWx0ZXJfZmlsdGVyX2Z1bmMgPSB1c2JyZWRpcl9maWx0ZXJfZmlsdGVyOworCisg
ICAgcmV0dXJuIHBhcnNlcjsKK30KKwogdm9pZCBzcGljZV91c2JfYmFja2VuZF9yZXR1cm5fd3Jp
dGVfZGF0YShTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCwgdm9pZCAqZGF0YSkKIHsKICAgICBp
ZiAoY2gtPnVzYnJlZGlyaG9zdCkgewpAQCAtNzk5LDExICs5OTcsMjIgQEAgc3BpY2VfdXNiX2Jh
Y2tlbmRfY2hhbm5lbF9uZXcoU3BpY2VVc2JCYWNrZW5kICpiZSwKICAgICAgICAgICAgIHNwaWNl
X3V0aWxfZ2V0X2RlYnVnKCkgPyB1c2JyZWRpcnBhcnNlcl9kZWJ1ZyA6IHVzYnJlZGlycGFyc2Vy
X3dhcm5pbmcsCiAgICAgICAgICAgICB1c2JyZWRpcmhvc3RfZmxfd3JpdGVfY2Jfb3duc19idWZm
ZXIpOwogICAgICAgICBnX3dhcm5faWZfZmFpbChjaC0+dXNicmVkaXJob3N0ICE9IE5VTEwpOwot
ICAgIH0KLSAgICBpZiAoY2gtPnVzYnJlZGlyaG9zdCkgewotICAgICAgICB1c2JyZWRpcmhvc3Rf
c2V0X2J1ZmZlcmVkX291dHB1dF9zaXplX2NiKGNoLT51c2JyZWRpcmhvc3QsIHVzYnJlZGlyX2J1
ZmZlcmVkX291dHB1dF9zaXplX2NhbGxiYWNrKTsKKyAgICAgICAgaWYgKGNoLT51c2JyZWRpcmhv
c3QpIHsKKyAgICAgICAgICAgIHVzYnJlZGlyaG9zdF9zZXRfYnVmZmVyZWRfb3V0cHV0X3NpemVf
Y2IoY2gtPnVzYnJlZGlyaG9zdCwgdXNicmVkaXJfYnVmZmVyZWRfb3V0cHV0X3NpemVfY2FsbGJh
Y2spOworICAgICAgICAgICAgLy8gZm9yY2UgZmx1c2ggb2YgSEVMTE8gcGFja2V0IGFuZCBjcmVh
dGlvbiBvZiBwYXJzZXIKKyAgICAgICAgICAgIHVzYnJlZGlyaG9zdF93cml0ZV9ndWVzdF9kYXRh
KGNoLT51c2JyZWRpcmhvc3QpOworICAgICAgICB9CiAgICAgfSBlbHNlIHsKLSAgICAgICAgZ19m
cmVlKGNoKTsKKyAgICAgICAgLy8gbm8gcGh5c2ljYWwgZGV2aWNlIHN1cHBvcnQsIG9ubHkgZW11
bGF0ZWQsIGNyZWF0ZSB0aGUKKyAgICAgICAgLy8gcGFyc2VyCisgICAgICAgIGNoLT5wYXJzZXIg
PSBjcmVhdGVfcGFyc2VyKGNoKTsKKyAgICAgICAgaWYgKGNoLT5wYXJzZXIgIT0gTlVMTCkgewor
ICAgICAgICAgICAgaW5pdGlhbGl6ZV9wYXJzZXIoY2gpOworICAgICAgICB9CisgICAgfQorCisg
ICAgaWYgKCFjaC0+cGFyc2VyKSB7CisgICAgICAgIHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxf
ZGVsZXRlKGNoKTsKICAgICAgICAgY2ggPSBOVUxMOwogICAgIH0KIApAQCAtODI4LDkgKzEwMzcs
MTMgQEAgdm9pZCBzcGljZV91c2JfYmFja2VuZF9jaGFubmVsX2RlbGV0ZShTcGljZVVzYkJhY2tl
bmRDaGFubmVsICpjaCkKICAgICBpZiAoY2gtPnVzYnJlZGlyaG9zdCkgewogICAgICAgICB1c2Jy
ZWRpcmhvc3RfY2xvc2UoY2gtPnVzYnJlZGlyaG9zdCk7CiAgICAgfQorICAgIGlmIChjaC0+cGFy
c2VyKSB7CisgICAgICAgIHVzYnJlZGlycGFyc2VyX2Rlc3Ryb3koY2gtPnBhcnNlcik7CisgICAg
fQogCiAgICAgaWYgKGNoLT5ydWxlcykgewotICAgICAgICBnX2ZyZWUoY2gtPnJ1bGVzKTsKKyAg
ICAgICAgLyogcnVsZXMgd2VyZSBhbGxvY2F0ZWQgYnkgdXNicmVkaXJwYXJzZXIgKi8KKyAgICAg
ICAgZnJlZShjaC0+cnVsZXMpOwogICAgIH0KIAogICAgIGdfZnJlZShjaCk7Ci0tIAoyLjIxLjAK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClNwaWNlLWRl
dmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6
Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9zcGljZS1kZXZlbA==
