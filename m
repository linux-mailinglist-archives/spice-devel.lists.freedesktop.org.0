Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 1970187C9B
	for <lists+spice-devel@lfdr.de>; Fri,  9 Aug 2019 16:27:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A23FC6EE19;
	Fri,  9 Aug 2019 14:27:03 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5E3886EE19
 for <spice-devel@lists.freedesktop.org>; Fri,  9 Aug 2019 14:27:02 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx07.intmail.prod.int.phx2.redhat.com
 [10.5.11.22])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 065C93084244;
 Fri,  9 Aug 2019 14:27:02 +0000 (UTC)
Received: from fziglio.remote.csb (ovpn-204-160.brq.redhat.com [10.40.204.160])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 44FE010016EA;
 Fri,  9 Aug 2019 14:26:59 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Fri,  9 Aug 2019 15:26:19 +0100
Message-Id: <20190809142651.2967-2-fziglio@redhat.com>
In-Reply-To: <20190809142651.2967-1-fziglio@redhat.com>
References: <20190809142651.2967-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.22
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.40]); Fri, 09 Aug 2019 14:27:02 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-gtk v2 01/33] usb-redir: define
 interfaces to support emulated devices
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogWXVyaSBCZW5kaXRvdmljaCA8eXVyaS5iZW5kaXRvdmljaEBkYXluaXguY29tPgoKU3Bp
Y2VVc2JCYWNrZW5kRGV2aWNlIHN0cnVjdHVyZSBpcyBleHRlbmRlZCB0byBzdXBwb3J0CmFkZGl0
aW9uYWwga2luZCBvZiBkZXZpY2UgdGhhdCBpcyBlbXVsYXRlZCBieSBTcGljZS1HVEsKYW5kIG5v
dCBwcmVzZW50IGxvY2FsbHkgKGFuZCBkb2VzIG5vdCBoYXZlIGxpYnVzYl9kZXZpY2UpLApzdWNo
IGRldmljZSBoYXMgaW5zdGVhZCBwb2ludGVyIHRvIFNwaWNlVXNiRW11bGF0ZWREZXZpY2UKYWJz
dHJhY3Qgc3RydWN0dXJlLiBTcGVjaWZpYyBpbXBsZW1lbnRhdGlvbiBvZiBzdWNoIGRldmljZQpk
ZXBlbmRzIG9uIGl0cyBkZXZpY2UgdHlwZS4gSW1wbGVtZW50YXRpb24gbW9kdWxlIHdpbGwgZGVm
aW5lCmNvbnN0cnVjdG9yIGZvciBzcGVjaWZpYyBkZXZpY2UgdHlwZS4KRGV2aWNlIHN0cnVjdHVy
ZSBpcyBhYnN0cmFjdCBidXQgYWx3YXlzIHN0YXJ0cyBmcm9tIHRhYmxlIG9mCnZpcnR1YWwgZnVu
Y3Rpb25zIHJlcXVpcmVkIHRvIHJlZGlyZWN0IHN1Y2ggdmlydHVhbCBkZXZpY2UuCgpTaWduZWQt
b2ZmLWJ5OiBZdXJpIEJlbmRpdG92aWNoIDx5dXJpLmJlbmRpdG92aWNoQGRheW5peC5jb20+Ci0t
LQogc3JjL21lc29uLmJ1aWxkICAgICB8ICAgMSArCiBzcmMvdXNiLWJhY2tlbmQuYyAgIHwgMTAy
ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKystCiBzcmMvdXNiLWJh
Y2tlbmQuaCAgIHwgICAzICsrCiBzcmMvdXNiLWVtdWxhdGlvbi5oIHwgIDkxICsrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKwogNCBmaWxlcyBjaGFuZ2VkLCAxOTUgaW5zZXJ0
aW9ucygrKSwgMiBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBzcmMvdXNiLWVtdWxh
dGlvbi5oCgpkaWZmIC0tZ2l0IGEvc3JjL21lc29uLmJ1aWxkIGIvc3JjL21lc29uLmJ1aWxkCmlu
ZGV4IGI0YTY4NzAyLi5mZTE5YzE2MCAxMDA2NDQKLS0tIGEvc3JjL21lc29uLmJ1aWxkCisrKyBi
L3NyYy9tZXNvbi5idWlsZApAQCAtMTIyLDYgKzEyMiw3IEBAIHNwaWNlX2NsaWVudF9nbGliX3Nv
dXJjZXMgPSBbCiAgICd1c2J1dGlsLmMnLAogICAndXNidXRpbC5oJywKICAgJ3VzYi1iYWNrZW5k
LmMnLAorICAndXNiLWVtdWxhdGlvbi5oJywKICAgJ3VzYi1iYWNrZW5kLmgnLAogICAndm1jc3Ry
ZWFtLmMnLAogICAndm1jc3RyZWFtLmgnLApkaWZmIC0tZ2l0IGEvc3JjL3VzYi1iYWNrZW5kLmMg
Yi9zcmMvdXNiLWJhY2tlbmQuYwppbmRleCA5YWM4NTk1Yy4uZDgwZGExNzcgMTAwNjQ0Ci0tLSBh
L3NyYy91c2ItYmFja2VuZC5jCisrKyBiL3NyYy91c2ItYmFja2VuZC5jCkBAIC0zOSw2ICszOSw3
IEBACiAjaW5jbHVkZSAidXNicmVkaXJwYXJzZXIuaCIKICNpbmNsdWRlICJzcGljZS11dGlsLmgi
CiAjaW5jbHVkZSAidXNiLWJhY2tlbmQuaCIKKyNpbmNsdWRlICJ1c2ItZW11bGF0aW9uLmgiCiAj
aW5jbHVkZSAiY2hhbm5lbC11c2JyZWRpci1wcml2LmgiCiAjaW5jbHVkZSAic3BpY2UtY2hhbm5l
bC1wcml2LmgiCiAKQEAgLTQ2LDcgKzQ3LDEwIEBACiAKIHN0cnVjdCBfU3BpY2VVc2JCYWNrZW5k
RGV2aWNlCiB7CisgICAgLyogUG9pbnRlciB0byBkZXZpY2UuIEVpdGhlciByZWFsIGRldmljZSAo
bGlidXNiX2RldmljZSkKKyAgICAgKiBvciBlbXVsYXRlZCBvbmUgKGVkZXYpICovCiAgICAgbGli
dXNiX2RldmljZSAqbGlidXNiX2RldmljZTsKKyAgICBTcGljZVVzYkVtdWxhdGVkRGV2aWNlICpl
ZGV2OwogICAgIGdpbnQgcmVmX2NvdW50OwogICAgIFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmF0
dGFjaGVkX3RvOwogICAgIFVzYkRldmljZUluZm9ybWF0aW9uIGRldmljZV9pbmZvOwpAQCAtNjYs
NiArNzAsMTAgQEAgc3RydWN0IF9TcGljZVVzYkJhY2tlbmQKICAgICBsaWJ1c2JfZGV2aWNlICoq
bGlidXNiX2RldmljZV9saXN0OwogICAgIGdpbnQgcmVkaXJlY3Rpbmc7CiAjZW5kaWYKKworICAg
IC8qIE1hc2sgb2YgYWxsb2NhdGVkIGRldmljZSwgYSBzcGVjaWZpYyBiaXQgc2V0IHRvIDEgdG8g
aW5kaWNhdGUgdGhhdCB0aGUgZGV2aWNlIGF0CisgICAgICogdGhhdCBhZGRyZXNzIGlzIGFsbG9j
YXRlZCAqLworICAgIHVpbnQzMl90IG93bl9kZXZpY2VzX21hc2s7CiB9OwogCiBzdHJ1Y3QgX1Nw
aWNlVXNiQmFja2VuZENoYW5uZWwKQEAgLTQwOCw2ICs0MTYsOCBAQCBTcGljZVVzYkJhY2tlbmQg
KnNwaWNlX3VzYl9iYWNrZW5kX25ldyhHRXJyb3IgKiplcnJvcikKICAgICAgICAgbGlidXNiX3Nl
dF9vcHRpb24oYmUtPmxpYnVzYl9jb250ZXh0LCBMSUJVU0JfT1BUSU9OX1VTRV9VU0JESyk7CiAj
ZW5kaWYKICNlbmRpZgorICAgICAgICAvKiBleGNsdWRlIGFkZHJlc3NlcyAwIChyZXNlcnZlZCkg
YW5kIDEgKHJvb3QgaHViKSAqLworICAgICAgICBiZS0+b3duX2RldmljZXNfbWFzayA9IDM7CiAg
ICAgfQogICAgIFNQSUNFX0RFQlVHKCIlcyA8PCIsIF9fRlVOQ1RJT05fXyk7CiAgICAgcmV0dXJu
IGJlOwpAQCAtNTI0LDggKzUzNCwxMyBAQCB2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV91
bnJlZihTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldikKIHsKICAgICBMT1VEX0RFQlVHKCIlcyA+
PiAlcCglZCkiLCBfX0ZVTkNUSU9OX18sIGRldiwgZGV2LT5yZWZfY291bnQpOwogICAgIGlmIChn
X2F0b21pY19pbnRfZGVjX2FuZF90ZXN0KCZkZXYtPnJlZl9jb3VudCkpIHsKLSAgICAgICAgbGli
dXNiX3VucmVmX2RldmljZShkZXYtPmxpYnVzYl9kZXZpY2UpOwotICAgICAgICBMT1VEX0RFQlVH
KCIlcyBmcmVlaW5nICVwIChsaWJ1c2IgJXApIiwgX19GVU5DVElPTl9fLCBkZXYsIGRldi0+bGli
dXNiX2RldmljZSk7CisgICAgICAgIGlmIChkZXYtPmxpYnVzYl9kZXZpY2UpIHsKKyAgICAgICAg
ICAgIGxpYnVzYl91bnJlZl9kZXZpY2UoZGV2LT5saWJ1c2JfZGV2aWNlKTsKKyAgICAgICAgICAg
IExPVURfREVCVUcoIiVzIGZyZWVpbmcgJXAgKGxpYnVzYiAlcCkiLCBfX0ZVTkNUSU9OX18sIGRl
diwgZGV2LT5saWJ1c2JfZGV2aWNlKTsKKyAgICAgICAgfQorICAgICAgICBpZiAoZGV2LT5lZGV2
KSB7CisgICAgICAgICAgICBkZXZpY2Vfb3BzKGRldi0+ZWRldiktPnVucmVhbGl6ZShkZXYtPmVk
ZXYpOworICAgICAgICB9CiAgICAgICAgIGdfZnJlZShkZXYpOwogICAgIH0KIH0KQEAgLTgyNCw0
ICs4MzksODcgQEAgc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9nZXRfZ3Vlc3RfZmlsdGVyKFNw
aWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLAogICAgIH0KIH0KIAordm9pZCBzcGljZV91c2JfYmFj
a2VuZF9kZXZpY2VfcmVwb3J0X2NoYW5nZShTcGljZVVzYkJhY2tlbmQgKmJlLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZVVzYkJhY2tlbmREZXZpY2Ug
KmRldikKK3sKKyAgICBnY2hhciAqZGVzYzsKKyAgICBnX3JldHVybl9pZl9mYWlsKGRldiAmJiBk
ZXYtPmVkZXYpOworCisgICAgZGVzYyA9IGRldmljZV9vcHMoZGV2LT5lZGV2KS0+Z2V0X3Byb2R1
Y3RfZGVzY3JpcHRpb24oZGV2LT5lZGV2KTsKKyAgICBTUElDRV9ERUJVRygiJXM6ICVzIiwgX19G
VU5DVElPTl9fLCBkZXNjKTsKKyAgICBnX2ZyZWUoZGVzYyk7Cit9CisKK3ZvaWQgc3BpY2VfdXNi
X2JhY2tlbmRfZGV2aWNlX2VqZWN0KFNwaWNlVXNiQmFja2VuZCAqYmUsIFNwaWNlVXNiQmFja2Vu
ZERldmljZSAqZGV2KQoreworICAgIGdfcmV0dXJuX2lmX2ZhaWwoZGV2ICYmIGRldi0+ZWRldik7
CisKKyAgICBpZiAoYmUtPmhvdHBsdWdfY2FsbGJhY2spIHsKKyAgICAgICAgYmUtPmhvdHBsdWdf
Y2FsbGJhY2soYmUtPmhvdHBsdWdfdXNlcl9kYXRhLCBkZXYsIEZBTFNFKTsKKyAgICB9CisgICAg
YmUtPm93bl9kZXZpY2VzX21hc2sgJj0gfigxIDw8IGRldi0+ZGV2aWNlX2luZm8uYWRkcmVzcyk7
CisKKyAgICBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfdW5yZWYoZGV2KTsKK30KKworU3BpY2VV
c2JCYWNrZW5kRGV2aWNlKgorc3BpY2VfdXNiX2JhY2tlbmRfY3JlYXRlX2VtdWxhdGVkX2Rldmlj
ZShTcGljZVVzYkJhY2tlbmQgKmJlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBTcGljZVVzYkVtdWxhdGVkRGV2aWNlQ3JlYXRlIGNyZWF0ZV9wcm9jLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICpjcmVhdGVfcGFyYW1zLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHRXJyb3IgKiplcnIpCit7
CisgICAgU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZWRldjsKKyAgICBTcGljZVVzYkJhY2tlbmRE
ZXZpY2UgKmRldjsKKyAgICBzdHJ1Y3QgbGlidXNiX2RldmljZV9kZXNjcmlwdG9yICpkZXNjOwor
ICAgIHVpbnQxNl90IGRldmljZV9kZXNjX3NpemU7CisgICAgdWludDhfdCBhZGRyZXNzID0gMDsK
KworICAgIGlmIChiZS0+b3duX2RldmljZXNfbWFzayA9PSAweGZmZmZmZmZmKSB7CisgICAgICAg
IGdfc2V0X2Vycm9yKGVyciwgU1BJQ0VfQ0xJRU5UX0VSUk9SLCBTUElDRV9DTElFTlRfRVJST1Jf
RkFJTEVELAorICAgICAgICAgICAgICAgICAgICBfKCJjYW4ndCBjcmVhdGUgZGV2aWNlIC0gbGlt
aXQgcmVhY2hlZCIpKTsKKyAgICAgICAgcmV0dXJuIE5VTEw7CisgICAgfQorICAgIGZvciAoYWRk
cmVzcyA9IDA7IGFkZHJlc3MgPCAzMjsgKythZGRyZXNzKSB7CisgICAgICAgIGlmICh+YmUtPm93
bl9kZXZpY2VzX21hc2sgJiAoMSA8PCBhZGRyZXNzKSkgeworICAgICAgICAgICAgYnJlYWs7Cisg
ICAgICAgIH0KKyAgICB9CisKKyAgICBkZXYgPSBnX25ldzAoU3BpY2VVc2JCYWNrZW5kRGV2aWNl
LCAxKTsKKyAgICBkZXYtPmRldmljZV9pbmZvLmJ1cyA9IEJVU19OVU1CRVJfRk9SX0VNVUxBVEVE
X1VTQjsKKyAgICBkZXYtPmRldmljZV9pbmZvLmFkZHJlc3MgPSBhZGRyZXNzOworICAgIGRldi0+
cmVmX2NvdW50ID0gMTsKKworICAgIGRldi0+ZWRldiA9IGVkZXYgPSBjcmVhdGVfcHJvYyhiZSwg
ZGV2LCBjcmVhdGVfcGFyYW1zLCBlcnIpOworICAgIGlmIChlZGV2ID09IE5VTEwpIHsKKyAgICAg
ICAgc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX3VucmVmKGRldik7CisgICAgICAgIHJldHVybiBO
VUxMOworICAgIH0KKworICAgIGlmICghZGV2aWNlX29wcyhlZGV2KS0+Z2V0X2Rlc2NyaXB0b3Io
ZWRldiwgTElCVVNCX0RUX0RFVklDRSwgMCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICh2b2lkICoqKSZkZXNjLCAmZGV2aWNlX2Rlc2Nfc2l6ZSkKKyAgICAgICAg
fHwgZGV2aWNlX2Rlc2Nfc2l6ZSAhPSBzaXplb2YoKmRlc2MpKSB7CisKKyAgICAgICAgc3BpY2Vf
dXNiX2JhY2tlbmRfZGV2aWNlX3VucmVmKGRldik7CisgICAgICAgIGdfc2V0X2Vycm9yKGVyciwg
U1BJQ0VfQ0xJRU5UX0VSUk9SLCBTUElDRV9DTElFTlRfRVJST1JfRkFJTEVELAorICAgICAgICAg
ICAgICAgICAgICBfKCJjYW4ndCBjcmVhdGUgZGV2aWNlIC0gaW50ZXJuYWwgZXJyb3IiKSk7Cisg
ICAgICAgIHJldHVybiBOVUxMOworICAgIH0KKworICAgIGJlLT5vd25fZGV2aWNlc19tYXNrIHw9
IDEgPDwgYWRkcmVzczsKKworICAgIGRldi0+ZGV2aWNlX2luZm8udmlkID0gZGVzYy0+aWRWZW5k
b3I7CisgICAgZGV2LT5kZXZpY2VfaW5mby5waWQgPSBkZXNjLT5pZFByb2R1Y3Q7CisgICAgZGV2
LT5kZXZpY2VfaW5mby5iY2RVU0IgPSBkZXNjLT5iY2RVU0I7CisgICAgZGV2LT5kZXZpY2VfaW5m
by5jbGFzcyA9IGRlc2MtPmJEZXZpY2VDbGFzczsKKyAgICBkZXYtPmRldmljZV9pbmZvLnN1YmNs
YXNzID0gZGVzYy0+YkRldmljZVN1YkNsYXNzOworICAgIGRldi0+ZGV2aWNlX2luZm8ucHJvdG9j
b2wgPSBkZXNjLT5iRGV2aWNlUHJvdG9jb2w7CisKKyAgICBpZiAoYmUtPmhvdHBsdWdfY2FsbGJh
Y2spIHsKKyAgICAgICAgYmUtPmhvdHBsdWdfY2FsbGJhY2soYmUtPmhvdHBsdWdfdXNlcl9kYXRh
LCBkZXYsIFRSVUUpOworICAgIH0KKworICAgIHJldHVybiBkZXY7Cit9CisKICNlbmRpZiAvKiBV
U0JfUkVESVIgKi8KZGlmZiAtLWdpdCBhL3NyYy91c2ItYmFja2VuZC5oIGIvc3JjL3VzYi1iYWNr
ZW5kLmgKaW5kZXggNjlhNDkwYjUuLjYzYjkyMDIwIDEwMDY0NAotLS0gYS9zcmMvdXNiLWJhY2tl
bmQuaAorKysgYi9zcmMvdXNiLWJhY2tlbmQuaApAQCAtMzEsMTIgKzMxLDE1IEBAIHR5cGVkZWYg
c3RydWN0IF9TcGljZVVzYkJhY2tlbmQgU3BpY2VVc2JCYWNrZW5kOwogdHlwZWRlZiBzdHJ1Y3Qg
X1NwaWNlVXNiQmFja2VuZERldmljZSBTcGljZVVzYkJhY2tlbmREZXZpY2U7CiB0eXBlZGVmIHN0
cnVjdCBfU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCBTcGljZVVzYkJhY2tlbmRDaGFubmVsOwogCisj
ZGVmaW5lIEJVU19OVU1CRVJfRk9SX0VNVUxBVEVEX1VTQiBHX01BWFVJTlQxNgorCiB0eXBlZGVm
IHN0cnVjdCBVc2JEZXZpY2VJbmZvcm1hdGlvbgogewogICAgIHVpbnQxNl90IGJ1czsKICAgICB1
aW50MTZfdCBhZGRyZXNzOwogICAgIHVpbnQxNl90IHZpZDsKICAgICB1aW50MTZfdCBwaWQ7Cisg
ICAgdWludDE2X3QgYmNkVVNCOwogICAgIHVpbnQ4X3QgY2xhc3M7CiAgICAgdWludDhfdCBzdWJj
bGFzczsKICAgICB1aW50OF90IHByb3RvY29sOwpkaWZmIC0tZ2l0IGEvc3JjL3VzYi1lbXVsYXRp
b24uaCBiL3NyYy91c2ItZW11bGF0aW9uLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAw
MDAwMDAuLjllNjI2YTI0Ci0tLSAvZGV2L251bGwKKysrIGIvc3JjL3VzYi1lbXVsYXRpb24uaApA
QCAtMCwwICsxLDkxIEBACisvKiAtKi0gTW9kZTogQzsgYy1iYXNpYy1vZmZzZXQ6IDQ7IGluZGVu
dC10YWJzLW1vZGU6IG5pbCAtKi0gKi8KKy8qCisgICAgQ29weXJpZ2h0IChDKSAyMDE5IFJlZCBI
YXQsIEluYy4KKworICAgIFJlZCBIYXQgQXV0aG9yczoKKyAgICBZdXJpIEJlbmRpdG92aWNoPHli
ZW5kaXRvQHJlZGhhdC5jb20+CisKKyAgICBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsg
eW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCisgICAgbW9kaWZ5IGl0IHVuZGVyIHRoZSB0
ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYworICAgIExpY2Vuc2UgYXMgcHVi
bGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlcgorICAgIHZlcnNp
b24gMi4xIG9mIHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJz
aW9uLgorCisgICAgVGhpcyBsaWJyYXJ5IGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQg
aXQgd2lsbCBiZSB1c2VmdWwsCisgICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0
IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKKyAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklU
TkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQorICAgIExlc3NlciBH
ZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCisKKyAgICBZb3Ugc2hvdWxk
IGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCisg
ICAgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCBzZWUgPGh0dHA6Ly93
d3cuZ251Lm9yZy9saWNlbnNlcy8+LgorKi8KKworI2lmbmRlZiBfX1NQSUNFX1VTQl9FTVVMQVRJ
T05fSF9fCisjZGVmaW5lIF9fU1BJQ0VfVVNCX0VNVUxBVElPTl9IX18KKworI2luY2x1ZGUgInVz
YnJlZGlycGFyc2VyLmgiCisjaW5jbHVkZSAidXNiLWJhY2tlbmQuaCIKKwordHlwZWRlZiBzdHJ1
Y3QgU3BpY2VVc2JFbXVsYXRlZERldmljZSBTcGljZVVzYkVtdWxhdGVkRGV2aWNlOwordHlwZWRl
ZiBTcGljZVVzYkVtdWxhdGVkRGV2aWNlKgorKCpTcGljZVVzYkVtdWxhdGVkRGV2aWNlQ3JlYXRl
KShTcGljZVVzYkJhY2tlbmQgKmJlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBT
cGljZVVzYkJhY2tlbmREZXZpY2UgKnBhcmVudCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgdm9pZCAqY3JlYXRlX3BhcmFtcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgR0Vycm9yICoqZXJyKTsKKworLyoKKyAgICBmdW5jdGlvbiB0YWJsZSBmb3IgZW11bGF0ZWQg
VVNCIGRldmljZQorICAgIG11c3QgYmUgZmlyc3QgbWVtYmVyIG9mIGRldmljZSBzdHJ1Y3R1cmUK
KyAgICBhbGwgZnVuY3Rpb25zIGFyZSBtYW5kYXRvcnkgZm9yIGltcGxlbWVudGF0aW9uCisqLwor
dHlwZWRlZiBzdHJ1Y3QgVXNiRGV2aWNlT3BzIHsKKyAgICBnYm9vbGVhbiAoKmdldF9kZXNjcmlw
dG9yKShTcGljZVVzYkVtdWxhdGVkRGV2aWNlICpkZXZpY2UsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdWludDhfdCB0eXBlLCB1aW50OF90IGluZGV4LAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHZvaWQgKipidWZmZXIsIHVpbnQxNl90ICpzaXplKTsKKyAgICBnY2hh
ciAqICgqZ2V0X3Byb2R1Y3RfZGVzY3JpcHRpb24pKFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmRl
dmljZSk7CisgICAgdm9pZCAoKmF0dGFjaCkoU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZGV2aWNl
LCBzdHJ1Y3QgdXNicmVkaXJwYXJzZXIgKnBhcnNlcik7CisgICAgdm9pZCAoKnJlc2V0KShTcGlj
ZVVzYkVtdWxhdGVkRGV2aWNlICpkZXZpY2UpOworICAgIC8qCisgICAgICAgIHByb2Nlc3Npbmcg
aXMgc3luY2hyb25vdXMsIGRlZmF1bHQgPSBzdGFsbDoKKyAgICAgICAgLSByZXR1cm4gc3VjY2Vz
cyB3aXRob3V0IGRhdGE6IHNldCBzdGF0dXMgdG8gMAorICAgICAgICAtIHJldHVybiBlcnJvciAt
IHNldCBzdGF0dXMgdG8gZXJyb3IKKyAgICAgICAgLSByZXR1cm4gc3VjY2VzcyB3aXRoIGRhdGEg
LSBzZXQgc3RhdHVzIHRvIDAsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBz
ZXQgYnVmZmVyIHRvIHNvbWUgYnVmZmVyCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBzZXQgbGVuZ3RoIHRvIG91dCBsZW4KKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHRydW5jYXRpb24gaXMgYXV0b21hdGljCisgICAgKi8KKyAgICB2b2lkICgqY29udHJv
bF9yZXF1ZXN0KShTcGljZVVzYkVtdWxhdGVkRGV2aWNlICpkZXZpY2UsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdWludDhfdCAqZGF0YSwgaW50IGRhdGFfbGVuLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHN0cnVjdCB1c2JfcmVkaXJfY29udHJvbF9wYWNrZXRfaGVhZGVyICpo
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKipidWZmZXIpOworICAgIC8qCisg
ICAgICAgIHByb2Nlc3NpbmcgaXMgc3luY2hyb25vdXM6CisgICAgICAgIC0gc2V0IGgtPnN0YXR1
cyB0byByZXN1bHRpbmcgc3RhdHVzLCBkZWZhdWx0ID0gc3RhbGwKKyAgICAqLworICAgIHZvaWQg
KCpidWxrX291dF9yZXF1ZXN0KShTcGljZVVzYkVtdWxhdGVkRGV2aWNlICpkZXZpY2UsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ4X3QgZXAsIHVpbnQ4X3QgKmRhdGEsIGludCBk
YXRhX2xlbiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDhfdCAqc3RhdHVzKTsK
KyAgICAvKgorICAgICAgICBpZiByZXR1cm5zIHRydWUsIHByb2Nlc3NpbmcgaXMgYXN5bmNocm9u
b3VzCisgICAgICAgIG90aGVyd2lzZSBoZWFkZXIgY29udGFpbnMgZXJyb3Igc3RhdHVzCisgICAg
Ki8KKyAgICBnYm9vbGVhbiAoKmJ1bGtfaW5fcmVxdWVzdCkoU3BpY2VVc2JFbXVsYXRlZERldmlj
ZSAqZGV2aWNlLCB1aW50NjRfdCBpZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1
Y3QgdXNiX3JlZGlyX2J1bGtfcGFja2V0X2hlYWRlciAqYnVsa19oZWFkZXIpOworICAgIHZvaWQg
KCpjYW5jZWxfcmVxdWVzdCkoU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZGV2aWNlLCB1aW50NjRf
dCBpZCk7CisgICAgdm9pZCAoKmRldGFjaCkoU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZGV2aWNl
KTsKKyAgICB2b2lkICgqdW5yZWFsaXplKShTcGljZVVzYkVtdWxhdGVkRGV2aWNlICpkZXZpY2Up
OworfSBVc2JEZXZpY2VPcHM7CisKK3N0YXRpYyBpbmxpbmUgY29uc3QgVXNiRGV2aWNlT3BzICpk
ZXZpY2Vfb3BzKFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmRldikKK3sKKyAgICByZXR1cm4gKGNv
bnN0IFVzYkRldmljZU9wcyAqKWRldjsKK30KKworU3BpY2VVc2JCYWNrZW5kRGV2aWNlKgorc3Bp
Y2VfdXNiX2JhY2tlbmRfY3JlYXRlX2VtdWxhdGVkX2RldmljZShTcGljZVVzYkJhY2tlbmQgKmJl
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGljZVVzYkVtdWxh
dGVkRGV2aWNlQ3JlYXRlIGNyZWF0ZV9wcm9jLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB2b2lkICpjcmVhdGVfcGFyYW1zLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBHRXJyb3IgKiplcnIpOwordm9pZCBzcGljZV91c2JfYmFja2Vu
ZF9kZXZpY2VfZWplY3QoU3BpY2VVc2JCYWNrZW5kICpiZSwgU3BpY2VVc2JCYWNrZW5kRGV2aWNl
ICpkZXZpY2UpOwordm9pZCBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfcmVwb3J0X2NoYW5nZShT
cGljZVVzYkJhY2tlbmQgKmJlLCBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldmljZSk7CisKKyNl
bmRpZgotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpTcGljZS1kZXZlbCBtYWlsaW5nIGxpc3QKU3BpY2UtZGV2ZWxAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
c3BpY2UtZGV2ZWw=
