Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E9B8F87C9E
	for <lists+spice-devel@lfdr.de>; Fri,  9 Aug 2019 16:27:12 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5DD726EE1D;
	Fri,  9 Aug 2019 14:27:11 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1DB886EE1C
 for <spice-devel@lists.freedesktop.org>; Fri,  9 Aug 2019 14:27:10 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx07.intmail.prod.int.phx2.redhat.com
 [10.5.11.22])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id B58993003C55;
 Fri,  9 Aug 2019 14:27:09 +0000 (UTC)
Received: from fziglio.remote.csb (ovpn-204-160.brq.redhat.com [10.40.204.160])
 by smtp.corp.redhat.com (Postfix) with ESMTP id A161810001BD;
 Fri,  9 Aug 2019 14:27:07 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Fri,  9 Aug 2019 15:26:22 +0100
Message-Id: <20190809142651.2967-5-fziglio@redhat.com>
In-Reply-To: <20190809142651.2967-1-fziglio@redhat.com>
References: <20190809142651.2967-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.22
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.48]); Fri, 09 Aug 2019 14:27:09 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-gtk v2 04/33] usb-redir: move
 implementation of device description to USB backend
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogWXVyaSBCZW5kaXRvdmljaCA8eXVyaS5iZW5kaXRvdmljaEBkYXluaXguY29tPgoKRm9y
IGxvY2FsIFVTQiBkZXZpY2UgdGhlIFVTQiBiYWNrZW5kIHJldHVybnMgdGhlIHNhbWUgZGV2aWNl
CmRlc2NyaXB0aW9uIGFzIHNwaWNlLXVzYi1tYW5hZ2VyIGRpZCwgZm9yIGVtdWxhdGVkIGRldmlj
ZXMgaXQKdXNlcyB0aGUgZGVzY3JpcHRpb24gcHJvdmlkZWQgYnkgZGV2aWNlJ3MgaW1wbGVtZW50
YXRpb24uCgpTaWduZWQtb2ZmLWJ5OiBZdXJpIEJlbmRpdG92aWNoIDx5dXJpLmJlbmRpdG92aWNo
QGRheW5peC5jb20+CkFja2VkLWJ5OiBGcmVkaWFubyBaaWdsaW8gPGZ6aWdsaW9AcmVkaGF0LmNv
bT4KLS0tCiBzcmMvdXNiLWJhY2tlbmQuYyAgICAgICAgfCA0MSArKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrCiBzcmMvdXNiLWJhY2tlbmQuaCAgICAgICAgfCAgMSArCiBz
cmMvdXNiLWRldmljZS1tYW5hZ2VyLmMgfCAyOSArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
CiAzIGZpbGVzIGNoYW5nZWQsIDQzIGluc2VydGlvbnMoKyksIDI4IGRlbGV0aW9ucygtKQoKZGlm
ZiAtLWdpdCBhL3NyYy91c2ItYmFja2VuZC5jIGIvc3JjL3VzYi1iYWNrZW5kLmMKaW5kZXggN2Y5
ZmNjMTcuLmFhMTFjNzkxIDEwMDY0NAotLS0gYS9zcmMvdXNiLWJhY2tlbmQuYworKysgYi9zcmMv
dXNiLWJhY2tlbmQuYwpAQCAtNDIsNiArNDIsNyBAQAogI2luY2x1ZGUgInVzYi1lbXVsYXRpb24u
aCIKICNpbmNsdWRlICJjaGFubmVsLXVzYnJlZGlyLXByaXYuaCIKICNpbmNsdWRlICJzcGljZS1j
aGFubmVsLXByaXYuaCIKKyNpbmNsdWRlICJ1c2J1dGlsLmgiCiAKICNkZWZpbmUgTE9VRF9ERUJV
Ryh4LCAuLi4pCiAKQEAgLTg0NCw2ICs4NDUsNDYgQEAgc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5l
bF9nZXRfZ3Vlc3RfZmlsdGVyKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLAogICAgIH0KIH0K
IAorZ2NoYXIgKiBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfZ2V0X2Rlc2NyaXB0aW9uKFNwaWNl
VXNiQmFja2VuZERldmljZSAqZGV2LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGNvbnN0IGdjaGFyICpmb3JtYXQpCit7CisgICAgZ3VpbnQxNiBidXMs
IGFkZHJlc3MsIHZpZCwgcGlkOworICAgIGdjaGFyICpkZXNjcmlwdGlvbiwgKmRlc2NyaXB0b3Is
ICptYW51ZmFjdHVyZXIgPSBOVUxMLCAqcHJvZHVjdCA9IE5VTEw7CisKKyAgICBnX3JldHVybl92
YWxfaWZfZmFpbChkZXYgIT0gTlVMTCwgTlVMTCk7CisKKyAgICBidXMgICAgID0gZGV2LT5kZXZp
Y2VfaW5mby5idXM7CisgICAgYWRkcmVzcyA9IGRldi0+ZGV2aWNlX2luZm8uYWRkcmVzczsKKyAg
ICB2aWQgICAgID0gZGV2LT5kZXZpY2VfaW5mby52aWQ7CisgICAgcGlkICAgICA9IGRldi0+ZGV2
aWNlX2luZm8ucGlkOworCisgICAgaWYgKCh2aWQgPiAwKSAmJiAocGlkID4gMCkpIHsKKyAgICAg
ICAgZGVzY3JpcHRvciA9IGdfc3RyZHVwX3ByaW50ZigiWyUwNHg6JTA0eF0iLCB2aWQsIHBpZCk7
CisgICAgfSBlbHNlIHsKKyAgICAgICAgZGVzY3JpcHRvciA9IGdfc3RyZHVwKCIiKTsKKyAgICB9
CisKKyAgICBpZiAoZGV2LT5saWJ1c2JfZGV2aWNlKSB7CisgICAgICAgIHNwaWNlX3VzYl91dGls
X2dldF9kZXZpY2Vfc3RyaW5ncyhidXMsIGFkZHJlc3MsIHZpZCwgcGlkLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJm1hbnVmYWN0dXJlciwgJnByb2R1Y3QpOwor
ICAgIH0gZWxzZSB7CisgICAgICAgIHByb2R1Y3QgPSBkZXZpY2Vfb3BzKGRldi0+ZWRldiktPmdl
dF9wcm9kdWN0X2Rlc2NyaXB0aW9uKGRldi0+ZWRldik7CisgICAgfQorCisgICAgaWYgKCFmb3Jt
YXQpIHsKKyAgICAgICAgZm9ybWF0ID0gXygiJXMgJXMgJXMgYXQgJWQtJWQiKTsKKyAgICB9CisK
KyAgICBkZXNjcmlwdGlvbiA9IGdfc3RyZHVwX3ByaW50Zihmb3JtYXQsIG1hbnVmYWN0dXJlciA/
IG1hbnVmYWN0dXJlciA6ICIiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBy
b2R1Y3QsIGRlc2NyaXB0b3IsIGJ1cywgYWRkcmVzcyk7CisKKyAgICBnX2ZyZWUobWFudWZhY3R1
cmVyKTsKKyAgICBnX2ZyZWUoZGVzY3JpcHRvcik7CisgICAgZ19mcmVlKHByb2R1Y3QpOworCisg
ICAgcmV0dXJuIGRlc2NyaXB0aW9uOworfQorCiB2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2Rldmlj
ZV9yZXBvcnRfY2hhbmdlKFNwaWNlVXNiQmFja2VuZCAqYmUsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2KQogewpk
aWZmIC0tZ2l0IGEvc3JjL3VzYi1iYWNrZW5kLmggYi9zcmMvdXNiLWJhY2tlbmQuaAppbmRleCA2
M2I5MjAyMC4uODdlZmQ1MTIgMTAwNjQ0Ci0tLSBhL3NyYy91c2ItYmFja2VuZC5oCisrKyBiL3Ny
Yy91c2ItYmFja2VuZC5oCkBAIC05MSw2ICs5MSw3IEBAIHZvaWQgc3BpY2VfdXNiX2JhY2tlbmRf
Y2hhbm5lbF9nZXRfZ3Vlc3RfZmlsdGVyKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RydWN0
IHVzYnJlZGlyZmlsdGVyX3J1bGUgICoqcnVsZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBpbnQgKmNvdW50KTsKIHZvaWQgc3BpY2VfdXNiX2JhY2tl
bmRfcmV0dXJuX3dyaXRlX2RhdGEoU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gsIHZvaWQgKmRh
dGEpOworZ2NoYXIgKnNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9nZXRfZGVzY3JpcHRpb24oU3Bp
Y2VVc2JCYWNrZW5kRGV2aWNlICpkZXYsIGNvbnN0IGdjaGFyICpmb3JtYXQpOwogCiBHX0VORF9E
RUNMUwogCmRpZmYgLS1naXQgYS9zcmMvdXNiLWRldmljZS1tYW5hZ2VyLmMgYi9zcmMvdXNiLWRl
dmljZS1tYW5hZ2VyLmMKaW5kZXggYjNkYjVkZTYuLjU4MzRlMDMyIDEwMDY0NAotLS0gYS9zcmMv
dXNiLWRldmljZS1tYW5hZ2VyLmMKKysrIGIvc3JjL3VzYi1kZXZpY2UtbWFuYWdlci5jCkBAIC0z
Miw3ICszMiw2IEBACiAjZW5kaWYKIAogI2luY2x1ZGUgImNoYW5uZWwtdXNicmVkaXItcHJpdi5o
IgotI2luY2x1ZGUgInVzYnV0aWwuaCIKICNlbmRpZgogCiAjaW5jbHVkZSAic3BpY2Utc2Vzc2lv
bi1wcml2LmgiCkBAIC0xNDM5LDM1ICsxNDM4LDkgQEAgc3BpY2VfdXNiX2RldmljZV9tYW5hZ2Vy
X2Nhbl9yZWRpcmVjdF9kZXZpY2UoU3BpY2VVc2JEZXZpY2VNYW5hZ2VyICAqc2VsZiwKIGdjaGFy
ICpzcGljZV91c2JfZGV2aWNlX2dldF9kZXNjcmlwdGlvbihTcGljZVVzYkRldmljZSAqZGV2aWNl
LCBjb25zdCBnY2hhciAqZm9ybWF0KQogewogI2lmZGVmIFVTRV9VU0JSRURJUgotICAgIGd1aW50
MTYgYnVzLCBhZGRyZXNzLCB2aWQsIHBpZDsKLSAgICBnY2hhciAqZGVzY3JpcHRpb24sICpkZXNj
cmlwdG9yLCAqbWFudWZhY3R1cmVyID0gTlVMTCwgKnByb2R1Y3QgPSBOVUxMOwotCiAgICAgZ19y
ZXR1cm5fdmFsX2lmX2ZhaWwoZGV2aWNlICE9IE5VTEwsIE5VTEwpOwogCi0gICAgYnVzICAgICA9
IHNwaWNlX3VzYl9kZXZpY2VfZ2V0X2J1c251bShkZXZpY2UpOwotICAgIGFkZHJlc3MgPSBzcGlj
ZV91c2JfZGV2aWNlX2dldF9kZXZhZGRyKGRldmljZSk7Ci0gICAgdmlkICAgICA9IHNwaWNlX3Vz
Yl9kZXZpY2VfZ2V0X3ZpZChkZXZpY2UpOwotICAgIHBpZCAgICAgPSBzcGljZV91c2JfZGV2aWNl
X2dldF9waWQoZGV2aWNlKTsKLQotICAgIGlmICgodmlkID4gMCkgJiYgKHBpZCA+IDApKSB7Ci0g
ICAgICAgIGRlc2NyaXB0b3IgPSBnX3N0cmR1cF9wcmludGYoIlslMDR4OiUwNHhdIiwgdmlkLCBw
aWQpOwotICAgIH0gZWxzZSB7Ci0gICAgICAgIGRlc2NyaXB0b3IgPSBnX3N0cmR1cCgiIik7Ci0g
ICAgfQotCi0gICAgc3BpY2VfdXNiX3V0aWxfZ2V0X2RldmljZV9zdHJpbmdzKGJ1cywgYWRkcmVz
cywgdmlkLCBwaWQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZtYW51
ZmFjdHVyZXIsICZwcm9kdWN0KTsKLQotICAgIGlmICghZm9ybWF0KQotICAgICAgICBmb3JtYXQg
PSBfKCIlcyAlcyAlcyBhdCAlZC0lZCIpOwotCi0gICAgZGVzY3JpcHRpb24gPSBnX3N0cmR1cF9w
cmludGYoZm9ybWF0LCBtYW51ZmFjdHVyZXIsIHByb2R1Y3QsIGRlc2NyaXB0b3IsIGJ1cywgYWRk
cmVzcyk7Ci0KLSAgICBnX2ZyZWUobWFudWZhY3R1cmVyKTsKLSAgICBnX2ZyZWUoZGVzY3JpcHRv
cik7Ci0gICAgZ19mcmVlKHByb2R1Y3QpOwotCi0gICAgcmV0dXJuIGRlc2NyaXB0aW9uOworICAg
IHJldHVybiBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfZ2V0X2Rlc2NyaXB0aW9uKGRldmljZS0+
YmRldiwgZm9ybWF0KTsKICNlbHNlCiAgICAgcmV0dXJuIE5VTEw7CiAjZW5kaWYKLS0gCjIuMjAu
MQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KU3BpY2Ut
ZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
