Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4ECF69CBC3
	for <lists+spice-devel@lfdr.de>; Mon, 26 Aug 2019 10:39:56 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9CEAF89AC3;
	Mon, 26 Aug 2019 08:39:54 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C992989AB6
 for <spice-devel@lists.freedesktop.org>; Mon, 26 Aug 2019 08:39:53 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx08.intmail.prod.int.phx2.redhat.com
 [10.5.11.23])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 764F3307D91E
 for <spice-devel@lists.freedesktop.org>; Mon, 26 Aug 2019 08:39:53 +0000 (UTC)
Received: from localhost.localdomain.com (unknown [10.35.4.83])
 by smtp.corp.redhat.com (Postfix) with ESMTP id D720F19C70
 for <spice-devel@lists.freedesktop.org>; Mon, 26 Aug 2019 08:39:52 +0000 (UTC)
From: Snir Sheriber <ssheribe@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Mon, 26 Aug 2019 11:39:47 +0300
Message-Id: <20190826083948.29309-2-ssheribe@redhat.com>
In-Reply-To: <20190826083948.29309-1-ssheribe@redhat.com>
References: <20190826083948.29309-1-ssheribe@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.23
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.48]); Mon, 26 Aug 2019 08:39:53 +0000 (UTC)
Subject: [Spice-devel] [RFC spice-streaminh-agent 2/3] mjpeg-fallback: Use
 Xlib capture helper
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

LS0tCiBzcmMvTWFrZWZpbGUuYW0gICAgICAgIHwgIDQgKysrKwogc3JjL21qcGVnLWZhbGxiYWNr
LmNwcCB8IDM4ICsrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAyIGZpbGVz
IGNoYW5nZWQsIDE3IGluc2VydGlvbnMoKyksIDI1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L3NyYy9NYWtlZmlsZS5hbSBiL3NyYy9NYWtlZmlsZS5hbQppbmRleCAwMTMzYmY1Li4zMWI4YWYx
IDEwMDY0NAotLS0gYS9zcmMvTWFrZWZpbGUuYW0KKysrIGIvc3JjL01ha2VmaWxlLmFtCkBAIC0y
MSw2ICsyMSw3IEBAIEFNX0NQUEZMQUdTID0gXAogCSQoWDExX0NGTEFHUykgXAogCSQoWEZJWEVT
X0NGTEFHUykgXAogCSQoWFJBTkRSX0NGTEFHUykgXAorCSQoWEVYVF9DRkxBR1MpIFwKIAkkKE5V
TEwpCiAKIEFNX0NGTEFHUyA9IFwKQEAgLTU2LDYgKzU3LDcgQEAgc3BpY2Vfc3RyZWFtaW5nX2Fn
ZW50X0xEQUREID0gXAogCSQoWDExX0xJQlMpIFwKIAkkKFhGSVhFU19MSUJTKSBcCiAJJChYUkFO
RFJfTElCUykgXAorCSQoWEVYVF9MSUJTKSBcCiAJJChKUEVHX0xJQlMpIFwKIAkkKE5VTEwpCiAK
QEAgLTc3LDYgKzc5LDggQEAgc3BpY2Vfc3RyZWFtaW5nX2FnZW50X1NPVVJDRVMgPSBcCiAJdXRp
bHMuY3BwIFwKIAl1dGlscy5ocHAgXAogCXgxMS1kaXNwbGF5LWluZm8uY3BwIFwKKwl4bGliLWNh
cHR1cmUuY3BwIFwKKwl4bGliLWNhcHR1cmUuaHBwIFwKIAkkKE5VTEwpCiAKIGlmIEhBVkVfR1NU
CmRpZmYgLS1naXQgYS9zcmMvbWpwZWctZmFsbGJhY2suY3BwIGIvc3JjL21qcGVnLWZhbGxiYWNr
LmNwcAppbmRleCAwMzI0N2ExLi5hNDM4MjViIDEwMDY0NAotLS0gYS9zcmMvbWpwZWctZmFsbGJh
Y2suY3BwCisrKyBiL3NyYy9tanBlZy1mYWxsYmFjay5jcHAKQEAgLTE2LDYgKzE2LDcgQEAKICNp
bmNsdWRlIDxzc3RyZWFtPgogI2luY2x1ZGUgPG1lbW9yeT4KICNpbmNsdWRlIDxzeXNsb2cuaD4K
KyNpbmNsdWRlICJ4bGliLWNhcHR1cmUuaHBwIgogCiB1c2luZyBuYW1lc3BhY2Ugc3BpY2U6OnN0
cmVhbWluZ19hZ2VudDsKIApAQCAtNDQsMTEgKzQ1LDEwIEBAIHB1YmxpYzoKIHByaXZhdGU6CiAg
ICAgTWpwZWdTZXR0aW5ncyBzZXR0aW5nczsKICAgICBEaXNwbGF5ICpjb25zdCBkcHk7CisgICAg
WGxpYkNhcHR1cmUgKnhjOwogCiAgICAgc3RkOjp2ZWN0b3I8dWludDhfdD4gZnJhbWU7CiAKLSAg
ICAvLyBsYXN0IGZyYW1lIHNpemVzCi0gICAgaW50IGxhc3Rfd2lkdGggPSAtMSwgbGFzdF9oZWln
aHQgPSAtMTsKICAgICAvLyBsYXN0IHRpbWUgYmVmb3JlIGNhcHR1cmUKICAgICB1aW50NjRfdCBs
YXN0X3RpbWUgPSAwOwogfTsKQEAgLTU4LDE5ICs1OCwyMSBAQCBwcml2YXRlOgogTWpwZWdGcmFt
ZUNhcHR1cmU6Ok1qcGVnRnJhbWVDYXB0dXJlKGNvbnN0IE1qcGVnU2V0dGluZ3MmIHNldHRpbmdz
KToKICAgICBzZXR0aW5ncyhzZXR0aW5ncyksZHB5KFhPcGVuRGlzcGxheShudWxscHRyKSkKIHsK
LSAgICBpZiAoIWRweSkKKyAgICBpZiAoIWRweSkgewogICAgICAgICB0aHJvdyBzdGQ6OnJ1bnRp
bWVfZXJyb3IoIlVuYWJsZSB0byBpbml0aWFsaXplIFgxMSIpOworICAgIH0KKyAgICB4YyA9IG5l
dyBYbGliQ2FwdHVyZShkcHkpOwogfQogCiBNanBlZ0ZyYW1lQ2FwdHVyZTo6fk1qcGVnRnJhbWVD
YXB0dXJlKCkKIHsKKyAgICBkZWxldGUgeGM7CiAgICAgWENsb3NlRGlzcGxheShkcHkpOwogfQog
CiB2b2lkIE1qcGVnRnJhbWVDYXB0dXJlOjpSZXNldCgpCiB7CiAgICAgZnJhbWUuY2xlYXIoKTsK
LSAgICBsYXN0X3dpZHRoID0gbGFzdF9oZWlnaHQgPSAtMTsKIH0KIAogRnJhbWVJbmZvIE1qcGVn
RnJhbWVDYXB0dXJlOjpDYXB0dXJlRnJhbWUoKQpAQCAtMTAwLDM0ICsxMDIsMjAgQEAgRnJhbWVJ
bmZvIE1qcGVnRnJhbWVDYXB0dXJlOjpDYXB0dXJlRnJhbWUoKQogICAgICAgICB9CiAgICAgfQog
Ci0gICAgaW50IHNjcmVlbiA9IFhEZWZhdWx0U2NyZWVuKGRweSk7Ci0KLSAgICBXaW5kb3cgd2lu
ID0gUm9vdFdpbmRvdyhkcHksIHNjcmVlbik7CisgICAgWEltZyAqaW1hZ2UgPSB4Yy0+Y2FwdHVy
ZSgpOwogCi0gICAgWFdpbmRvd0F0dHJpYnV0ZXMgd2luX2luZm87Ci0gICAgWEdldFdpbmRvd0F0
dHJpYnV0ZXMoZHB5LCB3aW4sICZ3aW5faW5mbyk7CisgICAgYm9vbCBpc19maXJzdCA9IGltYWdl
LT5uZXdfcmVzb2x1dGlvbigpOwogCi0gICAgYm9vbCBpc19maXJzdCA9IGZhbHNlOwotICAgIGlm
ICh3aW5faW5mby53aWR0aCAhPSBsYXN0X3dpZHRoIHx8IHdpbl9pbmZvLmhlaWdodCAhPSBsYXN0
X2hlaWdodCkgewotICAgICAgICBsYXN0X3dpZHRoID0gd2luX2luZm8ud2lkdGg7Ci0gICAgICAg
IGxhc3RfaGVpZ2h0ID0gd2luX2luZm8uaGVpZ2h0OwotICAgICAgICBpc19maXJzdCA9IHRydWU7
Ci0gICAgfQorICAgIGluZm8uc2l6ZS53aWR0aCA9IGltYWdlLT53aWR0aCgpOworICAgIGluZm8u
c2l6ZS5oZWlnaHQgPSBpbWFnZS0+aGVpZ2h0KCk7CiAKLSAgICBpbmZvLnNpemUud2lkdGggPSB3
aW5faW5mby53aWR0aDsKLSAgICBpbmZvLnNpemUuaGVpZ2h0ID0gd2luX2luZm8uaGVpZ2h0Owot
Ci0gICAgaW50IGZvcm1hdCA9IFpQaXhtYXA7Ci0gICAgLy8gVE9ETyBoYW5kbGUgZXJyb3JzCi0g
ICAgWEltYWdlICppbWFnZSA9IFhHZXRJbWFnZShkcHksIHdpbiwgd2luX2luZm8ueCwgd2luX2lu
Zm8ueSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbl9pbmZvLndpZHRoLCB3aW5f
aW5mby5oZWlnaHQsIEFsbFBsYW5lcywgZm9ybWF0KTsKIAogICAgIC8vIFRPRE8gaGFuZGxlIGVy
cm9ycwogICAgIC8vIFRPRE8gbXVsdGlwbGUgZm9ybWF0cyAob25seSAzMiBiaXQpCi0gICAgd3Jp
dGVfSlBFR19maWxlKGZyYW1lLCBzZXR0aW5ncy5xdWFsaXR5LCAodWludDhfdCopIGltYWdlLT5k
YXRhLAotICAgICAgICAgICAgICAgICAgICBpbWFnZS0+d2lkdGgsIGltYWdlLT5oZWlnaHQpOwor
ICAgIHdyaXRlX0pQRUdfZmlsZShmcmFtZSwgc2V0dGluZ3MucXVhbGl0eSwgKHVpbnQ4X3QqKSBp
bWFnZS0+Z2V0X2RhdGEoKSwKKyAgICAgICAgICAgICAgICAgICAgaW1hZ2UtPndpZHRoKCksIGlt
YWdlLT5oZWlnaHQoKSk7CiAKLSAgICBpbWFnZS0+Zi5kZXN0cm95X2ltYWdlKGltYWdlKTsKKyAg
ICBkZWxldGUgaW1hZ2U7CiAKICAgICBpbmZvLmJ1ZmZlciA9ICZmcmFtZVswXTsKICAgICBpbmZv
LmJ1ZmZlcl9zaXplID0gZnJhbWUuc2l6ZSgpOwotLSAKMi4yMS4wCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpTcGljZS1kZXZlbCBtYWlsaW5nIGxpc3QK
U3BpY2UtZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vc3BpY2UtZGV2ZWw=
