Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 661C4B6149
	for <lists+spice-devel@lfdr.de>; Wed, 18 Sep 2019 12:18:57 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EEED36EEAA;
	Wed, 18 Sep 2019 10:18:55 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 353C36EEAA
 for <spice-devel@lists.freedesktop.org>; Wed, 18 Sep 2019 10:18:55 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
 [10.5.11.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id CF7978A2195
 for <spice-devel@lists.freedesktop.org>; Wed, 18 Sep 2019 10:18:54 +0000 (UTC)
Received: from colo-mx.corp.redhat.com
 (colo-mx01.intmail.prod.int.phx2.redhat.com [10.5.11.20])
 by smtp.corp.redhat.com (Postfix) with ESMTPS id C79605D6B2
 for <spice-devel@lists.freedesktop.org>; Wed, 18 Sep 2019 10:18:54 +0000 (UTC)
Received: from zmail25.collab.prod.int.phx2.redhat.com
 (zmail25.collab.prod.int.phx2.redhat.com [10.5.83.31])
 by colo-mx.corp.redhat.com (Postfix) with ESMTP id BF3601803517;
 Wed, 18 Sep 2019 10:18:54 +0000 (UTC)
Date: Wed, 18 Sep 2019 06:18:54 -0400 (EDT)
From: Frediano Ziglio <fziglio@redhat.com>
To: Victor Toso <victortoso@redhat.com>
Message-ID: <1980315358.452731.1568801934736.JavaMail.zimbra@redhat.com>
In-Reply-To: <20190916102104.20943-9-victortoso@redhat.com>
References: <20190916102104.20943-1-victortoso@redhat.com>
 <20190916102104.20943-9-victortoso@redhat.com>
MIME-Version: 1.0
X-Originating-IP: [10.33.32.16, 10.4.195.15]
Thread-Topic: usb-redir: extend USB backend to support emulated devices
Thread-Index: BKfJjLtJ3WvBeEJmYcISmr12cBiM/A==
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.6.2
 (mx1.redhat.com [10.5.110.69]); Wed, 18 Sep 2019 10:18:54 +0000 (UTC)
Subject: Re: [Spice-devel] [PATCH v7 08/20] usb-redir: extend USB backend to
 support emulated devices
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: spice-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

PiAKPiBGcm9tOiBZdXJpIEJlbmRpdG92aWNoIDx5dXJpLmJlbmRpdG92aWNoQGRheW5peC5jb20+
Cj4gCj4gUmVkaXJlY3Rpb24gb2YgZW11bGF0ZWQgZGV2aWNlcyByZXF1aXJlcyBzcGVjaWFsIGFw
cHJvYWNoLCBhcwo+IHVzYnJlZGlyaG9zdCBjYW4ndCBiZSB1c2VkIGZvciB0aGF0IChpdCB3b3Jr
cyBvbmx5IHdpdGggbGlidXNiCj4gZGV2aWNlcykuIEZvciBlbXVsYXRlZCBkZXZpY2VzIHdlIGNy
ZWF0ZSBpbnN0YW5jZSBvZiB1c2JyZWRpcnBhcnNlcgo+IHRoYXQgaW1wbGVtZW50cyBVU0IgcmVk
aXJlY3Rpb24gcHJvdG9jb2wuICBJbiBvcmRlciB0byB3b3JrIHdpdGggdGhlCj4gc2FtZSBzZXQg
b2YgcHJvdG9jb2wgY2FwYWJpbGl0aWVzIHRoYXQgdXNicmVkaXJob3N0IHNldHMgdXAgd2l0aAo+
IHJlbW90ZSBzaWRlLCB0aGUgcGFyc2VyIHNoYWxsOiAtIG5vdCBzZW5kIGl0cyBvd24gJ2hlbGxv
JyB0byB0aGUKPiBzZXJ2ZXIKPiAtIGluaXRpYWxpemUgdGhlIHNhbWUgY2FwYWJpbGl0aWVzIHRo
YXQgdXNicmVkaXJob3N0Cj4gLSByZWNlaXZlIHRoZSBzYW1lICdoZWxsbycgcmVzcG9uc2UKPiBG
b3IgdGhhdCB3ZSBhbmFseXplICdoZWxsbycgc2VudCBieSBVU0IgcmVkaXIgcGFyc2VyIGFuZCBl
eHRyYWN0IHNldAo+IG9mIGNhcGFiaWxpdGllcyBmcm9tIGl0IGFuZCB1cG9uIHJlY2VpdmUgb2Yg
J2hlbGxvJyByZXNwb25zZSB3ZQo+IHByb3ZpZGUgaXQgYWxzbyB0byB0aGUgcGFyc2VyLiAgV2hl
biBsaWJ1c2IgZGV2aWNlIGlzIHJlZGlyZWN0ZWQgdmlhIGEKPiBjaGFubmVsLCBpbnN0YW5jZSBv
ZiB1c2JyZWRpcmhvc3Qgc2VydmVzIGl0LiAgV2hlbiBlbXVsYXRlZCBkZXZpY2UgaXMKPiByZWRp
cmVjdGVkIHZpYSBhIGNoYW5uZWwsIGluc3RhbmNlIG9mIHVzYnJlZGlycGFyc2VyIGRvZXMgdGhl
IGpvYi4KPiAKPiBTaWduZWQtb2ZmLWJ5OiBZdXJpIEJlbmRpdG92aWNoIDx5dXJpLmJlbmRpdG92
aWNoQGRheW5peC5jb20+CgpTYW1lIGNvbW1lbnRzIGZvciBwcmV2aW91cyBwYXRjaC4KT3RoZXJ3
aXNlIGZpbmUgZm9yIG1lLgpDaHJpc3RvcGhlIGRpZCBtdWx0aXBsZSBjb21tZW50cyBidXQgSSB0
aGluayB3ZXJlIGFsbCBhZGRyZXNzZWQgYmVmb3JlLgoKPiAtLS0KPiAgc3JjL3VzYi1iYWNrZW5k
LmMgfCA0MTcgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLQo+
ICAxIGZpbGUgY2hhbmdlZCwgMzcwIGluc2VydGlvbnMoKyksIDQ3IGRlbGV0aW9ucygtKQo+IAo+
IGRpZmYgLS1naXQgYS9zcmMvdXNiLWJhY2tlbmQuYyBiL3NyYy91c2ItYmFja2VuZC5jCj4gaW5k
ZXggZWYyOTkwMS4uODFkN2M5ZSAxMDA2NDQKPiAtLS0gYS9zcmMvdXNiLWJhY2tlbmQuYwo+ICsr
KyBiL3NyYy91c2ItYmFja2VuZC5jCj4gQEAgLTU4LDYgKzU4LDcgQEAgc3RydWN0IF9TcGljZVVz
YkRldmljZQo+ICAgICAgVXNiRGV2aWNlSW5mb3JtYXRpb24gZGV2aWNlX2luZm87Cj4gICAgICBi
b29sIGNhY2hlZF9pc29jaHJvbm91c192YWxpZDsKPiAgICAgIGJvb2wgY2FjaGVkX2lzb2Nocm9u
b3VzOwo+ICsgICAgZ2Jvb2xlYW4gZWRldl9jb25maWd1cmVkOwo+ICB9Owo+ICAKPiAgc3RydWN0
IF9TcGljZVVzYkJhY2tlbmQKPiBAQCAtODAsMTQgKzgxLDIzIEBAIHN0cnVjdCBfU3BpY2VVc2JC
YWNrZW5kCj4gICAgICB1aW50MzJfdCBvd25fZGV2aWNlc19tYXNrOwo+ICB9Owo+ICAKPiArdHlw
ZWRlZiBlbnVtIHsKPiArICAgIFVTQl9DSEFOTkVMX1NUQVRFX0lOSVRJQUxJWklORywKPiArICAg
IFVTQl9DSEFOTkVMX1NUQVRFX0hPU1QsCj4gKyAgICBVU0JfQ0hBTk5FTF9TVEFURV9QQVJTRVIs
Cj4gK30gU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbFN0YXRlOwo+ICsKPiAgc3RydWN0IF9TcGljZVVz
YkJhY2tlbmRDaGFubmVsCj4gIHsKPiAgICAgIHN0cnVjdCB1c2JyZWRpcmhvc3QgKnVzYnJlZGly
aG9zdDsKPiAgICAgIHN0cnVjdCB1c2JyZWRpcnBhcnNlciAqcGFyc2VyOwo+ICsgICAgU3BpY2VV
c2JCYWNrZW5kQ2hhbm5lbFN0YXRlIHN0YXRlOwo+ICAgICAgdWludDhfdCAqcmVhZF9idWY7Cj4g
ICAgICBpbnQgcmVhZF9idWZfc2l6ZTsKPiAgICAgIHN0cnVjdCB1c2JyZWRpcmZpbHRlcl9ydWxl
ICpydWxlczsKPiAgICAgIGludCBydWxlc19jb3VudDsKPiArICAgIHVpbnQzMl90IHJlamVjdGVk
ICAgICAgICAgIDogMTsKPiArICAgIHVpbnQzMl90IHdhaXRfZGlzY29ubmVjdF9hY2sgOiAxOwo+
ICAgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICphdHRhY2hlZDsKPiAgICAgIFNwaWNlVXNicmVk
aXJDaGFubmVsICp1c2JyZWRpcl9jaGFubmVsOwo+ICAgICAgU3BpY2VVc2JCYWNrZW5kICpiYWNr
ZW5kOwo+IEBAIC00MDYsMTMgKzQxNiwxNyBAQCBmcm9tIGJvdGggdGhlIG1haW4gdGhyZWFkIGFz
IHdlbGwgYXMgZnJvbSB0aGUgdXNiIGV2ZW50Cj4gaGFuZGxpbmcgdGhyZWFkICovCj4gIHN0YXRp
YyB2b2lkIHVzYnJlZGlyX3dyaXRlX2ZsdXNoX2NhbGxiYWNrKHZvaWQgKnVzZXJfZGF0YSkKPiAg
ewo+ICAgICAgU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSB1c2VyX2RhdGE7Cj4gLSAgICBp
ZiAoIWNoLT51c2JyZWRpcmhvc3QpIHsKPiAtICAgICAgICAvKiBqdXN0IHRvIGJlIG9uIHRoZSBz
YWZlIHNpZGUgKi8KPiArICAgIGlmIChjaC0+cGFyc2VyID09IE5VTEwpIHsKPiAgICAgICAgICBy
ZXR1cm47Cj4gICAgICB9Cj4gICAgICBpZiAoaXNfY2hhbm5lbF9yZWFkeShjaC0+dXNicmVkaXJf
Y2hhbm5lbCkpIHsKPiAtICAgICAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAgLT4gdXNicmVkaXJo
b3N0IiwgX19GVU5DVElPTl9fLCBjaCk7Cj4gLSAgICAgICAgdXNicmVkaXJob3N0X3dyaXRlX2d1
ZXN0X2RhdGEoY2gtPnVzYnJlZGlyaG9zdCk7Cj4gKyAgICAgICAgaWYgKGNoLT5zdGF0ZSA9PSBV
U0JfQ0hBTk5FTF9TVEFURV9IT1NUKSB7Cj4gKyAgICAgICAgICAgIFNQSUNFX0RFQlVHKCIlcyBj
aCAlcCAtPiB1c2JyZWRpcmhvc3QiLCBfX0ZVTkNUSU9OX18sIGNoKTsKPiArICAgICAgICAgICAg
dXNicmVkaXJob3N0X3dyaXRlX2d1ZXN0X2RhdGEoY2gtPnVzYnJlZGlyaG9zdCk7Cj4gKyAgICAg
ICAgfSBlbHNlIHsKPiArICAgICAgICAgICAgU1BJQ0VfREVCVUcoIiVzIGNoICVwIC0+IHBhcnNl
ciIsIF9fRlVOQ1RJT05fXywgY2gpOwo+ICsgICAgICAgICAgICB1c2JyZWRpcnBhcnNlcl9kb193
cml0ZShjaC0+cGFyc2VyKTsKPiArICAgICAgICB9Cj4gICAgICB9IGVsc2Ugewo+ICAgICAgICAg
IFNQSUNFX0RFQlVHKCIlcyBjaCAlcCAobm90IHJlYWR5KSIsIF9fRlVOQ1RJT05fXywgY2gpOwo+
ICAgICAgfQo+IEBAIC01NjcsMTMgKzU4MSw1MyBAQCB2b2lkCj4gc3BpY2VfdXNiX2JhY2tlbmRf
ZGV2aWNlX3VucmVmKFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2KQo+ICAgICAgfQo+ICB9Cj4g
IAo+IC1HX0dOVUNfSU5URVJOQUwKPiArc3RhdGljIGludCBjaGVja19lZGV2X2RldmljZV9maWx0
ZXIoU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYsCj4gKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCB1c2JyZWRpcmZpbHRlcl9ydWxlICpydWxlcywKPiAr
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGNvdW50KQo+ICt7Cj4gKyAg
ICBTcGljZVVzYkVtdWxhdGVkRGV2aWNlICplZGV2ID0gZGV2LT5lZGV2Owo+ICsgICAgdWludDhf
dCBjbHNbMzJdLCBzdWJjbHNbMzJdLCBwcm90b1szMl0sICpjZmcsIGlmbnVtID0gMDsKPiArICAg
IHVpbnQxNl90IHNpemUsIG9mZnNldCA9IDA7Cj4gKwo+ICsgICAgaWYgKCFkZXZpY2Vfb3BzKGVk
ZXYpLT5nZXRfZGVzY3JpcHRvcihlZGV2LCBMSUJVU0JfRFRfQ09ORklHLCAwLCAodm9pZAo+ICoq
KSZjZmcsICZzaXplKSkgewo+ICsgICAgICAgIHJldHVybiAtRUlOVkFMOwo+ICsgICAgfQo+ICsK
PiArICAgIHdoaWxlICgob2Zmc2V0ICsgMSkgPCBzaXplKSB7Cj4gKyAgICAgICAgdWludDhfdCBs
ZW4gID0gY2ZnW29mZnNldF07Cj4gKyAgICAgICAgdWludDhfdCB0eXBlID0gY2ZnW29mZnNldCAr
IDFdOwo+ICsgICAgICAgIGlmICgob2Zmc2V0ICsgbGVuKSA+IHNpemUpIHsKPiArICAgICAgICAg
ICAgYnJlYWs7Cj4gKyAgICAgICAgfQo+ICsgICAgICAgIGlmICh0eXBlID09IExJQlVTQl9EVF9J
TlRFUkZBQ0UpIHsKPiArICAgICAgICAgICAgY2xzW2lmbnVtXSA9IGNmZ1tvZmZzZXQgKyA1XTsK
PiArICAgICAgICAgICAgc3ViY2xzW2lmbnVtXSA9IGNmZ1tvZmZzZXQgKyA2XTsKPiArICAgICAg
ICAgICAgcHJvdG9baWZudW1dID0gY2ZnW29mZnNldCArIDddOwo+ICsgICAgICAgICAgICBpZm51
bSsrOwo+ICsgICAgICAgIH0KPiArICAgICAgICBvZmZzZXQgKz0gbGVuOwo+ICsgICAgfQo+ICsK
PiArICAgIHJldHVybiB1c2JyZWRpcmZpbHRlcl9jaGVjayhydWxlcywgY291bnQsCj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2LT5kZXZpY2VfaW5mby5jbGFzcywKPiArICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXYtPmRldmljZV9pbmZvLnN1YmNsYXNzLAo+
ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldi0+ZGV2aWNlX2luZm8ucHJvdG9j
b2wsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xzLCBzdWJjbHMsIHByb3Rv
LCBpZm51bSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXYtPmRldmljZV9p
bmZvLnZpZCwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXYtPmRldmljZV9p
bmZvLnBpZCwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXYtPmRldmljZV9p
bmZvLmJjZFVTQiwgMCk7Cj4gK30KPiArCj4gIGludCBzcGljZV91c2JfYmFja2VuZF9kZXZpY2Vf
Y2hlY2tfZmlsdGVyKFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2LAo+IC0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJ1Y3QgdXNicmVkaXJmaWx0ZXJf
cnVsZQo+ICpydWxlcywKPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgaW50IGNvdW50KQo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBjb25zdCBzdHJ1Y3QgdXNicmVkaXJmaWx0ZXJfcnVsZQo+ICpydWxlcywgaW50IGNvdW50KQo+
ICB7Cj4gLSAgICBnX3JldHVybl92YWxfaWZfZmFpbChkZXYtPmxpYnVzYl9kZXZpY2UgIT0gTlVM
TCwgLUVJTlZBTCk7Cj4gLSAgICByZXR1cm4gdXNicmVkaXJob3N0X2NoZWNrX2RldmljZV9maWx0
ZXIocnVsZXMsIGNvdW50LAo+IGRldi0+bGlidXNiX2RldmljZSwgMCk7Cj4gKyAgICBpZiAoZGV2
LT5saWJ1c2JfZGV2aWNlICE9IE5VTEwpIHsKPiArICAgICAgICByZXR1cm4gdXNicmVkaXJob3N0
X2NoZWNrX2RldmljZV9maWx0ZXIocnVsZXMsIGNvdW50LAo+IGRldi0+bGlidXNiX2RldmljZSwg
MCk7Cj4gKyAgICB9IGVsc2UgaWYgKGRldi0+ZWRldiAhPSBOVUxMKSB7Cj4gKyAgICAgICAgcmV0
dXJuIGNoZWNrX2VkZXZfZGV2aWNlX2ZpbHRlcihkZXYsIHJ1bGVzLCBjb3VudCk7Cj4gKyAgICB9
Cj4gKyAgICBnX3dhcm5faWZfcmVhY2hlZCgpOwo+ICsgICAgcmV0dXJuIC1FSU5WQUw7Cj4gIH0K
PiAgCj4gIHN0YXRpYyBpbnQgdXNicmVkaXJfcmVhZF9jYWxsYmFjayh2b2lkICp1c2VyX2RhdGEs
IHVpbnQ4X3QgKmRhdGEsIGludCBjb3VudCkKPiBAQCAtNjkyLDEwICs3NDYsMzMgQEAgaW50Cj4g
c3BpY2VfdXNiX2JhY2tlbmRfcmVhZF9ndWVzdF9kYXRhKFNwaWNlVXNiQmFja2VuZENoYW5uZWwg
KmNoLCB1aW50OF90ICpkYXRhLAo+ICAKPiAgICAgIGNoLT5yZWFkX2J1ZiA9IGRhdGE7Cj4gICAg
ICBjaC0+cmVhZF9idWZfc2l6ZSA9IGNvdW50Owo+IC0gICAgaWYgKGNoLT51c2JyZWRpcmhvc3Qp
IHsKPiArICAgIGlmIChTUElDRV9VTkxJS0VMWShjaC0+c3RhdGUgPT0gVVNCX0NIQU5ORUxfU1RB
VEVfSU5JVElBTElaSU5HKSkgewo+ICsgICAgICAgIGlmIChjaC0+dXNicmVkaXJob3N0ICE9IE5V
TEwpIHsKPiArICAgICAgICAgICAgcmVzID0gdXNicmVkaXJob3N0X3JlYWRfZ3Vlc3RfZGF0YShj
aC0+dXNicmVkaXJob3N0KTsKPiArICAgICAgICAgICAgaWYgKHJlcyAhPSAwKSB7Cj4gKyAgICAg
ICAgICAgICAgICByZXR1cm4gcmVzOwo+ICsgICAgICAgICAgICB9Cj4gKyAgICAgICAgICAgIGNo
LT5zdGF0ZSA9IFVTQl9DSEFOTkVMX1NUQVRFX0hPU1Q7Cj4gKwo+ICsgICAgICAgICAgICAvKiB1
c2JyZWRpcmhvc3Qgc2hvdWxkIGNvbnN1bWUgaGVsbG8gcmVzcG9uc2UgKi8KPiArICAgICAgICAg
ICAgZ19yZXR1cm5fdmFsX2lmX2ZhaWwoY2gtPnJlYWRfYnVmID09IE5VTEwsCj4gVVNCX1JFRElS
X0VSUk9SX1JFQURfUEFSU0UpOwo+ICsgICAgICAgIH0gZWxzZSB7Cj4gKyAgICAgICAgICAgIGNo
LT5zdGF0ZSA9IFVTQl9DSEFOTkVMX1NUQVRFX1BBUlNFUjsKPiArICAgICAgICB9Cj4gKwo+ICsg
ICAgICAgIGNoLT5yZWFkX2J1ZiA9IGRhdGE7Cj4gKyAgICAgICAgY2gtPnJlYWRfYnVmX3NpemUg
PSBjb3VudDsKPiArICAgICAgICBpZiAoY2gtPmF0dGFjaGVkICYmIGNoLT5hdHRhY2hlZC0+ZWRl
dikgewo+ICsgICAgICAgICAgICAvKiBjYXNlIG9mIENEIHNoYXJpbmcgb24gY29ubmVjdCAqLwo+
ICsgICAgICAgICAgICBjaC0+c3RhdGUgPSBVU0JfQ0hBTk5FTF9TVEFURV9QQVJTRVI7Cj4gKyAg
ICAgICAgICAgIFNQSUNFX0RFQlVHKCIlczogc3dpdGNoICVwIHRvIHBhcnNlciIsIF9fRlVOQ1RJ
T05fXywgY2gpOwo+ICsgICAgICAgIH0KPiArICAgICAgICByZXR1cm4gdXNicmVkaXJwYXJzZXJf
ZG9fcmVhZChjaC0+cGFyc2VyKTsKPiArICAgIH0KPiArICAgIGlmIChjaC0+c3RhdGUgPT0gVVNC
X0NIQU5ORUxfU1RBVEVfSE9TVCkgewo+ICAgICAgICAgIHJlcyA9IHVzYnJlZGlyaG9zdF9yZWFk
X2d1ZXN0X2RhdGEoY2gtPnVzYnJlZGlyaG9zdCk7Cj4gICAgICB9IGVsc2Ugewo+IC0gICAgICAg
IHJlcyA9IFVTQl9SRURJUl9FUlJPUl9JTzsKPiArICAgICAgICByZXMgPSB1c2JyZWRpcnBhcnNl
cl9kb19yZWFkKGNoLT5wYXJzZXIpOwo+ICAgICAgfQo+ICAgICAgc3dpdGNoIChyZXMpCj4gICAg
ICB7Cj4gQEAgLTcxNCw2ICs3OTEsMTEgQEAgaW50Cj4gc3BpY2VfdXNiX2JhY2tlbmRfcmVhZF9n
dWVzdF9kYXRhKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLCB1aW50OF90ICpkYXRhLAo+ICAg
ICAgfQo+ICAgICAgU1BJQ0VfREVCVUcoIiVzIGNoICVwLCAlZCBieXRlcywgcmVzICVkIiwgX19G
VU5DVElPTl9fLCBjaCwgY291bnQsIHJlcyk7Cj4gIAo+ICsgICAgaWYgKGNoLT5yZWplY3RlZCkg
ewo+ICsgICAgICAgIGNoLT5yZWplY3RlZCA9IDA7Cj4gKyAgICAgICAgcmVzID0gVVNCX1JFRElS
X0VSUk9SX0RFVl9SRUpFQ1RFRDsKPiArICAgIH0KPiArCj4gICAgICByZXR1cm4gcmVzOwo+ICB9
Cj4gIAo+IEBAIC03NDAsMjMgKzgyMiwxMTUgQEAgR0Vycm9yICpzcGljZV91c2JfYmFja2VuZF9n
ZXRfZXJyb3JfZGV0YWlscyhpbnQKPiBlcnJvcl9jb2RlLCBnY2hhciAqZGVzYykKPiAgICAgIHJl
dHVybiBlcnI7Cj4gIH0KPiAgCj4gK3ZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfcmV0dXJuX3dyaXRl
X2RhdGEoU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gsIHZvaWQKPiAqZGF0YSkKPiArewo+ICsg
ICAgaWYgKGNoLT5zdGF0ZSA9PSBVU0JfQ0hBTk5FTF9TVEFURV9IT1NUKSB7Cj4gKyAgICAgICAg
U1BJQ0VfREVCVUcoIiVzIGNoICVwIC0+IHVzYnJlZGlyaG9zdCIsIF9fRlVOQ1RJT05fXywgY2gp
Owo+ICsgICAgICAgIHVzYnJlZGlyaG9zdF9mcmVlX3dyaXRlX2J1ZmZlcihjaC0+dXNicmVkaXJo
b3N0LCBkYXRhKTsKPiArICAgIH0gZWxzZSB7Cj4gKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzIGNo
ICVwIC0+IHBhcnNlciIsIF9fRlVOQ1RJT05fXywgY2gpOwo+ICsgICAgICAgIHVzYnJlZGlycGFy
c2VyX2ZyZWVfd3JpdGVfYnVmZmVyKGNoLT5wYXJzZXIsIGRhdGEpOwo+ICsgICAgfQo+ICt9Cj4g
Kwo+ICBzdGF0aWMgdm9pZAo+ICB1c2JyZWRpcl9jb250cm9sX3BhY2tldCh2b2lkICpwcml2LCB1
aW50NjRfdCBpZCwgc3RydWN0Cj4gIHVzYl9yZWRpcl9jb250cm9sX3BhY2tldF9oZWFkZXIgKmgs
Cj4gICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ4X3QgKmRhdGEsIGludCBkYXRhX2xlbikK
PiAgewo+IC0gICAgVVNCUkVESVJfQ0FMTEJBQ0tfTk9UX0lNUExFTUVOVEVEKCk7Cj4gKyAgICBT
cGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCA9IHByaXY7Cj4gKyAgICBTcGljZVVzYkJhY2tlbmRE
ZXZpY2UgKmQgPSBjaC0+YXR0YWNoZWQ7Cj4gKyAgICBTcGljZVVzYkVtdWxhdGVkRGV2aWNlICpl
ZGV2ID0gZCA/IGQtPmVkZXYgOiBOVUxMOwo+ICsgICAgc3RydWN0IHVzYl9yZWRpcl9jb250cm9s
X3BhY2tldF9oZWFkZXIgcmVzcG9uc2UgPSAqaDsKPiArICAgIHVpbnQ4X3QgcmVxdHlwZSA9IGgt
PnJlcXVlc3R0eXBlICYgMHg3ZjsKPiArICAgIGdib29sZWFuIGRvbmUgPSBGQUxTRTsKPiArICAg
IHZvaWQgKm91dF9idWZmZXIgPSBOVUxMOwo+ICsKPiArICAgIHJlc3BvbnNlLnN0YXR1cyA9IHVz
Yl9yZWRpcl9zdGFsbDsKPiArICAgIFNQSUNFX0RFQlVHKCIlcyAlcDogVFJWSUwgJTAyWCAlMDJY
ICUwNFggJTA0WCAlMDRYIiwKPiArICAgICAgICAgICAgICAgIF9fRlVOQ1RJT05fXywKPiArICAg
ICAgICAgICAgICAgIGNoLCBoLT5yZXF1ZXN0dHlwZSwgaC0+cmVxdWVzdCwKPiArICAgICAgICAg
ICAgICAgIGgtPnZhbHVlLCBoLT5pbmRleCwgaC0+bGVuZ3RoKTsKPiArCj4gKyAgICBpZiAoIWVk
ZXYpIHsKPiArICAgICAgICBTUElDRV9ERUJVRygiJXM6IGRldmljZSBub3QgYXR0YWNoZWQiLCBf
X0ZVTkNUSU9OX18pOwo+ICsgICAgICAgIHJlc3BvbnNlLnN0YXR1cyA9IHVzYl9yZWRpcl9pb2Vy
cm9yOwo+ICsgICAgICAgIGRvbmUgPSBUUlVFOwo+ICsgICAgfSBlbHNlIGlmIChyZXF0eXBlID09
IChMSUJVU0JfUkVRVUVTVF9UWVBFX1NUQU5EQVJEIHwKPiBMSUJVU0JfUkVDSVBJRU5UX0RFVklD
RSkgJiYKPiArICAgICAgICAgICAgICAgaC0+cmVxdWVzdCA9PSBMSUJVU0JfUkVRVUVTVF9HRVRf
REVTQ1JJUFRPUikgewo+ICsgICAgICAgIHVpbnQxNl90IHNpemU7Cj4gKyAgICAgICAgZG9uZSA9
IGRldmljZV9vcHMoZWRldiktPmdldF9kZXNjcmlwdG9yKGVkZXYsIGgtPnZhbHVlID4+IDgsCj4g
aC0+dmFsdWUgJiAweGZmLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAmb3V0X2J1ZmZlciwgJnNpemUpOwo+ICsgICAgICAgIHJlc3BvbnNlLmxlbmd0
aCA9IHNpemU7Cj4gKyAgICAgICAgaWYgKGRvbmUpIHsKPiArICAgICAgICAgICAgcmVzcG9uc2Uu
c3RhdHVzID0gMDsKPiArICAgICAgICB9Cj4gKyAgICAgICAgZG9uZSA9IFRSVUU7Cj4gKyAgICB9
Cj4gKwo+ICsgICAgaWYgKCFkb25lKSB7Cj4gKyAgICAgICAgZGV2aWNlX29wcyhlZGV2KS0+Y29u
dHJvbF9yZXF1ZXN0KGVkZXYsIGRhdGEsIGRhdGFfbGVuLCAmcmVzcG9uc2UsCj4gJm91dF9idWZm
ZXIpOwo+ICsgICAgICAgIGRvbmUgPSBUUlVFOwo+ICsgICAgfQo+ICsKPiArICAgIGlmIChyZXNw
b25zZS5zdGF0dXMpIHsKPiArICAgICAgICByZXNwb25zZS5sZW5ndGggPSAwOwo+ICsgICAgfSBl
bHNlIGlmIChyZXNwb25zZS5sZW5ndGggPiBoLT5sZW5ndGgpIHsKPiArICAgICAgICByZXNwb25z
ZS5sZW5ndGggPSBoLT5sZW5ndGg7Cj4gKyAgICB9Cj4gKwo+ICsgICAgU1BJQ0VfREVCVUcoIiVz
IHJlc3BvbmRpbmcgd2l0aCBwYXlsb2FkIG9mICUwMlgsIHN0YXR1cyAlWCIsCj4gKyAgICAgICAg
ICAgICAgICBfX0ZVTkNUSU9OX18sIHJlc3BvbnNlLmxlbmd0aCwgcmVzcG9uc2Uuc3RhdHVzKTsK
PiArICAgIHVzYnJlZGlycGFyc2VyX3NlbmRfY29udHJvbF9wYWNrZXQoY2gtPnBhcnNlciwgaWQs
ICZyZXNwb25zZSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVz
cG9uc2UubGVuZ3RoID8gb3V0X2J1ZmZlciA6IE5VTEwsCj4gKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmxlbmd0aCk7Cj4gKwo+ICsgICAgdXNicmVkaXJf
d3JpdGVfZmx1c2hfY2FsbGJhY2soY2gpOwo+ICsgICAgdXNicmVkaXJwYXJzZXJfZnJlZV9wYWNr
ZXRfZGF0YShjaC0+cGFyc2VyLCBkYXRhKTsKPiAgfQo+ICAKPiAgc3RhdGljIHZvaWQKPiAgdXNi
cmVkaXJfYnVsa19wYWNrZXQodm9pZCAqcHJpdiwgdWludDY0X3QgaWQsIHN0cnVjdAo+ICB1c2Jf
cmVkaXJfYnVsa19wYWNrZXRfaGVhZGVyICpoLAo+ICAgICAgICAgICAgICAgICAgICAgICB1aW50
OF90ICpkYXRhLCBpbnQgZGF0YV9sZW4pCj4gIHsKPiAtICAgIFVTQlJFRElSX0NBTExCQUNLX05P
VF9JTVBMRU1FTlRFRCgpOwo+ICsgICAgU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSBwcml2
Owo+ICsgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkID0gY2gtPmF0dGFjaGVkOwo+ICsgICAg
U3BpY2VVc2JFbXVsYXRlZERldmljZSAqZWRldiA9IGQgPyBkLT5lZGV2IDogTlVMTDsKPiArICAg
IHN0cnVjdCB1c2JfcmVkaXJfYnVsa19wYWNrZXRfaGVhZGVyIGhvdXQgPSAqaDsKPiArICAgIHVp
bnQzMl90IGxlbiA9IChoLT5sZW5ndGhfaGlnaCA8PCAxNikgfCBoLT5sZW5ndGg7Cj4gKyAgICBT
UElDRV9ERUJVRygiJXMgJXA6IGVwICVYLCBsZW4gJXUsIGlkICUiIEdfR1VJTlQ2NF9GT1JNQVQs
IF9fRlVOQ1RJT05fXywKPiArICAgICAgICAgICAgICAgIGNoLCBoLT5lbmRwb2ludCwgbGVuLCBp
ZCk7Cj4gKwo+ICsgICAgaWYgKCFlZGV2KSB7Cj4gKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiBk
ZXZpY2Ugbm90IGF0dGFjaGVkIiwgX19GVU5DVElPTl9fKTsKPiArICAgICAgICBob3V0LnN0YXR1
cyA9IHVzYl9yZWRpcl9pb2Vycm9yOwo+ICsgICAgICAgIGhvdXQubGVuZ3RoID0gaG91dC5sZW5n
dGhfaGlnaCA9IDA7Cj4gKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiByZXNwb25kaW5nIHdpdGgg
WkxQIHN0YXR1cyAlZCIsIF9fRlVOQ1RJT05fXywKPiBob3V0LnN0YXR1cyk7Cj4gKyAgICB9IGVs
c2UgaWYgKGgtPmVuZHBvaW50ICYgTElCVVNCX0VORFBPSU5UX0lOKSB7Cj4gKyAgICAgICAgaWYg
KGRldmljZV9vcHMoZWRldiktPmJ1bGtfaW5fcmVxdWVzdChlZGV2LCBpZCwgJmhvdXQpKSB7Cj4g
KyAgICAgICAgICAgIHVzYnJlZGlycGFyc2VyX2ZyZWVfcGFja2V0X2RhdGEoY2gtPnBhcnNlciwg
ZGF0YSk7Cj4gKyAgICAgICAgICAgIC8qIGNvbXBsZXRpb24gaXMgYXN5bmNocm9ub3VzICovCj4g
KyAgICAgICAgICAgIHJldHVybjsKPiArICAgICAgICB9Cj4gKyAgICB9IGVsc2Ugewo+ICsgICAg
ICAgIGhvdXQuc3RhdHVzID0gdXNiX3JlZGlyX3N0YWxsOwo+ICsgICAgICAgIGRldmljZV9vcHMo
ZWRldiktPmJ1bGtfb3V0X3JlcXVlc3QoZWRldiwgaC0+ZW5kcG9pbnQsIGRhdGEsCj4gZGF0YV9s
ZW4sICZob3V0LnN0YXR1cyk7Cj4gKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzOiByZXNwb25kaW5n
IHN0YXR1cyAlZCIsIF9fRlVOQ1RJT05fXywgaG91dC5zdGF0dXMpOwo+ICsgICAgfQo+ICsKPiAr
ICAgIHVzYnJlZGlycGFyc2VyX3NlbmRfYnVsa19wYWNrZXQoY2gtPnBhcnNlciwgaWQsICZob3V0
LCBOVUxMLCAwKTsKPiArICAgIHVzYnJlZGlycGFyc2VyX2ZyZWVfcGFja2V0X2RhdGEoY2gtPnBh
cnNlciwgZGF0YSk7Cj4gKyAgICB1c2JyZWRpcl93cml0ZV9mbHVzaF9jYWxsYmFjayhjaCk7Cj4g
IH0KPiAgCj4gIHN0YXRpYyB2b2lkIHVzYnJlZGlyX2RldmljZV9yZXNldCh2b2lkICpwcml2KQo+
ICB7Cj4gLSAgICBVU0JSRURJUl9DQUxMQkFDS19OT1RfSU1QTEVNRU5URUQoKTsKPiArICAgIFNw
aWNlVXNiQmFja2VuZENoYW5uZWwgKmNoID0gcHJpdjsKPiArICAgIFNwaWNlVXNiQmFja2VuZERl
dmljZSAqZCA9IGNoLT5hdHRhY2hlZDsKPiArICAgIFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmVk
ZXYgPSBkID8gZC0+ZWRldiA6IE5VTEw7Cj4gKyAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAiLCBf
X0ZVTkNUSU9OX18sIGNoKTsKPiArICAgIGlmIChlZGV2KSB7Cj4gKyAgICAgICAgZGV2aWNlX29w
cyhlZGV2KS0+cmVzZXQoZWRldik7Cj4gKyAgICB9Cj4gIH0KPiAgCj4gIHN0YXRpYyB2b2lkCj4g
QEAgLTc3NSwzNCArOTQ5LDcyIEBAIHN0YXRpYyB2b2lkCj4gIHVzYnJlZGlyX3NldF9jb25maWd1
cmF0aW9uKHZvaWQgKnByaXYsIHVpbnQ2NF90IGlkLAo+ICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBzdHJ1Y3QgdXNiX3JlZGlyX3NldF9jb25maWd1cmF0aW9uX2hlYWRlcgo+ICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAqc2V0X2NvbmZpZ3VyYXRpb24pCj4gIHsKPiAtICAgIFVTQlJF
RElSX0NBTExCQUNLX05PVF9JTVBMRU1FTlRFRCgpOwo+ICsgICAgU3BpY2VVc2JCYWNrZW5kQ2hh
bm5lbCAqY2ggPSBwcml2Owo+ICsgICAgc3RydWN0IHVzYl9yZWRpcl9jb25maWd1cmF0aW9uX3N0
YXR1c19oZWFkZXIgaDsKPiArICAgIGguc3RhdHVzID0gMDsKPiArICAgIGguY29uZmlndXJhdGlv
biA9IHNldF9jb25maWd1cmF0aW9uLT5jb25maWd1cmF0aW9uOwo+ICsgICAgU1BJQ0VfREVCVUco
IiVzIGNoICVwLCBjZmcgJWQiLCBfX0ZVTkNUSU9OX18sIGNoLCBoLmNvbmZpZ3VyYXRpb24pOwo+
ICsgICAgaWYgKGNoLT5hdHRhY2hlZCkgewo+ICsgICAgICAgIGNoLT5hdHRhY2hlZC0+ZWRldl9j
b25maWd1cmVkID0gaC5jb25maWd1cmF0aW9uICE9IDA7Cj4gKyAgICB9Cj4gKyAgICB1c2JyZWRp
cnBhcnNlcl9zZW5kX2NvbmZpZ3VyYXRpb25fc3RhdHVzKGNoLT5wYXJzZXIsIGlkLCAmaCk7Cj4g
KyAgICB1c2JyZWRpcl93cml0ZV9mbHVzaF9jYWxsYmFjayhjaCk7Cj4gIH0KPiAgCj4gIHN0YXRp
YyB2b2lkIHVzYnJlZGlyX2dldF9jb25maWd1cmF0aW9uKHZvaWQgKnByaXYsIHVpbnQ2NF90IGlk
KQo+ICB7Cj4gLSAgICBVU0JSRURJUl9DQUxMQkFDS19OT1RfSU1QTEVNRU5URUQoKTsKPiArICAg
IFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoID0gcHJpdjsKPiArICAgIHN0cnVjdCB1c2JfcmVk
aXJfY29uZmlndXJhdGlvbl9zdGF0dXNfaGVhZGVyIGg7Cj4gKyAgICBoLnN0YXR1cyA9IDA7Cj4g
KyAgICBoLmNvbmZpZ3VyYXRpb24gPSBjaC0+YXR0YWNoZWQgJiYgY2gtPmF0dGFjaGVkLT5lZGV2
X2NvbmZpZ3VyZWQ7Cj4gKyAgICBTUElDRV9ERUJVRygiJXMgY2ggJXAsIGNmZyAlZCIsIF9fRlVO
Q1RJT05fXywgY2gsIGguY29uZmlndXJhdGlvbik7Cj4gKyAgICB1c2JyZWRpcnBhcnNlcl9zZW5k
X2NvbmZpZ3VyYXRpb25fc3RhdHVzKGNoLT5wYXJzZXIsIGlkLCAmaCk7Cj4gKyAgICB1c2JyZWRp
cl93cml0ZV9mbHVzaF9jYWxsYmFjayhjaCk7Cj4gIH0KPiAgCj4gIHN0YXRpYyB2b2lkCj4gIHVz
YnJlZGlyX3NldF9hbHRfc2V0dGluZyh2b2lkICpwcml2LCB1aW50NjRfdCBpZCwgc3RydWN0Cj4g
IHVzYl9yZWRpcl9zZXRfYWx0X3NldHRpbmdfaGVhZGVyICpzKQo+ICB7Cj4gLSAgICBVU0JSRURJ
Ul9DQUxMQkFDS19OT1RfSU1QTEVNRU5URUQoKTsKPiArICAgIFNwaWNlVXNiQmFja2VuZENoYW5u
ZWwgKmNoID0gcHJpdjsKPiArICAgIHN0cnVjdCB1c2JfcmVkaXJfYWx0X3NldHRpbmdfc3RhdHVz
X2hlYWRlciBzaDsKPiArICAgIHNoLnN0YXR1cyA9ICghcy0+aW50ZXJmYWNlICYmICFzLT5hbHQp
ID8gMCA6IHVzYl9yZWRpcl9zdGFsbDsKPiArICAgIHNoLmludGVyZmFjZSA9IHMtPmludGVyZmFj
ZTsKPiArICAgIHNoLmFsdCA9IHMtPmFsdDsKPiArICAgIFNQSUNFX0RFQlVHKCIlcyBjaCAlcCwg
JWQ6JWQiLCBfX0ZVTkNUSU9OX18sIGNoLCBzLT5pbnRlcmZhY2UsIHMtPmFsdCk7Cj4gKyAgICB1
c2JyZWRpcnBhcnNlcl9zZW5kX2FsdF9zZXR0aW5nX3N0YXR1cyhjaC0+cGFyc2VyLCBpZCwgJnNo
KTsKPiArICAgIHVzYnJlZGlyX3dyaXRlX2ZsdXNoX2NhbGxiYWNrKGNoKTsKPiAgfQo+ICAKPiAg
c3RhdGljIHZvaWQKPiAgdXNicmVkaXJfZ2V0X2FsdF9zZXR0aW5nKHZvaWQgKnByaXYsIHVpbnQ2
NF90IGlkLCBzdHJ1Y3QKPiAgdXNiX3JlZGlyX2dldF9hbHRfc2V0dGluZ19oZWFkZXIgKnMpCj4g
IHsKPiAtICAgIFVTQlJFRElSX0NBTExCQUNLX05PVF9JTVBMRU1FTlRFRCgpOwo+ICsgICAgU3Bp
Y2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSBwcml2Owo+ICsgICAgc3RydWN0IHVzYl9yZWRpcl9h
bHRfc2V0dGluZ19zdGF0dXNfaGVhZGVyIHNoOwo+ICsgICAgc2guc3RhdHVzID0gKHMtPmludGVy
ZmFjZSA9PSAwKSA/IDAgOiB1c2JfcmVkaXJfc3RhbGw7Cj4gKyAgICBzaC5pbnRlcmZhY2UgPSBz
LT5pbnRlcmZhY2U7Cj4gKyAgICBzaC5hbHQgPSAwOwo+ICsgICAgU1BJQ0VfREVCVUcoIiVzIGNo
ICVwLCBpZiAlZCIsIF9fRlVOQ1RJT05fXywgY2gsIHMtPmludGVyZmFjZSk7Cj4gKyAgICB1c2Jy
ZWRpcnBhcnNlcl9zZW5kX2FsdF9zZXR0aW5nX3N0YXR1cyhjaC0+cGFyc2VyLCBpZCwgJnNoKTsK
PiArICAgIHVzYnJlZGlyX3dyaXRlX2ZsdXNoX2NhbGxiYWNrKGNoKTsKPiAgfQo+ICAKPiAgc3Rh
dGljIHZvaWQgdXNicmVkaXJfY2FuY2VsX2RhdGEodm9pZCAqcHJpdiwgdWludDY0X3QgaWQpCj4g
IHsKPiAtICAgIFVTQlJFRElSX0NBTExCQUNLX05PVF9JTVBMRU1FTlRFRCgpOwo+ICsgICAgU3Bp
Y2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSBwcml2Owo+ICsgICAgU3BpY2VVc2JCYWNrZW5kRGV2
aWNlICpkID0gY2gtPmF0dGFjaGVkOwo+ICsgICAgU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZWRl
diA9IGQgPyBkLT5lZGV2IDogTlVMTDsKPiArICAgIGlmICghZWRldikgewo+ICsgICAgICAgIFNQ
SUNFX0RFQlVHKCIlczogZGV2aWNlIG5vdCBhdHRhY2hlZCIsIF9fRlVOQ1RJT05fXyk7Cj4gKyAg
ICAgICAgcmV0dXJuOwo+ICsgICAgfQo+ICsgICAgZGV2aWNlX29wcyhlZGV2KS0+Y2FuY2VsX3Jl
cXVlc3QoZWRldiwgaWQpOwo+ICB9Cj4gIAo+ICBzdGF0aWMgdm9pZCB1c2JyZWRpcl9maWx0ZXJf
cmVqZWN0KHZvaWQgKnByaXYpCj4gIHsKPiAtICAgIFVTQlJFRElSX0NBTExCQUNLX05PVF9JTVBM
RU1FTlRFRCgpOwo+ICsgICAgU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2ggPSBwcml2Owo+ICsg
ICAgU1BJQ0VfREVCVUcoIiVzICVwIiwgX19GVU5DVElPTl9fLCBjaCk7Cj4gKyAgICBjaC0+cmVq
ZWN0ZWQgPSAxOwo+ICB9Cj4gIAo+ICAvKiBOb3RlIHRoYXQgdGhlIG93bmVyc2hpcCBvZiB0aGUg
cnVsZXMgYXJyYXkgaXMgcGFzc2VkIG9uIHRvIHRoZSBjYWxsYmFjay4KPiAgKi8KPiBAQCAtODI3
LDEzICsxMDM5LDc3IEBAIHVzYnJlZGlyX2ZpbHRlcl9maWx0ZXIodm9pZCAqcHJpdiwgc3RydWN0
Cj4gdXNicmVkaXJmaWx0ZXJfcnVsZSAqciwgaW50IGNvdW50KQo+ICAKPiAgc3RhdGljIHZvaWQg
dXNicmVkaXJfZGV2aWNlX2Rpc2Nvbm5lY3RfYWNrKHZvaWQgKnByaXYpCj4gIHsKPiAtICAgIFVT
QlJFRElSX0NBTExCQUNLX05PVF9JTVBMRU1FTlRFRCgpOwo+ICsgICAgU3BpY2VVc2JCYWNrZW5k
Q2hhbm5lbCAqY2ggPSBwcml2Owo+ICsgICAgU1BJQ0VfREVCVUcoIiVzIGNoICVwIiwgX19GVU5D
VElPTl9fLCBjaCk7Cj4gKyAgICBpZiAoY2gtPnN0YXRlID09IFVTQl9DSEFOTkVMX1NUQVRFX1BB
UlNFUiAmJiBjaC0+dXNicmVkaXJob3N0ICE9IE5VTEwgJiYKPiArICAgICAgICBjaC0+d2FpdF9k
aXNjb25uZWN0X2Fjaykgewo+ICsgICAgICAgIGNoLT5zdGF0ZSA9IFVTQl9DSEFOTkVMX1NUQVRF
X0hPU1Q7Cj4gKyAgICAgICAgU1BJQ0VfREVCVUcoIiVzIHN3aXRjaCB0byB1c2JyZWRpcmhvc3Qi
LCBfX0ZVTkNUSU9OX18pOwo+ICsgICAgfQo+ICsgICAgY2gtPndhaXRfZGlzY29ubmVjdF9hY2sg
PSAwOwo+ICB9Cj4gIAo+ICBzdGF0aWMgdm9pZAo+ICB1c2JyZWRpcl9oZWxsbyh2b2lkICpwcml2
LCBzdHJ1Y3QgdXNiX3JlZGlyX2hlbGxvX2hlYWRlciAqaGVsbG8pCj4gIHsKPiAtICAgIFVTQlJF
RElSX0NBTExCQUNLX05PVF9JTVBMRU1FTlRFRCgpOwo+ICsgICAgU3BpY2VVc2JCYWNrZW5kQ2hh
bm5lbCAqY2ggPSBwcml2Owo+ICsgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkID0gY2gtPmF0
dGFjaGVkOwo+ICsgICAgU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZWRldiA9IGQgPyBkLT5lZGV2
IDogTlVMTDsKPiArICAgIHN0cnVjdCB1c2JfcmVkaXJfZGV2aWNlX2Nvbm5lY3RfaGVhZGVyIGRl
dmljZV9jb25uZWN0Owo+ICsgICAgc3RydWN0IHVzYl9yZWRpcl9lcF9pbmZvX2hlYWRlciBlcF9p
bmZvID0geyAwIH07Cj4gKyAgICBzdHJ1Y3QgdXNiX3JlZGlyX2ludGVyZmFjZV9pbmZvX2hlYWRl
ciBpbnRlcmZhY2VfaW5mbyA9IHsgMCB9Owo+ICsgICAgdWludDhfdCAqY2ZnOwo+ICsgICAgdWlu
dDE2X3Qgc2l6ZSwgb2Zmc2V0ID0gMDsKPiArICAgIFNQSUNFX0RFQlVHKCIlcyAlcCAlc2F0dGFj
aGVkICVzIiwgX19GVU5DVElPTl9fLCBjaCwKPiArICAgICAgICBlZGV2ID8gIiIgOiAibm90ICIs
ICBoZWxsbyA/ICIiIDogIihpbnRlcm5hbCkiKTsKPiArCj4gKyAgICBpZiAoIWVkZXYpIHsKPiAr
ICAgICAgICByZXR1cm47Cj4gKyAgICB9Cj4gKyAgICBpZiAoIWRldmljZV9vcHMoZWRldiktPmdl
dF9kZXNjcmlwdG9yKGVkZXYsIExJQlVTQl9EVF9DT05GSUcsIDAsICh2b2lkCj4gKiopJmNmZywg
JnNpemUpKSB7Cj4gKyAgICAgICAgcmV0dXJuOwo+ICsgICAgfQo+ICsgICAgd2hpbGUgKChvZmZz
ZXQgKyAxKSA8IHNpemUpIHsKPiArICAgICAgICB1aW50OF90IGxlbiAgPSBjZmdbb2Zmc2V0XTsK
PiArICAgICAgICB1aW50OF90IHR5cGUgPSBjZmdbb2Zmc2V0ICsgMV07Cj4gKyAgICAgICAgaWYg
KChvZmZzZXQgKyBsZW4pID4gc2l6ZSkgewo+ICsgICAgICAgICAgICBicmVhazsKPiArICAgICAg
ICB9Cj4gKyAgICAgICAgaWYgKHR5cGUgPT0gTElCVVNCX0RUX0lOVEVSRkFDRSkgewo+ICsgICAg
ICAgICAgICB1aW50MzJfdCBpID0gaW50ZXJmYWNlX2luZm8uaW50ZXJmYWNlX2NvdW50Owo+ICsg
ICAgICAgICAgICB1aW50OF90IGNsYXNzLCBzdWJjbGFzcywgcHJvdG9jb2w7Cj4gKyAgICAgICAg
ICAgIGNsYXNzID0gY2ZnW29mZnNldCArIDVdOwo+ICsgICAgICAgICAgICBzdWJjbGFzcyA9IGNm
Z1tvZmZzZXQgKyA2XTsKPiArICAgICAgICAgICAgcHJvdG9jb2wgPSBjZmdbb2Zmc2V0ICsgN107
Cj4gKyAgICAgICAgICAgIGludGVyZmFjZV9pbmZvLmludGVyZmFjZV9jbGFzc1tpXSA9IGNsYXNz
Owo+ICsgICAgICAgICAgICBpbnRlcmZhY2VfaW5mby5pbnRlcmZhY2Vfc3ViY2xhc3NbaV0gPSBz
dWJjbGFzczsKPiArICAgICAgICAgICAgaW50ZXJmYWNlX2luZm8uaW50ZXJmYWNlX3Byb3RvY29s
W2ldID0gcHJvdG9jb2w7Cj4gKyAgICAgICAgICAgIGludGVyZmFjZV9pbmZvLmludGVyZmFjZV9j
b3VudCsrOwo+ICsgICAgICAgICAgICBTUElDRV9ERUJVRygiJXMgSUYlZDogJWQvJWQvJWQiLCBf
X0ZVTkNUSU9OX18sIGksIGNsYXNzLAo+IHN1YmNsYXNzLCBwcm90b2NvbCk7Cj4gKyAgICAgICAg
fSBlbHNlIGlmICh0eXBlID09IExJQlVTQl9EVF9FTkRQT0lOVCkgewo+ICsgICAgICAgICAgICB1
aW50OF90IGFkZHJlc3MgPSBjZmdbb2Zmc2V0ICsgMl07Cj4gKyAgICAgICAgICAgIHVpbnQxNl90
IG1heF9wYWNrZXRfc2l6ZSA9IDB4MTAwICogY2ZnW29mZnNldCArIDVdICsgY2ZnW29mZnNldAo+
ICsgNF07Cj4gKyAgICAgICAgICAgIHVpbnQ4X3QgaW5kZXggPSBhZGRyZXNzICYgMHhmOwo+ICsg
ICAgICAgICAgICBpZiAoYWRkcmVzcyAmIDB4ODApIGluZGV4ICs9IDB4MTA7Cj4gKyAgICAgICAg
ICAgIGVwX2luZm8udHlwZVtpbmRleF0gPSBjZmdbb2Zmc2V0ICsgM10gJiAweDM7Cj4gKyAgICAg
ICAgICAgIGVwX2luZm8ubWF4X3BhY2tldF9zaXplW2luZGV4XSA9IG1heF9wYWNrZXRfc2l6ZTsK
PiArICAgICAgICAgICAgU1BJQ0VfREVCVUcoIiVzIEVQWyUwMlhdOiAlZC8lZCIsIF9fRlVOQ1RJ
T05fXywgaW5kZXgsCj4gZXBfaW5mby50eXBlW2luZGV4XSwgbWF4X3BhY2tldF9zaXplKTsKPiAr
ICAgICAgICB9Cj4gKyAgICAgICAgb2Zmc2V0ICs9IGxlbjsKPiArICAgIH0KPiArCj4gKyAgICB1
c2JyZWRpcnBhcnNlcl9zZW5kX2ludGVyZmFjZV9pbmZvKGNoLT5wYXJzZXIsICZpbnRlcmZhY2Vf
aW5mbyk7Cj4gKyAgICB1c2JyZWRpcnBhcnNlcl9zZW5kX2VwX2luZm8oY2gtPnBhcnNlciwgJmVw
X2luZm8pOwo+ICsKPiArICAgIGRldmljZV9jb25uZWN0LmRldmljZV9jbGFzcyA9IDA7IC8vZC0+
ZGV2aWNlX2luZm8uY2xhc3M7Cj4gKyAgICBkZXZpY2VfY29ubmVjdC5kZXZpY2Vfc3ViY2xhc3Mg
PSAwOyAvL2QtPmRldmljZV9pbmZvLnN1YmNsYXNzOwo+ICsgICAgZGV2aWNlX2Nvbm5lY3QuZGV2
aWNlX3Byb3RvY29sID0gMDsgLy9kLT5kZXZpY2VfaW5mby5wcm90b2NvbDs7Cj4gKyAgICBkZXZp
Y2VfY29ubmVjdC52ZW5kb3JfaWQgPSBkLT5kZXZpY2VfaW5mby52aWQ7Cj4gKyAgICBkZXZpY2Vf
Y29ubmVjdC5wcm9kdWN0X2lkID0gZC0+ZGV2aWNlX2luZm8ucGlkOwo+ICsgICAgZGV2aWNlX2Nv
bm5lY3QuZGV2aWNlX3ZlcnNpb25fYmNkID0gZC0+ZGV2aWNlX2luZm8uYmNkVVNCOwo+ICsgICAg
ZGV2aWNlX2Nvbm5lY3Quc3BlZWQgPSB1c2JfcmVkaXJfc3BlZWRfaGlnaDsKPiArICAgIHVzYnJl
ZGlycGFyc2VyX3NlbmRfZGV2aWNlX2Nvbm5lY3QoY2gtPnBhcnNlciwgJmRldmljZV9jb25uZWN0
KTsKPiArICAgIHVzYnJlZGlyX3dyaXRlX2ZsdXNoX2NhbGxiYWNrKGNoKTsKPiAgfQo+ICAKPiAg
c3RhdGljIHZvaWQgaW5pdGlhbGl6ZV9wYXJzZXIoU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gp
Cj4gQEAgLTg5OSwxNCArMTE3NSwzNiBAQCBzdGF0aWMgc3RydWN0IHVzYnJlZGlycGFyc2VyCj4g
KmNyZWF0ZV9wYXJzZXIoU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gpCj4gICAgICByZXR1cm4g
cGFyc2VyOwo+ICB9Cj4gIAo+IC12b2lkIHNwaWNlX3VzYl9iYWNrZW5kX3JldHVybl93cml0ZV9k
YXRhKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLCB2b2lkCj4gKmRhdGEpCj4gK3N0YXRpYyBn
Ym9vbGVhbiBhdHRhY2hfZWRldihTcGljZVVzYkJhY2tlbmRDaGFubmVsICpjaCwKPiArICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqZGV2LAo+ICsgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgR0Vycm9yICoqZXJyb3IpCj4gIHsKPiAtICAgIGlmIChj
aC0+dXNicmVkaXJob3N0KSB7Cj4gLSAgICAgICAgU1BJQ0VfREVCVUcoIiVzIGNoICVwIiwgX19G
VU5DVElPTl9fLCBjaCk7Cj4gLSAgICAgICAgdXNicmVkaXJob3N0X2ZyZWVfd3JpdGVfYnVmZmVy
KGNoLT51c2JyZWRpcmhvc3QsIGRhdGEpOwo+ICsgICAgaWYgKCFkZXYtPmVkZXYpIHsKPiArICAg
ICAgICBnX3NldF9lcnJvcihlcnJvciwgU1BJQ0VfQ0xJRU5UX0VSUk9SLCBTUElDRV9DTElFTlRf
RVJST1JfRkFJTEVELAo+ICsgICAgICAgICAgIF8oIkZhaWxlZCB0byByZWRpcmVjdCBkZXZpY2Ug
JWQiKSwgMSk7Cj4gKyAgICAgICAgcmV0dXJuIEZBTFNFOwo+ICsgICAgfQo+ICsgICAgaWYgKGNo
LT5zdGF0ZSA9PSBVU0JfQ0hBTk5FTF9TVEFURV9JTklUSUFMSVpJTkcpIHsKPiArICAgICAgICAv
Kgo+ICsgICAgICAgICAgICB3ZSBjYW4ndCBpbml0aWFsaXplIHBhcnNlciB1bnRpbCB3ZSBzZWUg
aGVsbG8gZnJvbSB1c2JyZWRpcgo+ICsgICAgICAgICAgICBhbmQgdGhlIHBhcnNlciBjYW4ndCB3
b3JrIHVudGlsIGl0IHNlZXMgdGhlIGhlbGxvIHJlc3BvbnNlLgo+ICsgICAgICAgICAgICB0aGlz
IGlzIGNhc2Ugb2YgYXV0b2Nvbm5lY3Qgd2hlbiBlbXVsYXRlZCBkZXZpY2UgaXMgYXR0YWNoZWQK
PiArICAgICAgICAgICAgYmVmb3JlIHRoZSBjaGFubmVsIGlzIHVwCj4gKyAgICAgICAgKi8KPiAr
ICAgICAgICBTUElDRV9ERUJVRygiJXMgd2FpdGluZyB1bnRpbCB0aGUgY2hhbm5lbCBpcyByZWFk
eSIsIF9fRlVOQ1RJT05fXyk7Cj4gKwo+ICAgICAgfSBlbHNlIHsKPiAtICAgICAgICBTUElDRV9E
RUJVRygiJXMgY2ggJXAgLSBOT0JPRFkgVE8gQ0FMTCIsIF9fRlVOQ1RJT05fXywgY2gpOwo+ICsg
ICAgICAgIGNoLT5zdGF0ZSA9IFVTQl9DSEFOTkVMX1NUQVRFX1BBUlNFUjsKPiAgICAgIH0KPiAr
ICAgIGNoLT53YWl0X2Rpc2Nvbm5lY3RfYWNrID0gMDsKPiArICAgIGNoLT5hdHRhY2hlZCA9IGRl
djsKPiArICAgIGRldi0+YXR0YWNoZWRfdG8gPSBjaDsKPiArICAgIGRldmljZV9vcHMoZGV2LT5l
ZGV2KS0+YXR0YWNoKGRldi0+ZWRldiwgY2gtPnBhcnNlcik7Cj4gKyAgICBpZiAoY2gtPnN0YXRl
ID09IFVTQl9DSEFOTkVMX1NUQVRFX1BBUlNFUikgewo+ICsgICAgICAgIC8qIHNlbmQgZGV2aWNl
IGluZm8gKi8KPiArICAgICAgICB1c2JyZWRpcl9oZWxsbyhjaCwgTlVMTCk7Cj4gKyAgICB9Cj4g
KyAgICByZXR1cm4gVFJVRTsKPiAgfQo+ICAKPiAgZ2Jvb2xlYW4gc3BpY2VfdXNiX2JhY2tlbmRf
Y2hhbm5lbF9hdHRhY2goU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gsCj4gQEAgLTkxOCwxMiAr
MTIxNiwxOSBAQCBnYm9vbGVhbgo+IHNwaWNlX3VzYl9iYWNrZW5kX2NoYW5uZWxfYXR0YWNoKFNw
aWNlVXNiQmFja2VuZENoYW5uZWwgKmNoLAo+ICAKPiAgICAgIGdfcmV0dXJuX3ZhbF9pZl9mYWls
KGRldiAhPSBOVUxMLCBGQUxTRSk7Cj4gIAo+ICsgICAgaWYgKCFkZXYtPmxpYnVzYl9kZXZpY2Up
IHsKPiArICAgICAgICByZXR1cm4gYXR0YWNoX2VkZXYoY2gsIGRldiwgZXJyb3IpOwo+ICsgICAg
fQo+ICsKPiAgICAgIC8vIG5vIHBoeXNpY2FsIGRldmljZSBlbmFibGVkCj4gICAgICBpZiAoY2gt
PnVzYnJlZGlyaG9zdCA9PSBOVUxMKSB7Cj4gICAgICAgICAgcmV0dXJuIEZBTFNFOwo+ICAgICAg
fQo+ICAKPiAgICAgIGxpYnVzYl9kZXZpY2VfaGFuZGxlICpoYW5kbGUgPSBOVUxMOwo+ICsgICAg
aWYgKGNoLT5zdGF0ZSAhPSBVU0JfQ0hBTk5FTF9TVEFURV9JTklUSUFMSVpJTkcpIHsKPiArICAg
ICAgICBjaC0+c3RhdGUgPSBVU0JfQ0hBTk5FTF9TVEFURV9IT1NUOwo+ICsgICAgfQo+ICAKPiAg
ICAgIC8qCj4gICAgICAgICBVbmRlciBXaW5kb3dzIHdlIG5lZWQgdG8gYXZvaWQgdXBkYXRpbmcK
PiBAQCAtOTU3LDE4ICsxMjYyLDMyIEBAIGdib29sZWFuCj4gc3BpY2VfdXNiX2JhY2tlbmRfY2hh
bm5lbF9hdHRhY2goU3BpY2VVc2JCYWNrZW5kQ2hhbm5lbCAqY2gsCj4gIAo+ICB2b2lkIHNwaWNl
X3VzYl9iYWNrZW5kX2NoYW5uZWxfZGV0YWNoKFNwaWNlVXNiQmFja2VuZENoYW5uZWwgKmNoKQo+
ICB7Cj4gKyAgICBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmQgPSBjaC0+YXR0YWNoZWQ7Cj4gKyAg
ICBTcGljZVVzYkVtdWxhdGVkRGV2aWNlICplZGV2ID0gZCA/IGQtPmVkZXYgOiBOVUxMOwo+ICAg
ICAgU1BJQ0VfREVCVUcoIiVzID4+IGNoICVwLCB3YXMgYXR0YWNoZWQgJXAiLCBfX0ZVTkNUSU9O
X18sIGNoLAo+ICAgICAgY2gtPmF0dGFjaGVkKTsKPiAtICAgIGlmICghY2gtPmF0dGFjaGVkKSB7
Cj4gKyAgICBpZiAoIWQpIHsKPiAgICAgICAgICBTUElDRV9ERUJVRygiJXM6IG5vdGhpbmcgdG8g
ZGV0YWNoIiwgX19GVU5DVElPTl9fKTsKPiAgICAgICAgICByZXR1cm47Cj4gICAgICB9Cj4gLSAg
ICBpZiAoY2gtPnVzYnJlZGlyaG9zdCkgewo+ICsgICAgaWYgKGNoLT5zdGF0ZSA9PSBVU0JfQ0hB
Tk5FTF9TVEFURV9IT1NUKSB7Cj4gICAgICAgICAgLyogaXQgd2lsbCBjYWxsIGxpYnVzYl9jbG9z
ZSBpbnRlcm5hbGx5ICovCj4gICAgICAgICAgdXNicmVkaXJob3N0X3NldF9kZXZpY2UoY2gtPnVz
YnJlZGlyaG9zdCwgTlVMTCk7Cj4gKyAgICB9IGVsc2Ugewo+ICsgICAgICAgIGlmIChlZGV2KSB7
Cj4gKyAgICAgICAgICAgIGRldmljZV9vcHMoZWRldiktPmRldGFjaChlZGV2KTsKPiArICAgICAg
ICB9Cj4gKyAgICAgICAgdXNicmVkaXJwYXJzZXJfc2VuZF9kZXZpY2VfZGlzY29ubmVjdChjaC0+
cGFyc2VyKTsKPiArICAgICAgICB1c2JyZWRpcl93cml0ZV9mbHVzaF9jYWxsYmFjayhjaCk7Cj4g
KyAgICAgICAgY2gtPndhaXRfZGlzY29ubmVjdF9hY2sgPQo+ICsgICAgICAgICAgICB1c2JyZWRp
cnBhcnNlcl9wZWVyX2hhc19jYXAoY2gtPnBhcnNlciwKPiB1c2JfcmVkaXJfY2FwX2RldmljZV9k
aXNjb25uZWN0X2Fjayk7Cj4gKyAgICAgICAgaWYgKCFjaC0+d2FpdF9kaXNjb25uZWN0X2FjayAm
JiBjaC0+dXNicmVkaXJob3N0ICE9IE5VTEwpIHsKPiArICAgICAgICAgICAgY2gtPnN0YXRlID0g
VVNCX0NIQU5ORUxfU1RBVEVfSE9TVDsKPiArICAgICAgICB9Cj4gICAgICB9Cj4gICAgICBTUElD
RV9ERUJVRygiJXMgY2ggJXAsIGRldGFjaCBkb25lIiwgX19GVU5DVElPTl9fLCBjaCk7Cj4gICAg
ICBjaC0+YXR0YWNoZWQtPmF0dGFjaGVkX3RvID0gTlVMTDsKPiAgICAgIGNoLT5hdHRhY2hlZCA9
IE5VTEw7Cj4gKyAgICBjaC0+cmVqZWN0ZWQgPSAwOwo+ICB9Cj4gIAo+ICBTcGljZVVzYkJhY2tl
bmRDaGFubmVsICoKPiBAQCAtOTgyLDIzICsxMzAxLDI1IEBAIHNwaWNlX3VzYl9iYWNrZW5kX2No
YW5uZWxfbmV3KFNwaWNlVXNiQmFja2VuZCAqYmUsCj4gICAgICBjaC0+dXNicmVkaXJfY2hhbm5l
bCA9IHVzYnJlZGlyX2NoYW5uZWw7Cj4gICAgICBpZiAoYmUtPmxpYnVzYl9jb250ZXh0KSB7Cj4g
ICAgICAgICAgY2gtPmJhY2tlbmQgPSBiZTsKPiAtICAgICAgICBjaC0+dXNicmVkaXJob3N0ID0g
dXNicmVkaXJob3N0X29wZW5fZnVsbCgKPiAtICAgICAgICAgICAgYmUtPmxpYnVzYl9jb250ZXh0
LAo+IC0gICAgICAgICAgICBOVUxMLAo+IC0gICAgICAgICAgICB1c2JyZWRpcl9sb2csCj4gLSAg
ICAgICAgICAgIHVzYnJlZGlyX3JlYWRfY2FsbGJhY2ssCj4gLSAgICAgICAgICAgIHVzYnJlZGly
X3dyaXRlX2NhbGxiYWNrLAo+IC0gICAgICAgICAgICB1c2JyZWRpcl93cml0ZV9mbHVzaF9jYWxs
YmFjaywKPiAtICAgICAgICAgICAgdXNicmVkaXJfYWxsb2NfbG9jaywKPiAtICAgICAgICAgICAg
dXNicmVkaXJfbG9ja19sb2NrLAo+IC0gICAgICAgICAgICB1c2JyZWRpcl91bmxvY2tfbG9jaywK
PiAtICAgICAgICAgICAgdXNicmVkaXJfZnJlZV9sb2NrLAo+IC0gICAgICAgICAgICBjaCwgUEFD
S0FHRV9TVFJJTkcsCj4gLSAgICAgICAgICAgIHNwaWNlX3V0aWxfZ2V0X2RlYnVnKCkgPyB1c2Jy
ZWRpcnBhcnNlcl9kZWJ1ZyA6Cj4gdXNicmVkaXJwYXJzZXJfd2FybmluZywKPiAtICAgICAgICAg
ICAgdXNicmVkaXJob3N0X2ZsX3dyaXRlX2NiX293bnNfYnVmZmVyKTsKPiArICAgICAgICBjaC0+
dXNicmVkaXJob3N0ID0KPiArICAgICAgICAgICAgdXNicmVkaXJob3N0X29wZW5fZnVsbChiZS0+
bGlidXNiX2NvbnRleHQsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTlVM
TCwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2JyZWRpcl9sb2csCj4g
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNicmVkaXJfcmVhZF9jYWxsYmFj
aywKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2JyZWRpcl93cml0ZV9j
YWxsYmFjaywKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2JyZWRpcl93
cml0ZV9mbHVzaF9jYWxsYmFjaywKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB1c2JyZWRpcl9hbGxvY19sb2NrLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHVzYnJlZGlyX2xvY2tfbG9jaywKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB1c2JyZWRpcl91bmxvY2tfbG9jaywKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB1c2JyZWRpcl9mcmVlX2xvY2ssCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgY2gsIFBBQ0tBR0VfU1RSSU5HLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHNwaWNlX3V0aWxfZ2V0X2RlYnVnKCkgPwo+IHVzYnJlZGlycGFyc2VyX2RlYnVn
IDoKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzYnJlZGlycGFy
c2VyX3dhcm5pbmcsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNicmVk
aXJob3N0X2ZsX3dyaXRlX2NiX293bnNfYnVmZmVyKTsKPiAgICAgICAgICBnX3dhcm5faWZfZmFp
bChjaC0+dXNicmVkaXJob3N0ICE9IE5VTEwpOwo+IC0gICAgICAgIGlmIChjaC0+dXNicmVkaXJo
b3N0KSB7Cj4gLSAgICAgICAgICAgIHVzYnJlZGlyaG9zdF9zZXRfYnVmZmVyZWRfb3V0cHV0X3Np
emVfY2IoY2gtPnVzYnJlZGlyaG9zdCwKPiB1c2JyZWRpcl9idWZmZXJlZF9vdXRwdXRfc2l6ZV9j
YWxsYmFjayk7Cj4gKyAgICAgICAgaWYgKGNoLT51c2JyZWRpcmhvc3QgIT0gTlVMTCkgewo+ICsg
ICAgICAgICAgICB1c2JyZWRpcmhvc3Rfc2V0X2J1ZmZlcmVkX291dHB1dF9zaXplX2NiKGNoLT51
c2JyZWRpcmhvc3QsCj4gKwo+IHVzYnJlZGlyX2J1ZmZlcmVkX291dHB1dF9zaXplX2NhbGxiYWNr
KTsKPiAgICAgICAgICAgICAgLy8gZm9yY2UgZmx1c2ggb2YgSEVMTE8gcGFja2V0IGFuZCBjcmVh
dGlvbiBvZiBwYXJzZXIKPiAgICAgICAgICAgICAgdXNicmVkaXJob3N0X3dyaXRlX2d1ZXN0X2Rh
dGEoY2gtPnVzYnJlZGlyaG9zdCk7Cj4gICAgICAgICAgfQo+IEBAIC0xMDIyLDkgKzEzNDMsMTEg
QEAgc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9uZXcoU3BpY2VVc2JCYWNrZW5kICpiZSwKPiAg
Cj4gIHZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfY2hhbm5lbF9mbHVzaF93cml0ZXMoU3BpY2VVc2JC
YWNrZW5kQ2hhbm5lbCAqY2gpCj4gIHsKPiAtICAgIFNQSUNFX0RFQlVHKCIlcyAlcCwgaG9zdCAl
cCIsIF9fRlVOQ1RJT05fXywgY2gsIGNoLT51c2JyZWRpcmhvc3QpOwo+IC0gICAgaWYgKGNoLT51
c2JyZWRpcmhvc3QpIHsKPiArICAgIFNQSUNFX0RFQlVHKCIlcyAlcCBpcyB1cCIsIF9fRlVOQ1RJ
T05fXywgY2gpOwo+ICsgICAgaWYgKGNoLT5zdGF0ZSAhPSBVU0JfQ0hBTk5FTF9TVEFURV9QQVJT
RVIgJiYgY2gtPnVzYnJlZGlyaG9zdCAhPSBOVUxMKSB7Cj4gICAgICAgICAgdXNicmVkaXJob3N0
X3dyaXRlX2d1ZXN0X2RhdGEoY2gtPnVzYnJlZGlyaG9zdCk7Cj4gKyAgICB9IGVsc2Ugewo+ICsg
ICAgICAgIHVzYnJlZGlycGFyc2VyX2RvX3dyaXRlKGNoLT5wYXJzZXIpOwo+ICAgICAgfQo+ICB9
Cj4gIAoKRnJlZGlhbm8KX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX18KU3BpY2UtZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3Nw
aWNlLWRldmVs
