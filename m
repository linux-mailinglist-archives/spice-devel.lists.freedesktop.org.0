Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8CEA6B7BC5
	for <lists+spice-devel@lfdr.de>; Thu, 19 Sep 2019 16:11:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CFB836F495;
	Thu, 19 Sep 2019 14:11:36 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A30C76F495
 for <spice-devel@lists.freedesktop.org>; Thu, 19 Sep 2019 14:11:35 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx06.intmail.prod.int.phx2.redhat.com
 [10.5.11.16])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 4DF663082135
 for <spice-devel@lists.freedesktop.org>; Thu, 19 Sep 2019 14:11:35 +0000 (UTC)
Received: from wingsuit.mxp.redhat.com (unknown [10.32.181.155])
 by smtp.corp.redhat.com (Postfix) with ESMTP id CB68A5C1B5
 for <spice-devel@lists.freedesktop.org>; Thu, 19 Sep 2019 14:11:34 +0000 (UTC)
From: Victor Toso <victortoso@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Thu, 19 Sep 2019 16:11:14 +0200
Message-Id: <20190919141133.10691-2-victortoso@redhat.com>
In-Reply-To: <20190919141133.10691-1-victortoso@redhat.com>
References: <20190919141133.10691-1-victortoso@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.16
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.42]); Thu, 19 Sep 2019 14:11:35 +0000 (UTC)
Subject: [Spice-devel] [PATCH v8 01/20] usb-redir: define interfaces to
 support emulated devices
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogWXVyaSBCZW5kaXRvdmljaCA8eXVyaS5iZW5kaXRvdmljaEBkYXluaXguY29tPgoKU3Bp
Y2VVc2JCYWNrZW5kRGV2aWNlIHN0cnVjdHVyZSBpcyBleHRlbmRlZCB0byBzdXBwb3J0CmFkZGl0
aW9uYWwga2luZCBvZiBkZXZpY2UgdGhhdCBpcyBlbXVsYXRlZCBieSBTcGljZS1HVEsKYW5kIG5v
dCBwcmVzZW50IGxvY2FsbHkgKGFuZCBkb2VzIG5vdCBoYXZlIGxpYnVzYl9kZXZpY2UpLApzdWNo
IGRldmljZSBoYXMgaW5zdGVhZCBwb2ludGVyIHRvIFNwaWNlVXNiRW11bGF0ZWREZXZpY2UKYWJz
dHJhY3Qgc3RydWN0dXJlLiBTcGVjaWZpYyBpbXBsZW1lbnRhdGlvbiBvZiBzdWNoIGRldmljZQpk
ZXBlbmRzIG9uIGl0cyBkZXZpY2UgdHlwZS4gSW1wbGVtZW50YXRpb24gbW9kdWxlIHdpbGwgZGVm
aW5lCmNvbnN0cnVjdG9yIGZvciBzcGVjaWZpYyBkZXZpY2UgdHlwZS4KRGV2aWNlIHN0cnVjdHVy
ZSBpcyBhYnN0cmFjdCBidXQgYWx3YXlzIHN0YXJ0cyBmcm9tIHRhYmxlIG9mCnZpcnR1YWwgZnVu
Y3Rpb25zIHJlcXVpcmVkIHRvIHJlZGlyZWN0IHN1Y2ggdmlydHVhbCBkZXZpY2UuCgpTaWduZWQt
b2ZmLWJ5OiBZdXJpIEJlbmRpdG92aWNoIDx5dXJpLmJlbmRpdG92aWNoQGRheW5peC5jb20+CkFj
a2VkLWJ5OiBGcmVkaWFubyBaaWdsaW8gPGZ6aWdsaW9AcmVkaGF0LmNvbT4KLS0tCiBzcmMvbWVz
b24uYnVpbGQgICAgIHwgICAxICsKIHNyYy91c2ItYmFja2VuZC5jICAgfCAxMDMgKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0KIHNyYy91c2ItYmFja2VuZC5oICAg
fCAgIDMgKysKIHNyYy91c2ItZW11bGF0aW9uLmggfCAgODggKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKwogNCBmaWxlcyBjaGFuZ2VkLCAxOTMgaW5zZXJ0aW9ucygrKSwgMiBk
ZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBzcmMvdXNiLWVtdWxhdGlvbi5oCgpkaWZm
IC0tZ2l0IGEvc3JjL21lc29uLmJ1aWxkIGIvc3JjL21lc29uLmJ1aWxkCmluZGV4IGRhYzg1YTcu
LjRkOTIxNWMgMTAwNjQ0Ci0tLSBhL3NyYy9tZXNvbi5idWlsZAorKysgYi9zcmMvbWVzb24uYnVp
bGQKQEAgLTEyMiw2ICsxMjIsNyBAQCBzcGljZV9jbGllbnRfZ2xpYl9zb3VyY2VzID0gWwogICAn
dXNidXRpbC5jJywKICAgJ3VzYnV0aWwuaCcsCiAgICd1c2ItYmFja2VuZC5jJywKKyAgJ3VzYi1l
bXVsYXRpb24uaCcsCiAgICd1c2ItYmFja2VuZC5oJywKICAgJ3ZtY3N0cmVhbS5jJywKICAgJ3Zt
Y3N0cmVhbS5oJywKZGlmZiAtLWdpdCBhL3NyYy91c2ItYmFja2VuZC5jIGIvc3JjL3VzYi1iYWNr
ZW5kLmMKaW5kZXggZTAyMWQ0My4uY2I0MWY3MSAxMDA2NDQKLS0tIGEvc3JjL3VzYi1iYWNrZW5k
LmMKKysrIGIvc3JjL3VzYi1iYWNrZW5kLmMKQEAgLTM5LDYgKzM5LDcgQEAKICNpbmNsdWRlICJ1
c2JyZWRpcnBhcnNlci5oIgogI2luY2x1ZGUgInNwaWNlLXV0aWwuaCIKICNpbmNsdWRlICJ1c2It
YmFja2VuZC5oIgorI2luY2x1ZGUgInVzYi1lbXVsYXRpb24uaCIKICNpbmNsdWRlICJjaGFubmVs
LXVzYnJlZGlyLXByaXYuaCIKICNpbmNsdWRlICJzcGljZS1jaGFubmVsLXByaXYuaCIKIApAQCAt
NDYsNyArNDcsMTAgQEAKIAogc3RydWN0IF9TcGljZVVzYkRldmljZQogeworICAgIC8qIFBvaW50
ZXIgdG8gZGV2aWNlLiBFaXRoZXIgcmVhbCBkZXZpY2UgKGxpYnVzYl9kZXZpY2UpCisgICAgICog
b3IgZW11bGF0ZWQgb25lIChlZGV2KSAqLwogICAgIGxpYnVzYl9kZXZpY2UgKmxpYnVzYl9kZXZp
Y2U7CisgICAgU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZWRldjsKICAgICBnaW50IHJlZl9jb3Vu
dDsKICAgICBTcGljZVVzYkJhY2tlbmRDaGFubmVsICphdHRhY2hlZF90bzsKICAgICBVc2JEZXZp
Y2VJbmZvcm1hdGlvbiBkZXZpY2VfaW5mbzsKQEAgLTY4LDYgKzcyLDEwIEBAIHN0cnVjdCBfU3Bp
Y2VVc2JCYWNrZW5kCiAgICAgbGlidXNiX2RldmljZSAqKmxpYnVzYl9kZXZpY2VfbGlzdDsKICAg
ICBnaW50IHJlZGlyZWN0aW5nOwogI2VuZGlmCisKKyAgICAvKiBNYXNrIG9mIGFsbG9jYXRlZCBk
ZXZpY2UsIGEgc3BlY2lmaWMgYml0IHNldCB0byAxIHRvIGluZGljYXRlIHRoYXQgdGhlIGRldmlj
ZSBhdAorICAgICAqIHRoYXQgYWRkcmVzcyBpcyBhbGxvY2F0ZWQgKi8KKyAgICB1aW50MzJfdCBv
d25fZGV2aWNlc19tYXNrOwogfTsKIAogc3RydWN0IF9TcGljZVVzYkJhY2tlbmRDaGFubmVsCkBA
IC00MjIsNiArNDMwLDggQEAgU3BpY2VVc2JCYWNrZW5kICpzcGljZV91c2JfYmFja2VuZF9uZXco
R0Vycm9yICoqZXJyb3IpCiAgICAgICAgIGxpYnVzYl9zZXRfb3B0aW9uKGJlLT5saWJ1c2JfY29u
dGV4dCwgTElCVVNCX09QVElPTl9VU0VfVVNCREspOwogI2VuZGlmCiAjZW5kaWYKKyAgICAgICAg
LyogZXhjbHVkZSBhZGRyZXNzZXMgMCAocmVzZXJ2ZWQpIGFuZCAxIChyb290IGh1YikgKi8KKyAg
ICAgICAgYmUtPm93bl9kZXZpY2VzX21hc2sgPSAzOwogICAgIH0KICAgICBTUElDRV9ERUJVRygi
JXMgPDwiLCBfX0ZVTkNUSU9OX18pOwogICAgIHJldHVybiBiZTsKQEAgLTUzOCw4ICs1NDgsMTMg
QEAgdm9pZCBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfdW5yZWYoU3BpY2VVc2JCYWNrZW5kRGV2
aWNlICpkZXYpCiB7CiAgICAgTE9VRF9ERUJVRygiJXMgPj4gJXAoJWQpIiwgX19GVU5DVElPTl9f
LCBkZXYsIGRldi0+cmVmX2NvdW50KTsKICAgICBpZiAoZ19hdG9taWNfaW50X2RlY19hbmRfdGVz
dCgmZGV2LT5yZWZfY291bnQpKSB7Ci0gICAgICAgIGxpYnVzYl91bnJlZl9kZXZpY2UoZGV2LT5s
aWJ1c2JfZGV2aWNlKTsKLSAgICAgICAgTE9VRF9ERUJVRygiJXMgZnJlZWluZyAlcCAobGlidXNi
ICVwKSIsIF9fRlVOQ1RJT05fXywgZGV2LCBkZXYtPmxpYnVzYl9kZXZpY2UpOworICAgICAgICBp
ZiAoZGV2LT5saWJ1c2JfZGV2aWNlKSB7CisgICAgICAgICAgICBsaWJ1c2JfdW5yZWZfZGV2aWNl
KGRldi0+bGlidXNiX2RldmljZSk7CisgICAgICAgICAgICBMT1VEX0RFQlVHKCIlcyBmcmVlaW5n
ICVwIChsaWJ1c2IgJXApIiwgX19GVU5DVElPTl9fLCBkZXYsIGRldi0+bGlidXNiX2RldmljZSk7
CisgICAgICAgIH0KKyAgICAgICAgaWYgKGRldi0+ZWRldikgeworICAgICAgICAgICAgZGV2aWNl
X29wcyhkZXYtPmVkZXYpLT51bnJlYWxpemUoZGV2LT5lZGV2KTsKKyAgICAgICAgfQogICAgICAg
ICBnX2ZyZWUoZGV2KTsKICAgICB9CiB9CkBAIC04MzcsNCArODUyLDg4IEBAIHNwaWNlX3VzYl9i
YWNrZW5kX2NoYW5uZWxfZ2V0X2d1ZXN0X2ZpbHRlcihTcGljZVVzYkJhY2tlbmRDaGFubmVsICpj
aCwKICAgICB9CiB9CiAKK3ZvaWQgc3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX3JlcG9ydF9jaGFu
Z2UoU3BpY2VVc2JCYWNrZW5kICpiZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgU3BpY2VVc2JCYWNrZW5kRGV2aWNlICpkZXYpCit7CisgICAgZ2NoYXIgKmRl
c2M7CisgICAgZ19yZXR1cm5faWZfZmFpbChkZXYgJiYgZGV2LT5lZGV2KTsKKworICAgIGRlc2Mg
PSBkZXZpY2Vfb3BzKGRldi0+ZWRldiktPmdldF9wcm9kdWN0X2Rlc2NyaXB0aW9uKGRldi0+ZWRl
dik7CisgICAgU1BJQ0VfREVCVUcoIiVzOiAlcyIsIF9fRlVOQ1RJT05fXywgZGVzYyk7CisgICAg
Z19mcmVlKGRlc2MpOworfQorCit2b2lkIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV9lamVjdChT
cGljZVVzYkJhY2tlbmQgKmJlLCBTcGljZVVzYkJhY2tlbmREZXZpY2UgKmRldikKK3sKKyAgICBn
X3JldHVybl9pZl9mYWlsKGRldik7CisKKyAgICBpZiAoZGV2LT5lZGV2KSB7CisgICAgICAgIGJl
LT5vd25fZGV2aWNlc19tYXNrICY9IH4oMSA8PCBkZXYtPmRldmljZV9pbmZvLmFkZHJlc3MpOwor
ICAgIH0KKyAgICBpZiAoYmUtPmhvdHBsdWdfY2FsbGJhY2spIHsKKyAgICAgICAgYmUtPmhvdHBs
dWdfY2FsbGJhY2soYmUtPmhvdHBsdWdfdXNlcl9kYXRhLCBkZXYsIEZBTFNFKTsKKyAgICB9Cit9
CisKK2dib29sZWFuCitzcGljZV91c2JfYmFja2VuZF9jcmVhdGVfZW11bGF0ZWRfZGV2aWNlKFNw
aWNlVXNiQmFja2VuZCAqYmUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIFNwaWNlVXNiRW11bGF0ZWREZXZpY2VDcmVhdGUgY3JlYXRlX3Byb2MsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKmNyZWF0ZV9wYXJhbXMsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdFcnJvciAqKmVycikKK3sKKyAg
ICBTcGljZVVzYkVtdWxhdGVkRGV2aWNlICplZGV2OworICAgIFNwaWNlVXNiQmFja2VuZERldmlj
ZSAqZGV2OworICAgIHN0cnVjdCBsaWJ1c2JfZGV2aWNlX2Rlc2NyaXB0b3IgKmRlc2M7CisgICAg
dWludDE2X3QgZGV2aWNlX2Rlc2Nfc2l6ZTsKKyAgICB1aW50OF90IGFkZHJlc3MgPSAwOworCisg
ICAgaWYgKGJlLT5vd25fZGV2aWNlc19tYXNrID09IDB4ZmZmZmZmZmYpIHsKKyAgICAgICAgZ19z
ZXRfZXJyb3IoZXJyLCBTUElDRV9DTElFTlRfRVJST1IsIFNQSUNFX0NMSUVOVF9FUlJPUl9GQUlM
RUQsCisgICAgICAgICAgICAgICAgICAgIF8oImNhbid0IGNyZWF0ZSBkZXZpY2UgLSBsaW1pdCBy
ZWFjaGVkIikpOworICAgICAgICByZXR1cm4gRkFMU0U7CisgICAgfQorICAgIGZvciAoYWRkcmVz
cyA9IDA7IGFkZHJlc3MgPCAzMjsgKythZGRyZXNzKSB7CisgICAgICAgIGlmICh+YmUtPm93bl9k
ZXZpY2VzX21hc2sgJiAoMSA8PCBhZGRyZXNzKSkgeworICAgICAgICAgICAgYnJlYWs7CisgICAg
ICAgIH0KKyAgICB9CisKKyAgICBkZXYgPSBnX25ldzAoU3BpY2VVc2JCYWNrZW5kRGV2aWNlLCAx
KTsKKyAgICBkZXYtPmRldmljZV9pbmZvLmJ1cyA9IEJVU19OVU1CRVJfRk9SX0VNVUxBVEVEX1VT
QjsKKyAgICBkZXYtPmRldmljZV9pbmZvLmFkZHJlc3MgPSBhZGRyZXNzOworICAgIGRldi0+cmVm
X2NvdW50ID0gMTsKKworICAgIGRldi0+ZWRldiA9IGVkZXYgPSBjcmVhdGVfcHJvYyhiZSwgZGV2
LCBjcmVhdGVfcGFyYW1zLCBlcnIpOworICAgIGlmIChlZGV2ID09IE5VTEwpIHsKKyAgICAgICAg
c3BpY2VfdXNiX2JhY2tlbmRfZGV2aWNlX3VucmVmKGRldik7CisgICAgICAgIHJldHVybiBGQUxT
RTsKKyAgICB9CisKKyAgICBpZiAoIWRldmljZV9vcHMoZWRldiktPmdldF9kZXNjcmlwdG9yKGVk
ZXYsIExJQlVTQl9EVF9ERVZJQ0UsIDAsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAodm9pZCAqKikmZGVzYywgJmRldmljZV9kZXNjX3NpemUpCisgICAgICAgIHx8
IGRldmljZV9kZXNjX3NpemUgIT0gc2l6ZW9mKCpkZXNjKSkgeworCisgICAgICAgIHNwaWNlX3Vz
Yl9iYWNrZW5kX2RldmljZV91bnJlZihkZXYpOworICAgICAgICBnX3NldF9lcnJvcihlcnIsIFNQ
SUNFX0NMSUVOVF9FUlJPUiwgU1BJQ0VfQ0xJRU5UX0VSUk9SX0ZBSUxFRCwKKyAgICAgICAgICAg
ICAgICAgICAgXygiY2FuJ3QgY3JlYXRlIGRldmljZSAtIGludGVybmFsIGVycm9yIikpOworICAg
ICAgICByZXR1cm4gRkFMU0U7CisgICAgfQorCisgICAgYmUtPm93bl9kZXZpY2VzX21hc2sgfD0g
MSA8PCBhZGRyZXNzOworCisgICAgZGV2LT5kZXZpY2VfaW5mby52aWQgPSBkZXNjLT5pZFZlbmRv
cjsKKyAgICBkZXYtPmRldmljZV9pbmZvLnBpZCA9IGRlc2MtPmlkUHJvZHVjdDsKKyAgICBkZXYt
PmRldmljZV9pbmZvLmJjZFVTQiA9IGRlc2MtPmJjZFVTQjsKKyAgICBkZXYtPmRldmljZV9pbmZv
LmNsYXNzID0gZGVzYy0+YkRldmljZUNsYXNzOworICAgIGRldi0+ZGV2aWNlX2luZm8uc3ViY2xh
c3MgPSBkZXNjLT5iRGV2aWNlU3ViQ2xhc3M7CisgICAgZGV2LT5kZXZpY2VfaW5mby5wcm90b2Nv
bCA9IGRlc2MtPmJEZXZpY2VQcm90b2NvbDsKKworICAgIGlmIChiZS0+aG90cGx1Z19jYWxsYmFj
aykgeworICAgICAgICBiZS0+aG90cGx1Z19jYWxsYmFjayhiZS0+aG90cGx1Z191c2VyX2RhdGEs
IGRldiwgVFJVRSk7CisgICAgfQorICAgIHNwaWNlX3VzYl9iYWNrZW5kX2RldmljZV91bnJlZihk
ZXYpOworCisgICAgcmV0dXJuIFRSVUU7Cit9CisKICNlbmRpZiAvKiBVU0JfUkVESVIgKi8KZGlm
ZiAtLWdpdCBhL3NyYy91c2ItYmFja2VuZC5oIGIvc3JjL3VzYi1iYWNrZW5kLmgKaW5kZXggNzU1
ODgwNy4uODMzMTlkYyAxMDA2NDQKLS0tIGEvc3JjL3VzYi1iYWNrZW5kLmgKKysrIGIvc3JjL3Vz
Yi1iYWNrZW5kLmgKQEAgLTMwLDEyICszMCwxNSBAQCB0eXBlZGVmIHN0cnVjdCBfU3BpY2VVc2JC
YWNrZW5kIFNwaWNlVXNiQmFja2VuZDsKIHR5cGVkZWYgc3RydWN0IF9TcGljZVVzYkRldmljZSBT
cGljZVVzYkJhY2tlbmREZXZpY2U7CiB0eXBlZGVmIHN0cnVjdCBfU3BpY2VVc2JCYWNrZW5kQ2hh
bm5lbCBTcGljZVVzYkJhY2tlbmRDaGFubmVsOwogCisjZGVmaW5lIEJVU19OVU1CRVJfRk9SX0VN
VUxBVEVEX1VTQiBHX01BWFVJTlQxNgorCiB0eXBlZGVmIHN0cnVjdCBVc2JEZXZpY2VJbmZvcm1h
dGlvbgogewogICAgIHVpbnQxNl90IGJ1czsKICAgICB1aW50MTZfdCBhZGRyZXNzOwogICAgIHVp
bnQxNl90IHZpZDsKICAgICB1aW50MTZfdCBwaWQ7CisgICAgdWludDE2X3QgYmNkVVNCOwogICAg
IHVpbnQ4X3QgY2xhc3M7CiAgICAgdWludDhfdCBzdWJjbGFzczsKICAgICB1aW50OF90IHByb3Rv
Y29sOwpkaWZmIC0tZ2l0IGEvc3JjL3VzYi1lbXVsYXRpb24uaCBiL3NyYy91c2ItZW11bGF0aW9u
LmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMC4uYWMzZDhlMAotLS0gL2Rldi9u
dWxsCisrKyBiL3NyYy91c2ItZW11bGF0aW9uLmgKQEAgLTAsMCArMSw4OCBAQAorLyogLSotIE1v
ZGU6IEM7IGMtYmFzaWMtb2Zmc2V0OiA0OyBpbmRlbnQtdGFicy1tb2RlOiBuaWwgLSotICovCisv
KgorICAgIENvcHlyaWdodCAoQykgMjAxOSBSZWQgSGF0LCBJbmMuCisKKyAgICBSZWQgSGF0IEF1
dGhvcnM6CisgICAgWXVyaSBCZW5kaXRvdmljaDx5YmVuZGl0b0ByZWRoYXQuY29tPgorCisgICAg
VGhpcyBsaWJyYXJ5IGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFu
ZC9vcgorICAgIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2Vu
ZXJhbCBQdWJsaWMKKyAgICBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2Fy
ZSBGb3VuZGF0aW9uOyBlaXRoZXIKKyAgICB2ZXJzaW9uIDIuMSBvZiB0aGUgTGljZW5zZSwgb3Ig
KGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KKworICAgIFRoaXMgbGlicmFyeSBp
cyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAorICAgIGJ1
dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5
IG9mCisgICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQ
T1NFLiAgU2VlIHRoZSBHTlUKKyAgICBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3Ig
bW9yZSBkZXRhaWxzLgorCisgICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0
aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYworICAgIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlz
IGxpYnJhcnk7IGlmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KKyov
CisKKyNwcmFnbWEgb25jZQorCisjaW5jbHVkZSAidXNicmVkaXJwYXJzZXIuaCIKKyNpbmNsdWRl
ICJ1c2ItYmFja2VuZC5oIgorCit0eXBlZGVmIHN0cnVjdCBTcGljZVVzYkVtdWxhdGVkRGV2aWNl
IFNwaWNlVXNiRW11bGF0ZWREZXZpY2U7Cit0eXBlZGVmIFNwaWNlVXNiRW11bGF0ZWREZXZpY2Uq
CisoKlNwaWNlVXNiRW11bGF0ZWREZXZpY2VDcmVhdGUpKFNwaWNlVXNiQmFja2VuZCAqYmUsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwaWNlVXNiQmFja2VuZERldmljZSAqcGFy
ZW50LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICpjcmVhdGVfcGFyYW1z
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHRXJyb3IgKiplcnIpOworCisvKgor
ICAgIGZ1bmN0aW9uIHRhYmxlIGZvciBlbXVsYXRlZCBVU0IgZGV2aWNlCisgICAgbXVzdCBiZSBm
aXJzdCBtZW1iZXIgb2YgZGV2aWNlIHN0cnVjdHVyZQorICAgIGFsbCBmdW5jdGlvbnMgYXJlIG1h
bmRhdG9yeSBmb3IgaW1wbGVtZW50YXRpb24KKyovCit0eXBlZGVmIHN0cnVjdCBVc2JEZXZpY2VP
cHMgeworICAgIGdib29sZWFuICgqZ2V0X2Rlc2NyaXB0b3IpKFNwaWNlVXNiRW11bGF0ZWREZXZp
Y2UgKmRldmljZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50OF90IHR5cGUs
IHVpbnQ4X3QgaW5kZXgsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqKmJ1
ZmZlciwgdWludDE2X3QgKnNpemUpOworICAgIGdjaGFyICogKCpnZXRfcHJvZHVjdF9kZXNjcmlw
dGlvbikoU3BpY2VVc2JFbXVsYXRlZERldmljZSAqZGV2aWNlKTsKKyAgICB2b2lkICgqYXR0YWNo
KShTcGljZVVzYkVtdWxhdGVkRGV2aWNlICpkZXZpY2UsIHN0cnVjdCB1c2JyZWRpcnBhcnNlciAq
cGFyc2VyKTsKKyAgICB2b2lkICgqcmVzZXQpKFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmRldmlj
ZSk7CisgICAgLyoKKyAgICAgICAgcHJvY2Vzc2luZyBpcyBzeW5jaHJvbm91cywgZGVmYXVsdCA9
IHN0YWxsOgorICAgICAgICAtIHJldHVybiBzdWNjZXNzIHdpdGhvdXQgZGF0YTogc2V0IHN0YXR1
cyB0byAwCisgICAgICAgIC0gcmV0dXJuIGVycm9yIC0gc2V0IHN0YXR1cyB0byBlcnJvcgorICAg
ICAgICAtIHJldHVybiBzdWNjZXNzIHdpdGggZGF0YSAtIHNldCBzdGF0dXMgdG8gMCwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldCBidWZmZXIgdG8gc29tZSBidWZmZXIK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldCBsZW5ndGggdG8gb3V0IGxl
bgorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1bmNhdGlvbiBpcyBhdXRv
bWF0aWMKKyAgICAqLworICAgIHZvaWQgKCpjb250cm9sX3JlcXVlc3QpKFNwaWNlVXNiRW11bGF0
ZWREZXZpY2UgKmRldmljZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50OF90ICpk
YXRhLCBpbnQgZGF0YV9sZW4sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHVz
Yl9yZWRpcl9jb250cm9sX3BhY2tldF9oZWFkZXIgKmgsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgdm9pZCAqKmJ1ZmZlcik7CisgICAgLyoKKyAgICAgICAgcHJvY2Vzc2luZyBpcyBzeW5j
aHJvbm91czoKKyAgICAgICAgLSBzZXQgaC0+c3RhdHVzIHRvIHJlc3VsdGluZyBzdGF0dXMsIGRl
ZmF1bHQgPSBzdGFsbAorICAgICovCisgICAgdm9pZCAoKmJ1bGtfb3V0X3JlcXVlc3QpKFNwaWNl
VXNiRW11bGF0ZWREZXZpY2UgKmRldmljZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
dWludDhfdCBlcCwgdWludDhfdCAqZGF0YSwgaW50IGRhdGFfbGVuLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB1aW50OF90ICpzdGF0dXMpOworICAgIC8qCisgICAgICAgIGlmIHJldHVy
bnMgdHJ1ZSwgcHJvY2Vzc2luZyBpcyBhc3luY2hyb25vdXMKKyAgICAgICAgb3RoZXJ3aXNlIGhl
YWRlciBjb250YWlucyBlcnJvciBzdGF0dXMKKyAgICAqLworICAgIGdib29sZWFuICgqYnVsa19p
bl9yZXF1ZXN0KShTcGljZVVzYkVtdWxhdGVkRGV2aWNlICpkZXZpY2UsIHVpbnQ2NF90IGlkLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCB1c2JfcmVkaXJfYnVsa19wYWNrZXRf
aGVhZGVyICpidWxrX2hlYWRlcik7CisgICAgdm9pZCAoKmNhbmNlbF9yZXF1ZXN0KShTcGljZVVz
YkVtdWxhdGVkRGV2aWNlICpkZXZpY2UsIHVpbnQ2NF90IGlkKTsKKyAgICB2b2lkICgqZGV0YWNo
KShTcGljZVVzYkVtdWxhdGVkRGV2aWNlICpkZXZpY2UpOworICAgIHZvaWQgKCp1bnJlYWxpemUp
KFNwaWNlVXNiRW11bGF0ZWREZXZpY2UgKmRldmljZSk7Cit9IFVzYkRldmljZU9wczsKKworc3Rh
dGljIGlubGluZSBjb25zdCBVc2JEZXZpY2VPcHMgKmRldmljZV9vcHMoU3BpY2VVc2JFbXVsYXRl
ZERldmljZSAqZGV2KQoreworICAgIHJldHVybiAoY29uc3QgVXNiRGV2aWNlT3BzICopZGV2Owor
fQorCitnYm9vbGVhbgorc3BpY2VfdXNiX2JhY2tlbmRfY3JlYXRlX2VtdWxhdGVkX2RldmljZShT
cGljZVVzYkJhY2tlbmQgKmJlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBTcGljZVVzYkVtdWxhdGVkRGV2aWNlQ3JlYXRlIGNyZWF0ZV9wcm9jLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICpjcmVhdGVfcGFyYW1zLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHRXJyb3IgKiplcnIpOwordm9p
ZCBzcGljZV91c2JfYmFja2VuZF9kZXZpY2VfZWplY3QoU3BpY2VVc2JCYWNrZW5kICpiZSwgU3Bp
Y2VVc2JCYWNrZW5kRGV2aWNlICpkZXZpY2UpOwordm9pZCBzcGljZV91c2JfYmFja2VuZF9kZXZp
Y2VfcmVwb3J0X2NoYW5nZShTcGljZVVzYkJhY2tlbmQgKmJlLCBTcGljZVVzYkJhY2tlbmREZXZp
Y2UgKmRldmljZSk7Ci0tIAoyLjIxLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9zcGljZS1kZXZlbA==
