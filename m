Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 354445541C
	for <lists+spice-devel@lfdr.de>; Tue, 25 Jun 2019 18:12:04 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C384F6E170;
	Tue, 25 Jun 2019 16:12:02 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E549D6E170
 for <spice-devel@lists.freedesktop.org>; Tue, 25 Jun 2019 16:12:00 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
 [10.5.11.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 8DC712E95B9
 for <spice-devel@lists.freedesktop.org>; Tue, 25 Jun 2019 16:12:00 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.4])
 by smtp.corp.redhat.com (Postfix) with ESMTP id AE6A95D70D;
 Tue, 25 Jun 2019 16:11:59 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Tue, 25 Jun 2019 17:11:32 +0100
Message-Id: <20190625161147.25211-9-fziglio@redhat.com>
In-Reply-To: <20190625161147.25211-1-fziglio@redhat.com>
References: <20190625161147.25211-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.29]); Tue, 25 Jun 2019 16:12:00 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-server 08/23] websocket: New interface
 to create RedsWebSocket
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

TGVzcyBjb3VwbGluZy4gVGhpcyBpcyBhIHByZXBhcmF0aW9uIGZvciBuZXh0IHBhdGNoLgoKU2ln
bmVkLW9mZi1ieTogRnJlZGlhbm8gWmlnbGlvIDxmemlnbGlvQHJlZGhhdC5jb20+Ci0tLQogc2Vy
dmVyL3JlZC1zdHJlYW0uYyB8IDMxICsrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLS0KIHNl
cnZlci93ZWJzb2NrZXQuYyAgfCAyNSArKysrKysrKysrKysrKysrKysrKysrKysrCiBzZXJ2ZXIv
d2Vic29ja2V0LmggIHwgIDggKysrKystLS0KIDMgZmlsZXMgY2hhbmdlZCwgNDEgaW5zZXJ0aW9u
cygrKSwgMjMgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvc2VydmVyL3JlZC1zdHJlYW0uYyBi
L3NlcnZlci9yZWQtc3RyZWFtLmMKaW5kZXggZDZhMDBkZDlmLi5mZDNmZGNlZDggMTAwNjQ0Ci0t
LSBhL3NlcnZlci9yZWQtc3RyZWFtLmMKKysrIGIvc2VydmVyL3JlZC1zdHJlYW0uYwpAQCAtMTIx
NSwyOCArMTIxNSwxOSBAQCBib29sIHJlZF9zdHJlYW1faXNfd2Vic29ja2V0KFJlZFN0cmVhbSAq
c3RyZWFtLCBjb25zdCB2b2lkICpidWYsIHNpemVfdCBsZW4pCiAgICAgICAgICAgICAgIHNvIGl0
IHNlZW1zIHdpc2VzdCB0byBsaXZlIHdpdGggdGhpcyB0aGVvcmV0aWNhbCBmbGF3LgogICAgICov
CiAKLSAgICBpZiAod2Vic29ja2V0X2lzX3N0YXJ0KHJidWYpKSB7Ci0gICAgICAgIGNoYXIgb3V0
YnVmWzEwMjRdOwotCi0gICAgICAgIHdlYnNvY2tldF9jcmVhdGVfcmVwbHkocmJ1Ziwgb3V0YnVm
KTsKLSAgICAgICAgcmMgPSBzdHJlYW0tPnByaXYtPndyaXRlKHN0cmVhbSwgb3V0YnVmLCBzdHJs
ZW4ob3V0YnVmKSk7Ci0gICAgICAgIGlmIChyYyA9PSBzdHJsZW4ob3V0YnVmKSkgewotICAgICAg
ICAgICAgc3RyZWFtLT5wcml2LT53cyA9IGdfbWFsbG9jMChzaXplb2YoKnN0cmVhbS0+cHJpdi0+
d3MpKTsKLQotICAgICAgICAgICAgc3RyZWFtLT5wcml2LT53cy0+cmF3X3N0cmVhbSA9IHN0cmVh
bTsKLSAgICAgICAgICAgIHN0cmVhbS0+cHJpdi0+d3MtPnJhd19yZWFkID0gc3RyZWFtLT5wcml2
LT5yZWFkOwotICAgICAgICAgICAgc3RyZWFtLT5wcml2LT53cy0+cmF3X3dyaXRlID0gc3RyZWFt
LT5wcml2LT53cml0ZTsKLQotICAgICAgICAgICAgc3RyZWFtLT5wcml2LT5yZWFkID0gc3RyZWFt
X3dlYnNvY2tldF9yZWFkOwotICAgICAgICAgICAgc3RyZWFtLT5wcml2LT53cml0ZSA9IHN0cmVh
bV93ZWJzb2NrZXRfd3JpdGU7Ci0KLSAgICAgICAgICAgIGlmIChzdHJlYW0tPnByaXYtPndyaXRl
dikgewotICAgICAgICAgICAgICAgIHN0cmVhbS0+cHJpdi0+d3MtPnJhd193cml0ZXYgPSBzdHJl
YW0tPnByaXYtPndyaXRldjsKLSAgICAgICAgICAgICAgICBzdHJlYW0tPnByaXYtPndyaXRldiA9
IHN0cmVhbV93ZWJzb2NrZXRfd3JpdGV2OwotICAgICAgICAgICAgfQorICAgIHN0cmVhbS0+cHJp
di0+d3MgPSB3ZWJzb2NrZXRfbmV3KHJidWYsIHN0cmVhbSwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAod2Vic29ja2V0X3JlYWRfY2JfdCkgc3RyZWFtLT5wcml2LT5yZWFk
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh3ZWJzb2NrZXRfd3JpdGVf
Y2JfdCkgc3RyZWFtLT5wcml2LT53cml0ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAod2Vic29ja2V0X3dyaXRldl9jYl90KSBzdHJlYW0tPnByaXYtPndyaXRldik7Cisg
ICAgaWYgKHN0cmVhbS0+cHJpdi0+d3MpIHsKKyAgICAgICAgc3RyZWFtLT5wcml2LT5yZWFkID0g
c3RyZWFtX3dlYnNvY2tldF9yZWFkOworICAgICAgICBzdHJlYW0tPnByaXYtPndyaXRlID0gc3Ry
ZWFtX3dlYnNvY2tldF93cml0ZTsKIAotICAgICAgICAgICAgcmV0dXJuIHRydWU7CisgICAgICAg
IGlmIChzdHJlYW0tPnByaXYtPndyaXRldikgeworICAgICAgICAgICAgc3RyZWFtLT5wcml2LT53
cml0ZXYgPSBzdHJlYW1fd2Vic29ja2V0X3dyaXRldjsKICAgICAgICAgfQorCisgICAgICAgIHJl
dHVybiB0cnVlOwogICAgIH0KIAogICAgIHJldHVybiBmYWxzZTsKZGlmZiAtLWdpdCBhL3NlcnZl
ci93ZWJzb2NrZXQuYyBiL3NlcnZlci93ZWJzb2NrZXQuYwppbmRleCAxYjE4YWE2MTQuLjAzZDkz
MTAyMyAxMDA2NDQKLS0tIGEvc2VydmVyL3dlYnNvY2tldC5jCisrKyBiL3NlcnZlci93ZWJzb2Nr
ZXQuYwpAQCAtNDc4LDMgKzQ3OCwyOCBAQCB2b2lkIHdlYnNvY2tldF9jcmVhdGVfcmVwbHkoY2hh
ciAqYnVmLCBjaGFyICpvdXRidWYpCiAgICAgICAgICAgICAgICAgICAgICJTZWMtV2ViU29ja2V0
LVByb3RvY29sOiBiaW5hcnlcclxuXHJcbiIsIGtleSk7CiAgICAgZ19mcmVlKGtleSk7CiB9CisK
K1JlZHNXZWJTb2NrZXQgKndlYnNvY2tldF9uZXcoY2hhciAqcmJ1Ziwgc3RydWN0IFJlZFN0cmVh
bSAqc3RyZWFtLCB3ZWJzb2NrZXRfcmVhZF9jYl90IHJlYWRfY2IsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHdlYnNvY2tldF93cml0ZV9jYl90IHdyaXRlX2NiLCB3ZWJzb2NrZXRfd3Jp
dGV2X2NiX3Qgd3JpdGV2X2NiKQoreworICAgIGlmICghd2Vic29ja2V0X2lzX3N0YXJ0KHJidWYp
KSB7CisgICAgICAgIHJldHVybiBOVUxMOworICAgIH0KKworICAgIGNoYXIgb3V0YnVmWzEwMjRd
OworCisgICAgd2Vic29ja2V0X2NyZWF0ZV9yZXBseShyYnVmLCBvdXRidWYpOworICAgIGludCBy
YyA9IHdyaXRlX2NiKHN0cmVhbSwgb3V0YnVmLCBzdHJsZW4ob3V0YnVmKSk7CisgICAgaWYgKHJj
ICE9IHN0cmxlbihvdXRidWYpKSB7CisgICAgICAgIHJldHVybiBOVUxMOworICAgIH0KKworICAg
IFJlZHNXZWJTb2NrZXQgKndzID0gZ19uZXcwKFJlZHNXZWJTb2NrZXQsIDEpOworCisgICAgd3Mt
PnJhd19zdHJlYW0gPSBzdHJlYW07CisgICAgd3MtPnJhd19yZWFkID0gcmVhZF9jYjsKKyAgICB3
cy0+cmF3X3dyaXRlID0gd3JpdGVfY2I7CisgICAgd3MtPnJhd193cml0ZXYgPSB3cml0ZXZfY2I7
CisKKyAgICByZXR1cm4gd3M7Cit9CmRpZmYgLS1naXQgYS9zZXJ2ZXIvd2Vic29ja2V0LmggYi9z
ZXJ2ZXIvd2Vic29ja2V0LmgKaW5kZXggMTczMTA5MDUwLi5hYjllYjgxMjYgMTAwNjQ0Ci0tLSBh
L3NlcnZlci93ZWJzb2NrZXQuaAorKysgYi9zZXJ2ZXIvd2Vic29ja2V0LmgKQEAgLTQxLDExICs0
MSwxMyBAQCB0eXBlZGVmIHN0cnVjdCB7CiAgICAgdWludDY0X3Qgd3JpdGVfcmVtYWluZGVyOwog
CiAgICAgc3RydWN0IFJlZFN0cmVhbSAqcmF3X3N0cmVhbTsKLSAgICBzc2l6ZV90ICgqcmF3X3Jl
YWQpKHN0cnVjdCBSZWRTdHJlYW0gKnMsIHZvaWQgKmJ1Ziwgc2l6ZV90IG5ieXRlKTsKLSAgICBz
c2l6ZV90ICgqcmF3X3dyaXRlKShzdHJ1Y3QgUmVkU3RyZWFtICpzLCBjb25zdCB2b2lkICpidWYs
IHNpemVfdCBuYnl0ZSk7Ci0gICAgc3NpemVfdCAoKnJhd193cml0ZXYpKHN0cnVjdCBSZWRTdHJl
YW0gKnMsIGNvbnN0IHN0cnVjdCBpb3ZlYyAqaW92LCBpbnQgaW92Y250KTsKKyAgICB3ZWJzb2Nr
ZXRfcmVhZF9jYl90IHJhd19yZWFkOworICAgIHdlYnNvY2tldF93cml0ZV9jYl90IHJhd193cml0
ZTsKKyAgICB3ZWJzb2NrZXRfd3JpdGV2X2NiX3QgcmF3X3dyaXRldjsKIH0gUmVkc1dlYlNvY2tl
dDsKIAorUmVkc1dlYlNvY2tldCAqd2Vic29ja2V0X25ldyhjaGFyICpidWYsIHN0cnVjdCBSZWRT
dHJlYW0gKnMsIHdlYnNvY2tldF9yZWFkX2NiX3QgcmVhZF9jYiwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgd2Vic29ja2V0X3dyaXRlX2NiX3Qgd3JpdGVfY2IsIHdlYnNvY2tldF93cml0
ZXZfY2JfdCB3cml0ZXZfY2IpOwogYm9vbCB3ZWJzb2NrZXRfaXNfc3RhcnQoY2hhciAqYnVmKTsK
IHZvaWQgd2Vic29ja2V0X2NyZWF0ZV9yZXBseShjaGFyICpidWYsIGNoYXIgKm91dGJ1Zik7CiBp
bnQgd2Vic29ja2V0X3JlYWQoUmVkc1dlYlNvY2tldCAqd3MsIHVpbnQ4X3QgKmJ1Ziwgc2l6ZV90
IGxlbik7Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9zcGljZS1kZXZlbA==
