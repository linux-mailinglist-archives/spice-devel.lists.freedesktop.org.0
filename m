Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C1DBE324A6
	for <lists+spice-devel@lfdr.de>; Sun,  2 Jun 2019 21:32:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7BBDD89286;
	Sun,  2 Jun 2019 19:32:34 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5D6C58925D
 for <spice-devel@lists.freedesktop.org>; Sun,  2 Jun 2019 19:32:33 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx08.intmail.prod.int.phx2.redhat.com
 [10.5.11.23])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 0AEB0821DE
 for <spice-devel@lists.freedesktop.org>; Sun,  2 Jun 2019 19:32:33 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.3])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 2AD9D52C8;
 Sun,  2 Jun 2019 19:32:31 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Sun,  2 Jun 2019 20:32:26 +0100
Message-Id: <20190602193226.19766-2-fziglio@redhat.com>
In-Reply-To: <20190602193226.19766-1-fziglio@redhat.com>
References: <20190602193226.19766-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.23
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.28]); Sun, 02 Jun 2019 19:32:33 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-server v2 2/2] smartcard: Use
 RedChannelClient as the type for RedCharDevice client
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

QXMgbm93IGlzIGFuIG9wYXF1ZSB0eXBlIGZvciBSZWRDaGFyRGV2aWNlIHVzZSB0aGUgdHlwZSB0
aGF0CmJldHRlciBzdWl0cyB1cy4KVGhpcyBhdm9pZCB1c2VsZXNzIGNvbnZlcnNpb25zIG9yIGxv
b2sgdXBzLgoKU2lnbmVkLW9mZi1ieTogRnJlZGlhbm8gWmlnbGlvIDxmemlnbGlvQHJlZGhhdC5j
b20+Ci0tLQogc2VydmVyL3NtYXJ0Y2FyZC1jaGFubmVsLWNsaWVudC5jIHwgIDUgKysrLS0KIHNl
cnZlci9zbWFydGNhcmQuYyAgICAgICAgICAgICAgICB8IDE2ICsrKysrKysrLS0tLS0tLS0KIDIg
ZmlsZXMgY2hhbmdlZCwgMTEgaW5zZXJ0aW9ucygrKSwgMTAgZGVsZXRpb25zKC0pCgpkaWZmIC0t
Z2l0IGEvc2VydmVyL3NtYXJ0Y2FyZC1jaGFubmVsLWNsaWVudC5jIGIvc2VydmVyL3NtYXJ0Y2Fy
ZC1jaGFubmVsLWNsaWVudC5jCmluZGV4IGUyMmIzOWFkZi4uM2QxYjQ0NmUzIDEwMDY0NAotLS0g
YS9zZXJ2ZXIvc21hcnRjYXJkLWNoYW5uZWwtY2xpZW50LmMKKysrIGIvc2VydmVyL3NtYXJ0Y2Fy
ZC1jaGFubmVsLWNsaWVudC5jCkBAIC0xNiw2ICsxNiw4IEBACiAqLwogI2luY2x1ZGUgPGNvbmZp
Zy5oPgogCisjZGVmaW5lIFJlZENoYXJEZXZpY2VDbGllbnRPcGFxdWUgUmVkQ2hhbm5lbENsaWVu
dAorCiAjaW5jbHVkZSAic21hcnRjYXJkLWNoYW5uZWwtY2xpZW50LmgiCiAKIHN0cnVjdCBTbWFy
dENhcmRDaGFubmVsQ2xpZW50UHJpdmF0ZQpAQCAtMTIxLDcgKzEyMyw2IEBAIHNtYXJ0Y2FyZF9j
aGFubmVsX2NsaWVudF9hbGxvY19tc2dfcmN2X2J1ZihSZWRDaGFubmVsQ2xpZW50ICpyY2MsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDE2X3QgdHlwZSwg
dWludDMyX3Qgc2l6ZSkKIHsKICAgICBTbWFydENhcmRDaGFubmVsQ2xpZW50ICpzY2MgPSBTTUFS
VENBUkRfQ0hBTk5FTF9DTElFTlQocmNjKTsKLSAgICBSZWRDbGllbnQgKmNsaWVudCA9IHJlZF9j
aGFubmVsX2NsaWVudF9nZXRfY2xpZW50KHJjYyk7CiAKICAgICAvKiB0b2RvOiBvbmx5IG9uZSBy
ZWFkZXIgaXMgYWN0dWFsbHkgc3VwcG9ydGVkLiBXaGVuIHdlIGZpeCB0aGUgY29kZSB0byBzdXBw
b3J0CiAgICAgICogbXVsdGlwbGUgcmVhZGVycywgd2Ugd2lsbCBwb3JiYWJseSBhc3NvY2lhdGUg
ZGlmZmVyZW50IGRldmljZXMgdG8KQEAgLTEzNyw3ICsxMzgsNyBAQCBzbWFydGNhcmRfY2hhbm5l
bF9jbGllbnRfYWxsb2NfbXNnX3Jjdl9idWYoUmVkQ2hhbm5lbENsaWVudCAqcmNjLAogICAgICAg
ICBzcGljZV9hc3NlcnQoc21hcnRjYXJkX2NoYXJfZGV2aWNlX2dldF9jbGllbnQoc21hcnRjYXJk
KSB8fCBzY2MtPnByaXYtPnNtYXJ0Y2FyZCk7CiAgICAgICAgIHNwaWNlX2Fzc2VydCghc2NjLT5w
cml2LT53cml0ZV9idWYpOwogICAgICAgICBzY2MtPnByaXYtPndyaXRlX2J1ZiA9Ci0gICAgICAg
ICAgICByZWRfY2hhcl9kZXZpY2Vfd3JpdGVfYnVmZmVyX2dldF9jbGllbnQoUkVEX0NIQVJfREVW
SUNFKHNtYXJ0Y2FyZCksIGNsaWVudCwgc2l6ZSk7CisgICAgICAgICAgICByZWRfY2hhcl9kZXZp
Y2Vfd3JpdGVfYnVmZmVyX2dldF9jbGllbnQoUkVEX0NIQVJfREVWSUNFKHNtYXJ0Y2FyZCksIHJj
Yywgc2l6ZSk7CiAKICAgICAgICAgaWYgKCFzY2MtPnByaXYtPndyaXRlX2J1ZikgewogICAgICAg
ICAgICAgc3BpY2VfZXJyb3IoImZhaWxlZCB0byBhbGxvY2F0ZSB3cml0ZSBidWZmZXIiKTsKZGlm
ZiAtLWdpdCBhL3NlcnZlci9zbWFydGNhcmQuYyBiL3NlcnZlci9zbWFydGNhcmQuYwppbmRleCBl
NmQzYjZhY2UuLjE3Nzk0YjA2ZiAxMDA2NDQKLS0tIGEvc2VydmVyL3NtYXJ0Y2FyZC5jCisrKyBi
L3NlcnZlci9zbWFydGNhcmQuYwpAQCAtMjIsNiArMjIsOCBAQAogI2luY2x1ZGUgPGxpYmNhY2Fy
ZC5oPgogI2VuZGlmCiAKKyNkZWZpbmUgUmVkQ2hhckRldmljZUNsaWVudE9wYXF1ZSBSZWRDaGFu
bmVsQ2xpZW50CisKICNpbmNsdWRlICJyZWRzLmgiCiAjaW5jbHVkZSAiY2hhci1kZXZpY2UuaCIK
ICNpbmNsdWRlICJzbWFydGNhcmQuaCIKQEAgLTE2NCwyNCArMTY2LDIyIEBAIHN0YXRpYyBSZWRQ
aXBlSXRlbSAqc21hcnRjYXJkX3JlYWRfbXNnX2Zyb21fZGV2aWNlKFJlZENoYXJEZXZpY2UgKnNl
bGYsCiAgKiBzbyBubyBtdXRleCBpcyByZXF1aXJlZC4gKi8KIHN0YXRpYyB2b2lkIHNtYXJ0Y2Fy
ZF9zZW5kX21zZ190b19jbGllbnQoUmVkQ2hhckRldmljZSAqc2VsZiwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVkUGlwZUl0ZW0gKm1zZywKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVkQ2xpZW50ICpjbGllbnQpCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlZENoYW5uZWxDbGllbnQgKmNsaWVu
dCkKIHsKICAgICBSZWRDaGFyRGV2aWNlU21hcnRjYXJkICpkZXYgPSBSRURfQ0hBUl9ERVZJQ0Vf
U01BUlRDQVJEKHNlbGYpOwogICAgIFJlZENoYW5uZWxDbGllbnQgKnJjYyA9IFJFRF9DSEFOTkVM
X0NMSUVOVChkZXYtPnByaXYtPnNjYyk7CiAKLSAgICBzcGljZV9hc3NlcnQoZGV2LT5wcml2LT5z
Y2MgJiYKLSAgICAgICAgICAgICAgICAgcmVkX2NoYW5uZWxfY2xpZW50X2dldF9jbGllbnQocmNj
KSA9PSBjbGllbnQpOworICAgIHNwaWNlX2Fzc2VydChkZXYtPnByaXYtPnNjYyAmJiByY2MgPT0g
Y2xpZW50KTsKICAgICByZWRfcGlwZV9pdGVtX3JlZihtc2cpOwogICAgIHJlZF9jaGFubmVsX2Ns
aWVudF9waXBlX2FkZF9wdXNoKHJjYywgbXNnKTsKIH0KIAotc3RhdGljIHZvaWQgc21hcnRjYXJk
X3JlbW92ZV9jbGllbnQoUmVkQ2hhckRldmljZSAqc2VsZiwgUmVkQ2xpZW50ICpjbGllbnQpCitz
dGF0aWMgdm9pZCBzbWFydGNhcmRfcmVtb3ZlX2NsaWVudChSZWRDaGFyRGV2aWNlICpzZWxmLCBS
ZWRDaGFubmVsQ2xpZW50ICpjbGllbnQpCiB7CiAgICAgUmVkQ2hhckRldmljZVNtYXJ0Y2FyZCAq
ZGV2ID0gUkVEX0NIQVJfREVWSUNFX1NNQVJUQ0FSRChzZWxmKTsKICAgICBSZWRDaGFubmVsQ2xp
ZW50ICpyY2MgPSBSRURfQ0hBTk5FTF9DTElFTlQoZGV2LT5wcml2LT5zY2MpOwogCi0gICAgc3Bp
Y2VfYXNzZXJ0KGRldi0+cHJpdi0+c2NjICYmCi0gICAgICAgICAgICAgICAgIHJlZF9jaGFubmVs
X2NsaWVudF9nZXRfY2xpZW50KHJjYykgPT0gY2xpZW50KTsKKyAgICBzcGljZV9hc3NlcnQoZGV2
LT5wcml2LT5zY2MgJiYgcmNjID09IGNsaWVudCk7CiAgICAgcmVkX2NoYW5uZWxfY2xpZW50X3No
dXRkb3duKHJjYyk7CiB9CiAKQEAgLTMwNSw3ICszMDUsNyBAQCB2b2lkIHNtYXJ0Y2FyZF9jaGFy
X2RldmljZV9hdHRhY2hfY2xpZW50KFNwaWNlQ2hhckRldmljZUluc3RhbmNlICpjaGFyX2Rldmlj
ZSwKICAgICBkZXYtPnByaXYtPnNjYyA9IHNjYzsKICAgICBzbWFydGNhcmRfY2hhbm5lbF9jbGll
bnRfc2V0X2NoYXJfZGV2aWNlKHNjYywgZGV2KTsKICAgICBjbGllbnRfYWRkZWQgPSByZWRfY2hh
cl9kZXZpY2VfY2xpZW50X2FkZChSRURfQ0hBUl9ERVZJQ0UoZGV2KSwKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWRfY2hhbm5lbF9jbGllbnRfZ2V0X2Ns
aWVudChSRURfQ0hBTk5FTF9DTElFTlQoc2NjKSksCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgUkVEX0NIQU5ORUxfQ0xJRU5UKHNjYyksCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRkFMU0UsIC8qIG5vIGZsb3cgY29u
dHJvbCB5ZXQgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAwLCAvKiBzZW5kIHF1ZXVlIHNpemUgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB+MCwKQEAgLTM2Miw3ICszNjIsNyBAQCB2b2lkIHNtYXJ0Y2FyZF9j
aGFyX2RldmljZV9kZXRhY2hfY2xpZW50KFJlZENoYXJEZXZpY2VTbWFydGNhcmQgKnNtYXJ0Y2Fy
ZCwKIAogICAgIHNwaWNlX2Fzc2VydChzbWFydGNhcmQtPnByaXYtPnNjYyA9PSBzY2MpOwogICAg
IHJlZF9jaGFyX2RldmljZV9jbGllbnRfcmVtb3ZlKFJFRF9DSEFSX0RFVklDRShzbWFydGNhcmQp
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZF9jaGFubmVsX2NsaWVudF9n
ZXRfY2xpZW50KFJFRF9DSEFOTkVMX0NMSUVOVChzY2MpKSk7CisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgUkVEX0NIQU5ORUxfQ0xJRU5UKHNjYykpOwogICAgIHNtYXJ0Y2FyZF9j
aGFubmVsX2NsaWVudF9zZXRfY2hhcl9kZXZpY2Uoc2NjLCBOVUxMKTsKICAgICBzbWFydGNhcmQt
PnByaXYtPnNjYyA9IE5VTEw7CiAKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KU3BpY2UtZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRl
dmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9t
YWlsbWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
