Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2D84D10B14
	for <lists+spice-devel@lfdr.de>; Wed,  1 May 2019 18:17:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 68D99891A0;
	Wed,  1 May 2019 16:17:21 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail.codeweavers.com (mail.codeweavers.com [50.203.203.244])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 47D85891FB
 for <spice-devel@lists.freedesktop.org>; Wed,  1 May 2019 16:17:20 +0000 (UTC)
Received: from jwhite.mn.codeweavers.com ([10.69.137.101])
 by mail.codeweavers.com with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_GCM_SHA256:128)
 (Exim 4.89) (envelope-from <jwhite@codeweavers.com>)
 id 1hLrvv-0001bS-Hc
 for spice-devel@lists.freedesktop.org; Wed, 01 May 2019 11:18:11 -0500
From: Jeremy White <jwhite@codeweavers.com>
To: spice-devel@lists.freedesktop.org
Date: Wed,  1 May 2019 11:17:14 -0500
Message-Id: <20190501161716.15538-2-jwhite@codeweavers.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20190501161716.15538-1-jwhite@codeweavers.com>
References: <20190501161716.15538-1-jwhite@codeweavers.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; 
 d=codeweavers.com; s=6377696661; h=Content-Transfer-Encoding:Content-Type:
 MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:To:From:Sender:
 Reply-To:Cc:Content-ID:Content-Description:Resent-Date:Resent-From:
 Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:
 List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=Y0IJR/+PONbUDFXUQQVSkakhqnjul0gNlEJPkYnu6yI=; b=SHSAGQZP/1p+GbaEhR1sd6YOOy
 /O1tYsqD/Zjajsxxu2oCZ3eNW9f8eDtK7cwUiBsft3q/1rP2BHLbBSHh4NrafI18EHel23XvYOt+L
 pVyOxLPc5u2pkKYXzGPazj2kTnk2/NYWwYqEJsi1moE82wvEywgCPzTdFnAesHsn6keU=;
Subject: [Spice-devel] [PATCH v2 x11spice 2/4] Apply Spice style to the
 spice-video-dummy
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

U2lnbmVkLW9mZi1ieTogSmVyZW15IFdoaXRlIDxqd2hpdGVAY29kZXdlYXZlcnMuY29tPgotLS0K
IHNwaWNlLXZpZGVvLWR1bW15L3NyYy9kdW1teS5oICAgICAgICB8ICAgOSArLQogc3BpY2Utdmlk
ZW8tZHVtbXkvc3JjL2R1bW15X2N1cnNvci5jIHwgIDQyICstLQogc3BpY2UtdmlkZW8tZHVtbXkv
c3JjL2R1bW15X2RyaXZlci5jIHwgNTU4ICsrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0t
LS0tCiAzIGZpbGVzIGNoYW5nZWQsIDI4MSBpbnNlcnRpb25zKCspLCAzMjggZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEvc3BpY2UtdmlkZW8tZHVtbXkvc3JjL2R1bW15LmggYi9zcGljZS12aWRl
by1kdW1teS9zcmMvZHVtbXkuaAppbmRleCA4ZTdjNDNiLi4wYzE2NTkxIDEwMDY0NAotLS0gYS9z
cGljZS12aWRlby1kdW1teS9zcmMvZHVtbXkuaAorKysgYi9zcGljZS12aWRlby1kdW1teS9zcmMv
ZHVtbXkuaApAQCAtMjksMTUgKzI5LDEzIEBAIGV4dGVybiB2b2lkIERVTU1ZU2hvd0N1cnNvcihT
Y3JuSW5mb1B0ciBwU2Nybik7CiBleHRlcm4gdm9pZCBEVU1NWUhpZGVDdXJzb3IoU2NybkluZm9Q
dHIgcFNjcm4pOwogCiAvKiBnbG9iYWxzICovCi10eXBlZGVmIHN0cnVjdCBfY29sb3IKLXsKK3R5
cGVkZWYgc3RydWN0IF9jb2xvciB7CiAgICAgaW50IHJlZDsKICAgICBpbnQgZ3JlZW47CiAgICAg
aW50IGJsdWU7CiB9IGR1bW15X2NvbG9yczsKIAotdHlwZWRlZiBzdHJ1Y3QgZHVtbXlSZWMgCi17
Cit0eXBlZGVmIHN0cnVjdCBkdW1teVJlYyB7CiAgICAgLyogb3B0aW9ucyAqLwogICAgIE9wdGlv
bkluZm9QdHIgT3B0aW9uczsKICAgICBCb29sIHN3Q3Vyc29yOwpAQCAtNTAsMTAgKzQ4LDkgQEAg
dHlwZWRlZiBzdHJ1Y3QgZHVtbXlSZWMKICAgICBpbnQgY3Vyc29yRkcsIGN1cnNvckJHOwogCiAg
ICAgZHVtbXlfY29sb3JzIGNvbG9yc1sxMDI0XTsKLSAgICBCb29sICAgICAgICAoKkNyZWF0ZVdp
bmRvdykoKSA7ICAgICAvKiB3cmFwcGVkIENyZWF0ZVdpbmRvdyAqLworICAgICBCb29sKCpDcmVh
dGVXaW5kb3cpICgpOyAgICAvKiB3cmFwcGVkIENyZWF0ZVdpbmRvdyAqLwogICAgIEJvb2wgcHJv
cDsKIH0gRFVNTVlSZWMsICpEVU1NWVB0cjsKIAogLyogVGhlIHByaXZhdGVzIG9mIHRoZSBEVU1N
WSBkcml2ZXIgKi8KICNkZWZpbmUgRFVNTVlQVFIocCkJKChEVU1NWVB0cikoKHApLT5kcml2ZXJQ
cml2YXRlKSkKLQpkaWZmIC0tZ2l0IGEvc3BpY2UtdmlkZW8tZHVtbXkvc3JjL2R1bW15X2N1cnNv
ci5jIGIvc3BpY2UtdmlkZW8tZHVtbXkvc3JjL2R1bW15X2N1cnNvci5jCmluZGV4IGQ3YzY3YzYu
LmNjY2U0NDIgMTAwNjQ0Ci0tLSBhL3NwaWNlLXZpZGVvLWR1bW15L3NyYy9kdW1teV9jdXJzb3Iu
YworKysgYi9zcGljZS12aWRlby1kdW1teS9zcmMvZHVtbXlfY3Vyc29yLmMKQEAgLTExLDIyICsx
MSwyMCBAQAogLyogRHJpdmVyIHNwZWNpZmljIGhlYWRlcnMgKi8KICNpbmNsdWRlICJkdW1teS5o
IgogCi1zdGF0aWMgdm9pZAotZHVtbXlTaG93Q3Vyc29yKFNjcm5JbmZvUHRyIHBTY3JuKQorc3Rh
dGljIHZvaWQgZHVtbXlTaG93Q3Vyc29yKFNjcm5JbmZvUHRyIHBTY3JuKQogewogICAgIERVTU1Z
UHRyIGRQdHIgPSBEVU1NWVBUUihwU2Nybik7CiAKICAgICAvKiB0dXJuIGN1cnNvciBvbiAqLwot
ICAgIGRQdHItPkR1bW15SFdDdXJzb3JTaG93biA9IFRSVUU7ICAgIAorICAgIGRQdHItPkR1bW15
SFdDdXJzb3JTaG93biA9IFRSVUU7CiB9CiAKLXN0YXRpYyB2b2lkCi1kdW1teUhpZGVDdXJzb3Io
U2NybkluZm9QdHIgcFNjcm4pCitzdGF0aWMgdm9pZCBkdW1teUhpZGVDdXJzb3IoU2NybkluZm9Q
dHIgcFNjcm4pCiB7CiAgICAgRFVNTVlQdHIgZFB0ciA9IERVTU1ZUFRSKHBTY3JuKTsKIAogICAg
IC8qCi0gICAgICogdHVybiBjdXJzb3Igb2ZmIAorICAgICAqIHR1cm4gY3Vyc29yIG9mZgogICAg
ICAqCiAgICAgICovCiAgICAgZFB0ci0+RHVtbXlIV0N1cnNvclNob3duID0gRkFMU0U7CkBAIC0z
NCw4ICszMiw3IEBAIGR1bW15SGlkZUN1cnNvcihTY3JuSW5mb1B0ciBwU2NybikKIAogI2RlZmlu
ZSBNQVhfQ1VSUyA2NAogCi1zdGF0aWMgdm9pZAotZHVtbXlTZXRDdXJzb3JQb3NpdGlvbihTY3Ju
SW5mb1B0ciBwU2NybiwgaW50IHgsIGludCB5KQorc3RhdGljIHZvaWQgZHVtbXlTZXRDdXJzb3JQ
b3NpdGlvbihTY3JuSW5mb1B0ciBwU2NybiwgaW50IHgsIGludCB5KQogewogICAgIERVTU1ZUHRy
IGRQdHIgPSBEVU1NWVBUUihwU2Nybik7CiAKQEAgLTQzLDQzICs0MCwzOSBAQCBkdW1teVNldEN1
cnNvclBvc2l0aW9uKFNjcm5JbmZvUHRyIHBTY3JuLCBpbnQgeCwgaW50IHkpCiAgICAgZFB0ci0+
Y3Vyc29yWSA9IHk7CiB9CiAKLXN0YXRpYyB2b2lkCi1kdW1teVNldEN1cnNvckNvbG9ycyhTY3Ju
SW5mb1B0ciBwU2NybiwgaW50IGJnLCBpbnQgZmcpCitzdGF0aWMgdm9pZCBkdW1teVNldEN1cnNv
ckNvbG9ycyhTY3JuSW5mb1B0ciBwU2NybiwgaW50IGJnLCBpbnQgZmcpCiB7CiAgICAgRFVNTVlQ
dHIgZFB0ciA9IERVTU1ZUFRSKHBTY3JuKTsKLSAgICAKKwogICAgIGRQdHItPmN1cnNvckZHID0g
Zmc7CiAgICAgZFB0ci0+Y3Vyc29yQkcgPSBiZzsKIH0KIAotc3RhdGljIHZvaWQKLWR1bW15TG9h
ZEN1cnNvckltYWdlKFNjcm5JbmZvUHRyIHBTY3JuLCB1bnNpZ25lZCBjaGFyICpzcmMpCitzdGF0
aWMgdm9pZCBkdW1teUxvYWRDdXJzb3JJbWFnZShTY3JuSW5mb1B0ciBwU2NybiwgdW5zaWduZWQg
Y2hhciAqc3JjKQogewogfQogCi1zdGF0aWMgQm9vbAotZHVtbXlVc2VIV0N1cnNvcihTY3JlZW5Q
dHIgcFNjciwgQ3Vyc29yUHRyIHBDdXJzKQorc3RhdGljIEJvb2wgZHVtbXlVc2VIV0N1cnNvcihT
Y3JlZW5QdHIgcFNjciwgQ3Vyc29yUHRyIHBDdXJzKQogewogICAgIERVTU1ZUHRyIGRQdHIgPSBE
VU1NWVBUUih4Zjg2U2NyZWVuVG9TY3JuKHBTY3IpKTsKLSAgICByZXR1cm4oIWRQdHItPnN3Q3Vy
c29yKTsKKyAgICByZXR1cm4gKCFkUHRyLT5zd0N1cnNvcik7CiB9CiAKICNpZiAwCi1zdGF0aWMg
dW5zaWduZWQgY2hhcioKLWR1bW15UmVhbGl6ZUN1cnNvcih4Zjg2Q3Vyc29ySW5mb1B0ciBpbmZv
UHRyLCBDdXJzb3JQdHIgcEN1cnMpCitzdGF0aWMgdW5zaWduZWQgY2hhciAqZHVtbXlSZWFsaXpl
Q3Vyc29yKHhmODZDdXJzb3JJbmZvUHRyIGluZm9QdHIsIEN1cnNvclB0ciBwQ3VycykKIHsKICAg
ICByZXR1cm4gTlVMTDsKIH0KICNlbmRpZgogCi1Cb29sCi1EVU1NWUN1cnNvckluaXQoU2NyZWVu
UHRyIHBTY3JlZW4pCitCb29sIERVTU1ZQ3Vyc29ySW5pdChTY3JlZW5QdHIgcFNjcmVlbikKIHsK
ICAgICBEVU1NWVB0ciBkUHRyID0gRFVNTVlQVFIoeGY4NlNjcmVlblRvU2NybihwU2NyZWVuKSk7
CiAKICAgICB4Zjg2Q3Vyc29ySW5mb1B0ciBpbmZvUHRyOwogICAgIGluZm9QdHIgPSB4Zjg2Q3Jl
YXRlQ3Vyc29ySW5mb1JlYygpOwotICAgIGlmKCFpbmZvUHRyKSByZXR1cm4gRkFMU0U7CisgICAg
aWYgKCFpbmZvUHRyKQorICAgICAgICByZXR1cm4gRkFMU0U7CiAKICAgICBkUHRyLT5DdXJzb3JJ
bmZvID0gaW5mb1B0cjsKIApAQCAtOTQsOSArODcsNiBAQCBEVU1NWUN1cnNvckluaXQoU2NyZWVu
UHRyIHBTY3JlZW4pCiAgICAgaW5mb1B0ci0+U2hvd0N1cnNvciA9IGR1bW15U2hvd0N1cnNvcjsK
ICAgICBpbmZvUHRyLT5Vc2VIV0N1cnNvciA9IGR1bW15VXNlSFdDdXJzb3I7CiAvKiAgICAgaW5m
b1B0ci0+UmVhbGl6ZUN1cnNvciA9IGR1bW15UmVhbGl6ZUN1cnNvcjsgKi8KLSAgICAKLSAgICBy
ZXR1cm4oeGY4NkluaXRDdXJzb3IocFNjcmVlbiwgaW5mb1B0cikpOwotfQotCi0KIAorICAgIHJl
dHVybiAoeGY4NkluaXRDdXJzb3IocFNjcmVlbiwgaW5mb1B0cikpOworfQpkaWZmIC0tZ2l0IGEv
c3BpY2UtdmlkZW8tZHVtbXkvc3JjL2R1bW15X2RyaXZlci5jIGIvc3BpY2UtdmlkZW8tZHVtbXkv
c3JjL2R1bW15X2RyaXZlci5jCmluZGV4IGI0YjQyZjcuLjA2OTYxNTEgMTAwNjQ0Ci0tLSBhL3Nw
aWNlLXZpZGVvLWR1bW15L3NyYy9kdW1teV9kcml2ZXIuYworKysgYi9zcGljZS12aWRlby1kdW1t
eS9zcmMvZHVtbXlfZHJpdmVyLmMKQEAgLTQxLDIzICs0MSwyMSBAQAogI2luY2x1ZGUgInNlcnZl
cm1kLmgiCiAKIC8qIE1hbmRhdG9yeSBmdW5jdGlvbnMgKi8KLXN0YXRpYyBjb25zdCBPcHRpb25J
bmZvUmVjICoJRFVNTVlBdmFpbGFibGVPcHRpb25zKGludCBjaGlwaWQsIGludCBidXNpZCk7Ci1z
dGF0aWMgdm9pZCAgICAgRFVNTVlJZGVudGlmeShpbnQgZmxhZ3MpOwotc3RhdGljIEJvb2wgICAg
IERVTU1ZUHJvYmUoRHJpdmVyUHRyIGRydiwgaW50IGZsYWdzKTsKLXN0YXRpYyBCb29sICAgICBE
VU1NWVByZUluaXQoU2NybkluZm9QdHIgcFNjcm4sIGludCBmbGFncyk7Ci1zdGF0aWMgQm9vbCAg
ICAgRFVNTVlTY3JlZW5Jbml0KFNDUkVFTl9JTklUX0FSR1NfREVDTCk7Ci1zdGF0aWMgQm9vbCAg
ICAgRFVNTVlFbnRlclZUKFZUX0ZVTkNfQVJHU19ERUNMKTsKLXN0YXRpYyB2b2lkICAgICBEVU1N
WUxlYXZlVlQoVlRfRlVOQ19BUkdTX0RFQ0wpOwotc3RhdGljIEJvb2wgICAgIERVTU1ZQ2xvc2VT
Y3JlZW4oQ0xPU0VfU0NSRUVOX0FSR1NfREVDTCk7Ci1zdGF0aWMgQm9vbCAgICAgRFVNTVlDcmVh
dGVXaW5kb3coV2luZG93UHRyIHBXaW4pOwotc3RhdGljIHZvaWQgICAgIERVTU1ZRnJlZVNjcmVl
bihGUkVFX1NDUkVFTl9BUkdTX0RFQ0wpOwotc3RhdGljIE1vZGVTdGF0dXMgRFVNTVlWYWxpZE1v
ZGUoU0NSTl9BUkdfVFlQRSBhcmcsIERpc3BsYXlNb2RlUHRyIG1vZGUsCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBCb29sIHZlcmJvc2UsIGludCBmbGFncyk7Ci1zdGF0aWMgQm9v
bAlEVU1NWVNhdmVTY3JlZW4oU2NyZWVuUHRyIHBTY3JlZW4sIGludCBtb2RlKTsKK3N0YXRpYyBj
b25zdCBPcHRpb25JbmZvUmVjICpEVU1NWUF2YWlsYWJsZU9wdGlvbnMoaW50IGNoaXBpZCwgaW50
IGJ1c2lkKTsKK3N0YXRpYyB2b2lkIERVTU1ZSWRlbnRpZnkoaW50IGZsYWdzKTsKK3N0YXRpYyBC
b29sIERVTU1ZUHJvYmUoRHJpdmVyUHRyIGRydiwgaW50IGZsYWdzKTsKK3N0YXRpYyBCb29sIERV
TU1ZUHJlSW5pdChTY3JuSW5mb1B0ciBwU2NybiwgaW50IGZsYWdzKTsKK3N0YXRpYyBCb29sIERV
TU1ZU2NyZWVuSW5pdChTQ1JFRU5fSU5JVF9BUkdTX0RFQ0wpOworc3RhdGljIEJvb2wgRFVNTVlF
bnRlclZUKFZUX0ZVTkNfQVJHU19ERUNMKTsKK3N0YXRpYyB2b2lkIERVTU1ZTGVhdmVWVChWVF9G
VU5DX0FSR1NfREVDTCk7CitzdGF0aWMgQm9vbCBEVU1NWUNsb3NlU2NyZWVuKENMT1NFX1NDUkVF
Tl9BUkdTX0RFQ0wpOworc3RhdGljIEJvb2wgRFVNTVlDcmVhdGVXaW5kb3coV2luZG93UHRyIHBX
aW4pOworc3RhdGljIHZvaWQgRFVNTVlGcmVlU2NyZWVuKEZSRUVfU0NSRUVOX0FSR1NfREVDTCk7
CitzdGF0aWMgTW9kZVN0YXR1cyBEVU1NWVZhbGlkTW9kZShTQ1JOX0FSR19UWVBFIGFyZywgRGlz
cGxheU1vZGVQdHIgbW9kZSwgQm9vbCB2ZXJib3NlLCBpbnQgZmxhZ3MpOworc3RhdGljIEJvb2wg
RFVNTVlTYXZlU2NyZWVuKFNjcmVlblB0ciBwU2NyZWVuLCBpbnQgbW9kZSk7CiAKIC8qIEludGVy
bmFsbHkgdXNlZCBmdW5jdGlvbnMgKi8KLXN0YXRpYyBCb29sCWR1bW15RHJpdmVyRnVuYyhTY3Ju
SW5mb1B0ciBwU2NybiwgeG9yZ0RyaXZlckZ1bmNPcCBvcCwKLQkJCQlwb2ludGVyIHB0cik7Citz
dGF0aWMgQm9vbCBkdW1teURyaXZlckZ1bmMoU2NybkluZm9QdHIgcFNjcm4sIHhvcmdEcml2ZXJG
dW5jT3Agb3AsIHBvaW50ZXIgcHRyKTsKIAogCiAvKiBzdGF0aWMgdm9pZCAgICAgRFVNTVlEaXNw
bGF5UG93ZXJNYW5hZ2VtZW50U2V0KFNjcm5JbmZvUHRyIHBTY3JuLCAqLwpAQCAtMTAxLDggKzk5
LDggQEAgX1hfRVhQT1JUIERyaXZlclJlYyBEVU1NWSA9IHsKIH07CiAKIHN0YXRpYyBTeW1UYWJS
ZWMgRFVNTVlDaGlwc2V0c1tdID0gewotICAgIHsgRFVNTVlfQ0hJUCwgICAiZHVtbXkiIH0sCi0g
ICAgeyAtMSwJCSBOVUxMIH0KKyAgICB7RFVNTVlfQ0hJUCwgImR1bW15In0sCisgICAgey0xLCBO
VUxMfQogfTsKIAogdHlwZWRlZiBlbnVtIHsKQEAgLTExMCwyNiArMTA4LDI1IEBAIHR5cGVkZWYg
ZW51bSB7CiB9IERVTU1ZT3B0czsKIAogc3RhdGljIGNvbnN0IE9wdGlvbkluZm9SZWMgRFVNTVlP
cHRpb25zW10gPSB7Ci0gICAgeyBPUFRJT05fU1dfQ1VSU09SLAkiU1djdXJzb3IiLAlPUFRWX0JP
T0xFQU4sCXswfSwgRkFMU0UgfSwKLSAgICB7IC0xLCAgICAgICAgICAgICAgICAgIE5VTEwsICAg
ICAgICAgICBPUFRWX05PTkUsCXswfSwgRkFMU0UgfQorICAgIHtPUFRJT05fU1dfQ1VSU09SLCAi
U1djdXJzb3IiLCBPUFRWX0JPT0xFQU4sIHswfSwgRkFMU0V9LAorICAgIHstMSwgTlVMTCwgT1BU
Vl9OT05FLCB7MH0sIEZBTFNFfQogfTsKIAogI2lmZGVmIFhGcmVlODZMT0FERVIKIAogc3RhdGlj
IE1PRFVMRVNFVFVQUFJPVE8oZHVtbXlTZXR1cCk7CiAKLXN0YXRpYyBYRjg2TW9kdWxlVmVyc2lv
bkluZm8gZHVtbXlWZXJzUmVjID0KLXsKLQkiZHVtbXkiLAotCU1PRFVMRVZFTkRPUlNUUklORywK
LQlNT0RJTkZPU1RSSU5HMSwKLQlNT0RJTkZPU1RSSU5HMiwKLQlYT1JHX1ZFUlNJT05fQ1VSUkVO
VCwKLQlEVU1NWV9NQUpPUl9WRVJTSU9OLCBEVU1NWV9NSU5PUl9WRVJTSU9OLCBEVU1NWV9QQVRD
SExFVkVMLAotCUFCSV9DTEFTU19WSURFT0RSViwKLQlBQklfVklERU9EUlZfVkVSU0lPTiwKLQlN
T0RfQ0xBU1NfVklERU9EUlYsCi0JezAsMCwwLDB9CitzdGF0aWMgWEY4Nk1vZHVsZVZlcnNpb25J
bmZvIGR1bW15VmVyc1JlYyA9IHsKKyAgICAiZHVtbXkiLAorICAgIE1PRFVMRVZFTkRPUlNUUklO
RywKKyAgICBNT0RJTkZPU1RSSU5HMSwKKyAgICBNT0RJTkZPU1RSSU5HMiwKKyAgICBYT1JHX1ZF
UlNJT05fQ1VSUkVOVCwKKyAgICBEVU1NWV9NQUpPUl9WRVJTSU9OLCBEVU1NWV9NSU5PUl9WRVJT
SU9OLCBEVU1NWV9QQVRDSExFVkVMLAorICAgIEFCSV9DTEFTU19WSURFT0RSViwKKyAgICBBQklf
VklERU9EUlZfVkVSU0lPTiwKKyAgICBNT0RfQ0xBU1NfVklERU9EUlYsCisgICAgezAsIDAsIDAs
IDB9CiB9OwogCiAvKgpAQCAtMTM4LDM1ICsxMzUsMzUgQEAgc3RhdGljIFhGODZNb2R1bGVWZXJz
aW9uSW5mbyBkdW1teVZlcnNSZWMgPQogICovCiBfWF9FWFBPUlQgWEY4Nk1vZHVsZURhdGEgZHVt
bXlNb2R1bGVEYXRhID0geyAmZHVtbXlWZXJzUmVjLCBkdW1teVNldHVwLCBOVUxMIH07CiAKLXN0
YXRpYyBwb2ludGVyCi1kdW1teVNldHVwKHBvaW50ZXIgbW9kdWxlLCBwb2ludGVyIG9wdHMsIGlu
dCAqZXJybWFqLCBpbnQgKmVycm1pbikKK3N0YXRpYyBwb2ludGVyIGR1bW15U2V0dXAocG9pbnRl
ciBtb2R1bGUsIHBvaW50ZXIgb3B0cywgaW50ICplcnJtYWosIGludCAqZXJybWluKQogewogICAg
IHN0YXRpYyBCb29sIHNldHVwRG9uZSA9IEZBTFNFOwogCiAgICAgaWYgKCFzZXR1cERvbmUpIHsK
LQlzZXR1cERvbmUgPSBUUlVFOworICAgICAgICBzZXR1cERvbmUgPSBUUlVFOwogICAgICAgICB4
Zjg2QWRkRHJpdmVyKCZEVU1NWSwgbW9kdWxlLCBIYXZlRHJpdmVyRnVuY3MpOwogCi0JLyoKLQkg
KiBNb2R1bGVzIHRoYXQgdGhpcyBkcml2ZXIgYWx3YXlzIHJlcXVpcmVzIGNhbiBiZSBsb2FkZWQg
aGVyZQotCSAqIGJ5IGNhbGxpbmcgTG9hZFN1Yk1vZHVsZSgpLgotCSAqLwotCi0JLyoKLQkgKiBU
aGUgcmV0dXJuIHZhbHVlIG11c3QgYmUgbm9uLU5VTEwgb24gc3VjY2VzcyBldmVuIHRob3VnaCB0
aGVyZQotCSAqIGlzIG5vIFRlYXJEb3duUHJvYy4KLQkgKi8KLQlyZXR1cm4gKHBvaW50ZXIpMTsK
LSAgICB9IGVsc2UgewotCWlmIChlcnJtYWopICplcnJtYWogPSBMRFJfT05DRU9OTFk7Ci0JcmV0
dXJuIE5VTEw7CisgICAgICAgIC8qCisgICAgICAgICAqIE1vZHVsZXMgdGhhdCB0aGlzIGRyaXZl
ciBhbHdheXMgcmVxdWlyZXMgY2FuIGJlIGxvYWRlZCBoZXJlCisgICAgICAgICAqIGJ5IGNhbGxp
bmcgTG9hZFN1Yk1vZHVsZSgpLgorICAgICAgICAgKi8KKworICAgICAgICAvKgorICAgICAgICAg
KiBUaGUgcmV0dXJuIHZhbHVlIG11c3QgYmUgbm9uLU5VTEwgb24gc3VjY2VzcyBldmVuIHRob3Vn
aCB0aGVyZQorICAgICAgICAgKiBpcyBubyBUZWFyRG93blByb2MuCisgICAgICAgICAqLworICAg
ICAgICByZXR1cm4gKHBvaW50ZXIpIDE7CisgICAgfQorICAgIGVsc2UgeworICAgICAgICBpZiAo
ZXJybWFqKQorICAgICAgICAgICAgKmVycm1haiA9IExEUl9PTkNFT05MWTsKKyAgICAgICAgcmV0
dXJuIE5VTEw7CiAgICAgfQogfQogCiAjZW5kaWYgLyogWEZyZWU4NkxPQURFUiAqLwogCi1zdGF0
aWMgQm9vbAotRFVNTVlHZXRSZWMoU2NybkluZm9QdHIgcFNjcm4pCitzdGF0aWMgQm9vbCBEVU1N
WUdldFJlYyhTY3JuSW5mb1B0ciBwU2NybikKIHsKICAgICAvKgogICAgICAqIEFsbG9jYXRlIGEg
RFVNTVlSZWMsIGFuZCBob29rIGl0IGludG8gcFNjcm4tPmRyaXZlclByaXZhdGUuCkBAIC0xNzQs
NDEgKzE3MSwzNiBAQCBEVU1NWUdldFJlYyhTY3JuSW5mb1B0ciBwU2NybikKICAgICAgKiB0aGUg
YWxsb2NhdGlvbiBoYXMgYWxyZWFkeSBiZWVuIGRvbmUuCiAgICAgICovCiAgICAgaWYgKHBTY3Ju
LT5kcml2ZXJQcml2YXRlICE9IE5VTEwpCi0JcmV0dXJuIFRSVUU7CisgICAgICAgIHJldHVybiBU
UlVFOwogCiAgICAgcFNjcm4tPmRyaXZlclByaXZhdGUgPSB4bmZjYWxsb2Moc2l6ZW9mKERVTU1Z
UmVjKSwgMSk7CiAKICAgICBpZiAocFNjcm4tPmRyaXZlclByaXZhdGUgPT0gTlVMTCkKLQlyZXR1
cm4gRkFMU0U7CisgICAgICAgIHJldHVybiBGQUxTRTsKICAgICByZXR1cm4gVFJVRTsKIH0KIAot
c3RhdGljIHZvaWQKLURVTU1ZRnJlZVJlYyhTY3JuSW5mb1B0ciBwU2NybikKK3N0YXRpYyB2b2lk
IERVTU1ZRnJlZVJlYyhTY3JuSW5mb1B0ciBwU2NybikKIHsKICAgICBpZiAocFNjcm4tPmRyaXZl
clByaXZhdGUgPT0gTlVMTCkKLQlyZXR1cm47CisgICAgICAgIHJldHVybjsKICAgICBmcmVlKHBT
Y3JuLT5kcml2ZXJQcml2YXRlKTsKICAgICBwU2Nybi0+ZHJpdmVyUHJpdmF0ZSA9IE5VTEw7CiB9
CiAKLXN0YXRpYyBjb25zdCBPcHRpb25JbmZvUmVjICoKLURVTU1ZQXZhaWxhYmxlT3B0aW9ucyhp
bnQgY2hpcGlkLCBpbnQgYnVzaWQpCitzdGF0aWMgY29uc3QgT3B0aW9uSW5mb1JlYyAqRFVNTVlB
dmFpbGFibGVPcHRpb25zKGludCBjaGlwaWQsIGludCBidXNpZCkKIHsKICAgICByZXR1cm4gRFVN
TVlPcHRpb25zOwogfQogCiAvKiBNYW5kYXRvcnkgKi8KLXN0YXRpYyB2b2lkCi1EVU1NWUlkZW50
aWZ5KGludCBmbGFncykKK3N0YXRpYyB2b2lkIERVTU1ZSWRlbnRpZnkoaW50IGZsYWdzKQogewot
ICAgIHhmODZQcmludENoaXBzZXRzKERVTU1ZX05BTUUsICJEcml2ZXIgZm9yIER1bW15IGNoaXBz
ZXRzIiwKLQkJCURVTU1ZQ2hpcHNldHMpOworICAgIHhmODZQcmludENoaXBzZXRzKERVTU1ZX05B
TUUsICJEcml2ZXIgZm9yIER1bW15IGNoaXBzZXRzIiwgRFVNTVlDaGlwc2V0cyk7CiB9CiAKIC8q
IE1hbmRhdG9yeSAqLwotc3RhdGljIEJvb2wKLURVTU1ZUHJvYmUoRHJpdmVyUHRyIGRydiwgaW50
IGZsYWdzKQorc3RhdGljIEJvb2wgRFVNTVlQcm9iZShEcml2ZXJQdHIgZHJ2LCBpbnQgZmxhZ3Mp
CiB7CiAgICAgQm9vbCBmb3VuZFNjcmVlbiA9IEZBTFNFOwogICAgIGludCBudW1EZXZTZWN0aW9u
cywgbnVtVXNlZDsKQEAgLTIxNiw1OCArMjA4LDU1IEBAIERVTU1ZUHJvYmUoRHJpdmVyUHRyIGRy
diwgaW50IGZsYWdzKQogICAgIGludCBpOwogCiAgICAgaWYgKGZsYWdzICYgUFJPQkVfREVURUNU
KQotCXJldHVybiBGQUxTRTsKKyAgICAgICAgcmV0dXJuIEZBTFNFOwogICAgIC8qCiAgICAgICog
RmluZCB0aGUgY29uZmlnIGZpbGUgRGV2aWNlIHNlY3Rpb25zIHRoYXQgbWF0Y2ggdGhpcwogICAg
ICAqIGRyaXZlciwgYW5kIHJldHVybiBpZiB0aGVyZSBhcmUgbm9uZS4KICAgICAgKi8KLSAgICBp
ZiAoKG51bURldlNlY3Rpb25zID0geGY4Nk1hdGNoRGV2aWNlKERVTU1ZX0RSSVZFUl9OQU1FLAot
CQkJCQkgICZkZXZTZWN0aW9ucykpIDw9IDApIHsKLQlyZXR1cm4gRkFMU0U7CisgICAgaWYgKChu
dW1EZXZTZWN0aW9ucyA9IHhmODZNYXRjaERldmljZShEVU1NWV9EUklWRVJfTkFNRSwgJmRldlNl
Y3Rpb25zKSkgPD0gMCkgeworICAgICAgICByZXR1cm4gRkFMU0U7CiAgICAgfQogCiAgICAgbnVt
VXNlZCA9IG51bURldlNlY3Rpb25zOwogCiAgICAgaWYgKG51bVVzZWQgPiAwKSB7CiAKLQlmb3Ig
KGkgPSAwOyBpIDwgbnVtVXNlZDsgaSsrKSB7Ci0JICAgIFNjcm5JbmZvUHRyIHBTY3JuID0gTlVM
TDsKLQkgICAgaW50IGVudGl0eUluZGV4ID0gCi0JCXhmODZDbGFpbU5vU2xvdChkcnYsRFVNTVlf
Q0hJUCxkZXZTZWN0aW9uc1tpXSxUUlVFKTsKLQkgICAgLyogQWxsb2NhdGUgYSBTY3JuSW5mb1Jl
YyBhbmQgY2xhaW0gdGhlIHNsb3QgKi8KLQkgICAgaWYgKChwU2NybiA9IHhmODZBbGxvY2F0ZVNj
cmVlbihkcnYsMCApKSkgewotCQkgICB4Zjg2QWRkRW50aXR5VG9TY3JlZW4ocFNjcm4sZW50aXR5
SW5kZXgpOwotCQkgICAgcFNjcm4tPmRyaXZlclZlcnNpb24gPSBEVU1NWV9WRVJTSU9OOwotCQkg
ICAgcFNjcm4tPmRyaXZlck5hbWUgICAgPSBEVU1NWV9EUklWRVJfTkFNRTsKLQkJICAgIHBTY3Ju
LT5uYW1lICAgICAgICAgID0gRFVNTVlfTkFNRTsKLQkJICAgIHBTY3JuLT5Qcm9iZSAgICAgICAg
ID0gRFVNTVlQcm9iZTsKLQkJICAgIHBTY3JuLT5QcmVJbml0ICAgICAgID0gRFVNTVlQcmVJbml0
OwotCQkgICAgcFNjcm4tPlNjcmVlbkluaXQgICAgPSBEVU1NWVNjcmVlbkluaXQ7Ci0JCSAgICBw
U2Nybi0+U3dpdGNoTW9kZSAgICA9IERVTU1ZU3dpdGNoTW9kZTsKLQkJICAgIHBTY3JuLT5BZGp1
c3RGcmFtZSAgID0gRFVNTVlBZGp1c3RGcmFtZTsKLQkJICAgIHBTY3JuLT5FbnRlclZUICAgICAg
ID0gRFVNTVlFbnRlclZUOwotCQkgICAgcFNjcm4tPkxlYXZlVlQgICAgICAgPSBEVU1NWUxlYXZl
VlQ7Ci0JCSAgICBwU2Nybi0+RnJlZVNjcmVlbiAgICA9IERVTU1ZRnJlZVNjcmVlbjsKLQkJICAg
IHBTY3JuLT5WYWxpZE1vZGUgICAgID0gRFVNTVlWYWxpZE1vZGU7Ci0KLQkJICAgIGZvdW5kU2Ny
ZWVuID0gVFJVRTsKLQkgICAgfQotCX0KLSAgICB9ICAgIAorICAgICAgICBmb3IgKGkgPSAwOyBp
IDwgbnVtVXNlZDsgaSsrKSB7CisgICAgICAgICAgICBTY3JuSW5mb1B0ciBwU2NybiA9IE5VTEw7
CisgICAgICAgICAgICBpbnQgZW50aXR5SW5kZXggPSB4Zjg2Q2xhaW1Ob1Nsb3QoZHJ2LCBEVU1N
WV9DSElQLCBkZXZTZWN0aW9uc1tpXSwgVFJVRSk7CisgICAgICAgICAgICAvKiBBbGxvY2F0ZSBh
IFNjcm5JbmZvUmVjIGFuZCBjbGFpbSB0aGUgc2xvdCAqLworICAgICAgICAgICAgaWYgKChwU2Ny
biA9IHhmODZBbGxvY2F0ZVNjcmVlbihkcnYsIDApKSkgeworICAgICAgICAgICAgICAgIHhmODZB
ZGRFbnRpdHlUb1NjcmVlbihwU2NybiwgZW50aXR5SW5kZXgpOworICAgICAgICAgICAgICAgIHBT
Y3JuLT5kcml2ZXJWZXJzaW9uID0gRFVNTVlfVkVSU0lPTjsKKyAgICAgICAgICAgICAgICBwU2Ny
bi0+ZHJpdmVyTmFtZSA9IERVTU1ZX0RSSVZFUl9OQU1FOworICAgICAgICAgICAgICAgIHBTY3Ju
LT5uYW1lID0gRFVNTVlfTkFNRTsKKyAgICAgICAgICAgICAgICBwU2Nybi0+UHJvYmUgPSBEVU1N
WVByb2JlOworICAgICAgICAgICAgICAgIHBTY3JuLT5QcmVJbml0ID0gRFVNTVlQcmVJbml0Owor
ICAgICAgICAgICAgICAgIHBTY3JuLT5TY3JlZW5Jbml0ID0gRFVNTVlTY3JlZW5Jbml0OworICAg
ICAgICAgICAgICAgIHBTY3JuLT5Td2l0Y2hNb2RlID0gRFVNTVlTd2l0Y2hNb2RlOworICAgICAg
ICAgICAgICAgIHBTY3JuLT5BZGp1c3RGcmFtZSA9IERVTU1ZQWRqdXN0RnJhbWU7CisgICAgICAg
ICAgICAgICAgcFNjcm4tPkVudGVyVlQgPSBEVU1NWUVudGVyVlQ7CisgICAgICAgICAgICAgICAg
cFNjcm4tPkxlYXZlVlQgPSBEVU1NWUxlYXZlVlQ7CisgICAgICAgICAgICAgICAgcFNjcm4tPkZy
ZWVTY3JlZW4gPSBEVU1NWUZyZWVTY3JlZW47CisgICAgICAgICAgICAgICAgcFNjcm4tPlZhbGlk
TW9kZSA9IERVTU1ZVmFsaWRNb2RlOworCisgICAgICAgICAgICAgICAgZm91bmRTY3JlZW4gPSBU
UlVFOworICAgICAgICAgICAgfQorICAgICAgICB9CisgICAgfQogCiAgICAgZnJlZShkZXZTZWN0
aW9ucyk7CiAKICAgICByZXR1cm4gZm91bmRTY3JlZW47CiB9CiAKLSMgZGVmaW5lIFJFVFVSTiBc
CisjZGVmaW5lIFJFVFVSTiBcCiAgICAgeyBEVU1NWUZyZWVSZWMocFNjcm4pO1wKIAkJCSAgICBy
ZXR1cm4gRkFMU0U7XAogCQkJCQkgICAgIH0KIAogLyogTWFuZGF0b3J5ICovCi1Cb29sCi1EVU1N
WVByZUluaXQoU2NybkluZm9QdHIgcFNjcm4sIGludCBmbGFncykKK0Jvb2wgRFVNTVlQcmVJbml0
KFNjcm5JbmZvUHRyIHBTY3JuLCBpbnQgZmxhZ3MpCiB7CiAgICAgQ2xvY2tSYW5nZVB0ciBjbG9j
a1JhbmdlczsKICAgICBpbnQgaTsKQEAgLTI3NSwxMDMgKzI2NCwxMDAgQEAgRFVNTVlQcmVJbml0
KFNjcm5JbmZvUHRyIHBTY3JuLCBpbnQgZmxhZ3MpCiAgICAgaW50IG1heENsb2NrID0gMzAwMDAw
OwogICAgIEdEZXZQdHIgZGV2aWNlID0geGY4NkdldEVudGl0eUluZm8ocFNjcm4tPmVudGl0eUxp
c3RbMF0pLT5kZXZpY2U7CiAKLSAgICBpZiAoZmxhZ3MgJiBQUk9CRV9ERVRFQ1QpIAotCXJldHVy
biBUUlVFOwotICAgIAorICAgIGlmIChmbGFncyAmIFBST0JFX0RFVEVDVCkKKyAgICAgICAgcmV0
dXJuIFRSVUU7CisKICAgICAvKiBBbGxvY2F0ZSB0aGUgRHVtbXlSZWMgZHJpdmVyUHJpdmF0ZSAq
LwogICAgIGlmICghRFVNTVlHZXRSZWMocFNjcm4pKSB7Ci0JcmV0dXJuIEZBTFNFOworICAgICAg
ICByZXR1cm4gRkFMU0U7CiAgICAgfQotICAgIAorCiAgICAgZFB0ciA9IERVTU1ZUFRSKHBTY3Ju
KTsKIAotICAgIHBTY3JuLT5jaGlwc2V0ID0gKGNoYXIgKil4Zjg2VG9rZW5Ub1N0cmluZyhEVU1N
WUNoaXBzZXRzLAotCQkJCQkgICAgICAgRFVNTVlfQ0hJUCk7CisgICAgcFNjcm4tPmNoaXBzZXQg
PSAoY2hhciAqKSB4Zjg2VG9rZW5Ub1N0cmluZyhEVU1NWUNoaXBzZXRzLCBEVU1NWV9DSElQKTsK
IAogICAgIHhmODZEcnZNc2cocFNjcm4tPnNjcm5JbmRleCwgWF9JTkZPLCAiQ2hpcHNldCBpcyBh
IERVTU1ZXG4iKTsKLSAgICAKKwogICAgIHBTY3JuLT5tb25pdG9yID0gcFNjcm4tPmNvbmZTY3Jl
ZW4tPm1vbml0b3I7CiAKLSAgICBpZiAoIXhmODZTZXREZXB0aEJwcChwU2NybiwgMCwgMCwgMCwg
IFN1cHBvcnQyNGJwcEZiIHwgU3VwcG9ydDMyYnBwRmIpKQotCXJldHVybiBGQUxTRTsKKyAgICBp
ZiAoIXhmODZTZXREZXB0aEJwcChwU2NybiwgMCwgMCwgMCwgU3VwcG9ydDI0YnBwRmIgfCBTdXBw
b3J0MzJicHBGYikpCisgICAgICAgIHJldHVybiBGQUxTRTsKICAgICBlbHNlIHsKLQkvKiBDaGVj
ayB0aGF0IHRoZSByZXR1cm5lZCBkZXB0aCBpcyBvbmUgd2Ugc3VwcG9ydCAqLwotCXN3aXRjaCAo
cFNjcm4tPmRlcHRoKSB7Ci0JY2FzZSA4OgotCWNhc2UgMTU6Ci0JY2FzZSAxNjoKLQljYXNlIDI0
OgotCWNhc2UgMzA6Ci0JICAgIGJyZWFrOwotCWRlZmF1bHQ6Ci0JICAgIHhmODZEcnZNc2cocFNj
cm4tPnNjcm5JbmRleCwgWF9FUlJPUiwKLQkJICAgICAgICJHaXZlbiBkZXB0aCAoJWQpIGlzIG5v
dCBzdXBwb3J0ZWQgYnkgdGhpcyBkcml2ZXJcbiIsCi0JCSAgICAgICBwU2Nybi0+ZGVwdGgpOwot
CSAgICByZXR1cm4gRkFMU0U7Ci0JfQorICAgICAgICAvKiBDaGVjayB0aGF0IHRoZSByZXR1cm5l
ZCBkZXB0aCBpcyBvbmUgd2Ugc3VwcG9ydCAqLworICAgICAgICBzd2l0Y2ggKHBTY3JuLT5kZXB0
aCkgeworICAgICAgICAgICAgY2FzZSA4OgorICAgICAgICAgICAgY2FzZSAxNToKKyAgICAgICAg
ICAgIGNhc2UgMTY6CisgICAgICAgICAgICBjYXNlIDI0OgorICAgICAgICAgICAgY2FzZSAzMDoK
KyAgICAgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICAgIGRlZmF1bHQ6CisgICAgICAgICAg
ICAgICAgeGY4NkRydk1zZyhwU2Nybi0+c2NybkluZGV4LCBYX0VSUk9SLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIkdpdmVuIGRlcHRoICglZCkgaXMgbm90IHN1cHBvcnRlZCBieSB0aGlz
IGRyaXZlclxuIiwgcFNjcm4tPmRlcHRoKTsKKyAgICAgICAgICAgICAgICByZXR1cm4gRkFMU0U7
CisgICAgICAgIH0KICAgICB9CiAKICAgICB4Zjg2UHJpbnREZXB0aEJwcChwU2Nybik7CiAgICAg
aWYgKHBTY3JuLT5kZXB0aCA9PSA4KQotCXBTY3JuLT5yZ2JCaXRzID0gODsKKyAgICAgICAgcFNj
cm4tPnJnYkJpdHMgPSA4OwogCiAgICAgLyogR2V0IHRoZSBkZXB0aDI0IHBpeG1hcCBmb3JtYXQg
Ki8KICAgICBpZiAocFNjcm4tPmRlcHRoID09IDI0ICYmIHBpeDI0YnBwID09IDApCi0JcGl4MjRi
cHAgPSB4Zjg2R2V0QnBwRnJvbURlcHRoKHBTY3JuLCAyNCk7CisgICAgICAgIHBpeDI0YnBwID0g
eGY4NkdldEJwcEZyb21EZXB0aChwU2NybiwgMjQpOwogCiAgICAgLyoKICAgICAgKiBUaGlzIG11
c3QgaGFwcGVuIGFmdGVyIHBTY3JuLT5kaXNwbGF5IGhhcyBiZWVuIHNldCBiZWNhdXNlCiAgICAg
ICogeGY4NlNldFdlaWdodCByZWZlcmVuY2VzIGl0LgogICAgICAqLwogICAgIGlmIChwU2Nybi0+
ZGVwdGggPiA4KSB7Ci0JLyogVGhlIGRlZmF1bHRzIGFyZSBPSyBmb3IgdXMgKi8KLQlyZ2IgemVy
b3MgPSB7MCwgMCwgMH07Ci0KLQlpZiAoIXhmODZTZXRXZWlnaHQocFNjcm4sIHplcm9zLCB6ZXJv
cykpIHsKLQkgICAgcmV0dXJuIEZBTFNFOwotCX0gZWxzZSB7Ci0JICAgIC8qIFhYWCBjaGVjayB0
aGF0IHdlaWdodCByZXR1cm5lZCBpcyBzdXBwb3J0ZWQgKi8KLQkgICAgOwotCX0KKyAgICAgICAg
LyogVGhlIGRlZmF1bHRzIGFyZSBPSyBmb3IgdXMgKi8KKyAgICAgICAgcmdiIHplcm9zID0geyAw
LCAwLCAwIH07CisKKyAgICAgICAgaWYgKCF4Zjg2U2V0V2VpZ2h0KHBTY3JuLCB6ZXJvcywgemVy
b3MpKSB7CisgICAgICAgICAgICByZXR1cm4gRkFMU0U7CisgICAgICAgIH0KKyAgICAgICAgZWxz
ZSB7CisgICAgICAgICAgICAvKiBYWFggY2hlY2sgdGhhdCB3ZWlnaHQgcmV0dXJuZWQgaXMgc3Vw
cG9ydGVkICovCisgICAgICAgICAgICA7CisgICAgICAgIH0KICAgICB9CiAKLSAgICBpZiAoIXhm
ODZTZXREZWZhdWx0VmlzdWFsKHBTY3JuLCAtMSkpIAotCXJldHVybiBGQUxTRTsKKyAgICBpZiAo
IXhmODZTZXREZWZhdWx0VmlzdWFsKHBTY3JuLCAtMSkpCisgICAgICAgIHJldHVybiBGQUxTRTsK
IAogICAgIGlmIChwU2Nybi0+ZGVwdGggPiAxKSB7Ci0JR2FtbWEgemVyb3MgPSB7MC4wLCAwLjAs
IDAuMH07CisgICAgICAgIEdhbW1hIHplcm9zID0geyAwLjAsIDAuMCwgMC4wIH07CiAKLQlpZiAo
IXhmODZTZXRHYW1tYShwU2NybiwgemVyb3MpKQotCSAgICByZXR1cm4gRkFMU0U7CisgICAgICAg
IGlmICgheGY4NlNldEdhbW1hKHBTY3JuLCB6ZXJvcykpCisgICAgICAgICAgICByZXR1cm4gRkFM
U0U7CiAgICAgfQogCiAgICAgeGY4NkNvbGxlY3RPcHRpb25zKHBTY3JuLCBkZXZpY2UtPm9wdGlv
bnMpOwogICAgIC8qIFByb2Nlc3MgdGhlIG9wdGlvbnMgKi8KICAgICBpZiAoIShkUHRyLT5PcHRp
b25zID0gbWFsbG9jKHNpemVvZihEVU1NWU9wdGlvbnMpKSkpCi0JcmV0dXJuIEZBTFNFOworICAg
ICAgICByZXR1cm4gRkFMU0U7CiAgICAgbWVtY3B5KGRQdHItPk9wdGlvbnMsIERVTU1ZT3B0aW9u
cywgc2l6ZW9mKERVTU1ZT3B0aW9ucykpOwogCiAgICAgeGY4NlByb2Nlc3NPcHRpb25zKHBTY3Ju
LT5zY3JuSW5kZXgsIHBTY3JuLT5vcHRpb25zLCBkUHRyLT5PcHRpb25zKTsKIAotICAgIHhmODZH
ZXRPcHRWYWxCb29sKGRQdHItPk9wdGlvbnMsIE9QVElPTl9TV19DVVJTT1IsJmRQdHItPnN3Q3Vy
c29yKTsKKyAgICB4Zjg2R2V0T3B0VmFsQm9vbChkUHRyLT5PcHRpb25zLCBPUFRJT05fU1dfQ1VS
U09SLCAmZFB0ci0+c3dDdXJzb3IpOwogCiAgICAgaWYgKGRldmljZS0+dmlkZW9SYW0gIT0gMCkg
ewotCXBTY3JuLT52aWRlb1JhbSA9IGRldmljZS0+dmlkZW9SYW07Ci0JeGY4NkRydk1zZyhwU2Ny
bi0+c2NybkluZGV4LCBYX0NPTkZJRywgIlZpZGVvUkFNOiAlZCBrQnl0ZVxuIiwKLQkJICAgcFNj
cm4tPnZpZGVvUmFtKTsKLSAgICB9IGVsc2UgewotCXBTY3JuLT52aWRlb1JhbSA9IDQwOTY7Ci0J
eGY4NkRydk1zZyhwU2Nybi0+c2NybkluZGV4LCBYX1BST0JFRCwgIlZpZGVvUkFNOiAlZCBrQnl0
ZVxuIiwKLQkJICAgcFNjcm4tPnZpZGVvUmFtKTsKKyAgICAgICAgcFNjcm4tPnZpZGVvUmFtID0g
ZGV2aWNlLT52aWRlb1JhbTsKKyAgICAgICAgeGY4NkRydk1zZyhwU2Nybi0+c2NybkluZGV4LCBY
X0NPTkZJRywgIlZpZGVvUkFNOiAlZCBrQnl0ZVxuIiwgcFNjcm4tPnZpZGVvUmFtKTsKKyAgICB9
CisgICAgZWxzZSB7CisgICAgICAgIHBTY3JuLT52aWRlb1JhbSA9IDQwOTY7CisgICAgICAgIHhm
ODZEcnZNc2cocFNjcm4tPnNjcm5JbmRleCwgWF9QUk9CRUQsICJWaWRlb1JBTTogJWQga0J5dGVc
biIsIHBTY3JuLT52aWRlb1JhbSk7CiAgICAgfQotICAgIAorCiAgICAgaWYgKGRldmljZS0+ZGFj
U3BlZWRzWzBdICE9IDApIHsKLQltYXhDbG9jayA9IGRldmljZS0+ZGFjU3BlZWRzWzBdOwotCXhm
ODZEcnZNc2cocFNjcm4tPnNjcm5JbmRleCwgWF9DT05GSUcsICJNYXggQ2xvY2s6ICVkIGtIelxu
IiwKLQkJICAgbWF4Q2xvY2spOwotICAgIH0gZWxzZSB7Ci0JeGY4NkRydk1zZyhwU2Nybi0+c2Ny
bkluZGV4LCBYX1BST0JFRCwgIk1heCBDbG9jazogJWQga0h6XG4iLAotCQkgICBtYXhDbG9jayk7
CisgICAgICAgIG1heENsb2NrID0gZGV2aWNlLT5kYWNTcGVlZHNbMF07CisgICAgICAgIHhmODZE
cnZNc2cocFNjcm4tPnNjcm5JbmRleCwgWF9DT05GSUcsICJNYXggQ2xvY2s6ICVkIGtIelxuIiwg
bWF4Q2xvY2spOworICAgIH0KKyAgICBlbHNlIHsKKyAgICAgICAgeGY4NkRydk1zZyhwU2Nybi0+
c2NybkluZGV4LCBYX1BST0JFRCwgIk1heCBDbG9jazogJWQga0h6XG4iLCBtYXhDbG9jayk7CiAg
ICAgfQogCiAgICAgcFNjcm4tPnByb2dDbG9jayA9IFRSVUU7CkBAIC0zNzksMzggKzM2NSwzNyBA
QCBEVU1NWVByZUluaXQoU2NybkluZm9QdHIgcFNjcm4sIGludCBmbGFncykKICAgICAgKiBTZXR1
cCB0aGUgQ2xvY2tSYW5nZXMsIHdoaWNoIGRlc2NyaWJlIHdoYXQgY2xvY2sgcmFuZ2VzIGFyZSBh
dmFpbGFibGUsCiAgICAgICogYW5kIHdoYXQgc29ydCBvZiBtb2RlcyB0aGV5IGNhbiBiZSB1c2Vk
IGZvci4KICAgICAgKi8KLSAgICBjbG9ja1JhbmdlcyA9IChDbG9ja1JhbmdlUHRyKXhuZmNhbGxv
YyhzaXplb2YoQ2xvY2tSYW5nZSksIDEpOworICAgIGNsb2NrUmFuZ2VzID0gKENsb2NrUmFuZ2VQ
dHIpIHhuZmNhbGxvYyhzaXplb2YoQ2xvY2tSYW5nZSksIDEpOwogICAgIGNsb2NrUmFuZ2VzLT5u
ZXh0ID0gTlVMTDsKICAgICBjbG9ja1Jhbmdlcy0+Q2xvY2tNdWxGYWN0b3IgPSAxOwotICAgIGNs
b2NrUmFuZ2VzLT5taW5DbG9jayA9IDExMDAwOyAgIC8qIGd1ZXNzZWQgwqfCp8KnICovCisgICAg
Y2xvY2tSYW5nZXMtPm1pbkNsb2NrID0gMTEwMDA7ICAvKiBndWVzc2VkIMKnwqfCpyAqLwogICAg
IGNsb2NrUmFuZ2VzLT5tYXhDbG9jayA9IG1heENsb2NrOwotICAgIGNsb2NrUmFuZ2VzLT5jbG9j
a0luZGV4ID0gLTE7CQkvKiBwcm9ncmFtbWFibGUgKi8KLSAgICBjbG9ja1Jhbmdlcy0+aW50ZXJs
YWNlQWxsb3dlZCA9IFRSVUU7IAorICAgIGNsb2NrUmFuZ2VzLT5jbG9ja0luZGV4ID0gLTE7ICAg
LyogcHJvZ3JhbW1hYmxlICovCisgICAgY2xvY2tSYW5nZXMtPmludGVybGFjZUFsbG93ZWQgPSBU
UlVFOwogICAgIGNsb2NrUmFuZ2VzLT5kb3VibGVTY2FuQWxsb3dlZCA9IFRSVUU7CiAKICAgICAv
KiBTdWJ0cmFjdCBtZW1vcnkgZm9yIEhXIGN1cnNvciAqLwogCiAKICAgICB7Ci0JaW50IGFwZXJ0
dXJlU2l6ZSA9IChwU2Nybi0+dmlkZW9SYW0gKiAxMDI0KTsKLQlpID0geGY4NlZhbGlkYXRlTW9k
ZXMocFNjcm4sIHBTY3JuLT5tb25pdG9yLT5Nb2RlcywKLQkJCSAgICAgIHBTY3JuLT5kaXNwbGF5
LT5tb2RlcywgY2xvY2tSYW5nZXMsCi0JCQkgICAgICBOVUxMLCAyNTYsIERVTU1ZX01BWF9XSURU
SCwKLQkJCSAgICAgICg4ICogcFNjcm4tPmJpdHNQZXJQaXhlbCksCi0JCQkgICAgICAxMjgsIERV
TU1ZX01BWF9IRUlHSFQsIHBTY3JuLT5kaXNwbGF5LT52aXJ0dWFsWCwKLQkJCSAgICAgIHBTY3Ju
LT5kaXNwbGF5LT52aXJ0dWFsWSwgYXBlcnR1cmVTaXplLAotCQkJICAgICAgTE9PS1VQX0JFU1Rf
UkVGUkVTSCk7Ci0KLSAgICAgICBpZiAoaSA9PSAtMSkKLSAgICAgICAgICAgUkVUVVJOOworICAg
ICAgICBpbnQgYXBlcnR1cmVTaXplID0gKHBTY3JuLT52aWRlb1JhbSAqIDEwMjQpOworICAgICAg
ICBpID0geGY4NlZhbGlkYXRlTW9kZXMocFNjcm4sIHBTY3JuLT5tb25pdG9yLT5Nb2RlcywKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBTY3JuLT5kaXNwbGF5LT5tb2RlcywgY2xvY2tS
YW5nZXMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOVUxMLCAyNTYsIERVTU1ZX01B
WF9XSURUSCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg4ICogcFNjcm4tPmJpdHNQ
ZXJQaXhlbCksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMjgsIERVTU1ZX01BWF9I
RUlHSFQsIHBTY3JuLT5kaXNwbGF5LT52aXJ0dWFsWCwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHBTY3JuLT5kaXNwbGF5LT52aXJ0dWFsWSwgYXBlcnR1cmVTaXplLCBMT09LVVBfQkVT
VF9SRUZSRVNIKTsKKworICAgICAgICBpZiAoaSA9PSAtMSkKKyAgICAgICAgICAgIFJFVFVSTjsK
ICAgICB9CiAKICAgICAvKiBQcnVuZSB0aGUgbW9kZXMgbWFya2VkIGFzIGludmFsaWQgKi8KICAg
ICB4Zjg2UHJ1bmVEcml2ZXJNb2RlcyhwU2Nybik7CiAKICAgICBpZiAoaSA9PSAwIHx8IHBTY3Ju
LT5tb2RlcyA9PSBOVUxMKSB7Ci0JeGY4NkRydk1zZyhwU2Nybi0+c2NybkluZGV4LCBYX0VSUk9S
LCAiTm8gdmFsaWQgbW9kZXMgZm91bmRcbiIpOwotCVJFVFVSTjsKKyAgICAgICAgeGY4NkRydk1z
ZyhwU2Nybi0+c2NybkluZGV4LCBYX0VSUk9SLCAiTm8gdmFsaWQgbW9kZXMgZm91bmRcbiIpOwor
ICAgICAgICBSRVRVUk47CiAgICAgfQogCiAgICAgLyoKQEAgLTQyMSw4ICs0MDYsOCBAQCBEVU1N
WVByZUluaXQoU2NybkluZm9QdHIgcFNjcm4sIGludCBmbGFncykKICAgICAgKiBkcml2ZXIgYW5k
IGlmIHRoZSBkcml2ZXIgZG9lc24ndCBwcm92aWRlIGNvZGUgdG8gc2V0IHRoZW0uICBUaGV5CiAg
ICAgICogYXJlIG5vdCBwcmUtaW5pdGlhbGlzZWQgYXQgYWxsLgogICAgICAqLwotICAgIHhmODZT
ZXRDcnRjRm9yTW9kZXMocFNjcm4sIDApOyAKLSAKKyAgICB4Zjg2U2V0Q3J0Y0Zvck1vZGVzKHBT
Y3JuLCAwKTsKKwogICAgIC8qIFNldCB0aGUgY3VycmVudCBtb2RlIHRvIHRoZSBmaXJzdCBpbiB0
aGUgbGlzdCAqLwogICAgIHBTY3JuLT5jdXJyZW50TW9kZSA9IHBTY3JuLT5tb2RlczsKIApAQCAt
NDMzLDczICs0MTgsNjYgQEAgRFVNTVlQcmVJbml0KFNjcm5JbmZvUHRyIHBTY3JuLCBpbnQgZmxh
Z3MpCiAgICAgeGY4NlNldERwaShwU2NybiwgMCwgMCk7CiAKICAgICBpZiAoeGY4NkxvYWRTdWJN
b2R1bGUocFNjcm4sICJmYiIpID09IE5VTEwpIHsKLQlSRVRVUk47CisgICAgICAgIFJFVFVSTjsK
ICAgICB9CiAKICAgICBpZiAoIWRQdHItPnN3Q3Vyc29yKSB7Ci0JaWYgKCF4Zjg2TG9hZFN1Yk1v
ZHVsZShwU2NybiwgInJhbWRhYyIpKQotCSAgICBSRVRVUk47CisgICAgICAgIGlmICgheGY4Nkxv
YWRTdWJNb2R1bGUocFNjcm4sICJyYW1kYWMiKSkKKyAgICAgICAgICAgIFJFVFVSTjsKICAgICB9
Ci0gICAgCisKICAgICAvKiBXZSBoYXZlIG5vIGNvbnRpZ3VvdXMgcGh5c2ljYWwgZmIgaW4gcGh5
c2ljYWwgbWVtb3J5ICovCiAgICAgcFNjcm4tPm1lbVBoeXNCYXNlID0gMDsKICAgICBwU2Nybi0+
ZmJPZmZzZXQgPSAwOwogCiAgICAgcmV0dXJuIFRSVUU7CiB9CisKICN1bmRlZiBSRVRVUk4KIAog
LyogTWFuZGF0b3J5ICovCi1zdGF0aWMgQm9vbAotRFVNTVlFbnRlclZUKFZUX0ZVTkNfQVJHU19E
RUNMKQorc3RhdGljIEJvb2wgRFVNTVlFbnRlclZUKFZUX0ZVTkNfQVJHU19ERUNMKQogewogICAg
IHJldHVybiBUUlVFOwogfQogCiAvKiBNYW5kYXRvcnkgKi8KLXN0YXRpYyB2b2lkCi1EVU1NWUxl
YXZlVlQoVlRfRlVOQ19BUkdTX0RFQ0wpCitzdGF0aWMgdm9pZCBEVU1NWUxlYXZlVlQoVlRfRlVO
Q19BUkdTX0RFQ0wpCiB7CiB9CiAKIHN0YXRpYyB2b2lkCi1EVU1NWUxvYWRQYWxldHRlKAotICAg
U2NybkluZm9QdHIgcFNjcm4sCi0gICBpbnQgbnVtQ29sb3JzLAotICAgaW50ICppbmRpY2VzLAot
ICAgTE9DTyAqY29sb3JzLAotICAgVmlzdWFsUHRyIHBWaXN1YWwKLSl7Ci0gICBpbnQgaSwgaW5k
ZXgsIHNoaWZ0LCBHc2hpZnQ7Ci0gICBEVU1NWVB0ciBkUHRyID0gRFVNTVlQVFIocFNjcm4pOwot
Ci0gICBzd2l0Y2gocFNjcm4tPmRlcHRoKSB7Ci0gICBjYXNlIDE1OgkKLQlzaGlmdCA9IEdzaGlm
dCA9IDE7Ci0JYnJlYWs7Ci0gICBjYXNlIDE2OgotCXNoaWZ0ID0gMDsgCi0gICAgICAgIEdzaGlm
dCA9IDA7Ci0JYnJlYWs7Ci0gICBkZWZhdWx0OgotCXNoaWZ0ID0gR3NoaWZ0ID0gMDsKLQlicmVh
azsKLSAgIH0KLQotICAgZm9yKGkgPSAwOyBpIDwgbnVtQ29sb3JzOyBpKyspIHsKLSAgICAgICBp
bmRleCA9IGluZGljZXNbaV07Ci0gICAgICAgZFB0ci0+Y29sb3JzW2luZGV4XS5yZWQgPSBjb2xv
cnNbaW5kZXhdLnJlZCA8PCBzaGlmdDsKLSAgICAgICBkUHRyLT5jb2xvcnNbaW5kZXhdLmdyZWVu
ID0gY29sb3JzW2luZGV4XS5ncmVlbiA8PCBHc2hpZnQ7Ci0gICAgICAgZFB0ci0+Y29sb3JzW2lu
ZGV4XS5ibHVlID0gY29sb3JzW2luZGV4XS5ibHVlIDw8IHNoaWZ0OwotICAgfSAKK0RVTU1ZTG9h
ZFBhbGV0dGUoU2NybkluZm9QdHIgcFNjcm4sIGludCBudW1Db2xvcnMsIGludCAqaW5kaWNlcywg
TE9DTyAqIGNvbG9ycywgVmlzdWFsUHRyIHBWaXN1YWwpCit7CisgICAgaW50IGksIGluZGV4LCBz
aGlmdCwgR3NoaWZ0OworICAgIERVTU1ZUHRyIGRQdHIgPSBEVU1NWVBUUihwU2Nybik7CisKKyAg
ICBzd2l0Y2ggKHBTY3JuLT5kZXB0aCkgeworICAgICAgICBjYXNlIDE1OgorICAgICAgICAgICAg
c2hpZnQgPSBHc2hpZnQgPSAxOworICAgICAgICAgICAgYnJlYWs7CisgICAgICAgIGNhc2UgMTY6
CisgICAgICAgICAgICBzaGlmdCA9IDA7CisgICAgICAgICAgICBHc2hpZnQgPSAwOworICAgICAg
ICAgICAgYnJlYWs7CisgICAgICAgIGRlZmF1bHQ6CisgICAgICAgICAgICBzaGlmdCA9IEdzaGlm
dCA9IDA7CisgICAgICAgICAgICBicmVhazsKKyAgICB9CisKKyAgICBmb3IgKGkgPSAwOyBpIDwg
bnVtQ29sb3JzOyBpKyspIHsKKyAgICAgICAgaW5kZXggPSBpbmRpY2VzW2ldOworICAgICAgICBk
UHRyLT5jb2xvcnNbaW5kZXhdLnJlZCA9IGNvbG9yc1tpbmRleF0ucmVkIDw8IHNoaWZ0OworICAg
ICAgICBkUHRyLT5jb2xvcnNbaW5kZXhdLmdyZWVuID0gY29sb3JzW2luZGV4XS5ncmVlbiA8PCBH
c2hpZnQ7CisgICAgICAgIGRQdHItPmNvbG9yc1tpbmRleF0uYmx1ZSA9IGNvbG9yc1tpbmRleF0u
Ymx1ZSA8PCBzaGlmdDsKKyAgICB9CiAKIH0KIAotc3RhdGljIFNjcm5JbmZvUHRyIERVTU1ZU2Ny
bjsgLyogc3RhdGljLWdsb2JhbGl6ZSBpdCAqLworc3RhdGljIFNjcm5JbmZvUHRyIERVTU1ZU2Ny
bjsgICAvKiBzdGF0aWMtZ2xvYmFsaXplIGl0ICovCiAKIC8qIE1hbmRhdG9yeSAqLwotc3RhdGlj
IEJvb2wKLURVTU1ZU2NyZWVuSW5pdChTQ1JFRU5fSU5JVF9BUkdTX0RFQ0wpCitzdGF0aWMgQm9v
bCBEVU1NWVNjcmVlbkluaXQoU0NSRUVOX0lOSVRfQVJHU19ERUNMKQogewogICAgIFNjcm5JbmZv
UHRyIHBTY3JuOwogICAgIERVTU1ZUHRyIGRQdHI7CkBAIC01MTcsMTAyICs0OTUsOTggQEAgRFVN
TVlTY3JlZW5Jbml0KFNDUkVFTl9JTklUX0FSR1NfREVDTCkKIAogCiAgICAgaWYgKCEocGl4ZWxz
ID0gbWFsbG9jKHBTY3JuLT52aWRlb1JhbSAqIDEwMjQpKSkKLQlyZXR1cm4gRkFMU0U7CisgICAg
ICAgIHJldHVybiBGQUxTRTsKIAogICAgIC8qCiAgICAgICogUmVzZXQgdmlzdWFsIGxpc3QuCiAg
ICAgICovCiAgICAgbWlDbGVhclZpc3VhbFR5cGVzKCk7Ci0gICAgCisKICAgICAvKiBTZXR1cCB0
aGUgdmlzdWFscyB3ZSBzdXBwb3J0LiAqLwotICAgIAorCiAgICAgaWYgKCFtaVNldFZpc3VhbFR5
cGVzKHBTY3JuLT5kZXB0aCwKLSAgICAgIAkJICAgICAgbWlHZXREZWZhdWx0VmlzdWFsTWFzayhw
U2Nybi0+ZGVwdGgpLAotCQkgICAgICBwU2Nybi0+cmdiQml0cywgcFNjcm4tPmRlZmF1bHRWaXN1
YWwpKQotICAgICAgICAgcmV0dXJuIEZBTFNFOworICAgICAgICAgICAgICAgICAgICAgICAgICBt
aUdldERlZmF1bHRWaXN1YWxNYXNrKHBTY3JuLT5kZXB0aCksCisgICAgICAgICAgICAgICAgICAg
ICAgICAgIHBTY3JuLT5yZ2JCaXRzLCBwU2Nybi0+ZGVmYXVsdFZpc3VhbCkpCisgICAgICAgIHJl
dHVybiBGQUxTRTsKIAotICAgIGlmICghbWlTZXRQaXhtYXBEZXB0aHMgKCkpIHJldHVybiBGQUxT
RTsKKyAgICBpZiAoIW1pU2V0UGl4bWFwRGVwdGhzKCkpCisgICAgICAgIHJldHVybiBGQUxTRTsK
IAogICAgIC8qCiAgICAgICogQ2FsbCB0aGUgZnJhbWVidWZmZXIgbGF5ZXIncyBTY3JlZW5Jbml0
IGZ1bmN0aW9uLCBhbmQgZmlsbCBpbiBvdGhlcgogICAgICAqIHBTY3JlZW4gZmllbGRzLgogICAg
ICAqLwogICAgIHJldCA9IGZiU2NyZWVuSW5pdChwU2NyZWVuLCBwaXhlbHMsCi0JCQkgICAgcFNj
cm4tPnZpcnR1YWxYLCBwU2Nybi0+dmlydHVhbFksCi0JCQkgICAgcFNjcm4tPnhEcGksIHBTY3Ju
LT55RHBpLAotCQkJICAgIHBTY3JuLT5kaXNwbGF5V2lkdGgsIHBTY3JuLT5iaXRzUGVyUGl4ZWwp
OworICAgICAgICAgICAgICAgICAgICAgICBwU2Nybi0+dmlydHVhbFgsIHBTY3JuLT52aXJ0dWFs
WSwKKyAgICAgICAgICAgICAgICAgICAgICAgcFNjcm4tPnhEcGksIHBTY3JuLT55RHBpLCBwU2Ny
bi0+ZGlzcGxheVdpZHRoLCBwU2Nybi0+Yml0c1BlclBpeGVsKTsKICAgICBpZiAoIXJldCkKLQly
ZXR1cm4gRkFMU0U7CisgICAgICAgIHJldHVybiBGQUxTRTsKIAogICAgIGlmIChwU2Nybi0+ZGVw
dGggPiA4KSB7CiAgICAgICAgIC8qIEZpeHVwIFJHQiBvcmRlcmluZyAqLwogICAgICAgICB2aXN1
YWwgPSBwU2NyZWVuLT52aXN1YWxzICsgcFNjcmVlbi0+bnVtVmlzdWFsczsKICAgICAgICAgd2hp
bGUgKC0tdmlzdWFsID49IHBTY3JlZW4tPnZpc3VhbHMpIHsKLQkgICAgaWYgKCh2aXN1YWwtPmNs
YXNzIHwgRHluYW1pY0NsYXNzKSA9PSBEaXJlY3RDb2xvcikgewotCQl2aXN1YWwtPm9mZnNldFJl
ZCA9IHBTY3JuLT5vZmZzZXQucmVkOwotCQl2aXN1YWwtPm9mZnNldEdyZWVuID0gcFNjcm4tPm9m
ZnNldC5ncmVlbjsKLQkJdmlzdWFsLT5vZmZzZXRCbHVlID0gcFNjcm4tPm9mZnNldC5ibHVlOwot
CQl2aXN1YWwtPnJlZE1hc2sgPSBwU2Nybi0+bWFzay5yZWQ7Ci0JCXZpc3VhbC0+Z3JlZW5NYXNr
ID0gcFNjcm4tPm1hc2suZ3JlZW47Ci0JCXZpc3VhbC0+Ymx1ZU1hc2sgPSBwU2Nybi0+bWFzay5i
bHVlOwotCSAgICB9Ci0JfQorICAgICAgICAgICAgaWYgKCh2aXN1YWwtPmNsYXNzIHwgRHluYW1p
Y0NsYXNzKSA9PSBEaXJlY3RDb2xvcikgeworICAgICAgICAgICAgICAgIHZpc3VhbC0+b2Zmc2V0
UmVkID0gcFNjcm4tPm9mZnNldC5yZWQ7CisgICAgICAgICAgICAgICAgdmlzdWFsLT5vZmZzZXRH
cmVlbiA9IHBTY3JuLT5vZmZzZXQuZ3JlZW47CisgICAgICAgICAgICAgICAgdmlzdWFsLT5vZmZz
ZXRCbHVlID0gcFNjcm4tPm9mZnNldC5ibHVlOworICAgICAgICAgICAgICAgIHZpc3VhbC0+cmVk
TWFzayA9IHBTY3JuLT5tYXNrLnJlZDsKKyAgICAgICAgICAgICAgICB2aXN1YWwtPmdyZWVuTWFz
ayA9IHBTY3JuLT5tYXNrLmdyZWVuOworICAgICAgICAgICAgICAgIHZpc3VhbC0+Ymx1ZU1hc2sg
PSBwU2Nybi0+bWFzay5ibHVlOworICAgICAgICAgICAgfQorICAgICAgICB9CiAgICAgfQotICAg
IAorCiAgICAgLyogbXVzdCBiZSBhZnRlciBSR0Igb3JkZXJpbmcgZml4ZWQgKi8KICAgICBmYlBp
Y3R1cmVJbml0KHBTY3JlZW4sIDAsIDApOwogCiAgICAgeGY4NlNldEJsYWNrV2hpdGVQaXhlbHMo
cFNjcmVlbik7CiAKICAgICBpZiAoZFB0ci0+c3dDdXJzb3IpCi0JeGY4NkRydk1zZyhwU2Nybi0+
c2NybkluZGV4LCBYX0NPTkZJRywgIlVzaW5nIFNvZnR3YXJlIEN1cnNvci5cbiIpOworICAgICAg
ICB4Zjg2RHJ2TXNnKHBTY3JuLT5zY3JuSW5kZXgsIFhfQ09ORklHLCAiVXNpbmcgU29mdHdhcmUg
Q3Vyc29yLlxuIik7CiAKICAgICB7CiAKLQkgCi0JQm94UmVjIEF2YWlsRkJBcmVhOwotCWludCBs
aW5lcyA9IHBTY3JuLT52aWRlb1JhbSAqIDEwMjQgLwotCSAgICAocFNjcm4tPmRpc3BsYXlXaWR0
aCAqIChwU2Nybi0+Yml0c1BlclBpeGVsID4+IDMpKTsKLQlBdmFpbEZCQXJlYS54MSA9IDA7Ci0J
QXZhaWxGQkFyZWEueTEgPSAwOwotCUF2YWlsRkJBcmVhLngyID0gcFNjcm4tPmRpc3BsYXlXaWR0
aDsKLQlBdmFpbEZCQXJlYS55MiA9IGxpbmVzOwotCXhmODZJbml0RkJNYW5hZ2VyKHBTY3JlZW4s
ICZBdmFpbEZCQXJlYSk7IAotCQotCXhmODZEcnZNc2cocFNjcm4tPnNjcm5JbmRleCwgWF9JTkZP
LCAKLQkJICAgIlVzaW5nICVpIHNjYW5saW5lcyBvZiBvZmZzY3JlZW4gbWVtb3J5IFxuIgotCQkg
ICAsIGxpbmVzIC0gcFNjcm4tPnZpcnR1YWxZKTsKKworICAgICAgICBCb3hSZWMgQXZhaWxGQkFy
ZWE7CisgICAgICAgIGludCBsaW5lcyA9IHBTY3JuLT52aWRlb1JhbSAqIDEwMjQgLyAocFNjcm4t
PmRpc3BsYXlXaWR0aCAqIChwU2Nybi0+Yml0c1BlclBpeGVsID4+IDMpKTsKKyAgICAgICAgQXZh
aWxGQkFyZWEueDEgPSAwOworICAgICAgICBBdmFpbEZCQXJlYS55MSA9IDA7CisgICAgICAgIEF2
YWlsRkJBcmVhLngyID0gcFNjcm4tPmRpc3BsYXlXaWR0aDsKKyAgICAgICAgQXZhaWxGQkFyZWEu
eTIgPSBsaW5lczsKKyAgICAgICAgeGY4NkluaXRGQk1hbmFnZXIocFNjcmVlbiwgJkF2YWlsRkJB
cmVhKTsKKworICAgICAgICB4Zjg2RHJ2TXNnKHBTY3JuLT5zY3JuSW5kZXgsIFhfSU5GTywKKyAg
ICAgICAgICAgICAgICAgICAiVXNpbmcgJWkgc2NhbmxpbmVzIG9mIG9mZnNjcmVlbiBtZW1vcnkg
XG4iLCBsaW5lcyAtIHBTY3JuLT52aXJ0dWFsWSk7CiAgICAgfQogCiAgICAgeGY4NlNldEJhY2tp
bmdTdG9yZShwU2NyZWVuKTsKICAgICB4Zjg2U2V0U2lsa2VuTW91c2UocFNjcmVlbik7Ci0JCisK
ICAgICAvKiBJbml0aWFsaXNlIGN1cnNvciBmdW5jdGlvbnMgKi8KLSAgICBtaURDSW5pdGlhbGl6
ZSAocFNjcmVlbiwgeGY4NkdldFBvaW50ZXJTY3JlZW5GdW5jcygpKTsKKyAgICBtaURDSW5pdGlh
bGl6ZShwU2NyZWVuLCB4Zjg2R2V0UG9pbnRlclNjcmVlbkZ1bmNzKCkpOwogCiAKICAgICBpZiAo
IWRQdHItPnN3Q3Vyc29yKSB7Ci0gICAgICAvKiBIVyBjdXJzb3IgZnVuY3Rpb25zICovCi0gICAg
ICBpZiAoIURVTU1ZQ3Vyc29ySW5pdChwU2NyZWVuKSkgewotCSAgeGY4NkRydk1zZyhwU2Nybi0+
c2NybkluZGV4LCBYX0VSUk9SLAotCQkgICAgICJIYXJkd2FyZSBjdXJzb3IgaW5pdGlhbGl6YXRp
b24gZmFpbGVkXG4iKTsKLQkgIHJldHVybiBGQUxTRTsKLSAgICAgIH0KKyAgICAgICAgLyogSFcg
Y3Vyc29yIGZ1bmN0aW9ucyAqLworICAgICAgICBpZiAoIURVTU1ZQ3Vyc29ySW5pdChwU2NyZWVu
KSkgeworICAgICAgICAgICAgeGY4NkRydk1zZyhwU2Nybi0+c2NybkluZGV4LCBYX0VSUk9SLCAi
SGFyZHdhcmUgY3Vyc29yIGluaXRpYWxpemF0aW9uIGZhaWxlZFxuIik7CisgICAgICAgICAgICBy
ZXR1cm4gRkFMU0U7CisgICAgICAgIH0KICAgICB9Ci0gICAgCisKICAgICAvKiBJbml0aWFsaXNl
IGRlZmF1bHQgY29sb3VybWFwICovCi0gICAgaWYoIW1pQ3JlYXRlRGVmQ29sb3JtYXAocFNjcmVl
bikpCi0JcmV0dXJuIEZBTFNFOworICAgIGlmICghbWlDcmVhdGVEZWZDb2xvcm1hcChwU2NyZWVu
KSkKKyAgICAgICAgcmV0dXJuIEZBTFNFOwogCiAgICAgaWYgKCF4Zjg2SGFuZGxlQ29sb3JtYXBz
KHBTY3JlZW4sIDEwMjQsIHBTY3JuLT5yZ2JCaXRzLAotICAgICAgICAgICAgICAgICAgICAgICAg
IERVTU1ZTG9hZFBhbGV0dGUsIE5VTEwsIAotICAgICAgICAgICAgICAgICAgICAgICAgIENNQVBf
UEFMRVRURURfVFJVRUNPTE9SIAotCQkJICAgICB8IENNQVBfUkVMT0FEX09OX01PREVfU1dJVENI
KSkKLQlyZXR1cm4gRkFMU0U7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERVTU1ZTG9h
ZFBhbGV0dGUsIE5VTEwsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENNQVBfUEFMRVRU
RURfVFJVRUNPTE9SIHwgQ01BUF9SRUxPQURfT05fTU9ERV9TV0lUQ0gpKQorICAgICAgICByZXR1
cm4gRkFMU0U7CiAKICAgICBwU2NyZWVuLT5TYXZlU2NyZWVuID0gRFVNTVlTYXZlU2NyZWVuOwog
Ci0gICAgCisKICAgICAvKiBXcmFwIHRoZSBjdXJyZW50IENsb3NlU2NyZWVuIGZ1bmN0aW9uICov
CiAgICAgZFB0ci0+Q2xvc2VTY3JlZW4gPSBwU2NyZWVuLT5DbG9zZVNjcmVlbjsKICAgICBwU2Ny
ZWVuLT5DbG9zZVNjcmVlbiA9IERVTU1ZQ2xvc2VTY3JlZW47CkBAIC02MjMsMjggKzU5NywyNSBA
QCBEVU1NWVNjcmVlbkluaXQoU0NSRUVOX0lOSVRfQVJHU19ERUNMKQogCiAgICAgLyogUmVwb3J0
IGFueSB1bnVzZWQgb3B0aW9ucyAob25seSBmb3IgdGhlIGZpcnN0IGdlbmVyYXRpb24pICovCiAg
ICAgaWYgKHNlcnZlckdlbmVyYXRpb24gPT0gMSkgewotCXhmODZTaG93VW51c2VkT3B0aW9ucyhw
U2Nybi0+c2NybkluZGV4LCBwU2Nybi0+b3B0aW9ucyk7CisgICAgICAgIHhmODZTaG93VW51c2Vk
T3B0aW9ucyhwU2Nybi0+c2NybkluZGV4LCBwU2Nybi0+b3B0aW9ucyk7CiAgICAgfQogCiAgICAg
cmV0dXJuIFRSVUU7CiB9CiAKIC8qIE1hbmRhdG9yeSAqLwotQm9vbAotRFVNTVlTd2l0Y2hNb2Rl
KFNXSVRDSF9NT0RFX0FSR1NfREVDTCkKK0Jvb2wgRFVNTVlTd2l0Y2hNb2RlKFNXSVRDSF9NT0RF
X0FSR1NfREVDTCkKIHsKICAgICByZXR1cm4gVFJVRTsKIH0KIAogLyogTWFuZGF0b3J5ICovCi12
b2lkCi1EVU1NWUFkanVzdEZyYW1lKEFESlVTVF9GUkFNRV9BUkdTX0RFQ0wpCit2b2lkIERVTU1Z
QWRqdXN0RnJhbWUoQURKVVNUX0ZSQU1FX0FSR1NfREVDTCkKIHsKIH0KIAogLyogTWFuZGF0b3J5
ICovCi1zdGF0aWMgQm9vbAotRFVNTVlDbG9zZVNjcmVlbihDTE9TRV9TQ1JFRU5fQVJHU19ERUNM
KQorc3RhdGljIEJvb2wgRFVNTVlDbG9zZVNjcmVlbihDTE9TRV9TQ1JFRU5fQVJHU19ERUNMKQog
ewogICAgIFNjcm5JbmZvUHRyIHBTY3JuID0geGY4NlNjcmVlblRvU2NybihwU2NyZWVuKTsKICAg
ICBEVU1NWVB0ciBkUHRyID0gRFVNTVlQVFIocFNjcm4pOwpAQCAtNjUyLDM5ICs2MjMsMzUgQEAg
RFVNTVlDbG9zZVNjcmVlbihDTE9TRV9TQ1JFRU5fQVJHU19ERUNMKQogICAgIGZyZWUocFNjcmVl
bi0+R2V0U2NyZWVuUGl4bWFwKHBTY3JlZW4pLT5kZXZQcml2YXRlLnB0cik7CiAKICAgICBpZiAo
ZFB0ci0+Q3Vyc29ySW5mbykKLQl4Zjg2RGVzdHJveUN1cnNvckluZm9SZWMoZFB0ci0+Q3Vyc29y
SW5mbyk7CisgICAgICAgIHhmODZEZXN0cm95Q3Vyc29ySW5mb1JlYyhkUHRyLT5DdXJzb3JJbmZv
KTsKIAogICAgIHBTY3JuLT52dFNlbWEgPSBGQUxTRTsKICAgICBwU2NyZWVuLT5DbG9zZVNjcmVl
biA9IGRQdHItPkNsb3NlU2NyZWVuOwotICAgIHJldHVybiAoKnBTY3JlZW4tPkNsb3NlU2NyZWVu
KShDTE9TRV9TQ1JFRU5fQVJHUyk7CisgICAgcmV0dXJuICgqcFNjcmVlbi0+Q2xvc2VTY3JlZW4p
IChDTE9TRV9TQ1JFRU5fQVJHUyk7CiB9CiAKIC8qIE9wdGlvbmFsICovCi1zdGF0aWMgdm9pZAot
RFVNTVlGcmVlU2NyZWVuKEZSRUVfU0NSRUVOX0FSR1NfREVDTCkKK3N0YXRpYyB2b2lkIERVTU1Z
RnJlZVNjcmVlbihGUkVFX1NDUkVFTl9BUkdTX0RFQ0wpCiB7CiAgICAgU0NSTl9JTkZPX1BUUihh
cmcpOwogICAgIERVTU1ZRnJlZVJlYyhwU2Nybik7CiB9CiAKLXN0YXRpYyBCb29sCi1EVU1NWVNh
dmVTY3JlZW4oU2NyZWVuUHRyIHBTY3JlZW4sIGludCBtb2RlKQorc3RhdGljIEJvb2wgRFVNTVlT
YXZlU2NyZWVuKFNjcmVlblB0ciBwU2NyZWVuLCBpbnQgbW9kZSkKIHsKICAgICByZXR1cm4gVFJV
RTsKIH0KIAogLyogT3B0aW9uYWwgKi8KLXN0YXRpYyBNb2RlU3RhdHVzCi1EVU1NWVZhbGlkTW9k
ZShTQ1JOX0FSR19UWVBFIGFyZywgRGlzcGxheU1vZGVQdHIgbW9kZSwgQm9vbCB2ZXJib3NlLCBp
bnQgZmxhZ3MpCitzdGF0aWMgTW9kZVN0YXR1cyBEVU1NWVZhbGlkTW9kZShTQ1JOX0FSR19UWVBF
IGFyZywgRGlzcGxheU1vZGVQdHIgbW9kZSwgQm9vbCB2ZXJib3NlLCBpbnQgZmxhZ3MpCiB7Ci0g
ICAgcmV0dXJuKE1PREVfT0spOworICAgIHJldHVybiAoTU9ERV9PSyk7CiB9CiAKLUF0b20gVkZC
X1BST1AgID0gMDsKK0F0b20gVkZCX1BST1AgPSAwOwogI2RlZmluZSAgVkZCX1BST1BfTkFNRSAg
IlZGQl9JREVOVCIKIAotc3RhdGljIEJvb2wKLURVTU1ZQ3JlYXRlV2luZG93KFdpbmRvd1B0ciBw
V2luKQorc3RhdGljIEJvb2wgRFVNTVlDcmVhdGVXaW5kb3coV2luZG93UHRyIHBXaW4pCiB7CiAg
ICAgU2NyZWVuUHRyIHBTY3JlZW4gPSBwV2luLT5kcmF3YWJsZS5wU2NyZWVuOwogICAgIERVTU1Z
UHRyIGRQdHIgPSBEVU1NWVBUUihEVU1NWVNjcm4pOwpAQCAtNjk2LDI2ICs2NjMsMjYgQEAgRFVN
TVlDcmVhdGVXaW5kb3coV2luZG93UHRyIHBXaW4pCiAgICAgZFB0ci0+Q3JlYXRlV2luZG93ID0g
cFNjcmVlbi0+Q3JlYXRlV2luZG93OwogICAgIHBTY3JlZW4tPkNyZWF0ZVdpbmRvdyA9IERVTU1Z
Q3JlYXRlV2luZG93OwogCi0gICAgaWYocmV0ICE9IFRSVUUpCi0JcmV0dXJuKHJldCk7Ci0JCi0g
ICAgaWYoZFB0ci0+cHJvcCA9PSBGQUxTRSkgeworICAgIGlmIChyZXQgIT0gVFJVRSkKKyAgICAg
ICAgcmV0dXJuIChyZXQpOworCisgICAgaWYgKGRQdHItPnByb3AgPT0gRkFMU0UpIHsKICNpZiBH
RVRfQUJJX01BSk9SKEFCSV9WSURFT0RSVl9WRVJTSU9OKSA8IDgKICAgICAgICAgcFdpblJvb3Qg
PSBXaW5kb3dUYWJsZVtEVU1NWVNjcm4tPnBTY3JlZW4tPm15TnVtXTsKICNlbHNlCiAgICAgICAg
IHBXaW5Sb290ID0gRFVNTVlTY3JuLT5wU2NyZWVuLT5yb290OwogI2VuZGlmCi0gICAgICAgIGlm
ICghIFZhbGlkQXRvbShWRkJfUFJPUCkpCisgICAgICAgIGlmICghVmFsaWRBdG9tKFZGQl9QUk9Q
KSkKICAgICAgICAgICAgIFZGQl9QUk9QID0gTWFrZUF0b20oVkZCX1BST1BfTkFNRSwgc3RybGVu
KFZGQl9QUk9QX05BTUUpLCAxKTsKIAogICAgICAgICByZXQgPSBkaXhDaGFuZ2VXaW5kb3dQcm9w
ZXJ0eShzZXJ2ZXJDbGllbnQsIHBXaW5Sb290LCBWRkJfUFJPUCwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgWEFfU1RSSU5HLCA4LCBQcm9wTW9kZVJlcGxhY2UsCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpbnQpNCwgKHBvaW50ZXIpIlRSVUUi
LCBGQUxTRSk7Ci0JaWYoIHJldCAhPSBTdWNjZXNzKQotCQlFcnJvckYoIkNvdWxkIG5vdCBzZXQg
VkZCIHJvb3Qgd2luZG93IHByb3BlcnR5Iik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIChpbnQpIDQsIChwb2ludGVyKSAiVFJVRSIsIEZBTFNFKTsKKyAgICAgICAgaWYg
KHJldCAhPSBTdWNjZXNzKQorICAgICAgICAgICAgRXJyb3JGKCJDb3VsZCBub3Qgc2V0IFZGQiBy
b290IHdpbmRvdyBwcm9wZXJ0eSIpOwogICAgICAgICBkUHRyLT5wcm9wID0gVFJVRTsKIAotCXJl
dHVybiBUUlVFOworICAgICAgICByZXR1cm4gVFJVRTsKICAgICB9CiAgICAgcmV0dXJuIFRSVUU7
CiB9CkBAIC03MjQsMTcgKzY5MSwxNiBAQCBEVU1NWUNyZWF0ZVdpbmRvdyhXaW5kb3dQdHIgcFdp
bikKICNkZWZpbmUgSFdfU0tJUF9DT05TT0xFIDQKICNlbmRpZgogCi1zdGF0aWMgQm9vbAotZHVt
bXlEcml2ZXJGdW5jKFNjcm5JbmZvUHRyIHBTY3JuLCB4b3JnRHJpdmVyRnVuY09wIG9wLCBwb2lu
dGVyIHB0cikKK3N0YXRpYyBCb29sIGR1bW15RHJpdmVyRnVuYyhTY3JuSW5mb1B0ciBwU2Nybiwg
eG9yZ0RyaXZlckZ1bmNPcCBvcCwgcG9pbnRlciBwdHIpCiB7CiAgICAgQ0FSRDMyICpmbGFnOwot
ICAgIAorCiAgICAgc3dpdGNoIChvcCkgewotCWNhc2UgR0VUX1JFUVVJUkVEX0hXX0lOVEVSRkFD
RVM6Ci0JICAgIGZsYWcgPSAoQ0FSRDMyKilwdHI7Ci0JICAgICgqZmxhZykgPSBIV19TS0lQX0NP
TlNPTEU7Ci0JICAgIHJldHVybiBUUlVFOwotCWRlZmF1bHQ6Ci0JICAgIHJldHVybiBGQUxTRTsK
KyAgICAgICAgY2FzZSBHRVRfUkVRVUlSRURfSFdfSU5URVJGQUNFUzoKKyAgICAgICAgICAgIGZs
YWcgPSAoQ0FSRDMyICopIHB0cjsKKyAgICAgICAgICAgICgqZmxhZykgPSBIV19TS0lQX0NPTlNP
TEU7CisgICAgICAgICAgICByZXR1cm4gVFJVRTsKKyAgICAgICAgZGVmYXVsdDoKKyAgICAgICAg
ICAgIHJldHVybiBGQUxTRTsKICAgICB9CiB9Ci0tIAoyLjExLjAKCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClNwaWNlLWRldmVsIG1haWxpbmcgbGlzdApT
cGljZS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9zcGljZS1kZXZlbA==
