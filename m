Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 66E257322F
	for <lists+spice-devel@lfdr.de>; Wed, 24 Jul 2019 16:52:22 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A14946E5C0;
	Wed, 24 Jul 2019 14:52:20 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 540FC6E5C0
 for <spice-devel@lists.freedesktop.org>; Wed, 24 Jul 2019 14:52:19 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx08.intmail.prod.int.phx2.redhat.com
 [10.5.11.23])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id BE504308FC4E;
 Wed, 24 Jul 2019 14:52:18 +0000 (UTC)
Received: from colo-mx.corp.redhat.com
 (colo-mx01.intmail.prod.int.phx2.redhat.com [10.5.11.20])
 by smtp.corp.redhat.com (Postfix) with ESMTPS id AF7D619C67;
 Wed, 24 Jul 2019 14:52:18 +0000 (UTC)
Received: from zmail25.collab.prod.int.phx2.redhat.com
 (zmail25.collab.prod.int.phx2.redhat.com [10.5.83.31])
 by colo-mx.corp.redhat.com (Postfix) with ESMTP id A2BEA1800202;
 Wed, 24 Jul 2019 14:52:18 +0000 (UTC)
Date: Wed, 24 Jul 2019 10:52:18 -0400 (EDT)
From: Frediano Ziglio <fziglio@redhat.com>
To: Jeremy White <jwhite@codeweavers.com>
Message-ID: <1311750248.2814920.1563979938480.JavaMail.zimbra@redhat.com>
In-Reply-To: <20190724141726.32063-2-jwhite@codeweavers.com>
References: <20190724141726.32063-1-jwhite@codeweavers.com>
 <20190724141726.32063-2-jwhite@codeweavers.com>
MIME-Version: 1.0
X-Originating-IP: [10.33.32.9, 10.4.195.20]
Thread-Topic: Simplify string options and make sure they are freed when
 replaced.
Thread-Index: gjEAVqWjch1uNu8MA+noEk6S2uXzqQ==
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.23
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.43]); Wed, 24 Jul 2019 14:52:18 +0000 (UTC)
Subject: Re: [Spice-devel] [PATCH fixup1 x11spice 1/3] Simplify string
 options and make sure they are freed when replaced.
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: spice-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

Cj4gCj4gVGhpcyBpcyBsYXJnZWx5IHRoZSB3b3JrIG9mIEZyZWRpYW5vIFppZ2xpbyA8ZnppZ2xp
b0ByZWRoYXQuY29tPi4KPiAKPiBTaWduZWQtb2ZmLWJ5OiBKZXJlbXkgV2hpdGUgPGp3aGl0ZUBj
b2Rld2VhdmVycy5jb20+CgpGaW5lIGZvciBtZSwgYWNrCgo+IC0tLQo+ICBzcmMvb3B0aW9ucy5j
IHwgMTE4ICsrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
Cj4gIDEgZmlsZSBjaGFuZ2VkLCA1NCBpbnNlcnRpb25zKCspLCA2NCBkZWxldGlvbnMoLSkKPiAK
PiBkaWZmIC0tZ2l0IGEvc3JjL29wdGlvbnMuYyBiL3NyYy9vcHRpb25zLmMKPiBpbmRleCA2YzZl
Y2I0ZS4uY2ZmNGFjMTcgMTAwNjQ0Cj4gLS0tIGEvc3JjL29wdGlvbnMuYwo+ICsrKyBiL3NyYy9v
cHRpb25zLmMKPiBAQCAtNDUsNTQgKzQ1LDQ2IEBACj4gICNpbmNsdWRlIDxsaWJhdWRpdC5oPgo+
ICAjZW5kaWYKPiAgCj4gK3N0YXRpYyB2b2lkIHN0cl9yZXBsYWNlKGNoYXIgKipkZXN0LCBjb25z
dCBjaGFyICpzcmMpCj4gK3sKPiArICAgIGdfZnJlZSgqZGVzdCk7Cj4gKyAgICAqZGVzdCA9IHNy
YyA/IGdfc3RyZHVwKHNyYykgOiBOVUxMOwo+ICt9Cj4gKwo+ICB2b2lkIG9wdGlvbnNfaW5pdChv
cHRpb25zX3QgKm9wdGlvbnMpCj4gIHsKPiAgICAgIG1lbXNldChvcHRpb25zLCAwLCBzaXplb2Yo
Km9wdGlvbnMpKTsKPiAgfQo+ICAKPiAtdm9pZCBzc2xfb3B0aW9uc19mcmVlKHNzbF9vcHRpb25z
X3QgKnNzbCkKPiArc3RhdGljIHZvaWQgc3NsX29wdGlvbnNfZnJlZShzc2xfb3B0aW9uc190ICpz
c2wpCj4gIHsKPiAtICAgIGdfZnJlZShzc2wtPmNhX2NlcnRfZmlsZSk7Cj4gLSAgICBnX2ZyZWUo
c3NsLT5jZXJ0c19maWxlKTsKPiAtICAgIGdfZnJlZShzc2wtPnByaXZhdGVfa2V5X2ZpbGUpOwo+
IC0gICAgZ19mcmVlKHNzbC0+a2V5X3Bhc3N3b3JkKTsKPiAtICAgIGdfZnJlZShzc2wtPmRoX2tl
eV9maWxlKTsKPiAtICAgIGdfZnJlZShzc2wtPmNpcGhlcnN1aXRlKTsKPiAtICAgICpzc2wgPSAo
c3NsX29wdGlvbnNfdCkgeyAwIH07Cj4gKyAgICBzdHJfcmVwbGFjZSgmc3NsLT5jYV9jZXJ0X2Zp
bGUsIE5VTEwpOwo+ICsgICAgc3RyX3JlcGxhY2UoJnNzbC0+Y2VydHNfZmlsZSwgTlVMTCk7Cj4g
KyAgICBzdHJfcmVwbGFjZSgmc3NsLT5wcml2YXRlX2tleV9maWxlLCBOVUxMKTsKPiArICAgIHN0
cl9yZXBsYWNlKCZzc2wtPmtleV9wYXNzd29yZCwgTlVMTCk7Cj4gKyAgICBzdHJfcmVwbGFjZSgm
c3NsLT5kaF9rZXlfZmlsZSwgTlVMTCk7Cj4gKyAgICBzdHJfcmVwbGFjZSgmc3NsLT5jaXBoZXJz
dWl0ZSwgTlVMTCk7Cj4gIH0KPiAgCj4gIHZvaWQgb3B0aW9uc19mcmVlKG9wdGlvbnNfdCAqb3B0
aW9ucykKPiAgewo+IC0gICAgZ19mcmVlKG9wdGlvbnMtPmRpc3BsYXkpOwo+IC0gICAgb3B0aW9u
cy0+ZGlzcGxheSA9IE5VTEw7Cj4gLSAgICBnX2ZyZWUob3B0aW9ucy0+bGlzdGVuKTsKPiAtICAg
IG9wdGlvbnMtPmxpc3RlbiA9IE5VTEw7Cj4gKyAgICBzdHJfcmVwbGFjZSgmb3B0aW9ucy0+ZGlz
cGxheSwgTlVMTCk7Cj4gKyAgICBzdHJfcmVwbGFjZSgmb3B0aW9ucy0+bGlzdGVuLCBOVUxMKTsK
PiAgCj4gICAgICBzc2xfb3B0aW9uc19mcmVlKCZvcHRpb25zLT5zc2wpOwo+IC0KPiAtICAgIGdf
ZnJlZShvcHRpb25zLT5zcGljZV9wYXNzd29yZCk7Cj4gLSAgICBvcHRpb25zLT5zcGljZV9wYXNz
d29yZCA9IE5VTEw7Cj4gLSAgICBnX2ZyZWUob3B0aW9ucy0+cGFzc3dvcmRfZmlsZSk7Cj4gLSAg
ICBvcHRpb25zLT5wYXNzd29yZF9maWxlID0gTlVMTDsKPiAtCj4gLSAgICBnX2ZyZWUob3B0aW9u
cy0+dmlydGlvX3BhdGgpOwo+IC0gICAgb3B0aW9ucy0+dmlydGlvX3BhdGggPSBOVUxMOwo+IC0g
ICAgZ19mcmVlKG9wdGlvbnMtPnVpbnB1dF9wYXRoKTsKPiAtICAgIG9wdGlvbnMtPnVpbnB1dF9w
YXRoID0gTlVMTDsKPiAtICAgIGdfZnJlZShvcHRpb25zLT5vbl9jb25uZWN0KTsKPiAtICAgIG9w
dGlvbnMtPm9uX2Nvbm5lY3QgPSBOVUxMOwo+IC0gICAgZ19mcmVlKG9wdGlvbnMtPm9uX2Rpc2Nv
bm5lY3QpOwo+IC0gICAgb3B0aW9ucy0+b25fZGlzY29ubmVjdCA9IE5VTEw7Cj4gLQo+IC0gICAg
Z19mcmVlKG9wdGlvbnMtPnVzZXJfY29uZmlnX2ZpbGUpOwo+IC0gICAgb3B0aW9ucy0+dXNlcl9j
b25maWdfZmlsZSA9IE5VTEw7Cj4gLQo+IC0gICAgZ19mcmVlKG9wdGlvbnMtPnN5c3RlbV9jb25m
aWdfZmlsZSk7Cj4gLSAgICBvcHRpb25zLT5zeXN0ZW1fY29uZmlnX2ZpbGUgPSBOVUxMOwo+ICsg
ICAgc3RyX3JlcGxhY2UoJm9wdGlvbnMtPnNwaWNlX3Bhc3N3b3JkLCBOVUxMKTsKPiArICAgIHN0
cl9yZXBsYWNlKCZvcHRpb25zLT5wYXNzd29yZF9maWxlLCBOVUxMKTsKPiArCj4gKyAgICBzdHJf
cmVwbGFjZSgmb3B0aW9ucy0+dmlydGlvX3BhdGgsIE5VTEwpOwo+ICsgICAgc3RyX3JlcGxhY2Uo
Jm9wdGlvbnMtPnVpbnB1dF9wYXRoLCBOVUxMKTsKPiArICAgIHN0cl9yZXBsYWNlKCZvcHRpb25z
LT5vbl9jb25uZWN0LCBOVUxMKTsKPiArICAgIHN0cl9yZXBsYWNlKCZvcHRpb25zLT5vbl9kaXNj
b25uZWN0LCBOVUxMKTsKPiArICAgIHN0cl9yZXBsYWNlKCZvcHRpb25zLT51c2VyX2NvbmZpZ19m
aWxlLCBOVUxMKTsKPiArICAgIHN0cl9yZXBsYWNlKCZvcHRpb25zLT5zeXN0ZW1fY29uZmlnX2Zp
bGUsIE5VTEwpOwo+ICB9Cj4gIAo+ICAKPiAtc3RhdGljIGdjaGFyICpzdHJpbmdfb3B0aW9uKEdL
ZXlGaWxlICp1LCBHS2V5RmlsZSAqcywgY29uc3QgZ2NoYXIgKnNlY3Rpb24sCj4gY29uc3QgZ2No
YXIgKmtleSkKPiArc3RhdGljIHZvaWQgc3RyaW5nX29wdGlvbihnY2hhciAqKmRlc3QsIEdLZXlG
aWxlICp1LCBHS2V5RmlsZSAqcywgY29uc3QKPiBnY2hhciAqc2VjdGlvbiwgY29uc3QgZ2NoYXIg
KmtleSkKPiAgewo+ICAgICAgZ2NoYXIgKnJldCA9IE5VTEw7Cj4gICAgICBHRXJyb3IgKmVycm9y
ID0gTlVMTDsKPiBAQCAtMTA0LDcgKzk2LDggQEAgc3RhdGljIGdjaGFyICpzdHJpbmdfb3B0aW9u
KEdLZXlGaWxlICp1LCBHS2V5RmlsZSAqcywKPiBjb25zdCBnY2hhciAqc2VjdGlvbiwgY29ucwo+
ICAgICAgaWYgKGVycm9yKQo+ICAgICAgICAgIGdfZXJyb3JfZnJlZShlcnJvcik7Cj4gIAo+IC0g
ICAgcmV0dXJuIHJldDsKPiArICAgIGdfZnJlZSgqZGVzdCk7Cj4gKyAgICAqZGVzdCA9IHJldDsK
PiAgfQo+ICAKPiAgc3RhdGljIGdpbnQgaW50X29wdGlvbihHS2V5RmlsZSAqdSwgR0tleUZpbGUg
KnMsIGNvbnN0IGdjaGFyICpzZWN0aW9uLCBjb25zdAo+ICBnY2hhciAqa2V5KQo+IEBAIC0xNzUs
MzEgKzE2OCwyOCBAQCBpbnQgb3B0aW9uc19oYW5kbGVfc3NsKG9wdGlvbnNfdCAqb3B0aW9ucywg
Y29uc3QgY2hhcgo+ICpzcGVjKQo+ICAgICAgaW50IGkgPSAwOwo+ICAgICAgaW50IHJjID0gMDsK
PiAgCj4gLSAgICBpZiAoIWluKQo+IC0gICAgICAgIHJldHVybiBYMTFTUElDRV9FUlJfTUFMTE9D
Owo+IC0KPiAgICAgIGZvciAocCA9IHN0cnRva19yKGluLCAiLCIsICZzYXZlKTsgcDsgcCA9IHN0
cnRva19yKE5VTEwsICIsIiwgJnNhdmUpLAo+ICAgICAgaSsrKSB7Cj4gICAgICAgICAgaWYgKHN0
cmxlbihwKSA9PSAwKQo+ICAgICAgICAgICAgICBjb250aW51ZTsKPiAgCj4gICAgICAgICAgc3dp
dGNoKGkpIHsKPiAgICAgICAgICAgICAgY2FzZSAwOgo+IC0gICAgICAgICAgICAgICAgb3B0aW9u
cy0+c3NsLmNhX2NlcnRfZmlsZSA9IGdfc3RyZHVwKHApOwo+ICsgICAgICAgICAgICAgICAgc3Ry
X3JlcGxhY2UoJm9wdGlvbnMtPnNzbC5jYV9jZXJ0X2ZpbGUsIHApOwo+ICAgICAgICAgICAgICAg
ICAgYnJlYWs7Cj4gICAgICAgICAgICAgIGNhc2UgMToKPiAtICAgICAgICAgICAgICAgIG9wdGlv
bnMtPnNzbC5jZXJ0c19maWxlID0gZ19zdHJkdXAocCk7Cj4gKyAgICAgICAgICAgICAgICBzdHJf
cmVwbGFjZSgmb3B0aW9ucy0+c3NsLmNlcnRzX2ZpbGUsIHApOwo+ICAgICAgICAgICAgICAgICAg
YnJlYWs7Cj4gICAgICAgICAgICAgIGNhc2UgMjoKPiAtICAgICAgICAgICAgICAgIG9wdGlvbnMt
PnNzbC5wcml2YXRlX2tleV9maWxlID0gZ19zdHJkdXAocCk7Cj4gKyAgICAgICAgICAgICAgICBz
dHJfcmVwbGFjZSgmb3B0aW9ucy0+c3NsLnByaXZhdGVfa2V5X2ZpbGUsIHApOwo+ICAgICAgICAg
ICAgICAgICAgYnJlYWs7Cj4gICAgICAgICAgICAgIGNhc2UgMzoKPiAtICAgICAgICAgICAgICAg
IG9wdGlvbnMtPnNzbC5rZXlfcGFzc3dvcmQgPSBnX3N0cmR1cChwKTsKPiArICAgICAgICAgICAg
ICAgIHN0cl9yZXBsYWNlKCZvcHRpb25zLT5zc2wua2V5X3Bhc3N3b3JkLCBwKTsKPiAgICAgICAg
ICAgICAgICAgIGJyZWFrOwo+ICAgICAgICAgICAgICBjYXNlIDQ6Cj4gLSAgICAgICAgICAgICAg
ICBvcHRpb25zLT5zc2wuZGhfa2V5X2ZpbGUgPSBnX3N0cmR1cChwKTsKPiArICAgICAgICAgICAg
ICAgIHN0cl9yZXBsYWNlKCZvcHRpb25zLT5zc2wuZGhfa2V5X2ZpbGUsIHApOwo+ICAgICAgICAg
ICAgICAgICAgYnJlYWs7Cj4gICAgICAgICAgICAgIGNhc2UgNToKPiAtICAgICAgICAgICAgICAg
IG9wdGlvbnMtPnNzbC5jaXBoZXJzdWl0ZSA9IGdfc3RyZHVwKHApOwo+ICsgICAgICAgICAgICAg
ICAgc3RyX3JlcGxhY2UoJm9wdGlvbnMtPnNzbC5jaXBoZXJzdWl0ZSwgcCk7Cj4gICAgICAgICAg
ICAgICAgICBicmVhazsKPiAgICAgICAgICAgICAgZGVmYXVsdDoKPiAgICAgICAgICAgICAgICAg
IGZwcmludGYoc3RkZXJyLCAiRXJyb3I6IGludmFsaWQgc3NsIHNwZWNpZmljYXRpb24uIik7Cj4g
QEAgLTIxNiwxMiArMjA2LDEyIEBAIHZvaWQgb3B0aW9uc19oYW5kbGVfc3NsX2ZpbGVfb3B0aW9u
cyhvcHRpb25zX3QKPiAqb3B0aW9ucywKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIEdLZXlGaWxlICp1c2Vya2V5LCBHS2V5RmlsZSAqc3lzdGVta2V5KQo+ICB7Cj4gICAg
ICBvcHRpb25zLT5zc2wuZW5hYmxlZCA9IGJvb2xfb3B0aW9uKHVzZXJrZXksIHN5c3RlbWtleSwg
InNzbCIsCj4gICAgICAiZW5hYmxlZCIpOwo+IC0gICAgb3B0aW9ucy0+c3NsLmNhX2NlcnRfZmls
ZSA9IHN0cmluZ19vcHRpb24odXNlcmtleSwgc3lzdGVta2V5LCAic3NsIiwKPiAiY2EtY2VydC1m
aWxlIik7Cj4gLSAgICBvcHRpb25zLT5zc2wuY2VydHNfZmlsZSA9IHN0cmluZ19vcHRpb24odXNl
cmtleSwgc3lzdGVta2V5LCAic3NsIiwKPiAiY2VydHMtZmlsZSIpOwo+IC0gICAgb3B0aW9ucy0+
c3NsLnByaXZhdGVfa2V5X2ZpbGUgPSBzdHJpbmdfb3B0aW9uKHVzZXJrZXksIHN5c3RlbWtleSwg
InNzbCIsCj4gInByaXZhdGUta2V5LWZpbGUiKTsKPiAtICAgIG9wdGlvbnMtPnNzbC5rZXlfcGFz
c3dvcmQgPSBzdHJpbmdfb3B0aW9uKHVzZXJrZXksIHN5c3RlbWtleSwgInNzbCIsCj4gImtleS1w
YXNzd29yZC1maWxlIik7Cj4gLSAgICBvcHRpb25zLT5zc2wuZGhfa2V5X2ZpbGUgPSBzdHJpbmdf
b3B0aW9uKHVzZXJrZXksIHN5c3RlbWtleSwgInNzbCIsCj4gImRoLWtleS1maWxlIik7Cj4gLSAg
ICBvcHRpb25zLT5zc2wuY2lwaGVyc3VpdGUgPSBzdHJpbmdfb3B0aW9uKHVzZXJrZXksIHN5c3Rl
bWtleSwgInNzbCIsCj4gImNpcGhlcnN1aXRlIik7Cj4gKyAgICBzdHJpbmdfb3B0aW9uKCZvcHRp
b25zLT5zc2wuY2FfY2VydF9maWxlLCB1c2Vya2V5LCBzeXN0ZW1rZXksICJzc2wiLAo+ICJjYS1j
ZXJ0LWZpbGUiKTsKPiArICAgIHN0cmluZ19vcHRpb24oJm9wdGlvbnMtPnNzbC5jZXJ0c19maWxl
LCB1c2Vya2V5LCBzeXN0ZW1rZXksICJzc2wiLAo+ICJjZXJ0cy1maWxlIik7Cj4gKyAgICBzdHJp
bmdfb3B0aW9uKCZvcHRpb25zLT5zc2wucHJpdmF0ZV9rZXlfZmlsZSwgdXNlcmtleSwgc3lzdGVt
a2V5LCAic3NsIiwKPiAicHJpdmF0ZS1rZXktZmlsZSIpOwo+ICsgICAgc3RyaW5nX29wdGlvbigm
b3B0aW9ucy0+c3NsLmtleV9wYXNzd29yZCwgdXNlcmtleSwgc3lzdGVta2V5LCAic3NsIiwKPiAi
a2V5LXBhc3N3b3JkLWZpbGUiKTsKPiArICAgIHN0cmluZ19vcHRpb24oJm9wdGlvbnMtPnNzbC5k
aF9rZXlfZmlsZSwgdXNlcmtleSwgc3lzdGVta2V5LCAic3NsIiwKPiAiZGgta2V5LWZpbGUiKTsK
PiArICAgIHN0cmluZ19vcHRpb24oJm9wdGlvbnMtPnNzbC5jaXBoZXJzdWl0ZSwgdXNlcmtleSwg
c3lzdGVta2V5LCAic3NsIiwKPiAiY2lwaGVyc3VpdGUiKTsKPiAgfQo+ICAKPiAgdm9pZCBvcHRp
b25zX2hhbmRsZV91c2VyX2NvbmZpZyhpbnQgYXJnYywgY2hhciAqYXJndltdLCBvcHRpb25zX3Qg
Km9wdGlvbnMpCj4gQEAgLTI4OSwxNSArMjc5LDE1IEBAIGludCBvcHRpb25zX3BhcnNlX2FyZ3Vt
ZW50cyhpbnQgYXJnYywgY2hhciAqYXJndltdLAo+IG9wdGlvbnNfdCAqb3B0aW9ucykKPiAgICAg
ICAgICAgICAgICAgIGJyZWFrOwo+ICAKPiAgICAgICAgICAgICAgY2FzZSBPUFRJT05fUEFTU1dP
UkQ6Cj4gLSAgICAgICAgICAgICAgICBvcHRpb25zLT5zcGljZV9wYXNzd29yZCA9IGdfc3RyZHVw
KG9wdGFyZyk7Cj4gKyAgICAgICAgICAgICAgICBzdHJfcmVwbGFjZSgmb3B0aW9ucy0+c3BpY2Vf
cGFzc3dvcmQsIG9wdGFyZyk7Cj4gICAgICAgICAgICAgICAgICBicmVhazsKPiAgCj4gICAgICAg
ICAgICAgIGNhc2UgT1BUSU9OX1BBU1NXT1JEX0ZJTEU6Cj4gLSAgICAgICAgICAgICAgICBvcHRp
b25zLT5wYXNzd29yZF9maWxlID0gZ19zdHJkdXAob3B0YXJnKTsKPiArICAgICAgICAgICAgICAg
IHN0cl9yZXBsYWNlKCZvcHRpb25zLT5wYXNzd29yZF9maWxlLCBvcHRhcmcpOwo+ICAgICAgICAg
ICAgICAgICAgYnJlYWs7Cj4gIAo+ICAgICAgICAgICAgICBjYXNlIE9QVElPTl9DT05GSUc6Cj4g
LSAgICAgICAgICAgICAgICAvKiBUaGlzIHdhcyBoYW5kbGVkIHByZXZpb3VzbHk7IHdlIGNhbiBp
Z25vcmUgKi8KPiArICAgICAgICAgICAgICAgIHN0cl9yZXBsYWNlKCZvcHRpb25zLT51c2VyX2Nv
bmZpZ19maWxlLCBvcHRhcmcpOwo+ICAgICAgICAgICAgICAgICAgYnJlYWs7Cj4gIAo+ICAgICAg
ICAgICAgICBjYXNlIE9QVElPTl9TU0w6Cj4gQEAgLTMxNiw3ICszMDYsNyBAQCBpbnQgb3B0aW9u
c19wYXJzZV9hcmd1bWVudHMoaW50IGFyZ2MsIGNoYXIgKmFyZ3ZbXSwKPiBvcHRpb25zX3QgKm9w
dGlvbnMpCj4gICAgICAgICAgICAgICAgICBicmVhazsKPiAgCj4gICAgICAgICAgICAgIGNhc2Ug
T1BUSU9OX0RJU1BMQVk6Cj4gLSAgICAgICAgICAgICAgICBvcHRpb25zLT5kaXNwbGF5ID0gZ19z
dHJkdXAob3B0YXJnKTsKPiArICAgICAgICAgICAgICAgIHN0cl9yZXBsYWNlKCZvcHRpb25zLT5k
aXNwbGF5LCBvcHRhcmcpOwo+ICAgICAgICAgICAgICAgICAgYnJlYWs7Cj4gIAo+ICAgICAgICAg
ICAgICBjYXNlIE9QVElPTl9NSU5JTUlaRToKPiBAQCAtMzQ2LDEyICszMzYsMTIgQEAgaW50IG9w
dGlvbnNfcGFyc2VfYXJndW1lbnRzKGludCBhcmdjLCBjaGFyICphcmd2W10sCj4gb3B0aW9uc190
ICpvcHRpb25zKQo+ICAgICAgaWYgKHJjID09IDApIHsKPiAgICAgICAgICBpZiAob3B0aW5kID49
IGFyZ2MpIHsKPiAgICAgICAgICAgICAgLyogRGVmYXVsdCAqLwo+IC0gICAgICAgICAgICBvcHRp
b25zLT5saXN0ZW4gPSBnX3N0cmR1cCgiNTkwMCIpOwo+ICsgICAgICAgICAgICBzdHJfcmVwbGFj
ZSgmb3B0aW9ucy0+bGlzdGVuLCAiNTkwMCIpOwo+ICAgICAgICAgIH0gZWxzZSBpZiAob3B0aW5k
IDwgKGFyZ2MgLSAxKSkgewo+ICAgICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIkVycm9yOiB0
b28gbWFueSBhcmd1bWVudHNcbiIpOwo+ICAgICAgICAgICAgICByYyA9IFgxMVNQSUNFX0VSUl9C
QURBUkdTOwo+ICAgICAgICAgIH0gZWxzZSB7Cj4gLSAgICAgICAgICAgIG9wdGlvbnMtPmxpc3Rl
biA9IGdfc3RyZHVwKGFyZ3Zbb3B0aW5kXSk7Cj4gKyAgICAgICAgICAgIHN0cl9yZXBsYWNlKCZv
cHRpb25zLT5saXN0ZW4sIGFyZ3Zbb3B0aW5kXSk7Cj4gICAgICAgICAgfQo+ICAgICAgfQo+ICAK
PiBAQCAtMzg2LDE3ICszNzYsMTcgQEAgdm9pZCBvcHRpb25zX2Zyb21fY29uZmlnKG9wdGlvbnNf
dCAqb3B0aW9ucykKPiAgICAgIG9wdGlvbnMtPmFsbG93X2NvbnRyb2wgPSBib29sX29wdGlvbih1
c2Vya2V5LCBzeXN0ZW1rZXksICJzcGljZSIsCj4gICAgICAiYWxsb3ctY29udHJvbCIpOwo+ICAg
ICAgb3B0aW9ucy0+Z2VuZXJhdGVfcGFzc3dvcmQgPSBpbnRfb3B0aW9uKHVzZXJrZXksIHN5c3Rl
bWtleSwgInNwaWNlIiwKPiAgICAgICJnZW5lcmF0ZS1wYXNzd29yZCIpOwo+ICAgICAgb3B0aW9u
cy0+aGlkZSA9IGJvb2xfb3B0aW9uKHVzZXJrZXksIHN5c3RlbWtleSwgInNwaWNlIiwgImhpZGUi
KTsKPiAtICAgIG9wdGlvbnMtPmRpc3BsYXkgPSBzdHJpbmdfb3B0aW9uKHVzZXJrZXksIHN5c3Rl
bWtleSwgInNwaWNlIiwKPiAiZGlzcGxheSIpOwo+ICsgICAgc3RyaW5nX29wdGlvbigmb3B0aW9u
cy0+ZGlzcGxheSwgdXNlcmtleSwgc3lzdGVta2V5LCAic3BpY2UiLAo+ICJkaXNwbGF5Iik7Cj4g
IAo+IC0gICAgb3B0aW9ucy0+bGlzdGVuID0gc3RyaW5nX29wdGlvbih1c2Vya2V5LCBzeXN0ZW1r
ZXksICJzcGljZSIsICJsaXN0ZW4iKTsKPiAtICAgIG9wdGlvbnMtPnNwaWNlX3Bhc3N3b3JkID0g
c3RyaW5nX29wdGlvbih1c2Vya2V5LCBzeXN0ZW1rZXksICJzcGljZSIsCj4gInBhc3N3b3JkIik7
Cj4gLSAgICBvcHRpb25zLT5wYXNzd29yZF9maWxlID0gc3RyaW5nX29wdGlvbih1c2Vya2V5LCBz
eXN0ZW1rZXksICJzcGljZSIsCj4gInBhc3N3b3JkLWZpbGUiKTsKPiArICAgIHN0cmluZ19vcHRp
b24oJm9wdGlvbnMtPmxpc3RlbiwgdXNlcmtleSwgc3lzdGVta2V5LCAic3BpY2UiLCAibGlzdGVu
Iik7Cj4gKyAgICBzdHJpbmdfb3B0aW9uKCZvcHRpb25zLT5zcGljZV9wYXNzd29yZCwgdXNlcmtl
eSwgc3lzdGVta2V5LCAic3BpY2UiLAo+ICJwYXNzd29yZCIpOwo+ICsgICAgc3RyaW5nX29wdGlv
bigmb3B0aW9ucy0+cGFzc3dvcmRfZmlsZSwgdXNlcmtleSwgc3lzdGVta2V5LCAic3BpY2UiLAo+
ICJwYXNzd29yZC1maWxlIik7Cj4gICAgICBvcHRpb25zLT5kaXNhYmxlX3RpY2tldGluZyA9IGJv
b2xfb3B0aW9uKHVzZXJrZXksIHN5c3RlbWtleSwgInNwaWNlIiwKPiAgICAgICJkaXNhYmxlLXRp
Y2tldGluZyIpOwo+ICAgICAgb3B0aW9ucy0+ZXhpdF9vbl9kaXNjb25uZWN0ID0gYm9vbF9vcHRp
b24odXNlcmtleSwgc3lzdGVta2V5LCAic3BpY2UiLAo+ICAgICAgImV4aXQtb24tZGlzY29ubmVj
dCIpOwo+IC0gICAgb3B0aW9ucy0+dmlydGlvX3BhdGggPSBzdHJpbmdfb3B0aW9uKHVzZXJrZXks
IHN5c3RlbWtleSwgInNwaWNlIiwKPiAidmlydGlvLXBhdGgiKTsKPiAtICAgIG9wdGlvbnMtPnVp
bnB1dF9wYXRoID0gc3RyaW5nX29wdGlvbih1c2Vya2V5LCBzeXN0ZW1rZXksICJzcGljZSIsCj4g
InVpbnB1dC1wYXRoIik7Cj4gLSAgICBvcHRpb25zLT5vbl9jb25uZWN0ID0gc3RyaW5nX29wdGlv
bih1c2Vya2V5LCBzeXN0ZW1rZXksICJzcGljZSIsCj4gIm9uLWNvbm5lY3QiKTsKPiAtICAgIG9w
dGlvbnMtPm9uX2Rpc2Nvbm5lY3QgPSBzdHJpbmdfb3B0aW9uKHVzZXJrZXksIHN5c3RlbWtleSwg
InNwaWNlIiwKPiAib24tZGlzY29ubmVjdCIpOwo+ICsgICAgc3RyaW5nX29wdGlvbigmb3B0aW9u
cy0+dmlydGlvX3BhdGgsIHVzZXJrZXksIHN5c3RlbWtleSwgInNwaWNlIiwKPiAidmlydGlvLXBh
dGgiKTsKPiArICAgIHN0cmluZ19vcHRpb24oJm9wdGlvbnMtPnVpbnB1dF9wYXRoLCB1c2Vya2V5
LCBzeXN0ZW1rZXksICJzcGljZSIsCj4gInVpbnB1dC1wYXRoIik7Cj4gKyAgICBzdHJpbmdfb3B0
aW9uKCZvcHRpb25zLT5vbl9jb25uZWN0LCB1c2Vya2V5LCBzeXN0ZW1rZXksICJzcGljZSIsCj4g
Im9uLWNvbm5lY3QiKTsKPiArICAgIHN0cmluZ19vcHRpb24oJm9wdGlvbnMtPm9uX2Rpc2Nvbm5l
Y3QsIHVzZXJrZXksIHN5c3RlbWtleSwgInNwaWNlIiwKPiAib24tZGlzY29ubmVjdCIpOwo+ICAg
ICAgb3B0aW9ucy0+YXVkaXQgPSBib29sX29wdGlvbih1c2Vya2V5LCBzeXN0ZW1rZXksICJzcGlj
ZSIsICJhdWRpdCIpOwo+ICAgICAgb3B0aW9ucy0+YXVkaXRfbWVzc2FnZV90eXBlID0gaW50X29w
dGlvbih1c2Vya2V5LCBzeXN0ZW1rZXksICJzcGljZSIsCj4gICAgICAiYXVkaXQtbWVzc2FnZS10
eXBlIik7Cj4gIAo+IEBAIC00NDUsNyArNDM1LDcgQEAgc3RhdGljIGludCBwcm9jZXNzX3Bhc3N3
b3JkX2ZpbGUob3B0aW9uc190ICpvcHRpb25zKQo+ICAgICAgaWYgKHAgPiBidWYgJiYgKihwIC0g
MSkgPT0gJ1xuJykKPiAgICAgICAgICAqKHAgLSAxKSA9ICdcMCc7Cj4gIAo+IC0gICAgb3B0aW9u
cy0+c3BpY2VfcGFzc3dvcmQgPSBnX3N0cmR1cChidWYpOwo+ICsgICAgc3RyX3JlcGxhY2UoJm9w
dGlvbnMtPnNwaWNlX3Bhc3N3b3JkLCBidWYpOwo+ICAKPiAgICAgIHJldHVybiByYzsKPiAgfQoK
RnJlZGlhbm8KX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
U3BpY2UtZGV2ZWwgbWFpbGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNlLWRl
dmVs
