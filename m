Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4A414AD6DA
	for <lists+spice-devel@lfdr.de>; Mon,  9 Sep 2019 12:29:56 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0CC4A891FD;
	Mon,  9 Sep 2019 10:29:54 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E5D2C891EF
 for <spice-devel@lists.freedesktop.org>; Mon,  9 Sep 2019 10:29:52 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx01.intmail.prod.int.phx2.redhat.com
 [10.5.11.11])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 92CCC308620B
 for <spice-devel@lists.freedesktop.org>; Mon,  9 Sep 2019 10:29:52 +0000 (UTC)
Received: from wingsuit.mxp.redhat.com (unknown [10.32.181.222])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 1BBD860126
 for <spice-devel@lists.freedesktop.org>; Mon,  9 Sep 2019 10:29:51 +0000 (UTC)
From: Victor Toso <victortoso@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Mon,  9 Sep 2019 12:29:49 +0200
Message-Id: <20190909102949.17504-4-victortoso@redhat.com>
In-Reply-To: <20190909102949.17504-1-victortoso@redhat.com>
References: <20190909102949.17504-1-victortoso@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.11
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.42]); Mon, 09 Sep 2019 10:29:52 +0000 (UTC)
Subject: [Spice-devel] [spice-gtk v2 3/3] gstaudio: rely on SpiceSession
 init of GStreamer
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

RnJvbTogVmljdG9yIFRvc28gPG1lQHZpY3RvcnRvc28uY29tPgoKVGhpcyBtZWFucyB3ZSBjYW4g
ZHJvcCBnc3RfaW5pdF9jaGVjaygpIGZ1bmN0aW9uIGFuZCByZXBsYWNlIGl0cyBjYWxscwp3aXRo
IGdzdF9pc19pbml0aWFsaXplZCgpLgoKQSBzbWFsbCBjb2RlIHJlZmFjdG9yIHdhcyBkb25lIGlu
IHNwaWNlX2dzdGF1ZGlvX25ldygpIHRvIG1ha2UgYW4KZWFybHkgcmV0dXJuIG9uIGVycm9yLiBU
aGUgcHJldmlvdXMgd2FybmluZyBhcm91bmQgR1N0cmVhbWVyIG5vdCBiZWluZwppbml0aWFsaXpl
ZCB3YXMgZGVtb3RlZCB0byBhIGRlYnVnIG1lc3NhZ2UgYXMgdGhlIHdhcm5pbmcgc2hvdWxkIGJl
Cmlzc3VlZCBpbiBTcGljZVNlc3Npb24gaW5pdGlhbGl6YXRpb24uCgpTaWduZWQtb2ZmLWJ5OiBW
aWN0b3IgVG9zbyA8dmljdG9ydG9zb0ByZWRoYXQuY29tPgotLS0KIHNyYy9zcGljZS1nc3RhdWRp
by5jIHwgNTkgKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIDEg
ZmlsZSBjaGFuZ2VkLCAyNyBpbnNlcnRpb25zKCspLCAzMiBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS9zcmMvc3BpY2UtZ3N0YXVkaW8uYyBiL3NyYy9zcGljZS1nc3RhdWRpby5jCmluZGV4IDRk
ZDNkODEuLjUxN2Q2MTIgMTAwNjQ0Ci0tLSBhL3NyYy9zcGljZS1nc3RhdWRpby5jCisrKyBiL3Ny
Yy9zcGljZS1nc3RhdWRpby5jCkBAIC01NTIsNDUgKzU1Miw0MCBAQCBzdGF0aWMgZ2Jvb2xlYW4g
Y29ubmVjdF9jaGFubmVsKFNwaWNlQXVkaW8gKmF1ZGlvLCBTcGljZUNoYW5uZWwgKmNoYW5uZWwp
CiBTcGljZUdzdGF1ZGlvICpzcGljZV9nc3RhdWRpb19uZXcoU3BpY2VTZXNzaW9uICpzZXNzaW9u
LCBHTWFpbkNvbnRleHQgKmNvbnRleHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgY29uc3QgY2hhciAqbmFtZSkKIHsKLSAgICBHRXJyb3IgKmVyciA9IE5VTEw7Ci0KLSAgICBp
ZiAoZ3N0X2luaXRfY2hlY2soTlVMTCwgTlVMTCwgJmVycikpIHsKLSAgICAgICAgR3N0UGx1Z2lu
RmVhdHVyZSAqcHVsc2VzcmM7Ci0KLSAgICAgICAgcHVsc2VzcmMgPSBnc3RfcmVnaXN0cnlfbG9v
a3VwX2ZlYXR1cmUoZ3N0X3JlZ2lzdHJ5X2dldCgpLCAicHVsc2VzcmMiKTsKLSAgICAgICAgaWYg
KHB1bHNlc3JjKSB7Ci0gICAgICAgICAgICB1bnNpZ25lZCBtYWpvciwgbWlub3IsIG1pY3JvOwot
ICAgICAgICAgICAgR3N0UGx1Z2luICpwbHVnaW4gPSBnc3RfcGx1Z2luX2ZlYXR1cmVfZ2V0X3Bs
dWdpbihwdWxzZXNyYyk7Ci0KLSAgICAgICAgICAgIGlmIChzc2NhbmYoZ3N0X3BsdWdpbl9nZXRf
dmVyc2lvbihwbHVnaW4pLCAiJXUuJXUuJXUiLAotICAgICAgICAgICAgICAgICAgICAgICAmbWFq
b3IsICZtaW5vciwgJm1pY3JvKSAhPSAzKSB7Ci0gICAgICAgICAgICAgICAgZ193YXJuX2lmX3Jl
YWNoZWQoKTsKLSAgICAgICAgICAgICAgICBnc3Rfb2JqZWN0X3VucmVmKHBsdWdpbik7Ci0gICAg
ICAgICAgICAgICAgZ3N0X29iamVjdF91bnJlZihwdWxzZXNyYyk7Ci0gICAgICAgICAgICAgICAg
cmV0dXJuIE5VTEw7Ci0gICAgICAgICAgICB9Ci0KLSAgICAgICAgICAgIGlmIChtYWpvciA8IDEg
fHwKLSAgICAgICAgICAgICAgICAobWFqb3IgPT0gMSAmJiBtaW5vciA8IDE0KSB8fAotICAgICAg
ICAgICAgICAgIChtYWpvciA9PSAxICYmIG1pbm9yID09IDE0ICYmIG1pY3JvIDwgNSkpIHsKLSAg
ICAgICAgICAgICAgICBnX3dhcm5pbmcoIkJhZCBwdWxzZXNyYyB2ZXJzaW9uICVzLCBsb3dlcmlu
ZyBpdHMgcmFuayIsCi0gICAgICAgICAgICAgICAgICAgICAgICAgIGdzdF9wbHVnaW5fZ2V0X3Zl
cnNpb24ocGx1Z2luKSk7Ci0gICAgICAgICAgICAgICAgZ3N0X3BsdWdpbl9mZWF0dXJlX3NldF9y
YW5rKHB1bHNlc3JjLCBHU1RfUkFOS19OT05FKTsKLSAgICAgICAgICAgIH0KKyAgICBpZiAoIWdz
dF9pc19pbml0aWFsaXplZCgpKSB7CisgICAgICAgIHNwaWNlX2RlYnVnKCJHU3RyZWFtZXIgaXMg
bm90IGluaXRpYWxpemVkOiBkaXNhYmxpbmcgR1N0cmVhbWVyIGF1ZGlvIHN1cHBvcnQiKTsKKyAg
ICAgICAgcmV0dXJuIE5VTEw7CisgICAgfQorCisgICAgR3N0UGx1Z2luRmVhdHVyZSAqcHVsc2Vz
cmMgPSBnc3RfcmVnaXN0cnlfbG9va3VwX2ZlYXR1cmUoZ3N0X3JlZ2lzdHJ5X2dldCgpLCAicHVs
c2VzcmMiKTsKKyAgICBpZiAocHVsc2VzcmMpIHsKKyAgICAgICAgdW5zaWduZWQgbWFqb3IsIG1p
bm9yLCBtaWNybzsKKyAgICAgICAgR3N0UGx1Z2luICpwbHVnaW4gPSBnc3RfcGx1Z2luX2ZlYXR1
cmVfZ2V0X3BsdWdpbihwdWxzZXNyYyk7CiAKKyAgICAgICAgaWYgKHNzY2FuZihnc3RfcGx1Z2lu
X2dldF92ZXJzaW9uKHBsdWdpbiksICIldS4ldS4ldSIsCisgICAgICAgICAgICAgICAgICAgJm1h
am9yLCAmbWlub3IsICZtaWNybykgIT0gMykgeworICAgICAgICAgICAgZ193YXJuX2lmX3JlYWNo
ZWQoKTsKICAgICAgICAgICAgIGdzdF9vYmplY3RfdW5yZWYocGx1Z2luKTsKICAgICAgICAgICAg
IGdzdF9vYmplY3RfdW5yZWYocHVsc2VzcmMpOworICAgICAgICAgICAgcmV0dXJuIE5VTEw7Cisg
ICAgICAgIH0KKworICAgICAgICBpZiAobWFqb3IgPCAxIHx8CisgICAgICAgICAgICAobWFqb3Ig
PT0gMSAmJiBtaW5vciA8IDE0KSB8fAorICAgICAgICAgICAgKG1ham9yID09IDEgJiYgbWlub3Ig
PT0gMTQgJiYgbWljcm8gPCA1KSkgeworICAgICAgICAgICAgZ193YXJuaW5nKCJCYWQgcHVsc2Vz
cmMgdmVyc2lvbiAlcywgbG93ZXJpbmcgaXRzIHJhbmsiLAorICAgICAgICAgICAgICAgICAgICAg
IGdzdF9wbHVnaW5fZ2V0X3ZlcnNpb24ocGx1Z2luKSk7CisgICAgICAgICAgICBnc3RfcGx1Z2lu
X2ZlYXR1cmVfc2V0X3JhbmsocHVsc2VzcmMsIEdTVF9SQU5LX05PTkUpOwogICAgICAgICB9CiAK
LSAgICAgICAgcmV0dXJuIGdfb2JqZWN0X25ldyhTUElDRV9UWVBFX0dTVEFVRElPLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICJzZXNzaW9uIiwgc2Vzc2lvbiwKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAibWFpbi1jb250ZXh0IiwgY29udGV4dCwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBOVUxMKTsKKyAgICAgICAgZ3N0X29iamVjdF91bnJlZihwbHVnaW4pOworICAg
ICAgICBnc3Rfb2JqZWN0X3VucmVmKHB1bHNlc3JjKTsKICAgICB9CiAKLSAgICBnX3dhcm5pbmco
IkRpc2FibGluZyBHU3RyZWFtZXIgYXVkaW8gc3VwcG9ydDogJXMiLCBlcnItPm1lc3NhZ2UpOwot
ICAgIGdfY2xlYXJfZXJyb3IoJmVycik7Ci0gICAgcmV0dXJuIE5VTEw7CisgICAgcmV0dXJuIGdf
b2JqZWN0X25ldyhTUElDRV9UWVBFX0dTVEFVRElPLAorICAgICAgICAgICAgICAgICAgICAgICAg
InNlc3Npb24iLCBzZXNzaW9uLAorICAgICAgICAgICAgICAgICAgICAgICAgIm1haW4tY29udGV4
dCIsIGNvbnRleHQsCisgICAgICAgICAgICAgICAgICAgICAgICBOVUxMKTsKIH0KIAogc3RhdGlj
IHZvaWQgc3BpY2VfZ3N0YXVkaW9fZ2V0X3BsYXliYWNrX3ZvbHVtZV9pbmZvX2FzeW5jKFNwaWNl
QXVkaW8gKmF1ZGlvLAotLSAKMi4yMS4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpTcGljZS1kZXZlbCBtYWlsaW5nIGxpc3QKU3BpY2UtZGV2ZWxAbGlz
dHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4v
bGlzdGluZm8vc3BpY2UtZGV2ZWw=
