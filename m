Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 89615D0007
	for <lists+spice-devel@lfdr.de>; Tue,  8 Oct 2019 19:39:47 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0E3976E888;
	Tue,  8 Oct 2019 17:39:46 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 69ACB6E884
 for <spice-devel@lists.freedesktop.org>; Tue,  8 Oct 2019 17:39:44 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx08.intmail.prod.int.phx2.redhat.com
 [10.5.11.23])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 1138E883C45
 for <spice-devel@lists.freedesktop.org>; Tue,  8 Oct 2019 17:39:44 +0000 (UTC)
Received: from fziglio.remote.csb (unknown [10.33.32.12])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 078A119C7F;
 Tue,  8 Oct 2019 17:39:42 +0000 (UTC)
From: Frediano Ziglio <fziglio@redhat.com>
To: spice-devel@lists.freedesktop.org
Date: Tue,  8 Oct 2019 18:39:23 +0100
Message-Id: <20191008173924.12388-7-fziglio@redhat.com>
In-Reply-To: <20191008173924.12388-1-fziglio@redhat.com>
References: <20191008173924.12388-1-fziglio@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.23
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.6.2
 (mx1.redhat.com [10.5.110.69]); Tue, 08 Oct 2019 17:39:44 +0000 (UTC)
Subject: [Spice-devel] [PATCH spice-server v2 6/7] test-smartcard: Add test
 for Smartcard device
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

Q3JlYXRlIFNtYXJkY2FyZCBkZXZpY2UuCkNvbm5lY3QgdG8gaXQgYW5kIHRlc3Qgc29tZSBtZXNz
YWdlcyBhcmUgcGFyc2VkIGFuZCBwcm9jZXNzZWQKYXMgZXhwZWN0ZWQuCgpTaWduZWQtb2ZmLWJ5
OiBGcmVkaWFubyBaaWdsaW8gPGZ6aWdsaW9AcmVkaGF0LmNvbT4KLS0KQ2hhbmdlcyBzaW5jZSB2
MToKLSBhZGQgbW9yZSBjb21tZW50cwotIGxpbWl0IHRpbWUgdGhlIHRlc3QgZXhlY3V0ZXMKLS0t
CiBzZXJ2ZXIvdGVzdHMvLmdpdGlnbm9yZSAgICAgICB8ICAgMSArCiBzZXJ2ZXIvdGVzdHMvTWFr
ZWZpbGUuYW0gICAgICB8ICAgNCArCiBzZXJ2ZXIvdGVzdHMvbWVzb24uYnVpbGQgICAgICB8ICAg
NCArCiBzZXJ2ZXIvdGVzdHMvdGVzdC1zbWFydGNhcmQuYyB8IDIxMSArKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrCiA0IGZpbGVzIGNoYW5nZWQsIDIyMCBpbnNlcnRpb25zKCspCiBj
cmVhdGUgbW9kZSAxMDA2NDQgc2VydmVyL3Rlc3RzL3Rlc3Qtc21hcnRjYXJkLmMKCmRpZmYgLS1n
aXQgYS9zZXJ2ZXIvdGVzdHMvLmdpdGlnbm9yZSBiL3NlcnZlci90ZXN0cy8uZ2l0aWdub3JlCmlu
ZGV4IDM2ZTk3OGQ0Zi4uNTZjYzdlYjlhIDEwMDY0NAotLS0gYS9zZXJ2ZXIvdGVzdHMvLmdpdGln
bm9yZQorKysgYi9zZXJ2ZXIvdGVzdHMvLmdpdGlnbm9yZQpAQCAtMjksNSArMjksNiBAQCB0ZXN0
LWxlYWtzCiB0ZXN0LXNhc2wKIHRlc3QtcmVjb3JkCiB0ZXN0LXdlYnNvY2tldAordGVzdC1zbWFy
dGNhcmQKIC90ZXN0LSoubG9nCiAvdGVzdC0qLnRycwpkaWZmIC0tZ2l0IGEvc2VydmVyL3Rlc3Rz
L01ha2VmaWxlLmFtIGIvc2VydmVyL3Rlc3RzL01ha2VmaWxlLmFtCmluZGV4IDk4MjUwODUxMC4u
ZGQyODVjMjRlIDEwMDY0NAotLS0gYS9zZXJ2ZXIvdGVzdHMvTWFrZWZpbGUuYW0KKysrIGIvc2Vy
dmVyL3Rlc3RzL01ha2VmaWxlLmFtCkBAIC02OCw2ICs2OCwxMCBAQCBjaGVja19QUk9HUkFNUyA9
CQkJCVwKIAl0ZXN0LXJlY29yZAkJCQlcCiAJJChOVUxMKQogCitpZiBIQVZFX1NNQVJUQ0FSRAor
Y2hlY2tfUFJPR1JBTVMgKz0gdGVzdC1zbWFydGNhcmQKK2VuZGlmCisKIGlmICFPU19XSU4zMgog
Y2hlY2tfUFJPR1JBTVMgKz0JCQkJXAogCXRlc3Qtc3RyZWFtCQkJCVwKZGlmZiAtLWdpdCBhL3Nl
cnZlci90ZXN0cy9tZXNvbi5idWlsZCBiL3NlcnZlci90ZXN0cy9tZXNvbi5idWlsZAppbmRleCAz
MzQ3MmYxNGUuLjk1YWRlNjBmYSAxMDA2NDQKLS0tIGEvc2VydmVyL3Rlc3RzL21lc29uLmJ1aWxk
CisrKyBiL3NlcnZlci90ZXN0cy9tZXNvbi5idWlsZApAQCAtNjUsNiArNjUsMTAgQEAgaWYgc3Bp
Y2Vfc2VydmVyX2hhc19zYXNsCiAgIHRlc3RzICs9IFtbJ3Rlc3Qtc2FzbCcsIHRydWVdXQogZW5k
aWYKIAoraWYgc3BpY2Vfc2VydmVyX2hhc19zbWFydGNhcmQgPT0gdHJ1ZQorICB0ZXN0cyArPSBb
Wyd0ZXN0LXNtYXJ0Y2FyZCcsIHRydWVdXQorZW5kaWYKKwogaWYgaG9zdF9tYWNoaW5lLnN5c3Rl
bSgpICE9ICd3aW5kb3dzJwogICB0ZXN0cyArPSBbCiAgICAgWyd0ZXN0LXN0cmVhbScsIHRydWVd
LApkaWZmIC0tZ2l0IGEvc2VydmVyL3Rlc3RzL3Rlc3Qtc21hcnRjYXJkLmMgYi9zZXJ2ZXIvdGVz
dHMvdGVzdC1zbWFydGNhcmQuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAu
LmFhYzJlNzk0MQotLS0gL2Rldi9udWxsCisrKyBiL3NlcnZlci90ZXN0cy90ZXN0LXNtYXJ0Y2Fy
ZC5jCkBAIC0wLDAgKzEsMjExIEBACisvKiAtKi0gTW9kZTogQzsgYy1iYXNpYy1vZmZzZXQ6IDQ7
IGluZGVudC10YWJzLW1vZGU6IG5pbCAtKi0gKi8KKy8qCisgICBDb3B5cmlnaHQgKEMpIDIwMTkg
UmVkIEhhdCwgSW5jLgorCisgICBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNh
biByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCisgICBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9m
IHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCisgICBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBi
eSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIKKyAgIHZlcnNpb24gMi4xIG9m
IHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgorCisg
ICBUaGlzIGxpYnJhcnkgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJl
IHVzZWZ1bCwKKyAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBp
bXBsaWVkIHdhcnJhbnR5IG9mCisgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQ
QVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQorICAgTGVzc2VyIEdlbmVyYWwgUHVibGlj
IExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKworICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVk
IGEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYworICAgTGljZW5zZSBhbG9u
ZyB3aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNl
bnNlcy8+LgorKi8KKy8qKgorICogVGVzdCBTbWFydGNhcmQgZGV2aWNlIGFuZCBjaGFubmVsCisg
Ki8KKworI2luY2x1ZGUgPGNvbmZpZy5oPgorI2luY2x1ZGUgPHN0cmluZy5oPgorI2luY2x1ZGUg
PHN0ZGxpYi5oPgorI2luY2x1ZGUgPHN0ZGlvLmg+CisjaW5jbHVkZSA8c3RkYm9vbC5oPgorI2lu
Y2x1ZGUgPHVuaXN0ZC5oPgorCisjaW5jbHVkZSA8c3BpY2UvcHJvdG9jb2wuaD4KKyNpbmNsdWRl
IDxzcGljZS9zdHJlYW0tZGV2aWNlLmg+CisKKyNpbmNsdWRlICJ0ZXN0LWRpc3BsYXktYmFzZS5o
IgorI2luY2x1ZGUgInRlc3QtZ2xpYi1jb21wYXQuaCIKKyNpbmNsdWRlICJyZWRzLmgiCisjaW5j
bHVkZSAidm1jLWVtdS5oIgorI2luY2x1ZGUgInJlZC1jbGllbnQuaCIKKyNpbmNsdWRlICJuZXQt
dXRpbHMuaCIKKyNpbmNsdWRlICJ3aW4tYWxhcm0uaCIKKworc3RhdGljIFNwaWNlQ29yZUludGVy
ZmFjZSAqY29yZTsKK3N0YXRpYyBUZXN0ICp0ZXN0Oworc3RhdGljIFZtY0VtdSAqdm1jOwordHlw
ZWRlZiBpbnQgVGVzdEZpeHR1cmU7CisKK3N0YXRpYyB2b2lkIHRlc3Rfc21hcnRjYXJkX3NldHVw
KFRlc3RGaXh0dXJlICpmaXh0dXJlLCBnY29uc3Rwb2ludGVyIHVzZXJfZGF0YSkKK3sKKyAgICBn
X2Fzc2VydF9udWxsKGNvcmUpOworICAgIGdfYXNzZXJ0X251bGwodGVzdCk7CisgICAgZ19hc3Nl
cnRfbnVsbCh2bWMpOworICAgIGNvcmUgPSBiYXNpY19ldmVudF9sb29wX2luaXQoKTsKKyAgICBn
X2Fzc2VydF9ub25udWxsKGNvcmUpOworICAgIHRlc3QgPSB0ZXN0X25ldyhjb3JlKTsKKyAgICBn
X2Fzc2VydF9ub25udWxsKHRlc3QpOworICAgIHZtYyA9IHZtY19lbXVfbmV3KCJzbWFydGNhcmQi
LCBOVUxMKTsKKyAgICBnX2Fzc2VydF9ub25udWxsKHZtYyk7Cit9CisKK3N0YXRpYyB2b2lkIHRl
c3Rfc21hcnRjYXJkX3RlYXJkb3duKFRlc3RGaXh0dXJlICpmaXh0dXJlLCBnY29uc3Rwb2ludGVy
IHVzZXJfZGF0YSkKK3sKKyAgICBnX2Fzc2VydF9ub25udWxsKGNvcmUpOworICAgIGdfYXNzZXJ0
X25vbm51bGwodGVzdCk7CisgICAgZ19hc3NlcnRfbm9ubnVsbCh2bWMpOworCisgICAgdm1jX2Vt
dV9kZXN0cm95KHZtYyk7CisgICAgdm1jID0gTlVMTDsKKyAgICB0ZXN0X2Rlc3Ryb3kodGVzdCk7
CisgICAgdGVzdCA9IE5VTEw7CisgICAgYmFzaWNfZXZlbnRfbG9vcF9kZXN0cm95KCk7CisgICAg
Y29yZSA9IE5VTEw7Cit9CisKK3N0YXRpYyBSZWRTdHJlYW0gKmNyZWF0ZV9kdW1teV9zdHJlYW0o
U3BpY2VTZXJ2ZXIgKnNlcnZlciwgaW50ICpwX3NvY2tldCkKK3sKKyAgICBpbnQgc3ZbMl07Cisg
ICAgZ19hc3NlcnRfY21waW50KHNvY2tldHBhaXIoQUZfTE9DQUwsIFNPQ0tfU1RSRUFNLCAwLCBz
diksID09LCAwKTsKKyAgICBpZiAocF9zb2NrZXQpIHsKKyAgICAgICAgKnBfc29ja2V0ID0gc3Zb
MV07CisgICAgfQorICAgIHJlZF9zb2NrZXRfc2V0X25vbl9ibG9ja2luZyhzdlswXSwgdHJ1ZSk7
CisgICAgcmVkX3NvY2tldF9zZXRfbm9uX2Jsb2NraW5nKHN2WzFdLCB0cnVlKTsKKworICAgIFJl
ZFN0cmVhbSAqIHN0cmVhbSA9IHJlZF9zdHJlYW1fbmV3KHNlcnZlciwgc3ZbMF0pOworICAgIGdf
YXNzZXJ0X25vbm51bGwoc3RyZWFtKTsKKworICAgIHJldHVybiBzdHJlYW07Cit9CisKK3N0YXRp
YyB2b2lkIHNlbmRfYWNrX3N5bmMoaW50IHNvY2tldCwgdWludDMyX3QgZ2VuZXJhdGlvbikKK3sK
KyAgICBzdHJ1Y3QgeworICAgICAgICB1aW50MTZfdCBkdW1teTsKKyAgICAgICAgdWludDE2X3Qg
dHlwZTsKKyAgICAgICAgdWludDMyX3QgbGVuOworICAgICAgICB1aW50MzJfdCBnZW5lcmF0aW9u
OworICAgIH0gbXNnOworICAgIFNQSUNFX1ZFUklGWShzaXplb2YobXNnKSA9PSAxMik7CisgICAg
bXNnLnR5cGUgPSBHVUlOVDE2X1RPX0xFKFNQSUNFX01TR0NfQUNLX1NZTkMpOworICAgIG1zZy5s
ZW4gPSBHVUlOVDMyX1RPX0xFKHNpemVvZihnZW5lcmF0aW9uKSk7CisgICAgbXNnLmdlbmVyYXRp
b24gPSBHVUlOVDMyX1RPX0xFKGdlbmVyYXRpb24pOworCisgICAgZ19hc3NlcnRfY21waW50KHNv
Y2tldF93cml0ZShzb2NrZXQsICZtc2cudHlwZSwgMTApLCA9PSwgMTApOworfQorCitzdGF0aWMg
dm9pZCBzZW5kX2RhdGEoaW50IHNvY2tldCwgdWludDMyX3QgdHlwZSkKK3sKKyAgICBzdHJ1Y3Qg
eworICAgICAgICB1aW50MTZfdCBkdW1teTsKKyAgICAgICAgdWludDE2X3QgdHlwZTsKKyAgICAg
ICAgdWludDMyX3QgbGVuOworICAgICAgICBWU0NNc2dIZWFkZXIgdmhlYWRlcjsKKyAgICAgICAg
Y2hhciBkYXRhWzZdOworICAgIH0gbXNnOworICAgIFNQSUNFX1ZFUklGWShzaXplb2YobXNnKSA9
PSA4KzEyKzgpOworICAgIG1zZy50eXBlID0gR1VJTlQxNl9UT19MRShTUElDRV9NU0dDX1NNQVJU
Q0FSRF9EQVRBKTsKKyAgICBtc2cubGVuID0gR1VJTlQzMl9UT19MRShzaXplb2YoVlNDTXNnSGVh
ZGVyKSs2KTsKKyAgICBtc2cudmhlYWRlci50eXBlID0gR1VJTlQzMl9UT19MRSh0eXBlKTsKKyAg
ICBtc2cudmhlYWRlci5yZWFkZXJfaWQgPSAwOworICAgIG1zZy52aGVhZGVyLmxlbmd0aCA9IEdV
SU5UMzJfVE9fTEUoNik7CisgICAgc3RyY3B5KG1zZy5kYXRhLCAiaGVsbG8iKTsKKworICAgIGdf
YXNzZXJ0X2NtcGludChzb2NrZXRfd3JpdGUoc29ja2V0LCAmbXNnLnR5cGUsIHNpemVvZihtc2cp
LTQpLCA9PSwgc2l6ZW9mKG1zZyktNCk7Cit9CisKK3N0YXRpYyB2b2lkIGNoZWNrX2RhdGEodm9p
ZCAqb3BhcXVlKQoreworICAgIHN0YXRpYyBjb25zdCBjaGFyIGV4cGVjdGVkX2J1ZltdID0KKyAg
ICAgICAgLy8gZm9yd2FyZGVkIFJlYWRlckFkZCBtZXNzYWdlLCBub3RlIHRoYXQgcGF5bG9hZCBp
cyBzdHJpcHBlZAorICAgICAgICAiXHgwMFx4MDBceDAwXHgwM1x4MDBceDAwXHgwMFx4MDBceDAw
XHgwMFx4MDBceDAwIgorICAgICAgICAvLyBmb3J3YXJkZWQgQVBEVSBtZXNzYWdlCisgICAgICAg
ICJceDAwXHgwMFx4MDBceDA3XHgwMFx4MDBceDAwXHgwMFx4MDBceDAwXHgwMFx4MDZceDY4XHg2
NVx4NmNceDZjXHg2Zlx4MDAiOworICAgIGNvbnN0IHNpemVfdCBleHBlY3RlZF9idWZfbGVuID0g
c2l6ZW9mKGV4cGVjdGVkX2J1ZikgLSAxOworICAgIGdfYXNzZXJ0X2NtcGludCh2bWMtPndyaXRl
X3BvcywgPT0sIGV4cGVjdGVkX2J1Zl9sZW4pOworICAgIGdfYXNzZXJ0X3RydWUobWVtY21wKHZt
Yy0+d3JpdGVfYnVmLCBleHBlY3RlZF9idWYsIGV4cGVjdGVkX2J1Zl9sZW4pID09IDApOworICAg
IGJhc2ljX2V2ZW50X2xvb3BfcXVpdCgpOworfQorCitzdGF0aWMgdm9pZCB0ZXN0X3NtYXJ0Y2Fy
ZChUZXN0Rml4dHVyZSAqZml4dHVyZSwgZ2NvbnN0cG9pbnRlciB1c2VyX2RhdGEpCit7CisgICAg
U3BpY2VTZXJ2ZXIgKmNvbnN0IHNlcnZlciA9IHRlc3QtPnNlcnZlcjsKKyAgICB1aW50OF90ICpw
ID0gdm1jLT5tZXNzYWdlOworCisgICAgc3BpY2Vfc2VydmVyX2FkZF9pbnRlcmZhY2Uoc2VydmVy
LCAmdm1jLT5pbnN0YW5jZS5iYXNlKTsKKworICAgIC8vIGFkZCBWU0NfSW5pdCBtZXNzYWdlCisg
ICAgbWVtY3B5KHAsICJceDAwXHgwMFx4MDBceDAxXHgwYVx4MGJceDBjXHgwZFx4MDBceDAwXHgw
MFx4MDAiLCAxMik7CisgICAgcCArPSAxMjsKKyAgICB2bWNfZW11X2FkZF9yZWFkX3RpbGwodm1j
LCBwKTsKKworICAgIC8vIGZpbmQgU21hcnRjYXJkIGNoYW5uZWwgdG8gY29ubmVjdCB0bworICAg
IFJlZENoYW5uZWwgKmNoYW5uZWwgPSByZWRzX2ZpbmRfY2hhbm5lbChzZXJ2ZXIsIFNQSUNFX0NI
QU5ORUxfU01BUlRDQVJELCAwKTsKKyAgICBnX2Fzc2VydF9ub25udWxsKGNoYW5uZWwpOworCisg
ICAgLy8gY3JlYXRlIGR1bW15IFJlZENsaWVudCBhbmQgTWFpbkNoYW5uZWxDbGllbnQKKyAgICBS
ZWRDaGFubmVsQ2FwYWJpbGl0aWVzIGNhcHM7CisgICAgbWVtc2V0KCZjYXBzLCAwLCBzaXplb2Yo
Y2FwcykpOworICAgIHVpbnQzMl90IGNvbW1vbl9jYXBzID0gMSA8PCBTUElDRV9DT01NT05fQ0FQ
X01JTklfSEVBREVSOworICAgIGNhcHMubnVtX2NvbW1vbl9jYXBzID0gMTsKKyAgICBjYXBzLmNv
bW1vbl9jYXBzID0gc3BpY2VfbWVtZHVwKCZjb21tb25fY2Fwcywgc2l6ZW9mKGNvbW1vbl9jYXBz
KSk7CisKKyAgICBSZWRDbGllbnQgKmNsaWVudCA9IHJlZF9jbGllbnRfbmV3KHNlcnZlciwgRkFM
U0UpOworICAgIGdfYXNzZXJ0X25vbm51bGwoY2xpZW50KTsKKworICAgIE1haW5DaGFubmVsICpt
YWluX2NoYW5uZWwgPSBtYWluX2NoYW5uZWxfbmV3KHNlcnZlcik7CisgICAgZ19hc3NlcnRfbm9u
bnVsbChtYWluX2NoYW5uZWwpOworCisgICAgTWFpbkNoYW5uZWxDbGllbnQgKm1jYzsKKyAgICBt
Y2MgPSBtYWluX2NoYW5uZWxfbGluayhtYWluX2NoYW5uZWwsIGNsaWVudCwgY3JlYXRlX2R1bW15
X3N0cmVhbShzZXJ2ZXIsIE5VTEwpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAsIEZB
TFNFLCAmY2Fwcyk7CisgICAgZ19hc3NlcnRfbm9ubnVsbChtY2MpOworICAgIHJlZF9jbGllbnRf
c2V0X21haW4oY2xpZW50LCBtY2MpOworCisgICAgLy8gY3JlYXRlIG91ciB0ZXN0aW5nIFJlZENo
YW5uZWxDbGllbnQKKyAgICBpbnQgY2xpZW50X3NvY2tldDsKKyAgICByZWRfY2hhbm5lbF9jb25u
ZWN0KGNoYW5uZWwsIGNsaWVudCwgY3JlYXRlX2R1bW15X3N0cmVhbShzZXJ2ZXIsICZjbGllbnRf
c29ja2V0KSwKKyAgICAgICAgICAgICAgICAgICAgICAgIEZBTFNFLCAmY2Fwcyk7CisgICAgcmVk
X2NoYW5uZWxfY2FwYWJpbGl0aWVzX3Jlc2V0KCZjYXBzKTsKKworICAgIC8vIHB1c2ggZGF0YSB0
byBkZXZpY2UKKyAgICBzcGljZV9zZXJ2ZXJfY2hhcl9kZXZpY2Vfd2FrZXVwKCZ2bWMtPmluc3Rh
bmNlKTsKKworICAgIC8vIHB1c2ggZGF0YSBpbnRvIGNoYW5uZWwKKyAgICBzZW5kX2Fja19zeW5j
KGNsaWVudF9zb2NrZXQsIDEpOworICAgIHNlbmRfZGF0YShjbGllbnRfc29ja2V0LCBWU0NfUmVh
ZGVyQWRkKTsKKyAgICBzZW5kX2RhdGEoY2xpZW50X3NvY2tldCwgVlNDX0FQRFUpOworCisgICAg
Ly8gY2hlY2sgZGF0YSBhcmUgcHJvY2Vzc2VkIGFmdGVyIGEgc2hvcnQgdGltZQorICAgIFNwaWNl
VGltZXIgKndhdGNoX3RpbWVyOworICAgIHdhdGNoX3RpbWVyID0gY29yZS0+dGltZXJfYWRkKGNo
ZWNrX2RhdGEsIGNvcmUpOworICAgIGNvcmUtPnRpbWVyX3N0YXJ0KHdhdGNoX3RpbWVyLCAxMDAp
OworCisgICAgLy8gc3RhcnQgYWxsIHRlc3QKKyAgICBhbGFybSgxMCk7CisgICAgYmFzaWNfZXZl
bnRfbG9vcF9tYWlubG9vcCgpOworICAgIGFsYXJtKDApOworCisgICAgLy8gY2xlYW51cAorICAg
IGNvcmUtPnRpbWVyX3JlbW92ZSh3YXRjaF90aW1lcik7CisgICAgcmVkX2NsaWVudF9kZXN0cm95
KGNsaWVudCk7CisgICAgZ19vYmplY3RfdW5yZWYobWFpbl9jaGFubmVsKTsKKyAgICBnX29iamVj
dF91bnJlZihjaGFubmVsKTsKK30KKworaW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKmFyZ3ZbXSkK
K3sKKyAgICBnX3Rlc3RfaW5pdCgmYXJnYywgJmFyZ3YsIE5VTEwpOworCisgICAgZ190ZXN0X2Fk
ZCgiL3NlcnZlci9zbWFydGNhcmQiLCBUZXN0Rml4dHVyZSwgTlVMTCwgdGVzdF9zbWFydGNhcmRf
c2V0dXAsCisgICAgICAgICAgICAgICB0ZXN0X3NtYXJ0Y2FyZCwgdGVzdF9zbWFydGNhcmRfdGVh
cmRvd24pOworCisgICAgcmV0dXJuIGdfdGVzdF9ydW4oKTsKK30KLS0gCjIuMjEuMAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KU3BpY2UtZGV2ZWwgbWFp
bGluZyBsaXN0ClNwaWNlLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3Rz
LmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3NwaWNlLWRldmVs
