Return-Path: <spice-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+spice-devel@lfdr.de
Delivered-To: lists+spice-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 684FB10B16
	for <lists+spice-devel@lfdr.de>; Wed,  1 May 2019 18:17:25 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0ABC78922A;
	Wed,  1 May 2019 16:17:22 +0000 (UTC)
X-Original-To: spice-devel@lists.freedesktop.org
Delivered-To: spice-devel@lists.freedesktop.org
Received: from mail.codeweavers.com (mail.codeweavers.com [50.203.203.244])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9522D891A0
 for <spice-devel@lists.freedesktop.org>; Wed,  1 May 2019 16:17:20 +0000 (UTC)
Received: from jwhite.mn.codeweavers.com ([10.69.137.101])
 by mail.codeweavers.com with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_GCM_SHA256:128)
 (Exim 4.89) (envelope-from <jwhite@codeweavers.com>)
 id 1hLrvv-0001bS-Nk
 for spice-devel@lists.freedesktop.org; Wed, 01 May 2019 11:18:11 -0500
From: Jeremy White <jwhite@codeweavers.com>
To: spice-devel@lists.freedesktop.org
Date: Wed,  1 May 2019 11:17:15 -0500
Message-Id: <20190501161716.15538-3-jwhite@codeweavers.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20190501161716.15538-1-jwhite@codeweavers.com>
References: <20190501161716.15538-1-jwhite@codeweavers.com>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; 
 d=codeweavers.com; s=6377696661; h=References:In-Reply-To:Message-Id:Date:
 Subject:To:From:Sender:Reply-To:Cc:MIME-Version:Content-Type:
 Content-Transfer-Encoding:Content-ID:Content-Description:Resent-Date:
 Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:
 List-Help:List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=gJniNg9rodZ34rvVpzgUYzufAA7BCcdEmHRobU8bgHw=; b=jNDwNq+Mu+hoKwD2oaJIyDYNM
 MQ+VW1DULXGUv+uXrFJAW0AITq7tTjcObxDpAyzYrK0g2t7DZNS1lak6GKsCEKvo1zoW+JmWEmLai
 C7zPNuR0vGLEGEMtoVDt2o1A3qjcRh+2Kh58OtYjGWrqVAWHIyyXzQaEJx+ORW2x6M6wg=;
Subject: [Spice-devel] [PATCH v2 x11spice 3/4] Initial set of revisions to
 the dummy driver to add DRI and Present.
X-BeenThere: spice-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <spice-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/spice-devel>
List-Post: <mailto:spice-devel@lists.freedesktop.org>
List-Help: <mailto:spice-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/spice-devel>, 
 <mailto:spice-devel-request@lists.freedesktop.org?subject=subscribe>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: spice-devel-bounces@lists.freedesktop.org
Sender: "Spice-devel" <spice-devel-bounces@lists.freedesktop.org>

VGhpcyBtYWtlcyB0aGUgZHVtbXkgZHJpdmVyIHNpbWlsYXIgdG8gdGhlIG1vZGUgc2V0dGluZyBk
cml2ZXIuCgpUaGlzIHdvcmsgd2FzIGRvbmUgYnkgSGVucmkgVmVyYmVldCwgd2hpY2ggd2FzIGlu
IHR1cm4gYmFzZWQgaGVhdmlseSBvbgp0aGUgWG9yZyBtb2Rlc2V0dGluZyBkcml2ZXIuCgpTaWdu
ZWQtb2ZmLWJ5OiBKZXJlbXkgV2hpdGUgPGp3aGl0ZUBjb2Rld2VhdmVycy5jb20+Ci0tLQogc3Bp
Y2UtdmlkZW8tZHVtbXkvLmdpdGlnbm9yZSAgICAgICAgICAgICAgICAgICAgICAgfCAgIDkgKwog
c3BpY2UtdmlkZW8tZHVtbXkvUkVBRE1FLm1kICAgICAgICAgICAgICAgICAgICAgICAgfCAgMTUg
Ky0KIHNwaWNlLXZpZGVvLWR1bW15L2NvbmZpZ3VyZS5hYyAgICAgICAgICAgICAgICAgICAgIHwg
IDEyICstCiBzcGljZS12aWRlby1kdW1teS9zcGljZWR1bW15LmNvbmYgICAgICAgICAgICAgICAg
ICB8ICAxOCArKwogc3BpY2UtdmlkZW8tZHVtbXkvc3JjL01ha2VmaWxlLmFtICAgICAgICAgICAg
ICAgICAgfCAgMTYgKy0KIHNwaWNlLXZpZGVvLWR1bW15L3NyYy9kcmkyLmMgICAgICAgICAgICAg
ICAgICAgICAgIHwgMjg4ICsrKysrKysrKysrKysrKysrKysrKwogc3BpY2UtdmlkZW8tZHVtbXkv
c3JjL2R1bW15X2N1cnNvci5jICAgICAgICAgICAgICAgfCAgIDIgKy0KIHNwaWNlLXZpZGVvLWR1
bW15L3NyYy9wcmVzZW50LmMgICAgICAgICAgICAgICAgICAgIHwgMTA0ICsrKysrKysrCiBzcGlj
ZS12aWRlby1kdW1teS9zcmMve2R1bW15LmggPT4gc3BpY2VkdW1teS5ofSAgICB8ICAxMCArCiAu
Li4vc3JjL3tkdW1teV9kcml2ZXIuYyA9PiBzcGljZWR1bW15X2RyaXZlci5jfSAgICB8ICA4MiAr
KysrKy0KIDEwIGZpbGVzIGNoYW5nZWQsIDUyMyBpbnNlcnRpb25zKCspLCAzMyBkZWxldGlvbnMo
LSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBzcGljZS12aWRlby1kdW1teS8uZ2l0aWdub3JlCiBjcmVh
dGUgbW9kZSAxMDA2NDQgc3BpY2UtdmlkZW8tZHVtbXkvc3BpY2VkdW1teS5jb25mCiBjcmVhdGUg
bW9kZSAxMDA2NDQgc3BpY2UtdmlkZW8tZHVtbXkvc3JjL2RyaTIuYwogY3JlYXRlIG1vZGUgMTAw
NjQ0IHNwaWNlLXZpZGVvLWR1bW15L3NyYy9wcmVzZW50LmMKIHJlbmFtZSBzcGljZS12aWRlby1k
dW1teS9zcmMve2R1bW15LmggPT4gc3BpY2VkdW1teS5ofSAoODMlKQogcmVuYW1lIHNwaWNlLXZp
ZGVvLWR1bW15L3NyYy97ZHVtbXlfZHJpdmVyLmMgPT4gc3BpY2VkdW1teV9kcml2ZXIuY30gKDg4
JSkKCmRpZmYgLS1naXQgYS9zcGljZS12aWRlby1kdW1teS8uZ2l0aWdub3JlIGIvc3BpY2Utdmlk
ZW8tZHVtbXkvLmdpdGlnbm9yZQpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwLi45
YjRiMTFmCi0tLSAvZGV2L251bGwKKysrIGIvc3BpY2UtdmlkZW8tZHVtbXkvLmdpdGlnbm9yZQpA
QCAtMCwwICsxLDkgQEAKK2NvbmZpZy5oCitjb25maWcuaC5pbgorbGlidG9vbAorbHRtYWluLnNo
CitzdGFtcC1oMQorc3JjLy5saWJzCisqLm8KKyoubG8KKyoubGEKZGlmZiAtLWdpdCBhL3NwaWNl
LXZpZGVvLWR1bW15L1JFQURNRS5tZCBiL3NwaWNlLXZpZGVvLWR1bW15L1JFQURNRS5tZAppbmRl
eCAyYTg0YmMzLi4zZTc3ZTRkIDEwMDY0NAotLS0gYS9zcGljZS12aWRlby1kdW1teS9SRUFETUUu
bWQKKysrIGIvc3BpY2UtdmlkZW8tZHVtbXkvUkVBRE1FLm1kCkBAIC0xLDE4ICsxLDE1IEBACi14
Zjg2LXZpZGVvLWR1bW15IC0gdmlydHVhbC9vZmZzY3JlZW4gZnJhbWUgYnVmZmVyIGRyaXZlciBm
b3IgdGhlIFhvcmcgWCBzZXJ2ZXIKK3NwaWNlLXZpZGVvLWR1bW15IC0gdmlydHVhbC9vZmZzY3Jl
ZW4gZnJhbWUgYnVmZmVyIGRyaXZlciBmb3IgdGhlIFhvcmcgWCBzZXJ2ZXIKIC0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLQogCiBBbGwgcXVlc3Rpb25zIHJlZ2FyZGluZyB0aGlzIHNvZnR3YXJlIHNob3Vs
ZCBiZSBkaXJlY3RlZCBhdCB0aGUKLVhvcmcgbWFpbGluZyBsaXN0Ogorc3BpY2UtZGV2ZWwgbWFp
bGluZyBsaXN0OgogCi0gIGh0dHBzOi8vbGlzdHMueC5vcmcvbWFpbG1hbi9saXN0aW5mby94b3Jn
CisgIGh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vc3BpY2Ut
ZGV2ZWwKIAotVGhlIG1hc3RlciBkZXZlbG9wbWVudCBjb2RlIHJlcG9zaXRvcnkgY2FuIGJlIGZv
dW5kIGF0OgorVGhpcyBkcml2ZXIgb3JpZ2luYXRlZCB3aXRoIHRoZSBkdW1teSBkcml2ZXIgZnJv
bToKIAogICBodHRwczovL2dpdGxhYi5mcmVlZGVza3RvcC5vcmcveG9yZy9kcml2ZXIveGY4Ni12
aWRlby1kdW1teQogCi1QbGVhc2Ugc3VibWl0IGJ1ZyByZXBvcnRzIGFuZCByZXF1ZXN0cyB0byBt
ZXJnZSBwYXRjaGVzIHRoZXJlLgotCi1Gb3IgcGF0Y2ggc3VibWlzc2lvbiBpbnN0cnVjdGlvbnMs
IHNlZToKLQotICBodHRwczovL3d3dy54Lm9yZy93aWtpL0RldmVsb3BtZW50L0RvY3VtZW50YXRp
b24vU3VibWl0dGluZ1BhdGNoZXMKK2FuZCBtb2RpZmllZCB0byBiZSBzaW1pbGFyIHRvIHRoZSBt
b2RlIHNldHRpbmcgZHJpdmVyOgogCisgIGh0dHBzOi8vZ2l0bGFiLmZyZWVkZXNrdG9wLm9yZy94
b3JnL3hzZXJ2ZXIvdHJlZS9tYXN0ZXIvaHcveGZyZWU4Ni9kcml2ZXJzL21vZGVzZXR0aW5nCmRp
ZmYgLS1naXQgYS9zcGljZS12aWRlby1kdW1teS9jb25maWd1cmUuYWMgYi9zcGljZS12aWRlby1k
dW1teS9jb25maWd1cmUuYWMKaW5kZXggMmNhMDMyNy4uZTg1YjdlNSAxMDA2NDQKLS0tIGEvc3Bp
Y2UtdmlkZW8tZHVtbXkvY29uZmlndXJlLmFjCisrKyBiL3NwaWNlLXZpZGVvLWR1bW15L2NvbmZp
Z3VyZS5hYwpAQCAtMjIsMTAgKzIyLDEwIEBACiAKICMgSW5pdGlhbGl6ZSBBdXRvY29uZgogQUNf
UFJFUkVRKFsyLjYwXSkKLUFDX0lOSVQoW3hmODYtdmlkZW8tZHVtbXldLAotICAgICAgICBbMC4z
LjhdLAotICAgICAgICBbaHR0cHM6Ly9naXRsYWIuZnJlZWRlc2t0b3Aub3JnL3hvcmcvZHJpdmVy
L3hmODYtdmlkZW8tZHVtbXkvaXNzdWVzXSwKLSAgICAgICAgW3hmODYtdmlkZW8tZHVtbXldKQor
QUNfSU5JVChbc3BpY2UtdmlkZW8tZHVtbXldLAorICAgICAgICBbMS4xXSwKKyAgICAgICAgW2h0
dHBzOi8vZ2l0bGFiLmZyZWVkZXNrdG9wLm9yZy9zcGljZS94MTFzcGljZS9pc3N1ZXNdLAorICAg
ICAgICBbc3BpY2UtdmlkZW8tZHVtbXldKQogQUNfQ09ORklHX1NSQ0RJUihbTWFrZWZpbGUuYW1d
KQogQUNfQ09ORklHX0hFQURFUlMoW2NvbmZpZy5oXSkKIEFDX0NPTkZJR19BVVhfRElSKC4pCkBA
IC02MSwxMCArNjEsNiBAQCBQS0dfQ0hFQ0tfTU9EVUxFUyhYT1JHLCBbeG9yZy1zZXJ2ZXIgPj0g
MS40Ljk5LjkwMV0geHByb3RvIGZvbnRzcHJvdG8gJFJFUVVJUkVEXwogCiAjIENoZWNrcyBmb3Ig
bGlicmFyaWVzLgogCi0KLURSSVZFUl9OQU1FPWR1bW15Ci1BQ19TVUJTVChbRFJJVkVSX05BTUVd
KQotCiBBQ19DT05GSUdfRklMRVMoWwogICAgICAgICAgICAgICAgIE1ha2VmaWxlCiAgICAgICAg
ICAgICAgICAgc3JjL01ha2VmaWxlCmRpZmYgLS1naXQgYS9zcGljZS12aWRlby1kdW1teS9zcGlj
ZWR1bW15LmNvbmYgYi9zcGljZS12aWRlby1kdW1teS9zcGljZWR1bW15LmNvbmYKbmV3IGZpbGUg
bW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMC4uOTUwZGQ2ZgotLS0gL2Rldi9udWxsCisrKyBiL3Nw
aWNlLXZpZGVvLWR1bW15L3NwaWNlZHVtbXkuY29uZgpAQCAtMCwwICsxLDE4IEBACitTZWN0aW9u
ICJEZXZpY2UiCisgICAgSWRlbnRpZmllciAiU3BpY2VEdW1teSIKKyAgICBEcml2ZXIgInNwaWNl
ZHVtbXkiCisgICAgIyBUaGUgU1djdXJzb3Igb3B0aW9uIGVuYWJsZXMgYSBzb2Z0d2FyZSBjdXJz
b3IuICBEZWZhdWx0IGZhbHNlLgorICAgICNPcHRpb24gIlNXY3Vyc29yIiAiZmFsc2UiCisgICAg
IyBBY2NlbE1ldGhvZCBjYW4gYmUgZ2xhbW9yICh0aGUgZGVmYXVsdCksIG9yIG5vbmUuCisgICAg
I09wdGlvbiAiQWNjZWxNZXRob2QiICJnbGFtb3IiCisgICAgIyBrbXNkZXYgc3BlY2lmaWVzIHdo
aWNoIGZyYW1lYnVmZmVyIGRldmljZSB0byB1c2UsIGRlZmF1bHQgL2Rldi9kcmkvcmVuZGVyRDEy
OAorICAgICNPcHRpb24gImttc2RldiIgIi9kZXYvZHJpL3JlbmRlckQxMjgiCisgICAgVmlkZW9S
YW0gMTYzODQKK0VuZFNlY3Rpb24KKworU2VjdGlvbiAiU2NyZWVuIgorICAgIElEZW50aWZpZXIg
IlNwaWNlRHVtbXkiCisgICAgU3ViU2VjdGlvbiAiRGlzcGxheSIKKyAgICAgICAgVmlydHVhbCAx
OTIwIDEyMDAKKyAgICBFbmRTdWJTZWN0aW9uCitFbmRTZWN0aW9uCmRpZmYgLS1naXQgYS9zcGlj
ZS12aWRlby1kdW1teS9zcmMvTWFrZWZpbGUuYW0gYi9zcGljZS12aWRlby1kdW1teS9zcmMvTWFr
ZWZpbGUuYW0KaW5kZXggYzBkODJlMC4uM2MwMzQwOSAxMDA2NDQKLS0tIGEvc3BpY2UtdmlkZW8t
ZHVtbXkvc3JjL01ha2VmaWxlLmFtCisrKyBiL3NwaWNlLXZpZGVvLWR1bW15L3NyYy9NYWtlZmls
ZS5hbQpAQCAtMjcsMTMgKzI3LDE1IEBACiAKIEFNX0NGTEFHUyA9ICQoWE9SR19DRkxBR1MpICQo
UENJQUNDRVNTX0NGTEFHUykKIAotZHVtbXlfZHJ2X2xhX0xUTElCUkFSSUVTID0gZHVtbXlfZHJ2
LmxhCi1kdW1teV9kcnZfbGFfTERGTEFHUyA9IC1tb2R1bGUgLWF2b2lkLXZlcnNpb24KLWR1bW15
X2Rydl9sYV9MSUJBREQgPSAkKFhPUkdfTElCUykKLWR1bW15X2Rydl9sYWRpciA9IEBtb2R1bGVk
aXJAL2RyaXZlcnMKK3NwaWNlZHVtbXlfZHJ2X2xhX0xUTElCUkFSSUVTID0gc3BpY2VkdW1teV9k
cnYubGEKK3NwaWNlZHVtbXlfZHJ2X2xhX0xERkxBR1MgPSAtbW9kdWxlIC1hdm9pZC12ZXJzaW9u
CitzcGljZWR1bW15X2Rydl9sYV9MSUJBREQgPSAkKFhPUkdfTElCUykKK3NwaWNlZHVtbXlfZHJ2
X2xhZGlyID0gQG1vZHVsZWRpckAvZHJpdmVycwogCi1kdW1teV9kcnZfbGFfU09VUkNFUyA9IFwK
K3NwaWNlZHVtbXlfZHJ2X2xhX1NPVVJDRVMgPSBcCiAgICAgICAgICBjb21wYXQtYXBpLmggXAor
ICAgICAgICAgZHJpMi5jIFwKICAgICAgICAgIGR1bW15X2N1cnNvci5jIFwKLSAgICAgICAgIGR1
bW15X2RyaXZlci5jIFwKLSAgICAgICAgIGR1bW15LmgKKyAgICAgICAgIHNwaWNlZHVtbXlfZHJp
dmVyLmMgXAorICAgICAgICAgc3BpY2VkdW1teS5oIFwKKyAgICAgICAgIHByZXNlbnQuYwpkaWZm
IC0tZ2l0IGEvc3BpY2UtdmlkZW8tZHVtbXkvc3JjL2RyaTIuYyBiL3NwaWNlLXZpZGVvLWR1bW15
L3NyYy9kcmkyLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMC4uMTNiMzIwMAot
LS0gL2Rldi9udWxsCisrKyBiL3NwaWNlLXZpZGVvLWR1bW15L3NyYy9kcmkyLmMKQEAgLTAsMCAr
MSwyODggQEAKKy8qCisgKiBDb3B5cmlnaHQgMjAxOSBIZW5yaSBWZXJiZWV0CisgKgorICogUGVy
bWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgZGlzdHJpYnV0ZSwgYW5kIHNlbGwgdGhpcyBz
b2Z0d2FyZSBhbmQgaXRzCisgKiBkb2N1bWVudGF0aW9uIGZvciBhbnkgcHVycG9zZSBpcyBoZXJl
YnkgZ3JhbnRlZCB3aXRob3V0IGZlZSwgcHJvdmlkZWQgdGhhdAorICogdGhlIGFib3ZlIGNvcHly
aWdodCBub3RpY2UgYXBwZWFyIGluIGFsbCBjb3BpZXMgYW5kIHRoYXQgYm90aCB0aGF0IGNvcHly
aWdodAorICogbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIGFwcGVhciBpbiBzdXBw
b3J0aW5nIGRvY3VtZW50YXRpb24sIGFuZAorICogdGhhdCB0aGUgbmFtZSBvZiB0aGUgY29weXJp
Z2h0IGhvbGRlcnMgbm90IGJlIHVzZWQgaW4gYWR2ZXJ0aXNpbmcgb3IKKyAqIHB1YmxpY2l0eSBw
ZXJ0YWluaW5nIHRvIGRpc3RyaWJ1dGlvbiBvZiB0aGUgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZp
YywKKyAqIHdyaXR0ZW4gcHJpb3IgcGVybWlzc2lvbi4gIFRoZSBjb3B5cmlnaHQgaG9sZGVycyBt
YWtlIG5vIHJlcHJlc2VudGF0aW9ucworICogYWJvdXQgdGhlIHN1aXRhYmlsaXR5IG9mIHRoaXMg
c29mdHdhcmUgZm9yIGFueSBwdXJwb3NlLiAgSXQgaXMgcHJvdmlkZWQgImFzCisgKiBpcyIgd2l0
aG91dCBleHByZXNzIG9yIGltcGxpZWQgd2FycmFudHkuCisgKgorICogVEhFIENPUFlSSUdIVCBI
T0xERVJTIERJU0NMQUlNIEFMTCBXQVJSQU5USUVTIFdJVEggUkVHQVJEIFRPIFRISVMgU09GVFdB
UkUsCisgKiBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJ
VFkgQU5EIEZJVE5FU1MsIElOIE5PCisgKiBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIEhPTERF
UlMgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwgSU5ESVJFQ1QgT1IKKyAqIENPTlNFUVVFTlRJ
QUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NIExPU1Mg
T0YgVVNFLAorICogREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05U
UkFDVCwgTkVHTElHRU5DRSBPUiBPVEhFUgorICogVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9V
VCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUiBQRVJGT1JNQU5DRQorICogT0Yg
VEhJUyBTT0ZUV0FSRS4KKyAqLworCisjaWZkZWYgSEFWRV9DT05GSUdfSAorI2luY2x1ZGUgImNv
bmZpZy5oIgorI2VuZGlmCisKKyNpbmNsdWRlICJzcGljZWR1bW15LmgiCisjaW5jbHVkZSAiZHJp
Mi5oIgorI2luY2x1ZGUgInhmODZkcm0uaCIKKworc3RydWN0IGR1bW15X2RyaTJfYnVmZmVyX3By
aXZhdGUgeworICAgIFBpeG1hcFJlYyAqcGl4bWFwOworfTsKKworc3RhdGljIFBpeG1hcFJlYyAq
ZHVtbXlfZ2V0X2RyYXdhYmxlX3BpeG1hcChEcmF3YWJsZVJlYyAqIGRyYXdhYmxlKQoreworICAg
IGNvbnN0IFNjcmVlblJlYyAqc2NyZWVuID0gZHJhd2FibGUtPnBTY3JlZW47CisKKyAgICBpZiAo
ZHJhd2FibGUtPnR5cGUgPT0gRFJBV0FCTEVfUElYTUFQKQorICAgICAgICByZXR1cm4gKFBpeG1h
cFJlYyAqKSBkcmF3YWJsZTsKKyAgICBlbHNlCisgICAgICAgIHJldHVybiBzY3JlZW4tPkdldFdp
bmRvd1BpeG1hcCgoV2luZG93UmVjICopIGRyYXdhYmxlKTsKK30KKworc3RhdGljIERSSTJCdWZm
ZXIyUmVjICpkdW1teV9kcmkyX2NyZWF0ZV9idWZmZXIyKFNjcmVlblJlYyAqIHNjcmVlbiwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEcmF3YWJsZVJl
YyAqIGRyYXdhYmxlLCB1bnNpZ25lZCBpbnQgYXR0YWNobWVudCwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgZm9ybWF0KQorewor
ICAgIGNvbnN0IFNjcm5JbmZvUmVjICpzY3JuID0geGY4NlNjcmVlblRvU2NybihzY3JlZW4pOwor
ICAgIHN0cnVjdCBkdW1teV9kcmkyX2J1ZmZlcl9wcml2YXRlICpwcml2YXRlOworICAgIERSSTJC
dWZmZXIyUmVjICpidWZmZXI7CisgICAgUGl4bWFwUmVjICpwaXhtYXA7CisgICAgQ0FSRDE2IHBp
dGNoOworICAgIENBUkQzMiBzaXplOworCisgICAgaWYgKCEoYnVmZmVyID0gY2FsbG9jKDEsIHNp
emVvZigqYnVmZmVyKSkpKQorICAgICAgICByZXR1cm4gTlVMTDsKKworICAgIGlmICghKHByaXZh
dGUgPSBjYWxsb2MoMSwgc2l6ZW9mKCpwcml2YXRlKSkpKSB7CisgICAgICAgIGZyZWUoYnVmZmVy
KTsKKyAgICAgICAgcmV0dXJuIE5VTEw7CisgICAgfQorCisgICAgcGl4bWFwID0gTlVMTDsKKyAg
ICBpZiAoYXR0YWNobWVudCA9PSBEUkkyQnVmZmVyRnJvbnRMZWZ0KSB7CisgICAgICAgIHBpeG1h
cCA9IGR1bW15X2dldF9kcmF3YWJsZV9waXhtYXAoZHJhd2FibGUpOworICAgICAgICBpZiAocGl4
bWFwICYmIHBpeG1hcC0+ZHJhd2FibGUucFNjcmVlbiAhPSBzY3JlZW4pCisgICAgICAgICAgICBw
aXhtYXAgPSBOVUxMOworICAgICAgICBpZiAocGl4bWFwKQorICAgICAgICAgICAgKytwaXhtYXAt
PnJlZmNudDsKKyAgICB9CisKKyAgICBpZiAoIXBpeG1hcCkgeworICAgICAgICBzd2l0Y2ggKGF0
dGFjaG1lbnQpIHsKKyAgICAgICAgICAgIGNhc2UgRFJJMkJ1ZmZlckFjY3VtOgorICAgICAgICAg
ICAgY2FzZSBEUkkyQnVmZmVyQmFja0xlZnQ6CisgICAgICAgICAgICBjYXNlIERSSTJCdWZmZXJC
YWNrUmlnaHQ6CisgICAgICAgICAgICBjYXNlIERSSTJCdWZmZXJGYWtlRnJvbnRMZWZ0OgorICAg
ICAgICAgICAgY2FzZSBEUkkyQnVmZmVyRmFrZUZyb250UmlnaHQ6CisgICAgICAgICAgICBjYXNl
IERSSTJCdWZmZXJGcm9udExlZnQ6CisgICAgICAgICAgICBjYXNlIERSSTJCdWZmZXJGcm9udFJp
Z2h0OgorICAgICAgICAgICAgICAgIGJyZWFrOworCisgICAgICAgICAgICBjYXNlIERSSTJCdWZm
ZXJTdGVuY2lsOgorICAgICAgICAgICAgY2FzZSBEUkkyQnVmZmVyRGVwdGg6CisgICAgICAgICAg
ICBjYXNlIERSSTJCdWZmZXJEZXB0aFN0ZW5jaWw6CisgICAgICAgICAgICBjYXNlIERSSTJCdWZm
ZXJIaXo6CisgICAgICAgICAgICBkZWZhdWx0OgorICAgICAgICAgICAgICAgIHhmODZEcnZNc2co
c2Nybi0+c2NybkluZGV4LCBYX1dBUk5JTkcsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAi
UmVxdWVzdCBmb3IgRFJJMiBidWZmZXIgYXR0YWNobWVudCAlI3ggdW5zdXBwb3J0ZWQuXG4iLCBh
dHRhY2htZW50KTsKKyAgICAgICAgICAgICAgICBmcmVlKHByaXZhdGUpOworICAgICAgICAgICAg
ICAgIGZyZWUoYnVmZmVyKTsKKyAgICAgICAgICAgICAgICByZXR1cm4gTlVMTDsKKyAgICAgICAg
fQorCisgICAgICAgIGlmICghKHBpeG1hcCA9IHNjcmVlbi0+Q3JlYXRlUGl4bWFwKHNjcmVlbiwg
ZHJhd2FibGUtPndpZHRoLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBkcmF3YWJsZS0+aGVpZ2h0LCBmb3JtYXQgPyBmb3JtYXQgOiBkcmF3YWJsZS0+ZGVwdGgs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDApKSkgeworICAg
ICAgICAgICAgZnJlZShwcml2YXRlKTsKKyAgICAgICAgICAgIGZyZWUoYnVmZmVyKTsKKyAgICAg
ICAgICAgIHJldHVybiBOVUxMOworICAgICAgICB9CisgICAgfQorCisgICAgYnVmZmVyLT5hdHRh
Y2htZW50ID0gYXR0YWNobWVudDsKKyAgICBidWZmZXItPmNwcCA9IHBpeG1hcC0+ZHJhd2FibGUu
Yml0c1BlclBpeGVsIC8gODsKKyAgICBidWZmZXItPmZvcm1hdCA9IGZvcm1hdDsKKyAgICBidWZm
ZXItPmZsYWdzID0gMDsKKworICAgIGJ1ZmZlci0+bmFtZSA9IGdsYW1vcl9uYW1lX2Zyb21fcGl4
bWFwKHBpeG1hcCwgJnBpdGNoLCAmc2l6ZSk7CisgICAgYnVmZmVyLT5waXRjaCA9IHBpdGNoOwor
ICAgIGlmIChidWZmZXItPm5hbWUgPT0gLTEpIHsKKyAgICAgICAgeGY4NkRydk1zZyhzY3JuLT5z
Y3JuSW5kZXgsIFhfRVJST1IsICJGYWlsZWQgdG8gZ2V0IERSSTIgbmFtZSBmb3IgcGl4bWFwLlxu
Iik7CisgICAgICAgIHNjcmVlbi0+RGVzdHJveVBpeG1hcChwaXhtYXApOworICAgICAgICBmcmVl
KHByaXZhdGUpOworICAgICAgICBmcmVlKGJ1ZmZlcik7CisgICAgICAgIHJldHVybiBOVUxMOwor
ICAgIH0KKworICAgIGJ1ZmZlci0+ZHJpdmVyUHJpdmF0ZSA9IHByaXZhdGU7CisgICAgcHJpdmF0
ZS0+cGl4bWFwID0gcGl4bWFwOworCisgICAgcmV0dXJuIGJ1ZmZlcjsKK30KKworc3RhdGljIERS
STJCdWZmZXIyUmVjICpkdW1teV9kcmkyX2NyZWF0ZV9idWZmZXIoRHJhd2FibGVSZWMgKiBkcmF3
YWJsZSwgdW5zaWduZWQgaW50IGF0dGFjaG1lbnQsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgZm9ybWF0KQoreworICAgIHJldHVy
biBkdW1teV9kcmkyX2NyZWF0ZV9idWZmZXIyKGRyYXdhYmxlLT5wU2NyZWVuLCBkcmF3YWJsZSwg
YXR0YWNobWVudCwgZm9ybWF0KTsKK30KKworc3RhdGljIHZvaWQgZHVtbXlfZHJpMl9kZXN0cm95
X2J1ZmZlcjIoU2NyZWVuUmVjICogdW51c2VkLCBEcmF3YWJsZVJlYyAqIHVudXNlZDIsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEUkkyQnVmZmVyMlJlYyAqIGJ1ZmZl
cikKK3sKKyAgICBzdHJ1Y3QgZHVtbXlfZHJpMl9idWZmZXJfcHJpdmF0ZSAqcHJpdmF0ZTsKKyAg
ICBjb25zdCBTY3JlZW5SZWMgKnNjcmVlbjsKKworICAgIGlmICghYnVmZmVyKQorICAgICAgICBy
ZXR1cm47CisKKyAgICBpZiAoIShwcml2YXRlID0gYnVmZmVyLT5kcml2ZXJQcml2YXRlKSkgewor
ICAgICAgICBmcmVlKGJ1ZmZlcik7CisgICAgICAgIHJldHVybjsKKyAgICB9CisKKyAgICBzY3Jl
ZW4gPSBwcml2YXRlLT5waXhtYXAtPmRyYXdhYmxlLnBTY3JlZW47CisgICAgc2NyZWVuLT5EZXN0
cm95UGl4bWFwKHByaXZhdGUtPnBpeG1hcCk7CisgICAgZnJlZShwcml2YXRlKTsKKyAgICBmcmVl
KGJ1ZmZlcik7Cit9CisKK3N0YXRpYyB2b2lkIGR1bW15X2RyaTJfZGVzdHJveV9idWZmZXIoRHJh
d2FibGVSZWMgKiBkcmF3YWJsZSwgRFJJMkJ1ZmZlcjJSZWMgKiBidWZmZXIpCit7CisgICAgZHVt
bXlfZHJpMl9kZXN0cm95X2J1ZmZlcjIoTlVMTCwgZHJhd2FibGUsIGJ1ZmZlcik7Cit9CisKK3N0
YXRpYyB2b2lkIGR1bW15X2RyaTJfY29weV9yZWdpb24yKFNjcmVlblJlYyAqIHNjcmVlbiwgRHJh
d2FibGVSZWMgKiBkcmF3YWJsZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFJlZ2lvblJlYyAqIHJlZ2lvbiwgRFJJMkJ1ZmZlclJlYyAqIGRzdF9idWZmZXIsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEUkkyQnVmZmVyUmVjICogc3JjX2J1ZmZlcikK
K3sKKyAgICBjb25zdCBzdHJ1Y3QgZHVtbXlfZHJpMl9idWZmZXJfcHJpdmF0ZSAqc3JjX3ByaXYg
PSBzcmNfYnVmZmVyLT5kcml2ZXJQcml2YXRlOworICAgIGNvbnN0IHN0cnVjdCBkdW1teV9kcmky
X2J1ZmZlcl9wcml2YXRlICpkc3RfcHJpdiA9IGRzdF9idWZmZXItPmRyaXZlclByaXZhdGU7Cisg
ICAgaW50IG9mZl94ID0gMCwgb2ZmX3kgPSAwOworICAgIEJvb2wgdHJhbnNsYXRlID0gRkFMU0U7
CisgICAgRHJhd2FibGVSZWMgKnNyYywgKmRzdDsKKyAgICBSZWdpb25SZWMgKmNsaXBfcmVnaW9u
OworICAgIEdDICpnYzsKKworICAgIHNyYyA9IChzcmNfYnVmZmVyLT5hdHRhY2htZW50ID09IERS
STJCdWZmZXJGcm9udExlZnQpID8gZHJhd2FibGUgOiAmc3JjX3ByaXYtPnBpeG1hcC0+ZHJhd2Fi
bGU7CisgICAgZHN0ID0gKGRzdF9idWZmZXItPmF0dGFjaG1lbnQgPT0gRFJJMkJ1ZmZlckZyb250
TGVmdCkgPyBkcmF3YWJsZSA6ICZkc3RfcHJpdi0+cGl4bWFwLT5kcmF3YWJsZTsKKworICAgIGlm
IChkc3RfYnVmZmVyLT5hdHRhY2htZW50ID09IERSSTJCdWZmZXJGcm9udExlZnQgJiYgZHJhd2Fi
bGUtPnBTY3JlZW4gIT0gc2NyZWVuKSB7CisgICAgICAgIGlmICghKGRzdCA9IERSSTJVcGRhdGVQ
cmltZShkcmF3YWJsZSwgZHN0X2J1ZmZlcikpKQorICAgICAgICAgICAgcmV0dXJuOworICAgICAg
ICBpZiAoZHN0ICE9IGRyYXdhYmxlKQorICAgICAgICAgICAgdHJhbnNsYXRlID0gVFJVRTsKKyAg
ICB9CisKKyAgICBpZiAodHJhbnNsYXRlICYmIGRyYXdhYmxlLT50eXBlID09IERSQVdBQkxFX1dJ
TkRPVykgeworICAgICAgICBjb25zdCBQaXhtYXBSZWMgKnBpeG1hcCA9IGR1bW15X2dldF9kcmF3
YWJsZV9waXhtYXAoZHJhd2FibGUpOworICAgICAgICBvZmZfeCA9IC1waXhtYXAtPnNjcmVlbl94
OworICAgICAgICBvZmZfeSA9IC1waXhtYXAtPnNjcmVlbl95OworICAgICAgICBvZmZfeCArPSBk
cmF3YWJsZS0+eDsKKyAgICAgICAgb2ZmX3kgKz0gZHJhd2FibGUtPnk7CisgICAgfQorCisgICAg
aWYgKCEoZ2MgPSBHZXRTY3JhdGNoR0MoZHN0LT5kZXB0aCwgc2NyZWVuKSkpCisgICAgICAgIHJl
dHVybjsKKworICAgIGNsaXBfcmVnaW9uID0gUkVHSU9OX0NSRUFURShzY3JlZW4sIE5VTEwsIDAp
OworICAgIFJFR0lPTl9DT1BZKHNjcmVlbiwgY2xpcF9yZWdpb24sIHJlZ2lvbik7CisgICAgaWYg
KHRyYW5zbGF0ZSkKKyAgICAgICAgUkVHSU9OX1RSQU5TTEFURShzY3JlZW4sIGNsaXBfcmVnaW9u
LCBvZmZfeCwgb2ZmX3kpOworICAgIGdjLT5mdW5jcy0+Q2hhbmdlQ2xpcChnYywgQ1RfUkVHSU9O
LCBjbGlwX3JlZ2lvbiwgMCk7CisgICAgVmFsaWRhdGVHQyhkc3QsIGdjKTsKKworICAgIGdjLT5v
cHMtPkNvcHlBcmVhKHNyYywgZHN0LCBnYywgMCwgMCwgZHJhd2FibGUtPndpZHRoLCBkcmF3YWJs
ZS0+aGVpZ2h0LCBvZmZfeCwgb2ZmX3kpOworCisgICAgRnJlZVNjcmF0Y2hHQyhnYyk7Cit9CisK
K3N0YXRpYyB2b2lkIGR1bW15X2RyaTJfY29weV9yZWdpb24oRHJhd2FibGVSZWMgKiBkcmF3YWJs
ZSwgUmVnaW9uUmVjICogcmVnaW9uLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBEUkkyQnVmZmVyUmVjICogZHN0X2J1ZmZlciwgRFJJMkJ1ZmZlclJlYyAqIHNyY19idWZmZXIp
Cit7CisgICAgZHVtbXlfZHJpMl9jb3B5X3JlZ2lvbjIoZHJhd2FibGUtPnBTY3JlZW4sIGRyYXdh
YmxlLCByZWdpb24sIGRzdF9idWZmZXIsIHNyY19idWZmZXIpOworfQorCitzdGF0aWMgaW50IGR1
bW15X2RyaTJfZ2V0X21zYyhEcmF3YWJsZVJlYyAqIGRyYXdhYmxlLCBDQVJENjQgKiB1c3QsIENB
UkQ2NCAqIG1zYykKK3sKKyAgICBzdHJ1Y3QgdGltZXNwZWMgdHY7CisKKyAgICBpZiAoY2xvY2tf
Z2V0dGltZShDTE9DS19NT05PVE9OSUMsICZ0dikpCisgICAgICAgICp1c3QgPSAwOworICAgIGVs
c2UKKyAgICAgICAgKnVzdCA9ICh1aW50NjRfdCkgdHYudHZfc2VjICogMTAwMDAwMCArIHR2LnR2
X25zZWMgLyAxMDAwOworICAgICptc2MgPSAwOworCisgICAgcmV0dXJuIFRSVUU7Cit9CisKK3N0
YXRpYyBpbnQgZHVtbXlfZHJpMl9zY2hlZHVsZV93YWl0X21zYyhDbGllbnRSZWMgKiBjbGllbnQs
IERyYXdhYmxlUmVjICogZHJhd2FibGUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgQ0FSRDY0IHRhcmdldF9tc2MsIENBUkQ2NCBkaXZpc29yLCBDQVJENjQgcmVtYWlu
ZGVyKQoreworICAgIERSSTJXYWl0TVNDQ29tcGxldGUoY2xpZW50LCBkcmF3YWJsZSwgdGFyZ2V0
X21zYywgMCwgMCk7CisKKyAgICByZXR1cm4gVFJVRTsKK30KKworc3RhdGljIGludCBkdW1teV9k
cmkyX3NjaGVkdWxlX3N3YXAoQ2xpZW50UmVjICogY2xpZW50LCBEcmF3YWJsZVJlYyAqIGRyYXdh
YmxlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRFJJMkJ1ZmZlclJlYyAq
IGZyb250LCBEUkkyQnVmZmVyUmVjICogYmFjaywKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIENBUkQ2NCAqIHRhcmdldF9tc2MsIENBUkQ2NCBkaXZpc29yLCBDQVJENjQgcmVt
YWluZGVyLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRFJJMlN3YXBFdmVu
dFB0ciBmdW5jLCB2b2lkICpkYXRhKQoreworICAgIFJlZ2lvblJlYyByZWdpb247CisgICAgQm94
UmVjIGJveDsKKworICAgIGJveC54MSA9IDA7CisgICAgYm94LnkxID0gMDsKKyAgICBib3gueDIg
PSBkcmF3YWJsZS0+d2lkdGg7CisgICAgYm94LnkyID0gZHJhd2FibGUtPmhlaWdodDsKKyAgICBS
ZWdpb25Jbml0KCZyZWdpb24sICZib3gsIDApOworCisgICAgZHVtbXlfZHJpMl9jb3B5X3JlZ2lv
bihkcmF3YWJsZSwgJnJlZ2lvbiwgZnJvbnQsIGJhY2spOworICAgIERSSTJTd2FwQ29tcGxldGUo
Y2xpZW50LCBkcmF3YWJsZSwgMCwgMCwgMCwgRFJJMl9CTElUX0NPTVBMRVRFLCBmdW5jLCBkYXRh
KTsKKyAgICAqdGFyZ2V0X21zYyA9IDA7CisKKyAgICByZXR1cm4gVFJVRTsKK30KKworQm9vbCBk
dW1teV9kcmkyX3NjcmVlbl9pbml0KFNjcmVlblJlYyAqIHNjcmVlbikKK3sKKyAgICBjb25zdCBT
Y3JuSW5mb1JlYyAqc2NybiA9IHhmODZTY3JlZW5Ub1Njcm4oc2NyZWVuKTsKKyAgICBjb25zdCBE
VU1NWVJlYyAqZHVtbXkgPSBzY3JuLT5kcml2ZXJQcml2YXRlOworICAgIERSSTJJbmZvUmVjIGlu
Zm87CisKKyAgICBpZiAoIWdsYW1vcl9zdXBwb3J0c19waXhtYXBfaW1wb3J0X2V4cG9ydChzY3Jl
ZW4pKQorICAgICAgICB4Zjg2RHJ2TXNnKHNjcm4tPnNjcm5JbmRleCwgWF9XQVJOSU5HLAorICAg
ICAgICAgICAgICAgICAgICJEUkkyOiBnbGFtb3IgbGFja3Mgc3VwcG9ydCBmb3IgcGl4bWFwIGlt
cG9ydC9leHBvcnRcbiIpOworCisgICAgaWYgKCF4Zjg2TG9hZGVyQ2hlY2tTeW1ib2woIkRSSTJW
ZXJzaW9uIikpCisgICAgICAgIHJldHVybiBGQUxTRTsKKworICAgIG1lbXNldCgmaW5mbywgMCwg
c2l6ZW9mKGluZm8pKTsKKyAgICBpbmZvLmZkID0gZHVtbXktPmZkOworICAgIGluZm8uZHJpdmVy
TmFtZSA9IE5VTEw7CisgICAgaW5mby5kZXZpY2VOYW1lID0gZHJtR2V0RGV2aWNlTmFtZUZyb21G
ZDIoZHVtbXktPmZkKTsKKworICAgIGluZm8udmVyc2lvbiA9IDk7CisgICAgaW5mby5DcmVhdGVC
dWZmZXIgPSBkdW1teV9kcmkyX2NyZWF0ZV9idWZmZXI7CisgICAgaW5mby5EZXN0cm95QnVmZmVy
ID0gZHVtbXlfZHJpMl9kZXN0cm95X2J1ZmZlcjsKKyAgICBpbmZvLkNvcHlSZWdpb24gPSBkdW1t
eV9kcmkyX2NvcHlfcmVnaW9uOworICAgIGluZm8uU2NoZWR1bGVTd2FwID0gZHVtbXlfZHJpMl9z
Y2hlZHVsZV9zd2FwOworICAgIGluZm8uR2V0TVNDID0gZHVtbXlfZHJpMl9nZXRfbXNjOworICAg
IGluZm8uU2NoZWR1bGVXYWl0TVNDID0gZHVtbXlfZHJpMl9zY2hlZHVsZV93YWl0X21zYzsKKyAg
ICBpbmZvLkNyZWF0ZUJ1ZmZlcjIgPSBkdW1teV9kcmkyX2NyZWF0ZV9idWZmZXIyOworICAgIGlu
Zm8uRGVzdHJveUJ1ZmZlcjIgPSBkdW1teV9kcmkyX2Rlc3Ryb3lfYnVmZmVyMjsKKyAgICBpbmZv
LkNvcHlSZWdpb24yID0gZHVtbXlfZHJpMl9jb3B5X3JlZ2lvbjI7CisKKyAgICBpbmZvLm51bURy
aXZlcnMgPSAwOworICAgIGluZm8uZHJpdmVyTmFtZXMgPSBOVUxMOworCisgICAgcmV0dXJuIERS
STJTY3JlZW5Jbml0KHNjcmVlbiwgJmluZm8pOworfQorCit2b2lkIGR1bW15X2RyaTJfY2xvc2Vf
c2NyZWVuKFNjcmVlblJlYyAqIHNjcmVlbikKK3sKKyAgICBEUkkyQ2xvc2VTY3JlZW4oc2NyZWVu
KTsKK30KZGlmZiAtLWdpdCBhL3NwaWNlLXZpZGVvLWR1bW15L3NyYy9kdW1teV9jdXJzb3IuYyBi
L3NwaWNlLXZpZGVvLWR1bW15L3NyYy9kdW1teV9jdXJzb3IuYwppbmRleCBjY2NlNDQyLi41YzY4
MGNiIDEwMDY0NAotLS0gYS9zcGljZS12aWRlby1kdW1teS9zcmMvZHVtbXlfY3Vyc29yLmMKKysr
IGIvc3BpY2UtdmlkZW8tZHVtbXkvc3JjL2R1bW15X2N1cnNvci5jCkBAIC05LDcgKzksNyBAQAog
I2luY2x1ZGUgInhmODZDdXJzb3IuaCIKICNpbmNsdWRlICJjdXJzb3JzdHIuaCIKIC8qIERyaXZl
ciBzcGVjaWZpYyBoZWFkZXJzICovCi0jaW5jbHVkZSAiZHVtbXkuaCIKKyNpbmNsdWRlICJzcGlj
ZWR1bW15LmgiCiAKIHN0YXRpYyB2b2lkIGR1bW15U2hvd0N1cnNvcihTY3JuSW5mb1B0ciBwU2Ny
bikKIHsKZGlmZiAtLWdpdCBhL3NwaWNlLXZpZGVvLWR1bW15L3NyYy9wcmVzZW50LmMgYi9zcGlj
ZS12aWRlby1kdW1teS9zcmMvcHJlc2VudC5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAw
MDAwMDAuLjMzYWM3MTAKLS0tIC9kZXYvbnVsbAorKysgYi9zcGljZS12aWRlby1kdW1teS9zcmMv
cHJlc2VudC5jCkBAIC0wLDAgKzEsMTA0IEBACisvKgorICogQ29weXJpZ2h0IDIwMTkgSGVucmkg
VmVyYmVldAorICoKKyAqIFBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGRpc3RyaWJ1
dGUsIGFuZCBzZWxsIHRoaXMgc29mdHdhcmUgYW5kIGl0cworICogZG9jdW1lbnRhdGlvbiBmb3Ig
YW55IHB1cnBvc2UgaXMgaGVyZWJ5IGdyYW50ZWQgd2l0aG91dCBmZWUsIHByb3ZpZGVkIHRoYXQK
KyAqIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFwcGVhciBpbiBhbGwgY29waWVzIGFuZCB0
aGF0IGJvdGggdGhhdCBjb3B5cmlnaHQKKyAqIG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5v
dGljZSBhcHBlYXIgaW4gc3VwcG9ydGluZyBkb2N1bWVudGF0aW9uLCBhbmQKKyAqIHRoYXQgdGhl
IG5hbWUgb2YgdGhlIGNvcHlyaWdodCBob2xkZXJzIG5vdCBiZSB1c2VkIGluIGFkdmVydGlzaW5n
IG9yCisgKiBwdWJsaWNpdHkgcGVydGFpbmluZyB0byBkaXN0cmlidXRpb24gb2YgdGhlIHNvZnR3
YXJlIHdpdGhvdXQgc3BlY2lmaWMsCisgKiB3cml0dGVuIHByaW9yIHBlcm1pc3Npb24uICBUaGUg
Y29weXJpZ2h0IGhvbGRlcnMgbWFrZSBubyByZXByZXNlbnRhdGlvbnMKKyAqIGFib3V0IHRoZSBz
dWl0YWJpbGl0eSBvZiB0aGlzIHNvZnR3YXJlIGZvciBhbnkgcHVycG9zZS4gIEl0IGlzIHByb3Zp
ZGVkICJhcworICogaXMiIHdpdGhvdXQgZXhwcmVzcyBvciBpbXBsaWVkIHdhcnJhbnR5LgorICoK
KyAqIFRIRSBDT1BZUklHSFQgSE9MREVSUyBESVNDTEFJTSBBTEwgV0FSUkFOVElFUyBXSVRIIFJF
R0FSRCBUTyBUSElTIFNPRlRXQVJFLAorICogSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJ
RVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTLCBJTiBOTworICogRVZFTlQgU0hBTEwg
VEhFIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIFNQRUNJQUwsIElORElSRUNU
IE9SCisgKiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBS
RVNVTFRJTkcgRlJPTSBMT1NTIE9GIFVTRSwKKyAqIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJ
TiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1IgT1RIRVIKKyAqIFRPUlRJT1VT
IEFDVElPTiwgQVJJU0lORyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1Ig
UEVSRk9STUFOQ0UKKyAqIE9GIFRISVMgU09GVFdBUkUuCisgKi8KKworI2lmZGVmIEhBVkVfQ09O
RklHX0gKKyNpbmNsdWRlICJjb25maWcuaCIKKyNlbmRpZgorCisjaW5jbHVkZSAic3BpY2VkdW1t
eS5oIgorI2luY2x1ZGUgInByZXNlbnQuaCIKKworc3RhdGljIFJSQ3J0Y1JlYyAqZHVtbXlfcHJl
c2VudF9nZXRfY3J0YyhXaW5kb3dSZWMgKiB3aW5kb3cpCit7CisgICAgcmV0dXJuIE5VTEw7Cit9
CisKK3N0YXRpYyB1aW50NjRfdCBkdW1teV9nZXR0aW1lX3VzKHZvaWQpCit7CisgICAgc3RydWN0
IHRpbWVzcGVjIHR2OworCisgICAgaWYgKGNsb2NrX2dldHRpbWUoQ0xPQ0tfTU9OT1RPTklDLCAm
dHYpKQorICAgICAgICByZXR1cm4gMDsKKworICAgIHJldHVybiAodWludDY0X3QpIHR2LnR2X3Nl
YyAqIDEwMDAwMDAgKyB0di50dl9uc2VjIC8gMTAwMDsKK30KKworc3RhdGljIGludCBkdW1teV9w
cmVzZW50X2dldF91c3RfbXNjKFJSQ3J0Y1JlYyAqIGNydGMsIENBUkQ2NCAqIHVzdCwgQ0FSRDY0
ICogbXNjKQoreworICAgICp1c3QgPSBkdW1teV9nZXR0aW1lX3VzKCk7CisgICAgKm1zYyA9IDA7
CisKKyAgICByZXR1cm4gU3VjY2VzczsKK30KKworc3RhdGljIGludCBkdW1teV9wcmVzZW50X3F1
ZXVlX3ZibGFuayhSUkNydGNSZWMgKiBjcnRjLCB1aW50NjRfdCBldmVudF9pZCwgdWludDY0X3Qg
bXNjKQoreworICAgIHByZXNlbnRfZXZlbnRfbm90aWZ5KGV2ZW50X2lkLCBkdW1teV9nZXR0aW1l
X3VzKCksIG1zYyk7CisKKyAgICByZXR1cm4gU3VjY2VzczsKK30KKworc3RhdGljIHZvaWQgZHVt
bXlfcHJlc2VudF9hYm9ydF92YmxhbmsoUlJDcnRjUmVjICogY3J0YywgdWludDY0X3QgZXZlbnRf
aWQsIHVpbnQ2NF90IG1zYykKK3sKK30KKworc3RhdGljIHZvaWQgZHVtbXlfcHJlc2VudF9mbHVz
aChXaW5kb3dSZWMgKiB3aW5kb3cpCit7CisgICAgZ2xhbW9yX2Jsb2NrX2hhbmRsZXIod2luZG93
LT5kcmF3YWJsZS5wU2NyZWVuKTsKK30KKworc3RhdGljIEJvb2wgZHVtbXlfcHJlc2VudF9jaGVj
a19mbGlwKFJSQ3J0Y1JlYyAqIGNydGMsIFdpbmRvd1JlYyAqIHdpbmRvdywgUGl4bWFwUmVjICog
cGl4bWFwLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvb2wgc3luY19m
bGlwKQoreworICAgIHJldHVybiBGQUxTRTsKK30KKworc3RhdGljIEJvb2wgZHVtbXlfcHJlc2Vu
dF9mbGlwKFJSQ3J0Y1JlYyAqIGNydGMsIHVpbnQ2NF90IGV2ZW50X2lkLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHVpbnQ2NF90IHRhcmdldF9tc2MsIFBpeG1hcFJlYyAqIHBpeG1h
cCwgQm9vbCBzeW5jX2ZsaXApCit7CisgICAgcmV0dXJuIEZBTFNFOworfQorCitzdGF0aWMgdm9p
ZCBkdW1teV9wcmVzZW50X3VuZmxpcChTY3JlZW5SZWMgKiBzY3JlZW4sIHVpbnQ2NF90IGV2ZW50
X2lkKQoreworICAgIHByZXNlbnRfZXZlbnRfbm90aWZ5KGV2ZW50X2lkLCAwLCAwKTsKK30KKwor
Qm9vbCBkdW1teV9wcmVzZW50X3NjcmVlbl9pbml0KFNjcmVlblJlYyAqIHNjcmVlbikKK3sKKyAg
ICBzdGF0aWMgc3RydWN0IHByZXNlbnRfc2NyZWVuX2luZm8gcHJlc2VudF9zY3JlZW5faW5mbyA9
IHsKKyAgICAgICAgLnZlcnNpb24gPSBQUkVTRU5UX1NDUkVFTl9JTkZPX1ZFUlNJT04sCisKKyAg
ICAgICAgLmdldF9jcnRjID0gZHVtbXlfcHJlc2VudF9nZXRfY3J0YywKKyAgICAgICAgLmdldF91
c3RfbXNjID0gZHVtbXlfcHJlc2VudF9nZXRfdXN0X21zYywKKyAgICAgICAgLnF1ZXVlX3ZibGFu
ayA9IGR1bW15X3ByZXNlbnRfcXVldWVfdmJsYW5rLAorICAgICAgICAuYWJvcnRfdmJsYW5rID0g
ZHVtbXlfcHJlc2VudF9hYm9ydF92YmxhbmssCisgICAgICAgIC5mbHVzaCA9IGR1bW15X3ByZXNl
bnRfZmx1c2gsCisKKyAgICAgICAgLmNhcGFiaWxpdGllcyA9IFByZXNlbnRDYXBhYmlsaXR5Tm9u
ZSwKKyAgICAgICAgLmNoZWNrX2ZsaXAgPSBkdW1teV9wcmVzZW50X2NoZWNrX2ZsaXAsCisgICAg
ICAgIC5mbGlwID0gZHVtbXlfcHJlc2VudF9mbGlwLAorICAgICAgICAudW5mbGlwID0gZHVtbXlf
cHJlc2VudF91bmZsaXAsCisgICAgfTsKKworICAgIHJldHVybiBwcmVzZW50X3NjcmVlbl9pbml0
KHNjcmVlbiwgJnByZXNlbnRfc2NyZWVuX2luZm8pOworfQpkaWZmIC0tZ2l0IGEvc3BpY2Utdmlk
ZW8tZHVtbXkvc3JjL2R1bW15LmggYi9zcGljZS12aWRlby1kdW1teS9zcmMvc3BpY2VkdW1teS5o
CnNpbWlsYXJpdHkgaW5kZXggODMlCnJlbmFtZSBmcm9tIHNwaWNlLXZpZGVvLWR1bW15L3NyYy9k
dW1teS5oCnJlbmFtZSB0byBzcGljZS12aWRlby1kdW1teS9zcmMvc3BpY2VkdW1teS5oCmluZGV4
IDBjMTY1OTEuLmFiNGQyYTEgMTAwNjQ0Ci0tLSBhL3NwaWNlLXZpZGVvLWR1bW15L3NyYy9kdW1t
eS5oCisrKyBiL3NwaWNlLXZpZGVvLWR1bW15L3NyYy9zcGljZWR1bW15LmgKQEAgLTEzLDYgKzEz
LDkgQEAKIAogI2luY2x1ZGUgImNvbXBhdC1hcGkuaCIKIAorI2RlZmluZSBHTEFNT1JfRk9SX1hP
UkcgMQorI2luY2x1ZGUgImdsYW1vci5oIgorCiAvKiBTdXBwb3J0ZWQgY2hpcHNldHMgKi8KIHR5
cGVkZWYgZW51bSB7CiAgICAgRFVNTVlfQ0hJUApAQCAtMjgsNiArMzEsMTAgQEAgZXh0ZXJuIEJv
b2wgRFVNTVlDdXJzb3JJbml0KFNjcmVlblB0ciBwU2Nybik7CiBleHRlcm4gdm9pZCBEVU1NWVNo
b3dDdXJzb3IoU2NybkluZm9QdHIgcFNjcm4pOwogZXh0ZXJuIHZvaWQgRFVNTVlIaWRlQ3Vyc29y
KFNjcm5JbmZvUHRyIHBTY3JuKTsKIAordm9pZCBkdW1teV9kcmkyX2Nsb3NlX3NjcmVlbihTY3Jl
ZW5SZWMgKiBzY3JlZW4pOworQm9vbCBkdW1teV9kcmkyX3NjcmVlbl9pbml0KFNjcmVlblJlYyAq
IHNjcmVlbik7CitCb29sIGR1bW15X3ByZXNlbnRfc2NyZWVuX2luaXQoU2NyZWVuUmVjICogc2Ny
ZWVuKTsKKwogLyogZ2xvYmFscyAqLwogdHlwZWRlZiBzdHJ1Y3QgX2NvbG9yIHsKICAgICBpbnQg
cmVkOwpAQCAtNTAsNiArNTcsOSBAQCB0eXBlZGVmIHN0cnVjdCBkdW1teVJlYyB7CiAgICAgZHVt
bXlfY29sb3JzIGNvbG9yc1sxMDI0XTsKICAgICAgQm9vbCgqQ3JlYXRlV2luZG93KSAoKTsgICAg
Lyogd3JhcHBlZCBDcmVhdGVXaW5kb3cgKi8KICAgICBCb29sIHByb3A7CisKKyAgICBCb29sIGds
YW1vcjsKKyAgICBpbnQgZmQ7CiB9IERVTU1ZUmVjLCAqRFVNTVlQdHI7CiAKIC8qIFRoZSBwcml2
YXRlcyBvZiB0aGUgRFVNTVkgZHJpdmVyICovCmRpZmYgLS1naXQgYS9zcGljZS12aWRlby1kdW1t
eS9zcmMvZHVtbXlfZHJpdmVyLmMgYi9zcGljZS12aWRlby1kdW1teS9zcmMvc3BpY2VkdW1teV9k
cml2ZXIuYwpzaW1pbGFyaXR5IGluZGV4IDg4JQpyZW5hbWUgZnJvbSBzcGljZS12aWRlby1kdW1t
eS9zcmMvZHVtbXlfZHJpdmVyLmMKcmVuYW1lIHRvIHNwaWNlLXZpZGVvLWR1bW15L3NyYy9zcGlj
ZWR1bW15X2RyaXZlci5jCmluZGV4IDA2OTYxNTEuLmNhZDA2MTkgMTAwNjQ0Ci0tLSBhL3NwaWNl
LXZpZGVvLWR1bW15L3NyYy9kdW1teV9kcml2ZXIuYworKysgYi9zcGljZS12aWRlby1kdW1teS9z
cmMvc3BpY2VkdW1teV9kcml2ZXIuYwpAQCAtMzIsNyArMzIsOSBAQAogLyoKICAqIERyaXZlciBk
YXRhIHN0cnVjdHVyZXMuCiAgKi8KLSNpbmNsdWRlICJkdW1teS5oIgorI2luY2x1ZGUgInNwaWNl
ZHVtbXkuaCIKKyNpbmNsdWRlIDxmY250bC5oPgorI2luY2x1ZGUgPGVycm5vLmg+CiAKIC8qIFRo
ZXNlIG5lZWQgdG8gYmUgY2hlY2tlZCAqLwogI2luY2x1ZGUgPFgxMS9YLmg+CkBAIC02Miw4ICs2
NCw4IEBAIHN0YXRpYyBCb29sIGR1bW15RHJpdmVyRnVuYyhTY3JuSW5mb1B0ciBwU2NybiwgeG9y
Z0RyaXZlckZ1bmNPcCBvcCwgcG9pbnRlciBwdHIpCiAvKiAJCQkJaW50IFBvd2VyTWFuYWdlbWVu
dE1vZGUsIGludCBmbGFncyk7ICovCiAKICNkZWZpbmUgRFVNTVlfVkVSU0lPTiA0MDAwCi0jZGVm
aW5lIERVTU1ZX05BTUUgIkRVTU1ZIgotI2RlZmluZSBEVU1NWV9EUklWRVJfTkFNRSAiZHVtbXki
CisjZGVmaW5lIERVTU1ZX05BTUUgIlNQSUNFRFVNTVkiCisjZGVmaW5lIERVTU1ZX0RSSVZFUl9O
QU1FICJzcGljZWR1bW15IgogCiAjZGVmaW5lIERVTU1ZX01BSk9SX1ZFUlNJT04gUEFDS0FHRV9W
RVJTSU9OX01BSk9SCiAjZGVmaW5lIERVTU1ZX01JTk9SX1ZFUlNJT04gUEFDS0FHRV9WRVJTSU9O
X01JTk9SCkBAIC05OSwxNiArMTAxLDIwIEBAIF9YX0VYUE9SVCBEcml2ZXJSZWMgRFVNTVkgPSB7
CiB9OwogCiBzdGF0aWMgU3ltVGFiUmVjIERVTU1ZQ2hpcHNldHNbXSA9IHsKLSAgICB7RFVNTVlf
Q0hJUCwgImR1bW15In0sCisgICAge0RVTU1ZX0NISVAsICJzcGljZWR1bW15In0sCiAgICAgey0x
LCBOVUxMfQogfTsKIAogdHlwZWRlZiBlbnVtIHsKLSAgICBPUFRJT05fU1dfQ1VSU09SCisgICAg
T1BUSU9OX1NXX0NVUlNPUiwKKyAgICBPUFRJT05fREVWSUNFX1BBVEgsCisgICAgT1BUSU9OX0FD
Q0VMX01FVEhPRCwKIH0gRFVNTVlPcHRzOwogCiBzdGF0aWMgY29uc3QgT3B0aW9uSW5mb1JlYyBE
VU1NWU9wdGlvbnNbXSA9IHsKICAgICB7T1BUSU9OX1NXX0NVUlNPUiwgIlNXY3Vyc29yIiwgT1BU
Vl9CT09MRUFOLCB7MH0sIEZBTFNFfSwKKyAgICB7T1BUSU9OX0RFVklDRV9QQVRILCAia21zZGV2
IiwgT1BUVl9TVFJJTkcsIHswfSwgRkFMU0V9LAorICAgIHtPUFRJT05fQUNDRUxfTUVUSE9ELCAi
QWNjZWxNZXRob2QiLCBPUFRWX1NUUklORywgezB9LCBGQUxTRX0sCiAgICAgey0xLCBOVUxMLCBP
UFRWX05PTkUsIHswfSwgRkFMU0V9CiB9OwogCkBAIC0xMTcsNyArMTIzLDcgQEAgc3RhdGljIGNv
bnN0IE9wdGlvbkluZm9SZWMgRFVNTVlPcHRpb25zW10gPSB7CiBzdGF0aWMgTU9EVUxFU0VUVVBQ
Uk9UTyhkdW1teVNldHVwKTsKIAogc3RhdGljIFhGODZNb2R1bGVWZXJzaW9uSW5mbyBkdW1teVZl
cnNSZWMgPSB7Ci0gICAgImR1bW15IiwKKyAgICAic3BpY2VkdW1teSIsCiAgICAgTU9EVUxFVkVO
RE9SU1RSSU5HLAogICAgIE1PRElORk9TVFJJTkcxLAogICAgIE1PRElORk9TVFJJTkcyLApAQCAt
MTMzLDcgKzEzOSw3IEBAIHN0YXRpYyBYRjg2TW9kdWxlVmVyc2lvbkluZm8gZHVtbXlWZXJzUmVj
ID0gewogICogVGhpcyBpcyB0aGUgbW9kdWxlIGluaXQgZGF0YS4KICAqIEl0cyBuYW1lIGhhcyB0
byBiZSB0aGUgZHJpdmVyIG5hbWUgZm9sbG93ZWQgYnkgTW9kdWxlRGF0YQogICovCi1fWF9FWFBP
UlQgWEY4Nk1vZHVsZURhdGEgZHVtbXlNb2R1bGVEYXRhID0geyAmZHVtbXlWZXJzUmVjLCBkdW1t
eVNldHVwLCBOVUxMIH07CitfWF9FWFBPUlQgWEY4Nk1vZHVsZURhdGEgc3BpY2VkdW1teU1vZHVs
ZURhdGEgPSB7ICZkdW1teVZlcnNSZWMsIGR1bW15U2V0dXAsIE5VTEwgfTsKIAogc3RhdGljIHBv
aW50ZXIgZHVtbXlTZXR1cChwb2ludGVyIG1vZHVsZSwgcG9pbnRlciBvcHRzLCBpbnQgKmVycm1h
aiwgaW50ICplcnJtaW4pCiB7CkBAIC0xOTYsNyArMjAyLDcgQEAgc3RhdGljIGNvbnN0IE9wdGlv
bkluZm9SZWMgKkRVTU1ZQXZhaWxhYmxlT3B0aW9ucyhpbnQgY2hpcGlkLCBpbnQgYnVzaWQpCiAv
KiBNYW5kYXRvcnkgKi8KIHN0YXRpYyB2b2lkIERVTU1ZSWRlbnRpZnkoaW50IGZsYWdzKQogewot
ICAgIHhmODZQcmludENoaXBzZXRzKERVTU1ZX05BTUUsICJEcml2ZXIgZm9yIER1bW15IGNoaXBz
ZXRzIiwgRFVNTVlDaGlwc2V0cyk7CisgICAgeGY4NlByaW50Q2hpcHNldHMoRFVNTVlfTkFNRSwg
IlNwaWNlIERyaXZlciBmb3IgRHVtbXkgY2hpcHNldHMiLCBEVU1NWUNoaXBzZXRzKTsKIH0KIAog
LyogTWFuZGF0b3J5ICovCkBAIC0yNTAsNiArMjU2LDQ2IEBAIHN0YXRpYyBCb29sIERVTU1ZUHJv
YmUoRHJpdmVyUHRyIGRydiwgaW50IGZsYWdzKQogICAgIHJldHVybiBmb3VuZFNjcmVlbjsKIH0K
IAorc3RhdGljIGludCBkdW1teV9vcGVuX3JlbmRlcl9ub2RlKGNvbnN0IFNjcm5JbmZvUmVjICog
c2NybikKK3sKKyAgICBjb25zdCBEVU1NWVJlYyAqZHVtbXkgPSBzY3JuLT5kcml2ZXJQcml2YXRl
OworICAgIGNvbnN0IGNoYXIgKmRldmljZV9wYXRoOworICAgIGludCBmZDsKKworICAgIGlmICgh
KGRldmljZV9wYXRoID0geGY4NkdldE9wdFZhbFN0cmluZyhkdW1teS0+T3B0aW9ucywgT1BUSU9O
X0RFVklDRV9QQVRIKSkpCisgICAgICAgIGRldmljZV9wYXRoID0gIi9kZXYvZHJpL3JlbmRlckQx
MjgiOworICAgIGlmICgoZmQgPSBvcGVuKGRldmljZV9wYXRoLCBPX1JEV1IsIDApKSA9PSAtMSkK
KyAgICAgICAgeGY4NkRydk1zZyhzY3JuLT5zY3JuSW5kZXgsIFhfRVJST1IsICJvcGVuICVzOiAl
c1xuIiwgZGV2aWNlX3BhdGgsIHN0cmVycm9yKGVycm5vKSk7CisKKyAgICByZXR1cm4gZmQ7Cit9
CisKK3N0YXRpYyBCb29sIGR1bW15X2VuYWJsZV9nbGFtb3IoU2NybkluZm9SZWMgKiBzY3JuKQor
eworICAgIGNvbnN0IERVTU1ZUmVjICpkdW1teSA9IHNjcm4tPmRyaXZlclByaXZhdGU7CisgICAg
Y29uc3QgY2hhciAqYWNjZWxfbWV0aG9kOworCisgICAgaWYgKChhY2NlbF9tZXRob2QgPSB4Zjg2
R2V0T3B0VmFsU3RyaW5nKGR1bW15LT5PcHRpb25zLCBPUFRJT05fQUNDRUxfTUVUSE9EKSkKKyAg
ICAgICAgJiYgc3RyY21wKGFjY2VsX21ldGhvZCwgImdsYW1vciIpKSB7CisgICAgICAgIHhmODZE
cnZNc2coc2Nybi0+c2NybkluZGV4LCBYX0NPTkZJRywgIkdsYW1vciBkaXNhYmxlZC5cbiIpOwor
ICAgICAgICByZXR1cm4gRkFMU0U7CisgICAgfQorCisgICAgaWYgKCF4Zjg2TG9hZFN1Yk1vZHVs
ZShzY3JuLCBHTEFNT1JfRUdMX01PRFVMRV9OQU1FKSkgeworICAgICAgICB4Zjg2RHJ2TXNnKHNj
cm4tPnNjcm5JbmRleCwgWF9FUlJPUiwgIkZhaWxlZCB0byBsb2FkIGdsYW1vciBtb2R1bGUuXG4i
KTsKKyAgICAgICAgcmV0dXJuIEZBTFNFOworICAgIH0KKworICAgIGlmICghZ2xhbW9yX2VnbF9p
bml0KHNjcm4sIGR1bW15LT5mZCkpIHsKKyAgICAgICAgeGY4NkRydk1zZyhzY3JuLT5zY3JuSW5k
ZXgsIFhfRVJST1IsICJHbGFtb3IgaW5pdGlhbGlzYXRpb24gZmFpbGVkLlxuIik7CisgICAgICAg
IHJldHVybiBGQUxTRTsKKyAgICB9CisKKyAgICB4Zjg2RHJ2TXNnKHNjcm4tPnNjcm5JbmRleCwg
WF9JTkZPLCAiR2xhbW9yIGluaXRpYWxpc2VkLlxuIik7CisKKyAgICByZXR1cm4gVFJVRTsKK30K
KwogI2RlZmluZSBSRVRVUk4gXAogICAgIHsgRFVNTVlGcmVlUmVjKHBTY3JuKTtcCiAJCQkgICAg
cmV0dXJuIEZBTFNFO1wKQEAgLTM0Myw2ICszODksOSBAQCBCb29sIERVTU1ZUHJlSW5pdChTY3Ju
SW5mb1B0ciBwU2NybiwgaW50IGZsYWdzKQogCiAgICAgeGY4NkdldE9wdFZhbEJvb2woZFB0ci0+
T3B0aW9ucywgT1BUSU9OX1NXX0NVUlNPUiwgJmRQdHItPnN3Q3Vyc29yKTsKIAorICAgIGRQdHIt
PmZkID0gZHVtbXlfb3Blbl9yZW5kZXJfbm9kZShwU2Nybik7CisgICAgZFB0ci0+Z2xhbW9yID0g
ZHVtbXlfZW5hYmxlX2dsYW1vcihwU2Nybik7CisKICAgICBpZiAoZGV2aWNlLT52aWRlb1JhbSAh
PSAwKSB7CiAgICAgICAgIHBTY3JuLT52aWRlb1JhbSA9IGRldmljZS0+dmlkZW9SYW07CiAgICAg
ICAgIHhmODZEcnZNc2cocFNjcm4tPnNjcm5JbmRleCwgWF9DT05GSUcsICJWaWRlb1JBTTogJWQg
a0J5dGVcbiIsIHBTY3JuLT52aWRlb1JhbSk7CkBAIC01NDAsNiArNTg5LDEyIEBAIHN0YXRpYyBC
b29sIERVTU1ZU2NyZWVuSW5pdChTQ1JFRU5fSU5JVF9BUkdTX0RFQ0wpCiAgICAgLyogbXVzdCBi
ZSBhZnRlciBSR0Igb3JkZXJpbmcgZml4ZWQgKi8KICAgICBmYlBpY3R1cmVJbml0KHBTY3JlZW4s
IDAsIDApOwogCisgICAgaWYgKGRQdHItPmdsYW1vciAmJiAhZ2xhbW9yX2luaXQocFNjcmVlbiwg
R0xBTU9SX1VTRV9FR0xfU0NSRUVOKSkgeworICAgICAgICB4Zjg2RHJ2TXNnKHBTY3JuLT5zY3Ju
SW5kZXgsIFhfRVJST1IsCisgICAgICAgICAgICAgICAgICAgIkZhaWxlZCB0byBpbml0aWFsaXNl
IGdsYW1vciBhdCBTY3JlZW5Jbml0KCkgdGltZS5cbiIpOworICAgICAgICByZXR1cm4gRkFMU0U7
CisgICAgfQorCiAgICAgeGY4NlNldEJsYWNrV2hpdGVQaXhlbHMocFNjcmVlbik7CiAKICAgICBp
ZiAoZFB0ci0+c3dDdXJzb3IpCkBAIC01OTUsNiArNjUwLDE0IEBAIHN0YXRpYyBCb29sIERVTU1Z
U2NyZWVuSW5pdChTQ1JFRU5fSU5JVF9BUkdTX0RFQ0wpCiAgICAgZFB0ci0+Q3JlYXRlV2luZG93
ID0gcFNjcmVlbi0+Q3JlYXRlV2luZG93OwogICAgIHBTY3JlZW4tPkNyZWF0ZVdpbmRvdyA9IERV
TU1ZQ3JlYXRlV2luZG93OwogCisgICAgaWYgKGRQdHItPmdsYW1vcikgeworICAgICAgICBpZiAo
IWR1bW15X2RyaTJfc2NyZWVuX2luaXQocFNjcmVlbikpCisgICAgICAgICAgICB4Zjg2RHJ2TXNn
KHBTY3JuLT5zY3JuSW5kZXgsIFhfRVJST1IsICJGYWlsZWQgdG8gaW5pdGlhbGlzZSB0aGUgRFJJ
MiBleHRlbnNpb24uXG4iKTsKKworICAgICAgICBpZiAoIWR1bW15X3ByZXNlbnRfc2NyZWVuX2lu
aXQocFNjcmVlbikpCisgICAgICAgICAgICB4Zjg2RHJ2TXNnKHBTY3JuLT5zY3JuSW5kZXgsIFhf
RVJST1IsICJGYWlsZWQgdG8gaW5pdGlhbGlzZSB0aGUgUHJlc2VudCBleHRlbnNpb24uXG4iKTsK
KyAgICB9CisKICAgICAvKiBSZXBvcnQgYW55IHVudXNlZCBvcHRpb25zIChvbmx5IGZvciB0aGUg
Zmlyc3QgZ2VuZXJhdGlvbikgKi8KICAgICBpZiAoc2VydmVyR2VuZXJhdGlvbiA9PSAxKSB7CiAg
ICAgICAgIHhmODZTaG93VW51c2VkT3B0aW9ucyhwU2Nybi0+c2NybkluZGV4LCBwU2Nybi0+b3B0
aW9ucyk7CkBAIC02MjAsNiArNjgzLDkgQEAgc3RhdGljIEJvb2wgRFVNTVlDbG9zZVNjcmVlbihD
TE9TRV9TQ1JFRU5fQVJHU19ERUNMKQogICAgIFNjcm5JbmZvUHRyIHBTY3JuID0geGY4NlNjcmVl
blRvU2NybihwU2NyZWVuKTsKICAgICBEVU1NWVB0ciBkUHRyID0gRFVNTVlQVFIocFNjcm4pOwog
CisgICAgaWYgKGRQdHItPmdsYW1vcikKKyAgICAgICAgZHVtbXlfZHJpMl9jbG9zZV9zY3JlZW4o
cFNjcmVlbik7CisKICAgICBmcmVlKHBTY3JlZW4tPkdldFNjcmVlblBpeG1hcChwU2NyZWVuKS0+
ZGV2UHJpdmF0ZS5wdHIpOwogCiAgICAgaWYgKGRQdHItPkN1cnNvckluZm8pCi0tIAoyLjExLjAK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClNwaWNlLWRl
dmVsIG1haWxpbmcgbGlzdApTcGljZS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6
Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9zcGljZS1kZXZlbA==
